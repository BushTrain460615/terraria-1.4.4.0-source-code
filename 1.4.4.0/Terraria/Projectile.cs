using System;
using System.Collections.Generic;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Audio;
using ReLogic.Utilities;
using Terraria.Audio;
using Terraria.Chat;
using Terraria.DataStructures;
using Terraria.Enums;
using Terraria.GameContent;
using Terraria.GameContent.Achievements;
using Terraria.GameContent.Creative;
using Terraria.GameContent.Drawing;
using Terraria.GameContent.Events;
using Terraria.GameContent.Golf;
using Terraria.GameContent.Shaders;
using Terraria.GameContent.UI;
using Terraria.Graphics;
using Terraria.Graphics.Effects;
using Terraria.Graphics.Shaders;
using Terraria.ID;
using Terraria.Localization;
using Terraria.ObjectData;
using Terraria.Physics;
using Terraria.Utilities;
using Terraria.WorldBuilding;

namespace Terraria
{
	public class Projectile : Entity
	{
		private class NPCDistanceByIndexComparator : IComparer<Tuple<int, float>>
		{
			public int Compare(Tuple<int, float> npcIndex1, Tuple<int, float> npcIndex2)
			{
				return npcIndex1.Item2.CompareTo(npcIndex2.Item2);
			}
		}

		public struct HallowBossPelletStormInfo
		{
			public float StartAngle;

			public float AnglePerBullet;

			public int BulletsInStorm;

			public float BulletsProgressInStormStartNormalized;

			public float BulletsProgressInStormBonusByIndexNormalized;

			public float StormTotalRange;

			public Vector2 BulletSize;

			public float GetBulletProgress(int bulletIndex)
			{
				return BulletsProgressInStormStartNormalized + BulletsProgressInStormBonusByIndexNormalized * (float)bulletIndex;
			}

			public bool IsValid(int bulletIndex)
			{
				float bulletProgress = GetBulletProgress(bulletIndex);
				if (bulletProgress >= 0f)
				{
					return bulletProgress <= 1f;
				}
				return false;
			}

			public Vector2 GetBulletPosition(int bulletIndex, Vector2 centerPoint)
			{
				return centerPoint + Vector2.UnitX.RotatedBy(StartAngle + AnglePerBullet * (float)bulletIndex) * StormTotalRange * GetBulletProgress(bulletIndex);
			}

			public Rectangle GetBulletHitbox(int bulletIndex, Vector2 centerPoint)
			{
				return Utils.CenteredRectangle(GetBulletPosition(bulletIndex, centerPoint), BulletSize);
			}
		}

		public static uint[][] perIDStaticNPCImmunity = new uint[1022][];

		public const int SentryLifeTime = 36000;

		public const int ArrowLifeTime = 1200;

		public float ownerHitCheckDistance = 1000f;

		public bool arrow;

		public int numHits;

		public bool bobber;

		public bool netImportant;

		public bool noDropItem;

		public static int maxAI = 3;

		public bool counterweight;

		public float scale = 1f;

		public float rotation;

		public int type;

		public int alpha;

		public bool sentry;

		public short glowMask;

		public int owner = 255;

		public float[] ai = new float[maxAI];

		public float[] localAI = new float[maxAI];

		public float gfxOffY;

		public float stepSpeed = 1f;

		public int aiStyle;

		public int timeLeft;

		public int soundDelay;

		public int damage;

		public int originalDamage;

		public int spriteDirection = 1;

		public bool hostile;

		public bool reflected;

		public float knockBack;

		public bool friendly;

		public int penetrate = 1;

		private int[] localNPCImmunity = new int[200];

		public bool usesLocalNPCImmunity;

		public bool usesIDStaticNPCImmunity;

		public bool appliesImmunityTimeOnSingleHits;

		public int maxPenetrate = 1;

		public int identity;

		public float light;

		public bool netUpdate;

		public bool netUpdate2;

		public int netSpam;

		public Vector2[] oldPos = new Vector2[10];

		public float[] oldRot = new float[10];

		public int[] oldSpriteDirection = new int[10];

		public bool minion;

		public float minionSlots;

		public int minionPos;

		public int restrikeDelay;

		public bool tileCollide;

		public int extraUpdates;

		public bool stopsDealingDamageAfterPenetrateHits;

		public int numUpdates;

		public bool ignoreWater;

		public bool isAPreviewDummy;

		public bool hide;

		public bool ownerHitCheck;

		public bool usesOwnerMeleeHitCD;

		public int[] playerImmune = new int[255];

		public string miscText = "";

		public bool melee;

		public bool ranged;

		public bool magic;

		public bool coldDamage;

		public bool noEnchantments;

		public bool noEnchantmentVisuals;

		public bool trap;

		public bool npcProj;

		public bool originatedFromActivableTile;

		public int frameCounter;

		public int frame;

		public bool manualDirectionChange;

		public int projUUID = -1;

		public bool decidesManualFallThrough;

		public bool shouldFallThrough;

		public int localNPCHitCooldown = -2;

		public int idStaticNPCHitCooldown = -1;

		public int bannerIdToRespondTo;

		private static Conditions.IsSolid _cachedConditions_solid = new Conditions.IsSolid();

		private static Conditions.NotNull _cachedConditions_notNull = new Conditions.NotNull();

		private static Point[] _javelinsMax6 = new Point[6];

		private static Point[] _javelinsMax8 = new Point[8];

		private static Point[] _javelinsMax10 = new Point[10];

		public List<Vector2> WhipPointsForCollision = new List<Vector2>();

		private static Rectangle _lanceHitboxBounds = new Rectangle(0, 0, 300, 300);

		private static List<Tuple<int, float>> _medusaHeadTargetList = new List<Tuple<int, float>>();

		private static NPCDistanceByIndexComparator _medusaTargetComparer = new NPCDistanceByIndexComparator();

		private static List<int> _ai164_blacklistedTargets = new List<int>();

		private static List<int> _ai158_blacklistedTargets = new List<int>();

		private static List<int> _ai156_blacklistedTargets = new List<int>();

		private static float[] _CompanionCubeScreamCooldown = new float[255];

		public string Name => Lang.GetProjectileName(type).Value;

		public bool WipableTurret
		{
			get
			{
				if (owner == Main.myPlayer && sentry)
				{
					return !TurretShouldPersist();
				}
				return false;
			}
		}

		public float Opacity
		{
			get
			{
				return 1f - (float)alpha / 255f;
			}
			set
			{
				alpha = (int)MathHelper.Clamp((1f - value) * 255f, 0f, 255f);
			}
		}

		public int MaxUpdates
		{
			get
			{
				return extraUpdates + 1;
			}
			set
			{
				extraUpdates = value - 1;
			}
		}

		public NPC OwnerMinionAttackTargetNPC
		{
			get
			{
				if (Main.player[owner].MinionAttackTargetNPC < 0)
				{
					return null;
				}
				return Main.npc[Main.player[owner].MinionAttackTargetNPC];
			}
		}

		public static void InitializeStaticThings()
		{
			perIDStaticNPCImmunity = new uint[1022][];
			for (int i = 0; i < perIDStaticNPCImmunity.Length; i++)
			{
				perIDStaticNPCImmunity[i] = new uint[200];
			}
			WorldGen.Hooks.OnWorldLoad += ResetImmunity;
		}

		public static void ResetImmunity()
		{
			for (int i = 0; i < 1022; i++)
			{
				for (int j = 0; j < 200; j++)
				{
					perIDStaticNPCImmunity[i][j] = 0u;
				}
			}
		}

		public static bool IsNPCIndexImmuneToProjectileType(int projectileType, int npcIndex)
		{
			return perIDStaticNPCImmunity[projectileType][npcIndex] <= Main.GameUpdateCount;
		}

		public bool TurretShouldPersist()
		{
			switch (type)
			{
			case 663:
			case 665:
			case 667:
			case 677:
			case 678:
			case 679:
			case 688:
			case 689:
			case 690:
			case 691:
			case 692:
			case 693:
				return DD2Event.Ongoing;
			default:
				return false;
			}
		}

		public void SetDefaults(int Type)
		{
			ownerHitCheckDistance = 1000f;
			counterweight = false;
			sentry = false;
			arrow = false;
			bobber = false;
			numHits = 0;
			netImportant = false;
			manualDirectionChange = false;
			decidesManualFallThrough = false;
			shouldFallThrough = false;
			bannerIdToRespondTo = 0;
			stopsDealingDamageAfterPenetrateHits = false;
			localNPCHitCooldown = -2;
			idStaticNPCHitCooldown = -1;
			usesLocalNPCImmunity = false;
			usesIDStaticNPCImmunity = false;
			usesOwnerMeleeHitCD = false;
			appliesImmunityTimeOnSingleHits = false;
			int num = 10;
			if (Type >= 0)
			{
				num = ProjectileID.Sets.TrailCacheLength[Type];
			}
			if (num != oldPos.Length)
			{
				Array.Resize(ref oldPos, num);
				Array.Resize(ref oldRot, num);
				Array.Resize(ref oldSpriteDirection, num);
			}
			for (int i = 0; i < oldPos.Length; i++)
			{
				oldPos[i].X = 0f;
				oldPos[i].Y = 0f;
				oldRot[i] = 0f;
				oldSpriteDirection[i] = 0;
			}
			for (int j = 0; j < maxAI; j++)
			{
				ai[j] = 0f;
				localAI[j] = 0f;
			}
			for (int k = 0; k < 255; k++)
			{
				playerImmune[k] = 0;
			}
			ResetLocalNPCHitImmunity();
			noDropItem = false;
			minion = false;
			minionSlots = 0f;
			soundDelay = 0;
			spriteDirection = 1;
			melee = false;
			ranged = false;
			magic = false;
			ownerHitCheck = false;
			hide = false;
			lavaWet = false;
			wetCount = 0;
			wet = false;
			ignoreWater = false;
			isAPreviewDummy = false;
			hostile = false;
			reflected = false;
			netUpdate = false;
			netUpdate2 = false;
			netSpam = 0;
			numUpdates = 0;
			extraUpdates = 0;
			identity = 0;
			restrikeDelay = 0;
			light = 0f;
			penetrate = 1;
			tileCollide = true;
			position = Vector2.Zero;
			velocity = Vector2.Zero;
			aiStyle = 0;
			alpha = 0;
			glowMask = -1;
			type = Type;
			active = true;
			rotation = 0f;
			scale = 1f;
			owner = 255;
			timeLeft = 3600;
			friendly = false;
			damage = 0;
			originalDamage = 0;
			knockBack = 0f;
			miscText = "";
			coldDamage = false;
			noEnchantments = false;
			noEnchantmentVisuals = false;
			trap = false;
			npcProj = false;
			originatedFromActivableTile = false;
			projUUID = -1;
			frame = 0;
			frameCounter = 0;
			if (type == 1)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				timeLeft = 1200;
			}
			else if (type == 2)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				light = 1f;
				ranged = true;
				timeLeft = 1200;
			}
			else if (type == 3)
			{
				width = 22;
				height = 22;
				aiStyle = 2;
				friendly = true;
				penetrate = 4;
				ranged = true;
			}
			else if (type == 4)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				light = 0.35f;
				penetrate = 5;
				ranged = true;
				timeLeft = 1200;
			}
			else if (type == 5)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				light = 0.4f;
				penetrate = -1;
				alpha = 100;
				ignoreWater = true;
				ranged = true;
				extraUpdates = 1;
				timeLeft = 120;
			}
			else if (type == 6)
			{
				width = 22;
				height = 22;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
				light = 0.4f;
			}
			else if (type == 7 || type == 8)
			{
				width = 28;
				height = 28;
				aiStyle = 4;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				alpha = 255;
				ignoreWater = true;
				magic = true;
			}
			else if (type == 9)
			{
				width = 24;
				height = 24;
				aiStyle = 5;
				friendly = true;
				penetrate = 2;
				scale = 0.8f;
				tileCollide = false;
				melee = true;
			}
			else if (type == 10)
			{
				width = 64;
				height = 64;
				aiStyle = 6;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				alpha = 255;
				ignoreWater = true;
			}
			else if (type == 11)
			{
				width = 48;
				height = 48;
				aiStyle = 6;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				alpha = 255;
				ignoreWater = true;
			}
			else if (type == 12)
			{
				width = 18;
				height = 18;
				aiStyle = 5;
				if (Main.remixWorld)
				{
					hostile = true;
				}
				friendly = true;
				penetrate = -1;
				alpha = 50;
				light = 1f;
			}
			else if (type == 13)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 14)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				scale = 1.2f;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 1;
			}
			else if (type == 15)
			{
				width = 16;
				height = 16;
				aiStyle = 8;
				friendly = true;
				light = 0.8f;
				alpha = 100;
				magic = true;
			}
			else if (type == 16)
			{
				width = 32;
				height = 32;
				aiStyle = 9;
				friendly = true;
				light = 0.8f;
				alpha = 100;
				magic = true;
				ignoreWater = true;
			}
			else if (type == 17)
			{
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				ignoreWater = true;
			}
			else if (type == 18)
			{
				netImportant = true;
				width = 32;
				height = 32;
				aiStyle = 11;
				friendly = true;
				light = 0.9f;
				alpha = 150;
				tileCollide = false;
				penetrate = -1;
				timeLeft *= 5;
				ignoreWater = true;
				scale = 0.8f;
			}
			else if (type == 19)
			{
				width = 22;
				height = 22;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				light = 1f;
				melee = true;
			}
			else if (type == 20)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 3;
				light = 0.75f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.4f;
				timeLeft = 600;
				magic = true;
			}
			else if (type == 21)
			{
				width = 16;
				height = 16;
				aiStyle = 2;
				scale = 1.2f;
				friendly = true;
				ranged = true;
			}
			else if (type == 22)
			{
				width = 18;
				height = 18;
				aiStyle = 12;
				friendly = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				ignoreWater = true;
				magic = true;
				if (Main.remixWorld)
				{
					usesLocalNPCImmunity = true;
					localNPCHitCooldown = 12;
				}
			}
			else if (type == 23)
			{
				width = 4;
				height = 4;
				aiStyle = 13;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				ranged = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 12;
			}
			else if (type == 24)
			{
				width = 14;
				height = 14;
				aiStyle = 14;
				friendly = true;
				penetrate = 7;
				ranged = true;
			}
			else if (type == 25)
			{
				netImportant = true;
				width = 22;
				height = 22;
				aiStyle = 15;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 0.9f;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 26)
			{
				netImportant = true;
				width = 22;
				height = 22;
				aiStyle = 15;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 0.8f;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 27)
			{
				width = 16;
				height = 16;
				aiStyle = 8;
				friendly = true;
				alpha = 255;
				timeLeft /= 2;
				penetrate = 10;
				magic = true;
			}
			else if (type == 28)
			{
				width = 22;
				height = 22;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
			}
			else if (type == 29)
			{
				width = 10;
				height = 10;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
			}
			else if (type == 30)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 31)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 32)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 33)
			{
				width = 38;
				height = 38;
				aiStyle = 3;
				friendly = true;
				scale = 0.9f;
				penetrate = -1;
				melee = true;
			}
			else if (type == 34)
			{
				width = 32;
				height = 32;
				aiStyle = 9;
				friendly = true;
				light = 0.8f;
				penetrate = 2;
				magic = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 12;
			}
			else if (type == 35)
			{
				netImportant = true;
				width = 22;
				height = 22;
				aiStyle = 15;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 0.8f;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 36)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 2;
				light = 0.6f;
				alpha = 255;
				scale = 1.4f;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 15;
			}
			else if (type == 37)
			{
				width = 22;
				height = 22;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
			}
			else if (type == 38)
			{
				width = 14;
				height = 14;
				aiStyle = 0;
				hostile = true;
				penetrate = -1;
				aiStyle = 1;
				tileCollide = true;
			}
			else if (type == 39)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 40)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 41)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				penetrate = -1;
				ranged = true;
				light = 0.3f;
			}
			else if (type == 42)
			{
				knockBack = 8f;
				width = 10;
				height = 10;
				aiStyle = 10;
				ranged = true;
				friendly = true;
				extraUpdates = 1;
			}
			else if (type == 43)
			{
				knockBack = 12f;
				width = 24;
				height = 24;
				aiStyle = 17;
				penetrate = -1;
				if (Main.getGoodWorld)
				{
					friendly = true;
					hostile = true;
				}
			}
			else if (type == 44)
			{
				width = 48;
				height = 48;
				alpha = 100;
				light = 0.2f;
				aiStyle = 18;
				hostile = true;
				penetrate = -1;
				tileCollide = true;
				scale = 0.9f;
			}
			else if (type == 45)
			{
				width = 48;
				height = 48;
				alpha = 100;
				light = 0.2f;
				aiStyle = 18;
				friendly = true;
				penetrate = 5;
				tileCollide = true;
				scale = 0.9f;
				magic = true;
			}
			else if (type == 46)
			{
				width = 20;
				height = 20;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.1f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 47)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.1f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 48)
			{
				width = 12;
				height = 12;
				aiStyle = 2;
				friendly = true;
				penetrate = 2;
				ranged = true;
			}
			else if (type == 49)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.2f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 50)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 14;
				penetrate = -1;
				alpha = 75;
				light = 1f;
				timeLeft *= 5;
			}
			else if (type == 51)
			{
				width = 8;
				height = 8;
				aiStyle = 1;
				ranged = true;
				friendly = true;
			}
			else if (type == 52)
			{
				width = 22;
				height = 22;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
			}
			else if (type == 53)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 14;
				penetrate = -1;
				alpha = 75;
				light = 1f;
				timeLeft *= 5;
				tileCollide = false;
			}
			else if (type == 54)
			{
				width = 12;
				height = 12;
				aiStyle = 2;
				friendly = true;
				penetrate = 2;
				ranged = true;
			}
			else if (type == 55)
			{
				width = 10;
				height = 10;
				aiStyle = 0;
				hostile = true;
				penetrate = -1;
				aiStyle = 1;
				tileCollide = true;
			}
			else if (type == 56)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 57)
			{
				width = 18;
				height = 18;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 58)
			{
				width = 18;
				height = 18;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 1.08f;
			}
			else if (type == 59)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 0.9f;
			}
			else if (type == 60)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 0.9f;
			}
			else if (type == 61)
			{
				width = 18;
				height = 18;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 1.16f;
			}
			else if (type == 62)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 0.9f;
			}
			else if (type == 63)
			{
				netImportant = true;
				width = 22;
				height = 22;
				aiStyle = 15;
				friendly = true;
				penetrate = -1;
				melee = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 64)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.25f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 65)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				ranged = true;
				penetrate = -1;
				extraUpdates = 1;
			}
			else if (type == 66)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.27f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 67)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 68)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				ranged = true;
				penetrate = -1;
				extraUpdates = 1;
			}
			else if (type == 69)
			{
				width = 14;
				height = 14;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
			}
			else if (type == 70)
			{
				width = 14;
				height = 14;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
			}
			else if (type == 621)
			{
				width = 14;
				height = 14;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
			}
			else if (type == 71)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 72)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 11;
				friendly = true;
				light = 0.9f;
				tileCollide = false;
				penetrate = -1;
				timeLeft *= 5;
				ignoreWater = true;
				scale = 0.8f;
			}
			else if (type == 73 || type == 74)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
				light = 0.4f;
			}
			else if (type == 75)
			{
				width = 22;
				height = 22;
				aiStyle = 16;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 76 || type == 77 || type == 78)
			{
				if (type == 76)
				{
					width = 10;
					height = 22;
				}
				else if (type == 77)
				{
					width = 18;
					height = 24;
				}
				else
				{
					width = 22;
					height = 24;
				}
				aiStyle = 21;
				friendly = true;
				alpha = 100;
				light = 0.3f;
				penetrate = -1;
				timeLeft = 180;
				magic = true;
			}
			else if (type == 79)
			{
				width = 32;
				height = 32;
				aiStyle = 9;
				friendly = true;
				light = 0.8f;
				magic = true;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 12;
				ignoreWater = true;
			}
			else if (type == 80)
			{
				width = 16;
				height = 16;
				aiStyle = 22;
				friendly = true;
				magic = true;
				tileCollide = false;
				light = 0.5f;
				coldDamage = true;
			}
			else if (type == 81)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				hostile = true;
			}
			else if (type == 82)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				hostile = true;
			}
			else if (type == 83)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				penetrate = 3;
				light = 0.75f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.7f;
				timeLeft = 600;
				magic = true;
			}
			else if (type == 84)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				penetrate = 3;
				light = 0.75f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.2f;
				timeLeft = 600;
				magic = true;
			}
			else if (type == 85)
			{
				width = 6;
				height = 6;
				aiStyle = 193;
				friendly = true;
				alpha = 255;
				penetrate = 4;
				extraUpdates = 2;
				ranged = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
			else if (type == 86)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 11;
				friendly = true;
				light = 0.9f;
				tileCollide = false;
				penetrate = -1;
				timeLeft *= 5;
				ignoreWater = true;
				scale = 0.8f;
			}
			else if (type == 87)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 11;
				friendly = true;
				light = 0.9f;
				tileCollide = false;
				penetrate = -1;
				timeLeft *= 5;
				ignoreWater = true;
				scale = 0.8f;
			}
			else if (type == 88)
			{
				width = 6;
				height = 6;
				aiStyle = 1;
				friendly = true;
				penetrate = 3;
				light = 0.75f;
				alpha = 255;
				extraUpdates = 4;
				scale = 1.4f;
				timeLeft = 600;
				magic = true;
			}
			else if (type == 89)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				scale = 1.2f;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 1;
			}
			else if (type == 90)
			{
				width = 6;
				height = 6;
				aiStyle = 24;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 50;
				scale = 1.2f;
				timeLeft = 600;
				ranged = true;
				tileCollide = false;
			}
			else if (type == 91)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				timeLeft = 1200;
			}
			else if (type == 92)
			{
				width = 24;
				height = 24;
				aiStyle = 5;
				friendly = true;
				penetrate = 1;
				alpha = 50;
				scale = 0.8f;
				tileCollide = false;
				ranged = true;
			}
			else if (type == 93)
			{
				light = 0.15f;
				width = 12;
				height = 12;
				aiStyle = 2;
				friendly = true;
				penetrate = 2;
				magic = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 20;
			}
			else if (type == 94)
			{
				ignoreWater = true;
				width = 8;
				height = 8;
				aiStyle = 24;
				friendly = true;
				light = 0.5f;
				alpha = 50;
				scale = 1.2f;
				timeLeft = 600;
				magic = true;
				tileCollide = true;
				penetrate = 1;
			}
			else if (type == 95)
			{
				width = 16;
				height = 16;
				aiStyle = 8;
				friendly = true;
				light = 0.8f;
				alpha = 100;
				magic = true;
				penetrate = 2;
			}
			else if (type == 96)
			{
				width = 16;
				height = 16;
				aiStyle = 8;
				hostile = true;
				light = 0.8f;
				alpha = 100;
				magic = true;
				penetrate = -1;
				scale = 0.9f;
				scale = 1.3f;
			}
			else if (type == 97)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.1f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 98)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				hostile = true;
				penetrate = -1;
				trap = true;
			}
			else if (type == 99 || type == 727 || type == 1013 || type == 1014)
			{
				width = 31;
				height = 31;
				aiStyle = 25;
				friendly = true;
				hostile = true;
				penetrate = -1;
				trap = true;
			}
			else if (type == 1005)
			{
				width = 15;
				height = 15;
				aiStyle = 25;
				friendly = true;
				hostile = true;
				penetrate = -1;
				trap = true;
			}
			else if (type == 1021)
			{
				width = 31;
				height = 31;
				aiStyle = 25;
				hostile = true;
				penetrate = -1;
				extraUpdates = 1;
				timeLeft *= 3;
			}
			else if (type == 100)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				penetrate = 3;
				light = 0.75f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.8f;
				timeLeft = 2700;
				magic = true;
			}
			else if (type == 101)
			{
				width = 6;
				height = 6;
				aiStyle = 23;
				hostile = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 3;
				magic = true;
			}
			else if (type == 102)
			{
				width = 22;
				height = 22;
				aiStyle = 16;
				hostile = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 103)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				light = 1f;
				ranged = true;
				timeLeft = 1200;
			}
			else if (type == 104)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				scale = 1.2f;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 2;
			}
			else if (type == 105)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.3f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 106)
			{
				width = 32;
				height = 32;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
				light = 0.4f;
			}
			else if (type == 107)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 1.1f;
			}
			else if (type == 108)
			{
				width = 260;
				height = 260;
				aiStyle = 16;
				friendly = true;
				hostile = true;
				penetrate = -1;
				tileCollide = false;
				alpha = 255;
				timeLeft = 2;
				trap = true;
			}
			else if (type == 109)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				hostile = true;
				scale = 0.9f;
				penetrate = -1;
				coldDamage = true;
				ranged = true;
			}
			else if (type == 110)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
				light = 0.5f;
				alpha = 255;
				scale = 1.2f;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 1;
			}
			else if (type == 111)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 112)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 113)
			{
				width = 22;
				height = 22;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
				light = 0.4f;
				coldDamage = true;
			}
			else if (type == 114)
			{
				width = 16;
				height = 16;
				aiStyle = 27;
				magic = true;
				penetrate = 3;
				light = 0.5f;
				alpha = 255;
				friendly = true;
			}
			else if (type == 115)
			{
				width = 16;
				height = 16;
				aiStyle = 27;
				hostile = true;
				magic = true;
				penetrate = -1;
				light = 0.5f;
				alpha = 255;
			}
			else if (type == 116)
			{
				width = 16;
				height = 16;
				aiStyle = 27;
				melee = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				friendly = true;
			}
			else if (type == 117)
			{
				arrow = true;
				extraUpdates = 2;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				timeLeft = 1200;
			}
			else if (type == 118)
			{
				width = 10;
				height = 10;
				aiStyle = 28;
				alpha = 255;
				melee = true;
				penetrate = 1;
				friendly = true;
				coldDamage = true;
			}
			else if (type == 119)
			{
				width = 14;
				height = 14;
				aiStyle = 28;
				alpha = 255;
				melee = true;
				penetrate = 3;
				friendly = true;
				coldDamage = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 120)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				coldDamage = true;
				extraUpdates = 1;
				timeLeft = 1200;
			}
			else if (type == 121)
			{
				width = 10;
				height = 10;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 1;
				friendly = true;
			}
			else if (type == 122)
			{
				width = 10;
				height = 10;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 1;
				friendly = true;
			}
			else if (type == 123)
			{
				width = 10;
				height = 10;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 1;
				friendly = true;
			}
			else if (type == 124)
			{
				width = 10;
				height = 10;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 2;
				friendly = true;
			}
			else if (type == 125)
			{
				width = 10;
				height = 10;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 2;
				friendly = true;
			}
			else if (type == 126)
			{
				width = 10;
				height = 10;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 2;
				friendly = true;
			}
			else if (type == 127)
			{
				netImportant = true;
				width = 22;
				height = 22;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 128)
			{
				width = 14;
				height = 14;
				aiStyle = 28;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				coldDamage = true;
			}
			else if (type == 129)
			{
				width = 14;
				height = 14;
				aiStyle = 28;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				tileCollide = false;
			}
			else if (type == 130)
			{
				width = 22;
				height = 22;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.2f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 131)
			{
				width = 22;
				height = 22;
				aiStyle = 30;
				friendly = true;
				penetrate = 1;
				tileCollide = false;
				melee = true;
				light = 0.5f;
			}
			else if (type == 132)
			{
				width = 16;
				height = 16;
				aiStyle = 27;
				melee = true;
				penetrate = 3;
				light = 0.5f;
				alpha = 255;
				friendly = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 133)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
			else if (type == 134)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 135)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 136)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
			else if (type == 137)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 138)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 139)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
			else if (type == 140)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 141)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 142)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
			else if (type == 143)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 144)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 145)
			{
				width = 6;
				height = 6;
				aiStyle = 31;
				friendly = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 146)
			{
				width = 6;
				height = 6;
				aiStyle = 31;
				friendly = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 147)
			{
				width = 6;
				height = 6;
				aiStyle = 31;
				friendly = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 148)
			{
				width = 6;
				height = 6;
				aiStyle = 31;
				friendly = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 149)
			{
				width = 6;
				height = 6;
				aiStyle = 31;
				friendly = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 150 || type == 151 || type == 152)
			{
				width = 28;
				height = 28;
				aiStyle = 4;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				alpha = 255;
				ignoreWater = true;
				magic = true;
			}
			else if (type == 153)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.1f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 154)
			{
				netImportant = true;
				width = 22;
				height = 22;
				aiStyle = 15;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 0.8f;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 155)
			{
				netImportant = true;
				width = 44;
				height = 44;
				aiStyle = 32;
				friendly = true;
			}
			else if (type == 156)
			{
				width = 16;
				height = 16;
				aiStyle = 27;
				melee = true;
				penetrate = 2;
				light = 0.5f;
				alpha = 255;
				friendly = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 157)
			{
				width = 32;
				height = 32;
				aiStyle = 27;
				melee = true;
				light = 0.5f;
				alpha = 255;
				friendly = true;
				scale = 1.2f;
			}
			else if (type == 158)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 1;
			}
			else if (type == 159)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 1;
			}
			else if (type == 160)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 1;
			}
			else if (type == 161)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 1;
			}
			else if (type == 162)
			{
				width = 16;
				height = 16;
				aiStyle = 2;
				friendly = true;
				penetrate = 4;
				alpha = 255;
			}
			else if (type == 163)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 33;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 36000;
			}
			else if (type == 164)
			{
				width = 128;
				height = 128;
				aiStyle = 16;
				friendly = true;
				hostile = true;
				penetrate = -1;
				tileCollide = false;
				alpha = 255;
				timeLeft = 2;
			}
			else if (type == 165)
			{
				netImportant = true;
				width = 12;
				height = 12;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 166)
			{
				width = 14;
				height = 14;
				aiStyle = 2;
				friendly = true;
				ranged = true;
				coldDamage = true;
			}
			else if (type == 167 || type == 168 || type == 169 || type == 170)
			{
				width = 14;
				height = 14;
				aiStyle = 34;
				friendly = true;
				ranged = true;
				timeLeft = 45;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 1;
				appliesImmunityTimeOnSingleHits = true;
			}
			else if (type == 171 || type == 505 || type == 506)
			{
				width = 14;
				height = 14;
				aiStyle = 35;
				penetrate = -1;
				tileCollide = false;
				timeLeft = 400;
			}
			else if (type == 172)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				light = 1f;
				ranged = true;
				coldDamage = true;
				timeLeft = 1200;
			}
			else if (type == 173)
			{
				width = 16;
				height = 16;
				aiStyle = 27;
				melee = true;
				penetrate = 1;
				light = 0.2f;
				alpha = 255;
				friendly = true;
			}
			else if (type == 174)
			{
				alpha = 255;
				width = 6;
				height = 6;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
				coldDamage = true;
			}
			else if (type == 175)
			{
				width = 34;
				height = 34;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 176)
			{
				alpha = 255;
				width = 6;
				height = 6;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 177)
			{
				width = 10;
				height = 10;
				aiStyle = 28;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				coldDamage = true;
			}
			else if (type == 178)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				penetrate = -1;
				timeLeft = 2;
			}
			else if (type == 179)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 180)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
				light = 0.5f;
				alpha = 255;
				scale = 1.2f;
				timeLeft = 600;
				extraUpdates = 1;
			}
			else if (type == 181)
			{
				width = 8;
				height = 8;
				aiStyle = 36;
				friendly = true;
				penetrate = 3;
				alpha = 255;
				timeLeft = 600;
				extraUpdates = 3;
			}
			else if (type == 182)
			{
				light = 0.15f;
				width = 30;
				height = 30;
				aiStyle = 3;
				friendly = true;
				penetrate = 10;
				melee = true;
				extraUpdates = 1;
			}
			else if (type == 183)
			{
				width = 14;
				height = 22;
				aiStyle = 14;
				penetrate = 1;
				timeLeft = 180;
				ranged = true;
				friendly = true;
			}
			else if (type == 184)
			{
				width = 6;
				height = 6;
				aiStyle = 1;
				friendly = true;
				hostile = true;
				penetrate = -1;
				trap = true;
			}
			else if (type == 185)
			{
				width = 14;
				height = 14;
				aiStyle = 14;
				friendly = true;
				hostile = true;
				penetrate = -1;
				timeLeft = 900;
				trap = true;
			}
			else if (type == 186)
			{
				width = 10;
				height = 14;
				aiStyle = 37;
				friendly = true;
				tileCollide = false;
				ignoreWater = true;
				hostile = true;
				penetrate = -1;
				timeLeft = 300;
				trap = true;
			}
			else if (type == 187)
			{
				width = 6;
				height = 6;
				aiStyle = 38;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 60;
				trap = true;
			}
			else if (type == 188)
			{
				width = 6;
				height = 6;
				aiStyle = 23;
				friendly = true;
				hostile = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				trap = true;
			}
			else if (type == 189)
			{
				width = 8;
				height = 8;
				aiStyle = 36;
				friendly = true;
				penetrate = 3;
				alpha = 255;
				timeLeft = 600;
				magic = true;
				extraUpdates = 3;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 190)
			{
				width = 22;
				height = 22;
				aiStyle = 39;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				ranged = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 14;
			}
			else if (type >= 191 && type <= 194)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 26;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				if (type == 192)
				{
					scale = 1.025f;
				}
				if (type == 193)
				{
					scale = 1.05f;
				}
				if (type == 194)
				{
					scale = 1.075f;
				}
			}
			else if (type == 195)
			{
				tileCollide = false;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				extraUpdates = 1;
			}
			else if (type == 196)
			{
				width = 16;
				height = 16;
				aiStyle = 14;
				penetrate = -1;
				scale = 0.8f;
			}
			else if (type == 197)
			{
				netImportant = true;
				width = 42;
				height = 42;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 198)
			{
				netImportant = true;
				width = 26;
				height = 26;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 199)
			{
				netImportant = true;
				width = 28;
				height = 28;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
				ignoreWater = true;
			}
			else if (type == 200)
			{
				netImportant = true;
				width = 28;
				height = 28;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 201)
			{
				knockBack = 12f;
				width = 24;
				height = 24;
				aiStyle = 17;
				penetrate = -1;
				if (Main.getGoodWorld)
				{
					friendly = true;
					hostile = true;
				}
			}
			else if (type == 202)
			{
				knockBack = 12f;
				width = 24;
				height = 24;
				aiStyle = 17;
				penetrate = -1;
				if (Main.getGoodWorld)
				{
					friendly = true;
					hostile = true;
				}
			}
			else if (type == 203)
			{
				knockBack = 12f;
				width = 24;
				height = 24;
				aiStyle = 17;
				penetrate = -1;
				if (Main.getGoodWorld)
				{
					friendly = true;
					hostile = true;
				}
			}
			else if (type == 204)
			{
				knockBack = 12f;
				width = 24;
				height = 24;
				aiStyle = 17;
				penetrate = -1;
				if (Main.getGoodWorld)
				{
					friendly = true;
					hostile = true;
				}
			}
			else if (type == 205)
			{
				knockBack = 12f;
				width = 24;
				height = 24;
				aiStyle = 17;
				penetrate = -1;
				if (Main.getGoodWorld)
				{
					friendly = true;
					hostile = true;
				}
			}
			else if (type == 206)
			{
				width = 14;
				height = 14;
				aiStyle = 40;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				timeLeft = 600;
				magic = true;
			}
			else if (type == 207)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.2f;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 208)
			{
				netImportant = true;
				width = 18;
				height = 36;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 209)
			{
				width = 12;
				height = 32;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
				light = 0.5f;
			}
			else if (type == 210)
			{
				netImportant = true;
				width = 14;
				height = 30;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 211)
			{
				netImportant = true;
				width = 24;
				height = 24;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
				light = 1f;
				ignoreWater = true;
			}
			else if (type == 212)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.12f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 213)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 0.92f;
			}
			else if (type == 214)
			{
				width = 18;
				height = 18;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 215)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.27f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 216)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 0.93f;
			}
			else if (type == 217)
			{
				width = 18;
				height = 18;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 1.12f;
			}
			else if (type == 218)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.28f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 219)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 0.95f;
			}
			else if (type == 220)
			{
				width = 18;
				height = 18;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 1.2f;
			}
			else if (type == 221)
			{
				width = 20;
				height = 20;
				aiStyle = 41;
				friendly = true;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 120;
				penetrate = -1;
				scale = 1f + (float)Main.rand.Next(30) * 0.01f;
				extraUpdates = 2;
			}
			else if (type == 222)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.3f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 223)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 1f;
			}
			else if (type == 224)
			{
				width = 18;
				height = 18;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 1.1f;
			}
			else if (type == 225)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				extraUpdates = 1;
				timeLeft = 1200;
			}
			else if (type == 226)
			{
				netImportant = true;
				width = 22;
				height = 42;
				aiStyle = 42;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				timeLeft *= 5;
				light = 0.4f;
				ignoreWater = true;
			}
			else if (type == 227)
			{
				netImportant = true;
				tileCollide = false;
				width = 14;
				height = 14;
				aiStyle = 43;
				friendly = true;
				penetrate = 1;
				timeLeft = 180;
				extraUpdates = 180;
				hide = true;
			}
			else if (type == 228)
			{
				tileCollide = false;
				width = 30;
				height = 30;
				aiStyle = 44;
				friendly = true;
				melee = true;
				scale = 1.1f;
				penetrate = -1;
				noEnchantmentVisuals = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 229)
			{
				width = 30;
				height = 30;
				aiStyle = 44;
				friendly = true;
				melee = true;
				penetrate = -1;
				light = 0.2f;
				noEnchantmentVisuals = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type >= 230 && type <= 235)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 236)
			{
				netImportant = true;
				width = 34;
				height = 34;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 237)
			{
				netImportant = true;
				width = 28;
				height = 28;
				aiStyle = 45;
				penetrate = -1;
			}
			else if (type == 238)
			{
				netImportant = true;
				tileCollide = false;
				ignoreWater = true;
				width = 54;
				height = 28;
				aiStyle = 45;
				penetrate = -1;
				timeLeft = 18000;
			}
			else if (type == 239)
			{
				ignoreWater = true;
				width = 4;
				height = 40;
				aiStyle = 45;
				friendly = true;
				penetrate = 5;
				timeLeft = 300;
				scale = 1.1f;
				magic = true;
				extraUpdates = 1;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 240)
			{
				width = 16;
				height = 16;
				aiStyle = 2;
				hostile = true;
				penetrate = -1;
				alpha = 255;
			}
			else if (type == 241)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 242)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 3;
				light = 0.5f;
				alpha = 255;
				extraUpdates = 7;
				scale = 1.18f;
				timeLeft = 600;
				ranged = true;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 15;
			}
			else if (type == 243)
			{
				netImportant = true;
				width = 28;
				height = 28;
				aiStyle = 45;
				penetrate = -1;
			}
			else if (type == 244)
			{
				netImportant = true;
				tileCollide = false;
				ignoreWater = true;
				width = 54;
				height = 28;
				aiStyle = 45;
				penetrate = -1;
				timeLeft = 18000;
			}
			else if (type == 245)
			{
				ignoreWater = true;
				width = 4;
				height = 40;
				aiStyle = 45;
				friendly = true;
				penetrate = 2;
				timeLeft = 300;
				scale = 1.1f;
				magic = true;
				extraUpdates = 1;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 246)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				alpha = 255;
				extraUpdates = 1;
			}
			else if (type == 247)
			{
				netImportant = true;
				width = 34;
				height = 34;
				aiStyle = 15;
				friendly = true;
				penetrate = -1;
				melee = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 248)
			{
				width = 18;
				height = 18;
				aiStyle = 1;
				friendly = true;
				melee = true;
			}
			else if (type == 249)
			{
				width = 12;
				height = 12;
				aiStyle = 2;
				friendly = true;
				ranged = true;
			}
			else if (type == 250)
			{
				width = 12;
				height = 12;
				aiStyle = 46;
				penetrate = -1;
				magic = true;
				alpha = 255;
				ignoreWater = true;
				scale = 1.25f;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 251)
			{
				width = 14;
				height = 14;
				aiStyle = 46;
				friendly = true;
				penetrate = -1;
				magic = true;
				alpha = 255;
				light = 0.3f;
				tileCollide = false;
				ignoreWater = true;
				scale = 1.25f;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 252)
			{
				width = 18;
				height = 18;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 1.1f;
			}
			else if (type == 253)
			{
				width = 16;
				height = 16;
				aiStyle = 8;
				friendly = true;
				light = 0.8f;
				alpha = 100;
				magic = true;
				coldDamage = true;
			}
			else if (type == 254)
			{
				width = 38;
				height = 38;
				aiStyle = 47;
				magic = true;
				timeLeft = 900;
				light = 0.5f;
			}
			else if (type == 255)
			{
				width = 8;
				height = 8;
				aiStyle = 48;
				friendly = true;
				magic = true;
				extraUpdates = 100;
				timeLeft = 100;
			}
			else if (type == 256)
			{
				netImportant = true;
				tileCollide = false;
				width = 6;
				height = 6;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				scale = 1f;
				timeLeft *= 10;
			}
			else if (type == 257)
			{
				ignoreWater = true;
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
				light = 0.75f;
				alpha = 255;
				scale = 1.2f;
				timeLeft = 600;
				magic = true;
				coldDamage = true;
				extraUpdates = 1;
			}
			else if (type == 258)
			{
				width = 16;
				height = 16;
				aiStyle = 8;
				hostile = true;
				penetrate = -1;
				alpha = 100;
				timeLeft = 300;
			}
			else if (type == 259)
			{
				ignoreWater = true;
				tileCollide = false;
				width = 8;
				height = 8;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
				light = 0.3f;
				scale = 1.1f;
				magic = true;
				extraUpdates = 1;
			}
			else if (type == 260)
			{
				width = 8;
				height = 8;
				aiStyle = 48;
				friendly = true;
				magic = true;
				extraUpdates = 100;
				timeLeft = 200;
				penetrate = 1;
			}
			else if (type == 261)
			{
				width = 32;
				height = 34;
				aiStyle = 14;
				friendly = true;
				penetrate = 6;
				magic = true;
				ignoreWater = true;
				extraUpdates = 1;
			}
			else if (type == 262)
			{
				width = 30;
				height = 30;
				aiStyle = 13;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				melee = true;
				extraUpdates = 1;
			}
			else if (type == 263)
			{
				width = 34;
				height = 34;
				alpha = 100;
				light = 0.5f;
				aiStyle = 18;
				friendly = true;
				penetrate = 3;
				tileCollide = true;
				scale = 1f;
				melee = true;
				timeLeft = 180;
				coldDamage = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 8;
			}
			else if (type == 264)
			{
				ignoreWater = true;
				width = 4;
				height = 40;
				aiStyle = 45;
				hostile = true;
				penetrate = -1;
				timeLeft = 120;
				scale = 1.1f;
				extraUpdates = 1;
			}
			else if (type == 265)
			{
				width = 12;
				height = 12;
				aiStyle = 1;
				alpha = 255;
				friendly = true;
				magic = true;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
				timeLeft = 37;
			}
			else if (type == 266)
			{
				netImportant = true;
				alpha = 75;
				width = 24;
				height = 16;
				aiStyle = 26;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 12;
			}
			else if (type == 267)
			{
				alpha = 255;
				width = 14;
				height = 14;
				aiStyle = 1;
				friendly = true;
				ranged = true;
			}
			else if (type == 268)
			{
				netImportant = true;
				width = 18;
				height = 32;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 269)
			{
				netImportant = true;
				width = 20;
				height = 26;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 270)
			{
				width = 26;
				height = 26;
				aiStyle = 1;
				alpha = 255;
				hostile = true;
				penetrate = 3;
			}
			else if (type == 271)
			{
				width = 20;
				height = 20;
				aiStyle = 13;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				melee = true;
				scale = 1.2f;
			}
			else if (type == 272)
			{
				width = 32;
				height = 32;
				aiStyle = 3;
				friendly = true;
				scale = 0.9f;
				penetrate = -1;
				melee = true;
			}
			else if (type == 273)
			{
				width = 26;
				height = 26;
				aiStyle = 13;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				melee = true;
			}
			else if (type == 274)
			{
				width = 42;
				height = 42;
				alpha = 100;
				light = 0.5f;
				aiStyle = 18;
				friendly = true;
				penetrate = 5;
				tileCollide = false;
				scale = 1.1f;
				melee = true;
				timeLeft = 180;
			}
			else if (type == 275)
			{
				alpha = 255;
				width = 14;
				height = 14;
				aiStyle = 1;
				hostile = true;
			}
			else if (type == 276)
			{
				alpha = 255;
				width = 14;
				height = 14;
				aiStyle = 1;
				hostile = true;
			}
			else if (type == 277)
			{
				alpha = 255;
				width = 38;
				height = 38;
				aiStyle = 14;
				hostile = true;
			}
			else if (type == 278)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				light = 1f;
				ranged = true;
				extraUpdates = 1;
				timeLeft = 1200;
			}
			else if (type == 279)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.25f;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 280)
			{
				width = 32;
				height = 32;
				aiStyle = 12;
				friendly = true;
				alpha = 255;
				penetrate = 5;
				extraUpdates = 2;
				ignoreWater = true;
				magic = true;
			}
			else if (type == 281)
			{
				width = 28;
				height = 28;
				aiStyle = 49;
				friendly = true;
				alpha = 255;
				timeLeft = 600;
				idStaticNPCHitCooldown = 10;
				usesIDStaticNPCImmunity = true;
				penetrate = -1;
			}
			else if (type == 282)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				extraUpdates = 1;
				timeLeft = 1200;
			}
			else if (type == 283)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.25f;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 284)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.3f;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 285)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.3f;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 286)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.3f;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 287)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.3f;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 288)
			{
				width = 32;
				height = 32;
				aiStyle = 12;
				hostile = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				ignoreWater = true;
				magic = true;
			}
			else if (type == 289)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				penetrate = -1;
				timeLeft = 2;
			}
			else if (type == 290)
			{
				width = 4;
				height = 4;
				aiStyle = 48;
				hostile = true;
				magic = true;
				extraUpdates = 100;
				timeLeft = 100;
				penetrate = -1;
			}
			else if (type == 291)
			{
				width = 12;
				height = 12;
				aiStyle = 50;
				hostile = true;
				alpha = 255;
				magic = true;
				tileCollide = false;
				penetrate = -1;
			}
			else if (type == 292)
			{
				width = 130;
				height = 130;
				aiStyle = 50;
				hostile = true;
				alpha = 255;
				magic = true;
				tileCollide = false;
				penetrate = -1;
			}
			else if (type == 293)
			{
				width = 12;
				height = 12;
				aiStyle = 51;
				hostile = true;
				alpha = 255;
				magic = true;
				tileCollide = false;
				penetrate = -1;
				extraUpdates = 1;
			}
			else if (type == 294)
			{
				width = 4;
				height = 4;
				aiStyle = 48;
				friendly = true;
				magic = true;
				extraUpdates = 100;
				timeLeft = 300;
				penetrate = -1;
			}
			else if (type == 295)
			{
				width = 12;
				height = 12;
				aiStyle = 50;
				friendly = true;
				alpha = 255;
				magic = true;
				tileCollide = true;
			}
			else if (type == 296)
			{
				width = 150;
				height = 150;
				aiStyle = 50;
				friendly = true;
				alpha = 255;
				magic = true;
				tileCollide = false;
				penetrate = -1;
			}
			else if (type == 297)
			{
				width = 12;
				height = 12;
				aiStyle = 51;
				friendly = true;
				alpha = 255;
				magic = true;
				extraUpdates = 1;
				penetrate = 3;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 298)
			{
				width = 6;
				height = 6;
				aiStyle = 52;
				alpha = 255;
				magic = true;
				tileCollide = false;
				extraUpdates = 3;
			}
			else if (type == 299)
			{
				width = 6;
				height = 6;
				aiStyle = 1;
				hostile = true;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				magic = true;
				ignoreWater = true;
				tileCollide = false;
			}
			else if (type == 300)
			{
				width = 38;
				height = 38;
				aiStyle = 2;
				hostile = true;
				penetrate = -1;
				ignoreWater = true;
				tileCollide = false;
			}
			else if (type == 301)
			{
				width = 38;
				height = 38;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
				extraUpdates = 2;
			}
			else if (type == 302)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
				light = 0.3f;
				alpha = 255;
				extraUpdates = 7;
				scale = 1.18f;
				timeLeft = 300;
				ranged = true;
				ignoreWater = true;
			}
			else if (type == 303)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				hostile = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 304)
			{
				alpha = 255;
				width = 30;
				height = 30;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
				melee = true;
				light = 0.2f;
				ignoreWater = true;
				extraUpdates = 0;
			}
			else if (type == 305)
			{
				width = 6;
				height = 6;
				aiStyle = 52;
				alpha = 255;
				tileCollide = false;
				extraUpdates = 10;
			}
			else if (type == 306)
			{
				alpha = 255;
				width = 14;
				height = 14;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
				melee = true;
				ignoreWater = true;
				extraUpdates = 1;
			}
			else if (type == 307)
			{
				width = 16;
				height = 16;
				aiStyle = 36;
				penetrate = 1;
				alpha = 255;
				timeLeft = 600;
				melee = true;
				extraUpdates = 3;
			}
			else if (type == 308)
			{
				width = 80;
				height = 74;
				aiStyle = 53;
				timeLeft = 36000;
				light = 0.25f;
				ignoreWater = true;
				coldDamage = true;
				sentry = true;
				netImportant = true;
			}
			else if (type == 309)
			{
				width = 14;
				height = 14;
				aiStyle = 28;
				alpha = 255;
				penetrate = 3;
				friendly = true;
				extraUpdates = 3;
				coldDamage = true;
			}
			else if (type == 310)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 33;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 36000;
			}
			else if (type == 311)
			{
				width = 10;
				height = 12;
				aiStyle = 1;
				friendly = true;
				penetrate = 3;
				alpha = 255;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 312)
			{
				alpha = 255;
				width = 32;
				height = 32;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				timeLeft = 300;
				glowMask = 257;
			}
			else if (type == 313)
			{
				netImportant = true;
				width = 30;
				height = 30;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 314)
			{
				netImportant = true;
				width = 24;
				height = 40;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 315)
			{
				netImportant = true;
				width = 14;
				height = 14;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 316)
			{
				alpha = 255;
				width = 16;
				height = 16;
				aiStyle = 36;
				friendly = true;
				penetrate = 1;
				timeLeft = 600;
				magic = true;
			}
			else if (type == 317)
			{
				netImportant = true;
				width = 28;
				height = 28;
				aiStyle = 54;
				penetrate = 1;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 318)
			{
				width = 12;
				height = 14;
				aiStyle = 2;
				friendly = true;
				ranged = true;
			}
			else if (type == 319)
			{
				netImportant = true;
				width = 36;
				height = 30;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 320)
			{
				width = 34;
				height = 34;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
			}
			else if (type == 321)
			{
				width = 30;
				height = 30;
				aiStyle = 55;
				friendly = true;
				melee = true;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 322)
			{
				netImportant = true;
				width = 14;
				height = 14;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 323)
			{
				penetrate = 10;
				extraUpdates = 3;
				width = 14;
				height = 14;
				aiStyle = 1;
				alpha = 255;
				friendly = true;
				ranged = true;
				scale = 0.8f;
			}
			else if (type == 324)
			{
				netImportant = true;
				width = 26;
				height = 38;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 325)
			{
				alpha = 255;
				penetrate = -1;
				width = 14;
				height = 14;
				aiStyle = 1;
				hostile = true;
				tileCollide = false;
				timeLeft = 420;
			}
			else if (type >= 326 && type <= 328)
			{
				if (type == 326)
				{
					width = 14;
					height = 16;
				}
				else if (type == 327)
				{
					width = 12;
					height = 14;
				}
				else
				{
					width = 6;
					height = 12;
				}
				aiStyle = 14;
				hostile = true;
				penetrate = -1;
				timeLeft = 360;
			}
			else if (type == 329)
			{
				width = 80;
				height = 80;
				light = 0.25f;
				aiStyle = 56;
				hostile = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft = 420;
			}
			else if (type == 330)
			{
				width = 22;
				height = 22;
				aiStyle = 2;
				friendly = true;
				penetrate = 6;
				ranged = true;
			}
			else if (type == 331)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 332)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
				light = 0.5f;
			}
			else if (type == 333)
			{
				width = 38;
				height = 38;
				aiStyle = 3;
				friendly = true;
				scale = 0.9f;
				penetrate = -1;
				melee = true;
			}
			else if (type == 334)
			{
				netImportant = true;
				width = 28;
				height = 28;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 335)
			{
				width = 22;
				height = 22;
				aiStyle = 30;
				friendly = true;
				penetrate = 1;
				melee = true;
			}
			else if (type == 336)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				magic = true;
				scale = 0.8f;
				extraUpdates = 1;
			}
			else if (type == 337)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				magic = true;
				tileCollide = false;
				coldDamage = true;
				extraUpdates = 1;
			}
			else if (type == 338 || type == 339 || type == 340 || type == 341)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				penetrate = -1;
				friendly = true;
				ranged = true;
				scale = 0.9f;
			}
			else if (type == 342)
			{
				width = 22;
				height = 2;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.1f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				coldDamage = true;
			}
			else if (type == 343)
			{
				alpha = 255;
				width = 10;
				height = 10;
				aiStyle = 57;
				friendly = true;
				melee = true;
				scale = 1.1f;
				penetrate = 3;
				coldDamage = true;
				timeLeft = 120;
			}
			else if (type == 344)
			{
				width = 26;
				height = 26;
				aiStyle = 1;
				friendly = true;
				scale = 0.9f;
				alpha = 255;
				melee = true;
				coldDamage = true;
				tileCollide = false;
				noEnchantmentVisuals = true;
				timeLeft = 240;
			}
			else if (type == 345)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				scale = 0.8f;
			}
			else if (type == 346)
			{
				width = 18;
				height = 18;
				aiStyle = 14;
				hostile = true;
				penetrate = -1;
				timeLeft = 300;
			}
			else if (type == 347)
			{
				width = 6;
				height = 6;
				aiStyle = 2;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 348)
			{
				aiStyle = 1;
				width = 48;
				height = 48;
				hostile = true;
				penetrate = -1;
				tileCollide = false;
				coldDamage = true;
				extraUpdates = 1;
				timeLeft = 900;
			}
			else if (type == 349)
			{
				aiStyle = 1;
				width = 12;
				height = 12;
				hostile = true;
				penetrate = -1;
				coldDamage = true;
				timeLeft = 900;
			}
			else if (type == 350)
			{
				alpha = 255;
				penetrate = -1;
				width = 14;
				height = 14;
				aiStyle = 1;
				hostile = true;
				tileCollide = false;
				timeLeft /= 2;
			}
			else if (type == 351)
			{
				alpha = 255;
				penetrate = -1;
				width = 24;
				height = 24;
				aiStyle = 58;
				hostile = true;
				tileCollide = false;
			}
			else if (type == 352)
			{
				width = 30;
				height = 30;
				aiStyle = 14;
				hostile = true;
				penetrate = -1;
				timeLeft /= 3;
			}
			else if (type == 353)
			{
				netImportant = true;
				width = 18;
				height = 28;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 354)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				ranged = true;
				penetrate = -1;
				extraUpdates = 1;
			}
			else if (type == 355)
			{
				width = 12;
				height = 12;
				aiStyle = 1;
				alpha = 255;
				friendly = true;
				magic = true;
				penetrate = 5;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
				timeLeft = 58;
			}
			else if (type == 356)
			{
				width = 6;
				height = 6;
				aiStyle = 59;
				alpha = 255;
				magic = true;
				tileCollide = false;
				extraUpdates = 3;
			}
			else if (type == 357)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 6;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.2f;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 358)
			{
				width = 18;
				height = 18;
				aiStyle = 60;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				ignoreWater = true;
			}
			else if (type == 359)
			{
				width = 14;
				height = 14;
				aiStyle = 28;
				alpha = 255;
				magic = true;
				penetrate = 2;
				friendly = true;
				coldDamage = true;
			}
			else if ((type >= 360 && type <= 366) || type == 381 || type == 382 || type == 760 || type == 775)
			{
				width = 14;
				height = 14;
				aiStyle = 61;
				penetrate = -1;
				netImportant = true;
				bobber = true;
			}
			else if (type == 367)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1.1f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 368)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 369)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 370)
			{
				width = 14;
				height = 14;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
			}
			else if (type == 371)
			{
				width = 14;
				height = 14;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
			}
			else if (type == 372)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 373)
			{
				netImportant = true;
				width = 24;
				height = 26;
				aiStyle = 62;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 374)
			{
				width = 10;
				height = 10;
				aiStyle = 0;
				friendly = true;
				penetrate = 1;
				aiStyle = 1;
				tileCollide = true;
				scale *= 0.9f;
			}
			else if (type == 375)
			{
				netImportant = true;
				width = 34;
				height = 26;
				aiStyle = 62;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 376)
			{
				width = 12;
				height = 12;
				aiStyle = 0;
				friendly = true;
				penetrate = 5;
				aiStyle = 1;
				tileCollide = true;
				timeLeft = 100;
				alpha = 255;
				extraUpdates = 1;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 6;
			}
			else if (type == 377)
			{
				width = 66;
				height = 50;
				aiStyle = 53;
				timeLeft = 36000;
				ignoreWater = true;
				sentry = true;
				netImportant = true;
			}
			else if (type == 378)
			{
				width = 16;
				height = 16;
				aiStyle = 14;
				friendly = true;
				penetrate = -1;
				timeLeft = 60;
				scale = 0.9f;
			}
			else if (type == 379)
			{
				width = 14;
				height = 10;
				aiStyle = 63;
				friendly = true;
				timeLeft = 300;
				penetrate = 1;
			}
			else if (type == 380)
			{
				netImportant = true;
				width = 26;
				height = 26;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 383)
			{
				width = 34;
				height = 34;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
			}
			else if (type == 384)
			{
				width = 150;
				height = 42;
				hostile = true;
				penetrate = -1;
				aiStyle = 64;
				tileCollide = false;
				ignoreWater = true;
				alpha = 255;
				timeLeft = 540;
			}
			else if (type == 385)
			{
				width = 30;
				height = 30;
				hostile = true;
				penetrate = -1;
				aiStyle = 65;
				alpha = 255;
				timeLeft = 300;
			}
			else if (type == 386)
			{
				width = 150;
				height = 42;
				hostile = true;
				penetrate = -1;
				aiStyle = 64;
				tileCollide = false;
				ignoreWater = true;
				alpha = 255;
				timeLeft = 840;
			}
			else if (type == 387)
			{
				netImportant = true;
				width = 40;
				height = 20;
				aiStyle = 66;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				minionSlots = 0.5f;
				tileCollide = false;
				ignoreWater = true;
				friendly = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 16;
			}
			else if (type == 388)
			{
				netImportant = true;
				width = 40;
				height = 20;
				aiStyle = 66;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				minionSlots = 0.5f;
				tileCollide = false;
				ignoreWater = true;
				friendly = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 12;
			}
			else if (type == 389)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				light = 0.75f;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.2f;
				timeLeft = 600;
			}
			else if (type == 390 || type == 391 || type == 392)
			{
				width = 18;
				height = 18;
				aiStyle = 26;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 15;
			}
			else if (type == 393 || type == 394 || type == 395)
			{
				width = 20;
				height = 30;
				aiStyle = 67;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 18;
				decidesManualFallThrough = true;
			}
			else if (type == 396)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
				alpha = 100;
			}
			else if (type == 397)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
				tileCollide = false;
			}
			else if (type == 398)
			{
				netImportant = true;
				width = 18;
				height = 38;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 399)
			{
				width = 14;
				height = 14;
				aiStyle = 68;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				ranged = true;
				noEnchantmentVisuals = true;
			}
			else if (type >= 400 && type <= 402)
			{
				if (type == 400)
				{
					width = 14;
					height = 16;
				}
				else if (type == 401)
				{
					width = 12;
					height = 14;
				}
				else
				{
					width = 6;
					height = 12;
				}
				penetrate = 3;
				aiStyle = 14;
				friendly = true;
				timeLeft = 360;
				ranged = true;
				noEnchantmentVisuals = true;
			}
			else if (type == 403)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 404)
			{
				width = 26;
				height = 26;
				aiStyle = 69;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				melee = true;
			}
			else if (type == 405)
			{
				width = 14;
				height = 14;
				aiStyle = 70;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				timeLeft = 120;
				melee = true;
				noEnchantments = true;
			}
			else if (type == 406)
			{
				width = 14;
				height = 14;
				aiStyle = 60;
				alpha = 255;
				penetrate = -1;
				extraUpdates = 2;
				ignoreWater = true;
			}
			else if (type == 407)
			{
				netImportant = true;
				width = 28;
				height = 40;
				aiStyle = 62;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				friendly = true;
				minionSlots = 1f;
				tileCollide = false;
				ignoreWater = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 408)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				ignoreWater = true;
			}
			else if (type == 409)
			{
				width = 30;
				height = 30;
				penetrate = -1;
				aiStyle = 71;
				alpha = 255;
				timeLeft = 300;
				friendly = true;
				tileCollide = true;
				extraUpdates = 2;
				magic = true;
				ignoreWater = true;
			}
			else if (type == 410)
			{
				width = 14;
				height = 14;
				aiStyle = 72;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				timeLeft = 100;
				magic = true;
				ignoreWater = true;
			}
			else if (type >= 411 && type <= 414)
			{
				switch (type)
				{
				}
				width = 10;
				height = 10;
				aiStyle = 10;
			}
			else if (type == 415 || type == 416 || type == 417 || type == 418)
			{
				width = 14;
				height = 14;
				aiStyle = 34;
				friendly = true;
				ranged = true;
				timeLeft = 45;
			}
			else if (type >= 419 && type <= 422)
			{
				width = 4;
				height = 4;
				aiStyle = 73;
				friendly = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 3;
			}
			else if (type == 423)
			{
				netImportant = true;
				width = 28;
				height = 28;
				aiStyle = 62;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				friendly = true;
				minionSlots = 1f;
				ignoreWater = true;
			}
			else if (type >= 424 && type <= 426)
			{
				width = 24;
				height = 24;
				aiStyle = 1;
				friendly = true;
				magic = true;
				tileCollide = false;
				extraUpdates = 2;
			}
			else if (type == 427)
			{
				width = 22;
				height = 56;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				glowMask = 2;
			}
			else if (type == 428)
			{
				width = 26;
				height = 54;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				glowMask = 3;
			}
			else if (type == 429)
			{
				width = 18;
				height = 56;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				glowMask = 7;
			}
			else if (type == 430)
			{
				width = 30;
				height = 54;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				glowMask = 8;
			}
			else if (type == 431)
			{
				width = 28;
				height = 64;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 432)
			{
				width = 30;
				height = 54;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 610)
			{
				width = 28;
				height = 64;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				glowMask = 179;
			}
			else if (type == 609)
			{
				width = 30;
				height = 54;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				glowMask = 180;
			}
			else if (type == 433)
			{
				width = 8;
				height = 8;
				aiStyle = 48;
				friendly = true;
				extraUpdates = 100;
				timeLeft = 100;
				ignoreWater = true;
			}
			else if (type == 434)
			{
				width = 1;
				height = 1;
				aiStyle = 74;
				friendly = true;
				extraUpdates = 100;
				penetrate = -1;
			}
			else if (type == 435)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				hostile = true;
				ignoreWater = true;
			}
			else if (type == 436)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				hostile = true;
				ignoreWater = true;
			}
			else if (type == 437)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				hostile = true;
				extraUpdates = 2;
				ignoreWater = true;
			}
			else if (type == 438)
			{
				width = 8;
				height = 8;
				aiStyle = 1;
				hostile = true;
				alpha = 255;
				extraUpdates = 3;
				ignoreWater = true;
			}
			else if (type == 439)
			{
				width = 22;
				height = 22;
				aiStyle = 75;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				magic = true;
				ignoreWater = true;
			}
			else if (type == 440)
			{
				width = 5;
				height = 5;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				extraUpdates = 2;
				scale = 1f;
				timeLeft = 600;
				magic = true;
				ignoreWater = true;
			}
			else if (type == 441)
			{
				width = 1;
				height = 1;
				aiStyle = 76;
				ignoreWater = true;
				tileCollide = false;
			}
			else if (type == 442)
			{
				width = 14;
				height = 14;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				scale = 1f;
				timeLeft = 600;
				ranged = true;
			}
			else if (type == 443)
			{
				width = 80;
				height = 80;
				aiStyle = 77;
				friendly = true;
				alpha = 255;
				scale = 1f;
				ranged = true;
				ignoreWater = true;
				tileCollide = false;
				penetrate = -1;
			}
			else if (type == 444)
			{
				width = 10;
				height = 10;
				aiStyle = 78;
				friendly = true;
				alpha = 255;
				scale = 1f;
				ranged = true;
				ignoreWater = true;
				extraUpdates = 1;
			}
			else if (type == 445)
			{
				width = 10;
				height = 10;
				aiStyle = 75;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				melee = true;
				ignoreWater = true;
				ownerHitCheck = true;
			}
			else if (type == 446)
			{
				netImportant = true;
				width = 14;
				height = 14;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
				light = 0.7f;
			}
			else if (type == 447)
			{
				width = 30;
				height = 30;
				aiStyle = 79;
				hostile = true;
				penetrate = -1;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 240;
			}
			else if (type == 448)
			{
				width = 14;
				height = 14;
				aiStyle = 80;
				hostile = true;
				penetrate = -1;
				tileCollide = false;
			}
			else if (type == 449)
			{
				width = 5;
				height = 5;
				aiStyle = 1;
				hostile = true;
				alpha = 255;
				extraUpdates = 1;
				scale = 1f;
				timeLeft = 600;
				ignoreWater = true;
			}
			else if (type == 450)
			{
				width = 14;
				height = 14;
				aiStyle = 14;
				hostile = true;
				penetrate = -1;
				timeLeft = 360;
			}
			else if (type == 451)
			{
				width = 16;
				height = 16;
				aiStyle = 81;
				melee = true;
				penetrate = 3;
				light = 0.2f;
				alpha = 255;
				friendly = true;
			}
			else if (type == 452)
			{
				width = 14;
				height = 14;
				aiStyle = 82;
				hostile = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 600;
			}
			else if (type == 453)
			{
				width = 1;
				height = 1;
				aiStyle = 76;
				ignoreWater = true;
				tileCollide = false;
			}
			else if (type == 454)
			{
				width = 40;
				height = 40;
				aiStyle = 83;
				hostile = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 600;
				tileCollide = false;
			}
			else if (type == 455)
			{
				width = 36;
				height = 36;
				aiStyle = 84;
				hostile = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 600;
				tileCollide = false;
			}
			else if (type == 456)
			{
				width = 16;
				height = 16;
				aiStyle = 85;
				hostile = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 600;
				tileCollide = false;
			}
			else if (type == 459)
			{
				width = 22;
				height = 22;
				aiStyle = 1;
				friendly = true;
				magic = true;
				alpha = 255;
				scale = 1f;
				ignoreWater = true;
				extraUpdates = 1;
			}
			else if (type == 460)
			{
				width = 14;
				height = 18;
				aiStyle = 75;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				magic = true;
				ignoreWater = true;
			}
			else if (type == 461)
			{
				width = 18;
				height = 18;
				aiStyle = 84;
				friendly = true;
				magic = true;
				penetrate = -1;
				alpha = 255;
				tileCollide = false;
				hide = true;
			}
			else if (type == 462)
			{
				width = 8;
				height = 8;
				aiStyle = 1;
				hostile = true;
				alpha = 255;
				extraUpdates = 3;
				ignoreWater = true;
				tileCollide = false;
			}
			else if (type == 463)
			{
				width = 48;
				height = 48;
				aiStyle = 6;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				alpha = 255;
				ignoreWater = true;
			}
			else if (type == 464)
			{
				width = 60;
				height = 60;
				aiStyle = 86;
				hostile = true;
				tileCollide = false;
				penetrate = -1;
				alpha = 255;
				ignoreWater = true;
			}
			else if (type == 467)
			{
				width = 40;
				height = 40;
				aiStyle = 1;
				hostile = true;
				alpha = 255;
				ignoreWater = true;
				extraUpdates = 1;
			}
			else if (type == 468)
			{
				width = 40;
				height = 40;
				aiStyle = 1;
				hostile = true;
				alpha = 255;
				ignoreWater = true;
				extraUpdates = 1;
			}
			else if (type == 465)
			{
				width = 80;
				height = 80;
				aiStyle = 88;
				hostile = true;
				alpha = 255;
				ignoreWater = true;
				tileCollide = false;
			}
			else if (type == 466)
			{
				width = 14;
				height = 14;
				aiStyle = 88;
				hostile = true;
				alpha = 255;
				ignoreWater = true;
				tileCollide = true;
				extraUpdates = 4;
				timeLeft = 120 * (extraUpdates + 1);
			}
			else if (type == 491)
			{
				width = 26;
				height = 26;
				aiStyle = 9;
				friendly = true;
				melee = true;
				penetrate = -1;
			}
			else if (type == 500)
			{
				width = 20;
				height = 20;
				aiStyle = 67;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				scale = 0.8f;
			}
			else if (type == 499)
			{
				netImportant = true;
				width = 34;
				height = 34;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 469)
			{
				alpha = 255;
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				timeLeft = 1200;
			}
			else if (type == 470)
			{
				width = 10;
				height = 10;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
			}
			else if (type == 471)
			{
				width = 16;
				height = 16;
				aiStyle = 2;
				scale = 1.2f;
				hostile = true;
				ranged = true;
			}
			else if (type == 472)
			{
				width = 8;
				height = 8;
				aiStyle = 0;
				hostile = true;
				penetrate = -1;
				aiStyle = 1;
				tileCollide = true;
				timeLeft = 60;
			}
			else if (type == 474)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				timeLeft = 1200;
				penetrate = 2;
			}
			else if (type == 473)
			{
				netImportant = true;
				width = 8;
				height = 8;
				aiStyle = 14;
				penetrate = -1;
				alpha = 75;
				light = 1f;
				timeLeft *= 2;
			}
			else if (type == 475)
			{
				width = 14;
				height = 14;
				aiStyle = 35;
				penetrate = -1;
				tileCollide = false;
				timeLeft = 400;
			}
			else if (type == 476)
			{
				width = 200;
				height = 200;
				aiStyle = 185;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 3;
				magic = true;
			}
			else if (type == 477)
			{
				alpha = 255;
				width = 14;
				height = 14;
				aiStyle = 1;
				friendly = true;
				penetrate = 7;
				extraUpdates = 1;
				ranged = true;
			}
			else if (type == 478)
			{
				alpha = 255;
				width = 14;
				height = 14;
				aiStyle = 1;
				friendly = true;
				timeLeft = 300;
				ranged = true;
			}
			else if (type == 479)
			{
				alpha = 255;
				width = 14;
				height = 14;
				aiStyle = 1;
				friendly = true;
				ranged = true;
			}
			else if (type == 480)
			{
				alpha = 255;
				width = 12;
				height = 12;
				penetrate = 3;
				aiStyle = 14;
				friendly = true;
				timeLeft = 120;
				ranged = true;
				noEnchantments = true;
			}
			else if (type == 481)
			{
				width = 22;
				height = 22;
				aiStyle = 13;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				melee = true;
				extraUpdates = 0;
			}
			else if (type == 482)
			{
				width = 16;
				height = 200;
				aiStyle = 87;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 18000;
				magic = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 483)
			{
				width = 14;
				height = 14;
				aiStyle = 14;
				friendly = true;
				melee = true;
			}
			else if (type == 484)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				melee = true;
				extraUpdates = 1;
			}
			else if (type == 485)
			{
				arrow = true;
				width = 24;
				height = 24;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				penetrate = -1;
				timeLeft = 1200;
			}
			else if (type >= 486 && type <= 489)
			{
				if (type == 486)
				{
					width = 12;
					height = 12;
				}
				else if (type == 487)
				{
					width = 22;
					height = 22;
				}
				else if (type == 488)
				{
					width = 12;
					height = 12;
					light = 0.3f;
				}
				else if (type == 489)
				{
					width = 20;
					height = 16;
				}
				netImportant = true;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 492)
			{
				netImportant = true;
				width = 18;
				height = 32;
				aiStyle = 90;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 490)
			{
				width = 14;
				height = 14;
				aiStyle = 89;
				hostile = true;
				alpha = 255;
				ignoreWater = true;
				tileCollide = false;
				timeLeft = 600;
				netImportant = true;
			}
			else if (type == 493 || type == 494)
			{
				width = 32;
				height = 32;
				aiStyle = 4;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				alpha = 255;
				ignoreWater = true;
				magic = true;
				light = 0.2f;
			}
			else if (type == 495)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				penetrate = 3;
				timeLeft = 1200;
			}
			else if (type == 496)
			{
				alpha = 255;
				width = 40;
				height = 40;
				aiStyle = 91;
				friendly = true;
				magic = true;
				MaxUpdates = 3;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 497)
			{
				width = 30;
				height = 30;
				aiStyle = 2;
				friendly = true;
				penetrate = 3;
				melee = true;
			}
			else if (type == 498)
			{
				width = 6;
				height = 6;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
				timeLeft = 180;
			}
			else if (type == 501)
			{
				width = 14;
				height = 14;
				aiStyle = 2;
				scale = 1.1f;
				hostile = true;
				ranged = true;
			}
			else if (type == 502)
			{
				width = 16;
				height = 16;
				aiStyle = 8;
				friendly = true;
				melee = true;
				penetrate = 5;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 503)
			{
				width = 24;
				height = 24;
				aiStyle = 5;
				friendly = true;
				penetrate = 2;
				alpha = 255;
				tileCollide = false;
				melee = true;
				extraUpdates = 1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 30;
			}
			else if (type == 504)
			{
				width = 10;
				height = 10;
				aiStyle = 2;
				friendly = true;
				melee = true;
				alpha = 255;
				penetrate = 2;
				noEnchantmentVisuals = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 507)
			{
				width = 16;
				height = 16;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				penetrate = 3;
			}
			else if (type == 508)
			{
				width = 16;
				height = 16;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 509)
			{
				width = 22;
				height = 22;
				aiStyle = 20;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ownerHitCheck = true;
				melee = true;
				scale = 1.2f;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 510)
			{
				width = 18;
				height = 18;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
				magic = true;
			}
			else if (type == 511)
			{
				width = 32;
				height = 32;
				aiStyle = 92;
				friendly = true;
				penetrate = -1;
				scale = 1.1f;
				magic = true;
			}
			else if (type == 512)
			{
				width = 40;
				height = 38;
				aiStyle = 92;
				friendly = true;
				penetrate = -1;
				scale = 1.1f;
				magic = true;
			}
			else if (type == 513)
			{
				width = 30;
				height = 28;
				aiStyle = 92;
				friendly = true;
				penetrate = -1;
				scale = 1.1f;
				magic = true;
			}
			else if (type == 514)
			{
				width = 10;
				height = 10;
				aiStyle = 93;
				friendly = true;
				penetrate = 3;
				alpha = 255;
				ranged = true;
			}
			else if (type == 515)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 14;
				penetrate = -1;
				alpha = 75;
				light = 1f;
				timeLeft *= 5;
			}
			else if (type == 516)
			{
				width = 22;
				height = 22;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
			}
			else if (type == 517)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 518)
			{
				width = 32;
				height = 32;
				aiStyle = 94;
				friendly = true;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 519)
			{
				width = 24;
				height = 24;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
			}
			else if (type == 520)
			{
				width = 22;
				height = 22;
				aiStyle = 2;
				friendly = true;
				penetrate = 3;
				ranged = true;
				coldDamage = true;
			}
			else if (type == 521)
			{
				width = 14;
				height = 14;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 1;
				friendly = true;
			}
			else if (type == 522)
			{
				width = 8;
				height = 8;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 1;
				friendly = true;
			}
			else if (type == 523)
			{
				width = 32;
				height = 32;
				aiStyle = 95;
				alpha = 255;
				ranged = true;
				penetrate = 1;
				friendly = true;
			}
			else if (type == 524)
			{
				width = 10;
				height = 10;
				aiStyle = 96;
				friendly = true;
				alpha = 255;
				penetrate = 5;
				ignoreWater = true;
				melee = true;
				extraUpdates = 5;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 525)
			{
				width = 30;
				height = 24;
				aiStyle = 97;
				tileCollide = false;
				timeLeft = 10800;
				hide = true;
			}
			else if (type == 526)
			{
				width = 8;
				height = 8;
				aiStyle = 98;
				tileCollide = false;
				timeLeft = 120;
				alpha = 255;
			}
			else if (type >= 527 && type <= 531)
			{
				knockBack = 12f;
				width = 24;
				height = 24;
				aiStyle = 17;
				penetrate = -1;
				if (Main.getGoodWorld)
				{
					friendly = true;
					hostile = true;
				}
			}
			else if (type == 532)
			{
				width = 16;
				height = 16;
				aiStyle = 1;
				scale = 1f;
				friendly = true;
				penetrate = 3;
				extraUpdates = 1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 533)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 66;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				tileCollide = false;
				ignoreWater = true;
				friendly = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 12;
			}
			else if (type == 534)
			{
				extraUpdates = 0;
				width = 16;
				height = 16;
				aiStyle = 99;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 1f;
			}
			else if (type >= 541 && type <= 555)
			{
				extraUpdates = 0;
				width = 16;
				height = 16;
				aiStyle = 99;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 1f;
				if (type == 547)
				{
					scale = 1.1f;
				}
				if (type == 554)
				{
					scale = 1.2f;
				}
				if (type == 555)
				{
					scale = 1.15f;
				}
				if (type == 551 || type == 550)
				{
					scale = 1.1f;
				}
			}
			else if (type >= 562 && type <= 564)
			{
				extraUpdates = 0;
				width = 16;
				height = 16;
				aiStyle = 99;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 1f;
				if (type == 563)
				{
					scale = 1.05f;
				}
				if (type == 564)
				{
					scale = 1.075f;
				}
			}
			else if (type == 603)
			{
				extraUpdates = 0;
				width = 16;
				height = 16;
				aiStyle = 99;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 1.15f;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 604)
			{
				extraUpdates = 0;
				width = 14;
				height = 14;
				aiStyle = 115;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 1.2f;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type >= 556 && type <= 561)
			{
				extraUpdates = 0;
				width = 10;
				height = 10;
				aiStyle = 99;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 1f;
				counterweight = true;
			}
			else if (type == 535)
			{
				width = 18;
				height = 18;
				aiStyle = 100;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				magic = true;
				ignoreWater = true;
			}
			else if (type == 536)
			{
				width = 10;
				height = 10;
				aiStyle = 101;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				magic = true;
				ignoreWater = true;
			}
			else if (type == 537)
			{
				width = 22;
				height = 22;
				aiStyle = 84;
				hostile = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 240;
				tileCollide = false;
			}
			else if (type == 538)
			{
				width = 12;
				height = 12;
				aiStyle = 14;
				hostile = true;
				penetrate = -1;
				timeLeft = 120;
				extraUpdates = 1;
				alpha = 255;
			}
			else if (type == 539)
			{
				width = 18;
				height = 30;
				aiStyle = 102;
				hostile = true;
				penetrate = -1;
				timeLeft = 600;
			}
			else if (type == 540)
			{
				width = 20;
				height = 20;
				aiStyle = 103;
				hostile = true;
				penetrate = -1;
				timeLeft = 300;
				alpha = 255;
			}
			else if (type == 565)
			{
				width = 28;
				height = 28;
				aiStyle = 104;
				penetrate = -1;
				tileCollide = false;
				ignoreWater = true;
				alpha = 255;
				scale = 0.8f;
			}
			else if (type == 566)
			{
				width = 16;
				height = 16;
				aiStyle = 36;
				friendly = true;
				penetrate = 4;
				alpha = 255;
				timeLeft = 660;
				extraUpdates = 3;
			}
			else if (type == 567 || type == 568)
			{
				if (type == 567)
				{
					width = 14;
					height = 14;
				}
				else
				{
					width = 16;
					height = 16;
				}
				aiStyle = 105;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				timeLeft = 3600;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type >= 569 && type <= 571)
			{
				width = 32;
				height = 32;
				aiStyle = 106;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 3600;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 575)
			{
				width = 24;
				height = 24;
				aiStyle = 107;
				hostile = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft = 420;
				alpha = 255;
			}
			else if (type == 573)
			{
				width = 18;
				height = 30;
				aiStyle = 102;
				hostile = true;
				penetrate = -1;
				timeLeft = 600;
			}
			else if (type == 574)
			{
				width = 18;
				height = 18;
				aiStyle = 102;
				hostile = true;
				timeLeft = 600;
				tileCollide = false;
			}
			else if (type == 572)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
			}
			else if (type == 576)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.2f;
				timeLeft = 600;
			}
			else if (type == 577)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
				alpha = 255;
				extraUpdates = 2;
				scale = 1.2f;
				timeLeft = 600;
			}
			else if (type == 578 || type == 579 || type == 813)
			{
				width = 32;
				height = 32;
				aiStyle = 108;
				friendly = true;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				hostile = true;
				hide = true;
			}
			else if (type == 580)
			{
				width = 14;
				height = 14;
				aiStyle = 88;
				hostile = true;
				alpha = 255;
				ignoreWater = true;
				tileCollide = true;
				extraUpdates = 4;
				timeLeft = 600;
			}
			else if (type == 581)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
			}
			else if (type == 582)
			{
				width = 20;
				height = 20;
				aiStyle = 109;
				friendly = true;
				penetrate = -1;
				MaxUpdates = 2;
			}
			else if (type == 583)
			{
				width = 10;
				height = 10;
				aiStyle = 2;
				friendly = true;
				scale = 0.8f;
			}
			else if (type == 589)
			{
				width = 10;
				height = 10;
				aiStyle = 2;
				friendly = true;
			}
			else if (type == 584)
			{
				width = 10;
				height = 10;
				aiStyle = 110;
				friendly = true;
				scale = 0.8f;
				penetrate = 3;
			}
			else if (type == 585)
			{
				width = 26;
				height = 26;
				aiStyle = 1;
				alpha = 255;
				friendly = true;
				penetrate = 3;
			}
			else if (type == 586)
			{
				width = 26;
				height = 26;
				aiStyle = 111;
				alpha = 255;
				friendly = true;
				penetrate = -1;
			}
			else if (type == 587)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				friendly = true;
				ranged = true;
			}
			else if (type == 588)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 590)
			{
				width = 14;
				height = 14;
				aiStyle = 112;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				timeLeft = 900;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 591)
			{
				width = 8;
				height = 8;
				aiStyle = 101;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ignoreWater = true;
			}
			else if (type == 592)
			{
				width = 8;
				height = 8;
				aiStyle = 1;
				hostile = true;
				alpha = 255;
				extraUpdates = 3;
				ignoreWater = true;
			}
			else if (type == 593)
			{
				width = 16;
				height = 16;
				aiStyle = 1;
				hostile = true;
				alpha = 255;
				extraUpdates = 1;
				ignoreWater = true;
			}
			else if (type == 594)
			{
				width = 40;
				height = 40;
				aiStyle = 1;
				alpha = 255;
				extraUpdates = 2;
			}
			else if (type == 595)
			{
				width = 68;
				height = 64;
				aiStyle = 75;
				friendly = true;
				tileCollide = false;
				melee = true;
				penetrate = -1;
				ownerHitCheck = true;
			}
			else if (type == 596)
			{
				width = 8;
				height = 8;
				aiStyle = 107;
				hostile = true;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 180;
				tileCollide = false;
			}
			else if (type == 597)
			{
				width = 10;
				height = 10;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 2;
				friendly = true;
			}
			else if (type == 598)
			{
				width = 16;
				height = 16;
				aiStyle = 113;
				friendly = true;
				ranged = true;
				penetrate = -1;
				alpha = 255;
				hide = true;
			}
			else if (type == 599)
			{
				width = 22;
				height = 22;
				aiStyle = 2;
				friendly = true;
				penetrate = 6;
				ranged = true;
			}
			else if (type == 600)
			{
				width = 14;
				height = 14;
				aiStyle = 75;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ignoreWater = true;
			}
			else if (type == 601)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				friendly = true;
				extraUpdates = 30;
			}
			else if (type == 602)
			{
				width = 10;
				height = 10;
				aiStyle = 114;
				alpha = 255;
				friendly = true;
				tileCollide = false;
				netImportant = true;
			}
			else if (type == 605)
			{
				alpha = 255;
				width = 6;
				height = 6;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 606)
			{
				width = 5;
				height = 5;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				extraUpdates = 2;
				scale = 1f;
				timeLeft = 600;
				ignoreWater = true;
			}
			else if (type == 607)
			{
				width = 10;
				height = 10;
				aiStyle = 116;
				friendly = true;
				alpha = 255;
				timeLeft = 600;
				ignoreWater = true;
				tileCollide = false;
				penetrate = -1;
			}
			else if (type == 608)
			{
				width = 160;
				height = 160;
				aiStyle = 117;
				friendly = true;
				alpha = 255;
				timeLeft = 3;
				ignoreWater = true;
				tileCollide = false;
				penetrate = -1;
				hide = true;
			}
			else if (type == 611)
			{
				width = 16;
				height = 16;
				aiStyle = 75;
				friendly = true;
				melee = true;
				penetrate = -1;
				alpha = 255;
				hide = true;
				tileCollide = false;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				noEnchantmentVisuals = true;
			}
			else if (type == 612)
			{
				width = 8;
				height = 8;
				aiStyle = 117;
				friendly = true;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 60;
				tileCollide = false;
				penetrate = -1;
				usesLocalNPCImmunity = true;
			}
			else if (type == 613)
			{
				netImportant = true;
				width = 24;
				height = 24;
				aiStyle = 62;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				friendly = true;
				minionSlots = 1f;
				ignoreWater = true;
			}
			else if (type == 614)
			{
				width = 16;
				height = 16;
				aiStyle = 113;
				friendly = true;
				penetrate = -1;
				alpha = 255;
			}
			else if (type == 615)
			{
				width = 22;
				height = 22;
				aiStyle = 75;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ranged = true;
				ignoreWater = true;
			}
			else if (type == 616)
			{
				width = 14;
				height = 14;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				ranged = true;
				extraUpdates = 2;
				timeLeft = 90 * MaxUpdates;
			}
			else if (type == 617)
			{
				width = 32;
				height = 32;
				aiStyle = 118;
				friendly = true;
				alpha = 255;
				ignoreWater = true;
				hide = true;
				magic = true;
				penetrate = 3;
				usesLocalNPCImmunity = true;
			}
			else if (type == 618)
			{
				tileCollide = false;
				width = 18;
				height = 30;
				aiStyle = 119;
				penetrate = -1;
				timeLeft = 420;
				magic = true;
				friendly = true;
				usesLocalNPCImmunity = true;
			}
			else if (type == 619)
			{
				width = 14;
				height = 14;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 1;
				friendly = true;
			}
			else if (type == 620)
			{
				width = 8;
				height = 8;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				penetrate = 1;
				friendly = true;
			}
			else if (type == 622)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				extraUpdates = 2;
			}
			else if (type == 623)
			{
				netImportant = true;
				width = 50;
				height = 80;
				aiStyle = 120;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				friendly = true;
				minionSlots = 0f;
				ignoreWater = true;
				tileCollide = false;
				netImportant = true;
				manualDirectionChange = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 5;
			}
			else if (type == 624)
			{
				width = 8;
				height = 8;
				aiStyle = 117;
				friendly = true;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 60;
				tileCollide = false;
				penetrate = -1;
			}
			else if (type >= 625 && type <= 628)
			{
				if (type == 625 || type == 628)
				{
					netImportant = true;
				}
				if (type == 626 || type == 627)
				{
					minionSlots = 0.5f;
				}
				width = 24;
				height = 24;
				aiStyle = 121;
				penetrate = -1;
				timeLeft *= 5;
				minion = true;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				alpha = 255;
				hide = true;
				netImportant = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 7;
			}
			else if (type == 629)
			{
				width = 8;
				height = 8;
				aiStyle = 122;
				hostile = true;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 3600;
				tileCollide = false;
				penetrate = -1;
				extraUpdates = 2;
			}
			else if (type == 630 || type == 705)
			{
				width = 22;
				height = 22;
				aiStyle = 75;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ranged = true;
				ignoreWater = true;
			}
			else if (type == 631)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 122;
				friendly = true;
				ranged = true;
				tileCollide = false;
				alpha = 255;
				ignoreWater = true;
				extraUpdates = 1;
				timeLeft = 1200;
			}
			else if (type == 633)
			{
				width = 14;
				height = 18;
				aiStyle = 75;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				magic = true;
				ignoreWater = true;
			}
			else if (type == 632)
			{
				width = 18;
				height = 18;
				aiStyle = 84;
				friendly = true;
				magic = true;
				penetrate = -1;
				alpha = 255;
				tileCollide = false;
			}
			else if (type == 634)
			{
				width = 40;
				height = 40;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				ignoreWater = true;
				extraUpdates = 2;
				magic = true;
			}
			else if (type == 635)
			{
				width = 40;
				height = 40;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				friendly = true;
				extraUpdates = 3;
				magic = true;
			}
			else if (type == 636)
			{
				width = 16;
				height = 16;
				aiStyle = 113;
				friendly = true;
				melee = true;
				penetrate = -1;
				alpha = 255;
				hide = true;
				MaxUpdates = 2;
			}
			else if (type == 637)
			{
				width = 10;
				height = 10;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
			}
			else if (type == 638)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				extraUpdates = 5;
				timeLeft = 600;
				ranged = true;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				penetrate = -1;
			}
			else if (type == 639)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				MaxUpdates = 2;
				timeLeft = MaxUpdates * 45;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				alpha = 255;
				penetrate = 4;
			}
			else if (type == 640)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				MaxUpdates = 3;
				timeLeft = 90;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				alpha = 255;
				penetrate = 4;
			}
			else if (type == 642)
			{
				width = 18;
				height = 18;
				aiStyle = 84;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				tileCollide = false;
				usesLocalNPCImmunity = true;
			}
			else if (type == 641)
			{
				width = 32;
				height = 32;
				aiStyle = 123;
				timeLeft = 36000;
				ignoreWater = true;
				tileCollide = false;
				alpha = 255;
				hide = true;
				sentry = true;
				netImportant = true;
			}
			else if (type == 643)
			{
				width = 32;
				height = 32;
				aiStyle = 123;
				timeLeft = 36000;
				ignoreWater = true;
				tileCollide = false;
				alpha = 255;
				sentry = true;
				netImportant = true;
			}
			else if (type == 644)
			{
				width = 14;
				height = 14;
				aiStyle = 112;
				penetrate = 1;
				timeLeft = 900;
				tileCollide = false;
				ignoreWater = true;
				alpha = 255;
				usesIDStaticNPCImmunity = true;
			}
			else if (type == 645)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				magic = true;
				tileCollide = false;
				extraUpdates = 5;
				penetrate = -1;
				usesLocalNPCImmunity = true;
			}
			else if (type >= 646 && type <= 649)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 650)
			{
				width = 20;
				height = 20;
				aiStyle = 124;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
			}
			else if (type == 651)
			{
				width = 10;
				height = 10;
				aiStyle = 125;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				penetrate = -1;
			}
			else if (type == 652)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 653)
			{
				width = 30;
				height = 30;
				aiStyle = 67;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				scale = 0.8f;
			}
			else if (type == 654)
			{
				width = 30;
				height = 30;
				aiStyle = 126;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 120;
				friendly = true;
				hostile = true;
				penetrate = -1;
				trap = true;
			}
			else if (type == 655)
			{
				width = 31;
				height = 31;
				aiStyle = 25;
				friendly = true;
				hostile = true;
				penetrate = -1;
				trap = true;
			}
			else if (type == 656)
			{
				width = 10;
				height = 10;
				aiStyle = 127;
				friendly = true;
				magic = true;
				tileCollide = false;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				timeLeft = 1200;
			}
			else if (type == 657)
			{
				width = 10;
				height = 10;
				aiStyle = 127;
				hostile = true;
				tileCollide = false;
				penetrate = -1;
				timeLeft = 1200;
			}
			else if (type == 658)
			{
				width = 14;
				height = 14;
				aiStyle = 128;
				penetrate = 1;
				timeLeft = 900;
				tileCollide = false;
				ignoreWater = true;
				alpha = 255;
				hostile = true;
			}
			else if (type == 659)
			{
				width = 8;
				height = 8;
				aiStyle = 129;
				friendly = true;
				magic = true;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 240;
				tileCollide = false;
				penetrate = -1;
			}
			else if (type == 660)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				timeLeft = 600;
				magic = true;
				ignoreWater = true;
			}
			else if (type == 661)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				timeLeft = 40;
				extraUpdates = 1;
				ranged = true;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
			}
			else if (type == 662 || type == 685)
			{
				width = 16;
				height = 16;
				aiStyle = 1;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 663 || type == 665 || type == 667)
			{
				width = 30;
				height = 54;
				aiStyle = 130;
				timeLeft = 36000;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
				switch (type)
				{
				case 665:
					height = 58;
					width = 28;
					break;
				case 667:
					height = 60;
					width = 28;
					break;
				}
				sentry = true;
				netImportant = true;
			}
			else if (type == 664 || type == 666 || type == 668)
			{
				width = 16;
				height = 16;
				aiStyle = 131;
				friendly = true;
				alpha = 255;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
			else if (type == 669)
			{
				width = 14;
				height = 14;
				aiStyle = 68;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				ranged = true;
				noEnchantmentVisuals = true;
			}
			else if (type == 670)
			{
				width = 30;
				height = 30;
				aiStyle = 126;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 120;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 671)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
			}
			else if (type == 672)
			{
				width = 10;
				height = 10;
				aiStyle = 132;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 900;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 674 || type == 673)
			{
				width = 10;
				height = 10;
				aiStyle = 133;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 900;
				hostile = true;
				penetrate = -1;
				hide = true;
			}
			else if (type == 675)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
			}
			else if (type == 676)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
			}
			else if (type == 677 || type == 678 || type == 679)
			{
				width = 26;
				height = 54;
				aiStyle = 134;
				timeLeft = 36000;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
				sentry = true;
				netImportant = true;
			}
			else if (type == 680)
			{
				width = 16;
				height = 16;
				aiStyle = 1;
				friendly = true;
				penetrate = 4;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
			else if (type == 681)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				hostile = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 682)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				hostile = true;
				ignoreWater = true;
				timeLeft = 30;
				scale = 1.2f;
			}
			else if (type == 683)
			{
				width = 30;
				height = 30;
				aiStyle = 135;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 120;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 684)
			{
				width = 16;
				height = 16;
				aiStyle = 1;
				melee = true;
				penetrate = 5;
				alpha = 255;
				friendly = true;
				tileCollide = false;
			}
			else if (type == 686)
			{
				width = 30;
				height = 30;
				aiStyle = 1;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
			}
			else if (type == 687)
			{
				width = 30;
				height = 30;
				aiStyle = 136;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
			}
			else if (type == 688 || type == 689 || type == 690)
			{
				width = 16;
				height = 16;
				aiStyle = 137;
				friendly = true;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				timeLeft = 36000;
				localNPCHitCooldown = 3;
				tileCollide = false;
				penetrate = -1;
				sentry = true;
				netImportant = true;
			}
			else if (type == 691 || type == 692 || type == 693)
			{
				width = 16;
				height = 16;
				aiStyle = 138;
				ignoreWater = true;
				friendly = true;
				timeLeft = 36000;
				tileCollide = false;
				penetrate = -1;
				hide = true;
				sentry = true;
				netImportant = true;
			}
			else if (type == 694 || type == 695 || type == 696)
			{
				aiStyle = 139;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 30;
				alpha = 255;
				width = 144;
				height = 144;
			}
			else if (type == 697)
			{
				width = 16;
				height = 16;
				aiStyle = 140;
				friendly = true;
				melee = true;
				scale = 1.35f;
				penetrate = -1;
				alpha = 255;
				hide = true;
				tileCollide = false;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 12;
				ownerHitCheck = true;
			}
			else if (type == 698)
			{
				width = 50;
				height = 200;
				aiStyle = 141;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 120;
				friendly = true;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				melee = true;
			}
			else if (type == 699)
			{
				width = 24;
				height = 24;
				aiStyle = 142;
				friendly = true;
				melee = true;
				penetrate = -1;
				alpha = 255;
				hide = true;
				tileCollide = false;
				ignoreWater = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
				ownerHitCheck = true;
			}
			else if (type == 700)
			{
				width = 40;
				height = 40;
				aiStyle = 143;
				alpha = 255;
				penetrate = -1;
				friendly = true;
				melee = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				ignoreWater = true;
				tileCollide = false;
			}
			else if (type == 703 || type == 701 || type == 702)
			{
				width = 20;
				height = 20;
				aiStyle = 144;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				scale = 1f;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
			}
			else if (type == 704)
			{
				width = 60;
				height = 210;
				aiStyle = 145;
				friendly = true;
				magic = true;
				tileCollide = false;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				timeLeft = 600;
				localNPCHitCooldown = -1;
				ignoreWater = true;
			}
			else if (type == 706)
			{
				width = 66;
				height = 66;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				timeLeft = 300;
				ranged = true;
				usesLocalNPCImmunity = true;
				penetrate = -1;
				localNPCHitCooldown = 10;
			}
			else if (type == 707)
			{
				width = 16;
				height = 16;
				aiStyle = 140;
				friendly = true;
				melee = true;
				penetrate = -1;
				alpha = 255;
				hide = true;
				tileCollide = false;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 6;
				ownerHitCheck = true;
			}
			else if (type == 708)
			{
				width = 24;
				height = 24;
				aiStyle = 142;
				friendly = true;
				melee = true;
				penetrate = -1;
				alpha = 255;
				hide = true;
				tileCollide = false;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 6;
				ownerHitCheck = true;
			}
			else if (type == 709)
			{
				width = 12;
				height = 12;
				aiStyle = 1;
				friendly = true;
				melee = true;
				alpha = 255;
				ignoreWater = true;
				extraUpdates = 1;
				noEnchantmentVisuals = true;
				scale = 0.6f;
			}
			else if (type == 710)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				ignoreWater = true;
				extraUpdates = 1;
				timeLeft = extraUpdates * 60 * 5;
				usesLocalNPCImmunity = true;
				alpha = 255;
				localNPCHitCooldown = -1;
			}
			else if (type == 711)
			{
				width = 30;
				height = 30;
				aiStyle = 1;
				alpha = 255;
				friendly = true;
				magic = true;
				extraUpdates = 1;
				scale = 0.7f;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
			else if (type == 712)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				alpha = 255;
				timeLeft = 600;
				magic = true;
				extraUpdates = 1;
			}
			else if (type == 713)
			{
				width = 10;
				height = 10;
				aiStyle = 146;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 900;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 714)
			{
				width = 22;
				height = 22;
				aiStyle = 75;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				hide = true;
				ranged = true;
				ignoreWater = true;
			}
			else if (type == 715 || type == 717)
			{
				width = 14;
				height = 14;
				aiStyle = 147;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				ranged = true;
				extraUpdates = 2;
				timeLeft = 360 * MaxUpdates;
			}
			else if (type == 716 || type == 718)
			{
				width = 14;
				height = 14;
				aiStyle = 147;
				friendly = true;
				penetrate = 1;
				alpha = 255;
				ranged = true;
				extraUpdates = 2;
				timeLeft = 360 * MaxUpdates;
			}
			else if (type == 719)
			{
				width = 10;
				height = 10;
				hostile = true;
				penetrate = -1;
				aiStyle = 1;
				tileCollide = true;
			}
			else if (type == 720)
			{
				width = 16;
				height = 16;
				aiStyle = 148;
				tileCollide = false;
				penetrate = -1;
				alpha = 255;
			}
			else if (type == 721 || type == 739 || type == 740 || type == 741 || type == 742 || type == 743 || type == 744 || type == 745 || type == 746 || type == 747 || type == 748 || type == 749 || type == 750 || type == 751 || type == 752)
			{
				netImportant = true;
				width = 7;
				height = 7;
				friendly = true;
				penetrate = -1;
				aiStyle = 149;
				tileCollide = false;
			}
			else if (type == 722)
			{
				width = 2;
				height = 2;
				aiStyle = 150;
				tileCollide = false;
				ignoreWater = true;
				penetrate = -1;
				hide = true;
			}
			else if (type == 723 || type == 724 || type == 725 || type == 726)
			{
				width = 24;
				height = 24;
				aiStyle = 5;
				friendly = true;
				penetrate = 2;
				alpha = 50;
				tileCollide = false;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 728)
			{
				width = 24;
				height = 24;
				aiStyle = 151;
				alpha = 255;
				tileCollide = true;
				ranged = true;
				friendly = true;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
			}
			else if (type == 729)
			{
				width = 20;
				height = 20;
				aiStyle = 152;
				friendly = true;
				tileCollide = false;
				ignoreWater = true;
				ranged = true;
				penetrate = -1;
				scale = 1f + (float)Main.rand.Next(30) * 0.01f;
				extraUpdates = 2;
				timeLeft = 10 * MaxUpdates;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 730)
			{
				width = 18;
				height = 18;
				aiStyle = 19;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 731)
			{
				width = 10;
				height = 10;
				aiStyle = 29;
				alpha = 255;
				magic = true;
				friendly = true;
				extraUpdates = 1;
				timeLeft = 90;
			}
			else if (type == 732)
			{
				tileCollide = true;
				width = 15;
				height = 15;
				aiStyle = 44;
				friendly = true;
				penetrate = 1;
				melee = true;
				noEnchantmentVisuals = true;
			}
			else if (type == 733)
			{
				width = 2;
				height = 2;
				aiStyle = 153;
				tileCollide = false;
				ignoreWater = true;
				penetrate = -1;
				alpha = 255;
			}
			else if (type == 734)
			{
				width = 30;
				height = 24;
				aiStyle = 154;
				tileCollide = false;
				timeLeft = 10800;
				alpha = 255;
				hide = true;
			}
			else if (type == 735)
			{
				width = 68;
				height = 64;
				aiStyle = 75;
				friendly = true;
				tileCollide = false;
				melee = true;
				penetrate = -1;
				ownerHitCheck = true;
			}
			else if (type == 736 || type == 737 || type == 738)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				penetrate = -1;
			}
			else if (type == 753)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 754)
			{
				width = 16;
				height = 16;
				aiStyle = 155;
				tileCollide = false;
				ignoreWater = true;
				penetrate = -1;
				alpha = 255;
			}
			else if (type == 755)
			{
				netImportant = true;
				width = 10;
				height = 10;
				penetrate = -1;
				ignoreWater = true;
				tileCollide = false;
				friendly = true;
				minion = true;
				minionSlots = 1f;
				timeLeft *= 5;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				aiStyle = 156;
			}
			else if (type == 756)
			{
				width = 32;
				height = 32;
				aiStyle = 157;
				friendly = true;
				alpha = 255;
				magic = true;
				tileCollide = false;
				ignoreWater = true;
				penetrate = 4;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 25;
			}
			else if (type == 757)
			{
				netImportant = true;
				width = 34;
				height = 34;
				aiStyle = 15;
				friendly = true;
				penetrate = -1;
				melee = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 758)
			{
				width = 20;
				height = 30;
				aiStyle = 67;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				friendly = true;
				decidesManualFallThrough = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 759)
			{
				netImportant = true;
				width = 10;
				height = 10;
				penetrate = -1;
				ignoreWater = true;
				tileCollide = true;
				friendly = true;
				minion = true;
				minionSlots = 1f;
				timeLeft *= 5;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 15;
				aiStyle = 158;
				hide = true;
			}
			else if (type == 761 || type == 762)
			{
				width = 10;
				height = 10;
				aiStyle = 159;
				friendly = true;
				ranged = true;
				manualDirectionChange = true;
			}
			else if (type == 763)
			{
				width = 10;
				height = 10;
				hostile = true;
				friendly = true;
				penetrate = -1;
				aiStyle = 1;
				tileCollide = true;
				extraUpdates = 1;
			}
			else if (type == 764)
			{
				width = 20;
				height = 20;
				aiStyle = 144;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
			}
			else if (type == 765)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if ((type >= 766 && type <= 770) || type == 771)
			{
				width = 4;
				height = 4;
				aiStyle = 160;
				penetrate = -1;
				extraUpdates = 60;
			}
			else if (type == 772)
			{
				width = 22;
				height = 22;
				friendly = true;
				aiStyle = 1;
				tileCollide = true;
				extraUpdates = 1;
			}
			else if (type == 773)
			{
				width = 22;
				height = 22;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
			}
			else if (type == 774)
			{
				netImportant = true;
				width = 26;
				height = 26;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 802)
			{
				width = 18;
				height = 18;
				aiStyle = 161;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1f;
				ownerHitCheck = true;
				melee = true;
				extraUpdates = 1;
				hide = true;
			}
			else if (type == 811 || type == 814)
			{
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				if (type == 814)
				{
					tileCollide = false;
				}
			}
			else if ((type >= 776 && type <= 801) || (type >= 803 && type <= 810))
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
				if (type == 777 || type == 781 || type == 794 || type == 797 || type == 800 || type == 785 || type == 788 || type == 800)
				{
					usesLocalNPCImmunity = true;
					localNPCHitCooldown = -1;
				}
			}
			else if (type == 812)
			{
				knockBack = 6f;
				width = 10;
				height = 10;
				aiStyle = 10;
				friendly = true;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 815)
			{
				netImportant = true;
				width = 26;
				height = 26;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 816)
			{
				netImportant = true;
				width = 26;
				height = 32;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 817)
			{
				netImportant = true;
				width = 26;
				height = 26;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 819)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				alpha = 255;
				extraUpdates = 1;
				hide = true;
				friendly = true;
				ranged = true;
			}
			else if (type == 818)
			{
				width = 132;
				height = 132;
				aiStyle = 162;
				friendly = true;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				penetrate = -1;
				extraUpdates = 3;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 820)
			{
				width = 12;
				height = 12;
				friendly = true;
				aiStyle = 163;
				tileCollide = true;
				netImportant = true;
				penetrate = -1;
				timeLeft = 86400;
			}
			else if (type == 821)
			{
				netImportant = true;
				width = 20;
				height = 36;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type >= 822 && type <= 824)
			{
				netImportant = true;
				width = 4;
				height = 4;
				aiStyle = 160;
				penetrate = -1;
				extraUpdates = 60;
			}
			else if (type == 825)
			{
				netImportant = true;
				width = 26;
				height = 32;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type >= 826 && type <= 830)
			{
				netImportant = true;
				width = 4;
				height = 4;
				aiStyle = 160;
				penetrate = -1;
				extraUpdates = 60;
			}
			else if (type == 836)
			{
				width = 4;
				height = 4;
				aiStyle = 112;
				hostile = true;
			}
			else if (type == 831)
			{
				netImportant = true;
				width = 10;
				height = 10;
				penetrate = -1;
				ignoreWater = true;
				tileCollide = false;
				friendly = true;
				minion = true;
				minionSlots = 1f;
				timeLeft = 60;
				aiStyle = 164;
				hide = true;
			}
			else if (type == 833)
			{
				width = 26;
				height = 20;
				aiStyle = 67;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				minion = true;
				minionSlots = 0f;
				decidesManualFallThrough = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 834)
			{
				width = 20;
				height = 30;
				aiStyle = 67;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				minion = true;
				minionSlots = 0f;
				decidesManualFallThrough = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 835)
			{
				width = 20;
				height = 30;
				aiStyle = 67;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				minion = true;
				minionSlots = 0f;
				decidesManualFallThrough = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 837)
			{
				width = 26;
				height = 26;
				aiStyle = 1;
				alpha = 255;
				friendly = true;
				magic = true;
				penetrate = 3;
			}
			else if (type >= 838 && type <= 840)
			{
				netImportant = true;
				width = 4;
				height = 4;
				aiStyle = 160;
				penetrate = -1;
				extraUpdates = 60;
			}
			else if (type == 841)
			{
				DefaultToWhip();
			}
			else if (type == 842)
			{
				width = 18;
				height = 18;
				aiStyle = 161;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1f;
				ownerHitCheck = true;
				melee = true;
				extraUpdates = 1;
				hide = true;
			}
			else if (type >= 843 && type <= 846)
			{
				netImportant = true;
				width = 4;
				height = 4;
				aiStyle = 160;
				penetrate = -1;
				extraUpdates = 60;
			}
			else if (type == 847)
			{
				DefaultToWhip();
				extraUpdates = 2;
			}
			else if (type == 848)
			{
				DefaultToWhip();
			}
			else if (type == 849)
			{
				DefaultToWhip();
				extraUpdates = 2;
			}
			else if (type == 850)
			{
				netImportant = true;
				width = 4;
				height = 4;
				aiStyle = 160;
				penetrate = -1;
				extraUpdates = 60;
			}
			else if (type == 851)
			{
				netImportant = true;
				width = 4;
				height = 4;
				aiStyle = 166;
				penetrate = -1;
				timeLeft = 300;
			}
			else if (type >= 852 && type <= 853)
			{
				netImportant = true;
				width = 4;
				height = 4;
				aiStyle = 160;
				penetrate = -1;
				extraUpdates = 60;
			}
			else if (type == 854)
			{
				netImportant = true;
				width = 26;
				height = 32;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 855)
			{
				netImportant = true;
				width = 12;
				height = 12;
				aiStyle = 166;
				penetrate = -1;
				timeLeft = 1000;
			}
			else if (type == 856)
			{
				width = 32;
				height = 32;
				aiStyle = 167;
				friendly = true;
				alpha = 255;
				magic = true;
				tileCollide = false;
				ignoreWater = true;
				extraUpdates = 2;
				usesLocalNPCImmunity = true;
			}
			else if (type == 857)
			{
				width = 32;
				height = 32;
				aiStyle = 168;
				friendly = true;
				alpha = 255;
				melee = true;
				tileCollide = false;
				ignoreWater = true;
				extraUpdates = 1;
				usesLocalNPCImmunity = true;
				manualDirectionChange = true;
				penetrate = -1;
				hide = true;
			}
			else if (type == 858)
			{
				netImportant = true;
				width = 26;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 859)
			{
				netImportant = true;
				width = 20;
				height = 32;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 860)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 861)
			{
				netImportant = true;
				width = 10;
				height = 10;
				aiStyle = 2;
				friendly = true;
			}
			else if (type == 862 || type == 863)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 864)
			{
				netImportant = true;
				width = 10;
				height = 10;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				ignoreWater = true;
				tileCollide = false;
				friendly = true;
				minion = true;
				minionSlots = 1f;
				timeLeft = 60;
				aiStyle = 169;
				localNPCHitCooldown = 40;
			}
			else if (type == 865)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
			}
			else if (type == 866)
			{
				light = 0.15f;
				width = 30;
				height = 30;
				aiStyle = 3;
				friendly = true;
				penetrate = 5;
				melee = true;
				extraUpdates = 1;
				usesLocalNPCImmunity = true;
			}
			else if (type == 867)
			{
				width = 22;
				height = 22;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
				light = 0.6f;
			}
			else if (type == 868 || type == 869)
			{
				width = 18;
				height = 18;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
			}
			else if (type == 870)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 14;
				penetrate = -1;
				alpha = 75;
				light = 1f;
				timeLeft *= 5;
			}
			else if (type == 873)
			{
				width = 30;
				height = 30;
				aiStyle = 171;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				timeLeft = 200;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 874)
			{
				width = 30;
				height = 30;
				aiStyle = 0;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				timeLeft = 210;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 871)
			{
				width = 30;
				height = 30;
				aiStyle = 172;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				timeLeft = 240;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 875)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 872)
			{
				width = 30;
				height = 30;
				aiStyle = 173;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				timeLeft = 660;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 876)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 8;
				light = 0.75f;
				alpha = 255;
				extraUpdates = 3;
				scale = 1.4f;
				timeLeft = 3600;
				magic = true;
			}
			else if (type >= 877 && type <= 879)
			{
				netImportant = true;
				width = 25;
				height = 25;
				aiStyle = 19;
				alpha = 255;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1f;
				hide = true;
				ownerHitCheck = true;
				melee = true;
			}
			else if (type == 880)
			{
				width = 32;
				height = 32;
				aiStyle = 183;
				penetrate = -1;
				timeLeft = 18;
				ignoreWater = true;
				tileCollide = false;
				friendly = true;
				hostile = false;
				manualDirectionChange = true;
			}
			else if (type == 881)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 882)
			{
				width = 20;
				height = 20;
				aiStyle = 124;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
			}
			else if (type == 883)
			{
				width = 20;
				height = 20;
				aiStyle = 174;
				penetrate = -1;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				netImportant = true;
			}
			else if (type >= 884 && type <= 886)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 887)
			{
				width = 20;
				height = 20;
				aiStyle = 174;
				penetrate = -1;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				netImportant = true;
			}
			else if (type == 888)
			{
				width = 20;
				height = 20;
				aiStyle = 124;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
			}
			else if (type >= 889 && type <= 892)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 893)
			{
				width = 20;
				height = 20;
				aiStyle = 174;
				penetrate = -1;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				netImportant = true;
			}
			else if (type == 894)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type >= 895 && type <= 896)
			{
				width = 20;
				height = 20;
				aiStyle = 124;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
			}
			else if (type == 897)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 898)
			{
				width = 20;
				height = 20;
				aiStyle = 124;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
			}
			else if (type >= 899 && type <= 901)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 902)
			{
				width = 20;
				height = 20;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
				MaxUpdates = 2;
			}
			else if (type >= 903 && type <= 906)
			{
				width = 22;
				height = 22;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
			}
			else if (type == 907)
			{
				width = 22;
				height = 22;
				aiStyle = 30;
				friendly = true;
				penetrate = 2;
				melee = true;
			}
			else if (type == 908)
			{
				tileCollide = false;
				ignoreWater = true;
				width = 14;
				height = 14;
				aiStyle = 175;
				friendly = true;
				penetrate = 1;
				timeLeft = 3600;
				hide = true;
			}
			else if (type == 909)
			{
				width = 12;
				height = 12;
				aiStyle = 2;
				friendly = false;
				hostile = true;
				penetrate = 1;
			}
			else if (type == 910)
			{
				width = 22;
				height = 22;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
			}
			else if (type == 911)
			{
				width = 22;
				height = 22;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
			}
			else if (type >= 912 && type <= 915)
			{
				DefaultToWhip();
				if (type == 915)
				{
					extraUpdates = 2;
				}
				if (type == 912)
				{
					coldDamage = true;
				}
			}
			else if (type == 916)
			{
				width = 18;
				height = 18;
				aiStyle = 176;
				friendly = true;
				tileCollide = false;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				extraUpdates = 2;
			}
			else if (type == 918)
			{
				aiStyle = 178;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				alpha = 255;
				width = 96;
				height = 96;
			}
			else if (type == 917)
			{
				width = 30;
				height = 30;
				aiStyle = 177;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				coldDamage = true;
				localNPCHitCooldown = 20;
			}
			else if (type == 919)
			{
				width = 8;
				height = 8;
				aiStyle = 179;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				timeLeft = 240;
				tileCollide = false;
				ignoreWater = true;
			}
			else if (type == 920)
			{
				alpha = 255;
				width = 6;
				height = 6;
				aiStyle = 1;
				hostile = true;
				penetrate = 1;
			}
			else if (type == 921)
			{
				alpha = 255;
				width = 6;
				height = 6;
				aiStyle = 1;
				hostile = true;
				penetrate = 3;
			}
			else if (type == 922)
			{
				width = 30;
				height = 30;
				aiStyle = 135;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 120;
				hostile = true;
				penetrate = -1;
			}
			else if (type == 923)
			{
				width = 30;
				height = 30;
				aiStyle = 180;
				alpha = 255;
				penetrate = -1;
				friendly = false;
				hostile = true;
				timeLeft = 180;
				tileCollide = false;
				ignoreWater = true;
				hide = true;
			}
			else if (type == 926)
			{
				alpha = 255;
				width = 12;
				height = 12;
				scale = 1f;
				aiStyle = 1;
				hostile = true;
				penetrate = 2;
			}
			else if (type == 927)
			{
				width = 40;
				height = 40;
				aiStyle = 75;
				friendly = true;
				tileCollide = false;
				melee = true;
				penetrate = -1;
				ownerHitCheck = true;
			}
			else if (type == 928)
			{
				netImportant = true;
				width = 34;
				height = 34;
				aiStyle = 14;
				friendly = true;
				penetrate = 2;
				melee = true;
				timeLeft = 250;
			}
			else if (type == 929)
			{
				width = 32;
				height = 32;
				aiStyle = 183;
				penetrate = -1;
				timeLeft = 18;
				ignoreWater = true;
				tileCollide = false;
				friendly = true;
				hostile = false;
				manualDirectionChange = true;
			}
			else if (type == 930)
			{
				width = 14;
				height = 14;
				aiStyle = 16;
				friendly = true;
				penetrate = -1;
				ranged = true;
			}
			else if (type == 931)
			{
				width = 30;
				height = 30;
				aiStyle = 171;
				alpha = 255;
				penetrate = 3;
				friendly = true;
				timeLeft = 240;
				magic = true;
				tileCollide = true;
				ignoreWater = true;
				extraUpdates = 1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 60;
			}
			else if (type == 932)
			{
				ranged = true;
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 181;
				penetrate = 5;
				friendly = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				timeLeft = 120;
				alpha = 0;
				ignoreWater = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 60;
			}
			else if (type == 933)
			{
				width = 32;
				height = 32;
				aiStyle = 182;
				friendly = true;
				melee = true;
				tileCollide = false;
				ignoreWater = true;
				alpha = 255;
				extraUpdates = 1;
				usesLocalNPCImmunity = true;
				manualDirectionChange = true;
				localNPCHitCooldown = 15;
				penetrate = -1;
				noEnchantmentVisuals = true;
			}
			else if (type == 934)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 935)
			{
				netImportant = true;
				width = 18;
				height = 18;
				aiStyle = 7;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				timeLeft *= 10;
				extraUpdates = 3;
			}
			else if (type == 936)
			{
				width = 14;
				height = 14;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
				Opacity = 0.6f;
			}
			else if (type == 937)
			{
				alpha = 255;
				width = 10;
				height = 10;
				aiStyle = 1;
				hostile = false;
				friendly = true;
				penetrate = 3;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type >= 938 && type <= 945)
			{
				width = 18;
				height = 18;
				aiStyle = 161;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				scale = 1f;
				ownerHitCheck = true;
				melee = true;
				extraUpdates = 1;
				timeLeft = 360;
				hide = true;
			}
			else if (type == 946)
			{
				netImportant = true;
				width = 10;
				height = 10;
				penetrate = -1;
				ignoreWater = true;
				tileCollide = false;
				friendly = true;
				minion = true;
				minionSlots = 1f;
				timeLeft *= 5;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				aiStyle = 156;
				scale = 0.75f;
				manualDirectionChange = true;
				hide = true;
			}
			else if (type == 947 || type == 948)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 15;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 1f;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 10;
			}
			else if (type == 949)
			{
				width = 4;
				height = 4;
				aiStyle = 184;
				penetrate = -1;
				hostile = true;
				tileCollide = false;
			}
			else if (type == 950)
			{
				width = 104;
				height = 104;
				aiStyle = 186;
				friendly = true;
				magic = true;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 180;
				tileCollide = false;
				penetrate = -1;
			}
			else if (type == 951)
			{
				width = 26;
				height = 26;
				aiStyle = 67;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				minion = true;
				minionSlots = 1f;
				friendly = true;
				decidesManualFallThrough = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 10;
			}
			else if (type == 952)
			{
				DefaultToWhip();
			}
			else if (type == 953)
			{
				width = 8;
				height = 8;
				aiStyle = 117;
				friendly = true;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 60;
				tileCollide = false;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 80;
			}
			else if (type == 954)
			{
				width = 10;
				height = 10;
				aiStyle = 2;
				friendly = true;
				magic = true;
				alpha = 255;
				penetrate = 2;
				noEnchantmentVisuals = true;
			}
			else if (type == 955)
			{
				width = 18;
				height = 18;
				aiStyle = 5;
				friendly = true;
				penetrate = -1;
				alpha = 50;
				light = 1f;
				ranged = true;
			}
			else if (type == 956)
			{
				netImportant = true;
				width = 20;
				height = 28;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 957)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 124;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
				ignoreWater = true;
				tileCollide = false;
				manualDirectionChange = true;
			}
			else if (type == 958)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 959)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 960)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
				hide = true;
			}
			else if (type == 961)
			{
				width = 32;
				height = 32;
				aiStyle = 157;
				hostile = true;
				alpha = 255;
				tileCollide = false;
				ignoreWater = true;
				coldDamage = true;
			}
			else if (type == 962)
			{
				width = 32;
				height = 32;
				aiStyle = 1;
				hostile = true;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 220;
				coldDamage = true;
			}
			else if (type == 963)
			{
				netImportant = true;
				width = 30;
				height = 48;
				penetrate = -1;
				ignoreWater = true;
				tileCollide = false;
				friendly = true;
				minion = true;
				minionSlots = 0f;
				timeLeft *= 5;
				aiStyle = 62;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = 20;
			}
			else if (type == 965)
			{
				width = 40;
				height = 40;
				aiStyle = 187;
				hostile = true;
				tileCollide = false;
				ignoreWater = true;
				timeLeft = 300;
				alpha = 255;
			}
			else if (type == 964)
			{
				width = 40;
				height = 40;
				aiStyle = 187;
				alpha = 255;
				penetrate = 3;
				friendly = true;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				ignoreWater = true;
				tileCollide = false;
				extraUpdates = 1;
				scale = 0.7f;
			}
			else if (type == 966)
			{
				width = 18;
				height = 60;
				aiStyle = 53;
				timeLeft = 36000;
				ignoreWater = true;
				sentry = true;
				netImportant = true;
			}
			else if (type == 967)
			{
				width = 14;
				height = 14;
				aiStyle = 28;
				friendly = true;
			}
			else if (type == 968)
			{
				width = 14;
				height = 14;
				aiStyle = 2;
				friendly = true;
				ranged = true;
				alpha = 255;
			}
			else if (type == 969)
			{
				width = 56;
				height = 64;
				aiStyle = 177;
				friendly = true;
				magic = true;
				tileCollide = true;
				penetrate = 15;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 25;
			}
			else if (type == 970)
			{
				netImportant = true;
				width = 10;
				height = 10;
				penetrate = -1;
				ignoreWater = true;
				tileCollide = false;
				friendly = true;
				minion = true;
				minionSlots = 1f;
				timeLeft = 60;
				aiStyle = 164;
				hide = true;
			}
			else if (type == 971)
			{
				width = 16;
				height = 16;
				aiStyle = 113;
				friendly = true;
				melee = true;
				penetrate = -1;
				alpha = 255;
				hide = true;
			}
			else if (type == 977)
			{
				width = 20;
				height = 20;
				aiStyle = 152;
				friendly = true;
				tileCollide = false;
				ignoreWater = true;
				melee = true;
				penetrate = 1;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				scale = 1f + (float)Main.rand.Next(30) * 0.01f;
				extraUpdates = 2;
				timeLeft = 10 * MaxUpdates;
			}
			else if (type == 979)
			{
				width = 10;
				height = 10;
				aiStyle = 2;
				friendly = true;
				magic = true;
				alpha = 255;
				penetrate = 2;
				noEnchantmentVisuals = true;
				coldDamage = true;
			}
			else if (type == 974)
			{
				width = 20;
				height = 20;
				aiStyle = 188;
				friendly = true;
				tileCollide = false;
				ignoreWater = true;
				melee = true;
				penetrate = 2;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				timeLeft = 30;
				stopsDealingDamageAfterPenetrateHits = true;
			}
			else if (type == 978)
			{
				width = 160;
				height = 160;
				aiStyle = 189;
				friendly = true;
				alpha = 255;
				ignoreWater = true;
				timeLeft = 60;
				tileCollide = false;
				ownerHitCheck = true;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				melee = true;
				timeLeft = 30;
			}
			else if (type == 976)
			{
				width = 20;
				height = 20;
				aiStyle = 152;
				friendly = true;
				tileCollide = false;
				ignoreWater = true;
				melee = true;
				penetrate = 2;
				usesLocalNPCImmunity = true;
				localNPCHitCooldown = -1;
				scale = 1f + (float)Main.rand.Next(30) * 0.01f;
				extraUpdates = 0;
				timeLeft = 60 * MaxUpdates;
			}
			else if (type == 975)
			{
				width = 16;
				height = 16;
				aiStyle = 113;
				friendly = true;
				melee = true;
				penetrate = -1;
				alpha = 0;
				hide = true;
			}
			else if (type == 972)
			{
				width = 16;
				height = 16;
				aiStyle = 190;
				friendly = true;
				melee = true;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				tileCollide = false;
				ignoreWater = true;
				localNPCHitCooldown = -1;
				ownerHitCheck = true;
				ownerHitCheckDistance = 300f;
				usesOwnerMeleeHitCD = true;
				stopsDealingDamageAfterPenetrateHits = true;
			}
			else if (type == 973)
			{
				width = 30;
				height = 30;
				aiStyle = 191;
				friendly = true;
				melee = true;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				tileCollide = false;
				ignoreWater = true;
				localNPCHitCooldown = 10;
				alpha = 255;
				timeLeft = 90;
			}
			else if (type == 980)
			{
				width = 6;
				height = 6;
				aiStyle = 1;
				friendly = true;
				hostile = true;
				penetrate = -1;
				trap = true;
			}
			else if (type == 981)
			{
				width = 4;
				height = 4;
				aiStyle = 1;
				friendly = true;
				penetrate = 1;
				light = 0.5f;
				alpha = 255;
				scale = 1.2f;
				timeLeft = 600;
				ranged = true;
				extraUpdates = 1;
			}
			else if (type == 982)
			{
				width = 16;
				height = 16;
				aiStyle = 190;
				friendly = true;
				melee = true;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				tileCollide = false;
				ignoreWater = true;
				localNPCHitCooldown = -1;
				ownerHitCheck = true;
				ownerHitCheckDistance = 300f;
				usesOwnerMeleeHitCD = true;
				stopsDealingDamageAfterPenetrateHits = true;
			}
			else if (type == 983)
			{
				width = 16;
				height = 16;
				aiStyle = 190;
				friendly = true;
				melee = true;
				penetrate = 6;
				usesLocalNPCImmunity = true;
				tileCollide = false;
				ignoreWater = true;
				localNPCHitCooldown = -1;
				ownerHitCheck = true;
				ownerHitCheckDistance = 300f;
				usesOwnerMeleeHitCD = true;
				stopsDealingDamageAfterPenetrateHits = true;
			}
			else if (type == 984)
			{
				width = 16;
				height = 16;
				aiStyle = 190;
				friendly = true;
				melee = true;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				tileCollide = false;
				ignoreWater = true;
				localNPCHitCooldown = -1;
				ownerHitCheck = true;
				ownerHitCheckDistance = 300f;
				usesOwnerMeleeHitCD = true;
				stopsDealingDamageAfterPenetrateHits = true;
			}
			else if (type == 985)
			{
				width = 8;
				height = 8;
				aiStyle = 191;
				friendly = true;
				melee = true;
				penetrate = -1;
				usesLocalNPCImmunity = true;
				tileCollide = true;
				ignoreWater = true;
				localNPCHitCooldown = -1;
				alpha = 255;
				timeLeft = 90;
				ownerHitCheck = true;
				ownerHitCheckDistance = 300f;
			}
			else if (type >= 986 && type <= 993)
			{
				width = 14;
				height = 14;
				aiStyle = 61;
				penetrate = -1;
				netImportant = true;
				bobber = true;
				if (type >= 987 && type <= 993)
				{
					glowMask = (short)(318 + (type - 987));
					light = 1f;
				}
			}
			else if (type == 994)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 995)
			{
				netImportant = true;
				width = 240;
				height = 104;
				aiStyle = 192;
				friendly = true;
				penetrate = -1;
				tileCollide = false;
				ignoreWater = true;
				timeLeft *= 5;
			}
			else if (type == 996)
			{
				width = 18;
				height = 18;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
			}
			else if (type == 997)
			{
				width = 16;
				height = 16;
				aiStyle = 190;
				friendly = true;
				melee = true;
				penetrate = 3;
				usesLocalNPCImmunity = true;
				tileCollide = false;
				ignoreWater = true;
				localNPCHitCooldown = -1;
				ownerHitCheck = true;
				ownerHitCheckDistance = 300f;
				usesOwnerMeleeHitCD = true;
				stopsDealingDamageAfterPenetrateHits = true;
			}
			else if (type == 999)
			{
				extraUpdates = 0;
				width = 16;
				height = 16;
				aiStyle = 99;
				friendly = true;
				penetrate = -1;
				melee = true;
				scale = 1f;
			}
			else if (type == 1000)
			{
				width = 22;
				height = 22;
				aiStyle = 3;
				friendly = true;
				penetrate = -1;
				melee = true;
				light = 0.6f;
			}
			else if (type == 998)
			{
				netImportant = true;
				width = 20;
				height = 20;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 1001)
			{
				width = 26;
				height = 26;
				aiStyle = 194;
				hostile = true;
				tileCollide = false;
				ignoreWater = true;
				scale = 1f + (float)Main.rand.Next(51) * 0.01f;
				timeLeft = 360;
				alpha = 255;
			}
			else if (type == 1002)
			{
				width = 260;
				height = 260;
				aiStyle = 16;
				friendly = true;
				hostile = true;
				penetrate = -1;
				tileCollide = false;
				alpha = 255;
				timeLeft = 2;
				trap = true;
				usesIDStaticNPCImmunity = true;
				idStaticNPCHitCooldown = 15;
			}
			else if (type == 1003)
			{
				netImportant = true;
				width = 26;
				height = 26;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 1004)
			{
				netImportant = true;
				width = 26;
				height = 26;
				aiStyle = 26;
				friendly = true;
				penetrate = -1;
				timeLeft *= 5;
			}
			else if (type == 1007)
			{
				width = 50;
				height = 50;
				aiStyle = 92;
				hostile = true;
				friendly = true;
				penetrate = -1;
				scale = 1.1f;
				trap = true;
				hide = true;
			}
			else if (type == 1006)
			{
				arrow = true;
				width = 10;
				height = 10;
				aiStyle = 1;
				friendly = true;
				ranged = true;
				timeLeft = 1200;
			}
			else if (type == 1008)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 33;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 36000;
			}
			else if (type == 1009)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 33;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 36000;
			}
			else if (type == 1010)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 33;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 36000;
			}
			else if (type == 1011)
			{
				netImportant = true;
				width = 6;
				height = 6;
				aiStyle = 33;
				friendly = true;
				penetrate = -1;
				alpha = 255;
				timeLeft = 36000;
			}
			else if (type == 1012)
			{
				width = 18;
				height = 18;
				aiStyle = 2;
				friendly = true;
				penetrate = 1;
			}
			else if (type == 1015 || type == 1016 || type == 1017)
			{
				DefaultToSpray();
			}
			else if (type == 1018)
			{
				width = 16;
				height = 16;
				aiStyle = 67;
				penetrate = -1;
				netImportant = true;
				timeLeft *= 5;
				friendly = true;
				ignoreWater = true;
			}
			else if (type == 1019)
			{
				width = 64;
				height = 64;
				aiStyle = 6;
				friendly = true;
				tileCollide = false;
				penetrate = -1;
				alpha = 255;
				ignoreWater = true;
			}
			else if (type == 1020)
			{
				width = 12;
				height = 12;
				aiStyle = 195;
				friendly = true;
				penetrate = -1;
			}
			else
			{
				active = false;
			}
			width = (int)((float)width * scale);
			height = (int)((float)height * scale);
			maxPenetrate = penetrate;
		}

		public void DefaultToSpray()
		{
			width = 6;
			height = 6;
			aiStyle = 31;
			friendly = true;
			alpha = 255;
			penetrate = -1;
			extraUpdates = 2;
			tileCollide = false;
			ignoreWater = true;
		}

		public void DefaultToWhip()
		{
			width = 18;
			height = 18;
			aiStyle = 165;
			friendly = true;
			penetrate = -1;
			tileCollide = false;
			scale = 1f;
			ownerHitCheck = true;
			extraUpdates = 1;
			usesLocalNPCImmunity = true;
			localNPCHitCooldown = -1;
		}

		public static int GetNextSlot()
		{
			int result = 1000;
			for (int i = 0; i < 1000; i++)
			{
				if (!Main.projectile[i].active)
				{
					result = i;
					break;
				}
			}
			return result;
		}

		public static int NewProjectile(IEntitySource spawnSource, Vector2 position, Vector2 velocity, int Type, int Damage, float KnockBack, int Owner = -1, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f)
		{
			return NewProjectile(spawnSource, position.X, position.Y, velocity.X, velocity.Y, Type, Damage, KnockBack, Owner, ai0, ai1, ai2);
		}

		public static int FindOldestProjectile()
		{
			int result = 1000;
			int num = 9999999;
			for (int i = 0; i < 1000; i++)
			{
				if (!Main.projectile[i].netImportant && Main.projectile[i].timeLeft < num)
				{
					result = i;
					num = Main.projectile[i].timeLeft;
				}
			}
			return result;
		}

		public static int NewProjectile(IEntitySource spawnSource, float X, float Y, float SpeedX, float SpeedY, int Type, int Damage, float KnockBack, int Owner = -1, float ai0 = 0f, float ai1 = 0f, float ai2 = 0f)
		{
			if (Owner == -1)
			{
				Owner = Main.myPlayer;
			}
			int num = 1000;
			for (int i = 0; i < 1000; i++)
			{
				if (!Main.projectile[i].active)
				{
					num = i;
					break;
				}
			}
			if (num == 1000)
			{
				num = FindOldestProjectile();
			}
			Projectile projectile = Main.projectile[num];
			projectile.SetDefaults(Type);
			projectile.position.X = X - (float)projectile.width * 0.5f;
			projectile.position.Y = Y - (float)projectile.height * 0.5f;
			projectile.owner = Owner;
			projectile.velocity.X = SpeedX;
			projectile.velocity.Y = SpeedY;
			projectile.damage = Damage;
			projectile.knockBack = KnockBack;
			projectile.identity = num;
			projectile.gfxOffY = 0f;
			projectile.stepSpeed = 1f;
			projectile.wet = Collision.WetCollision(projectile.position, projectile.width, projectile.height);
			if (projectile.ignoreWater)
			{
				projectile.wet = false;
			}
			projectile.honeyWet = Collision.honey;
			projectile.shimmerWet = Collision.shimmer;
			Main.projectileIdentity[Owner, num] = num;
			FindBannerToAssociateTo(spawnSource, projectile);
			if (projectile.aiStyle == 1)
			{
				while (projectile.velocity.X >= 16f || projectile.velocity.X <= -16f || projectile.velocity.Y >= 16f || projectile.velocity.Y < -16f)
				{
					projectile.velocity.X *= 0.97f;
					projectile.velocity.Y *= 0.97f;
				}
			}
			if (Owner == Main.myPlayer)
			{
				switch (Type)
				{
				case 206:
					projectile.ai[0] = (float)Main.rand.Next(-100, 101) * 0.0005f;
					projectile.ai[1] = (float)Main.rand.Next(-100, 101) * 0.0005f;
					break;
				case 335:
					projectile.ai[1] = Main.rand.Next(4);
					break;
				case 358:
					projectile.ai[1] = (float)Main.rand.Next(10, 31) * 0.1f;
					break;
				case 406:
					projectile.ai[1] = (float)Main.rand.Next(10, 21) * 0.1f;
					break;
				default:
					projectile.ai[0] = ai0;
					projectile.ai[1] = ai1;
					projectile.ai[2] = ai2;
					break;
				}
			}
			if (Type == 434)
			{
				projectile.ai[0] = projectile.position.X;
				projectile.ai[1] = projectile.position.Y;
			}
			if (Type > 0 && Type < 1022)
			{
				if (ProjectileID.Sets.NeedsUUID[Type])
				{
					projectile.projUUID = projectile.identity;
				}
				if (ProjectileID.Sets.StardustDragon[Type])
				{
					int num2 = Main.projectile[(int)projectile.ai[0]].projUUID;
					if (num2 >= 0)
					{
						projectile.ai[0] = num2;
					}
				}
			}
			if (Main.netMode != 0 && Owner == Main.myPlayer)
			{
				NetMessage.SendData(27, -1, -1, null, num);
			}
			if (Owner == Main.myPlayer)
			{
				if (ProjectileID.Sets.IsAGolfBall[Type] && Damage <= 0)
				{
					int num3 = 0;
					int num4 = 0;
					int num5 = 99999999;
					for (int j = 0; j < 1000; j++)
					{
						if (Main.projectile[j].active && ProjectileID.Sets.IsAGolfBall[Main.projectile[j].type] && Main.projectile[j].owner == Owner && Main.projectile[j].damage <= 0)
						{
							num3++;
							if (num5 > Main.projectile[j].timeLeft)
							{
								num4 = j;
								num5 = Main.projectile[j].timeLeft;
							}
						}
					}
					if (num3 > 10)
					{
						Main.projectile[num4].Kill();
					}
				}
				if (Type == 28)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 516)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 519)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 29)
				{
					projectile.timeLeft = 300;
				}
				if (Type == 470)
				{
					projectile.timeLeft = 300;
				}
				if (Type == 637)
				{
					projectile.timeLeft = 300;
				}
				if (Type == 30)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 517)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 37)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 773)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 75)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 133)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 136)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 139)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 142)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 397)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 419)
				{
					projectile.timeLeft = 600;
				}
				if (Type == 420)
				{
					projectile.timeLeft = 600;
				}
				if (Type == 421)
				{
					projectile.timeLeft = 600;
				}
				if (Type == 422)
				{
					projectile.timeLeft = 600;
				}
				if (Type == 588)
				{
					projectile.timeLeft = 180;
				}
				if (Type == 779)
				{
					projectile.timeLeft = 60;
				}
				if (Type == 783)
				{
					projectile.timeLeft = 60;
				}
				if (Type == 862 || Type == 863)
				{
					projectile.timeLeft = 60;
				}
				if (Type == 443)
				{
					projectile.timeLeft = 300;
				}
				if (Type == 681)
				{
					projectile.timeLeft = 600;
				}
				if (Type == 684)
				{
					projectile.timeLeft = 60;
				}
				if (Type == 706)
				{
					projectile.timeLeft = 120;
				}
				if (Type == 680 && Main.player[projectile.owner].setSquireT2)
				{
					projectile.penetrate = 7;
				}
				if (Type == 777 || Type == 781 || Type == 794 || Type == 797 || Type == 800 || Type == 785 || Type == 788 || Type == 791 || Type == 903 || Type == 904 || Type == 905 || Type == 906 || Type == 910 || Type == 911)
				{
					projectile.timeLeft = 180;
				}
			}
			if (Type == 249)
			{
				projectile.frame = Main.rand.Next(5);
			}
			if (Owner == Main.myPlayer)
			{
				Main.player[Owner].TryUpdateChannel(projectile);
			}
			return num;
		}

		private static void FindBannerToAssociateTo(IEntitySource spawnSource, Projectile next)
		{
			if (spawnSource is EntitySource_Parent entitySource_Parent)
			{
				if (entitySource_Parent.Entity is Projectile projectile)
				{
					next.bannerIdToRespondTo = projectile.bannerIdToRespondTo;
				}
				else if (entitySource_Parent.Entity is NPC nPC)
				{
					next.bannerIdToRespondTo = Item.NPCtoBanner(nPC.BannerID());
				}
			}
		}

		public static Color GetGolfTrailColor(Projectile proj)
		{
			return proj.type switch
			{
				739 => new Color(50, 50, 50, 80), 
				740 => new Color(30, 50, 255, 40), 
				741 => new Color(150, 90, 60, 90), 
				742 => new Color(30, 255, 170, 30), 
				743 => new Color(30, 255, 30, 40), 
				744 => new Color(190, 255, 30, 50), 
				745 => new Color(255, 130, 30, 50), 
				746 => new Color(255, 50, 110, 50), 
				747 => new Color(130, 10, 200, 40), 
				748 => new Color(255, 30, 50, 50), 
				749 => new Color(100, 180, 255, 30), 
				750 => new Color(50, 240, 160, 30), 
				751 => new Color(220, 80, 220, 70), 
				752 => new Color(255, 180, 50, 30), 
				_ => new Color(160, 160, 255, 50), 
			};
		}

		public void StatusNPC(int i)
		{
			NPC nPC = Main.npc[i];
			if ((melee || ProjectileID.Sets.IsAWhip[type]) && Main.player[owner].meleeEnchant > 0 && !noEnchantments)
			{
				byte meleeEnchant = Main.player[owner].meleeEnchant;
				if (meleeEnchant == 1)
				{
					nPC.AddBuff(70, 60 * Main.rand.Next(5, 10));
				}
				if (meleeEnchant == 2)
				{
					nPC.AddBuff(39, 60 * Main.rand.Next(3, 7));
				}
				if (meleeEnchant == 3)
				{
					nPC.AddBuff(24, 60 * Main.rand.Next(3, 7));
				}
				if (meleeEnchant == 5)
				{
					nPC.AddBuff(69, 60 * Main.rand.Next(10, 20));
				}
				if (meleeEnchant == 6)
				{
					nPC.AddBuff(31, 60 * Main.rand.Next(1, 4));
				}
				if (meleeEnchant == 8)
				{
					nPC.AddBuff(20, 60 * Main.rand.Next(5, 10));
				}
				if (meleeEnchant == 4)
				{
					nPC.AddBuff(72, 120);
				}
			}
			if (type == 195)
			{
				nPC.AddBuff(70, 60 * Main.rand.Next(5, 11));
			}
			if (type == 119)
			{
				nPC.AddBuff(324, 240);
			}
			if (type == 309)
			{
				nPC.AddBuff(324, 300);
			}
			if (type == 359)
			{
				nPC.AddBuff(324, 420);
			}
			switch (type)
			{
			case 841:
				nPC.AddBuff(307, 240);
				break;
			case 952:
				nPC.AddBuff(326, 240);
				break;
			case 847:
				nPC.AddBuff(309, 240);
				break;
			case 849:
				nPC.AddBuff(310, 240);
				break;
			case 913:
				if (localAI[0] == 0f)
				{
					nPC.AddBuff(313, 240);
				}
				nPC.AddBuff(323, 240);
				break;
			case 912:
				nPC.AddBuff(340, 240);
				nPC.AddBuff(324, 240);
				break;
			case 914:
				nPC.AddBuff(20, 240);
				nPC.AddBuff(315, 240);
				break;
			case 848:
				nPC.AddBuff(319, 240);
				break;
			case 915:
				nPC.AddBuff(316, 240);
				break;
			}
			if (type == 664 && Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(24, 60 * Main.rand.Next(3, 6));
			}
			if (type == 666 && Main.rand.Next(2) == 0)
			{
				nPC.AddBuff(323, 60 * Main.rand.Next(3, 9));
			}
			if (type == 668 && Main.rand.Next(3) != 0)
			{
				nPC.AddBuff(323, 60 * Main.rand.Next(6, 9));
			}
			if (type == 567 || type == 568)
			{
				nPC.AddBuff(20, 60 * Main.rand.Next(5, 11));
			}
			if (type == 598 && ai[1] == (float)i)
			{
				nPC.AddBuff(169, 900);
			}
			if (type == 636 && ai[1] == (float)i)
			{
				nPC.AddBuff(189, 300);
			}
			if (type == 971 && ai[1] == (float)i)
			{
				nPC.AddBuff(337, 540);
			}
			if (type == 975 && ai[1] == (float)i)
			{
				nPC.AddBuff(344, 540);
			}
			if (type == 611)
			{
				nPC.AddBuff(189, 300);
			}
			if (type == 612)
			{
				nPC.AddBuff(189, 300);
			}
			if (type == 978)
			{
				nPC.AddBuff(24, 180);
			}
			if (type == 953)
			{
				nPC.AddBuff(189, 300);
			}
			if (type == 711)
			{
				nPC.AddBuff(203, 600);
			}
			if (type == 706)
			{
				nPC.AddBuff(323, 480);
			}
			if (type == 614 && ai[1] == (float)i)
			{
				nPC.AddBuff(183, 900);
			}
			if (type == 585)
			{
				nPC.AddBuff(153, 60 * Main.rand.Next(5, 11));
			}
			if (type == 583)
			{
				nPC.AddBuff(20, 60 * Main.rand.Next(3, 6));
			}
			if (type == 524)
			{
				nPC.AddBuff(69, 60 * Main.rand.Next(3, 8));
			}
			if (type == 954 && Main.rand.Next(2) == 0)
			{
				int num = 24;
				if (Main.remixWorld)
				{
					num = 323;
				}
				if (Main.rand.Next(3) == 0)
				{
					nPC.AddBuff(num, Main.rand.Next(60, 240));
				}
				else
				{
					nPC.AddBuff(num, Main.rand.Next(60, 120));
				}
			}
			if (type == 504 && Main.rand.Next(2) == 0)
			{
				if (Main.rand.Next(3) == 0)
				{
					nPC.AddBuff(323, Main.rand.Next(60, 240));
				}
				else
				{
					nPC.AddBuff(323, Main.rand.Next(60, 120));
				}
			}
			if (type == 979 && Main.rand.Next(2) == 0)
			{
				int num2 = 44;
				if (Main.remixWorld)
				{
					num2 = 324;
				}
				if (Main.rand.Next(3) == 0)
				{
					nPC.AddBuff(num2, Main.rand.Next(60, 240));
				}
				else
				{
					nPC.AddBuff(num2, Main.rand.Next(60, 120));
				}
			}
			if ((type == 694 || type == 695 || type == 696) && Main.player[owner].setHuntressT2)
			{
				nPC.AddBuff(204, Main.rand.Next(8, 18) * 30);
			}
			if (type == 545 && Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(24, Main.rand.Next(60, 240));
			}
			if (type == 553)
			{
				nPC.AddBuff(323, Main.rand.Next(180, 480));
			}
			if (type == 552 && Main.rand.Next(3) != 0)
			{
				nPC.AddBuff(324, Main.rand.Next(120, 320));
			}
			if (type == 495)
			{
				nPC.AddBuff(153, Main.rand.Next(120, 300));
			}
			if (type == 497)
			{
				nPC.AddBuff(153, Main.rand.Next(60, 180));
			}
			if (type == 496)
			{
				nPC.AddBuff(153, Main.rand.Next(240, 480));
			}
			if (type == 46)
			{
				nPC.AddBuff(153, Main.rand.Next(240, 300));
			}
			if (type == 476)
			{
				nPC.AddBuff(151, 30);
			}
			if (type == 523)
			{
				nPC.AddBuff(20, 60 * Main.rand.Next(10, 30));
			}
			if (type == 478 || type == 480)
			{
				nPC.AddBuff(39, 60 * Main.rand.Next(3, 7));
			}
			if (type == 479)
			{
				nPC.AddBuff(69, 60 * Main.rand.Next(7, 15));
			}
			if (type == 379)
			{
				nPC.AddBuff(70, 60 * Main.rand.Next(2, 5));
			}
			if (type >= 390 && type <= 392)
			{
				nPC.AddBuff(70, 60 * Main.rand.Next(2, 5));
			}
			if (type == 374)
			{
				nPC.AddBuff(20, 60 * Main.rand.Next(4, 7));
			}
			if (type == 376)
			{
				nPC.AddBuff(24, 60 * Main.rand.Next(3, 7));
			}
			if (type >= 399 && type <= 402)
			{
				nPC.AddBuff(24, 60 * Main.rand.Next(3, 7));
			}
			if (type == 295 || type == 296)
			{
				nPC.AddBuff(323, 60 * Main.rand.Next(8, 16));
			}
			if ((melee || ranged) && !npcProj && Main.player[owner].frostBurn && !noEnchantments)
			{
				nPC.AddBuff(324, 60 * Main.rand.Next(5, 15));
			}
			if (melee && Main.player[owner].magmaStone && !noEnchantments)
			{
				if (Main.rand.Next(7) == 0)
				{
					nPC.AddBuff(323, 360);
				}
				else if (Main.rand.Next(3) == 0)
				{
					nPC.AddBuff(323, 120);
				}
				else
				{
					nPC.AddBuff(323, 60);
				}
			}
			if (type == 287)
			{
				nPC.AddBuff(72, 120);
			}
			if (type == 285)
			{
				if (Main.rand.Next(3) == 0)
				{
					nPC.AddBuff(31, 180);
				}
				else
				{
					nPC.AddBuff(31, 60);
				}
			}
			if (type == 2 && Main.rand.Next(3) == 0)
			{
				nPC.AddBuff(24, 180);
			}
			if (type == 172)
			{
				if (Main.rand.Next(3) == 0)
				{
					nPC.AddBuff(44, 180);
				}
			}
			else if (type == 15)
			{
				int num3 = 24;
				if (Main.remixWorld)
				{
					num3 = 323;
				}
				if (Main.rand.Next(2) == 0)
				{
					nPC.AddBuff(num3, 300);
				}
			}
			else if (type == 253)
			{
				nPC.AddBuff(324, 480);
			}
			else if (type == 19)
			{
				if (Main.rand.Next(2) == 0)
				{
					nPC.AddBuff(24, 360);
				}
			}
			else if (type == 113)
			{
				if (Main.rand.Next(2) == 0)
				{
					nPC.AddBuff(44, 180);
				}
			}
			else if (type == 33)
			{
				if (Main.rand.Next(2) == 0)
				{
					nPC.AddBuff(20, 420);
				}
			}
			else if (type == 34)
			{
				if (Main.rand.Next(2) == 0)
				{
					nPC.AddBuff(24, Main.rand.Next(240, 480));
				}
			}
			else if (type == 948)
			{
				if (Main.rand.Next(6) == 0)
				{
					nPC.AddBuff(24, 60 * Main.rand.Next(2, 4));
				}
			}
			else if (type == 35)
			{
				if (Main.rand.Next(2) == 0)
				{
					nPC.AddBuff(24, 300);
				}
			}
			else if (type == 54)
			{
				if (Main.rand.Next(2) == 0)
				{
					nPC.AddBuff(20, 600);
				}
			}
			else if (type == 267)
			{
				if (Main.rand.Next(3) == 0)
				{
					nPC.AddBuff(20, 3600);
				}
				else
				{
					nPC.AddBuff(20, 1800);
				}
			}
			else if (type == 63)
			{
				if (Main.rand.Next(5) != 0)
				{
					nPC.AddBuff(31, 60 * Main.rand.Next(2, 5));
				}
			}
			else if (type == 85)
			{
				int num4 = ((ai[0] == 1f) ? 324 : 323);
				nPC.AddBuff(num4, 1200);
			}
			else if (type == 188)
			{
				nPC.AddBuff(323, 1200);
			}
			else if (type == 95 || type == 103 || type == 104 || type == 482)
			{
				nPC.AddBuff(39, 420);
			}
			else if (type == 278 || type == 279 || type == 280)
			{
				nPC.AddBuff(69, 600);
			}
			else if (type == 282 || type == 283)
			{
				nPC.AddBuff(70, 600);
			}
			if (type == 163 || type == 310 || type == 1008 || type == 1010 || type == 1011)
			{
				if (Main.rand.Next(3) == 0)
				{
					nPC.AddBuff(24, 600);
				}
				else
				{
					nPC.AddBuff(24, 300);
				}
			}
			if (type == 1009)
			{
				nPC.AddBuff(39, 600);
			}
			else if (type == 98)
			{
				nPC.AddBuff(20, 600);
			}
			else if (type == 184)
			{
				nPC.AddBuff(20, 900);
			}
			else if (type == 980)
			{
				nPC.AddBuff(70, 300);
			}
			else if (type == 265)
			{
				nPC.AddBuff(20, 1800);
			}
			else if (type == 355)
			{
				nPC.AddBuff(70, 1800);
			}
		}

		public void StatusPvP(int i)
		{
			if ((melee || ProjectileID.Sets.IsAWhip[type]) && Main.player[owner].meleeEnchant > 0 && !noEnchantments)
			{
				byte meleeEnchant = Main.player[owner].meleeEnchant;
				if (meleeEnchant == 1)
				{
					Main.player[i].AddBuff(70, 60 * Main.rand.Next(5, 10), quiet: false);
				}
				if (meleeEnchant == 2)
				{
					Main.player[i].AddBuff(39, 60 * Main.rand.Next(3, 7), quiet: false);
				}
				if (meleeEnchant == 3)
				{
					Main.player[i].AddBuff(24, 60 * Main.rand.Next(3, 7), quiet: false);
				}
				if (meleeEnchant == 5)
				{
					Main.player[i].AddBuff(69, 60 * Main.rand.Next(10, 20), quiet: false);
				}
				if (meleeEnchant == 6)
				{
					Main.player[i].AddBuff(31, 60 * Main.rand.Next(1, 4), quiet: false);
				}
				if (meleeEnchant == 8)
				{
					Main.player[i].AddBuff(20, 60 * Main.rand.Next(5, 10), quiet: false);
				}
			}
			if (type == 978)
			{
				Main.player[i].AddBuff(24, 180);
			}
			if (type == 295 || type == 296)
			{
				Main.player[i].AddBuff(323, 60 * Main.rand.Next(8, 16), quiet: false);
			}
			if (type >= 399 && type <= 402)
			{
				Main.player[i].AddBuff(24, 60 * Main.rand.Next(3, 7), quiet: false);
			}
			if (type == 478 || type == 480)
			{
				Main.player[i].AddBuff(39, 60 * Main.rand.Next(3, 7), quiet: false);
			}
			if ((melee || ranged) && Main.player[owner].frostBurn && !noEnchantments)
			{
				Main.player[i].AddBuff(324, 60 * Main.rand.Next(1, 8), quiet: false);
			}
			if (melee && Main.player[owner].magmaStone && !noEnchantments)
			{
				if (Main.rand.Next(4) == 0)
				{
					Main.player[i].AddBuff(24, 360, quiet: false);
				}
				else if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(24, 240, quiet: false);
				}
				else
				{
					Main.player[i].AddBuff(24, 120, quiet: false);
				}
			}
			if (type == 2 && Main.rand.Next(3) == 0)
			{
				Main.player[i].AddBuff(24, 180, quiet: false);
			}
			if (type == 172)
			{
				if (Main.rand.Next(3) == 0)
				{
					Main.player[i].AddBuff(44, 240, quiet: false);
				}
			}
			else if (type == 15)
			{
				int num = 24;
				if (Main.remixWorld)
				{
					num = 323;
				}
				if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(num, 300, quiet: false);
				}
			}
			else if (type == 253)
			{
				if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(44, 480, quiet: false);
				}
			}
			else if (type == 19)
			{
				if (Main.rand.Next(5) == 0)
				{
					Main.player[i].AddBuff(24, 180, quiet: false);
				}
			}
			else if (type == 113)
			{
				if (Main.rand.Next(5) == 0)
				{
					Main.player[i].AddBuff(44, 180, quiet: false);
				}
			}
			else if (type == 33)
			{
				if (Main.rand.Next(5) == 0)
				{
					Main.player[i].AddBuff(20, 420, quiet: false);
				}
			}
			else if (type == 34)
			{
				if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(24, 240, quiet: false);
				}
			}
			else if (type == 35)
			{
				if (Main.rand.Next(4) == 0)
				{
					Main.player[i].AddBuff(24, 180, quiet: false);
				}
			}
			else if (type == 54)
			{
				if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(20, 600, quiet: false);
				}
			}
			else if (type == 267)
			{
				if (Main.rand.Next(3) == 0)
				{
					Main.player[i].AddBuff(20, 3600, quiet: false);
				}
				else
				{
					Main.player[i].AddBuff(20, 1800, quiet: false);
				}
			}
			else if (type == 63)
			{
				if (Main.rand.Next(3) != 0)
				{
					Main.player[i].AddBuff(31, 120, quiet: false);
				}
			}
			else if (type == 85 || type == 188)
			{
				Main.player[i].AddBuff(24, 1200, quiet: false);
			}
			else if (type == 95 || type == 103 || type == 104 || type == 482)
			{
				Main.player[i].AddBuff(39, 420, quiet: false);
			}
			else if (type == 278 || type == 279 || type == 280)
			{
				Main.player[i].AddBuff(69, 900, quiet: false);
			}
			else if (type == 282 || type == 283)
			{
				Main.player[i].AddBuff(70, 600, quiet: false);
			}
			if (type == 163 || type == 310 || type == 1008 || type == 1010 || type == 1011)
			{
				if (Main.rand.Next(3) == 0)
				{
					Main.player[i].AddBuff(24, 600, quiet: false);
				}
				else
				{
					Main.player[i].AddBuff(24, 300, quiet: false);
				}
			}
			if (type == 1009)
			{
				Main.player[i].AddBuff(39, 300, quiet: false);
			}
			else if (type == 265)
			{
				Main.player[i].AddBuff(20, 1200, quiet: false);
			}
			else if (type == 355)
			{
				Main.player[i].AddBuff(70, 1800, quiet: false);
			}
		}

		public void ghostHurt(int dmg, Vector2 Position, Entity victim)
		{
			if (!magic || damage <= 0)
			{
				return;
			}
			int num = damage;
			if (dmg <= 1)
			{
				return;
			}
			int num2 = -1;
			int num3 = 1500;
			if (Main.player[Main.myPlayer].ghostDmg > (float)num3)
			{
				return;
			}
			Main.player[Main.myPlayer].ghostDmg += num;
			int[] array = new int[200];
			int num4 = 0;
			_ = new int[200];
			int num5 = 0;
			for (int i = 0; i < 200; i++)
			{
				if (!Main.npc[i].CanBeChasedBy(this))
				{
					continue;
				}
				float num6 = Math.Abs(Main.npc[i].position.X + (float)(Main.npc[i].width / 2) - position.X + (float)(width / 2)) + Math.Abs(Main.npc[i].position.Y + (float)(Main.npc[i].height / 2) - position.Y + (float)(height / 2));
				if (num6 < 800f)
				{
					if (Collision.CanHit(position, 1, 1, Main.npc[i].position, Main.npc[i].width, Main.npc[i].height) && num6 > 50f)
					{
						array[num5] = i;
						num5++;
					}
					else if (num5 == 0)
					{
						array[num4] = i;
						num4++;
					}
				}
			}
			if (num4 != 0 || num5 != 0)
			{
				num2 = ((num5 <= 0) ? array[Main.rand.Next(num4)] : array[Main.rand.Next(num5)]);
				float num7 = Main.rand.Next(-100, 101);
				float num8 = Main.rand.Next(-100, 101);
				float num9 = (float)Math.Sqrt(num7 * num7 + num8 * num8);
				num9 = 4f / num9;
				num7 *= num9;
				num8 *= num9;
				NewProjectile(GetProjectileSource_OnHit(victim, 16), Position.X, Position.Y, num7, num8, 356, num, 0f, owner, num2);
			}
		}

		public void ghostHeal(int dmg, Vector2 Position, Entity victim)
		{
			float num = 0.2f;
			num -= (float)numHits * 0.05f;
			if (num <= 0f)
			{
				return;
			}
			float num2 = (float)dmg * num;
			if ((int)num2 <= 0 || Main.player[Main.myPlayer].lifeSteal <= 0f)
			{
				return;
			}
			Main.player[Main.myPlayer].lifeSteal -= num2;
			if (!magic)
			{
				return;
			}
			float num3 = 0f;
			int num4 = owner;
			for (int i = 0; i < 255; i++)
			{
				if (Main.player[i].active && !Main.player[i].dead && ((!Main.player[owner].hostile && !Main.player[i].hostile) || Main.player[owner].team == Main.player[i].team) && Distance(Main.player[i].Center) <= 3000f)
				{
					int num5 = Main.player[i].statLifeMax2 - Main.player[i].statLife;
					if ((float)num5 > num3)
					{
						num3 = num5;
						num4 = i;
					}
				}
			}
			NewProjectile(GetProjectileSource_OnHit(victim, 15), Position.X, Position.Y, 0f, 0f, 298, 0, 0f, owner, num4, num2);
		}

		public void vampireHeal(int dmg, Vector2 Position, Entity victim)
		{
			float num = (float)dmg * 0.075f;
			if ((int)num != 0 && !(Main.player[Main.myPlayer].lifeSteal <= 0f))
			{
				Main.player[Main.myPlayer].lifeSteal -= num;
				int num2 = owner;
				NewProjectile(GetProjectileSource_OnHit(victim, 18), Position.X, Position.Y, 0f, 0f, 305, 0, 0f, owner, num2, num);
			}
		}

		public void StatusPlayer(int i)
		{
			if (Main.player[i].creativeGodMode)
			{
				return;
			}
			if (type == 119)
			{
				Main.player[i].AddBuff(324, 240);
			}
			if (type == 359)
			{
				Main.player[i].AddBuff(324, 420);
			}
			if (type == 472)
			{
				Main.player[i].AddBuff(149, Main.rand.Next(30, 150));
			}
			if (type == 961)
			{
				Main.player[i].AddBuff(47, 20);
			}
			if (type == 467)
			{
				Main.player[i].AddBuff(24, Main.rand.Next(30, 150));
			}
			if (type == 581)
			{
				if (Main.expertMode)
				{
					Main.player[i].AddBuff(164, Main.rand.Next(300, 540));
				}
				else if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(164, Main.rand.Next(360, 720));
				}
			}
			if (type == 687)
			{
				Main.player[i].AddBuff(24, 60 * Main.rand.Next(7, 11));
			}
			if (type == 258 && Main.rand.Next(2) == 0)
			{
				Main.player[i].AddBuff(24, 60 * Main.rand.Next(5, 8));
			}
			if (type == 572 && Main.rand.Next(3) != 0)
			{
				Main.player[i].AddBuff(20, Main.rand.Next(120, 240));
			}
			if (type == 276)
			{
				if (Main.expertMode)
				{
					Main.player[i].AddBuff(20, Main.rand.Next(120, 540));
				}
				else if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(20, Main.rand.Next(180, 420));
				}
			}
			if (type == 436 && Main.rand.Next(5) >= 2)
			{
				Main.player[i].AddBuff(31, 300);
			}
			if (type == 435 && Main.rand.Next(3) != 0)
			{
				Main.player[i].AddBuff(144, 300);
			}
			if (type == 682)
			{
				Main.player[i].AddBuff(196, 300);
			}
			if (type == 437)
			{
				Main.player[i].AddBuff(144, 60 * Main.rand.Next(4, 9));
			}
			if (type == 348)
			{
				if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(46, 600);
				}
				else
				{
					Main.player[i].AddBuff(46, 300);
				}
				if (Main.rand.Next(3) != 0)
				{
					if (Main.rand.Next(16) == 0)
					{
						Main.player[i].AddBuff(47, 60);
					}
					else if (Main.rand.Next(12) == 0)
					{
						Main.player[i].AddBuff(47, 40);
					}
					else if (Main.rand.Next(8) == 0)
					{
						Main.player[i].AddBuff(47, 20);
					}
				}
			}
			if (type == 349)
			{
				if (Main.rand.Next(3) == 0)
				{
					Main.player[i].AddBuff(46, 600);
				}
				else if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(46, 300);
				}
			}
			if (type >= 399 && type <= 402 && !hostile)
			{
				Main.player[i].AddBuff(24, 60 * Main.rand.Next(3, 7));
			}
			if (type == 55 || type == 719)
			{
				if (Main.rand.Next(3) == 0)
				{
					Main.player[i].AddBuff(20, 600);
				}
				else if (Main.expertMode)
				{
					Main.player[i].AddBuff(20, Main.rand.Next(60, 300));
				}
			}
			if (type == 44 && Main.rand.Next(3) == 0)
			{
				Main.player[i].AddBuff(22, 900);
			}
			if (type == 293)
			{
				Main.player[i].AddBuff(80, 60 * Main.rand.Next(2, 7));
			}
			if (type == 299)
			{
				Main.player[i].AddBuff(23, 240);
			}
			if (type == 82 && Main.rand.Next(3) == 0)
			{
				Main.player[i].AddBuff(24, 420);
			}
			if (type == 285 && !hostile)
			{
				if (Main.rand.Next(3) == 0)
				{
					Main.player[i].AddBuff(31, 180);
				}
				else
				{
					Main.player[i].AddBuff(31, 60);
				}
			}
			if (type == 96 || type == 101)
			{
				if (Main.rand.Next(6) == 0)
				{
					Main.player[i].AddBuff(39, 180);
				}
				else if (Main.rand.Next(4) == 0)
				{
					Main.player[i].AddBuff(39, 180);
				}
				else if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(39, 120);
				}
			}
			else if (type == 288)
			{
				Main.player[i].AddBuff(69, 900);
			}
			else if (type == 253 && !hostile)
			{
				Main.player[i].AddBuff(324, 600);
			}
			if (type == 291 || type == 292)
			{
				Main.player[i].AddBuff(24, 60 * Main.rand.Next(8, 16));
			}
			if (type == 98)
			{
				Main.player[i].AddBuff(20, 600);
			}
			if (type == 184)
			{
				Main.player[i].AddBuff(20, 900);
			}
			if (type == 980)
			{
				Main.player[i].AddBuff(70, 300);
			}
			if (type == 290)
			{
				Main.player[i].AddBuff(32, 60 * Main.rand.Next(5, 16));
			}
			if (type == 174)
			{
				Main.player[i].AddBuff(46, 1200);
				if (!Main.player[i].frozen && Main.rand.Next(20) == 0)
				{
					Main.player[i].AddBuff(47, 90);
				}
				else if (!Main.player[i].frozen && Main.expertMode && Main.rand.Next(20) == 0)
				{
					Main.player[i].AddBuff(47, 60);
				}
			}
			if (type == 257)
			{
				Main.player[i].AddBuff(46, 2700);
				if (!Main.player[i].frozen && Main.rand.Next(5) == 0)
				{
					Main.player[i].AddBuff(47, 60);
				}
			}
			if (type == 177)
			{
				Main.player[i].AddBuff(46, 1500);
				if (!Main.player[i].frozen && Main.rand.Next(10) == 0)
				{
					Main.player[i].AddBuff(47, Main.rand.Next(30, 120));
				}
			}
			if (type == 128 && Main.rand.Next(3) == 0)
			{
				Main.player[i].AddBuff(44, 360);
			}
			if (type == 176)
			{
				if (Main.rand.Next(4) == 0)
				{
					Main.player[i].AddBuff(20, 1200);
				}
				else if (Main.rand.Next(2) == 0)
				{
					Main.player[i].AddBuff(20, 300);
				}
			}
		}

		public bool CanHitWithMeleeWeapon(Entity ent)
		{
			if (Distance(ent.Center) > ownerHitCheckDistance)
			{
				return false;
			}
			if (!Collision.CanHit(Main.player[owner].position, Main.player[owner].width, Main.player[owner].height, ent.position, ent.width, ent.height) && !Collision.CanHitLine(Main.player[owner].Center + new Vector2(Main.player[owner].direction * Main.player[owner].width / 2, Main.player[owner].gravDir * (float)(-Main.player[owner].height) / 3f), 0, 0, ent.Center + new Vector2(0f, -ent.height / 3), 0, 0) && !Collision.CanHitLine(Main.player[owner].Center + new Vector2(Main.player[owner].direction * Main.player[owner].width / 2, Main.player[owner].gravDir * (float)(-Main.player[owner].height) / 3f), 0, 0, ent.Center, 0, 0))
			{
				return Collision.CanHitLine(Main.player[owner].Center + new Vector2(Main.player[owner].direction * Main.player[owner].width / 2, 0f), 0, 0, ent.Center + new Vector2(0f, ent.height / 3), 0, 0);
			}
			return true;
		}

		public bool CanHitWithOwnBody(Entity ent)
		{
			if (Distance(ent.Center) > ownerHitCheckDistance)
			{
				return false;
			}
			bool flag = Collision.CanHit(base.position, width, height, ent.position, ent.width, ent.height) || Collision.CanHitLine(base.Center + new Vector2(direction * width / 2, -height / 3), 0, 0, ent.Center + new Vector2(0f, -ent.height / 3), 0, 0) || Collision.CanHitLine(base.Center + new Vector2(direction * width / 2, -height / 3), 0, 0, ent.Center, 0, 0) || Collision.CanHitLine(base.Center + new Vector2(direction * width / 2, 0f), 0, 0, ent.Center + new Vector2(0f, ent.height / 3), 0, 0);
			float num = ProjectileID.Sets.ExtendedCanHitCheckRange[type];
			if (num != 0f)
			{
				if (flag)
				{
					return flag;
				}
				GenSearch genSearch = ProjectileID.Sets.ExtendedCanHitCheckSearch[type];
				Vector2 position = base.Top + new Vector2(0f, 0f - num);
				Vector2 position2 = ent.Top + new Vector2(0f, 0f - num);
				if (genSearch != null)
				{
					if (WorldUtils.Find(base.Top.ToTileCoordinates(), Searches.Chain(genSearch, _cachedConditions_notNull, _cachedConditions_solid), out var result))
					{
						position = result.ToWorldCoordinates();
					}
					if (WorldUtils.Find(ent.Top.ToTileCoordinates(), Searches.Chain(genSearch, _cachedConditions_notNull, _cachedConditions_solid), out result))
					{
						position2 = result.ToWorldCoordinates();
					}
				}
				flag |= Collision.CanHitLine(position, 0, 0, position2, 0, 0);
			}
			return flag;
		}

		public void Damage()
		{
			if (type == 18 || type == 72 || type == 86 || type == 87 || aiStyle == 31 || aiStyle == 32 || type == 226 || type == 378 || type == 613 || type == 650 || type == 882 || type == 888 || type == 895 || type == 896 || (type == 434 && localAI[0] != 0f) || type == 439 || type == 444 || (type == 451 && ((int)(ai[0] - 1f) / penetrate == 0 || ai[1] < 5f) && ai[0] != 0f) || type == 500 || type == 653 || type == 1018 || type == 460 || type == 633 || type == 600 || type == 601 || type == 602 || type == 535 || (type == 631 && localAI[1] == 0f) || (type == 537 && localAI[0] <= 30f) || type == 651 || (type == 188 && localAI[0] < 5f) || (aiStyle == 137 && ai[0] != 0f) || aiStyle == 138 || (type == 261 && velocity.Length() < 1.5f) || (type == 818 && ai[0] < 1f) || type == 831 || type == 970 || (type == 833 && ai[0] == 4f) || (type == 834 && ai[0] == 4f) || (type == 835 && ai[0] == 4f) || (type == 281 && ai[0] == -3f) || ((type == 598 || type == 636 || type == 614 || type == 971 || type == 975) && ai[0] == 1f) || (type == 923 && localAI[0] <= 60f) || (type == 919 && localAI[0] <= 60f) || (aiStyle == 15 && ai[0] == 0f && localAI[1] <= 12f) || type == 861 || (type >= 511 && type <= 513 && ai[1] >= 1f) || type == 1007 || (aiStyle == 93 && ai[0] != 0f && ai[0] != 2f) || (aiStyle == 10 && localAI[1] == -1f) || (Main.projPet[type] && type != 266 && type != 407 && type != 317 && (type != 388 || ai[0] != 2f) && (type < 390 || type > 392) && (type < 393 || type > 395) && (type != 533 || !(ai[0] >= 6f) || !(ai[0] <= 8f)) && (type < 625 || type > 628) && (type != 755 || ai[0] == 0f) && (type != 946 || ai[0] == 0f) && type != 758 && type != 951 && type != 963 && (type != 759 || frame == Main.projFrames[type] - 1) && type != 833 && type != 834 && type != 835 && type != 864 && (type != 623 || ai[0] != 2f)))
			{
				return;
			}
			Rectangle myRect = new Rectangle((int)position.X, (int)position.Y, width, height);
			if (type == 101)
			{
				myRect.Inflate(30, 30);
			}
			if (type == 85)
			{
				if (localAI[0] >= 54f)
				{
					return;
				}
				int num = (int)Utils.Remap(localAI[0], 0f, 72f, 10f, 40f);
				myRect.Inflate(num, num);
			}
			if (type == 188)
			{
				myRect.Inflate(20, 20);
			}
			if (aiStyle == 29)
			{
				myRect.Inflate(4, 4);
			}
			if (friendly && owner == Main.myPlayer && !npcProj)
			{
				if (aiStyle == 16 && !ProjectileID.Sets.RocketsSkipDamageForPlayers[type] && (timeLeft <= 1 || type == 108 || type == 164 || type == 1002))
				{
					int myPlayer = Main.myPlayer;
					if (Main.player[myPlayer].active && !Main.player[myPlayer].dead && !Main.player[myPlayer].immune && (!ownerHitCheck || CanHitWithMeleeWeapon(Main.player[myPlayer])))
					{
						Rectangle value = new Rectangle((int)Main.player[myPlayer].position.X, (int)Main.player[myPlayer].position.Y, Main.player[myPlayer].width, Main.player[myPlayer].height);
						if (myRect.Intersects(value))
						{
							if (Main.player[myPlayer].position.X + (float)(Main.player[myPlayer].width / 2) < position.X + (float)(width / 2))
							{
								direction = -1;
							}
							else
							{
								direction = 1;
							}
							int num2 = Main.DamageVar(damage, 0f - Main.player[myPlayer].luck);
							int playerIndex = owner;
							bool pvp = true;
							if (type == 108 || type == 1002)
							{
								playerIndex = -1;
								pvp = false;
							}
							if (ProjectileID.Sets.IsAGravestone[type])
							{
								playerIndex = (int)ai[0];
							}
							bool dodgeable = IsDamageDodgable();
							PlayerDeathReason damageSource = PlayerDeathReason.ByProjectile(playerIndex, whoAmI);
							if (Main.player[myPlayer].Hurt(damageSource, num2, direction, pvp, quiet: false, Crit: false, -1, dodgeable) > 0.0 && !Main.player[myPlayer].dead)
							{
								StatusPlayer(myPlayer);
							}
							if (trap)
							{
								Main.player[myPlayer].trapDebuffSource = true;
								if (Main.player[myPlayer].dead)
								{
									AchievementsHelper.HandleSpecialEvent(Main.player[myPlayer], 4);
								}
							}
						}
					}
				}
				if (owner == Main.myPlayer && !npcProj && !minion)
				{
					CutTiles();
				}
			}
			if (owner == Main.myPlayer)
			{
				float num3 = 1f;
				if (ProjectileID.Sets.IsARocketThatDealsDoubleDamageToPrimaryEnemy[type] && timeLeft > 3)
				{
					num3 *= 2f;
				}
				if (ProjectileID.Sets.IsAMineThatDealsTripleDamageWhenStationary[type] && velocity.Length() < 0.5f)
				{
					num3 *= 3f;
				}
				if (type == 34 && penetrate == 1)
				{
					num3 *= 1f;
				}
				if (aiStyle == 15 && ai[0] == 0f)
				{
					num3 *= 1.2f;
				}
				if (aiStyle == 15 && (ai[0] == 1f || ai[0] == 2f))
				{
					num3 *= 2f;
				}
				if (type == 877 || type == 879 || type == 878)
				{
					num3 = 0.1f + Main.player[owner].velocity.Length() / 7f * 0.9f;
				}
				if (type == 968)
				{
					num3 = 1f;
					switch ((int)ai[1])
					{
					case 0:
						num3 = 1.5f;
						break;
					case 1:
						num3 = 1f;
						break;
					case 2:
						num3 = 1.5f;
						break;
					case 3:
						num3 = 0.1f;
						break;
					case 4:
						num3 = 1f;
						break;
					case 5:
						num3 = 1f;
						break;
					case 6:
						num3 = 1f;
						break;
					case 7:
						num3 = 0.25f;
						break;
					case 8:
						num3 = 1f;
						break;
					case 9:
						num3 = 0.75f;
						break;
					case 10:
						num3 = 0.5f;
						break;
					case 11:
						num3 = 0.5f;
						break;
					case 12:
						num3 = 0.5f;
						break;
					case 13:
						num3 = 0.5f;
						break;
					case 14:
						num3 = 0.5f;
						break;
					case 15:
						num3 = 0.5f;
						break;
					case 16:
						num3 = 0.5f;
						break;
					case 17:
						num3 = 1.5f;
						break;
					case 18:
						num3 = 1.6f;
						break;
					case 19:
						num3 = 1.8f;
						break;
					case 20:
						num3 = 1.9f;
						break;
					case 21:
						num3 = 1.7f;
						break;
					case 22:
						num3 = 2f;
						break;
					case 23:
						num3 = 1.9f;
						break;
					}
				}
				bool flag = !npcProj && !trap;
				bool flag2 = usesOwnerMeleeHitCD && flag && owner < 255;
				bool flag3 = damage > 0;
				if (flag3)
				{
					int[] array = localNPCImmunity;
					if (type == 626 || type == 627 || type == 628)
					{
						Projectile projectile = FindStardustDragonHeadOfOwner();
						if (projectile != null)
						{
							array = projectile.localNPCImmunity;
						}
					}
					bool flag4 = true;
					for (int i = 0; i < 200 && flag4; i++)
					{
						if (!Main.npc[i].active)
						{
							continue;
						}
						bool flag5 = (!usesLocalNPCImmunity && !usesIDStaticNPCImmunity) || (usesLocalNPCImmunity && array[i] == 0) || (usesIDStaticNPCImmunity && IsNPCIndexImmuneToProjectileType(type, i));
						if (flag2 && !Main.player[owner].CanHitNPCWithMeleeHit(i))
						{
							flag5 = false;
						}
						if (!((!Main.npc[i].dontTakeDamage || NPCID.Sets.ZappingJellyfish[Main.npc[i].type]) && flag5) || (Main.npc[i].aiStyle == 112 && Main.npc[i].ai[2] > 1f))
						{
							continue;
						}
						Main.npc[i].position += Main.npc[i].netOffset;
						bool flag6 = !Main.npc[i].friendly;
						flag6 |= type == 318;
						flag6 |= Main.npc[i].type == 22 && owner < 255 && Main.player[owner].killGuide;
						flag6 |= Main.npc[i].type == 54 && owner < 255 && Main.player[owner].killClothier;
						if (owner < 255 && !Main.player[owner].CanNPCBeHitByPlayerOrPlayerProjectile(Main.npc[i], this))
						{
							flag6 = false;
						}
						bool flag7 = Main.npc[i].friendly && !Main.npc[i].dontTakeDamageFromHostiles;
						if ((friendly && (flag6 || NPCID.Sets.ZappingJellyfish[Main.npc[i].type])) || (hostile && flag7))
						{
							bool flag8 = maxPenetrate == 1 && !usesLocalNPCImmunity && !usesIDStaticNPCImmunity;
							if (owner < 0 || Main.npc[i].immune[owner] == 0 || flag8)
							{
								bool flag9 = false;
								if (type == 11 && (Main.npc[i].type == 47 || Main.npc[i].type == 57))
								{
									flag9 = true;
								}
								else if (type == 31 && Main.npc[i].type == 69)
								{
									flag9 = true;
								}
								else if (Main.npc[i].trapImmune && trap)
								{
									flag9 = true;
								}
								else if (Main.npc[i].immortal && npcProj)
								{
									flag9 = true;
								}
								if (!flag9 && (Main.npc[i].noTileCollide || !ownerHitCheck || CanHitWithMeleeWeapon(Main.npc[i])))
								{
									bool flag10 = false;
									if (Main.npc[i].type == 414)
									{
										Rectangle rect = Main.npc[i].getRect();
										int num4 = 8;
										rect.X -= num4;
										rect.Y -= num4;
										rect.Width += num4 * 2;
										rect.Height += num4 * 2;
										flag10 = Colliding(myRect, rect);
									}
									else
									{
										flag10 = Colliding(myRect, Main.npc[i].getRect());
									}
									if (flag10)
									{
										NPC nPC = Main.npc[i];
										if (NPCID.Sets.ZappingJellyfish[nPC.type])
										{
											if ((nPC.dontTakeDamage || !Main.player[owner].CanNPCBeHitByPlayerOrPlayerProjectile(nPC, this)) && (aiStyle == 19 || aiStyle == 161 || aiStyle == 75 || aiStyle == 140 || ProjectileID.Sets.IsAWhip[type] || ProjectileID.Sets.AllowsContactDamageFromJellyfish[type]))
											{
												Main.player[owner].TakeDamageFromJellyfish(i);
											}
											if (nPC.dontTakeDamage || !flag6)
											{
												continue;
											}
										}
										if (type == 876)
										{
											Vector2 vector = position;
											if (Main.rand.Next(20) == 0)
											{
												tileCollide = false;
												position.X += Main.rand.Next(-256, 257);
											}
											if (Main.rand.Next(20) == 0)
											{
												tileCollide = false;
												position.Y += Main.rand.Next(-256, 257);
											}
											if (Main.rand.Next(2) == 0)
											{
												tileCollide = false;
											}
											if (Main.rand.Next(3) != 0)
											{
												vector = position;
												position -= velocity * Main.rand.Next(0, 40);
												if (tileCollide && Collision.SolidTiles(position, width, height))
												{
													position = vector;
													position -= velocity * Main.rand.Next(0, 40);
													if (tileCollide && Collision.SolidTiles(position, width, height))
													{
														position = vector;
													}
												}
											}
											velocity *= 0.6f;
											if (Main.rand.Next(7) == 0)
											{
												velocity.X += (float)Main.rand.Next(30, 31) * 0.01f;
											}
											if (Main.rand.Next(7) == 0)
											{
												velocity.Y += (float)Main.rand.Next(30, 31) * 0.01f;
											}
											damage = (int)((double)damage * 0.9);
											knockBack *= 0.9f;
											if (Main.rand.Next(20) == 0)
											{
												knockBack *= 10f;
											}
											if (Main.rand.Next(50) == 0)
											{
												damage *= 10;
											}
											if (Main.rand.Next(7) == 0)
											{
												vector = position;
												position.X += Main.rand.Next(-64, 65);
												if (tileCollide && Collision.SolidTiles(position, width, height))
												{
													position = vector;
												}
											}
											if (Main.rand.Next(7) == 0)
											{
												vector = position;
												position.Y += Main.rand.Next(-64, 65);
												if (tileCollide && Collision.SolidTiles(position, width, height))
												{
													position = vector;
												}
											}
											if (Main.rand.Next(14) == 0)
											{
												velocity.X *= -1f;
											}
											if (Main.rand.Next(14) == 0)
											{
												velocity.Y *= -1f;
											}
											if (Main.rand.Next(10) == 0)
											{
												velocity *= (float)Main.rand.Next(1, 201) * 0.0005f;
											}
											if (tileCollide)
											{
												ai[1] = 0f;
											}
											else
											{
												ai[1] = 1f;
											}
											netUpdate = true;
										}
										bool flag11 = nPC.reflectsProjectiles;
										if (Main.getGoodWorld && NPCID.Sets.ReflectStarShotsInForTheWorthy[Main.npc[i].type] && (type == 955 || type == 728))
										{
											flag11 = true;
										}
										if (flag11 && CanBeReflected() && nPC.CanReflectProjectile(this))
										{
											nPC.ReflectProjectile(this);
											Main.npc[i].position -= Main.npc[i].netOffset;
											return;
										}
										if (type == 604)
										{
											Main.player[owner].Counterweight(nPC.Center, damage, knockBack);
										}
										float num5 = knockBack;
										bool flag12 = false;
										int num6 = Main.player[owner].armorPenetration;
										float armorPenetrationPercent = 0f;
										bool flag13 = false;
										switch (type)
										{
										case 442:
											flag13 = true;
											break;
										case 410:
											if (Main.remixWorld)
											{
												num6 += 20;
											}
											break;
										case 864:
											num6 += 25;
											break;
										case 916:
											num6 += 50;
											break;
										case 917:
											num6 += 30;
											break;
										case 595:
											num6 += 20;
											break;
										case 493:
										case 494:
											num6 += 10;
											break;
										case 150:
										case 151:
										case 152:
											num6 += 10;
											break;
										case 189:
											num6 += 10;
											if (flag && Main.player[owner].strongBees)
											{
												num6 += 5;
											}
											break;
										case 723:
										case 724:
										case 725:
										case 726:
											num6 += 25;
											break;
										case 532:
											num6 += 25;
											break;
										case 964:
											num6 += 20;
											break;
										case 969:
											num6 += 10;
											break;
										case 85:
											num6 += 15;
											break;
										case 877:
										case 878:
										case 879:
											num5 *= Main.player[owner].velocity.Length() / 7f;
											break;
										case 963:
											num5 *= 0.25f;
											break;
										case 976:
											num6 += 20;
											break;
										case 974:
											num6 += 5;
											break;
										case 977:
											num6 += 5;
											break;
										}
										if (flag13)
										{
											Kill();
											return;
										}
										int num7 = (int)((float)damage * num3);
										int num8 = 0;
										if (type > 0 && type < 1022 && ProjectileID.Sets.StardustDragon[type])
										{
											float value2 = (scale - 1f) * 100f;
											value2 = Utils.Clamp(value2, 0f, 50f);
											num7 = (int)((float)num7 * (1f + value2 * 0.23f));
										}
										if (type > 0 && type < 1022 && ProjectileID.Sets.StormTiger[type])
										{
											int num9 = Math.Max(0, Main.player[owner].ownedProjectileCounts[831] - 1);
											num7 = (int)((float)num7 * (1f + (float)num9 * 0.4f));
										}
										if (type == 818)
										{
											int num10 = Math.Max(0, Main.player[owner].ownedProjectileCounts[831] - 1);
											num7 = (int)((float)num7 * (1.5f + (float)num10 * 0.4f));
										}
										if (type == 963)
										{
											int num11 = Math.Max(0, Main.player[owner].ownedProjectileCounts[970] - 1);
											int num12 = 3 + num11 / 2;
											if (CountEnemiesWhoAreImmuneToMeRightNow(num12) >= num12)
											{
												return;
											}
											float num13 = 0.55f;
											if (Main.hardMode)
											{
												num13 = 1.3f;
											}
											num7 = (int)((float)num7 * (1f + (float)num11 * num13));
										}
										if (flag && type == 189 && Main.player[owner].strongBees)
										{
											num7 += 5;
										}
										if (flag)
										{
											if (melee && Main.rand.Next(1, 101) <= Main.player[owner].meleeCrit)
											{
												flag12 = true;
											}
											if (ranged && Main.rand.Next(1, 101) <= Main.player[owner].rangedCrit)
											{
												flag12 = true;
											}
											if (magic && Main.rand.Next(1, 101) <= Main.player[owner].magicCrit)
											{
												flag12 = true;
											}
											int num14 = type;
											if ((uint)(num14 - 688) <= 2u)
											{
												if (Main.player[owner].setMonkT3)
												{
													if (Main.rand.Next(4) == 0)
													{
														flag12 = true;
													}
												}
												else if (Main.player[owner].setMonkT2 && Main.rand.Next(6) == 0)
												{
													flag12 = true;
												}
											}
										}
										float num15 = 1f;
										if (type == 864)
										{
											num15 = 0.75f;
										}
										if (type == 688 || type == 689 || type == 690)
										{
											num15 /= 2f;
										}
										if (flag && (minion || ProjectileID.Sets.MinionShot[type] || sentry || ProjectileID.Sets.SentryShot[type]))
										{
											bool flag14 = false;
											bool flag15 = false;
											bool flag16 = false;
											bool flag17 = false;
											bool flag18 = false;
											bool flag19 = false;
											bool flag20 = false;
											bool flag21 = false;
											bool flag22 = false;
											for (int j = 0; j < 20; j++)
											{
												if (nPC.buffTime[j] >= 1)
												{
													switch (nPC.buffType[j])
													{
													case 307:
														flag14 = true;
														break;
													case 309:
														flag15 = true;
														break;
													case 313:
														flag16 = true;
														break;
													case 310:
														flag17 = true;
														break;
													case 315:
														flag18 = true;
														break;
													case 326:
														flag19 = true;
														break;
													case 319:
														flag21 = true;
														break;
													case 316:
														flag22 = true;
														break;
													case 340:
														flag20 = true;
														break;
													}
												}
											}
											if (flag14)
											{
												num8 += 4;
											}
											if (flag18)
											{
												num8 += 6;
											}
											if (flag19)
											{
												num8 += 7;
											}
											if (flag20)
											{
												num8 += 6;
											}
											if (flag15)
											{
												num8 += 9;
											}
											if (flag21)
											{
												num8 += 8;
												if (Main.rand.Next(100) < 12)
												{
													flag12 = true;
												}
											}
											if (flag17)
											{
												int num16 = 10;
												num8 += num16;
												int num17 = NewProjectile(GetProjectileSource_FromThis(), nPC.Center, Vector2.Zero, 916, (int)((float)num16 * num15), 0f, owner);
												Main.projectile[num17].localNPCImmunity[i] = -1;
												EmitBlackLightningParticles(nPC);
											}
											if (flag22)
											{
												int num18 = 20;
												num8 += num18;
												if (Main.rand.Next(10) == 0)
												{
													flag12 = true;
												}
												ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.RainbowRodHit, new ParticleOrchestraSettings
												{
													PositionInWorld = base.Center
												});
											}
											if (flag16)
											{
												nPC.RequestBuffRemoval(313);
												int num19 = (int)((float)num7 * 1.75f);
												int num20 = NewProjectile(GetProjectileSource_FromThis(), nPC.Center, Vector2.Zero, 918, num19, 0f, owner);
												Main.projectile[num20].localNPCImmunity[i] = -1;
												num8 += num19;
											}
										}
										num8 = (int)((float)num8 * num15);
										num7 += num8;
										int num21 = ((!flag) ? Main.DamageVar(num7) : Main.DamageVar(num7, Main.player[owner].luck));
										if (type == 1002)
										{
											num21 /= 2;
										}
										if (trap && NPCID.Sets.BelongsToInvasionOldOnesArmy[nPC.type])
										{
											num21 /= 2;
										}
										if (type == 482 && (nPC.aiStyle == 6 || nPC.aiStyle == 37))
										{
											num21 /= 2;
										}
										if (flag)
										{
											Vector2 positionInWorld = Main.rand.NextVector2FromRectangle(nPC.Hitbox);
											ParticleOrchestraSettings particleOrchestraSettings = default(ParticleOrchestraSettings);
											particleOrchestraSettings.PositionInWorld = positionInWorld;
											ParticleOrchestraSettings settings = particleOrchestraSettings;
											switch (type)
											{
											case 972:
												ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.NightsEdge, settings, owner);
												break;
											case 973:
												ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.TrueNightsEdge, settings, owner);
												break;
											case 984:
											case 985:
												settings.MovementVector = velocity;
												ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.TerraBlade, settings, owner);
												break;
											case 982:
												ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.Excalibur, settings, owner);
												break;
											case 983:
												ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.TrueExcalibur, settings, owner);
												break;
											}
										}
										if (type == 604)
										{
											friendly = false;
											ai[1] = 1000f;
										}
										if ((type == 400 || type == 401 || type == 402) && nPC.type >= 13 && nPC.type <= 15)
										{
											num21 = (int)((double)num21 * 0.65);
											if (penetrate > 1)
											{
												penetrate--;
											}
										}
										if (type == 710 && !WorldUtils.Find(base.Center.ToTileCoordinates(), Searches.Chain(new Searches.Down(12), _cachedConditions_notNull, _cachedConditions_solid), out var _))
										{
											num21 = (int)((float)num21 * 1.5f);
										}
										if (type == 504 || type == 954 || type == 979)
										{
											float num22 = (60f - ai[0]) / 2f;
											ai[0] += num22;
										}
										if (aiStyle == 3 && type != 301 && type != 866 && type != 902)
										{
											if (ai[0] == 0f)
											{
												if (type == 106)
												{
													LightDisc_Bounce(base.Center + velocity.SafeNormalize(Vector2.UnitX) * 8f, (-velocity).SafeNormalize(Vector2.UnitX));
												}
												velocity.X = 0f - velocity.X;
												velocity.Y = 0f - velocity.Y;
												netUpdate = true;
											}
											ai[0] = 1f;
										}
										else if (type == 951)
										{
											Vector2 vector2 = (nPC.Center - base.Center).SafeNormalize(Vector2.Zero);
											vector2.X += (-0.5f + Main.rand.NextFloat()) * 13f;
											vector2.Y = -5f;
											velocity.X = vector2.X;
											velocity.Y = vector2.Y;
											netUpdate = true;
										}
										else if (type == 582 || type == 902)
										{
											if (ai[0] != 0f)
											{
												direction *= -1;
											}
										}
										else if (type == 612 || type == 953 || type == 978)
										{
											direction = Main.player[owner].direction;
										}
										else if (type == 624)
										{
											float num23 = 1f;
											if (nPC.knockBackResist > 0f)
											{
												num23 = 1f / nPC.knockBackResist;
											}
											knockBack = 4f * num23;
											num5 = knockBack;
											if (nPC.Center.X < base.Center.X)
											{
												direction = 1;
											}
											else
											{
												direction = -1;
											}
										}
										else if (aiStyle == 16)
										{
											if (timeLeft > 3)
											{
												timeLeft = 3;
											}
											if (nPC.position.X + (float)(nPC.width / 2) < position.X + (float)(width / 2))
											{
												direction = -1;
											}
											else
											{
												direction = 1;
											}
										}
										else if (aiStyle == 68)
										{
											if (timeLeft > 3)
											{
												timeLeft = 3;
											}
											if (nPC.position.X + (float)(nPC.width / 2) < position.X + (float)(width / 2))
											{
												direction = -1;
											}
											else
											{
												direction = 1;
											}
										}
										else if (aiStyle == 50)
										{
											if (nPC.position.X + (float)(nPC.width / 2) < position.X + (float)(width / 2))
											{
												direction = -1;
											}
											else
											{
												direction = 1;
											}
										}
										else if (type == 908)
										{
											if (nPC.position.X + (float)(nPC.width / 2) < position.X + (float)(width / 2))
											{
												direction = -1;
											}
											else
											{
												direction = 1;
											}
										}
										if (type == 509)
										{
											int num24 = Main.rand.Next(2, 6);
											for (int k = 0; k < num24; k++)
											{
												Vector2 vector3 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
												vector3 += velocity * 3f;
												vector3.Normalize();
												vector3 *= (float)Main.rand.Next(35, 81) * 0.1f;
												int num25 = (int)((double)damage * 0.5);
												NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector3.X, vector3.Y, 504, num25, knockBack * 0.2f, owner);
											}
										}
										if ((type == 476 || type == 950) && !npcProj)
										{
											float x = Main.player[owner].Center.X;
											if (nPC.Center.X < x)
											{
												direction = -1;
											}
											else
											{
												direction = 1;
											}
										}
										if (type == 598 || type == 636 || type == 614 || type == 971 || type == 975)
										{
											ai[0] = 1f;
											ai[1] = i;
											velocity = (nPC.Center - base.Center) * 0.75f;
											netUpdate = true;
										}
										if (type >= 511 && type <= 513)
										{
											ai[1] += 1f;
											netUpdate = true;
										}
										if (type == 659)
										{
											timeLeft = 0;
										}
										if (type == 524)
										{
											netUpdate = true;
											ai[0] += 50f;
										}
										if ((type == 688 || type == 689 || type == 690) && nPC.type != 68 && nPC.defense < 999)
										{
											armorPenetrationPercent = 1f;
										}
										if (aiStyle == 39)
										{
											if (ai[1] == 0f)
											{
												ai[1] = i + 1;
												netUpdate = true;
											}
											if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) < position.X + (float)(width / 2))
											{
												direction = 1;
											}
											else
											{
												direction = -1;
											}
										}
										if (type == 41 && timeLeft > 1)
										{
											timeLeft = 1;
										}
										if (aiStyle == 99)
										{
											Main.player[owner].Counterweight(nPC.Center, damage, knockBack);
											if (nPC.Center.X < Main.player[owner].Center.X)
											{
												direction = -1;
											}
											else
											{
												direction = 1;
											}
											if (ai[0] >= 0f)
											{
												Vector2 vector4 = base.Center - nPC.Center;
												vector4.Normalize();
												float num26 = 16f;
												velocity *= -0.5f;
												velocity += vector4 * num26;
												netUpdate = true;
												localAI[0] += 20f;
												if (!Collision.CanHit(position, width, height, Main.player[owner].position, Main.player[owner].width, Main.player[owner].height))
												{
													localAI[0] += 40f;
													num21 = (int)((double)num21 * 0.75);
												}
											}
										}
										if (type == 856 && !Collision.CanHit(position, width, height, Main.player[owner].position, Main.player[owner].width, Main.player[owner].height))
										{
											num21 = (int)((double)num21 * 0.75);
										}
										if (aiStyle == 93)
										{
											if (ai[0] == 0f)
											{
												ai[1] = 0f;
												int num27 = -i - 1;
												ai[0] = num27;
												velocity = nPC.Center - base.Center;
											}
											num21 = ((ai[0] != 2f) ? ((int)((double)num21 * 0.15)) : ((int)((double)num21 * 1.35)));
										}
										if (flag)
										{
											int num28 = Item.NPCtoBanner(nPC.BannerID());
											if (num28 >= 0)
											{
												Main.player[Main.myPlayer].lastCreatureHit = num28;
											}
										}
										if (Main.netMode != 2 && flag)
										{
											int num29 = Item.NPCtoBanner(nPC.BannerID());
											if (num29 > 0 && Main.player[owner].HasNPCBannerBuff(num29))
											{
												num21 = ((!Main.expertMode) ? ((int)((float)num21 * ItemID.Sets.BannerStrength[Item.BannerToItem(num29)].NormalDamageDealt)) : ((int)((float)num21 * ItemID.Sets.BannerStrength[Item.BannerToItem(num29)].ExpertDamageDealt)));
											}
										}
										if (Main.expertMode)
										{
											if ((type == 30 || type == 397 || type == 517 || type == 28 || type == 37 || type == 516 || type == 29 || type == 470 || type == 637 || type == 108 || type == 281 || type == 588 || type == 519 || type == 773 || type == 183 || type == 181 || type == 566 || type == 1002) && nPC.type >= 13 && nPC.type <= 15)
											{
												num21 /= 5;
											}
											if (type == 280 && ((nPC.type >= 134 && nPC.type <= 136) || nPC.type == 139))
											{
												num21 = (int)((double)num21 * 0.75);
											}
										}
										if (Main.netMode != 2 && nPC.type == 439 && type >= 0 && type <= 1022 && ProjectileID.Sets.CultistIsResistantTo[type])
										{
											num21 = (int)((float)num21 * 0.75f);
										}
										if (type == 497 && penetrate != 1)
										{
											ai[0] = 25f;
											float num30 = velocity.Length();
											Vector2 vector5 = nPC.Center - base.Center;
											vector5.Normalize();
											vector5 *= num30;
											velocity = -vector5 * 0.9f;
											netUpdate = true;
										}
										if (type == 323 && (nPC.type == 159 || nPC.type == 158))
										{
											num21 *= 10;
										}
										if (type == 981 && nPC.type == 104)
										{
											num21 *= 3;
										}
										if (type == 294)
										{
											damage = (int)((double)damage * 0.9);
										}
										if (type == 265)
										{
											damage = (int)((double)damage * 0.75);
										}
										if (type == 355)
										{
											damage = (int)((double)damage * 0.75);
										}
										if (type == 114)
										{
											damage = (int)((double)damage * 0.9);
										}
										if (type == 76 || type == 78 || type == 77)
										{
											damage = (int)((double)damage * 0.95);
										}
										if (type == 85)
										{
											damage = (int)((double)damage * 0.85);
										}
										if (type == 866)
										{
											damage = (int)((double)damage * 0.8);
										}
										if (type == 841)
										{
											damage = (int)((double)damage * 0.5);
										}
										if (type == 914)
										{
											damage = (int)((double)damage * 0.6);
										}
										if (type == 952)
										{
											damage = (int)((double)damage * 0.9);
										}
										if (type == 913)
										{
											damage = (int)((double)damage * 0.66);
										}
										if (type == 912)
										{
											damage = (int)((double)damage * 0.7);
										}
										if (type == 847)
										{
											damage = (int)((double)damage * 0.8);
										}
										if (type == 848)
										{
											damage = (int)((double)damage * 0.95);
										}
										if (type == 849)
										{
											damage = (int)((double)damage * 0.9);
										}
										if (type == 915)
										{
											damage = (int)((double)damage * 0.9);
										}
										if (type == 931)
										{
											damage = (int)((double)damage * 0.8);
										}
										if (type == 242)
										{
											damage = (int)((double)damage * 0.85);
										}
										if (type == 323)
										{
											damage = (int)((double)damage * 0.9);
										}
										if (type == 5)
										{
											damage = (int)((double)damage * 0.9);
										}
										if (type == 4)
										{
											damage = (int)((double)damage * 0.95);
										}
										if (type == 309)
										{
											damage = (int)((double)damage * 0.85);
										}
										if (type == 132)
										{
											damage = (int)((double)damage * 0.85);
										}
										if (type == 985)
										{
											damage = (int)((double)damage * 0.75);
										}
										if (type == 950)
										{
											damage = (int)((double)damage * 0.98);
										}
										if (type == 964)
										{
											damage = (int)((double)damage * 0.85);
										}
										if (type == 477 && penetrate > 1)
										{
											int[] array2 = new int[10];
											int num31 = 0;
											int num32 = 700;
											int num33 = 20;
											for (int l = 0; l < 200; l++)
											{
												if (l == i || !Main.npc[l].CanBeChasedBy(this))
												{
													continue;
												}
												float num34 = (base.Center - Main.npc[l].Center).Length();
												if (num34 > (float)num33 && num34 < (float)num32 && Collision.CanHitLine(base.Center, 1, 1, Main.npc[l].Center, 1, 1))
												{
													array2[num31] = l;
													num31++;
													if (num31 >= 9)
													{
														break;
													}
												}
											}
											if (num31 > 0)
											{
												num31 = Main.rand.Next(num31);
												Vector2 vector6 = Main.npc[array2[num31]].Center - base.Center;
												float num35 = velocity.Length();
												vector6.Normalize();
												velocity = vector6 * num35;
												netUpdate = true;
											}
										}
										if (type == 261 && velocity.Length() < 3.5f)
										{
											num21 /= 2;
											num5 /= 2f;
										}
										if (flag && melee && Main.player[owner].parryDamageBuff && !ProjectileID.Sets.DontApplyParryDamageBuff[type])
										{
											num21 *= 5;
											Main.player[owner].parryDamageBuff = false;
											Main.player[owner].ClearBuff(198);
										}
										StatusNPC(i);
										if (flag && nPC.life > 5)
										{
											TryDoingOnHitEffects(nPC);
										}
										if (ProjectileID.Sets.ImmediatelyUpdatesNPCBuffFlags[type])
										{
											nPC.UpdateNPC_BuffSetFlags(lowerBuffTime: false);
										}
										if (type == 317)
										{
											ai[1] = -1f;
											netUpdate = true;
										}
										int num36 = direction;
										switch (type)
										{
										case 697:
										case 699:
										case 707:
										case 708:
										case 759:
											num36 = ((Main.player[owner].Center.X < nPC.Center.X) ? 1 : (-1));
											break;
										}
										if (aiStyle == 15)
										{
											num36 = ((Main.player[owner].Center.X < nPC.Center.X) ? 1 : (-1));
											if (ai[0] == 0f)
											{
												num5 *= 0.35f;
											}
											if (ai[0] == 6f)
											{
												num5 *= 0.5f;
											}
										}
										if (flag && !hostile)
										{
											num21 += nPC.checkArmorPenetration(num6, armorPenetrationPercent);
										}
										NPCKillAttempt attempt = new NPCKillAttempt(nPC);
										int num37 = ((!flag) ? ((int)nPC.StrikeNPCNoInteraction(num21, num5, num36, flag12)) : ((int)nPC.StrikeNPC(num21, num5, num36, flag12)));
										if (flag && attempt.DidNPCDie())
										{
											Main.player[owner].OnKillNPC(ref attempt, this);
										}
										if (flag && Main.player[owner].accDreamCatcher)
										{
											Main.player[owner].addDPS(num37);
										}
										bool flag23 = !nPC.immortal;
										bool flag24 = num37 > 0 && nPC.lifeMax > 5 && friendly && !hostile && aiStyle != 59;
										bool flag25 = false;
										if (flag23 && active && timeLeft > 10 && nPC.active && nPC.type == 676 && CanBeReflected())
										{
											nPC.ReflectProjectile(this);
											penetrate++;
										}
										if (flag && flag23)
										{
											if (type == 997 && (!nPC.immortal || flag25) && !nPC.SpawnedFromStatue)
											{
												Main.player[owner].HorsemansBlade_SpawnPumpkin(i, (int)((float)damage * 1f), knockBack);
											}
											if (type == 756 && penetrate == 1)
											{
												damage = 0;
												penetrate = -1;
												flag4 = false;
											}
											if ((flag25 || nPC.value > 0f) && Main.player[owner].hasLuckyCoin && Main.rand.Next(5) == 0)
											{
												int num38 = 71;
												if (Main.rand.Next(10) == 0)
												{
													num38 = 72;
												}
												if (Main.rand.Next(100) == 0)
												{
													num38 = 73;
												}
												int num39 = Item.NewItem(GetItemSource_OnHit(nPC, 2), (int)nPC.position.X, (int)nPC.position.Y, nPC.width, nPC.height, num38);
												Main.item[num39].stack = Main.rand.Next(1, 11);
												Main.item[num39].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
												Main.item[num39].velocity.X = (float)Main.rand.Next(10, 31) * 0.2f * (float)num36;
												Main.item[num39].timeLeftInWhichTheItemCannotBeTakenByEnemies = 60;
												if (Main.netMode == 1)
												{
													NetMessage.SendData(21, -1, -1, null, num39);
												}
											}
											if (type == 999 && owner == Main.myPlayer && Main.rand.Next(3) == 0)
											{
												Player player = Main.player[owner];
												Vector2 vector7 = (base.Center - nPC.Center).SafeNormalize(Vector2.Zero) * 0.25f;
												int dmg = damage / 2;
												float kB = knockBack;
												NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector7.X, vector7.Y, player.beeType(), player.beeDamage(dmg), player.beeKB(kB), owner);
											}
											if (flag24)
											{
												if (type == 304 && !Main.player[owner].moonLeech)
												{
													vampireHeal(num37, new Vector2(nPC.Center.X, nPC.Center.Y), nPC);
												}
												if (nPC.canGhostHeal || flag25)
												{
													if (Main.player[owner].ghostHeal && !Main.player[owner].moonLeech)
													{
														ghostHeal(num37, new Vector2(nPC.Center.X, nPC.Center.Y), nPC);
													}
													if (Main.player[owner].ghostHurt)
													{
														ghostHurt(num37, new Vector2(nPC.Center.X, nPC.Center.Y), nPC);
													}
													if (magic && Main.player[owner].setNebula && Main.player[owner].nebulaCD == 0 && Main.rand.Next(3) == 0)
													{
														Main.player[owner].nebulaCD = 30;
														int num40 = Utils.SelectRandom<int>(Main.rand, 3453, 3454, 3455);
														int num41 = Item.NewItem(GetItemSource_OnHit(nPC, 1), (int)nPC.position.X, (int)nPC.position.Y, nPC.width, nPC.height, num40);
														Main.item[num41].velocity.Y = (float)Main.rand.Next(-20, 1) * 0.2f;
														Main.item[num41].velocity.X = (float)Main.rand.Next(10, 31) * 0.2f * (float)num36;
														if (Main.netMode == 1)
														{
															NetMessage.SendData(21, -1, -1, null, num41);
														}
													}
												}
												if (melee && Main.player[owner].beetleOffense && (!nPC.immortal || flag25))
												{
													if (Main.player[owner].beetleOrbs == 0)
													{
														Main.player[owner].beetleCounter += num37 * 3;
													}
													else if (Main.player[owner].beetleOrbs == 1)
													{
														Main.player[owner].beetleCounter += num37 * 2;
													}
													else
													{
														Main.player[owner].beetleCounter += num37;
													}
													Main.player[owner].beetleCountdown = 0;
												}
												if (arrow && type != 631 && Main.player[owner].phantasmTime > 0)
												{
													Vector2 source = Main.player[owner].position + Main.player[owner].Size * Utils.RandomVector2(Main.rand, 0f, 1f);
													Vector2 vector8 = nPC.DirectionFrom(source) * 6f;
													int num42 = (int)((float)damage * 0.3f);
													NewProjectile(GetProjectileSource_FromThis(), source.X, source.Y, vector8.X, vector8.Y, 631, num42, 0f, owner, i);
													NewProjectile(GetProjectileSource_FromThis(), source.X, source.Y, vector8.X, vector8.Y, 631, num42, 0f, owner, i, 15f);
													NewProjectile(GetProjectileSource_FromThis(), source.X, source.Y, vector8.X, vector8.Y, 631, num42, 0f, owner, i, 30f);
												}
												Player player2 = Main.player[owner];
												switch (type)
												{
												case 914:
													player2.AddBuff(314, 180);
													break;
												case 847:
													player2.AddBuff(308, 180);
													break;
												case 849:
													player2.AddBuff(311, 180);
													break;
												case 912:
												{
													int num43 = 15;
													if (!player2.coolWhipBuff)
													{
														NewProjectile(GetProjectileSource_FromThis(), nPC.Center, Vector2.Zero, 917, num43, 0f, owner);
														player2.coolWhipBuff = true;
													}
													player2.AddBuff(312, 180);
													break;
												}
												}
											}
										}
										if (flag && (melee || ProjectileID.Sets.IsAWhip[type]) && Main.player[owner].meleeEnchant == 7)
										{
											NewProjectile(GetProjectileSource_FromThis(), nPC.Center.X, nPC.Center.Y, nPC.velocity.X, nPC.velocity.Y, 289, 0, 0f, owner);
										}
										if (flag && type == 913)
										{
											localAI[0] = 1f;
										}
										if (Main.netMode != 0)
										{
											if (flag12)
											{
												NetMessage.SendData(28, -1, -1, null, i, num21, num5, num36, 1);
											}
											else
											{
												NetMessage.SendData(28, -1, -1, null, i, num21, num5, num36);
											}
										}
										if (type == 916)
										{
											EmitBlackLightningParticles(nPC);
										}
										if (type >= 390 && type <= 392)
										{
											localAI[1] = 20f;
										}
										if (usesIDStaticNPCImmunity)
										{
											if (penetrate != 1 || appliesImmunityTimeOnSingleHits)
											{
												nPC.immune[owner] = 0;
												perIDStaticNPCImmunity[type][i] = Main.GameUpdateCount + (uint)idStaticNPCHitCooldown;
											}
										}
										else if (type == 434)
										{
											numUpdates = 0;
										}
										else if (type == 598 || type == 636 || type == 614)
										{
											Point[] bufferForScan = _javelinsMax6;
											if (type == 636)
											{
												bufferForScan = _javelinsMax8;
											}
											if (type == 614)
											{
												bufferForScan = _javelinsMax10;
											}
											KillOldestJavelin(whoAmI, type, i, bufferForScan);
										}
										else if (type == 632)
										{
											nPC.immune[owner] = 5;
										}
										else if (type == 514)
										{
											nPC.immune[owner] = 1;
										}
										else if (type == 611)
										{
											if (localAI[1] <= 0f)
											{
												NewProjectile(GetProjectileSource_FromThis(), nPC.Center.X, nPC.Center.Y, 0f, 0f, 612, damage, 10f, owner, 0f, 0.85f + Main.rand.NextFloat() * 1.15f);
											}
											localAI[1] = 4f;
										}
										else if (type == 595 || type == 735)
										{
											nPC.immune[owner] = 5;
										}
										else if (type == 927)
										{
											nPC.immune[owner] = 4;
										}
										else if (type == 286)
										{
											nPC.immune[owner] = 5;
										}
										else if (type == 443)
										{
											nPC.immune[owner] = 8;
										}
										else if (type >= 424 && type <= 426)
										{
											nPC.immune[owner] = 5;
										}
										else if (type == 634 || type == 635)
										{
											nPC.immune[owner] = 5;
										}
										else if (type == 659)
										{
											nPC.immune[owner] = 5;
										}
										else if (type == 246)
										{
											nPC.immune[owner] = 7;
										}
										else if (type == 249)
										{
											nPC.immune[owner] = 7;
										}
										else if (type == 16)
										{
											nPC.immune[owner] = 8;
										}
										else if (type == 409)
										{
											nPC.immune[owner] = 6;
										}
										else if (type == 311)
										{
											nPC.immune[owner] = 7;
										}
										else if (type == 582 || type == 902)
										{
											nPC.immune[owner] = 7;
											if (ai[0] != 1f)
											{
												ai[0] = 1f;
												netUpdate = true;
											}
										}
										else
										{
											if (type == 451)
											{
												if (ai[0] == 0f)
												{
													ai[0] += penetrate;
												}
												else
												{
													ai[0] -= penetrate + 1;
												}
												ai[1] = 0f;
												netUpdate = true;
												Main.npc[i].position -= Main.npc[i].netOffset;
												break;
											}
											if (type == 864)
											{
												array[i] = 10;
												nPC.immune[owner] = 0;
												if (ai[0] > 0f)
												{
													ai[0] = -1f;
													ai[1] = 0f;
													netUpdate = true;
												}
											}
											else if (type == 661 || type == 856)
											{
												array[i] = 8;
												nPC.immune[owner] = 0;
											}
											else if (type == 866)
											{
												array[i] = -1;
												nPC.immune[owner] = 0;
												penetrate--;
												if (penetrate == 0)
												{
													penetrate = 1;
													damage = 0;
													ai[1] = -1f;
													netUpdate = true;
													Main.npc[i].position -= Main.npc[i].netOffset;
													break;
												}
												if (owner == Main.myPlayer)
												{
													int num44 = FindTargetWithLineOfSight();
													float num45 = ai[1];
													ai[1] = num44;
													if (ai[1] != num45)
													{
														netUpdate = true;
													}
													if (num44 != -1)
													{
														velocity = velocity.Length() * DirectionTo(Main.npc[num44].Center);
													}
												}
											}
											else if (usesLocalNPCImmunity && localNPCHitCooldown != -2)
											{
												nPC.immune[owner] = 0;
												array[i] = localNPCHitCooldown;
											}
											else if (penetrate != 1 || appliesImmunityTimeOnSingleHits)
											{
												nPC.immune[owner] = 10;
											}
										}
										if (type == 710)
										{
											BetsySharpnel(i);
										}
										if (penetrate > 0 && type != 317 && type != 866)
										{
											if (type == 357)
											{
												damage = (int)((double)damage * 0.8);
											}
											penetrate--;
											if (penetrate == 0)
											{
												Main.npc[i].position -= Main.npc[i].netOffset;
												if (stopsDealingDamageAfterPenetrateHits)
												{
													penetrate = -1;
													damage = 0;
												}
												flag4 = false;
											}
										}
										if (aiStyle == 7)
										{
											ai[0] = 1f;
											damage = 0;
											netUpdate = true;
										}
										else if (aiStyle == 13)
										{
											ai[0] = 1f;
											netUpdate = true;
										}
										else if (aiStyle == 69)
										{
											ai[0] = 1f;
											netUpdate = true;
										}
										else if (type == 607)
										{
											ai[0] = 1f;
											netUpdate = true;
											friendly = false;
										}
										else if (type == 638 || type == 639 || type == 640)
										{
											array[i] = -1;
											nPC.immune[owner] = 0;
											damage = (int)((double)damage * 0.96);
										}
										else if (type == 617)
										{
											array[i] = 8;
											nPC.immune[owner] = 0;
										}
										else if (type == 656)
										{
											array[i] = 8;
											nPC.immune[owner] = 0;
											localAI[0] += 1f;
										}
										else if (type == 618)
										{
											array[i] = 20;
											nPC.immune[owner] = 0;
										}
										else if (type == 642)
										{
											array[i] = 10;
											nPC.immune[owner] = 0;
										}
										else if (type == 857)
										{
											array[i] = 10;
											nPC.immune[owner] = 0;
										}
										else if (type == 611 || type == 612)
										{
											array[i] = 6;
											nPC.immune[owner] = 4;
										}
										else if (type == 645)
										{
											array[i] = -1;
											nPC.immune[owner] = 0;
											if (ai[1] != -1f)
											{
												ai[0] = 0f;
												ai[1] = -1f;
												netUpdate = true;
											}
										}
										numHits++;
										if (type == 697)
										{
											if (ai[0] >= 42f)
											{
												localAI[1] = 1f;
											}
										}
										else if (type == 699)
										{
											SummonMonkGhast();
										}
										else if (type == 706)
										{
											damage = (int)((float)damage * 0.95f);
										}
										else if (type == 728)
										{
											SummonSuperStarSlash(nPC.Center);
										}
										else if (type == 34)
										{
											if (ai[0] == -1f)
											{
												ai[1] = -1f;
												netUpdate = true;
											}
										}
										else if (type == 79)
										{
											if (ai[0] == -1f)
											{
												ai[1] = -1f;
												netUpdate = true;
											}
											ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.RainbowRodHit, new ParticleOrchestraSettings
											{
												PositionInWorld = nPC.Center,
												MovementVector = velocity
											});
										}
										else if (type == 931)
										{
											int num46 = FindTargetWithLineOfSight();
											if (num46 != -1)
											{
												ai[0] = num46;
												netUpdate = true;
											}
										}
										else if (aiStyle == 165)
										{
											if (nPC.active)
											{
												Main.player[owner].MinionAttackTargetNPC = i;
											}
										}
										else if (type == 623)
										{
											ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.StardustPunch, new ParticleOrchestraSettings
											{
												PositionInWorld = Vector2.Lerp(base.Center, nPC.Hitbox.ClosestPointInRect(base.Center), 0.5f) + new Vector2(0f, Main.rand.NextFloatDirection() * 10f),
												MovementVector = new Vector2(direction, Main.rand.NextFloatDirection() * 0.5f) * (3f + 3f * Main.rand.NextFloat())
											});
										}
										if (flag2)
										{
											Main.player[owner].SetMeleeHitCooldown(i, Main.player[owner].itemAnimation);
										}
									}
								}
							}
						}
						Main.npc[i].position -= Main.npc[i].netOffset;
					}
				}
				if (flag3 && Main.player[Main.myPlayer].hostile)
				{
					for (int m = 0; m < 255; m++)
					{
						if (m == owner)
						{
							continue;
						}
						Player player3 = Main.player[m];
						if (!player3.active || player3.dead || player3.immune || !player3.hostile || playerImmune[m] > 0 || (Main.player[Main.myPlayer].team != 0 && Main.player[Main.myPlayer].team == player3.team))
						{
							continue;
						}
						bool flag26 = !ownerHitCheck;
						if (ownerHitCheck)
						{
							flag26 |= CanHitWithMeleeWeapon(player3);
						}
						if (!flag26 || !Colliding(myRect, player3.getRect()))
						{
							continue;
						}
						if (aiStyle == 3)
						{
							if (ai[0] == 0f)
							{
								velocity.X = 0f - velocity.X;
								velocity.Y = 0f - velocity.Y;
								netUpdate = true;
							}
							ai[0] = 1f;
						}
						else if (aiStyle == 16)
						{
							if (timeLeft > 3)
							{
								timeLeft = 3;
							}
							if (player3.position.X + (float)(player3.width / 2) < position.X + (float)(width / 2))
							{
								direction = -1;
							}
							else
							{
								direction = 1;
							}
						}
						else if (aiStyle == 68)
						{
							if (timeLeft > 3)
							{
								timeLeft = 3;
							}
							if (player3.position.X + (float)(player3.width / 2) < position.X + (float)(width / 2))
							{
								direction = -1;
							}
							else
							{
								direction = 1;
							}
						}
						int playerIndex2 = owner;
						if (ProjectileID.Sets.IsAGravestone[type])
						{
							playerIndex2 = (int)ai[0];
						}
						PlayerDeathReason playerDeathReason = PlayerDeathReason.ByProjectile(playerIndex2, whoAmI);
						if (type == 41 && timeLeft > 1)
						{
							timeLeft = 1;
						}
						bool flag27 = false;
						if (melee && Main.rand.Next(1, 101) <= Main.player[owner].meleeCrit)
						{
							flag27 = true;
						}
						int num47 = Main.DamageVar((int)((float)damage * num3), Main.player[owner].luck);
						bool dodgeable2 = IsDamageDodgable();
						if (!player3.immune)
						{
							StatusPvP(m);
						}
						TryDoingOnHitEffects(player3);
						int num48 = (int)player3.Hurt(playerDeathReason, num47, direction, pvp: true, quiet: false, flag27, -1, dodgeable2);
						if (num48 > 0 && Main.player[owner].ghostHeal && friendly && !hostile)
						{
							ghostHeal(num48, new Vector2(player3.Center.X, player3.Center.Y), player3);
						}
						if (type == 304 && num48 > 0)
						{
							vampireHeal(num48, new Vector2(player3.Center.X, player3.Center.Y), player3);
						}
						if ((melee || ProjectileID.Sets.IsAWhip[type]) && Main.player[owner].meleeEnchant == 7)
						{
							NewProjectile(GetProjectileSource_FromThis(), player3.Center.X, player3.Center.Y, player3.velocity.X, player3.velocity.Y, 289, 0, 0f, owner);
						}
						if (Main.netMode != 0)
						{
							NetMessage.SendPlayerHurt(m, playerDeathReason, num47, direction, flag27, pvp: true, -1);
						}
						playerImmune[m] = 40;
						if (penetrate > 0)
						{
							penetrate--;
							if (penetrate == 0)
							{
								break;
							}
						}
						if (aiStyle == 7)
						{
							ai[0] = 1f;
							damage = 0;
							netUpdate = true;
						}
						else if (aiStyle == 13)
						{
							ai[0] = 1f;
							netUpdate = true;
						}
						else if (aiStyle == 69)
						{
							ai[0] = 1f;
							netUpdate = true;
						}
					}
				}
			}
			if (type == 10 && Main.netMode != 1)
			{
				for (int n = 0; n < 200; n++)
				{
					NPC nPC2 = Main.npc[n];
					if (!nPC2.active)
					{
						continue;
					}
					if (nPC2.type == 534)
					{
						if (myRect.Intersects(nPC2.Hitbox))
						{
							nPC2.Transform(441);
						}
					}
					else
					{
						if (nPC2.type != 687 || !myRect.Intersects(nPC2.Hitbox))
						{
							continue;
						}
						nPC2.Transform(683);
						Vector2 vector9 = nPC2.Center - new Vector2(20f);
						Utils.PoofOfSmoke(vector9);
						if (Main.netMode == 2)
						{
							NetMessage.SendData(106, -1, -1, null, (int)vector9.X, vector9.Y);
						}
						if (!NPC.unlockedSlimeYellowSpawn)
						{
							NPC.unlockedSlimeYellowSpawn = true;
							if (Main.netMode == 2)
							{
								NetMessage.SendData(7);
							}
						}
					}
				}
			}
			if ((type == 11 || type == 463) && Main.netMode != 1)
			{
				bool crimson = type == 463;
				for (int num49 = 0; num49 < 200; num49++)
				{
					if (Main.npc[num49].active)
					{
						Rectangle value3 = new Rectangle((int)Main.npc[num49].position.X, (int)Main.npc[num49].position.Y, Main.npc[num49].width, Main.npc[num49].height);
						if (myRect.Intersects(value3))
						{
							Main.npc[num49].AttemptToConvertNPCToEvil(crimson);
						}
					}
				}
			}
			if (Main.netMode == 2 || !hostile || Main.myPlayer >= 255 || damage <= 0)
			{
				return;
			}
			int num50 = -1;
			switch (type)
			{
			case 452:
			case 454:
			case 455:
			case 462:
				num50 = 1;
				break;
			case 871:
			case 872:
			case 873:
			case 874:
			case 919:
			case 923:
			case 924:
				num50 = 1;
				break;
			}
			int myPlayer2 = Main.myPlayer;
			bool flag28 = Main.player[myPlayer2].active && !Main.player[myPlayer2].dead && (!Main.player[myPlayer2].immune || num50 != -1);
			if (flag28 && type == 281)
			{
				flag28 = ai[1] - 1f == (float)myPlayer2;
			}
			if (Main.getGoodWorld && type == 281)
			{
				flag28 = true;
			}
			if (!flag28 || !Colliding(myRect, Main.player[myPlayer2].getRect()))
			{
				return;
			}
			int num51 = direction;
			num51 = ((!(Main.player[myPlayer2].position.X + (float)(Main.player[myPlayer2].width / 2) < position.X + (float)(width / 2))) ? 1 : (-1));
			if (!Main.player[myPlayer2].CanParryAgainst(Main.player[myPlayer2].Hitbox, base.Hitbox, velocity))
			{
				int num52 = Main.DamageVar(damage, 0f - Main.player[owner].luck);
				int num53 = bannerIdToRespondTo;
				if (num53 > 0 && Main.player[myPlayer2].HasNPCBannerBuff(num53))
				{
					ItemID.BannerEffect bannerEffect = ItemID.Sets.BannerStrength[Item.BannerToItem(num53)];
					num52 = ((!Main.expertMode) ? ((int)((float)num52 * bannerEffect.NormalDamageReceived)) : ((int)((float)num52 * bannerEffect.ExpertDamageReceived)));
				}
				if (Main.player[myPlayer2].resistCold && coldDamage)
				{
					num52 = (int)((float)num52 * 0.7f);
				}
				if (!reflected)
				{
					float num54 = Main.GameModeInfo.EnemyDamageMultiplier;
					if (Main.GameModeInfo.IsJourneyMode)
					{
						CreativePowers.DifficultySliderPower power = CreativePowerManager.Instance.GetPower<CreativePowers.DifficultySliderPower>();
						if (power.GetIsUnlocked())
						{
							num54 = power.StrengthMultiplierToGiveNPCs;
						}
					}
					num52 = (int)((float)num52 * num54);
				}
				int num55 = num52 * 2;
				if (type == 961)
				{
					if (penetrate == 1)
					{
						damage = 0;
						penetrate = -1;
					}
					else
					{
						damage = (int)((double)damage * 0.7);
					}
				}
				bool dodgeable3 = IsDamageDodgable();
				int playerIndex3 = -1;
				if (ProjectileID.Sets.IsAGravestone[type])
				{
					playerIndex3 = (int)ai[0];
				}
				if (Main.player[myPlayer2].Hurt(PlayerDeathReason.ByProjectile(playerIndex3, whoAmI), num55, num51, pvp: false, quiet: false, Crit: false, num50, dodgeable3) > 0.0 && !Main.player[myPlayer2].dead)
				{
					StatusPlayer(myPlayer2);
				}
				if (trap)
				{
					Main.player[myPlayer2].trapDebuffSource = true;
					if (Main.player[myPlayer2].dead)
					{
						AchievementsHelper.HandleSpecialEvent(Main.player[myPlayer2], 4);
					}
				}
			}
			if (true)
			{
				if (type == 435 || type == 682)
				{
					penetrate--;
				}
				if (type == 436)
				{
					penetrate--;
				}
				if (type == 681)
				{
					timeLeft = 0;
				}
				if (type == 437)
				{
					penetrate--;
				}
			}
		}

		public bool IsDamageDodgable()
		{
			int num = type;
			if (((uint)(num - 871) <= 3u || num == 919 || (uint)(num - 923) <= 1u) && damage == 9999)
			{
				return false;
			}
			return true;
		}

		public static void KillOldestJavelin(int protectedProjectileIndex, int projectileType, int targetNPCIndex, Point[] bufferForScan)
		{
			int num = 0;
			for (int i = 0; i < 1000; i++)
			{
				if (i != protectedProjectileIndex && Main.projectile[i].active && Main.projectile[i].owner == Main.myPlayer && Main.projectile[i].type == projectileType && Main.projectile[i].ai[0] == 1f && Main.projectile[i].ai[1] == (float)targetNPCIndex)
				{
					bufferForScan[num++] = new Point(i, Main.projectile[i].timeLeft);
					if (num >= bufferForScan.Length)
					{
						break;
					}
				}
			}
			if (num < bufferForScan.Length)
			{
				return;
			}
			int num2 = 0;
			for (int j = 1; j < bufferForScan.Length; j++)
			{
				if (bufferForScan[j].Y < bufferForScan[num2].Y)
				{
					num2 = j;
				}
			}
			Main.projectile[bufferForScan[num2].X].Kill();
		}

		private int CountEnemiesWhoAreImmuneToMeRightNow(int cap)
		{
			int num = 0;
			for (int i = 0; i < localNPCImmunity.Length; i++)
			{
				if (localNPCImmunity[i] > 0)
				{
					num++;
					if (num >= cap)
					{
						break;
					}
				}
			}
			return num;
		}

		private static void EmitBlackLightningParticles(NPC targetNPC)
		{
			ParticleOrchestrator.RequestParticleSpawn(clientOnly: false, ParticleOrchestraType.BlackLightningHit, new ParticleOrchestraSettings
			{
				PositionInWorld = targetNPC.Center
			});
		}

		private void TryDoingOnHitEffects(Entity entity)
		{
			switch (type)
			{
			case 221:
			case 227:
			case 614:
			case 729:
			case 908:
			case 977:
				return;
			}
			Main.player[owner].OnHit(entity.Center.X, entity.Center.Y, entity);
		}

		private void SummonSuperStarSlash(Vector2 target)
		{
			Vector2 v = Main.rand.NextVector2CircularEdge(200f, 200f);
			if (v.Y < 0f)
			{
				v.Y *= -1f;
			}
			v.Y += 100f;
			Vector2 vector = v.SafeNormalize(Vector2.UnitY) * 6f;
			NewProjectile(GetProjectileSource_FromThis(), target - vector * 20f, vector, 729, (int)((double)damage * 0.75), 0f, owner, 0f, target.Y);
		}

		private void SummonMonkGhast()
		{
			if (localAI[0] > 0f)
			{
				return;
			}
			localAI[0] = 1000f;
			List<NPC> list = new List<NPC>();
			for (int i = 0; i < 200; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.CanBeChasedBy(this) && Distance(nPC.Center) < 800f)
				{
					list.Add(nPC);
				}
			}
			Vector2 center = base.Center;
			Vector2 zero = Vector2.Zero;
			if (list.Count > 0)
			{
				NPC nPC2 = list[Main.rand.Next(list.Count)];
				center = nPC2.Center;
				zero = nPC2.velocity;
			}
			int num = Main.rand.Next(2) * 2 - 1;
			Vector2 vector = new Vector2((float)num * (4f + (float)Main.rand.Next(3)), 0f);
			Vector2 vector2 = center + new Vector2(-num * 120, 0f);
			vector += (center + zero * 15f - vector2).SafeNormalize(Vector2.Zero) * 2f;
			NewProjectile(GetProjectileSource_FromThis(), vector2, vector, 700, damage, 0f, owner);
		}

		private void CutTiles()
		{
			if (!CanCutTiles())
			{
				return;
			}
			AchievementsHelper.CurrentlyMining = true;
			bool flag = true;
			bool[] tileCutIgnorance = Main.player[owner].GetTileCutIgnorance(allowRegrowth: false);
			DelegateMethods.tilecut_0 = TileCuttingContext.AttackProjectile;
			DelegateMethods.tileCutIgnore = tileCutIgnorance;
			Rectangle extensionBox;
			if (type == 461 || type == 632 || type == 642)
			{
				Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CutTiles);
			}
			else if (ProjectileID.Sets.IsAWhip[type])
			{
				flag = false;
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Vector2 vector = new Vector2((float)width * scale / 2f, 0f);
				for (int i = 0; i < WhipPointsForCollision.Count; i++)
				{
					Utils.PlotTileLine(WhipPointsForCollision[i] - vector, WhipPointsForCollision[i] + vector, (float)height * scale, DelegateMethods.CutTiles);
				}
			}
			else if (type == 756)
			{
				Utils.PlotTileLine(base.Center, base.Center + velocity.SafeNormalize(-Vector2.UnitY) * 200f * scale, 22f * scale, DelegateMethods.CutTiles);
			}
			else if (type == 927)
			{
				Vector2 end = base.Center + velocity.SafeNormalize(Vector2.UnitX) * 220f * scale;
				Utils.PlotTileLine(base.Center, end, 80f * scale, DelegateMethods.CutTiles);
			}
			else if (type == 802 || type == 842 || type == 938 || type == 939 || type == 940 || type == 941 || type == 942 || type == 943 || type == 944 || type == 945)
			{
				Utils.PlotTileLine(base.Center, base.Center + velocity.SafeNormalize(-Vector2.UnitY) * 10f, 10f * scale, DelegateMethods.CutTiles);
			}
			else if (type == 611)
			{
				Utils.PlotTileLine(base.Center, base.Center + velocity + velocity.SafeNormalize(Vector2.Zero) * 48f, (float)width * scale, DelegateMethods.CutTiles);
			}
			else if (type == 697 || type == 707)
			{
				float num = 40f;
				if (type == 707)
				{
					num = 60f;
				}
				float f = rotation - MathF.PI / 4f * (float)Math.Sign(velocity.X);
				Utils.PlotTileLine(base.Center + f.ToRotationVector2() * (0f - num), base.Center + f.ToRotationVector2() * num, (float)width * scale, DelegateMethods.CutTiles);
			}
			else if (aiStyle == 190 || aiStyle == 191)
			{
				flag = false;
				Vector2 vector2 = (rotation - MathF.PI / 4f).ToRotationVector2() * 60f * scale;
				Vector2 vector3 = (rotation + MathF.PI / 4f).ToRotationVector2() * 60f * scale;
				float num2 = 60f * scale;
				Utils.PlotTileLine(base.Center + vector2, base.Center + vector3, num2, DelegateMethods.CutTiles);
			}
			else if (aiStyle == 19 && AI_019_Spears_GetExtensionHitbox(out extensionBox))
			{
				CutTilesAt(extensionBox.TopLeft(), extensionBox.Width, extensionBox.Height);
			}
			if (flag)
			{
				CutTilesAt(position, width, height);
			}
			AchievementsHelper.CurrentlyMining = false;
		}

		private void CutTilesAt(Vector2 boxPosition, int boxWidth, int boxHeight)
		{
			int num = (int)(boxPosition.X / 16f);
			int num2 = (int)((boxPosition.X + (float)boxWidth) / 16f) + 1;
			int num3 = (int)(boxPosition.Y / 16f);
			int num4 = (int)((boxPosition.Y + (float)boxHeight) / 16f) + 1;
			if (num < 0)
			{
				num = 0;
			}
			if (num2 > Main.maxTilesX)
			{
				num2 = Main.maxTilesX;
			}
			if (num3 < 0)
			{
				num3 = 0;
			}
			if (num4 > Main.maxTilesY)
			{
				num4 = Main.maxTilesY;
			}
			bool[] tileCutIgnorance = Main.player[owner].GetTileCutIgnorance(allowRegrowth: false);
			for (int i = num; i < num2; i++)
			{
				for (int j = num3; j < num4; j++)
				{
					if (Main.tile[i, j] != null && Main.tileCut[Main.tile[i, j].type] && !tileCutIgnorance[Main.tile[i, j].type] && WorldGen.CanCutTile(i, j, TileCuttingContext.AttackProjectile))
					{
						WorldGen.KillTile(i, j);
						if (Main.netMode != 0)
						{
							NetMessage.SendData(17, -1, -1, null, 0, i, j);
						}
					}
				}
			}
		}

		private bool CanCutTiles()
		{
			if (aiStyle != 45 && aiStyle != 137 && aiStyle != 92 && aiStyle != 105 && aiStyle != 106 && !ProjectileID.Sets.IsAGolfBall[type] && type != 463 && type != 69 && type != 70 && type != 621 && type != 10 && type != 11 && type != 379 && type != 407 && type != 476 && type != 623 && (type < 625 || type > 628) && type != 833 && type != 834 && type != 835 && type != 818 && type != 831 && type != 820 && type != 864 && type != 970 && type != 995 && type != 908)
			{
				return type != 1020;
			}
			return false;
		}

		public bool Colliding(Rectangle myRect, Rectangle targetRect)
		{
			if (aiStyle == 15)
			{
				if (ai[0] == 0f)
				{
					Vector2 mountedCenter = Main.player[owner].MountedCenter;
					Vector2 vector = targetRect.ClosestPointInRect(mountedCenter) - mountedCenter;
					vector.Y /= 0.8f;
					float num = 55f;
					return vector.Length() <= num;
				}
			}
			else if (type == 973)
			{
				Vector2 v = targetRect.ClosestPointInRect(base.Center) - base.Center;
				v.SafeNormalize(Vector2.UnitX);
				float num2 = 100f * scale;
				if (v.Length() < num2 && Collision.CanHit(base.Center, 0, 0, targetRect.Center.ToVector2(), 0, 0))
				{
					return true;
				}
			}
			else
			{
				if (type == 85)
				{
					if (!myRect.Intersects(targetRect))
					{
						return false;
					}
					return Collision.CanHit(base.Center, 0, 0, targetRect.Center.ToVector2(), 0, 0);
				}
				if (type == 985)
				{
					float coneLength = 90f * scale;
					float maximumAngle = MathF.PI / 4f;
					float coneRotation = rotation;
					if (targetRect.IntersectsCone(base.Center, coneLength, coneRotation, maximumAngle) && Collision.CanHit(base.Center, 0, 0, targetRect.Center.ToVector2(), 0, 0))
					{
						return true;
					}
				}
				else
				{
					if (aiStyle == 190)
					{
						float coneLength2 = 90f * scale;
						float num3 = 0.5105088f * ai[0];
						float maximumAngle2 = MathF.PI / 8f;
						float coneRotation2 = rotation + num3;
						float num4 = MathF.PI / 4f * ai[0];
						_ = rotation;
						return targetRect.IntersectsCone(base.Center, coneLength2, coneRotation2, maximumAngle2);
					}
					if (type == 623)
					{
						if (ai[0] == 2f)
						{
							Rectangle value = Utils.CenteredRectangle(base.Center + new Vector2(direction * 40, 0f), new Vector2(80f, 40f));
							if (targetRect.Intersects(value))
							{
								return true;
							}
						}
					}
					else
					{
						if (type == 933)
						{
							float collisionPoint = 0f;
							float num5 = 40f;
							for (int i = 14; i < oldPos.Length; i += 15)
							{
								float num6 = localAI[0] - (float)i;
								if (!(num6 < 0f) && !(num6 > 60f))
								{
									Vector2 vector2 = oldPos[i] + base.Size / 2f;
									Vector2 vector3 = (oldRot[i] + MathF.PI / 2f).ToRotationVector2();
									_lanceHitboxBounds.X = (int)vector2.X - _lanceHitboxBounds.Width / 2;
									_lanceHitboxBounds.Y = (int)vector2.Y - _lanceHitboxBounds.Height / 2;
									if (_lanceHitboxBounds.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), vector2 - vector3 * num5, vector2 + vector3 * num5, 20f, ref collisionPoint))
									{
										return true;
									}
								}
							}
							Vector2 vector4 = (rotation + MathF.PI / 2f).ToRotationVector2();
							_lanceHitboxBounds.X = (int)position.X - _lanceHitboxBounds.Width / 2;
							_lanceHitboxBounds.Y = (int)position.Y - _lanceHitboxBounds.Height / 2;
							if (_lanceHitboxBounds.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center - vector4 * num5, base.Center + vector4 * num5, 20f, ref collisionPoint))
							{
								return true;
							}
							return false;
						}
						if (type == 927)
						{
							for (float num7 = 0f; num7 <= 1f; num7 += 0.05f)
							{
								float num8 = Utils.Remap(num7, 0f, 1f, 1f, 5f);
								Rectangle rectangle = myRect;
								Vector2 vector5 = velocity.SafeNormalize(Vector2.Zero) * width * num8 * scale;
								rectangle.Offset((int)vector5.X, (int)vector5.Y);
								if (rectangle.Intersects(targetRect))
								{
									return true;
								}
							}
						}
						else
						{
							if (type == 877 || type == 878 || type == 879)
							{
								float f = rotation - MathF.PI / 4f - MathF.PI / 2f - ((spriteDirection == 1) ? MathF.PI : 0f);
								float collisionPoint2 = 0f;
								float num9 = 95f;
								_lanceHitboxBounds.X = (int)position.X - _lanceHitboxBounds.Width / 2;
								_lanceHitboxBounds.Y = (int)position.Y - _lanceHitboxBounds.Height / 2;
								if (_lanceHitboxBounds.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + f.ToRotationVector2() * num9, 23f * scale, ref collisionPoint2))
								{
									return true;
								}
								return false;
							}
							if (type == 974)
							{
								float f2 = rotation;
								float collisionPoint3 = 0f;
								float num10 = 46f * scale;
								float num11 = 8f;
								Vector2 vector6 = f2.ToRotationVector2();
								Rectangle hitbox = base.Hitbox;
								hitbox.Inflate((int)num10, (int)num10);
								if (hitbox.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center - vector6 * num10, base.Center + vector6 * num10, num11 * scale, ref collisionPoint3))
								{
									return true;
								}
								return false;
							}
							if (type == 919 || type == 932)
							{
								float f3 = rotation;
								float collisionPoint4 = 0f;
								float num12 = 40f;
								Vector2 vector7 = f3.ToRotationVector2();
								_lanceHitboxBounds.X = (int)position.X - _lanceHitboxBounds.Width / 2;
								_lanceHitboxBounds.Y = (int)position.Y - _lanceHitboxBounds.Height / 2;
								if (_lanceHitboxBounds.Intersects(targetRect) && Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center - vector7 * num12, base.Center + vector7 * num12, 8f, ref collisionPoint4))
								{
									return true;
								}
								return false;
							}
							if (type == 923)
							{
								float collisionPoint5 = 0f;
								_ = scale;
								float f4 = rotation;
								Vector2 objectPosition = targetRect.TopLeft();
								Vector2 objectDimensions = targetRect.Size();
								Vector2 vector8 = f4.ToRotationVector2();
								float num13 = scale * 0.7f;
								if (Collision.CheckAABBvLineCollision(objectPosition, objectDimensions, base.Center, base.Center + vector8 * scale * 510f, num13 * 100f, ref collisionPoint5))
								{
									return true;
								}
								if (Collision.CheckAABBvLineCollision(objectPosition, objectDimensions, base.Center, base.Center + vector8 * scale * 660f, num13 * 60f, ref collisionPoint5))
								{
									return true;
								}
								if (Collision.CheckAABBvLineCollision(objectPosition, objectDimensions, base.Center, base.Center + vector8 * scale * 800f, num13 * 10f, ref collisionPoint5))
								{
									return true;
								}
								return false;
							}
							if (type == 598 && targetRect.Width > 8 && targetRect.Height > 8)
							{
								targetRect.Inflate(-targetRect.Width / 8, -targetRect.Height / 8);
							}
							else
							{
								if (type == 872)
								{
									Rectangle hitbox2 = base.Hitbox;
									int num14 = 80;
									for (int j = 0; j < num14; j += 2)
									{
										Vector2 vector9 = oldPos[j];
										if (!(vector9 == Vector2.Zero))
										{
											hitbox2.X = (int)vector9.X;
											hitbox2.Y = (int)vector9.Y;
											if (hitbox2.Intersects(targetRect))
											{
												return true;
											}
										}
									}
									return false;
								}
								if (type == 871)
								{
									int num15 = AI_172_GetPelletStormsCount();
									for (int k = 0; k < num15; k++)
									{
										HallowBossPelletStormInfo hallowBossPelletStormInfo = AI_172_GetPelletStormInfo(k);
										for (int l = 0; l < hallowBossPelletStormInfo.BulletsInStorm; l++)
										{
											if (hallowBossPelletStormInfo.IsValid(l) && hallowBossPelletStormInfo.GetBulletHitbox(l, base.Center).Intersects(targetRect))
											{
												return true;
											}
										}
									}
									return false;
								}
								if (ProjectileID.Sets.IsAWhip[type])
								{
									WhipPointsForCollision.Clear();
									FillWhipControlPoints(this, WhipPointsForCollision);
									for (int m = 0; m < WhipPointsForCollision.Count; m++)
									{
										Point point = WhipPointsForCollision[m].ToPoint();
										myRect.Location = new Point(point.X - myRect.Width / 2, point.Y - myRect.Height / 2);
										if (myRect.Intersects(targetRect))
										{
											return true;
										}
									}
									return false;
								}
								if (type == 614 && targetRect.Width > 8 && targetRect.Height > 8)
								{
									targetRect.Inflate(-targetRect.Width / 8, -targetRect.Height / 8);
								}
								else if (type == 963 && ai[0] >= 2f)
								{
									targetRect.Inflate(30, 30);
								}
								else if (type == 758)
								{
									if (ai[0] == 2f && Utils.CenteredRectangle(base.Center + new Vector2(spriteDirection * 30, 0f), new Vector2(50f, 20f)).Intersects(targetRect))
									{
										return true;
									}
								}
								else if (type == 636 && targetRect.Width > 8 && targetRect.Height > 8)
								{
									targetRect.Inflate(-targetRect.Width / 8, -targetRect.Height / 8);
								}
								else if (type == 607)
								{
									myRect.X += (int)velocity.X;
									myRect.Y += (int)velocity.Y;
								}
								else if (type == 661)
								{
									if (Vector2.Distance(myRect.Center.ToVector2(), targetRect.Center.ToVector2()) > 500f || !Collision.CanHitLine(myRect.Center.ToVector2(), 0, 0, targetRect.Center.ToVector2(), 0, 0))
									{
										return false;
									}
								}
								else
								{
									if (aiStyle == 137)
									{
										if (myRect.Intersects(targetRect) && targetRect.Distance(base.Center) < (float)(height / 2 - 20))
										{
											if (AI_137_CanHit(targetRect.Center.ToVector2()))
											{
												return true;
											}
											if (AI_137_CanHit(targetRect.TopLeft() + new Vector2(targetRect.Width / 2, 0f)))
											{
												return true;
											}
										}
										return false;
									}
									if (aiStyle == 19 && AI_019_Spears_GetExtensionHitbox(out var extensionBox) && extensionBox.Intersects(targetRect))
									{
										return true;
									}
								}
							}
						}
					}
				}
			}
			if (myRect.Intersects(targetRect))
			{
				return true;
			}
			if (type == 461)
			{
				float collisionPoint6 = 0f;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 22f * scale, ref collisionPoint6))
				{
					return true;
				}
				return false;
			}
			if (type == 697 || type == 707)
			{
				float f5 = rotation - MathF.PI / 4f * (float)Math.Sign(velocity.X);
				float collisionPoint7 = 0f;
				float num16 = 50f;
				if (type == 697)
				{
					num16 = 65f;
				}
				if (type == 707)
				{
					num16 = 110f;
				}
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center + f5.ToRotationVector2() * (0f - num16), base.Center + f5.ToRotationVector2() * num16, 23f * scale, ref collisionPoint7))
				{
					return true;
				}
				return false;
			}
			if (type == 699)
			{
				float f6 = rotation - MathF.PI / 4f * (float)Math.Sign(velocity.X) + ((spriteDirection == -1) ? MathF.PI : 0f);
				float collisionPoint8 = 0f;
				float num17 = -95f;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + f6.ToRotationVector2() * num17, 23f * scale, ref collisionPoint8))
				{
					return true;
				}
				return false;
			}
			if (type == 642)
			{
				float collisionPoint9 = 0f;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 30f * scale, ref collisionPoint9))
				{
					return true;
				}
				return false;
			}
			if (type == 802 || type == 842 || type == 938 || type == 939 || type == 940 || type == 941 || type == 942 || type == 943 || type == 944 || type == 945)
			{
				float collisionPoint10 = 0f;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * 6f, 10f * scale, ref collisionPoint10))
				{
					return true;
				}
				return false;
			}
			if (type == 632)
			{
				float collisionPoint11 = 0f;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 22f * scale, ref collisionPoint11))
				{
					return true;
				}
				return false;
			}
			if (type == 455)
			{
				float collisionPoint12 = 0f;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 36f * scale, ref collisionPoint12))
				{
					return true;
				}
				return false;
			}
			if (type == 611)
			{
				float collisionPoint13 = 0f;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity + velocity.SafeNormalize(Vector2.Zero) * 48f, 16f * scale, ref collisionPoint13))
				{
					return true;
				}
				return false;
			}
			if (type == 684)
			{
				float collisionPoint14 = 0f;
				Vector2 vector10 = velocity.SafeNormalize(Vector2.UnitY).RotatedBy(-1.5707963705062866) * scale;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center - vector10 * 40f, base.Center + vector10 * 40f, 16f * scale, ref collisionPoint14))
				{
					return true;
				}
				return false;
			}
			if (type == 537)
			{
				float collisionPoint15 = 0f;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity * localAI[1], 22f * scale, ref collisionPoint15))
				{
					return true;
				}
				return false;
			}
			if (type == 756 || type == 961)
			{
				float collisionPoint16 = 0f;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), base.Center, base.Center + velocity.SafeNormalize(-Vector2.UnitY) * 200f * scale, 22f * scale, ref collisionPoint16))
				{
					return true;
				}
				return false;
			}
			if (type == 687)
			{
				float collisionPoint17 = 0f;
				float num18 = ai[0] / 25f;
				if (num18 > 1f)
				{
					num18 = 1f;
				}
				float num19 = (ai[0] - 38f) / 40f;
				if (num19 < 0f)
				{
					num19 = 0f;
				}
				Vector2 lineStart = base.Center + rotation.ToRotationVector2() * 400f * num19;
				Vector2 lineEnd = base.Center + rotation.ToRotationVector2() * 400f * num18;
				if (Collision.CheckAABBvLineCollision(targetRect.TopLeft(), targetRect.Size(), lineStart, lineEnd, 40f * scale, ref collisionPoint17))
				{
					return true;
				}
				return false;
			}
			if (type == 466 || type == 580 || type == 686)
			{
				for (int n = 0; n < oldPos.Length && (oldPos[n].X != 0f || oldPos[n].Y != 0f); n++)
				{
					myRect.X = (int)oldPos[n].X;
					myRect.Y = (int)oldPos[n].Y;
					if (myRect.Intersects(targetRect))
					{
						return true;
					}
				}
				return false;
			}
			if (type == 711)
			{
				if (penetrate != -1)
				{
					for (int num20 = 0; num20 < oldPos.Length && (oldPos[num20].X != 0f || oldPos[num20].Y != 0f); num20++)
					{
						myRect.X = (int)oldPos[num20].X;
						myRect.Y = (int)oldPos[num20].Y;
						if (myRect.Intersects(targetRect))
						{
							return true;
						}
					}
				}
			}
			else if (type == 464 && ai[1] != 1f)
			{
				Vector2 vector11 = new Vector2(0f, -720f).RotatedBy(velocity.ToRotation());
				float num21 = ai[0] % 45f / 45f;
				Vector2 spinningpoint = vector11 * num21;
				for (int num22 = 0; num22 < 6; num22++)
				{
					float num23 = (float)num22 * (MathF.PI * 2f) / 6f;
					if (Utils.CenteredRectangle(base.Center + spinningpoint.RotatedBy(num23), new Vector2(30f, 30f)).Intersects(targetRect))
					{
						return true;
					}
				}
			}
			return false;
		}

		public void ProjLight()
		{
			if (!(light > 0f))
			{
				return;
			}
			float num = light;
			float num2 = light;
			float num3 = light;
			switch (type)
			{
			case 987:
				num *= 0.6f;
				num2 *= 0.5f;
				num3 *= 0.1f;
				break;
			case 988:
				num *= 0.8f;
				num2 *= 0.35f;
				num3 *= 0f;
				break;
			case 989:
				num *= 0f;
				num2 *= 0.65f;
				num3 *= 0f;
				break;
			case 990:
				num *= 0f;
				num2 *= 0.35f;
				num3 *= 0.7f;
				break;
			case 991:
				num *= 0.9f;
				num2 *= 0f;
				num3 *= 0.5f;
				break;
			case 992:
				num *= 0.75f;
				num2 *= 0f;
				num3 *= 0.75f;
				break;
			case 993:
				num *= (float)Main.DiscoR / 255f;
				num2 *= (float)Main.DiscoG / 255f;
				num3 *= (float)Main.DiscoB / 255f;
				break;
			}
			if (type == 446)
			{
				num *= 0f;
				num3 *= 0.8f;
			}
			else if (type == 493 || type == 494)
			{
				num2 *= 0.3f;
			}
			else if (type == 876)
			{
				num *= 0.1f;
				num2 *= 0.7f;
				num3 *= 1f;
			}
			else if (type == 867)
			{
				float num4 = (float)Main.rand.Next(28, 42) * 0.005f;
				num4 += (float)(270 - Main.mouseTextColor) / 500f;
				num = 0.1f;
				num2 = 0.3f + num4 / 2f;
				num3 = 0.6f + num4;
			}
			else if (type == 1000)
			{
				float num5 = (float)Main.rand.Next(28, 42) * 0.005f;
				num5 += (float)(270 - Main.mouseTextColor) / 500f;
				num = 0.3f + num5 * 0.25f;
				num2 = 0.35f + num5 * 0.75f;
				num3 = 0.5f + num5;
			}
			else if (type == 332)
			{
				num3 *= 0.1f;
				num2 *= 0.6f;
			}
			else if (type == 259)
			{
				num3 *= 0.1f;
				if (Main.getGoodWorld)
				{
					num = 0f;
					num2 = 0f;
					num3 = 0f;
				}
			}
			else if (type == 329)
			{
				num3 *= 0.1f;
				num2 *= 0.9f;
			}
			else if (type == 2 || type == 82)
			{
				num2 *= 0.75f;
				num3 *= 0.55f;
			}
			else if (type == 172)
			{
				num2 *= 0.55f;
				num *= 0.35f;
			}
			else if (type == 308)
			{
				num2 *= 0.7f;
				num *= 0.1f;
			}
			else if (type == 304)
			{
				num2 *= 0.2f;
				num3 *= 0.1f;
			}
			else if (type == 263)
			{
				num2 *= 0.7f;
				num *= 0.1f;
			}
			else if (type == 274)
			{
				num2 *= 0.1f;
				num *= 0.7f;
			}
			else if (type == 254)
			{
				num *= 0.1f;
			}
			else if (type == 94)
			{
				num *= 0.5f;
				num2 *= 0f;
			}
			else if (type == 95 || type == 96 || type == 103 || type == 104)
			{
				num *= 0.35f;
				num2 *= 1f;
				num3 *= 0f;
			}
			else if (type == 4)
			{
				num2 *= 0.1f;
				num *= 0.5f;
			}
			else if (type == 257)
			{
				num2 *= 0.9f;
				num *= 0.1f;
			}
			else if (type == 9)
			{
				num2 *= 0.1f;
				num3 *= 0.6f;
			}
			else if (type == 488)
			{
				num = 0.3f;
				num3 = 0.25f;
				num2 = 0f;
			}
			else if (type == 92)
			{
				num2 *= 0.6f;
				num *= 0.8f;
			}
			else if (type == 93)
			{
				num2 *= 1f;
				num *= 1f;
				num3 *= 0.01f;
			}
			else if (type == 12 || type == 955)
			{
				num *= 0.9f;
				num2 *= 0.8f;
				num3 *= 0.1f;
			}
			else if (type == 14 || type == 110 || type == 180 || type == 242 || type == 302)
			{
				num2 *= 0.7f;
				num3 *= 0.1f;
			}
			else if (type == 981)
			{
				num2 *= 0.7f;
				num3 *= 0.7f;
			}
			else if (type == 15)
			{
				num2 *= 0.4f;
				num3 *= 0.1f;
				num = 1f;
			}
			else if (type == 16)
			{
				num *= 0.1f;
				num2 *= 0.4f;
				num3 = 1f;
			}
			else if (type == 18)
			{
				num2 *= 0.1f;
				num *= 0.6f;
			}
			else if (type == 19)
			{
				num2 *= 0.5f;
				num3 *= 0.1f;
			}
			else if (type == 20)
			{
				num *= 0.1f;
				num3 *= 0.3f;
			}
			else if (type == 22)
			{
				num = 0f;
				num2 = 0f;
			}
			else if (type == 27)
			{
				num *= 0f;
				num2 *= 0.3f;
				num3 = 1f;
			}
			else if (type == 34)
			{
				num2 *= 0.1f;
				num3 *= 0.1f;
			}
			else if (type == 36)
			{
				num = 0.8f;
				num2 *= 0.2f;
				num3 *= 0.6f;
			}
			else if (type == 41)
			{
				num2 *= 0.8f;
				num3 *= 0.6f;
			}
			else if (type == 44 || type == 45)
			{
				num3 = 1f;
				num *= 0.6f;
				num2 *= 0.1f;
			}
			else if (type == 50)
			{
				num *= 0.7f;
				num3 *= 0.8f;
			}
			else if (type == 515)
			{
				num2 *= 0.6f;
				num3 *= 0.85f;
			}
			else if (type == 870)
			{
				num *= 0.9f;
				num2 = 0.35f;
			}
			else if (type == 53)
			{
				num *= 0.7f;
				num2 *= 0.8f;
			}
			else if (type == 473)
			{
				num *= 1.05f;
				num2 *= 0.95f;
				num3 *= 0.55f;
			}
			else if (type == 72)
			{
				num *= 0.45f;
				num2 *= 0.75f;
				num3 = 1f;
			}
			else if (type == 86)
			{
				num *= 1f;
				num2 *= 0.45f;
				num3 = 0.75f;
			}
			else if (type == 87)
			{
				num *= 0.45f;
				num2 = 1f;
				num3 *= 0.75f;
			}
			else if (type == 73)
			{
				num *= 0.4f;
				num2 *= 0.6f;
				num3 *= 1f;
			}
			else if (type == 74)
			{
				num *= 1f;
				num2 *= 0.4f;
				num3 *= 0.6f;
			}
			else if (type == 284)
			{
				num *= 1f;
				num2 *= 0.1f;
				num3 *= 0.8f;
			}
			else if (type == 285)
			{
				num *= 0.1f;
				num2 *= 0.5f;
				num3 *= 1f;
			}
			else if (type == 286)
			{
				num *= 1f;
				num2 *= 0.5f;
				num3 *= 0.1f;
			}
			else if (type == 287)
			{
				num *= 0.9f;
				num2 *= 1f;
				num3 *= 0.4f;
			}
			else if (type == 283)
			{
				num *= 0.8f;
				num2 *= 0.1f;
			}
			else if (type == 76 || type == 77 || type == 78)
			{
				num *= 1f;
				num2 *= 0.3f;
				num3 *= 0.6f;
			}
			else if (type == 79)
			{
				num = (float)Main.DiscoR / 255f;
				num2 = (float)Main.DiscoG / 255f;
				num3 = (float)Main.DiscoB / 255f;
			}
			else if (type == 80)
			{
				num *= 0f;
				num2 *= 0.8f;
				num3 *= 1f;
			}
			else if (type == 83 || type == 88)
			{
				num *= 0.7f;
				num2 *= 0f;
				num3 *= 1f;
			}
			else if (type == 100)
			{
				num *= 1f;
				num2 *= 0.5f;
				num3 *= 0f;
			}
			else if (type == 84 || type == 389)
			{
				num *= 0.8f;
				num2 *= 0f;
				num3 *= 0.5f;
			}
			else if (type == 89 || type == 90)
			{
				num2 *= 0.2f;
				num3 *= 1f;
				num *= 0.05f;
			}
			else if (type == 106)
			{
				num *= 0f;
				num2 *= 0.5f;
				num3 *= 1f;
			}
			else if (type == 113)
			{
				num *= 0.25f;
				num2 *= 0.75f;
				num3 *= 1f;
			}
			else if (type == 114 || type == 115)
			{
				num *= 0.5f;
				num2 *= 0.05f;
				num3 *= 1f;
			}
			else if (type == 116)
			{
				num3 *= 0.25f;
			}
			else if (type == 131)
			{
				num *= 0.1f;
				num2 *= 0.4f;
			}
			else if (type == 132 || type == 157)
			{
				num *= 0.2f;
				num3 *= 0.6f;
			}
			else if (type == 156)
			{
				num *= 1f;
				num3 *= 0.6f;
				num2 = 0f;
			}
			else if (type == 173)
			{
				num *= 0.3f;
				num3 *= 1f;
				num2 = 0.4f;
			}
			else if (type == 207)
			{
				num *= 0.4f;
				num3 *= 0.4f;
			}
			else if (type == 253)
			{
				num = 0f;
				num2 *= 0.4f;
			}
			else if (type == 211)
			{
				num *= 0.5f;
				num2 *= 0.9f;
				num3 *= 1f;
				if (localAI[0] == 0f)
				{
					light = 1.5f;
				}
				else
				{
					light = 1f;
				}
			}
			else if (type == 209)
			{
				float num6 = (255f - (float)alpha) / 255f;
				num *= 0.3f;
				num2 *= 0.4f;
				num3 *= 1.75f;
				num3 *= num6;
				num *= num6;
				num2 *= num6;
			}
			else if (type == 226 || ((type == 221) | (type == 229)))
			{
				num *= 0.25f;
				num2 *= 1f;
				num3 *= 0.5f;
			}
			else if (type == 251)
			{
				num = (float)Main.DiscoR / 255f;
				num2 = (float)Main.DiscoG / 255f;
				num3 = (float)Main.DiscoB / 255f;
				num = (num + 1f) / 2f;
				num2 = (num2 + 1f) / 2f;
				num3 = (num3 + 1f) / 2f;
				num *= light;
				num2 *= light;
				num3 *= light;
			}
			else if (type == 278 || type == 279)
			{
				num *= 1f;
				num2 *= 1f;
				num3 *= 0f;
			}
			if (type == 870)
			{
				Vector3 rgb = (DelegateMethods.v3_1 = new Vector3(num, num2, num3));
				Point p = base.Center.ToTileCoordinates();
				DelegateMethods.v2_1 = p.ToVector2();
				DelegateMethods.f_1 = 4.5f;
				Utils.PlotTileArea(p.X, p.Y, DelegateMethods.SpreadLightOpen_StopForSolids);
				Lighting.AddLight(base.Center, rgb);
			}
			else
			{
				Lighting.AddLight((int)((position.X + (float)(width / 2)) / 16f), (int)((position.Y + (float)(height / 2)) / 16f), num, num2, num3);
			}
		}

		public Rectangle getRect()
		{
			return new Rectangle((int)position.X, (int)position.Y, width, height);
		}

		public void Update(int i)
		{
			if (!active)
			{
				return;
			}
			if (Main.netMode == 1 && (ProjectileID.Sets.IsAGolfBall[type] || type == 820))
			{
				int num = (int)(position.X + (float)(width / 2)) / 16;
				int num2 = (int)(position.Y + (float)(height / 2)) / 16;
				if (Main.tile[num, num2] == null)
				{
					return;
				}
			}
			numUpdates = extraUpdates;
			while (numUpdates >= 0)
			{
				numUpdates--;
				if (type == 640 && ai[1] > 0f)
				{
					ai[1] -= 1f;
					continue;
				}
				if (position.X <= Main.leftWorld || position.X + (float)width >= Main.rightWorld || position.Y <= Main.topWorld || position.Y + (float)height >= Main.bottomWorld)
				{
					active = false;
					return;
				}
				if (!noEnchantmentVisuals)
				{
					UpdateEnchantmentVisuals();
				}
				if (numUpdates == -1 && (minion || sentry))
				{
					Player player = Main.player[owner];
					damage = (int)((float)originalDamage * player.minionDamage + 5E-06f);
				}
				if (minion && numUpdates == -1 && type != 625 && type != 628)
				{
					minionPos = Main.player[owner].numMinions;
					if (Main.player[owner].slotsMinions + minionSlots > (float)Main.player[owner].maxMinions && owner == Main.myPlayer)
					{
						if ((type == 627 || type == 626) && owner == Main.myPlayer)
						{
							int byUUID = GetByUUID(owner, ai[0]);
							if (byUUID != -1)
							{
								Projectile projectile = Main.projectile[byUUID];
								if (projectile.type != 625)
								{
									projectile.localAI[1] = localAI[1];
								}
								projectile = Main.projectile[(int)localAI[1]];
								projectile.ai[0] = ai[0];
								projectile.ai[1] = 1f;
								projectile.netUpdate = true;
							}
						}
						Kill();
					}
					else
					{
						Main.player[owner].numMinions++;
						Main.player[owner].slotsMinions += minionSlots;
					}
				}
				float num3 = 1f + Math.Abs(velocity.X) / 3f;
				if (gfxOffY > 0f)
				{
					gfxOffY -= num3 * stepSpeed;
					if (gfxOffY < 0f)
					{
						gfxOffY = 0f;
					}
				}
				else if (gfxOffY < 0f)
				{
					gfxOffY += num3 * stepSpeed;
					if (gfxOffY > 0f)
					{
						gfxOffY = 0f;
					}
				}
				if (gfxOffY > 16f)
				{
					gfxOffY = 16f;
				}
				if (gfxOffY < -16f)
				{
					gfxOffY = -16f;
				}
				Vector2 wetVelocity = velocity;
				oldVelocity = velocity;
				whoAmI = i;
				if (soundDelay > 0)
				{
					soundDelay--;
				}
				netUpdate = false;
				for (int j = 0; j < 255; j++)
				{
					if (playerImmune[j] > 0)
					{
						playerImmune[j]--;
					}
				}
				if (usesLocalNPCImmunity)
				{
					for (int k = 0; k < 200; k++)
					{
						if (localNPCImmunity[k] > 0)
						{
							localNPCImmunity[k]--;
						}
					}
				}
				AI();
				if (ShouldUseWindPhysics() && (double)base.Center.Y < Main.worldSurface * 16.0 && Main.tile[(int)base.Center.X / 16, (int)base.Center.Y / 16] != null && Main.tile[(int)base.Center.X / 16, (int)base.Center.Y / 16].wall == 0 && ((velocity.X > 0f && Main.windSpeedCurrent < 0f) || (velocity.X < 0f && Main.windSpeedCurrent > 0f) || Math.Abs(velocity.X) < Math.Abs(Main.windSpeedCurrent * Main.windPhysicsStrength) * 180f) && Math.Abs(velocity.X) < 16f)
				{
					velocity.X += Main.windSpeedCurrent * Main.windPhysicsStrength;
					MathHelper.Clamp(velocity.X, -16f, 16f);
				}
				if (owner < 255 && !Main.player[owner].active)
				{
					Kill();
				}
				if (type == 242 || type == 302 || type == 638)
				{
					wet = false;
				}
				if (!ignoreWater)
				{
					bool flag;
					bool flag2;
					try
					{
						flag = Collision.LavaCollision(position, width, height);
						flag2 = Collision.WetCollision(position, width, height);
						if (flag)
						{
							lavaWet = true;
						}
						if (Collision.honey)
						{
							honeyWet = true;
						}
						if (Collision.shimmer)
						{
							shimmerWet = true;
						}
					}
					catch
					{
						active = false;
						return;
					}
					if (wet && !lavaWet)
					{
						if (type == 85 || type == 15 || type == 188)
						{
							Kill();
						}
						if (type == 2)
						{
							type = 1;
							light = 0f;
						}
					}
					if (type == 34)
					{
						if (wet && !lavaWet)
						{
							Kill();
						}
						if (lavaWet)
						{
							flag2 = (wet = (lavaWet = false));
						}
					}
					if (type == 80)
					{
						flag2 = false;
						wet = false;
						if (flag && ai[0] >= 0f)
						{
							Kill();
						}
					}
					if (flag2)
					{
						if (type != 155 && wetCount == 0 && !wet)
						{
							if (!flag)
							{
								if (shimmerWet)
								{
									for (int l = 0; l < 10; l++)
									{
										int num4 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 308);
										Main.dust[num4].velocity.Y -= 4f;
										Main.dust[num4].velocity.X *= 2.5f;
										Main.dust[num4].scale = 1.3f;
										Main.dust[num4].noGravity = true;
										switch (Main.rand.Next(6))
										{
										case 0:
											Main.dust[num4].color = new Color(255, 255, 210);
											break;
										case 1:
											Main.dust[num4].color = new Color(190, 245, 255);
											break;
										case 2:
											Main.dust[num4].color = new Color(255, 150, 255);
											break;
										default:
											Main.dust[num4].color = new Color(190, 175, 255);
											break;
										}
										SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 4);
									}
								}
								else if (honeyWet)
								{
									for (int m = 0; m < 10; m++)
									{
										int num5 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 152);
										Main.dust[num5].velocity.Y -= 1f;
										Main.dust[num5].velocity.X *= 2.5f;
										Main.dust[num5].scale = 1.3f;
										Main.dust[num5].alpha = 100;
										Main.dust[num5].noGravity = true;
									}
									SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
								}
								else
								{
									for (int n = 0; n < 10; n++)
									{
										int num6 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, Dust.dustWater());
										Main.dust[num6].velocity.Y -= 4f;
										Main.dust[num6].velocity.X *= 2.5f;
										Main.dust[num6].scale = 1.3f;
										Main.dust[num6].alpha = 100;
										Main.dust[num6].noGravity = true;
									}
									SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
								}
							}
							else
							{
								for (int num7 = 0; num7 < 10; num7++)
								{
									int num8 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 35);
									Main.dust[num8].velocity.Y -= 1.5f;
									Main.dust[num8].velocity.X *= 2.5f;
									Main.dust[num8].scale = 1.3f;
									Main.dust[num8].alpha = 100;
									Main.dust[num8].noGravity = true;
								}
								SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
							}
						}
						wet = true;
					}
					else if (wet)
					{
						wet = false;
						if (type == 155)
						{
							velocity.Y *= 0.5f;
						}
						else if (wetCount == 0)
						{
							wetCount = 10;
							if (!lavaWet)
							{
								if (shimmerWet)
								{
									for (int num9 = 0; num9 < 10; num9++)
									{
										int num10 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 308);
										Main.dust[num10].velocity.Y -= 4f;
										Main.dust[num10].velocity.X *= 2.5f;
										Main.dust[num10].scale = 1.3f;
										Main.dust[num10].noGravity = true;
										switch (Main.rand.Next(6))
										{
										case 0:
											Main.dust[num10].color = new Color(255, 255, 210);
											break;
										case 1:
											Main.dust[num10].color = new Color(190, 245, 255);
											break;
										case 2:
											Main.dust[num10].color = new Color(255, 150, 255);
											break;
										default:
											Main.dust[num10].color = new Color(190, 175, 255);
											break;
										}
										SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 5);
									}
								}
								else if (honeyWet)
								{
									for (int num11 = 0; num11 < 10; num11++)
									{
										int num12 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 152);
										Main.dust[num12].velocity.Y -= 1f;
										Main.dust[num12].velocity.X *= 2.5f;
										Main.dust[num12].scale = 1.3f;
										Main.dust[num12].alpha = 100;
										Main.dust[num12].noGravity = true;
									}
									SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
								}
								else
								{
									for (int num13 = 0; num13 < 10; num13++)
									{
										int num14 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2)), width + 12, 24, Dust.dustWater());
										Main.dust[num14].velocity.Y -= 4f;
										Main.dust[num14].velocity.X *= 2.5f;
										Main.dust[num14].scale = 1.3f;
										Main.dust[num14].alpha = 100;
										Main.dust[num14].noGravity = true;
									}
									SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
								}
							}
							else
							{
								for (int num15 = 0; num15 < 10; num15++)
								{
									int num16 = Dust.NewDust(new Vector2(position.X - 6f, position.Y + (float)(height / 2) - 8f), width + 12, 24, 35);
									Main.dust[num16].velocity.Y -= 1.5f;
									Main.dust[num16].velocity.X *= 2.5f;
									Main.dust[num16].scale = 1.3f;
									Main.dust[num16].alpha = 100;
									Main.dust[num16].noGravity = true;
								}
								SoundEngine.PlaySound(19, (int)position.X, (int)position.Y);
							}
						}
					}
					if (!wet)
					{
						lavaWet = false;
						honeyWet = false;
						shimmerWet = false;
					}
					if (wetCount > 0)
					{
						wetCount--;
					}
				}
				if (shimmerWet)
				{
					Shimmer();
				}
				oldPosition = position;
				oldDirection = direction;
				HandleMovement(wetVelocity, out var _, out var _);
				if (AutomaticallyChangesDirection())
				{
					if (velocity.X < 0f)
					{
						direction = -1;
					}
					else
					{
						direction = 1;
					}
				}
				if (!active)
				{
					return;
				}
				ProjLight();
				if (!npcProj && friendly && Main.player[owner].magicQuiver && extraUpdates < 1 && arrow)
				{
					extraUpdates = 1;
				}
				if (type == 2 || type == 82)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100);
				}
				else if (type == 172)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, 0f, 0f, 100);
				}
				else if (type == 103)
				{
					int num17 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 75, 0f, 0f, 100);
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num17].noGravity = true;
						Main.dust[num17].scale *= 2f;
					}
				}
				else if (type == 278)
				{
					int num18 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 169, 0f, 0f, 100);
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num18].noGravity = true;
						Main.dust[num18].scale *= 1.5f;
					}
				}
				else if (type == 4)
				{
					if (Main.rand.Next(5) == 0)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 14, 0f, 0f, 150, default(Color), 1.1f);
					}
				}
				else if (type == 5)
				{
					int num19 = Main.rand.Next(3);
					Dust.NewDust(position, width, height, num19 switch
					{
						0 => 15, 
						1 => 57, 
						_ => 58, 
					}, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.2f);
				}
				Damage();
				if (type == 434 && localAI[0] == 0f && numUpdates == 0)
				{
					extraUpdates = 1;
					velocity = Vector2.Zero;
					localAI[0] = 1f;
					localAI[1] = 0.9999f;
					netUpdate = true;
				}
				if (Main.netMode != 1 && (type == 99 || type == 1013 || type == 655 || type == 727 || type == 1014 || type == 1021))
				{
					Collision.SwitchTiles(position, width, height, oldPosition, 3);
				}
				if (ProjectileID.Sets.TrailingMode[type] == 0)
				{
					for (int num20 = oldPos.Length - 1; num20 > 0; num20--)
					{
						oldPos[num20] = oldPos[num20 - 1];
					}
					oldPos[0] = position;
				}
				else if (ProjectileID.Sets.TrailingMode[type] == 1)
				{
					if (frameCounter == 0 || oldPos[0] == Vector2.Zero)
					{
						for (int num21 = oldPos.Length - 1; num21 > 0; num21--)
						{
							oldPos[num21] = oldPos[num21 - 1];
						}
						oldPos[0] = position;
						if (velocity == Vector2.Zero && type == 466)
						{
							float num22 = rotation + MathF.PI / 2f + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
							float num23 = (float)Main.rand.NextDouble() * 2f + 2f;
							Vector2 vector = new Vector2((float)Math.Cos(num22) * num23, (float)Math.Sin(num22) * num23);
							int num24 = Dust.NewDust(oldPos[oldPos.Length - 1], 0, 0, 229, vector.X, vector.Y);
							Main.dust[num24].noGravity = true;
							Main.dust[num24].scale = 1.7f;
						}
						if (velocity == Vector2.Zero && type == 580)
						{
							float num25 = rotation + MathF.PI / 2f + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
							float num26 = (float)Main.rand.NextDouble() * 2f + 2f;
							Vector2 vector2 = new Vector2((float)Math.Cos(num25) * num26, (float)Math.Sin(num25) * num26);
							int num27 = Dust.NewDust(oldPos[oldPos.Length - 1], 0, 0, 229, vector2.X, vector2.Y);
							Main.dust[num27].noGravity = true;
							Main.dust[num27].scale = 1.7f;
						}
					}
				}
				else if (ProjectileID.Sets.TrailingMode[type] == 2)
				{
					for (int num28 = oldPos.Length - 1; num28 > 0; num28--)
					{
						oldPos[num28] = oldPos[num28 - 1];
						oldRot[num28] = oldRot[num28 - 1];
						oldSpriteDirection[num28] = oldSpriteDirection[num28 - 1];
					}
					oldPos[0] = position;
					oldRot[0] = rotation;
					oldSpriteDirection[0] = spriteDirection;
				}
				else if (ProjectileID.Sets.TrailingMode[type] == 3)
				{
					for (int num29 = oldPos.Length - 1; num29 > 0; num29--)
					{
						oldPos[num29] = oldPos[num29 - 1];
						oldRot[num29] = oldRot[num29 - 1];
						oldSpriteDirection[num29] = oldSpriteDirection[num29 - 1];
					}
					oldPos[0] = position;
					oldRot[0] = rotation;
					oldSpriteDirection[0] = spriteDirection;
					float amount = 0.65f;
					int num30 = 1;
					for (int num31 = 0; num31 < num30; num31++)
					{
						for (int num32 = oldPos.Length - 1; num32 > 0; num32--)
						{
							if (!(oldPos[num32] == Vector2.Zero))
							{
								if (oldPos[num32].Distance(oldPos[num32 - 1]) > 2f)
								{
									oldPos[num32] = Vector2.Lerp(oldPos[num32], oldPos[num32 - 1], amount);
								}
								oldRot[num32] = (oldPos[num32 - 1] - oldPos[num32]).SafeNormalize(Vector2.Zero).ToRotation();
							}
						}
					}
				}
				else if (ProjectileID.Sets.TrailingMode[type] == 4)
				{
					Vector2 vector3 = Main.player[owner].position - Main.player[owner].oldPosition;
					for (int num33 = oldPos.Length - 1; num33 > 0; num33--)
					{
						oldPos[num33] = oldPos[num33 - 1];
						oldRot[num33] = oldRot[num33 - 1];
						oldSpriteDirection[num33] = oldSpriteDirection[num33 - 1];
						if (numUpdates == 0 && oldPos[num33] != Vector2.Zero)
						{
							oldPos[num33] += vector3;
						}
					}
					oldPos[0] = position;
					oldRot[0] = rotation;
					oldSpriteDirection[0] = spriteDirection;
				}
				else if (ProjectileID.Sets.TrailingMode[type] == 5)
				{
					for (int num34 = oldPos.Length - 1; num34 > 0; num34--)
					{
						oldPos[num34] = oldPos[num34 - 1];
						oldRot[num34] = oldRot[num34 - 1];
						oldSpriteDirection[num34] = oldSpriteDirection[num34 - 1];
					}
					oldPos[0] = position;
					oldRot[0] = velocity.ToRotation();
					oldSpriteDirection[0] = spriteDirection;
				}
				if (ProjectileID.Sets.IsADD2Turret[type] && DD2Event.Ongoing)
				{
					timeLeft++;
				}
				timeLeft--;
				if (timeLeft <= 0)
				{
					Kill();
				}
				if (penetrate == 0)
				{
					Kill();
				}
				if (!active || owner != Main.myPlayer)
				{
					continue;
				}
				if (netUpdate2)
				{
					netUpdate = true;
				}
				if (!active)
				{
					netSpam = 0;
				}
				if (netUpdate)
				{
					if (netSpam < 60)
					{
						netSpam += 5;
						NetMessage.SendData(27, -1, -1, null, i);
						netUpdate2 = false;
					}
					else
					{
						netUpdate2 = true;
					}
				}
				if (netSpam > 0)
				{
					netSpam--;
				}
			}
			netUpdate = false;
		}

		private bool AutomaticallyChangesDirection()
		{
			if ((aiStyle != 3 || ai[0] != 1f) && (aiStyle != 7 || ai[0] != 1f) && (aiStyle != 13 || ai[0] != 1f) && aiStyle != 65 && aiStyle != 69 && aiStyle != 114 && aiStyle != 123 && aiStyle != 112 && !manualDirectionChange && aiStyle != 67 && aiStyle != 26 && aiStyle != 15)
			{
				return aiStyle != 150;
			}
			return false;
		}

		private void UpdateEnchantmentVisuals()
		{
			if (npcProj)
			{
				return;
			}
			Vector2 boxPosition = position;
			int boxWidth = width;
			int boxHeight = height;
			if (aiStyle == 190 || aiStyle == 191)
			{
				for (float num = -MathF.PI / 4f; num <= MathF.PI / 4f; num += MathF.PI / 2f)
				{
					Rectangle r = Utils.CenteredRectangle(base.Center + (rotation + num).ToRotationVector2() * 70f * scale, new Vector2(60f * scale, 60f * scale));
					EmitEnchantmentVisualsAt(r.TopLeft(), r.Width, r.Height);
				}
			}
			else
			{
				EmitEnchantmentVisualsAt(boxPosition, boxWidth, boxHeight);
			}
		}

		public void EmitEnchantmentVisualsAt(Vector2 boxPosition, int boxWidth, int boxHeight)
		{
			Player player = Main.player[owner];
			if (player.frostBurn && (melee || ranged) && friendly && !hostile && !noEnchantments && Main.rand.Next(2 * (1 + extraUpdates)) == 0)
			{
				int num = Dust.NewDust(boxPosition, boxWidth, boxHeight, 135, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 2f);
				Main.dust[num].noGravity = true;
				Main.dust[num].velocity *= 0.7f;
				Main.dust[num].velocity.Y -= 0.5f;
			}
			if (melee && player.magmaStone && !noEnchantments && Main.rand.Next(3) != 0)
			{
				int num2 = Dust.NewDust(new Vector2(boxPosition.X - 4f, boxPosition.Y - 4f), boxWidth + 8, boxHeight + 8, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
				if (Main.rand.Next(2) == 0)
				{
					Main.dust[num2].scale = 1.5f;
				}
				Main.dust[num2].noGravity = true;
				Main.dust[num2].velocity.X *= 2f;
				Main.dust[num2].velocity.Y *= 2f;
			}
			if (!melee || player.meleeEnchant <= 0 || noEnchantments)
			{
				return;
			}
			if (player.meleeEnchant == 1 && Main.rand.Next(3) == 0)
			{
				int num3 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 171, 0f, 0f, 100);
				Main.dust[num3].noGravity = true;
				Main.dust[num3].fadeIn = 1.5f;
				Main.dust[num3].velocity *= 0.25f;
			}
			if (player.meleeEnchant == 1)
			{
				if (Main.rand.Next(3) == 0)
				{
					int num4 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 171, 0f, 0f, 100);
					Main.dust[num4].noGravity = true;
					Main.dust[num4].fadeIn = 1.5f;
					Main.dust[num4].velocity *= 0.25f;
				}
			}
			else if (player.meleeEnchant == 2)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num5 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 75, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 2.5f);
					Main.dust[num5].noGravity = true;
					Main.dust[num5].velocity *= 0.7f;
					Main.dust[num5].velocity.Y -= 0.5f;
				}
			}
			else if (player.meleeEnchant == 3)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num6 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 6, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 2.5f);
					Main.dust[num6].noGravity = true;
					Main.dust[num6].velocity *= 0.7f;
					Main.dust[num6].velocity.Y -= 0.5f;
				}
			}
			else if (player.meleeEnchant == 4)
			{
				int num7 = 0;
				if (Main.rand.Next(2) == 0)
				{
					num7 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 57, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 1.1f);
					Main.dust[num7].noGravity = true;
					Main.dust[num7].velocity.X /= 2f;
					Main.dust[num7].velocity.Y /= 2f;
				}
			}
			else if (player.meleeEnchant == 5)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num8 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 169, 0f, 0f, 100);
					Main.dust[num8].velocity.X += direction;
					Main.dust[num8].velocity.Y += 0.2f;
					Main.dust[num8].noGravity = true;
				}
			}
			else if (player.meleeEnchant == 6)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num9 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 135, 0f, 0f, 100);
					Main.dust[num9].velocity.X += direction;
					Main.dust[num9].velocity.Y += 0.2f;
					Main.dust[num9].noGravity = true;
				}
			}
			else if (player.meleeEnchant == 7)
			{
				Vector2 vector = velocity;
				if (vector.Length() > 4f)
				{
					vector *= 4f / vector.Length();
				}
				if (Main.rand.Next(20) == 0)
				{
					int num10 = Main.rand.Next(139, 143);
					int num11 = Dust.NewDust(boxPosition, boxWidth, boxHeight, num10, vector.X, vector.Y, 0, default(Color), 1.2f);
					Main.dust[num11].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num11].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num11].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
					Main.dust[num11].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
					Main.dust[num11].scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
				}
				if (Main.rand.Next(40) == 0)
				{
					int num12 = Main.rand.Next(276, 283);
					int num13 = Gore.NewGore(position, vector, num12);
					Main.gore[num13].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.gore[num13].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.gore[num13].scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
					Main.gore[num13].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
					Main.gore[num13].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
				}
			}
			else if (player.meleeEnchant == 8 && Main.rand.Next(4) == 0)
			{
				int num14 = Dust.NewDust(boxPosition, boxWidth, boxHeight, 46, 0f, 0f, 100);
				Main.dust[num14].noGravity = true;
				Main.dust[num14].fadeIn = 1.5f;
				Main.dust[num14].velocity *= 0.25f;
			}
		}

		private void HandleMovement(Vector2 wetVelocity, out int overrideWidth, out int overrideHeight)
		{
			bool flag = false;
			overrideWidth = -1;
			overrideHeight = -1;
			bool flag2 = false;
			bool? flag3 = ProjectileID.Sets.ForcePlateDetection[type];
			bool flag4 = flag3.HasValue && !flag3.Value;
			bool flag5 = flag3.HasValue && flag3.Value;
			if (tileCollide)
			{
				Vector2 lastVelocity = velocity;
				bool flag6 = true;
				Vector2? vector = null;
				if (Main.projPet[type])
				{
					flag6 = false;
					if (Main.player[owner].position.Y + (float)Main.player[owner].height - 12f > position.Y + (float)height)
					{
						flag6 = true;
					}
				}
				if (type == 500)
				{
					flag6 = false;
					if (Main.player[owner].Bottom.Y > base.Bottom.Y + 4f)
					{
						flag6 = true;
					}
				}
				if (type == 653 || type == 668)
				{
					flag6 = false;
					if (Main.player[owner].Bottom.Y > base.Bottom.Y + 4f)
					{
						flag6 = true;
					}
				}
				if (aiStyle == 62)
				{
					flag6 = true;
				}
				if (aiStyle == 66)
				{
					flag6 = true;
				}
				if (type == 317)
				{
					flag6 = true;
				}
				if (type == 373)
				{
					flag6 = true;
				}
				if (aiStyle == 53)
				{
					flag6 = false;
				}
				if (type == 9 || type == 12 || type == 15 || type == 13)
				{
					flag6 = false;
				}
				if (aiStyle == 10 && ProjectileID.Sets.FallingBlockDoesNotFallThroughPlatforms[type])
				{
					flag6 = false;
				}
				if (type == 24)
				{
					flag6 = false;
				}
				switch (type)
				{
				case 663:
				case 665:
				case 667:
				case 677:
				case 678:
				case 679:
				case 688:
				case 689:
				case 690:
				case 691:
				case 692:
				case 693:
					flag6 = false;
					break;
				case 759:
					flag6 = true;
					break;
				case 1020:
				{
					float num = MathHelper.WrapAngle(rotation);
					flag6 = num >= MathF.PI / 2f || num < -MathF.PI / 2f;
					break;
				}
				}
				if (decidesManualFallThrough)
				{
					flag6 = shouldFallThrough;
				}
				if (type == 771 || type == 822 || type == 823 || type == 843 || type == 846 || type == 845 || type == 852)
				{
					overrideWidth = width;
					overrideHeight = 34;
					vector = new Vector2(0.75f, 0.75f);
				}
				if (type == 969)
				{
					overrideWidth = 18;
					overrideHeight = 32;
				}
				if (type == 824 || type == 839 || type == 840 || type == 850 || type == 853)
				{
					overrideWidth = width;
					overrideHeight = 58;
					vector = new Vector2(0.75f, 0.75f);
				}
				if (type == 826 || type == 830 || type == 838)
				{
					overrideWidth = width;
					overrideHeight = 38;
					vector = new Vector2(0.75f, 0.75f);
				}
				if (type == 828 || type == 829 || type == 827 || type == 844)
				{
					overrideWidth = width;
					overrideHeight = 22;
					vector = new Vector2(0.75f, 0.75f);
				}
				if (aiStyle == 29 || type == 28 || aiStyle == 49 || type == 906 || type == 903 || type == 904 || type == 910)
				{
					overrideWidth = width - 8;
					overrideHeight = height - 8;
				}
				else if (type == 250 || type == 267 || type == 297 || type == 323 || type == 3 || type == 711)
				{
					overrideWidth = 6;
					overrideHeight = 6;
				}
				else if (type == 308)
				{
					overrideWidth = 26;
					overrideHeight = height;
				}
				else if (type == 663 || type == 665 || type == 667 || type == 677 || type == 678 || type == 679 || type == 691 || type == 692 || type == 693)
				{
					overrideWidth = 16;
					overrideHeight = height;
				}
				else if (type == 688 || type == 689 || type == 690)
				{
					overrideWidth = 16;
					overrideHeight = height;
					vector = new Vector2(0.5f, 1f);
				}
				else if (type == 669 || type == 706)
				{
					overrideWidth = 10;
					overrideHeight = 10;
				}
				else if (type == 261 || type == 277)
				{
					overrideWidth = 26;
					overrideHeight = 26;
				}
				else if (type == 481 || type == 491 || type == 106 || type == 262 || type == 271 || type == 270 || type == 272 || type == 273 || type == 274 || type == 280 || type == 288 || type == 301 || type == 320 || type == 333 || type == 335 || type == 343 || type == 344 || type == 497 || type == 496 || type == 6 || type == 19 || type == 113 || type == 52 || type == 520 || type == 523 || type == 585 || type == 598 || type == 599 || type == 636 || type == 837 || type == 861 || type == 867 || type == 971 || type == 975 || type == 1000)
				{
					overrideWidth = 10;
					overrideHeight = 10;
				}
				else if (type == 514)
				{
					overrideWidth = 4;
					overrideHeight = 4;
				}
				else if (type == 248 || type == 247 || type == 507 || type == 508 || type == 662 || type == 680 || type == 685 || type == 757 || type == 928)
				{
					overrideWidth = width - 12;
					overrideHeight = height - 12;
				}
				else if (aiStyle == 18 || type == 254)
				{
					overrideWidth = width - 36;
					overrideHeight = height - 36;
				}
				else if (type == 182 || type == 190 || type == 33 || type == 229 || type == 237 || type == 243 || type == 866)
				{
					overrideWidth = width - 20;
					overrideHeight = height - 20;
				}
				else if (aiStyle == 27)
				{
					overrideWidth = width - 12;
					overrideHeight = height - 12;
				}
				else if (type == 533 && ai[0] >= 6f)
				{
					overrideWidth = width + 6;
					overrideHeight = height + 6;
				}
				else if (type == 755 && ai[0] >= 0f)
				{
					overrideWidth = width + 6;
					overrideHeight = height + 6;
				}
				else if (type == 759)
				{
					if (velocity.X != lastVelocity.X)
					{
						velocity.X = 0f - lastVelocity.X;
					}
					if (velocity.Y != lastVelocity.Y)
					{
						velocity.Y = 0f - lastVelocity.Y;
					}
				}
				else if (type == 582 || type == 634 || type == 635 || type == 902)
				{
					overrideWidth = 8;
					overrideHeight = 8;
				}
				else if (type == 617)
				{
					overrideWidth = (int)(20f * scale);
					overrideHeight = (int)(20f * scale);
				}
				else if (type == 304)
				{
					overrideWidth = 4;
					overrideHeight = 4;
				}
				else if (aiStyle == 9)
				{
					overrideWidth = 4;
					overrideHeight = 4;
				}
				else if (type == 931)
				{
					overrideWidth = 4;
					overrideHeight = 4;
				}
				if (((type != 440 && type != 449 && type != 606) || ai[1] != 1f) && (type != 466 || localAI[1] != 1f) && (type != 580 || !(localAI[1] > 0f)) && (type != 640 || !(localAI[1] > 0f)))
				{
					if (aiStyle == 10)
					{
						if (type >= 736 && type <= 738)
						{
							velocity = Collision.TileCollision(position, velocity, width, height, flag6, flag6);
						}
						else if (type == 411 || type == 412 || type == 413 || type == 414)
						{
							velocity = Collision.TileCollision(position, velocity, width, height, flag6, flag6);
							velocity = Collision.AnyCollisionWithSpecificTiles(position, velocity, width, height, TileID.Sets.Falling, evenActuated: true);
						}
						else if (type == 42 || type == 65 || type == 68 || type == 354 || (type == 31 && ai[0] == 2f))
						{
							velocity = Collision.TileCollision(position, velocity, width, height, flag6, flag6);
						}
						else
						{
							velocity = Collision.TileCollision(position, velocity, width, height, flag6, flag6);
						}
					}
					else
					{
						Vector2 vector2 = position;
						int num2 = ((overrideWidth != -1) ? overrideWidth : width);
						int num3 = ((overrideHeight != -1) ? overrideHeight : height);
						if (overrideHeight != -1 || overrideWidth != -1)
						{
							vector2 = ((!vector.HasValue) ? new Vector2(position.X + (float)(width / 2) - (float)(num2 / 2), position.Y + (float)(height / 2) - (float)(num3 / 2)) : (base.Center - new Vector2(num2, num3) * vector.Value));
						}
						if (wet)
						{
							if (shimmerWet)
							{
								Vector2 vector3 = velocity;
								velocity = Collision.TileCollision(vector2, velocity, num2, num3, flag6, flag6);
								wetVelocity = velocity * 0.375f;
								if (velocity.X != vector3.X)
								{
									wetVelocity.X = velocity.X;
								}
								if (velocity.Y != vector3.Y)
								{
									wetVelocity.Y = velocity.Y;
								}
							}
							else if (honeyWet)
							{
								Vector2 vector4 = velocity;
								velocity = Collision.TileCollision(vector2, velocity, num2, num3, flag6, flag6);
								wetVelocity = velocity * 0.25f;
								if (velocity.X != vector4.X)
								{
									wetVelocity.X = velocity.X;
								}
								if (velocity.Y != vector4.Y)
								{
									wetVelocity.Y = velocity.Y;
								}
							}
							else
							{
								Vector2 vector5 = velocity;
								velocity = Collision.TileCollision(vector2, velocity, num2, num3, flag6, flag6);
								wetVelocity = velocity * 0.5f;
								if (velocity.X != vector5.X)
								{
									wetVelocity.X = velocity.X;
								}
								if (velocity.Y != vector5.Y)
								{
									wetVelocity.Y = velocity.Y;
								}
							}
							if (!Main.projPet[type])
							{
								Vector4 vector6 = Collision.SlopeCollision(vector2, velocity, num2, num3, 0f, fall: true);
								Vector2 vector7 = position - vector2;
								if (aiStyle == 137)
								{
									if (vector2.Y != vector6.Y)
									{
										flag = true;
									}
									if (velocity.Y != vector6.W)
									{
										flag = true;
									}
									vector2.Y = vector6.Y;
									position.Y = vector2.Y + vector7.Y;
									velocity.Y = vector6.W;
								}
								else
								{
									if (vector2.X != vector6.X)
									{
										flag = true;
									}
									if (vector2.Y != vector6.Y)
									{
										flag = true;
									}
									if (velocity.X != vector6.Z)
									{
										flag = true;
									}
									if (velocity.Y != vector6.W)
									{
										flag = true;
									}
									vector2.X = vector6.X;
									vector2.Y = vector6.Y;
									position = vector2 + vector7;
									velocity.X = vector6.Z;
									velocity.Y = vector6.W;
								}
							}
						}
						else
						{
							int num4 = Math.Min(num2, num3);
							if (num4 < 3)
							{
								num4 = 3;
							}
							if (num4 > 16)
							{
								num4 = 16;
							}
							if (velocity.Length() > (float)num4)
							{
								Vector2 vector8 = Collision.TileCollision(vector2, velocity, num2, num3, flag6, flag6);
								float num5 = velocity.Length();
								float num6 = num4;
								Vector2 vector9 = velocity.SafeNormalize(Vector2.Zero);
								if (vector8.Y == 0f)
								{
									vector9.Y = 0f;
								}
								Vector2 zero = Vector2.Zero;
								_ = Vector2.Zero;
								_ = Vector2.Zero;
								Vector2 vector10 = vector2;
								int num7 = 0;
								while (num5 > 0f)
								{
									num7++;
									if (num7 > 300)
									{
										break;
									}
									vector10 = vector2;
									float num8 = num5;
									if (num8 > num6)
									{
										num8 = num6;
									}
									num5 -= num8;
									Vector2 vector11 = vector9 * num8;
									Vector2 vector12 = Collision.TileCollision(vector2, vector11, num2, num3, flag6, flag6);
									vector2 += vector12;
									velocity = vector12;
									if (!Main.projPet[type])
									{
										Vector4 vector13 = Collision.SlopeCollision(vector2, velocity, num2, num3, 0f, fall: true);
										Vector2 vector14 = position - vector2;
										if (aiStyle == 137)
										{
											if (vector2.Y != vector13.Y)
											{
												flag = true;
											}
											if (velocity.Y != vector13.W)
											{
												flag = true;
											}
											vector2.Y = vector13.Y;
											position.Y = vector2.Y + vector14.Y;
											velocity.Y = vector13.W;
										}
										else
										{
											if (vector2.X != vector13.X)
											{
												flag = true;
											}
											if (vector2.Y != vector13.Y)
											{
												flag = true;
											}
											if (velocity.X != vector13.Z)
											{
												flag = true;
											}
											if (velocity.Y != vector13.W)
											{
												flag = true;
											}
											vector2.X = vector13.X;
											vector2.Y = vector13.Y;
											position = vector2 + vector14;
											velocity.X = vector13.Z;
											velocity.Y = vector13.W;
										}
									}
									flag2 = true;
									if (owner == Main.myPlayer && vector2 != vector10 && !flag4)
									{
										Collision.SwitchTiles(vector2, num2, num3, vector10, 4);
									}
									vector12 = velocity;
									zero += vector12;
								}
								velocity = zero;
								if (Math.Abs(velocity.X - lastVelocity.X) < 0.0001f)
								{
									velocity.X = lastVelocity.X;
								}
								if (Math.Abs(velocity.Y - lastVelocity.Y) < 0.0001f)
								{
									velocity.Y = lastVelocity.Y;
								}
								if (!Main.projPet[type])
								{
									Vector4 vector15 = Collision.SlopeCollision(vector2, velocity, num2, num3, 0f, fall: true);
									Vector2 vector16 = position - vector2;
									if (aiStyle == 137)
									{
										if (vector2.Y != vector15.Y)
										{
											flag = true;
										}
										if (velocity.Y != vector15.W)
										{
											flag = true;
										}
										vector2.Y = vector15.Y;
										position.Y = vector2.Y + vector16.Y;
										velocity.Y = vector15.W;
									}
									else
									{
										if (vector2.X != vector15.X)
										{
											flag = true;
										}
										if (vector2.Y != vector15.Y)
										{
											flag = true;
										}
										if (velocity.X != vector15.Z)
										{
											flag = true;
										}
										if (velocity.Y != vector15.W)
										{
											flag = true;
										}
										vector2.X = vector15.X;
										vector2.Y = vector15.Y;
										position = vector2 + vector16;
										velocity.X = vector15.Z;
										velocity.Y = vector15.W;
									}
								}
							}
							else
							{
								velocity = Collision.TileCollision(vector2, velocity, num2, num3, flag6, flag6);
								if (!Main.projPet[type])
								{
									Vector4 vector17 = Collision.SlopeCollision(vector2, velocity, num2, num3, 0f, fall: true);
									Vector2 vector18 = position - vector2;
									if (aiStyle == 137)
									{
										if (vector2.Y != vector17.Y)
										{
											flag = true;
										}
										if (velocity.Y != vector17.W)
										{
											flag = true;
										}
										vector2.Y = vector17.Y;
										position.Y = vector2.Y + vector18.Y;
										velocity.Y = vector17.W;
									}
									else
									{
										if (vector2.X != vector17.X)
										{
											flag = true;
										}
										if (vector2.Y != vector17.Y)
										{
											flag = true;
										}
										if (velocity.X != vector17.Z)
										{
											flag = true;
										}
										if (velocity.Y != vector17.W)
										{
											flag = true;
										}
										vector2.X = vector17.X;
										vector2.Y = vector17.Y;
										position = vector2 + vector18;
										velocity.X = vector17.Z;
										velocity.Y = vector17.W;
									}
								}
							}
						}
					}
				}
				if (lastVelocity != velocity)
				{
					flag = true;
				}
				if (flag)
				{
					if (owner == Main.myPlayer && CanCutTiles() && (friendly || hostile) && damage > 0)
					{
						int num9 = (int)(position.X + velocity.X - 1f) / 16;
						int num10 = (int)((position.X + (float)width + velocity.X + 1f) / 16f) + 1;
						int num11 = (int)(position.Y + velocity.Y - 1f) / 16;
						int num12 = (int)((position.Y + (float)height + velocity.Y + 1f) / 16f) + 1;
						if (num9 < 0)
						{
							num9 = 0;
						}
						if (num10 > Main.maxTilesX)
						{
							num10 = Main.maxTilesX;
						}
						if (num11 < 0)
						{
							num11 = 0;
						}
						if (num12 > Main.maxTilesY)
						{
							num12 = Main.maxTilesY;
						}
						bool[] tileCutIgnorance = Main.player[owner].GetTileCutIgnorance(allowRegrowth: false);
						for (int i = num9; i < num10; i++)
						{
							for (int j = num11; j < num12; j++)
							{
								if (Main.tile[i, j] != null && !tileCutIgnorance[Main.tile[i, j].type] && Main.tile[i, j].type == 484 && WorldGen.CanCutTile(i, j, TileCuttingContext.AttackProjectile))
								{
									WorldGen.KillTile(i, j);
									if (Main.netMode != 0)
									{
										NetMessage.SendData(17, -1, -1, null, 0, i, j);
									}
								}
							}
						}
					}
					if (Main.rand.Next(3) == 0 && owner == Main.myPlayer && CanCutTiles() && (friendly || hostile) && damage > 0)
					{
						int num13 = (int)(position.X + velocity.X - 1f) / 16;
						int num14 = (int)((position.X + (float)width + velocity.X + 1f) / 16f) + 1;
						int num15 = (int)(position.Y + velocity.Y - 1f) / 16;
						int num16 = (int)((position.Y + (float)height + velocity.Y + 1f) / 16f) + 1;
						if (num13 < 0)
						{
							num13 = 0;
						}
						if (num14 > Main.maxTilesX)
						{
							num14 = Main.maxTilesX;
						}
						if (num15 < 0)
						{
							num15 = 0;
						}
						if (num16 > Main.maxTilesY)
						{
							num16 = Main.maxTilesY;
						}
						bool[] tileCutIgnorance2 = Main.player[owner].GetTileCutIgnorance(allowRegrowth: false);
						for (int k = num13; k < num14; k++)
						{
							for (int l = num15; l < num16; l++)
							{
								if (Main.tile[k, l] != null && !tileCutIgnorance2[Main.tile[k, l].type] && TileID.Sets.CrackedBricks[Main.tile[k, l].type] && WorldGen.CanCutTile(k, l, TileCuttingContext.AttackProjectile))
								{
									WorldGen.KillTile(k, l);
									if (Main.netMode != 0)
									{
										NetMessage.SendData(17, -1, -1, null, 0, k, l);
									}
								}
							}
						}
					}
					if (type == 663 || type == 665 || type == 667 || type == 677 || type == 678 || type == 679 || type == 691 || type == 692 || type == 693 || type == 688 || type == 689 || type == 690)
					{
						position += velocity;
						velocity = Vector2.Zero;
					}
					else if (type == 434)
					{
						position += velocity;
						numUpdates = 0;
					}
					else if (type == 1020)
					{
						if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 1f)
						{
							velocity.X = (0f - lastVelocity.X) * 0.25f;
						}
						if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 1f)
						{
							velocity.Y = (0f - lastVelocity.Y) * 0.25f;
						}
					}
					else if (type == 601)
					{
						if (Main.netMode != 2 && alpha > 0)
						{
							if (ai[1] != 0f)
							{
								SoundEngine.PlaySound(SoundID.Item114, position);
							}
							else
							{
								SoundEngine.PlaySound(SoundID.Item115, position);
							}
						}
						if (owner == Main.myPlayer)
						{
							PortalHelper.TryPlacingPortal(this, lastVelocity, velocity);
						}
						position += velocity;
						Kill();
					}
					else if (type == 985)
					{
						position += velocity;
						velocity = lastVelocity;
						velocity *= 0.01f;
						localAI[1] = 1f;
					}
					else if (type == 451)
					{
						ai[0] = 1f;
						ai[1] = 0f;
						netUpdate = true;
						velocity = lastVelocity / 2f;
					}
					else if (type == 645)
					{
						ai[0] = 0f;
						ai[1] = -1f;
						netUpdate = true;
					}
					else if (type == 584)
					{
						bool flag7 = false;
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * -0.75f;
							flag7 = true;
						}
						if ((velocity.Y != lastVelocity.Y && lastVelocity.Y > 2f) || velocity.Y == 0f)
						{
							velocity.Y = lastVelocity.Y * -0.75f;
							flag7 = true;
						}
						if (flag7)
						{
							float num17 = lastVelocity.Length() / velocity.Length();
							if (num17 == 0f)
							{
								num17 = 1f;
							}
							velocity /= num17;
							penetrate--;
						}
					}
					else if (type == 532)
					{
						bool flag8 = false;
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * -0.75f;
							flag8 = true;
						}
						if ((velocity.Y != lastVelocity.Y && lastVelocity.Y > 2f) || velocity.Y == 0f)
						{
							velocity.Y = lastVelocity.Y * -0.75f;
							flag8 = true;
						}
						if (flag8)
						{
							float num18 = lastVelocity.Length() / velocity.Length();
							if (num18 == 0f)
							{
								num18 = 1f;
							}
							velocity /= num18;
							penetrate--;
							Collision.HitTiles(position, lastVelocity, width, height);
						}
					}
					else if (type == 533)
					{
						float num19 = 1f;
						bool flag9 = false;
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * (0f - num19);
							flag9 = true;
						}
						if (velocity.Y != lastVelocity.Y || velocity.Y == 0f)
						{
							velocity.Y = lastVelocity.Y * (0f - num19) * 0.5f;
							flag9 = true;
						}
						if (flag9)
						{
							float num20 = lastVelocity.Length() / velocity.Length();
							if (num20 == 0f)
							{
								num20 = 1f;
							}
							velocity /= num20;
							if (ai[0] == 7f && (double)velocity.Y < -0.1)
							{
								velocity.Y += 0.1f;
							}
							if (ai[0] >= 6f && ai[0] < 9f)
							{
								Collision.HitTiles(position, lastVelocity, width, height);
							}
						}
					}
					else if (type == 502)
					{
						ai[0] += 1f;
						SoundEngine.PlaySound(37, (int)position.X, (int)position.Y, 5 + (int)ai[0]);
						if (ai[0] >= 5f)
						{
							position += velocity;
							Kill();
						}
						else
						{
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
							}
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
							}
						}
						Vector2 spinningpoint = new Vector2(0f, -3f - ai[0]).RotatedByRandom(3.1415927410125732);
						float num21 = 10f + ai[0] * 4f;
						Vector2 vector19 = new Vector2(1.05f, 1f);
						for (float num22 = 0f; num22 < num21; num22 += 1f)
						{
							int num23 = Dust.NewDust(base.Center, 0, 0, 66, 0f, 0f, 0, Color.Transparent);
							Main.dust[num23].position = base.Center;
							Main.dust[num23].velocity = spinningpoint.RotatedBy(MathF.PI * 2f * num22 / num21) * vector19 * (0.8f + Main.rand.NextFloat() * 0.4f);
							Main.dust[num23].color = Main.hslToRgb(num22 / num21, 1f, 0.5f);
							Main.dust[num23].noGravity = true;
							Main.dust[num23].scale = 1f + ai[0] / 3f;
						}
						if (Main.myPlayer == owner)
						{
							int num24 = width;
							int num25 = height;
							int num26 = penetrate;
							position = base.Center;
							width = (height = 40 + 8 * (int)ai[0]);
							base.Center = position;
							penetrate = -1;
							Damage();
							penetrate = num26;
							position = base.Center;
							width = num24;
							height = num25;
							base.Center = position;
						}
					}
					else if (type == 444)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = 0f - lastVelocity.X;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = 0f - lastVelocity.Y;
						}
						ai[0] = velocity.ToRotation();
					}
					else if (type == 617)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = (0f - lastVelocity.X) * 0.35f;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = (0f - lastVelocity.Y) * 0.35f;
						}
					}
					else if (type == 440 || type == 449 || type == 606)
					{
						if (ai[1] != 1f)
						{
							ai[1] = 1f;
							position += velocity;
							velocity = lastVelocity;
						}
					}
					else if (type == 85)
					{
						velocity = lastVelocity * 0.95f;
						position -= velocity;
					}
					else if (type == 466 || type == 580 || type == 640)
					{
						if (localAI[1] < 1f)
						{
							localAI[1] += 2f;
							position += velocity;
							velocity = Vector2.Zero;
						}
					}
					else if (type == 851)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = (0f - lastVelocity.X) * 0.8f;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = (0f - lastVelocity.Y) * 0.5f;
						}
					}
					else if (type == 855)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = 0f - lastVelocity.X;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = 0f - lastVelocity.Y;
							if (lastVelocity.Y < 0f)
							{
								velocity.Y *= 0.25f;
							}
						}
					}
					else if (aiStyle == 54)
					{
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * -0.6f;
						}
						if (velocity.Y != lastVelocity.Y)
						{
							velocity.Y = lastVelocity.Y * -0.6f;
						}
					}
					else if (type == 861)
					{
						float num27 = -1f;
						if (ai[1] == 1f)
						{
							num27 = -0.6f;
						}
						if (velocity.X != lastVelocity.X)
						{
							velocity.X = lastVelocity.X * num27;
						}
						if (velocity.Y != lastVelocity.Y && (double)lastVelocity.Y > 0.7)
						{
							velocity.Y = lastVelocity.Y * num27;
						}
						if (Math.Abs(velocity.Y) < 0.5f)
						{
							velocity.Y = 0f;
						}
						if (ai[1] != 1f)
						{
							netUpdate = true;
						}
						ai[1] = 1f;
					}
					else if (!Main.projPet[type] && type != 500 && type != 820 && aiStyle != 160 && type != 650 && type != 882 && type != 888 && type != 894 && type != 895 && type != 898 && type != 901 && type != 957)
					{
						if (aiStyle == 99)
						{
							if (type >= 556 && type <= 561)
							{
								bool flag10 = false;
								if (velocity.X != lastVelocity.X)
								{
									flag10 = true;
									velocity.X = lastVelocity.X * -1f;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									flag10 = true;
									velocity.Y = lastVelocity.Y * -1f;
								}
								if (flag10)
								{
									Vector2 vector20 = Main.player[owner].Center - base.Center;
									vector20.Normalize();
									vector20 *= velocity.Length();
									vector20 *= 0.25f;
									velocity *= 0.75f;
									velocity += vector20;
									if (velocity.Length() > 6f)
									{
										velocity *= 0.5f;
									}
								}
							}
						}
						else if (type == 604)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = 0f - lastVelocity.X;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = 0f - lastVelocity.Y;
							}
						}
						else if (type == 379)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -0.6f;
							}
							if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 2f)
							{
								velocity.Y = lastVelocity.Y * -0.6f;
							}
						}
						else if (type == 491)
						{
							if (ai[0] <= 0f)
							{
								ai[0] = -10f;
							}
							if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 0f)
							{
								velocity.X = lastVelocity.X * -1f;
							}
							if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 0f)
							{
								velocity.Y = lastVelocity.Y * -1f;
							}
						}
						else if ((type >= 515 && type <= 517) || type == 637)
						{
							if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 1f)
							{
								velocity.X = lastVelocity.X * -0.9f;
							}
							if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 1f)
							{
								velocity.Y = lastVelocity.Y * -0.9f;
							}
						}
						else if (type == 921 || type == 926 || type == 937)
						{
							if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 1f)
							{
								velocity.X = lastVelocity.X * -0.4f;
							}
							if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 1f)
							{
								velocity.Y = lastVelocity.Y * -0.95f;
							}
							penetrate--;
						}
						else if (type == 969)
						{
							if (velocity.X != lastVelocity.X && Math.Abs(lastVelocity.X) > 1f)
							{
								velocity.X = lastVelocity.X * -0.75f;
							}
							if (velocity.Y != lastVelocity.Y && Math.Abs(lastVelocity.Y) > 1f)
							{
								velocity.Y = lastVelocity.Y * -0.75f;
							}
						}
						else if (type == 681)
						{
							timeLeft = 4;
						}
						else if (type == 409)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -1f;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = lastVelocity.Y * -1f;
							}
						}
						else if (type == 254)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -1f;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = lastVelocity.Y * -1f;
							}
						}
						else if (type == 225)
						{
							ai[1] += 1f;
							if (ai[1] == 1f)
							{
								damage = (int)((float)damage * 0.66f);
							}
							if (ai[1] >= 4f)
							{
								Kill();
								return;
							}
							velocity.X = 0f - lastVelocity.X;
							velocity.Y = 0f - lastVelocity.Y;
							int num28 = FindTargetWithLineOfSight();
							if (num28 != -1)
							{
								NPC nPC = Main.npc[num28];
								float t = Distance(nPC.Center);
								Vector2 vector21 = -Vector2.UnitY * MathHelper.Lerp((float)nPC.height * 0.1f, (float)nPC.height * 0.5f, Utils.GetLerpValue(0f, 300f, t));
								velocity = DirectionTo(nPC.Center + vector21).SafeNormalize(-Vector2.UnitY) * velocity.Length();
								netUpdate = true;
							}
						}
						else if (type == 285)
						{
							ai[1] += 1f;
							if (ai[1] == 1f)
							{
								damage = (int)((float)damage * 0.66f);
							}
							if (ai[1] >= 2f)
							{
								Kill();
								return;
							}
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -1f;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = lastVelocity.Y * -1f;
							}
							int num29 = FindTargetWithLineOfSight();
							if (num29 != -1)
							{
								NPC nPC2 = Main.npc[num29];
								Distance(nPC2.Center);
								velocity = DirectionTo(nPC2.Center).SafeNormalize(-Vector2.UnitY) * velocity.Length();
								netUpdate = true;
							}
						}
						else if (type == 931)
						{
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -1f;
							}
							if (velocity.Y != lastVelocity.Y)
							{
								velocity.Y = lastVelocity.Y * -1f;
							}
						}
						else if (type == 155)
						{
							if (ai[1] > 10f)
							{
								NetworkText networkText = NetworkText.FromKey("Game.BallBounceResult", NetworkText.FromKey(Lang.GetProjectileName(type).Key), ai[1]);
								if (Main.netMode == 0)
								{
									Main.NewText(networkText.ToString(), byte.MaxValue, 240, 20);
								}
								else if (Main.netMode == 2)
								{
									ChatHelper.BroadcastChatMessage(networkText, new Color(255, 240, 20));
								}
							}
							ai[1] = 0f;
							if (velocity.X != lastVelocity.X)
							{
								velocity.X = lastVelocity.X * -0.6f;
							}
							if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 2f)
							{
								velocity.Y = lastVelocity.Y * -0.6f;
							}
						}
						else if (aiStyle == 33)
						{
							if (localAI[0] == 0f)
							{
								if (wet)
								{
									position += lastVelocity / 2f;
								}
								else
								{
									position += lastVelocity;
								}
								velocity *= 0f;
								localAI[0] = 1f;
							}
						}
						else if (type != 308 && type != 377 && type != 966)
						{
							if (type == 477)
							{
								if (velocity.Y != lastVelocity.Y || velocity.X != lastVelocity.X)
								{
									penetrate--;
									if (penetrate <= 0)
									{
										Kill();
									}
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = 0f - lastVelocity.X;
									}
									if (velocity.Y != lastVelocity.Y)
									{
										velocity.Y = 0f - lastVelocity.Y;
									}
								}
								if (penetrate > 0 && owner == Main.myPlayer)
								{
									int[] array = new int[10];
									int num30 = 0;
									int num31 = 700;
									int num32 = 20;
									for (int m = 0; m < 200; m++)
									{
										if (!Main.npc[m].CanBeChasedBy(this))
										{
											continue;
										}
										float num33 = (base.Center - Main.npc[m].Center).Length();
										if (num33 > (float)num32 && num33 < (float)num31 && Collision.CanHitLine(base.Center, 1, 1, Main.npc[m].Center, 1, 1))
										{
											array[num30] = m;
											num30++;
											if (num30 >= 9)
											{
												break;
											}
										}
									}
									if (num30 > 0)
									{
										num30 = Main.rand.Next(num30);
										Vector2 vector22 = Main.npc[array[num30]].Center - base.Center;
										float num34 = velocity.Length();
										vector22.Normalize();
										velocity = vector22 * num34;
										netUpdate = true;
									}
								}
							}
							else if (type == 94)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else if (type == 496)
							{
								if (velocity.X != lastVelocity.X)
								{
									if (Math.Abs(velocity.X) < 1f)
									{
										velocity.X = 0f - lastVelocity.X;
									}
									else
									{
										Kill();
									}
								}
								if (velocity.Y != lastVelocity.Y)
								{
									if (Math.Abs(velocity.Y) < 1f)
									{
										velocity.Y = 0f - lastVelocity.Y;
									}
									else
									{
										Kill();
									}
								}
							}
							else if (type == 311)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
									ai[1] += 1f;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
									ai[1] += 1f;
								}
								if (ai[1] > 4f)
								{
									Kill();
								}
							}
							else if (type == 312)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
									ai[1] += 1f;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
									ai[1] += 1f;
								}
							}
							else if (type == 522 || type == 620)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else if (type == 524)
							{
								ai[0] += 100f;
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else if (aiStyle == 93)
							{
								if (velocity != lastVelocity)
								{
									ai[1] = 0f;
									ai[0] = 1f;
									netUpdate = true;
									tileCollide = false;
									position += velocity;
									velocity = lastVelocity;
									velocity.Normalize();
									velocity *= 3f;
								}
							}
							else if (type == 281)
							{
								bool flag11 = Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 2f || ai[0] == -1f;
								if (ai[0] == -2f || ai[0] == -3f)
								{
									flag11 = false;
								}
								if (flag11)
								{
									if (Main.myPlayer == owner)
									{
										int num35 = ((velocity.X > 0f) ? 1 : 2);
										if (damage == 0)
										{
											num35 += 2;
										}
										NPC.ReleaseNPC((int)base.Center.X, (int)base.Bottom.Y - 4, 614, num35, owner);
										ai[0] = -3f;
										netUpdate = true;
									}
								}
								else
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = (0f - lastVelocity.X) * 0.5f;
									}
									if (velocity.Y != lastVelocity.Y)
									{
										velocity.Y = (0f - lastVelocity.Y) * 0.5f;
									}
								}
							}
							else if (type == 290 || type == 294)
							{
								if (velocity.X != lastVelocity.X)
								{
									position.X += velocity.X;
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									position.Y += velocity.Y;
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else if ((type == 181 || type == 189 || type == 357 || type == 566) && penetrate > 0)
							{
								if (type == 357)
								{
									damage = (int)((double)damage * 0.9);
								}
								penetrate--;
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else if (type == 307 && ai[1] < 5f)
							{
								ai[1] += 1f;
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else if (type == 99 || type == 1005 || type == 1014)
							{
								if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 5f)
								{
									Collision.HitTiles(position, velocity, width, height);
									SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
									velocity.Y = (0f - lastVelocity.Y) * 0.2f;
								}
								if (velocity.X != lastVelocity.X)
								{
									Kill();
								}
							}
							else if (type == 1021)
							{
								if (velocity.Y != lastVelocity.Y)
								{
									if (lastVelocity.Y > 4f)
									{
										Collision.HitTiles(position, velocity, width, height);
										SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
										velocity.Y = (0f - lastVelocity.Y) * 0.9f;
									}
									else if (lastVelocity.Y > 0f)
									{
										localAI[1] = 999f;
									}
								}
								if (velocity.X != lastVelocity.X)
								{
									if (localAI[1] <= 3f)
									{
										velocity.X = lastVelocity.X * -0.75f;
										localAI[1] += 1f;
									}
									else
									{
										Kill();
									}
								}
							}
							else if (type == 1013)
							{
								float num36 = Math.Abs(lastVelocity.X);
								float num37 = Math.Abs(lastVelocity.Y);
								float num38 = 0.95f;
								float num39 = 0.95f;
								if (num36 < 0.5f)
								{
									num38 = 0.1f;
								}
								else if (num36 < 0.75f)
								{
									num38 = 0.25f;
								}
								else if (num36 < 1f)
								{
									num38 = 0.5f;
								}
								if (num37 < 0.5f)
								{
									num39 = 0.1f;
								}
								else if (num37 < 0.75f)
								{
									num39 = 0.25f;
								}
								else if (num37 < 1f)
								{
									num39 = 0.5f;
								}
								bool flag12 = false;
								if (velocity.Y != lastVelocity.Y)
								{
									if (Math.Abs(lastVelocity.Y) > 5f)
									{
										flag12 = true;
									}
									velocity.Y = (0f - lastVelocity.Y) * num39;
								}
								if (velocity.X != lastVelocity.X)
								{
									if (Math.Abs(lastVelocity.X) > 5f)
									{
										flag12 = true;
									}
									velocity.X = (0f - lastVelocity.X) * num38;
								}
								if (flag12)
								{
									localAI[1] += 1f;
									Collision.HitTiles(position, velocity, width, height);
									SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
								}
								if (velocity.Length() < 0.1f && localAI[0] > 50f)
								{
									Kill();
								}
								if (localAI[1] > 20f)
								{
									Kill();
								}
							}
							else if (type == 727)
							{
								int num40 = 30;
								float num41 = 2f;
								float num42 = 2f;
								if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 5f)
								{
									Collision.HitTiles(position, velocity, width, height);
									SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
									velocity.Y = (0f - lastVelocity.Y) * 0.65f;
									if (owner == Main.myPlayer)
									{
										int num43 = Main.rand.Next(3, 6);
										float num44 = Main.rand.NextFloat();
										for (float num45 = 0f; num45 < 1f; num45 += 1f / (float)num43)
										{
											Vector2 vector23 = ((num44 + num45) * (MathF.PI * 2f)).ToRotationVector2() * num42;
											if (vector23.Y > 0f)
											{
												vector23 *= -0.7f;
											}
											NewProjectile(GetProjectileSource_FromThis(), base.Center, vector23, 763, num40, num41, Main.myPlayer);
										}
									}
								}
								if (velocity.X != lastVelocity.X)
								{
									Kill();
									if (owner == Main.myPlayer)
									{
										int num46 = Main.rand.Next(3, 6);
										float num47 = Main.rand.NextFloat();
										for (float num48 = 0f; num48 < 1f; num48 += 1f / (float)num46)
										{
											Vector2 vector24 = ((num47 + num48) * (MathF.PI * 2f)).ToRotationVector2() * num42;
											if (vector24.Y > 0f)
											{
												vector24 *= -0.7f;
											}
											NewProjectile(GetProjectileSource_FromThis(), base.Center, vector24, 763, num40, num41, Main.myPlayer);
										}
									}
								}
							}
							else if (type == 655)
							{
								if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 5f)
								{
									Collision.HitTiles(position, velocity, width, height);
									SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
									velocity.Y = (0f - lastVelocity.Y) * 0.2f;
								}
								if (velocity.X != lastVelocity.X)
								{
									Kill();
								}
							}
							else if (type == 36)
							{
								if (penetrate > 1)
								{
									Collision.HitTiles(position, velocity, width, height);
									SoundEngine.PlaySound(SoundID.Item10, position);
									penetrate--;
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = 0f - lastVelocity.X;
									}
									if (velocity.Y != lastVelocity.Y)
									{
										velocity.Y = 0f - lastVelocity.Y;
									}
								}
								else
								{
									Kill();
								}
							}
							else if (aiStyle == 21)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = 0f - lastVelocity.X;
								}
								if (velocity.Y != lastVelocity.Y)
								{
									velocity.Y = 0f - lastVelocity.Y;
								}
							}
							else if (aiStyle == 17)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -0.75f;
								}
								if (velocity.Y != lastVelocity.Y && (double)lastVelocity.Y > 1.5)
								{
									velocity.Y = lastVelocity.Y * -0.7f;
								}
							}
							else if (aiStyle == 15)
							{
								AI_015_HandleMovementCollision(ref wetVelocity, ref lastVelocity);
							}
							else if (aiStyle == 9)
							{
								bool flag13 = owner == Main.myPlayer;
								if (type == 79)
								{
									bool flag14 = ai[0] >= 0f;
									flag13 = flag13 && !flag14;
									if (flag14)
									{
										if (velocity.X != lastVelocity.X)
										{
											velocity.X *= 0.1f;
										}
										if (velocity.Y != lastVelocity.Y)
										{
											velocity.Y *= 0.1f;
										}
									}
								}
								if (flag13)
								{
									Kill();
								}
							}
							else if (aiStyle == 39)
							{
								Collision.HitTiles(position, velocity, width, height);
								if (type == 33 || type == 106)
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = 0f - lastVelocity.X;
									}
									if (velocity.Y != lastVelocity.Y)
									{
										velocity.Y = 0f - lastVelocity.Y;
									}
								}
								else
								{
									ai[0] = 1f;
									if (aiStyle == 3)
									{
										velocity.X = 0f - lastVelocity.X;
										velocity.Y = 0f - lastVelocity.Y;
									}
								}
								netUpdate = true;
								SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
							}
							else if (aiStyle == 3 || aiStyle == 13 || aiStyle == 69 || aiStyle == 109)
							{
								if (type == 106)
								{
									Vector2 hitPoint = base.Center + velocity.SafeNormalize(Vector2.UnitX) * 8f * scale;
									Vector2 normal = new Vector2((velocity.X != lastVelocity.X) ? (-Math.Sign(lastVelocity.X)) : 0, (velocity.Y != lastVelocity.Y) ? (-Math.Sign(lastVelocity.Y)) : 0);
									LightDisc_Bounce(hitPoint, normal);
								}
								Collision.HitTiles(position, velocity, width, height);
								if (type == 33 || type == 106 || type == 866)
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = 0f - lastVelocity.X;
									}
									if (velocity.Y != lastVelocity.Y)
									{
										velocity.Y = 0f - lastVelocity.Y;
									}
								}
								else
								{
									ai[0] = 1f;
									if ((aiStyle == 3 || aiStyle == 109) && type != 383)
									{
										velocity.X = 0f - lastVelocity.X;
										velocity.Y = 0f - lastVelocity.Y;
									}
								}
								netUpdate = true;
								SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
							}
							else if (aiStyle == 8 && type != 96)
							{
								SoundEngine.PlaySound(SoundID.Item10, position);
								ai[0] += 1f;
								int num49 = 5;
								switch (type)
								{
								case 15:
									num49 = 6;
									break;
								case 253:
									num49 = 8;
									break;
								}
								if (ai[0] >= (float)num49)
								{
									position += velocity;
									Kill();
								}
								else
								{
									if (type == 15 && velocity.Y > 4f)
									{
										if (velocity.Y != lastVelocity.Y)
										{
											velocity.Y = (0f - lastVelocity.Y) * 0.8f;
										}
									}
									else if (velocity.Y != lastVelocity.Y)
									{
										velocity.Y = 0f - lastVelocity.Y;
									}
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = 0f - lastVelocity.X;
									}
								}
							}
							else if (aiStyle == 61)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -0.3f;
								}
								if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 1f)
								{
									velocity.Y = lastVelocity.Y * -0.3f;
								}
							}
							else if (aiStyle == 14)
							{
								if (type == 928)
								{
									int num50 = 0;
									for (int num51 = 1000; num51 >= 0; num51--)
									{
										if (num51 != whoAmI && Main.projectile[num51].active && Main.projectile[num51].owner == owner && Main.projectile[num51].type == type)
										{
											num50++;
											if (num50 >= 2 && timeLeft > Main.projectile[num51].timeLeft && Main.projectile[num51].timeLeft > 30)
											{
												Main.projectile[num51].timeLeft = 2;
											}
										}
									}
								}
								if (type == 261 && ((velocity.X != lastVelocity.X && (lastVelocity.X < -3f || lastVelocity.X > 3f)) || (velocity.Y != lastVelocity.Y && (lastVelocity.Y < -3f || lastVelocity.Y > 3f))))
								{
									for (int n = 0; n < 10; n++)
									{
										Collision.HitTiles(position, velocity, width, height);
									}
									SoundEngine.PlaySound(0, (int)base.Center.X, (int)base.Center.Y);
									MakeBoulderOfEarthExplosion();
								}
								if (type >= 326 && type <= 328 && velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -0.1f;
								}
								if (type >= 400 && type <= 402)
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = lastVelocity.X * -0.1f;
									}
								}
								else if (type == 870 && ai[1] == 0f)
								{
									if (velocity.X != lastVelocity.X || velocity.Y != lastVelocity.Y)
									{
										velocity = -lastVelocity;
										ai[1] = 1f;
									}
								}
								else if (type == 50)
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = lastVelocity.X * -0.2f;
									}
									if (velocity.Y != lastVelocity.Y && (double)lastVelocity.Y > 1.5)
									{
										velocity.Y = lastVelocity.Y * -0.2f;
									}
								}
								else if (type == 185)
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = lastVelocity.X * -0.9f;
									}
									if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 1f)
									{
										velocity.Y = lastVelocity.Y * -0.9f;
									}
								}
								else if (type == 277)
								{
									if (velocity.X != lastVelocity.X)
									{
										velocity.X = lastVelocity.X * -0.9f;
									}
									if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 3f)
									{
										velocity.Y = lastVelocity.Y * -0.9f;
									}
								}
								else if (type != 480)
								{
									if (type == 450)
									{
										if (velocity.X != lastVelocity.X)
										{
											velocity.X = lastVelocity.X * -0.1f;
										}
									}
									else
									{
										if (velocity.X != lastVelocity.X)
										{
											velocity.X = lastVelocity.X * -0.5f;
										}
										if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 1f)
										{
											velocity.Y = lastVelocity.Y * -0.5f;
										}
									}
								}
							}
							else if (aiStyle == 16)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -0.4f;
									if (type == 29)
									{
										velocity.X *= 0.8f;
									}
								}
								if (velocity.Y != lastVelocity.Y && (double)lastVelocity.Y > 0.7 && type != 102)
								{
									velocity.Y = lastVelocity.Y * -0.4f;
									if (type == 29)
									{
										velocity.Y *= 0.8f;
									}
								}
								if (type == 134 || type == 137 || type == 140 || type == 143 || type == 303 || (type >= 338 && type <= 341) || type == 776 || type == 780 || type == 793 || type == 796 || type == 799 || type == 784 || type == 787 || type == 790 || type == 803 || type == 804 || type == 808 || type == 809 || type == 810 || type == 805 || type == 806 || type == 807 || type == 930)
								{
									velocity *= 0f;
									alpha = 255;
									timeLeft = 3;
								}
							}
							else if (aiStyle == 68)
							{
								velocity *= 0f;
								alpha = 255;
								timeLeft = 3;
								netUpdate = true;
							}
							else if (type == 870)
							{
								if (velocity.X != lastVelocity.X)
								{
									velocity.X = lastVelocity.X * -0.2f;
								}
								if (velocity.Y != lastVelocity.Y && lastVelocity.Y > 0f)
								{
									velocity.Y = lastVelocity.Y * -0.2f;
								}
							}
							else
							{
								position += velocity;
								Kill();
							}
						}
					}
				}
			}
			UpdatePosition(wetVelocity);
			if (!flag2 && !flag4 && owner == Main.myPlayer && (tileCollide || flag5) && position != oldPosition)
			{
				Vector2 vector25 = position;
				Vector2 vector26 = oldPosition;
				int num52 = ((overrideWidth != -1) ? overrideWidth : width);
				int num53 = ((overrideHeight != -1) ? overrideHeight : height);
				if (overrideHeight != -1 || overrideWidth != -1)
				{
					vector25 = new Vector2(position.X + (float)(width / 2) - (float)(num52 / 2), position.Y + (float)(height / 2) - (float)(num53 / 2));
					vector26 = new Vector2(oldPosition.X + (float)(width / 2) - (float)(num52 / 2), oldPosition.Y + (float)(height / 2) - (float)(num53 / 2));
				}
				Collision.SwitchTiles(vector25, num52, num53, vector26, 4);
			}
		}

		private void LightDisc_Bounce(Vector2 hitPoint, Vector2 normal)
		{
			Vector2 spinningpoint = Vector2.Reflect(velocity, normal);
			for (int i = 0; i < 4; i++)
			{
				Dust dust = Dust.NewDustPerfect(hitPoint, 306, spinningpoint.RotatedBy(MathF.PI / 4f * Main.rand.NextFloatDirection()) * 0.6f * Main.rand.NextFloat(), 200, default(Color), 1.6f);
				dust.color = Color.Lerp(new Color(219, 253, 0), Color.Cyan, Main.rand.NextFloat());
				Dust dust2 = Dust.CloneDust(dust);
				dust2.color = Color.White;
				dust2.scale = 1f;
				dust2.alpha = 50;
			}
		}

		private void AI_149_GolfBall()
		{
			if (!npcProj && timeLeft < 10)
			{
				timeLeft = 10;
			}
			if (ai[1] == -1f)
			{
				Tile tileSafely = Framing.GetTileSafely(base.Bottom.ToTileCoordinates());
				if (!tileSafely.active() || tileSafely.type != 494)
				{
					ai[1] = 0f;
					netUpdate = true;
				}
				return;
			}
			BallStepResult ballStepResult = GolfHelper.StepGolfBall(this, ref localAI[0]);
			if (ballStepResult.State == BallState.Resting)
			{
				damage = 0;
				if (Main.netMode == 1 && owner == Main.myPlayer && localAI[1] != (float)ballStepResult.State)
				{
					netUpdate = true;
				}
			}
			localAI[1] = (float)ballStepResult.State;
			rotation += localAI[0];
			if (velocity.Y != 0f && ballStepResult.State == BallState.Moving)
			{
				rotation += velocity.X * 0.1f + velocity.Y * 0.1f;
			}
			if (ballStepResult.State == BallState.Moving && owner == Main.myPlayer)
			{
				bool? flag = ProjectileID.Sets.ForcePlateDetection[135];
				if ((!flag.HasValue || flag.Value) && localAI[1] != 0f)
				{
					Collision.SwitchTiles(position, width, height, oldPosition, 4);
				}
			}
			if (ballStepResult.State == BallState.Moving && Main.netMode == 2 && Main.player.IndexInRange(owner) && Main.player[owner].active)
			{
				RemoteClient.CheckSection(owner, position);
			}
		}

		private void MakeBoulderOfEarthExplosion()
		{
			localAI[0] = 40f;
			float mAX_SPREAD = 20f;
			int fluff = 10;
			int distFluff = 50;
			int layerStart = 1;
			int num = 6;
			if (velocity.Length() < 8f || Math.Abs(velocity.Y) < 4f)
			{
				mAX_SPREAD = 15f;
				fluff = 7;
				distFluff = 30;
				num = 4;
			}
			if (velocity.Length() < 4f || Math.Abs(velocity.Y) < 2f)
			{
				mAX_SPREAD = 15f;
				fluff = 7;
				distFluff = 30;
				num = 2;
				layerStart = 0;
			}
			int layerEnd = num;
			int num2 = num - 2;
			if (num2 < 1)
			{
				num2 = 1;
			}
			CreateGroundExplosion(mAX_SPREAD, fluff, distFluff, layerStart, layerEnd, num2);
			for (int i = 0; i < 10; i++)
			{
				Dust dust = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(width / 2, height / 2), 228, Main.rand.NextVector2Circular(3f, 3f));
				dust.scale = 0.6f;
				if (i < 5)
				{
					dust.noGravity = true;
					dust.scale = 1.8f;
				}
			}
		}

		private void UpdatePosition(Vector2 wetVelocity)
		{
			if (aiStyle == 4 || aiStyle == 38 || aiStyle == 84 || aiStyle == 148 || (aiStyle == 7 && ai[0] == 2f) || ((type == 440 || type == 449 || type == 606) && ai[1] == 1f) || (aiStyle == 93 && ai[0] < 0f) || type == 540 || type == 756 || type == 818 || type == 856 || type == 961 || type == 933 || ProjectileID.Sets.IsAGolfBall[type])
			{
				return;
			}
			if (wet)
			{
				position += wetVelocity;
			}
			else
			{
				position += velocity;
			}
			if (Main.projPet[type] && tileCollide)
			{
				bool fall = false;
				if (aiStyle == 62)
				{
					fall = true;
				}
				switch (type)
				{
				case 317:
				case 387:
				case 388:
				case 533:
				case 759:
					fall = true;
					break;
				}
				Vector4 vector = Collision.SlopeCollision(position, velocity, width, height, 0f, fall);
				position.X = vector.X;
				position.Y = vector.Y;
				velocity.X = vector.Z;
				velocity.Y = vector.W;
			}
		}

		public void FishingCheck()
		{
			if (Main.player[owner].wet && !(base.Center.Y >= Main.player[owner].RotatedRelativePoint(Main.player[owner].MountedCenter).Y))
			{
				return;
			}
			FishingAttempt fisher = default(FishingAttempt);
			fisher.X = (int)(base.Center.X / 16f);
			fisher.Y = (int)(base.Center.Y / 16f);
			fisher.bobberType = type;
			GetFishingPondState(fisher.X, fisher.Y, out fisher.inLava, out fisher.inHoney, out fisher.waterTilesCount, out fisher.chumsInWater);
			if (Main.notTheBeesWorld && Main.rand.Next(2) == 0)
			{
				fisher.inHoney = false;
			}
			if (fisher.waterTilesCount < 75)
			{
				Main.player[owner].displayedFishingInfo = Language.GetTextValue("GameUI.NotEnoughWater");
				return;
			}
			fisher.playerFishingConditions = Main.player[owner].GetFishingConditions();
			int baitItemType = fisher.playerFishingConditions.BaitItemType;
			if (baitItemType == 2673)
			{
				Main.player[owner].displayedFishingInfo = Language.GetTextValue("GameUI.FishingWarning");
				if ((fisher.X < 380 || fisher.X > Main.maxTilesX - 380) && fisher.waterTilesCount > 1000 && !NPC.AnyNPCs(370))
				{
					ai[1] = Main.rand.Next(-180, -60) - 100;
					localAI[1] = 1f;
					netUpdate = true;
				}
				return;
			}
			fisher.fishingLevel = fisher.playerFishingConditions.FinalFishingLevel;
			if (fisher.fishingLevel == 0)
			{
				return;
			}
			fisher.CanFishInLava = ItemID.Sets.CanFishInLava[fisher.playerFishingConditions.PoleItemType] || ItemID.Sets.IsLavaBait[fisher.playerFishingConditions.BaitItemType] || Main.player[owner].accLavaFishing;
			if (fisher.chumsInWater > 0)
			{
				fisher.fishingLevel += 11;
			}
			if (fisher.chumsInWater > 1)
			{
				fisher.fishingLevel += 6;
			}
			if (fisher.chumsInWater > 2)
			{
				fisher.fishingLevel += 3;
			}
			Main.player[owner].displayedFishingInfo = Language.GetTextValue("GameUI.FishingPower", fisher.fishingLevel);
			fisher.waterNeededToFish = 300;
			float num = (float)Main.maxTilesX / 4200f;
			num *= num;
			fisher.atmo = (float)((double)(position.Y / 16f - (60f + 10f * num)) / (Main.worldSurface / 6.0));
			if ((double)fisher.atmo < 0.25)
			{
				fisher.atmo = 0.25f;
			}
			if (fisher.atmo > 1f)
			{
				fisher.atmo = 1f;
			}
			fisher.waterNeededToFish = (int)((float)fisher.waterNeededToFish * fisher.atmo);
			fisher.waterQuality = (float)fisher.waterTilesCount / (float)fisher.waterNeededToFish;
			if (fisher.waterQuality < 1f)
			{
				fisher.fishingLevel = (int)((float)fisher.fishingLevel * fisher.waterQuality);
			}
			fisher.waterQuality = 1f - fisher.waterQuality;
			if (fisher.waterTilesCount < fisher.waterNeededToFish)
			{
				Main.player[owner].displayedFishingInfo = Language.GetTextValue("GameUI.FullFishingPower", fisher.fishingLevel, 0.0 - Math.Round(fisher.waterQuality * 100f));
			}
			if (Main.player[owner].luck < 0f)
			{
				if (Main.rand.NextFloat() < 0f - Main.player[owner].luck)
				{
					fisher.fishingLevel = (int)((double)fisher.fishingLevel * (0.9 - (double)Main.rand.NextFloat() * 0.3));
				}
			}
			else if (Main.rand.NextFloat() < Main.player[owner].luck)
			{
				fisher.fishingLevel = (int)((double)fisher.fishingLevel * (1.1 + (double)Main.rand.NextFloat() * 0.3));
			}
			int num2 = (fisher.fishingLevel + 75) / 2;
			if (Main.rand.Next(100) > num2)
			{
				return;
			}
			fisher.heightLevel = 0;
			if (Main.remixWorld)
			{
				if ((double)fisher.Y < Main.worldSurface * 0.5)
				{
					fisher.heightLevel = 0;
				}
				else if ((double)fisher.Y < Main.worldSurface)
				{
					fisher.heightLevel = 1;
				}
				else if ((double)fisher.Y < Main.rockLayer)
				{
					fisher.heightLevel = 3;
				}
				else if (fisher.Y < Main.maxTilesY - 300)
				{
					fisher.heightLevel = 2;
				}
				else
				{
					fisher.heightLevel = 4;
				}
				if (fisher.heightLevel == 2 && Main.rand.Next(2) == 0)
				{
					fisher.heightLevel = 1;
				}
			}
			else if ((double)fisher.Y < Main.worldSurface * 0.5)
			{
				fisher.heightLevel = 0;
			}
			else if ((double)fisher.Y < Main.worldSurface)
			{
				fisher.heightLevel = 1;
			}
			else if ((double)fisher.Y < Main.rockLayer)
			{
				fisher.heightLevel = 2;
			}
			else if (fisher.Y < Main.maxTilesY - 300)
			{
				fisher.heightLevel = 3;
			}
			else
			{
				fisher.heightLevel = 4;
			}
			FishingCheck_RollDropLevels(fisher.fishingLevel, out fisher.common, out fisher.uncommon, out fisher.rare, out fisher.veryrare, out fisher.legendary, out fisher.crate);
			FishingCheck_ProbeForQuestFish(ref fisher);
			FishingCheck_RollEnemySpawns(ref fisher);
			FishingCheck_RollItemDrop(ref fisher);
			bool flag = false;
			if (fisher.rolledItemDrop > 0)
			{
				if (Main.player[owner].sonarPotion)
				{
					Item item = new Item();
					item.SetDefaults(fisher.rolledItemDrop);
					item.position = position;
					PopupText.AssignAsSonarText(PopupText.NewText(PopupTextContext.SonarAlert, item, 1, noStack: true));
				}
				float num3 = fisher.fishingLevel;
				ai[1] = (float)Main.rand.Next(-240, -90) - num3;
				localAI[1] = fisher.rolledItemDrop;
				netUpdate = true;
				flag = true;
			}
			if (fisher.rolledEnemySpawn > 0)
			{
				if (Main.player[owner].sonarPotion)
				{
					PopupText.AssignAsSonarText(PopupText.NewText(PopupTextContext.SonarAlert, fisher.rolledEnemySpawn, base.Center, stay5TimesLonger: false));
				}
				float num4 = fisher.fishingLevel;
				ai[1] = (float)Main.rand.Next(-240, -90) - num4;
				localAI[1] = -fisher.rolledEnemySpawn;
				netUpdate = true;
				flag = true;
			}
			if (!flag && fisher.inLava)
			{
				int num5 = 0;
				if (ItemID.Sets.IsLavaBait[fisher.playerFishingConditions.BaitItemType])
				{
					num5++;
				}
				if (ItemID.Sets.CanFishInLava[fisher.playerFishingConditions.PoleItemType])
				{
					num5++;
				}
				if (Main.player[owner].accLavaFishing)
				{
					num5++;
				}
				if (num5 >= 2)
				{
					localAI[1] += 240f;
				}
			}
			if (fisher.CanFishInLava && fisher.inLava)
			{
				AchievementsHelper.HandleSpecialEvent(Main.player[owner], 19);
			}
		}

		private void FishingCheck_RollEnemySpawns(ref FishingAttempt fisher)
		{
			if (fisher.inLava || fisher.inHoney || !Main.bloodMoon || Main.dayTime)
			{
				return;
			}
			int maxValue = 6;
			if (fisher.playerFishingConditions.PoleItemType == 4325)
			{
				maxValue = 3;
			}
			if (Main.rand.Next(maxValue) != 0)
			{
				return;
			}
			if (!NPC.unlockedSlimeRedSpawn && Main.rand.Next(5) == 0)
			{
				fisher.rolledEnemySpawn = 682;
			}
			else if (Main.hardMode)
			{
				fisher.rolledEnemySpawn = Utils.SelectRandom(Main.rand, new short[4] { 620, 621, 586, 587 });
				if (Main.rand.Next(10) == 0)
				{
					fisher.rolledEnemySpawn = 618;
				}
			}
			else
			{
				fisher.rolledEnemySpawn = Utils.SelectRandom(Main.rand, new short[2] { 586, 587 });
			}
		}

		private void FishingCheck_RollItemDrop(ref FishingAttempt fisher)
		{
			bool flag = Main.player[owner].ZoneCorrupt;
			bool flag2 = Main.player[owner].ZoneCrimson;
			bool flag3 = Main.player[owner].ZoneJungle;
			bool flag4 = Main.player[owner].ZoneSnow;
			bool flag5 = Main.player[owner].ZoneDungeon;
			if (!NPC.downedBoss3)
			{
				flag5 = false;
			}
			if (Main.notTheBeesWorld && !Main.remixWorld && Main.rand.Next(2) == 0)
			{
				flag3 = false;
			}
			if (Main.remixWorld && fisher.heightLevel == 0)
			{
				flag = false;
				flag2 = false;
			}
			else if (flag && flag2)
			{
				if (Main.rand.Next(2) == 0)
				{
					flag2 = false;
				}
				else
				{
					flag = false;
				}
			}
			if (fisher.rolledEnemySpawn > 0)
			{
				return;
			}
			if (fisher.inLava)
			{
				if (fisher.CanFishInLava)
				{
					if (fisher.crate && Main.rand.Next(6) == 0)
					{
						fisher.rolledItemDrop = (Main.hardMode ? 4878 : 4877);
					}
					else if (fisher.legendary && Main.hardMode && Main.rand.Next(3) == 0)
					{
						fisher.rolledItemDrop = Main.rand.NextFromList(new short[4] { 4819, 4820, 4872, 2331 });
					}
					else if (fisher.legendary && !Main.hardMode && Main.rand.Next(3) == 0)
					{
						fisher.rolledItemDrop = Main.rand.NextFromList(new short[3] { 4819, 4820, 4872 });
					}
					else if (fisher.veryrare)
					{
						fisher.rolledItemDrop = 2312;
					}
					else if (fisher.rare)
					{
						fisher.rolledItemDrop = 2315;
					}
				}
				return;
			}
			if (fisher.inHoney)
			{
				if (fisher.rare || (fisher.uncommon && Main.rand.Next(2) == 0))
				{
					fisher.rolledItemDrop = 2314;
				}
				else if (fisher.uncommon && fisher.questFish == 2451)
				{
					fisher.rolledItemDrop = 2451;
				}
				return;
			}
			if (Main.rand.Next(50) > fisher.fishingLevel && Main.rand.Next(50) > fisher.fishingLevel && fisher.waterTilesCount < fisher.waterNeededToFish)
			{
				fisher.rolledItemDrop = Main.rand.Next(2337, 2340);
				if (Main.rand.Next(8) == 0)
				{
					fisher.rolledItemDrop = 5275;
				}
				return;
			}
			if (fisher.crate)
			{
				bool hardMode = Main.hardMode;
				if (fisher.rare && flag5)
				{
					fisher.rolledItemDrop = (hardMode ? 3984 : 3205);
				}
				else if (fisher.rare && (Main.player[owner].ZoneBeach || (Main.remixWorld && fisher.heightLevel == 1 && (double)fisher.Y >= Main.rockLayer && Main.rand.Next(2) == 0)))
				{
					fisher.rolledItemDrop = (hardMode ? 5003 : 5002);
				}
				else if (fisher.rare && flag)
				{
					fisher.rolledItemDrop = (hardMode ? 3982 : 3203);
				}
				else if (fisher.rare && flag2)
				{
					fisher.rolledItemDrop = (hardMode ? 3983 : 3204);
				}
				else if (fisher.rare && Main.player[owner].ZoneHallow)
				{
					fisher.rolledItemDrop = (hardMode ? 3986 : 3207);
				}
				else if (fisher.rare && flag3)
				{
					fisher.rolledItemDrop = (hardMode ? 3987 : 3208);
				}
				else if (fisher.rare && Main.player[owner].ZoneSnow)
				{
					fisher.rolledItemDrop = (hardMode ? 4406 : 4405);
				}
				else if (fisher.rare && Main.player[owner].ZoneDesert)
				{
					fisher.rolledItemDrop = (hardMode ? 4408 : 4407);
				}
				else if (fisher.rare && fisher.heightLevel == 0)
				{
					fisher.rolledItemDrop = (hardMode ? 3985 : 3206);
				}
				else if (fisher.veryrare || fisher.legendary)
				{
					fisher.rolledItemDrop = (hardMode ? 3981 : 2336);
				}
				else if (fisher.uncommon)
				{
					fisher.rolledItemDrop = (hardMode ? 3980 : 2335);
				}
				else
				{
					fisher.rolledItemDrop = (hardMode ? 3979 : 2334);
				}
				return;
			}
			if (!NPC.combatBookWasUsed && Main.bloodMoon && fisher.legendary && Main.rand.Next(3) == 0)
			{
				fisher.rolledItemDrop = 4382;
				return;
			}
			if (Main.bloodMoon && fisher.legendary && Main.rand.Next(2) == 0)
			{
				fisher.rolledItemDrop = 5240;
				return;
			}
			if (fisher.legendary && Main.rand.Next(5) == 0)
			{
				fisher.rolledItemDrop = 2423;
				return;
			}
			if (fisher.legendary && Main.rand.Next(5) == 0)
			{
				fisher.rolledItemDrop = 3225;
				return;
			}
			if (fisher.legendary && Main.rand.Next(10) == 0)
			{
				fisher.rolledItemDrop = 2420;
				return;
			}
			if (!fisher.legendary && !fisher.veryrare && fisher.uncommon && Main.rand.Next(5) == 0)
			{
				fisher.rolledItemDrop = 3196;
				return;
			}
			bool flag6 = Main.player[owner].ZoneDesert;
			if (flag5)
			{
				flag6 = false;
				if (fisher.rolledItemDrop == 0 && fisher.veryrare && Main.rand.Next(7) == 0)
				{
					fisher.rolledItemDrop = 3000;
				}
			}
			else
			{
				if (flag)
				{
					if (fisher.legendary && Main.hardMode && Main.player[owner].ZoneSnow && fisher.heightLevel == 3 && Main.rand.Next(3) != 0)
					{
						fisher.rolledItemDrop = 2429;
					}
					else if (fisher.legendary && Main.hardMode && Main.rand.Next(2) == 0)
					{
						fisher.rolledItemDrop = 3210;
					}
					else if (fisher.rare)
					{
						fisher.rolledItemDrop = 2330;
					}
					else if (fisher.uncommon && fisher.questFish == 2454)
					{
						fisher.rolledItemDrop = 2454;
					}
					else if (fisher.uncommon && fisher.questFish == 2485)
					{
						fisher.rolledItemDrop = 2485;
					}
					else if (fisher.uncommon && fisher.questFish == 2457)
					{
						fisher.rolledItemDrop = 2457;
					}
					else if (fisher.uncommon)
					{
						fisher.rolledItemDrop = 2318;
					}
				}
				else if (flag2)
				{
					if (fisher.legendary && Main.hardMode && Main.player[owner].ZoneSnow && fisher.heightLevel == 3 && Main.rand.Next(3) != 0)
					{
						fisher.rolledItemDrop = 2429;
					}
					else if (fisher.legendary && Main.hardMode && Main.rand.Next(2) == 0)
					{
						fisher.rolledItemDrop = 3211;
					}
					else if (fisher.uncommon && fisher.questFish == 2477)
					{
						fisher.rolledItemDrop = 2477;
					}
					else if (fisher.uncommon && fisher.questFish == 2463)
					{
						fisher.rolledItemDrop = 2463;
					}
					else if (fisher.uncommon)
					{
						fisher.rolledItemDrop = 2319;
					}
					else if (fisher.common)
					{
						fisher.rolledItemDrop = 2305;
					}
				}
				else if (Main.player[owner].ZoneHallow)
				{
					if (flag6 && Main.rand.Next(2) == 0)
					{
						if (fisher.uncommon && fisher.questFish == 4393)
						{
							fisher.rolledItemDrop = 4393;
						}
						else if (fisher.uncommon && fisher.questFish == 4394)
						{
							fisher.rolledItemDrop = 4394;
						}
						else if (fisher.uncommon)
						{
							fisher.rolledItemDrop = 4410;
						}
						else if (Main.rand.Next(3) == 0)
						{
							fisher.rolledItemDrop = 4402;
						}
						else
						{
							fisher.rolledItemDrop = 4401;
						}
					}
					else if (fisher.legendary && Main.hardMode && Main.player[owner].ZoneSnow && fisher.heightLevel == 3 && Main.rand.Next(3) != 0)
					{
						fisher.rolledItemDrop = 2429;
					}
					else if (fisher.legendary && Main.hardMode && Main.rand.Next(2) == 0)
					{
						fisher.rolledItemDrop = 3209;
					}
					else if (fisher.legendary && Main.hardMode && Main.rand.Next(3) != 0)
					{
						fisher.rolledItemDrop = 5274;
					}
					else if (fisher.heightLevel > 1 && fisher.veryrare)
					{
						fisher.rolledItemDrop = 2317;
					}
					else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2465)
					{
						fisher.rolledItemDrop = 2465;
					}
					else if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2468)
					{
						fisher.rolledItemDrop = 2468;
					}
					else if (fisher.rare)
					{
						fisher.rolledItemDrop = 2310;
					}
					else if (fisher.uncommon && fisher.questFish == 2471)
					{
						fisher.rolledItemDrop = 2471;
					}
					else if (fisher.uncommon)
					{
						fisher.rolledItemDrop = 2307;
					}
				}
				if (fisher.rolledItemDrop == 0 && Main.player[owner].ZoneGlowshroom && fisher.uncommon && fisher.questFish == 2475)
				{
					fisher.rolledItemDrop = 2475;
				}
				if (flag4 && flag3 && Main.rand.Next(2) == 0)
				{
					flag4 = false;
				}
				if (fisher.rolledItemDrop == 0 && flag4)
				{
					if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2467)
					{
						fisher.rolledItemDrop = 2467;
					}
					else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2470)
					{
						fisher.rolledItemDrop = 2470;
					}
					else if (fisher.heightLevel >= 2 && fisher.uncommon && fisher.questFish == 2484)
					{
						fisher.rolledItemDrop = 2484;
					}
					else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2466)
					{
						fisher.rolledItemDrop = 2466;
					}
					else if ((fisher.common && Main.rand.Next(12) == 0) || (fisher.uncommon && Main.rand.Next(6) == 0))
					{
						fisher.rolledItemDrop = 3197;
					}
					else if (fisher.uncommon)
					{
						fisher.rolledItemDrop = 2306;
					}
					else if (fisher.common)
					{
						fisher.rolledItemDrop = 2299;
					}
					else if (fisher.heightLevel > 1 && Main.rand.Next(3) == 0)
					{
						fisher.rolledItemDrop = 2309;
					}
				}
				if (fisher.rolledItemDrop == 0 && flag3)
				{
					if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2452)
					{
						fisher.rolledItemDrop = 2452;
					}
					else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2483)
					{
						fisher.rolledItemDrop = 2483;
					}
					else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2488)
					{
						fisher.rolledItemDrop = 2488;
					}
					else if (fisher.heightLevel >= 1 && fisher.uncommon && fisher.questFish == 2486)
					{
						fisher.rolledItemDrop = 2486;
					}
					else if (fisher.heightLevel > 1 && fisher.uncommon)
					{
						fisher.rolledItemDrop = 2311;
					}
					else if (fisher.uncommon)
					{
						fisher.rolledItemDrop = 2313;
					}
					else if (fisher.common)
					{
						fisher.rolledItemDrop = 2302;
					}
				}
			}
			if (fisher.rolledItemDrop == 0)
			{
				if ((Main.remixWorld && fisher.heightLevel == 1 && (double)fisher.Y >= Main.rockLayer && Main.rand.Next(3) == 0) || (fisher.heightLevel <= 1 && (fisher.X < 380 || fisher.X > Main.maxTilesX - 380) && fisher.waterTilesCount > 1000))
				{
					if (fisher.veryrare && Main.rand.Next(2) == 0)
					{
						fisher.rolledItemDrop = 2341;
					}
					else if (fisher.veryrare)
					{
						fisher.rolledItemDrop = 2342;
					}
					else if (fisher.rare && Main.rand.Next(5) == 0)
					{
						fisher.rolledItemDrop = 2438;
					}
					else if (fisher.rare && Main.rand.Next(3) == 0)
					{
						fisher.rolledItemDrop = 2332;
					}
					else if (fisher.uncommon && fisher.questFish == 2480)
					{
						fisher.rolledItemDrop = 2480;
					}
					else if (fisher.uncommon && fisher.questFish == 2481)
					{
						fisher.rolledItemDrop = 2481;
					}
					else if (fisher.uncommon)
					{
						fisher.rolledItemDrop = 2316;
					}
					else if (fisher.common && Main.rand.Next(2) == 0)
					{
						fisher.rolledItemDrop = 2301;
					}
					else if (fisher.common)
					{
						fisher.rolledItemDrop = 2300;
					}
					else
					{
						fisher.rolledItemDrop = 2297;
					}
				}
				else if (flag6)
				{
					if (fisher.uncommon && fisher.questFish == 4393)
					{
						fisher.rolledItemDrop = 4393;
					}
					else if (fisher.uncommon && fisher.questFish == 4394)
					{
						fisher.rolledItemDrop = 4394;
					}
					else if (fisher.uncommon)
					{
						fisher.rolledItemDrop = 4410;
					}
					else if (Main.rand.Next(3) == 0)
					{
						fisher.rolledItemDrop = 4402;
					}
					else
					{
						fisher.rolledItemDrop = 4401;
					}
				}
			}
			if (fisher.rolledItemDrop != 0)
			{
				return;
			}
			if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2461)
			{
				fisher.rolledItemDrop = 2461;
			}
			else if (fisher.heightLevel == 0 && fisher.uncommon && fisher.questFish == 2453)
			{
				fisher.rolledItemDrop = 2453;
			}
			else if (fisher.heightLevel == 0 && fisher.uncommon && fisher.questFish == 2473)
			{
				fisher.rolledItemDrop = 2473;
			}
			else if (fisher.heightLevel == 0 && fisher.uncommon && fisher.questFish == 2476)
			{
				fisher.rolledItemDrop = 2476;
			}
			else if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2458)
			{
				fisher.rolledItemDrop = 2458;
			}
			else if (fisher.heightLevel < 2 && fisher.uncommon && fisher.questFish == 2459)
			{
				fisher.rolledItemDrop = 2459;
			}
			else if (fisher.heightLevel == 0 && fisher.uncommon)
			{
				fisher.rolledItemDrop = 2304;
			}
			else if (fisher.heightLevel > 0 && fisher.heightLevel < 3 && fisher.uncommon && fisher.questFish == 2455)
			{
				fisher.rolledItemDrop = 2455;
			}
			else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2479)
			{
				fisher.rolledItemDrop = 2479;
			}
			else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2456)
			{
				fisher.rolledItemDrop = 2456;
			}
			else if (fisher.heightLevel == 1 && fisher.uncommon && fisher.questFish == 2474)
			{
				fisher.rolledItemDrop = 2474;
			}
			else if (fisher.heightLevel > 1 && fisher.rare && Main.rand.Next(5) == 0)
			{
				if (Main.hardMode && Main.rand.Next(2) == 0)
				{
					fisher.rolledItemDrop = 2437;
				}
				else
				{
					fisher.rolledItemDrop = 2436;
				}
			}
			else if (fisher.heightLevel > 1 && fisher.legendary && Main.rand.Next(3) != 0)
			{
				fisher.rolledItemDrop = 2308;
			}
			else if (fisher.heightLevel > 1 && fisher.veryrare && Main.rand.Next(2) == 0)
			{
				fisher.rolledItemDrop = 2320;
			}
			else if (fisher.heightLevel > 1 && fisher.rare)
			{
				fisher.rolledItemDrop = 2321;
			}
			else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2478)
			{
				fisher.rolledItemDrop = 2478;
			}
			else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2450)
			{
				fisher.rolledItemDrop = 2450;
			}
			else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2464)
			{
				fisher.rolledItemDrop = 2464;
			}
			else if (fisher.heightLevel > 1 && fisher.uncommon && fisher.questFish == 2469)
			{
				fisher.rolledItemDrop = 2469;
			}
			else if (fisher.heightLevel > 2 && fisher.uncommon && fisher.questFish == 2462)
			{
				fisher.rolledItemDrop = 2462;
			}
			else if (fisher.heightLevel > 2 && fisher.uncommon && fisher.questFish == 2482)
			{
				fisher.rolledItemDrop = 2482;
			}
			else if (fisher.heightLevel > 2 && fisher.uncommon && fisher.questFish == 2472)
			{
				fisher.rolledItemDrop = 2472;
			}
			else if (fisher.heightLevel > 2 && fisher.uncommon && fisher.questFish == 2460)
			{
				fisher.rolledItemDrop = 2460;
			}
			else if (fisher.heightLevel > 1 && fisher.uncommon && Main.rand.Next(4) != 0)
			{
				fisher.rolledItemDrop = 2303;
			}
			else if (fisher.heightLevel > 1 && (fisher.uncommon || fisher.common || Main.rand.Next(4) == 0))
			{
				if (Main.rand.Next(4) == 0)
				{
					fisher.rolledItemDrop = 2303;
				}
				else
				{
					fisher.rolledItemDrop = 2309;
				}
			}
			else if (fisher.uncommon && fisher.questFish == 2487)
			{
				fisher.rolledItemDrop = 2487;
			}
			else if (fisher.waterTilesCount > 1000 && fisher.common)
			{
				fisher.rolledItemDrop = 2298;
			}
			else
			{
				fisher.rolledItemDrop = 2290;
			}
		}

		private void FishingCheck_ProbeForQuestFish(ref FishingAttempt fisher)
		{
			fisher.questFish = Main.anglerQuestItemNetIDs[Main.anglerQuest];
			if (Main.player[owner].HasItem(fisher.questFish))
			{
				fisher.questFish = -1;
			}
			if (!NPC.AnyNPCs(369))
			{
				fisher.questFish = -1;
			}
			if (Main.anglerQuestFinished)
			{
				fisher.questFish = -1;
			}
		}

		private void FishingCheck_RollDropLevels(int fishingLevel, out bool common, out bool uncommon, out bool rare, out bool veryrare, out bool legendary, out bool crate)
		{
			int num = 150 / fishingLevel;
			int num2 = 150 * 2 / fishingLevel;
			int num3 = 150 * 7 / fishingLevel;
			int num4 = 150 * 15 / fishingLevel;
			int num5 = 150 * 30 / fishingLevel;
			int num6 = 10;
			if (Main.player[owner].cratePotion)
			{
				num6 += 15;
			}
			if (num < 2)
			{
				num = 2;
			}
			if (num2 < 3)
			{
				num2 = 3;
			}
			if (num3 < 4)
			{
				num3 = 4;
			}
			if (num4 < 5)
			{
				num4 = 5;
			}
			if (num5 < 6)
			{
				num5 = 6;
			}
			common = false;
			uncommon = false;
			rare = false;
			veryrare = false;
			legendary = false;
			crate = false;
			if (Main.rand.Next(num) == 0)
			{
				common = true;
			}
			if (Main.rand.Next(num2) == 0)
			{
				uncommon = true;
			}
			if (Main.rand.Next(num3) == 0)
			{
				rare = true;
			}
			if (Main.rand.Next(num4) == 0)
			{
				veryrare = true;
			}
			if (Main.rand.Next(num5) == 0)
			{
				legendary = true;
			}
			if (Main.rand.Next(100) < num6)
			{
				crate = true;
			}
		}

		private static void GetFishingPondState(int x, int y, out bool lava, out bool honey, out int numWaters, out int chumCount)
		{
			lava = false;
			honey = false;
			numWaters = 0;
			chumCount = 0;
			Point tileCoords = new Point(0, 0);
			GetFishingPondWidth(x, y, out var minX, out var maxX);
			for (int i = minX; i <= maxX; i++)
			{
				int num = y;
				while (Main.tile[i, num].liquid > 0 && !WorldGen.SolidTile(i, num) && num < Main.maxTilesY - 10)
				{
					numWaters++;
					num++;
					if (Main.tile[i, num].lava())
					{
						lava = true;
					}
					else if (Main.tile[i, num].honey())
					{
						honey = true;
					}
					tileCoords.X = i;
					tileCoords.Y = num;
					chumCount += Main.instance.ChumBucketProjectileHelper.GetChumsInLocation(tileCoords);
				}
			}
			if (honey)
			{
				numWaters = (int)((double)numWaters * 1.5);
			}
		}

		private static void GetFishingPondWidth(int x, int y, out int minX, out int maxX)
		{
			minX = x;
			maxX = x;
			while (minX > 10 && Main.tile[minX, y].liquid > 0 && !WorldGen.SolidTile(minX, y))
			{
				minX--;
			}
			while (maxX < Main.maxTilesX - 10 && Main.tile[maxX, y].liquid > 0 && !WorldGen.SolidTile(maxX, y))
			{
				maxX++;
			}
		}

		public bool CanBeReflected()
		{
			if (active && friendly && !hostile && damage > 0)
			{
				if (type == 728 || type == 955)
				{
					return true;
				}
				if (aiStyle == 1 || aiStyle == 2 || aiStyle == 8 || aiStyle == 21 || aiStyle == 24 || aiStyle == 28 || aiStyle == 29 || aiStyle == 131)
				{
					return true;
				}
			}
			return false;
		}

		public Color GetFairyQueenWeaponsColor(float alphaChannelMultiplier = 1f, float lerpToWhite = 0f, float? rawHueOverride = null)
		{
			float num = ai[1];
			if (rawHueOverride.HasValue)
			{
				num = rawHueOverride.Value;
			}
			float num2 = (num + 0.5f) % 1f;
			float saturation = 1f;
			float luminosity = 0.5f;
			if (Main.player[owner].active)
			{
				switch (Main.player[owner].name)
				{
				case "Cenx":
				{
					float amount13 = Utils.PingPongFrom01To010(num2);
					amount13 = MathHelper.SmoothStep(0f, 1f, amount13);
					amount13 = MathHelper.SmoothStep(0f, 1f, amount13);
					Color color3 = Color.Lerp(new Color(0.3f, 1f, 0.2f), Color.HotPink, amount13);
					if (lerpToWhite != 0f)
					{
						color3 = Color.Lerp(color3, Color.White, lerpToWhite);
					}
					color3.A = (byte)((float)(int)color3.A * alphaChannelMultiplier);
					return color3;
				}
				case "Crowno":
					luminosity = MathHelper.Lerp(0.25f, 0.4f, Utils.Turn01ToCyclic010(num2));
					num2 = MathHelper.Lerp(127f / 180f, 47f / 60f, Utils.Turn01ToCyclic010(num2));
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Yoraiz0r":
					num2 = MathHelper.Lerp(0.9f, 0.95f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					break;
				case "Jaxrud":
					num2 = MathHelper.Lerp(13f / 72f, 0.43611112f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					break;
				case "Lazure":
					num2 = MathHelper.Lerp(8f / 15f, 83f / 90f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					break;
				case "Leinfors":
					num2 = MathHelper.Lerp(0.7f, 0.77f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					break;
				case "Grox The Great":
					num2 = MathHelper.Lerp(0.31f, 0.5f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 1f, 0.8f);
					break;
				case "Acamaeda":
					num2 = MathHelper.Lerp(0.06f, 0.28f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Alchemystics":
					num2 = MathHelper.Lerp(0.74f, 0.96f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.6f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Antithesis":
				{
					num2 = 0.51f;
					float amount14 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(0f, 0.5f, amount14);
					break;
				}
				case "Aurora3500":
					num2 = MathHelper.Lerp(0.33f, 0.8f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Bame":
				{
					float amount12 = Utils.PingPongFrom01To010(num2);
					amount12 = MathHelper.SmoothStep(0f, 1f, amount12);
					amount12 = MathHelper.SmoothStep(0f, 1f, amount12);
					Color color2 = Color.Lerp(Color.Yellow, new Color(0.4f, 0f, 0.75f), amount12);
					if (lerpToWhite != 0f)
					{
						color2 = Color.Lerp(color2, Color.White, lerpToWhite);
					}
					color2.A = (byte)((float)(int)color2.A * alphaChannelMultiplier);
					return color2;
				}
				case "Criddle":
					num2 = MathHelper.Lerp(0.05f, 0.15f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Darthkitten":
				{
					num2 = 1f;
					float amount11 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(1f, 0.4f, amount11);
					break;
				}
				case "darthmorf":
				{
					num2 = 0f;
					float amount10 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(0f, 0.2f, amount10);
					break;
				}
				case "Discipile":
				{
					num2 = 0.53f;
					float amount9 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(0.05f, 0.5f, amount9);
					break;
				}
				case "Doylee":
					num2 = MathHelper.Lerp(0.68f, 1f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Ghostar":
				{
					num2 = 0.66f;
					float amount8 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(0.15f, 0.85f, amount8);
					break;
				}
				case "Jenosis":
					num2 = MathHelper.Lerp(0.9f, 1.13f, Utils.Turn01ToCyclic010(num2)) % 1f;
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Kazzymodus":
				{
					num2 = 0.33f;
					float amount7 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(0.15f, 0.4f, amount7);
					break;
				}
				case "Khaios":
				{
					num2 = 0.33f;
					float amount6 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(0f, 0.2f, amount6);
					break;
				}
				case "Loki":
				{
					num2 = 0f;
					float amount5 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(0f, 0.25f, amount5);
					break;
				}
				case "ManaUser":
					num2 = MathHelper.Lerp(0.41f, 0.57f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					break;
				case "Mid":
				{
					num2 = 0f;
					float amount4 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(0f, 0.9f, amount4);
					break;
				}
				case "Nimbus":
					num2 = MathHelper.Lerp(0.75f, 1f, Utils.Turn01ToCyclic010(num2));
					luminosity = 1f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.8f);
					break;
				case "Nike Leon":
					num2 = MathHelper.Lerp(0.04f, 0.1f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "ppowersteef":
					num2 = MathHelper.Lerp(0f, 0.15f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "RBrandon":
					num2 = 0.03f;
					luminosity = 0.3f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Redigit":
					num2 = 0.7f;
					luminosity = 0.5f;
					break;
				case "Serenity":
				{
					num2 = 0.85f;
					float amount3 = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(1f, 0.5f, amount3);
					break;
				}
				case "Sigma":
					num2 = MathHelper.Lerp(0f, 0.12f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "teiull":
					num2 = MathHelper.Lerp(0.66f, 1f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					break;
				case "Unit One":
				{
					float amount2 = Utils.PingPongFrom01To010(num2);
					amount2 = MathHelper.SmoothStep(0f, 1f, amount2);
					Color color = Color.Lerp(Color.Yellow, Color.Blue, amount2);
					if (lerpToWhite != 0f)
					{
						color = Color.Lerp(color, Color.White, lerpToWhite);
					}
					color.A = (byte)((float)(int)color.A * alphaChannelMultiplier);
					return color;
				}
				case "Vulpes Inculta":
					num2 = MathHelper.Lerp(0.65f, 0.75f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.5f, 0.5f);
					break;
				case "Waze3174":
					num2 = MathHelper.Lerp(0.33f, 0f, Utils.Turn01ToCyclic010(num2));
					luminosity = 0.3f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				case "Xman101":
				{
					num2 = 0.06f;
					float amount = (float)Math.Cos(num * (MathF.PI * 2f)) * 0.5f + 0.5f;
					luminosity = MathHelper.Lerp(0f, 0.5f, amount);
					break;
				}
				case "Zoomo":
					num2 = 0.77f;
					luminosity = 0.5f;
					alphaChannelMultiplier = MathHelper.Lerp(alphaChannelMultiplier, 0.6f, 0.5f);
					break;
				}
			}
			Color color4 = Main.hslToRgb(num2, saturation, luminosity);
			color4 *= Opacity;
			if (lerpToWhite != 0f)
			{
				color4 = Color.Lerp(color4, Color.White, lerpToWhite);
			}
			color4.A = (byte)((float)(int)color4.A * alphaChannelMultiplier);
			return color4;
		}

		public float GetLastPrismHue(float laserIndex, ref float laserLuminance, ref float laserAlphaMultiplier)
		{
			if (Main.player[owner].active)
			{
				double timeForVisualEffects = Main.timeForVisualEffects;
				switch (Main.player[owner].name)
				{
				case "Cenx":
				{
					float amount2 = Utils.PingPongFrom01To010(laserIndex / 6f);
					amount2 = MathHelper.SmoothStep(0f, 1f, amount2);
					amount2 = MathHelper.SmoothStep(0f, 1f, amount2);
					return Main.rgbToHsl(Color.Lerp(new Color(0.3f, 1f, 0.2f), Color.HotPink, amount2)).X;
				}
				case "Crowno":
					laserLuminance = MathHelper.Lerp(0.25f, 0.4f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.5f;
					return MathHelper.Lerp(127f / 180f, 47f / 60f, Utils.Turn01ToCyclic010(laserIndex / 6f));
				case "Tsuki":
				case "Yoraiz0r":
					return 0.92f;
				case "Lazure":
					return MathHelper.Lerp(8f / 15f, 83f / 90f, Utils.Turn01ToCyclic010(laserIndex / 6f));
				case "Jaxrud":
					return MathHelper.Lerp(13f / 72f, 0.43611112f, Utils.Turn01ToCyclic010(laserIndex / 6f));
				case "Ghostar":
					laserLuminance = MathHelper.Lerp(0.4f, 0.7f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.3f;
					return 0.66f;
				case "Devalaous":
					return 0.66f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.1f;
				case "Leinfors":
					return 0.73f + (float)Math.Cos(timeForVisualEffects / 3.0 * 6.2831854820251465) * 0.03f;
				case "Aeroblop":
					return 0.25f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.1f;
				case "Doylee":
					return 0.84f + (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465) * 0.16f;
				case "Darkhalis":
				case "Arkhalis":
					return 0.75f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.07f;
				case "Nike Leon":
					return 0.07f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.04f;
				case "Suweeka":
					return 0.5f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.18f;
				case "W1K":
					return 0.75f + (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465) * 0.05f;
				case "Grox The Great":
					return 0.41f + (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465) * 0.1f;
				case "Acamaeda":
					return 0.18f + (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465) * 0.1f;
				case "Alchemystics":
					return 0.73f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.18f;
				case "Antithesis":
					laserLuminance = 0.25f;
					laserAlphaMultiplier = 0.4f;
					return 0.7f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.05f;
				case "Aurora3500":
					laserLuminance = MathHelper.Lerp(0f, 0.5f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.25f;
					return 0.35f;
				case "Bame":
				{
					float amount = Utils.PingPongFrom01To010(laserIndex / 6f);
					amount = MathHelper.SmoothStep(0f, 1f, amount);
					amount = MathHelper.SmoothStep(0f, 1f, amount);
					return Main.rgbToHsl(Color.Lerp(Color.Yellow, new Color(0.2f, 0f, 0.7f), amount)).X;
				}
				case "Criddle":
					return 0.91f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.19f;
				case "Darthkitten":
					laserLuminance = MathHelper.Lerp(0.4f, 0.9f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.3f;
					return 1f;
				case "darthmorf":
					laserLuminance = MathHelper.Lerp(0f, 0.2f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.4f;
					return 0f;
				case "Discipile":
					laserLuminance = MathHelper.Lerp(0f, 0.4f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.35f;
					return 0.55f;
				case "Jenosis":
					return 0.66f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.08f;
				case "Kazzymodus":
					laserLuminance = MathHelper.Lerp(0.6f, 0.8f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.3f;
					return 0.33f;
				case "Khaios":
					laserLuminance = MathHelper.Lerp(0f, 0.1f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.25f;
					return 0.35f;
				case "Loki":
					laserLuminance = MathHelper.Lerp(0f, 0.3f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 5.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.4f;
					return 0f;
				case "ManaUser":
					return 0.49f + (float)Math.Cos(timeForVisualEffects / 140.0 * 6.2831854820251465) * 0.08f;
				case "Mid":
					laserLuminance = 0.25f;
					laserAlphaMultiplier = 0.4f;
					return 0.86f + (float)Math.Cos(timeForVisualEffects / 270.0 * 6.2831854820251465) * 0.13f;
				case "Nimbus":
					laserLuminance = MathHelper.Lerp(0f, 0.3f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 20.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.2f;
					return 0.75f;
				case "ppowersteef":
					laserLuminance = MathHelper.Lerp(0.1f, 0.5f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.25f;
					return 0.6f;
				case "RBrandon":
					laserLuminance = MathHelper.Lerp(0f, 0.5f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 105.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.4f;
					return 1f;
				case "Redigit":
					return 0.7f;
				case "Serenity":
					laserLuminance = MathHelper.Lerp(0.9f, 0.65f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.3f;
					return 0.85f;
				case "Sigma":
					return 0.06f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.06f;
				case "teiull":
					return 0.5f + (float)Math.Cos(timeForVisualEffects / 45.0 * 6.2831854820251465) * 0.3f;
				case "Unit One":
					return 0.38f + (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465) * 0.24f;
				case "Vulpes Inculta":
					return 0.7f + (float)Math.Cos(timeForVisualEffects / 180.0 * 6.2831854820251465) * 0.05f;
				case "Waze3174":
					return 0.38f + (float)Math.Cos(timeForVisualEffects / 90.0 * 6.2831854820251465) * 0.24f;
				case "Xman101":
					laserLuminance = MathHelper.Lerp(0.9f, 0.55f, Utils.GetLerpValue(-1f, 1f, (float)Math.Cos(timeForVisualEffects / 120.0 * 6.2831854820251465)));
					laserAlphaMultiplier = 0.2f;
					return 0.33f;
				case "Zoomo":
					return 0.77f;
				case "Random":
					return Main.rand.NextFloat();
				}
			}
			return (float)(int)laserIndex / 6f;
		}

		public static int GetByUUID(int owner, float uuid)
		{
			return GetByUUID(owner, (int)uuid);
		}

		public static int GetByUUID(int owner, int uuid)
		{
			if (uuid < 0 || uuid >= 1000 || owner < 0 || owner >= 255)
			{
				return -1;
			}
			int num = Main.projectileIdentity[owner, uuid];
			if (num >= 0 && Main.projectile[num].active)
			{
				return num;
			}
			return -1;
		}

		public void ProjectileFixDesperation()
		{
			if (owner < 0 || owner >= 255)
			{
				return;
			}
			switch (type)
			{
			case 461:
			case 632:
			case 642:
			case 644:
			{
				for (int i = 0; i < 1000; i++)
				{
					if (Main.projectile[i].owner == owner && (float)Main.projectile[i].identity == ai[1] && Main.projectile[i].active)
					{
						ai[1] = i;
						break;
					}
				}
				break;
			}
			}
		}

		public bool ShouldUseWindPhysics()
		{
			if (Main.windPhysics)
			{
				bool? flag = ProjectileID.Sets.WindPhysicsImmunity[type];
				if (flag.HasValue)
				{
					return !flag.Value;
				}
				switch (aiStyle)
				{
				case 1:
				case 2:
				case 8:
				case 10:
				case 14:
				case 16:
				case 17:
				case 21:
				case 24:
				case 28:
				case 29:
				case 32:
				case 33:
				case 34:
				case 35:
				case 49:
				case 72:
				case 93:
				case 96:
				case 106:
					return true;
				}
			}
			return false;
		}

		private void AI_151_SuperStar()
		{
			alpha -= 10;
			int num = 100;
			if (alpha < num)
			{
				alpha = num;
			}
			if (soundDelay == 0)
			{
				soundDelay = 20 + Main.rand.Next(40);
				SoundEngine.PlaySound(SoundID.Item9, position);
			}
			rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.005f * (float)direction;
			Vector2 vector = new Vector2(Main.screenWidth, Main.screenHeight);
			if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector / 2f, vector + new Vector2(400f))) && Main.rand.Next(6) == 0)
			{
				Gore.NewGore(position, velocity * 0.2f, Utils.SelectRandom<int>(Main.rand, 16, 17, 17, 17));
			}
			for (int i = 0; i < 2; i++)
			{
				if (Main.rand.Next(8) == 0)
				{
					int num2 = 228;
					Dust dust = Dust.NewDustDirect(position, width, height, num2, 0f, 0f, 127);
					dust.velocity *= 0.25f;
					dust.scale = 1.3f;
					dust.noGravity = true;
					dust.velocity += velocity.RotatedBy(MathF.PI / 8f * (1f - (float)(2 * i))) * 0.2f;
				}
			}
		}

		public bool IsInterruptible(Player player)
		{
			int num = aiStyle;
			if (num == 160)
			{
				return true;
			}
			return false;
		}

		public void Interrupt(Player player)
		{
			int num = aiStyle;
			if (num == 160)
			{
				Kill();
				player.heldProj = -1;
				player.itemAnimation = 0;
				player.itemTime = 0;
			}
		}

		public static IEntitySource GetNoneSource()
		{
			return null;
		}

		public IEntitySource GetNPCSource_FromThis()
		{
			return new EntitySource_Parent(this);
		}

		public IEntitySource GetProjectileSource_FromThis()
		{
			return new EntitySource_Parent(this);
		}

		public IEntitySource GetItemSource_DropAsItem()
		{
			return new EntitySource_DropAsItem(this);
		}

		public IEntitySource GetItemSource_FromThis()
		{
			return new EntitySource_Parent(this);
		}

		public IEntitySource GetProjectileSource_OnHit(Entity victim, int projectileSourceId)
		{
			return new EntitySource_OnHit_ByProjectileSourceID(this, victim, projectileSourceId);
		}

		public IEntitySource GetItemSource_OnHit(Entity victim, int itemSourceId)
		{
			return new EntitySource_OnHit_ByItemSourceID(this, victim, itemSourceId);
		}

		public static IEntitySource InheritSource(Projectile projectile)
		{
			return projectile?.GetProjectileSource_FromThis();
		}

		private void AI_152_SuperStarSlash()
		{
			float num = MathF.PI / 2f;
			bool flag = true;
			if (type == 976)
			{
				flag = false;
			}
			if (flag)
			{
				alpha -= 10;
				int num2 = 100;
				if (alpha < num2)
				{
					alpha = num2;
				}
			}
			if (soundDelay == 0)
			{
				if (type == 977)
				{
					soundDelay = -1;
					SoundEngine.PlaySound(SoundID.Item1, position);
				}
				else if (type == 976)
				{
					soundDelay = -1;
				}
				else
				{
					soundDelay = 20 + Main.rand.Next(40);
					SoundEngine.PlaySound(SoundID.Item9, position);
				}
			}
			if (ai[0] != 0f)
			{
				if (type == 976)
				{
					velocity = velocity.RotatedBy(ai[0]);
				}
				else
				{
					int num3 = 10 * MaxUpdates;
					velocity = velocity.RotatedBy(ai[0] / (float)num3);
				}
			}
			if (type == 977)
			{
				velocity *= 0.96f;
				if (Main.rand.Next(8) == 0)
				{
					Dust dust = Dust.NewDustDirect(base.Center, 0, 0, 172, velocity.X * 0.1f, velocity.Y * 0.1f, 100, default(Color), 0.9f);
					dust.noGravity = true;
					dust.position = base.Center;
					dust.velocity = Main.rand.NextVector2Circular(1f, 1f) + velocity * 0.5f;
				}
			}
			if (type == 976)
			{
				if (Collision.LavaCollision(position, width, height))
				{
					Kill();
					return;
				}
				if (++frameCounter >= 2)
				{
					frameCounter = 0;
					if (++frame >= 7)
					{
						frame = 0;
					}
				}
				float fromValue = 60 - timeLeft;
				float fromMax = ai[1] + 20f;
				float num4 = Utils.Remap(fromValue, ai[1], fromMax, 0f, 1f) * Utils.Remap(fromValue, ai[1], ai[1] + 60f, 1f, 0f);
				velocity = velocity.SafeNormalize(Vector2.UnitY) * (4f + 12f * (1f - num4));
				Opacity = Utils.Remap(fromValue, 0f, 10f, 0f, 1f) * Utils.Remap(fromValue, 30f, 60f, 1f, 0f);
				num = 0f;
				if (Main.rand.Next(3) == 0)
				{
					Dust dust2 = Dust.NewDustDirect(position, width, height, 40, 0f, 0f, 0, default(Color), 1.2f);
					dust2.noGravity = true;
					dust2.velocity = velocity * 0.5f;
				}
				if (localAI[1] == 0f)
				{
					localAI[1] = 1f;
					for (int i = 0; i < 10; i++)
					{
						Dust.NewDustDirect(position, width, height, 40, 0f, 0f, 0, default(Color), 0.7f).velocity = velocity.SafeNormalize(Vector2.UnitY).RotatedBy(Main.rand.NextFloat() * (MathF.PI * 2f) * 0.25f) * (Main.rand.NextFloat() * 3f);
					}
				}
			}
			rotation = velocity.ToRotation() + num;
			tileCollide = false;
		}

		public void Resize(int newWidth, int newHeight)
		{
			position = base.Center;
			width = newWidth;
			height = newHeight;
			base.Center = position;
		}

		private void Shimmer()
		{
			if (hostile || (aiStyle == 99 && ai[0] == -1f) || (aiStyle == 15 && (ai[0] == 2f || ai[0] == 4f)))
			{
				return;
			}
			if (type == 502)
			{
				velocity.Y -= 0.4f;
				timeLeft -= 5;
			}
			else if (type == 469 || type == 181)
			{
				velocity.Y -= 0.2f;
				if (type == 469 && velocity.Y < 0f)
				{
					Kill();
				}
			}
			else if (type == 819 || type == 117 || type == 474 || type == 225 || type == 103 || type == 2 || type == 82 || type == 120 || type == 172 || type == 41 || type == 91 || type == 278 || type == 5 || type == 639 || type == 631 || type == 495 || type == 4 || type == 282 || type == 1 || type == 81)
			{
				velocity.Y -= 0.4f;
			}
			else if (aiStyle == 1 || aiStyle == 16 || aiStyle == 40)
			{
				int num = (int)(base.Center.X / 16f);
				int num2 = (int)(position.Y / 16f);
				if (WorldGen.InWorld(num, num2) && Main.tile[num, num2] != null && Main.tile[num, num2].liquid == byte.MaxValue && Main.tile[num, num2].shimmer() && WorldGen.InWorld(num, num2 - 1) && Main.tile[num, num2 - 1] != null && Main.tile[num, num2 - 1].liquid > 0 && Main.tile[num, num2 - 1].shimmer())
				{
					Kill();
				}
				else if (velocity.Y > 0f)
				{
					velocity.Y *= -1f;
					netUpdate = true;
					if (timeLeft > 600)
					{
						timeLeft = 600;
					}
					timeLeft -= 60;
					shimmerWet = false;
					wet = false;
				}
			}
			else if (aiStyle == 5 || aiStyle == 8 || aiStyle == 21 || aiStyle == 28 || aiStyle == 29 || aiStyle == 33 || aiStyle == 36 || aiStyle == 47 || aiStyle == 93 || aiStyle == 115 || aiStyle == 151 || aiStyle == 152)
			{
				int num3 = (int)(base.Center.X / 16f);
				int num4 = (int)(position.Y / 16f);
				if (WorldGen.InWorld(num3, num4) && Main.tile[num3, num4] != null && Main.tile[num3, num4].liquid == byte.MaxValue && Main.tile[num3, num4].shimmer() && WorldGen.InWorld(num3, num4 - 1) && Main.tile[num3, num4 - 1] != null && Main.tile[num3, num4 - 1].liquid > 0 && Main.tile[num3, num4 - 1].shimmer())
				{
					Kill();
				}
				else if (velocity.Y > 0f)
				{
					velocity.Y *= -1f;
					netUpdate = true;
					shimmerWet = false;
					wet = false;
				}
			}
			else if (aiStyle == 15)
			{
				if (velocity.Y > 0f)
				{
					velocity.Y *= -1f;
					netUpdate = true;
				}
				velocity.Y -= 0.4f;
				if (velocity.Y < -8f)
				{
					velocity.Y = -8f;
				}
			}
			else if (aiStyle == 99)
			{
				if (velocity.Y > 0f)
				{
					velocity.Y *= -1f;
					netUpdate = true;
					shimmerWet = false;
					wet = false;
				}
				if (velocity.Y > -8f)
				{
					velocity.Y = -8f;
				}
			}
			else if (aiStyle == 7 || aiStyle == 9 || aiStyle == 13 || aiStyle == 35 || aiStyle == 53 || aiStyle == 130 || aiStyle == 134 || aiStyle == 137 || aiStyle == 138 || aiStyle == 149 || aiStyle == 160)
			{
				Kill();
			}
			else if (aiStyle == 2)
			{
				velocity.Y -= 0.7f;
				if (type == 936 && !NPC.unlockedSlimeRainbowSpawn && velocity.Y < 0f)
				{
					if (timeLeft > 5)
					{
						timeLeft = 5;
					}
					if (Main.netMode != 1)
					{
						NPC.unlockedSlimeRainbowSpawn = true;
						NetMessage.SendData(7);
						int num5 = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X + 4, (int)base.Center.Y, 681);
						NPC obj = Main.npc[num5];
						obj.velocity = velocity;
						obj.netUpdate = true;
					}
				}
				else
				{
					timeLeft -= 20;
				}
			}
			else if (aiStyle == 14 || aiStyle == 16)
			{
				if (timeLeft > 3000)
				{
					timeLeft -= 60;
				}
				velocity.Y -= 0.5f;
			}
			else if (aiStyle == 25 || aiStyle == 17)
			{
				if (velocity.Y > 10f)
				{
					velocity.Y *= 0.97f;
				}
				velocity.Y -= 0.7f;
				if (velocity.Y < -10f)
				{
					velocity.Y = -10f;
				}
			}
		}

		public void AI()
		{
			//IL_1abd3: Unknown result type (might be due to invalid IL or missing references)
			//IL_1ac0f: Unknown result type (might be due to invalid IL or missing references)
			//IL_1ac14: Unknown result type (might be due to invalid IL or missing references)
			//IL_1ac55: Unknown result type (might be due to invalid IL or missing references)
			//IL_1ac5a: Unknown result type (might be due to invalid IL or missing references)
			//IL_2fe2a: Unknown result type (might be due to invalid IL or missing references)
			//IL_305bc: Unknown result type (might be due to invalid IL or missing references)
			//IL_306ab: Unknown result type (might be due to invalid IL or missing references)
			if (aiStyle == 1)
			{
				AI_001();
			}
			else if (aiStyle == 2)
			{
				if (Main.windPhysics)
				{
					velocity.X += Main.windSpeedCurrent * Main.windPhysicsStrength;
				}
				if (type == 93 && Main.rand.Next(5) == 0)
				{
					int num = Dust.NewDust(base.position, width, height, 57, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100);
					Main.dust[num].noGravity = true;
					Main.dust[num].fadeIn = 1f;
					Main.dust[num].velocity.X *= 0.3f;
					Main.dust[num].velocity.Y *= 0.3f;
				}
				if (type == 968)
				{
					if (localAI[0] == 0f)
					{
						localAI[0] = 1f;
						Vector2 vector = Main.player[owner].velocity;
						float num2 = Utils.Remap(vector.Length(), 0f, 3f, 0f, 0.5f);
						Vector2 vector2 = base.Center + new Vector2(-8f, -8f) + velocity.SafeNormalize(Vector2.Zero) * 25f;
						for (int i = 0; i < 8; i++)
						{
							Dust dust = Main.dust[Dust.NewDust(vector2, 16, 16, 31, velocity.X, velocity.Y, 50, default(Color), 0.75f + Main.rand.NextFloat() * 0.3f)];
							dust.velocity = (velocity * (0.2f + num2)).RotatedByRandom(0.699999988079071) + vector * 0.25f;
							Dust dust2 = dust;
							dust2.velocity *= 0f + Main.rand.NextFloat() * 1f;
							dust.fadeIn = 0.1f;
							dust2 = dust;
							dust2.position -= dust.velocity;
							dust.noGravity = true;
						}
					}
					alpha = Math.Max(0, alpha - 50);
					frame = (int)this.ai[1];
				}
				if (type == 304 && localAI[0] == 0f)
				{
					localAI[0] += 1f;
					alpha = 0;
				}
				if (type == 510)
				{
					rotation += Math.Abs(velocity.X) * 0.04f * (float)direction;
				}
				else
				{
					rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.03f * (float)direction;
				}
				if (type == 909)
				{
					int num3 = 38;
					this.ai[0] += 1f;
					if (this.ai[0] >= (float)num3)
					{
						velocity.Y += 0.4f;
						velocity.X *= 0.97f;
					}
					if (Main.netMode != 1 && this.ai[1] == 0f)
					{
						this.ai[1] = 1 + Main.rand.Next(6);
						netUpdate = true;
					}
					if (this.ai[1] > 0f)
					{
						frame = (int)this.ai[1] - 1;
					}
				}
				else if (type == 162)
				{
					if (this.ai[1] == 0f)
					{
						this.ai[1] = 1f;
						SoundEngine.PlaySound(SoundID.Item14, base.position);
					}
					this.ai[0] += 1f;
					if (this.ai[0] >= 18f)
					{
						velocity.Y += 0.28f;
						velocity.X *= 0.99f;
					}
					if (this.ai[0] > 2f)
					{
						alpha = 0;
						if (this.ai[0] == 3f)
						{
							for (int j = 0; j < 10; j++)
							{
								int num4 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
								Dust dust2 = Main.dust[num4];
								dust2.velocity *= 0.5f;
								dust2 = Main.dust[num4];
								dust2.velocity += velocity * 0.1f;
							}
							for (int k = 0; k < 5; k++)
							{
								int num5 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
								Main.dust[num5].noGravity = true;
								Dust dust2 = Main.dust[num5];
								dust2.velocity *= 3f;
								dust2 = Main.dust[num5];
								dust2.velocity += velocity * 0.2f;
								num5 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100);
								dust2 = Main.dust[num5];
								dust2.velocity *= 2f;
								dust2 = Main.dust[num5];
								dust2.velocity += velocity * 0.3f;
							}
							for (int l = 0; l < 1; l++)
							{
								int num6 = Gore.NewGore(new Vector2(base.position.X - 10f, base.position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
								Gore gore = Main.gore[num6];
								gore.position += velocity * 1.25f;
								Main.gore[num6].scale = 1.5f;
								gore = Main.gore[num6];
								gore.velocity += velocity * 0.5f;
								gore = Main.gore[num6];
								gore.velocity *= 0.02f;
							}
						}
					}
				}
				else if (type == 281)
				{
					if (this.ai[1] == 0f)
					{
						this.ai[1] = 1f;
						SoundEngine.PlaySound(SoundID.Item14, base.position);
					}
					this.ai[0] += 1f;
					if (this.ai[0] >= 18f)
					{
						velocity.Y += 0.28f;
						velocity.X *= 0.99f;
					}
					if (this.ai[0] > 2f)
					{
						alpha = 0;
						if (this.ai[0] == 3f)
						{
							for (int m = 0; m < 10; m++)
							{
								int num7 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
								Dust dust2 = Main.dust[num7];
								dust2.velocity *= 0.5f;
								dust2 = Main.dust[num7];
								dust2.velocity += velocity * 0.1f;
							}
							for (int n = 0; n < 5; n++)
							{
								int num8 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
								Main.dust[num8].noGravity = true;
								Dust dust2 = Main.dust[num8];
								dust2.velocity *= 3f;
								dust2 = Main.dust[num8];
								dust2.velocity += velocity * 0.2f;
								num8 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100);
								dust2 = Main.dust[num8];
								dust2.velocity *= 2f;
								dust2 = Main.dust[num8];
								dust2.velocity += velocity * 0.3f;
							}
							for (int num9 = 0; num9 < 1; num9++)
							{
								int num10 = Gore.NewGore(new Vector2(base.position.X - 10f, base.position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
								Gore gore = Main.gore[num10];
								gore.position += velocity * 1.25f;
								Main.gore[num10].scale = 1.5f;
								gore = Main.gore[num10];
								gore.velocity += velocity * 0.5f;
								gore = Main.gore[num10];
								gore.velocity *= 0.02f;
							}
						}
					}
				}
				else if (type == 240)
				{
					if (this.ai[1] == 0f)
					{
						this.ai[1] = 1f;
						SoundEngine.PlaySound(SoundID.Item14, base.position);
					}
					this.ai[0] += 1f;
					if (this.ai[0] >= 16f)
					{
						velocity.Y += 0.18f;
						velocity.X *= 0.991f;
					}
					if (this.ai[0] > 2f)
					{
						alpha = 0;
						if (this.ai[0] == 3f)
						{
							for (int num11 = 0; num11 < 7; num11++)
							{
								int num12 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
								Dust dust2 = Main.dust[num12];
								dust2.velocity *= 0.5f;
								dust2 = Main.dust[num12];
								dust2.velocity += velocity * 0.1f;
							}
							for (int num13 = 0; num13 < 3; num13++)
							{
								int num14 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
								Main.dust[num14].noGravity = true;
								Dust dust2 = Main.dust[num14];
								dust2.velocity *= 3f;
								dust2 = Main.dust[num14];
								dust2.velocity += velocity * 0.2f;
								num14 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100);
								dust2 = Main.dust[num14];
								dust2.velocity *= 2f;
								dust2 = Main.dust[num14];
								dust2.velocity += velocity * 0.3f;
							}
							for (int num15 = 0; num15 < 1; num15++)
							{
								int num16 = Gore.NewGore(new Vector2(base.position.X - 10f, base.position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
								Gore gore = Main.gore[num16];
								gore.position += velocity * 1.25f;
								Main.gore[num16].scale = 1.25f;
								gore = Main.gore[num16];
								gore.velocity += velocity * 0.5f;
								gore = Main.gore[num16];
								gore.velocity *= 0.02f;
							}
						}
					}
				}
				else if (type == 497)
				{
					int num17 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 27, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num17].position = (Main.dust[num17].position + base.Center) / 2f;
					Main.dust[num17].noGravity = true;
					Dust dust2 = Main.dust[num17];
					dust2.velocity *= 0.3f;
					dust2 = Main.dust[num17];
					dust2.velocity -= velocity * 0.1f;
					this.ai[0] += 1f;
					if (this.ai[0] >= 30f)
					{
						velocity.X *= 0.99f;
						velocity.Y += 0.5f;
					}
					else
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					}
				}
				else if (type == 861)
				{
					if (Main.myPlayer == owner)
					{
						localAI[0]++;
						if (localAI[0] > 30f)
						{
							localAI[0] = 30f;
						}
						Player player = Main.player[owner];
						for (int num18 = 0; num18 < 255; num18++)
						{
							Player player2 = Main.player[num18];
							if (player2 != null && player2.active && !player2.dead && (player2.whoAmI != player.whoAmI || !(localAI[0] < 30f)) && Colliding(base.Hitbox, player2.Hitbox))
							{
								Kill();
								break;
							}
						}
					}
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.95f;
					}
					else
					{
						velocity.X *= 0.995f;
					}
					if (Math.Abs(velocity.X) < 0.5f)
					{
						velocity.X = 0f;
					}
					if (velocity.X == 0f && velocity.Y == 0f)
					{
						Kill();
					}
					velocity.Y += 0.1f;
					if (this.ai[1] == 1f)
					{
						frame = (frameCounter = 0);
						rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.03f * (float)direction;
					}
					else
					{
						if (frame == 0)
						{
							frame = 1;
						}
						frameCounter++;
						if (frameCounter > 4)
						{
							frameCounter = 0;
							frame++;
							if (frame >= Main.projFrames[type])
							{
								frame = 1;
							}
						}
						rotation = velocity.ToRotation() + MathF.PI / 4f;
						spriteDirection = ((!(velocity.X < 0f)) ? 1 : (-1));
						if (spriteDirection == -1)
						{
							rotation += MathF.PI / 2f;
						}
					}
				}
				else if (type == 249)
				{
					this.ai[0] += 1f;
					if (this.ai[0] >= 0f)
					{
						velocity.Y += 0.25f;
					}
				}
				else if (type == 347)
				{
					this.ai[0] += 1f;
					if (this.ai[0] >= 5f)
					{
						velocity.Y += 0.25f;
					}
				}
				else if (type == 501)
				{
					this.ai[0] += 1f;
					if (this.ai[0] >= 18f)
					{
						velocity.X *= 0.995f;
						velocity.Y += 0.2f;
					}
				}
				else if (type == 504 || type == 954 || type == 979)
				{
					alpha = 255;
					this.ai[0] += 1f;
					if (this.ai[0] > 3f)
					{
						int num19 = 100;
						if (this.ai[0] > 20f)
						{
							int num20 = 40;
							float num21 = this.ai[0] - 20f;
							num19 = (int)(100f * (1f - num21 / (float)num20));
							if (num21 >= (float)num20)
							{
								Kill();
							}
						}
						if (this.ai[0] <= 10f)
						{
							num19 = (int)this.ai[0] * 10;
						}
						if (Main.rand.Next(100) < num19)
						{
							int num22 = ((type != 979) ? Dust.NewDust(base.position, width, height, 6, 0f, 0f, 150) : Dust.NewDust(base.position, width, height, 135, 0f, 0f, 150));
							Main.dust[num22].position = (Main.dust[num22].position + base.Center) / 2f;
							Main.dust[num22].noGravity = true;
							Dust dust2 = Main.dust[num22];
							dust2.velocity *= 2f;
							dust2 = Main.dust[num22];
							dust2.scale *= 1.6f;
							dust2 = Main.dust[num22];
							dust2.velocity += velocity;
						}
					}
					if (this.ai[0] >= 20f)
					{
						velocity.X *= 0.99f;
						velocity.Y += 0.1f;
					}
				}
				else if (type == 69 || type == 70 || type == 621)
				{
					this.ai[0] += 1f;
					if (this.ai[0] >= 10f)
					{
						velocity.Y += 0.25f;
						velocity.X *= 0.99f;
					}
				}
				else if (type == 166)
				{
					if (owner == Main.myPlayer && this.ai[1] == 1f)
					{
						for (int num23 = 0; num23 < 200; num23++)
						{
							if (Main.npc[num23].active && Main.npc[num23].townNPC && Colliding(base.Hitbox, Main.npc[num23].Hitbox))
							{
								Kill();
								return;
							}
						}
						if (Main.netMode == 1)
						{
							for (int num24 = 0; num24 < 255; num24++)
							{
								if (num24 != owner && Main.player[num24].active && !Main.player[owner].InOpposingTeam(Main.player[num24]) && Colliding(base.Hitbox, Main.player[num24].Hitbox))
								{
									Kill();
									return;
								}
							}
						}
					}
					this.ai[0] += 1f;
					if (this.ai[0] >= 20f)
					{
						velocity.Y += 0.3f;
						velocity.X *= 0.98f;
					}
				}
				else if (type == 300)
				{
					if (this.ai[0] == 0f)
					{
						SoundEngine.PlaySound(SoundID.Item1, base.position);
					}
					this.ai[0] += 1f;
					if (this.ai[0] >= 60f)
					{
						velocity.Y += 0.2f;
						velocity.X *= 0.99f;
					}
				}
				else if (type == 306)
				{
					if (alpha <= 200)
					{
						for (int num25 = 0; num25 < 4; num25++)
						{
							float num26 = velocity.X / 4f * (float)num25;
							float num27 = velocity.Y / 4f * (float)num25;
							int num28 = Dust.NewDust(base.position, width, height, 184);
							Main.dust[num28].position.X = base.Center.X - num26;
							Main.dust[num28].position.Y = base.Center.Y - num27;
							Dust dust2 = Main.dust[num28];
							dust2.velocity *= 0f;
							Main.dust[num28].scale = 0.7f;
						}
					}
					alpha -= 50;
					if (alpha < 0)
					{
						alpha = 0;
					}
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 0.785f;
				}
				else if (type == 304)
				{
					this.ai[0] += 1f;
					if (this.ai[0] >= 30f)
					{
						alpha += 10;
						damage = (int)((double)damage * 0.9);
						knockBack = (int)((double)knockBack * 0.9);
						if (alpha >= 255)
						{
							active = false;
						}
					}
					if (this.ai[0] < 30f)
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					}
				}
				else if (type == 370 || type == 371 || type == 936)
				{
					this.ai[0] += 1f;
					if (this.ai[0] >= 15f)
					{
						velocity.Y += 0.3f;
						velocity.X *= 0.98f;
					}
				}
				else
				{
					int num29 = 20;
					if (type == 93)
					{
						num29 = 28 + Main.rand.Next(6);
					}
					this.ai[0] += 1f;
					if (this.ai[0] >= (float)num29)
					{
						if (type == 93)
						{
							this.ai[0] = 40f;
						}
						velocity.Y += 0.4f;
						velocity.X *= 0.97f;
					}
					else if (type == 48 || type == 54 || type == 93 || type == 520 || type == 599)
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					}
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				if (type == 54 && Main.rand.Next(20) == 0)
				{
					Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 40, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.75f);
				}
			}
			else if (aiStyle == 3)
			{
				if (soundDelay == 0 && type != 383)
				{
					soundDelay = 8;
					SoundEngine.PlaySound(SoundID.Item7, base.position);
				}
				if (type == 19)
				{
					for (int num30 = 0; num30 < 2; num30++)
					{
						int num31 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
						Main.dust[num31].noGravity = true;
						Main.dust[num31].velocity.X *= 0.3f;
						Main.dust[num31].velocity.Y *= 0.3f;
					}
				}
				else if (type == 1000)
				{
					if (Main.rand.Next(3) == 0)
					{
						switch (Main.rand.Next(3))
						{
						default:
						{
							int num32 = Main.rand.Next(3) switch
							{
								1 => 57, 
								2 => 58, 
								_ => 15, 
							};
							Dust dust3 = Main.dust[Dust.NewDust(base.position, width, height, num32, velocity.X * 0.25f, velocity.Y * 0.25f, 150, default(Color), 0.7f)];
							Dust dust2 = dust3;
							dust2.velocity *= 0.5f;
							break;
						}
						case 1:
						{
							Dust dust3 = Main.dust[Dust.NewDust(base.position, width, height, 267, velocity.X, velocity.Y, 50, new Color(50, 50, 200), 1.1f)];
							dust3.fadeIn = 0.1f;
							dust3.velocity = velocity * 0.5f;
							dust3.noGravity = true;
							break;
						}
						case 2:
						{
							Dust dust3 = Main.dust[Dust.NewDust(base.position, width, height, 76, velocity.X * 0.15f, velocity.Y * 0.15f, 0, default(Color), 1.1f)];
							dust3.noGravity = true;
							Dust.NewDust(base.position, width, height, 15, velocity.X * 0.05f, velocity.Y * 0.05f, 150, default(Color), 0.6f);
							break;
						}
						}
					}
				}
				else if (type == 867)
				{
					if (Main.rand.Next(3) == 0)
					{
						int num33 = Dust.NewDust(base.position, width, height, 165, velocity.X, velocity.Y, 50);
						Dust dust2 = Main.dust[num33];
						dust2.velocity *= 0.5f;
						Main.dust[num33].noGravity = true;
					}
				}
				else if (type == 33)
				{
					if (Main.rand.Next(1) == 0)
					{
						int num34 = Dust.NewDust(base.position, width, height, 40, velocity.X * 0.25f, velocity.Y * 0.25f, 0, default(Color), 1.4f);
						Main.dust[num34].noGravity = true;
					}
				}
				else if (type == 320)
				{
					if (Main.rand.Next(3) == 0)
					{
						int num35 = Dust.NewDust(base.position, width, height, 5, velocity.X * 0.25f, velocity.Y * 0.25f, 0, default(Color), 1.1f);
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num35].scale = 0.9f;
							Dust dust2 = Main.dust[num35];
							dust2.velocity *= 0.2f;
						}
						else
						{
							Main.dust[num35].noGravity = true;
						}
					}
				}
				else if (type == 6)
				{
					if (Main.rand.Next(5) == 0)
					{
						int num36 = Main.rand.Next(3);
						Dust.NewDust(base.position, width, height, num36 switch
						{
							0 => 15, 
							1 => 57, 
							_ => 58, 
						}, velocity.X * 0.25f, velocity.Y * 0.25f, 150, default(Color), 0.7f);
					}
				}
				else if (type == 113 && Main.rand.Next(1) == 0)
				{
					int num37 = Dust.NewDust(base.position, width, height, 76, velocity.X * 0.15f, velocity.Y * 0.15f, 0, default(Color), 1.1f);
					Main.dust[num37].noGravity = true;
					Dust.NewDust(base.position, width, height, 15, velocity.X * 0.05f, velocity.Y * 0.05f, 150, default(Color), 0.6f);
				}
				if (this.ai[0] == 0f)
				{
					bool flag = true;
					int num38 = type;
					if (num38 == 866)
					{
						flag = false;
					}
					if (flag)
					{
						this.ai[1] += 1f;
					}
					if (type == 106 && this.ai[1] >= 45f)
					{
						this.ai[0] = 1f;
						this.ai[1] = 0f;
						netUpdate = true;
					}
					if (type == 320 || type == 383)
					{
						if (this.ai[1] >= 10f)
						{
							velocity.Y += 0.5f;
							if (type == 383 && velocity.Y < 0f)
							{
								velocity.Y += 0.35f;
							}
							velocity.X *= 0.95f;
							if (velocity.Y > 16f)
							{
								velocity.Y = 16f;
							}
							if (type == 383 && Vector2.Distance(base.Center, Main.player[owner].Center) > 800f)
							{
								this.ai[0] = 1f;
								netUpdate = true;
							}
						}
					}
					else if (type == 182)
					{
						if (Main.rand.Next(2) == 0)
						{
							int num39 = Dust.NewDust(base.position, width, height, 57, 0f, 0f, 255, default(Color), 0.75f);
							Dust dust2 = Main.dust[num39];
							dust2.velocity *= 0.1f;
							Main.dust[num39].noGravity = true;
						}
						if (velocity.X > 0f)
						{
							spriteDirection = 1;
						}
						else if (velocity.X < 0f)
						{
							spriteDirection = -1;
						}
						float num40 = base.position.X;
						float num41 = base.position.Y;
						float num42 = 800f;
						bool flag2 = false;
						if (this.ai[1] > 10f && this.ai[1] < 360f)
						{
							for (int num43 = 0; num43 < 200; num43++)
							{
								if (Main.npc[num43].CanBeChasedBy(this))
								{
									float num44 = Main.npc[num43].position.X + (float)(Main.npc[num43].width / 2);
									float num45 = Main.npc[num43].position.Y + (float)(Main.npc[num43].height / 2);
									float num46 = Distance(Main.npc[num43].Center);
									if (num46 < num42 && Collision.CanHit(new Vector2(base.position.X + (float)(width / 2), base.position.Y + (float)(height / 2)), 1, 1, Main.npc[num43].position, Main.npc[num43].width, Main.npc[num43].height))
									{
										num42 = num46;
										num40 = num44;
										num41 = num45;
										flag2 = true;
									}
								}
							}
						}
						if (!flag2)
						{
							num40 = base.position.X + (float)(width / 2) + velocity.X * 100f;
							num41 = base.position.Y + (float)(height / 2) + velocity.Y * 100f;
							if (this.ai[1] >= 30f)
							{
								this.ai[0] = 1f;
								this.ai[1] = 0f;
								netUpdate = true;
							}
						}
						float num47 = 12f;
						float num48 = 0.25f;
						Vector2 vector3 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
						float num49 = num40 - vector3.X;
						float num50 = num41 - vector3.Y;
						float num51 = (float)Math.Sqrt(num49 * num49 + num50 * num50);
						float num52 = num51;
						num51 = num47 / num51;
						num49 *= num51;
						num50 *= num51;
						if (velocity.X < num49)
						{
							velocity.X += num48;
							if (velocity.X < 0f && num49 > 0f)
							{
								velocity.X += num48 * 2f;
							}
						}
						else if (velocity.X > num49)
						{
							velocity.X -= num48;
							if (velocity.X > 0f && num49 < 0f)
							{
								velocity.X -= num48 * 2f;
							}
						}
						if (velocity.Y < num50)
						{
							velocity.Y += num48;
							if (velocity.Y < 0f && num50 > 0f)
							{
								velocity.Y += num48 * 2f;
							}
						}
						else if (velocity.Y > num50)
						{
							velocity.Y -= num48;
							if (velocity.Y > 0f && num50 < 0f)
							{
								velocity.Y -= num48 * 2f;
							}
						}
					}
					else if (type == 866)
					{
						if (owner == Main.myPlayer && damage > 0)
						{
							float num53 = this.ai[1];
							if (localAI[0] >= 10f && localAI[0] <= 360f)
							{
								int num54 = FindTargetWithLineOfSight();
								this.ai[1] = num54;
							}
							else
							{
								this.ai[1] = -1f;
							}
							if (this.ai[1] != num53)
							{
								netUpdate = true;
							}
						}
						localAI[0] += 1f;
						int num55 = (int)this.ai[1];
						Vector2 vector4;
						if (Main.npc.IndexInRange(num55) && Main.npc[num55].CanBeChasedBy(this))
						{
							vector4 = Main.npc[num55].Center;
						}
						else
						{
							vector4 = base.Center + velocity * 100f;
							int num56 = 30;
							if (owner != Main.myPlayer)
							{
								num56 = 60;
							}
							if (localAI[0] >= (float)num56)
							{
								this.ai[0] = 1f;
								this.ai[1] = 0f;
								netUpdate = true;
							}
						}
						float num57 = 12f;
						float num58 = 0.25f;
						Vector2 vector5 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
						float num59 = vector4.X - vector5.X;
						float num60 = vector4.Y - vector5.Y;
						float num61 = (float)Math.Sqrt(num59 * num59 + num60 * num60);
						float num62 = num61;
						num61 = num57 / num61;
						num59 *= num61;
						num60 *= num61;
						if (velocity.X < num59)
						{
							velocity.X += num58;
							if (velocity.X < 0f && num59 > 0f)
							{
								velocity.X += num58 * 2f;
							}
						}
						else if (velocity.X > num59)
						{
							velocity.X -= num58;
							if (velocity.X > 0f && num59 < 0f)
							{
								velocity.X -= num58 * 2f;
							}
						}
						if (velocity.Y < num60)
						{
							velocity.Y += num58;
							if (velocity.Y < 0f && num60 > 0f)
							{
								velocity.Y += num58 * 2f;
							}
						}
						else if (velocity.Y > num60)
						{
							velocity.Y -= num58;
							if (velocity.Y > 0f && num60 < 0f)
							{
								velocity.Y -= num58 * 2f;
							}
						}
					}
					else if (type == 301)
					{
						if (this.ai[1] >= 20f)
						{
							this.ai[0] = 1f;
							this.ai[1] = 0f;
							velocity = Vector2.Zero;
							netUpdate = true;
						}
					}
					else if (this.ai[1] >= 30f)
					{
						this.ai[0] = 1f;
						this.ai[1] = 0f;
						netUpdate = true;
					}
				}
				else
				{
					tileCollide = false;
					float num63 = 9f;
					float num64 = 0.4f;
					if (type == 19)
					{
						num63 = 20f;
						num64 = 1.5f;
					}
					else if (type == 33)
					{
						num63 = 18f;
						num64 = 1.2f;
					}
					else if (type == 182)
					{
						num63 = 16f;
						num64 = 1.2f;
					}
					else if (type == 866)
					{
						num63 = 16f;
						num64 = 1.2f;
					}
					else if (type == 106)
					{
						num63 = 16f;
						num64 = 1.2f;
					}
					else if (type == 272)
					{
						num63 = 20f;
						num64 = 1.5f;
					}
					else if (type == 333)
					{
						num63 = 12f;
						num64 = 0.6f;
					}
					else if (type == 301)
					{
						num63 = 15f;
						num64 = 3f;
					}
					else if (type == 320)
					{
						num63 = 15f;
						num64 = 3f;
					}
					else if (type == 383)
					{
						num63 = 16f;
						num64 = 4f;
					}
					Vector2 vector6 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
					float num65 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector6.X;
					float num66 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector6.Y;
					float num67 = (float)Math.Sqrt(num65 * num65 + num66 * num66);
					if (num67 > 3000f)
					{
						Kill();
					}
					num67 = num63 / num67;
					num65 *= num67;
					num66 *= num67;
					if (type == 383)
					{
						Vector2 vector7 = new Vector2(num65, num66) - velocity;
						if (vector7 != Vector2.Zero)
						{
							Vector2 vector8 = vector7;
							vector8.Normalize();
							velocity += vector8 * Math.Min(num64, vector7.Length());
						}
					}
					else
					{
						if (velocity.X < num65)
						{
							velocity.X += num64;
							if (velocity.X < 0f && num65 > 0f)
							{
								velocity.X += num64;
							}
						}
						else if (velocity.X > num65)
						{
							velocity.X -= num64;
							if (velocity.X > 0f && num65 < 0f)
							{
								velocity.X -= num64;
							}
						}
						if (velocity.Y < num66)
						{
							velocity.Y += num64;
							if (velocity.Y < 0f && num66 > 0f)
							{
								velocity.Y += num64;
							}
						}
						else if (velocity.Y > num66)
						{
							velocity.Y -= num64;
							if (velocity.Y > 0f && num66 < 0f)
							{
								velocity.Y -= num64;
							}
						}
					}
					if (Main.myPlayer == owner)
					{
						Rectangle rectangle = new Rectangle((int)base.position.X, (int)base.position.Y, width, height);
						Rectangle value = new Rectangle((int)Main.player[owner].position.X, (int)Main.player[owner].position.Y, Main.player[owner].width, Main.player[owner].height);
						if (rectangle.Intersects(value))
						{
							Kill();
						}
					}
				}
				if (type == 106)
				{
					rotation += 0.3f * (float)direction;
				}
				else if (type == 866)
				{
					rotation = velocity.ToRotation();
					if (Main.rand.Next(2) == 0)
					{
						int num68 = Dust.NewDust(base.position, width, height, 212);
						Dust dust2 = Main.dust[num68];
						dust2.velocity *= 0.1f;
						Main.dust[num68].noGravity = true;
					}
				}
				else if (type == 383)
				{
					if (this.ai[0] == 0f)
					{
						Vector2 v = velocity;
						v = v.SafeNormalize(Vector2.Zero);
						rotation = (float)Math.Atan2(v.Y, v.X) + 1.57f;
					}
					else
					{
						Vector2 v2 = base.Center - Main.player[owner].Center;
						v2 = v2.SafeNormalize(Vector2.Zero);
						rotation = (float)Math.Atan2(v2.Y, v2.X) + 1.57f;
					}
				}
				else if (type == 301)
				{
					if (this.ai[0] == 0f)
					{
						rotation = velocity.ToRotation() + MathF.PI / 4f;
						if (Main.rand.Next(2) == 0)
						{
							int num69 = Dust.NewDust(base.position, width, height, 57, velocity.X * 0.2f, velocity.Y * 0.2f, 200, default(Color), 1.2f);
							Dust dust2 = Main.dust[num69];
							dust2.velocity += velocity * 0.3f;
							dust2 = Main.dust[num69];
							dust2.velocity *= 0.2f;
							Main.dust[num69].noGravity = true;
						}
						if (Main.rand.Next(3) == 0)
						{
							int num70 = Dust.NewDust(base.position, width, height, 43, 0f, 0f, 254, default(Color), 0.3f);
							Dust dust2 = Main.dust[num70];
							dust2.velocity += velocity * 0.5f;
							dust2 = Main.dust[num70];
							dust2.velocity *= 0.5f;
							Main.dust[num70].noGravity = true;
						}
					}
					else
					{
						rotation += 0.4f * (float)direction;
					}
				}
				else
				{
					rotation += 0.4f * (float)direction;
				}
			}
			else if (aiStyle == 4)
			{
				if (Main.netMode != 2 && this.ai[1] == 0f && localAI[0] == 0f)
				{
					localAI[0] = 1f;
					LegacySoundStyle legacySoundStyle = SoundID.Item8;
					if (type == 494)
					{
						legacySoundStyle = SoundID.Item101;
					}
					SoundEngine.PlaySound(legacySoundStyle, base.Center);
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				if (this.ai[0] == 0f)
				{
					if (type >= 150 && type <= 152 && this.ai[1] == 0f && alpha == 255 && Main.rand.Next(2) == 0)
					{
						type++;
						netUpdate = true;
					}
					alpha -= 50;
					if (type >= 150 && type <= 152)
					{
						alpha -= 25;
					}
					else if (type == 493 || type == 494)
					{
						alpha -= 50;
					}
					if (alpha > 0)
					{
						return;
					}
					alpha = 0;
					this.ai[0] = 1f;
					if (this.ai[1] == 0f)
					{
						this.ai[1] += 1f;
						base.position += velocity * 1f;
					}
					if (type == 7 && Main.myPlayer == owner)
					{
						int num71 = type;
						if (this.ai[1] >= 6f)
						{
							num71++;
						}
						int num72 = NewProjectile(GetProjectileSource_FromThis(), base.position.X + velocity.X + (float)(width / 2), base.position.Y + velocity.Y + (float)(height / 2), velocity.X, velocity.Y, num71, damage, knockBack, owner);
						Main.projectile[num72].damage = damage;
						Main.projectile[num72].ai[1] = this.ai[1] + 1f;
						NetMessage.SendData(27, -1, -1, null, num72);
					}
					else if (type == 494 && Main.myPlayer == owner)
					{
						int num73 = type;
						if (this.ai[1] >= (float)(7 + Main.rand.Next(2)))
						{
							num73--;
						}
						int num74 = damage;
						float num75 = knockBack;
						if (num73 == 493)
						{
							num74 = (int)((double)damage * 1.25);
							num75 = knockBack * 1.25f;
						}
						int number = NewProjectile(GetProjectileSource_FromThis(), base.position.X + velocity.X + (float)(width / 2), base.position.Y + velocity.Y + (float)(height / 2), velocity.X, velocity.Y, num73, num74, num75, owner, 0f, this.ai[1] + 1f);
						NetMessage.SendData(27, -1, -1, null, number);
					}
					else if ((type == 150 || type == 151) && Main.myPlayer == owner)
					{
						int num76 = type;
						if (type == 150)
						{
							num76 = 151;
						}
						else if (type == 151)
						{
							num76 = 150;
						}
						if (this.ai[1] >= 10f && type == 151)
						{
							num76 = 152;
						}
						int num77 = NewProjectile(GetProjectileSource_FromThis(), base.position.X + velocity.X + (float)(width / 2), base.position.Y + velocity.Y + (float)(height / 2), velocity.X, velocity.Y, num76, damage, knockBack, owner);
						Main.projectile[num77].damage = damage;
						Main.projectile[num77].ai[1] = this.ai[1] + 1f;
						NetMessage.SendData(27, -1, -1, null, num77);
					}
					return;
				}
				if (alpha < 170 && alpha + 5 >= 170)
				{
					if (type >= 150 && type <= 152)
					{
						for (int num78 = 0; num78 < 8; num78++)
						{
							int num79 = Dust.NewDust(base.position, width, height, 7, velocity.X * 0.025f, velocity.Y * 0.025f, 200, default(Color), 1.3f);
							Main.dust[num79].noGravity = true;
							Dust dust2 = Main.dust[num79];
							dust2.velocity *= 0.5f;
						}
					}
					else if (type == 493 || type == 494)
					{
						for (int num80 = 0; num80 < 8; num80++)
						{
							int num81 = Dust.NewDust(base.position, width, height, Main.rand.Next(68, 71), velocity.X * 0.025f, velocity.Y * 0.025f, 200, default(Color), 1.3f);
							Main.dust[num81].noGravity = true;
							Dust dust2 = Main.dust[num81];
							dust2.velocity *= 0.5f;
						}
					}
					else
					{
						for (int num82 = 0; num82 < 3; num82++)
						{
							Dust.NewDust(base.position, width, height, 18, velocity.X * 0.025f, velocity.Y * 0.025f, 170, default(Color), 1.2f);
						}
						Dust.NewDust(base.position, width, height, 14, 0f, 0f, 170, default(Color), 1.1f);
					}
				}
				if (type >= 150 && type <= 152)
				{
					alpha += 3;
				}
				else if (type == 493 || type == 494)
				{
					alpha += 4;
				}
				else
				{
					alpha += 5;
				}
				if (alpha >= 255)
				{
					Kill();
				}
			}
			else if (aiStyle == 5)
			{
				if (!Main.remixWorld && type == 12 && Main.dayTime && damage == 1000)
				{
					Kill();
				}
				if (type == 503 || type == 723 || type == 724 || type == 725 || type == 726)
				{
					if (base.Center.Y > this.ai[1])
					{
						tileCollide = true;
					}
				}
				else if (type == 92)
				{
					if (base.position.Y > this.ai[1])
					{
						tileCollide = true;
					}
				}
				else if (type == 9)
				{
					tileCollide = base.Bottom.Y >= this.ai[1];
				}
				else
				{
					if (this.ai[1] == 0f && !Collision.SolidCollision(base.position, width, height))
					{
						this.ai[1] = 1f;
						netUpdate = true;
					}
					if (this.ai[1] != 0f)
					{
						tileCollide = true;
					}
				}
				if (soundDelay == 0)
				{
					soundDelay = 20 + Main.rand.Next(40);
					SoundEngine.PlaySound(SoundID.Item9, base.position);
				}
				if (type == 503 || type == 9)
				{
					alpha -= 15;
					int num83 = 150;
					if (base.Center.Y >= this.ai[1])
					{
						num83 = 0;
					}
					if (alpha < num83)
					{
						alpha = num83;
					}
					localAI[0] += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f * (float)direction;
				}
				else if (type == 723 || type == 724 || type == 725 || type == 726)
				{
					alpha -= 15;
					int num84 = 100;
					if (base.Center.Y >= this.ai[1])
					{
						num84 = 0;
					}
					if (alpha < num84)
					{
						alpha = num84;
					}
					localAI[0] += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f * (float)direction;
				}
				else
				{
					if (localAI[0] == 0f)
					{
						localAI[0] = 1f;
					}
					alpha += (int)(25f * localAI[0]);
					if (alpha > 200)
					{
						alpha = 200;
						localAI[0] = -1f;
					}
					if (alpha < 0)
					{
						alpha = 0;
						localAI[0] = 1f;
					}
				}
				if (type == 503)
				{
					rotation = velocity.ToRotation() - MathF.PI / 2f;
				}
				else
				{
					rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f * (float)direction;
				}
				if (type == 503)
				{
					if (Main.rand.Next(16) == 0)
					{
						Vector2 vector9 = Vector2.UnitX.RotatedByRandom(1.5707963705062866).RotatedBy(velocity.ToRotation());
						int num85 = Dust.NewDust(base.position, width, height, 58, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.2f);
						Main.dust[num85].velocity = vector9 * 0.66f;
						Main.dust[num85].position = base.Center + vector9 * 12f;
					}
					if (Main.rand.Next(48) == 0)
					{
						int num86 = Gore.NewGore(base.Center, new Vector2(velocity.X * 0.2f, velocity.Y * 0.2f), 16);
						Gore gore = Main.gore[num86];
						gore.velocity *= 0.66f;
						gore = Main.gore[num86];
						gore.velocity += velocity * 0.3f;
					}
				}
				if (type == 12 || type == 955)
				{
					Vector2 vector10 = new Vector2(Main.screenWidth, Main.screenHeight);
					if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector10 / 2f, vector10 + new Vector2(400f))) && Main.rand.Next(6) == 0)
					{
						int num87 = Utils.SelectRandom<int>(Main.rand, 16, 17, 17, 17);
						if (Main.tenthAnniversaryWorld)
						{
							num87 = Utils.SelectRandom<int>(Main.rand, 16, 16, 16, 17);
						}
						Gore.NewGore(base.position, velocity * 0.2f, num87);
					}
					light = 0.9f;
					if (Main.rand.Next(20) == 0 || (Main.tenthAnniversaryWorld && Main.rand.Next(15) == 0))
					{
						Dust.NewDust(base.position, width, height, 58, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.2f);
					}
				}
				else if (type == 723 || type == 724 || type == 725 || type == 726)
				{
					if (type == 726 || type == 725 || type == 726)
					{
						Vector2 vector11 = new Vector2(Main.screenWidth, Main.screenHeight);
						if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector11 / 2f, vector11 + new Vector2(400f))) && Main.rand.Next(24) == 0)
						{
							Gore.NewGore(base.position, velocity * 0.2f, Utils.SelectRandom<int>(Main.rand, 16, 17));
						}
						if (Main.rand.Next(3) == 0)
						{
							Dust dust4 = Dust.NewDustDirect(base.position, width, height, 86, 0f, 0f, 127);
							Dust dust2 = dust4;
							dust2.velocity *= 0.5f;
							dust4.noGravity = true;
						}
					}
					if (type == 723)
					{
						Vector2 vector12 = new Vector2(Main.screenWidth, Main.screenHeight);
						if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector12 / 2f, vector12 + new Vector2(400f))) && Main.rand.Next(6) == 0)
						{
							Gore.NewGore(base.position, velocity * 0.2f, 17);
						}
						for (float num88 = 0f; num88 < 3f; num88 += 1f)
						{
							Vector2 vector13 = base.Center + new Vector2(0f, 12f * scale).RotatedBy(base.position.Y / 200f + num88 * (MathF.PI * 2f) + rotation) - velocity * 0.5f;
							Dust dust5 = Dust.NewDustPerfect(vector13, 267, velocity * 0.2f * num88, 0, Color.Blue);
							dust5.noLight = true;
							dust5.noGravity = true;
							dust5 = Dust.NewDustPerfect(vector13, 267, velocity * 0.2f * num88, 0, Color.White, 0.4f);
							dust5.noLight = true;
							dust5.noGravity = true;
						}
					}
				}
				else if (type == 9)
				{
					Vector2 vector14 = new Vector2(Main.screenWidth, Main.screenHeight);
					if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector14 / 2f, vector14 + new Vector2(400f))) && Main.rand.Next(20) == 0)
					{
						Gore.NewGore(base.position, velocity * 0.2f, Main.rand.Next(16, 18));
					}
					if (Main.rand.Next(4) == 0)
					{
						Dust dust6 = Dust.NewDustDirect(base.position, width, height, 86, 0f, 0f, 127);
						Dust dust2 = dust6;
						dust2.velocity *= 0.7f;
						dust6.noGravity = true;
						dust2 = dust6;
						dust2.velocity += velocity * 0.3f;
						if (Main.rand.Next(2) == 0)
						{
							dust2 = dust6;
							dust2.position -= velocity * 4f;
						}
					}
				}
				else if (this.ai[1] == 1f || type == 92)
				{
					light = 0.9f;
					if (Main.rand.Next(10) == 0)
					{
						Dust.NewDust(base.position, width, height, 58, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.2f);
					}
					if (Main.rand.Next(20) == 0)
					{
						Gore.NewGore(base.position, new Vector2(velocity.X * 0.2f, velocity.Y * 0.2f), Main.rand.Next(16, 18));
					}
				}
			}
			else if (aiStyle == 6)
			{
				bool flag3 = type == 1019;
				velocity *= 0.95f;
				this.ai[0] += 1f;
				if (this.ai[0] == 180f)
				{
					Kill();
				}
				if (this.ai[1] == 0f)
				{
					this.ai[1] = 1f;
					int num89 = 10 + type;
					int num90 = 30;
					if (type == 463)
					{
						num89 = 231;
					}
					if (flag3)
					{
						num89 = 0;
						num90 = 40;
					}
					for (int num91 = 0; num91 < num90; num91++)
					{
						Dust dust7 = Main.dust[Dust.NewDust(base.position, width, height, num89, velocity.X, velocity.Y, 50)];
						if (flag3)
						{
							dust7.noGravity = num91 % 3 != 0;
							if (!dust7.noGravity)
							{
								Dust dust2 = dust7;
								dust2.scale *= 1.25f;
								dust2 = dust7;
								dust2.velocity /= 2f;
								dust7.velocity.Y -= 2.2f;
							}
							else
							{
								Dust dust2 = dust7;
								dust2.scale *= 1.75f;
								dust2 = dust7;
								dust2.velocity += velocity * 0.65f;
							}
						}
					}
				}
				bool flag4 = Main.myPlayer == owner;
				if (flag3)
				{
					flag4 = Main.netMode != 1;
				}
				if (flag4 && (type == 10 || type == 11 || type == 463 || flag3))
				{
					int num92 = (int)(base.position.X / 16f) - 1;
					int num93 = (int)((base.position.X + (float)width) / 16f) + 2;
					int num94 = (int)(base.position.Y / 16f) - 1;
					int num95 = (int)((base.position.Y + (float)height) / 16f) + 2;
					if (num92 < 0)
					{
						num92 = 0;
					}
					if (num93 > Main.maxTilesX)
					{
						num93 = Main.maxTilesX;
					}
					if (num94 < 0)
					{
						num94 = 0;
					}
					if (num95 > Main.maxTilesY)
					{
						num95 = Main.maxTilesY;
					}
					Vector2 vector15 = default(Vector2);
					for (int num96 = num92; num96 < num93; num96++)
					{
						for (int num97 = num94; num97 < num95; num97++)
						{
							vector15.X = num96 * 16;
							vector15.Y = num97 * 16;
							if (!(base.position.X + (float)width > vector15.X) || !(base.position.X < vector15.X + 16f) || !(base.position.Y + (float)height > vector15.Y) || !(base.position.Y < vector15.Y + 16f) || !Main.tile[num96, num97].active())
							{
								continue;
							}
							if (type == 10)
							{
								if (Main.tile[num96, num97].type == 23 || Main.tile[num96, num97].type == 199)
								{
									Main.tile[num96, num97].type = 2;
									WorldGen.SquareTileFrame(num96, num97);
									if (Main.netMode == 1)
									{
										NetMessage.SendTileSquare(-1, num96, num97);
									}
								}
								if (Main.tile[num96, num97].type == 25 || Main.tile[num96, num97].type == 203)
								{
									Main.tile[num96, num97].type = 1;
									WorldGen.SquareTileFrame(num96, num97);
									if (Main.netMode == 1)
									{
										NetMessage.SendTileSquare(-1, num96, num97);
									}
								}
								if (Main.tile[num96, num97].type == 112 || Main.tile[num96, num97].type == 234)
								{
									Main.tile[num96, num97].type = 53;
									WorldGen.SquareTileFrame(num96, num97);
									if (Main.netMode == 1)
									{
										NetMessage.SendTileSquare(-1, num96, num97);
									}
								}
								if (Main.tile[num96, num97].type == 163 || Main.tile[num96, num97].type == 200)
								{
									Main.tile[num96, num97].type = 161;
									WorldGen.SquareTileFrame(num96, num97);
									if (Main.netMode == 1)
									{
										NetMessage.SendTileSquare(-1, num96, num97);
									}
								}
								if (Main.tile[num96, num97].type == 400 || Main.tile[num96, num97].type == 401)
								{
									Main.tile[num96, num97].type = 396;
									WorldGen.SquareTileFrame(num96, num97);
									if (Main.netMode == 1)
									{
										NetMessage.SendTileSquare(-1, num96, num97);
									}
								}
								if (Main.tile[num96, num97].type == 398 || Main.tile[num96, num97].type == 399)
								{
									Main.tile[num96, num97].type = 397;
									WorldGen.SquareTileFrame(num96, num97);
									if (Main.netMode == 1)
									{
										NetMessage.SendTileSquare(-1, num96, num97);
									}
								}
								if (Main.tile[num96, num97].type == 661 || Main.tile[num96, num97].type == 662)
								{
									Main.tile[num96, num97].type = 60;
									WorldGen.SquareTileFrame(num96, num97);
									if (Main.netMode == 1)
									{
										NetMessage.SendTileSquare(-1, num96, num97);
									}
								}
							}
							if (type == 11 || type == 463)
							{
								if (type == 11)
								{
									WorldGen.Convert(num96, num97, 1, 1);
								}
								if (type == 463)
								{
									WorldGen.Convert(num96, num97, 4, 1);
								}
							}
							if (flag3)
							{
								Tile tile = Main.tile[num96, num97];
								if (tile.type >= 0 && tile.type < 693 && TileID.Sets.CommonSapling[tile.type])
								{
									WorldGen.AttemptToGrowTreeFromSapling(num96, num97, num97 > (int)Main.worldSurface - 1);
								}
							}
						}
					}
				}
				if (flag3 && velocity.Length() < 0.5f)
				{
					Kill();
				}
			}
			else if (aiStyle == 7)
			{
				AI_007_GrapplingHooks();
			}
			else if (aiStyle == 8)
			{
				if (type == 258 && localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item20, base.position);
				}
				if (type == 96 && localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item20, base.position);
				}
				if (type == 27)
				{
					for (int num98 = 0; num98 < 5; num98++)
					{
						float num99 = velocity.X / 3f * (float)num98;
						float num100 = velocity.Y / 3f * (float)num98;
						int num101 = 4;
						int num102 = Dust.NewDust(new Vector2(base.position.X + (float)num101, base.position.Y + (float)num101), width - num101 * 2, height - num101 * 2, 172, 0f, 0f, 100, default(Color), 1.2f);
						Main.dust[num102].noGravity = true;
						Dust dust2 = Main.dust[num102];
						dust2.velocity *= 0.1f;
						dust2 = Main.dust[num102];
						dust2.velocity += velocity * 0.1f;
						Main.dust[num102].position.X -= num99;
						Main.dust[num102].position.Y -= num100;
					}
					if (Main.rand.Next(5) == 0)
					{
						int num103 = 4;
						int num104 = Dust.NewDust(new Vector2(base.position.X + (float)num103, base.position.Y + (float)num103), width - num103 * 2, height - num103 * 2, 172, 0f, 0f, 100, default(Color), 0.6f);
						Dust dust2 = Main.dust[num104];
						dust2.velocity *= 0.25f;
						dust2 = Main.dust[num104];
						dust2.velocity += velocity * 0.5f;
					}
				}
				else if (type == 502)
				{
					float num105 = (float)Main.DiscoR / 255f;
					float num106 = (float)Main.DiscoG / 255f;
					float num107 = (float)Main.DiscoB / 255f;
					num105 = (0.5f + num105) / 2f;
					num106 = (0.5f + num106) / 2f;
					num107 = (0.5f + num107) / 2f;
					Lighting.AddLight(base.Center, num105, num106, num107);
				}
				else if (type == 95 || type == 96)
				{
					int num108 = Dust.NewDust(new Vector2(base.position.X + velocity.X, base.position.Y + velocity.Y), width, height, 75, velocity.X, velocity.Y, 100, default(Color), 3f * scale);
					Main.dust[num108].noGravity = true;
				}
				else if (type == 253)
				{
					for (int num109 = 0; num109 < 2; num109++)
					{
						int num110 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 135, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
						Main.dust[num110].noGravity = true;
						Main.dust[num110].velocity.X *= 0.3f;
						Main.dust[num110].velocity.Y *= 0.3f;
					}
				}
				else
				{
					for (int num111 = 0; num111 < 2; num111++)
					{
						int num112 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
						if (type == 258 && Main.getGoodWorld)
						{
							Main.dust[num112].noLight = true;
						}
						Main.dust[num112].noGravity = true;
						Main.dust[num112].velocity.X *= 0.3f;
						Main.dust[num112].velocity.Y *= 0.3f;
					}
				}
				if (type != 27 && type != 96 && type != 258)
				{
					this.ai[1] += 1f;
				}
				if (this.ai[1] >= 20f)
				{
					velocity.Y += 0.2f;
				}
				if (type == 502)
				{
					rotation = velocity.ToRotation() + MathF.PI / 2f;
					if (velocity.X != 0f)
					{
						spriteDirection = (direction = Math.Sign(velocity.X));
					}
				}
				else
				{
					rotation += 0.3f * (float)direction;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
			}
			else if (aiStyle == 9)
			{
				AI_009_MagicMissiles();
			}
			else if (aiStyle == 10)
			{
				AI_010();
			}
			else if (aiStyle == 11)
			{
				bool flag5 = type == 72 || type == 86 || type == 87;
				if (flag5)
				{
					if (velocity.X > 0f)
					{
						spriteDirection = -1;
					}
					else if (velocity.X < 0f)
					{
						spriteDirection = 1;
					}
					rotation = velocity.X * 0.1f;
					frameCounter++;
					if (frameCounter >= 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame >= 4)
					{
						frame = 0;
					}
					if (Main.rand.Next(6) == 0)
					{
						int num113 = 56;
						if (type == 86)
						{
							num113 = 73;
						}
						else if (type == 87)
						{
							num113 = 74;
						}
						int num114 = Dust.NewDust(base.position, width, height, num113, 0f, 0f, 200, default(Color), 0.8f);
						Dust dust2 = Main.dust[num114];
						dust2.velocity *= 0.3f;
						Main.dust[num114].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cLight, Main.player[owner]);
					}
				}
				else
				{
					rotation += 0.02f;
				}
				if (type == 72)
				{
					if (Main.player[owner].blueFairy)
					{
						timeLeft = 2;
					}
				}
				else if (type == 86)
				{
					if (Main.player[owner].redFairy)
					{
						timeLeft = 2;
					}
				}
				else if (type == 87)
				{
					if (Main.player[owner].greenFairy)
					{
						timeLeft = 2;
					}
				}
				else if (type == 18 && Main.player[owner].lightOrb)
				{
					timeLeft = 2;
				}
				if (!Main.player[owner].dead)
				{
					float num115 = 3f;
					if (flag5)
					{
						num115 = 6f;
					}
					Vector2 vector16 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
					float num116 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector16.X;
					float num117 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector16.Y;
					int num118 = 800;
					int num119 = 70;
					if (type == 18)
					{
						if (Main.player[owner].controlUp)
						{
							num117 = Main.player[owner].position.Y - 40f - vector16.Y;
							num116 -= 6f;
							num119 = 4;
						}
						else if (Main.player[owner].controlDown)
						{
							num117 = Main.player[owner].position.Y + (float)Main.player[owner].height + 40f - vector16.Y;
							num116 -= 6f;
							num119 = 4;
						}
					}
					if (flag5)
					{
						num119 = 50;
					}
					float num120 = (float)Math.Sqrt(num116 * num116 + num117 * num117);
					num120 = (float)Math.Sqrt(num116 * num116 + num117 * num117);
					if (num120 > (float)num118)
					{
						base.position.X = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - (float)(width / 2);
						base.position.Y = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - (float)(height / 2);
					}
					else if (num120 > (float)num119)
					{
						float num121 = num120 - (float)num119;
						num120 = num115 / num120;
						num116 *= num120;
						num117 *= num120;
						velocity.X = num116;
						velocity.Y = num117;
						if (flag5 && velocity.Length() > num121)
						{
							velocity = velocity.SafeNormalize(Vector2.Zero) * num121;
						}
					}
					else
					{
						velocity.X = (velocity.Y = 0f);
					}
				}
				else
				{
					Kill();
				}
			}
			else if (aiStyle == 12)
			{
				if (type == 288 && localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item17, base.position);
				}
				if (type == 280 || type == 288)
				{
					scale -= 0.002f;
					if (scale <= 0f)
					{
						Kill();
					}
					if (type == 288)
					{
						this.ai[0] = 4f;
					}
					if (this.ai[0] > 3f)
					{
						velocity.Y += 0.075f;
						for (int num122 = 0; num122 < 3; num122++)
						{
							float num123 = velocity.X / 3f * (float)num122;
							float num124 = velocity.Y / 3f * (float)num122;
							int num125 = 14;
							int num126 = Dust.NewDust(new Vector2(base.position.X + (float)num125, base.position.Y + (float)num125), width - num125 * 2, height - num125 * 2, 170, 0f, 0f, 100);
							Main.dust[num126].noGravity = true;
							Dust dust2 = Main.dust[num126];
							dust2.velocity *= 0.1f;
							dust2 = Main.dust[num126];
							dust2.velocity += velocity * 0.5f;
							Main.dust[num126].position.X -= num123;
							Main.dust[num126].position.Y -= num124;
						}
						if (Main.rand.Next(8) == 0)
						{
							int num127 = 16;
							int num128 = Dust.NewDust(new Vector2(base.position.X + (float)num127, base.position.Y + (float)num127), width - num127 * 2, height - num127 * 2, 170, 0f, 0f, 100, default(Color), 0.5f);
							Dust dust2 = Main.dust[num128];
							dust2.velocity *= 0.25f;
							dust2 = Main.dust[num128];
							dust2.velocity += velocity * 0.5f;
						}
					}
					else
					{
						this.ai[0] += 1f;
					}
					return;
				}
				float num129 = 0.02f;
				float num130 = 0.2f;
				if (type == 22)
				{
					num129 = 0.01f;
					num130 = 0.15f;
				}
				scale -= num129;
				if (scale <= 0f)
				{
					Kill();
				}
				if (this.ai[0] > 3f)
				{
					velocity.Y += num130;
					for (int num131 = 0; num131 < 1; num131++)
					{
						for (int num132 = 0; num132 < 3; num132++)
						{
							float num133 = velocity.X / 3f * (float)num132;
							float num134 = velocity.Y / 3f * (float)num132;
							int num135 = 6;
							int num136 = Dust.NewDust(new Vector2(base.position.X + (float)num135, base.position.Y + (float)num135), width - num135 * 2, height - num135 * 2, 172, 0f, 0f, 100, default(Color), 1.2f);
							Main.dust[num136].noGravity = true;
							Dust dust2 = Main.dust[num136];
							dust2.velocity *= 0.3f;
							dust2 = Main.dust[num136];
							dust2.velocity += velocity * 0.5f;
							Main.dust[num136].position.X -= num133;
							Main.dust[num136].position.Y -= num134;
						}
						if (Main.rand.Next(8) == 0)
						{
							int num137 = 6;
							int num138 = Dust.NewDust(new Vector2(base.position.X + (float)num137, base.position.Y + (float)num137), width - num137 * 2, height - num137 * 2, 172, 0f, 0f, 100, default(Color), 0.75f);
							Dust dust2 = Main.dust[num138];
							dust2.velocity *= 0.5f;
							dust2 = Main.dust[num138];
							dust2.velocity += velocity * 0.5f;
						}
					}
				}
				else
				{
					this.ai[0] += 1f;
				}
			}
			else if (aiStyle == 13)
			{
				bool flag6 = Main.player[owner].dead;
				if (!flag6)
				{
					float num139 = (Main.player[owner].Center - base.Center).Length();
					flag6 = num139 > 2000f;
				}
				if (flag6)
				{
					Kill();
					return;
				}
				if (type != 481)
				{
					int dummyItemTime = 5;
					Main.player[owner].SetDummyItemTime(dummyItemTime);
				}
				if (alpha == 0)
				{
					if (base.position.X + (float)(width / 2) > Main.player[owner].position.X + (float)(Main.player[owner].width / 2))
					{
						Main.player[owner].ChangeDir(1);
					}
					else
					{
						Main.player[owner].ChangeDir(-1);
					}
				}
				if (type == 481)
				{
					if (this.ai[0] == 0f)
					{
						extraUpdates = 1;
					}
					else
					{
						extraUpdates = 2;
					}
				}
				Vector2 vector17 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
				float num140 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector17.X;
				float num141 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector17.Y;
				float num142 = (float)Math.Sqrt(num140 * num140 + num141 * num141);
				if (this.ai[0] == 0f)
				{
					if (num142 > 700f)
					{
						this.ai[0] = 1f;
					}
					else if (type == 262 && num142 > 500f)
					{
						this.ai[0] = 1f;
					}
					else if (type == 271 && num142 > 200f)
					{
						this.ai[0] = 1f;
					}
					else if (type == 273 && (Main.remixWorld ? (num142 > 300f) : (num142 > 150f)))
					{
						this.ai[0] = 1f;
					}
					else if (type == 481 && num142 > 525f)
					{
						this.ai[0] = 1f;
					}
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					this.ai[1] += 1f;
					if (this.ai[1] > 5f)
					{
						alpha = 0;
					}
					if (type == 262 && this.ai[1] > 8f)
					{
						this.ai[1] = 8f;
					}
					if (type == 271 && this.ai[1] > 8f)
					{
						this.ai[1] = 8f;
					}
					if (type == 273 && this.ai[1] > 8f)
					{
						this.ai[1] = 8f;
					}
					if (type == 481 && this.ai[1] > 8f)
					{
						this.ai[1] = 8f;
					}
					if (type == 404 && this.ai[1] > 8f)
					{
						this.ai[1] = 0f;
					}
					if (this.ai[1] >= 10f)
					{
						this.ai[1] = 15f;
						velocity.Y += 0.3f;
					}
					if (type == 262 && velocity.X < 0f)
					{
						spriteDirection = -1;
					}
					else if (type == 262)
					{
						spriteDirection = 1;
					}
					if (type == 271 && velocity.X < 0f)
					{
						spriteDirection = -1;
					}
					else if (type == 271)
					{
						spriteDirection = 1;
					}
				}
				else if (this.ai[0] == 1f)
				{
					tileCollide = false;
					rotation = (float)Math.Atan2(num141, num140) - 1.57f;
					float num143 = 20f;
					if (type == 262)
					{
						num143 = 30f;
					}
					if (num142 < 50f)
					{
						Kill();
					}
					num142 = num143 / num142;
					num140 *= num142;
					num141 *= num142;
					velocity.X = num140;
					velocity.Y = num141;
					if (type == 262 && velocity.X < 0f)
					{
						spriteDirection = 1;
					}
					else if (type == 262)
					{
						spriteDirection = -1;
					}
					if (type == 271 && velocity.X < 0f)
					{
						spriteDirection = 1;
					}
					else if (type == 271)
					{
						spriteDirection = -1;
					}
				}
			}
			else if (aiStyle == 14)
			{
				if (type == 870 && this.ai[1] > 0f)
				{
					aiStyle = 170;
				}
				if (type == 473 && Main.netMode != 2)
				{
					localAI[0] += 1f;
					if (localAI[0] >= 10f)
					{
						localAI[0] = 0f;
						int num144 = 30;
						if ((base.Center - Main.player[Main.myPlayer].Center).Length() < (float)(Main.screenWidth + num144 * 16))
						{
							Main.instance.SpelunkerProjectileHelper.AddSpotToCheck(base.Center);
						}
					}
				}
				if (type == 352)
				{
					if (localAI[1] == 0f)
					{
						localAI[1] = 1f;
					}
					alpha += (int)(25f * localAI[1]);
					if (alpha <= 0)
					{
						alpha = 0;
						localAI[1] = 1f;
					}
					else if (alpha >= 255)
					{
						alpha = 255;
						localAI[1] = -1f;
					}
					scale += localAI[1] * 0.01f;
				}
				if (type == 346)
				{
					if (localAI[0] == 0f)
					{
						localAI[0] = 1f;
						SoundEngine.PlaySound(SoundID.Item1, base.position);
					}
					frame = (int)this.ai[1];
					if (frame == 0)
					{
						Lighting.AddLight(base.Center, 0.25f, 0.2f, 0f);
					}
					else
					{
						Lighting.AddLight(base.Center, 0.15f, 0.15f, 0.15f);
					}
					if (owner == Main.myPlayer && timeLeft == 1)
					{
						for (int num145 = 0; num145 < 5; num145++)
						{
							float num146 = 10f;
							Vector2 vector18 = new Vector2(base.Center.X, base.Center.Y);
							float num147 = Main.rand.Next(-20, 21);
							float num148 = Main.rand.Next(-20, 0);
							float num149 = (float)Math.Sqrt(num147 * num147 + num148 * num148);
							num149 = num146 / num149;
							num147 *= num149;
							num148 *= num149;
							num147 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
							num148 *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
							int num150 = NewProjectile(GetProjectileSource_FromThis(), vector18.X, vector18.Y, num147, num148, 347, 40, 0f, Main.myPlayer, 0f, this.ai[1]);
						}
					}
				}
				if (type == 196)
				{
					int num151 = Main.rand.Next(1, 3);
					for (int num152 = 0; num152 < num151; num152++)
					{
						int num153 = Dust.NewDust(base.position, width, height, 31, 0f, 0f, 100);
						Dust dust2 = Main.dust[num153];
						dust2.alpha += Main.rand.Next(100);
						dust2 = Main.dust[num153];
						dust2.velocity *= 0.3f;
						Main.dust[num153].velocity.X += (float)Main.rand.Next(-10, 11) * 0.025f;
						Main.dust[num153].velocity.Y -= 0.4f + (float)Main.rand.Next(-3, 14) * 0.15f;
						Main.dust[num153].fadeIn = 1.25f + (float)Main.rand.Next(20) * 0.15f;
					}
				}
				if (type == 53)
				{
					try
					{
						int num154 = (int)(base.position.X / 16f) - 1;
						int num155 = (int)((base.position.X + (float)width) / 16f) + 2;
						int num156 = (int)(base.position.Y / 16f) - 1;
						int num157 = (int)((base.position.Y + (float)height) / 16f) + 2;
						if (num154 < 0)
						{
							num154 = 0;
						}
						if (num155 > Main.maxTilesX)
						{
							num155 = Main.maxTilesX;
						}
						if (num156 < 0)
						{
							num156 = 0;
						}
						if (num157 > Main.maxTilesY)
						{
							num157 = Main.maxTilesY;
						}
						Vector2 vector19 = default(Vector2);
						for (int num158 = num154; num158 < num155; num158++)
						{
							for (int num159 = num156; num159 < num157; num159++)
							{
								if (Main.tile[num158, num159] != null && Main.tile[num158, num159].nactive() && Main.tileSolid[Main.tile[num158, num159].type] && !Main.tileSolidTop[Main.tile[num158, num159].type])
								{
									vector19.X = num158 * 16;
									vector19.Y = num159 * 16;
									if (base.position.X + (float)width > vector19.X && base.position.X < vector19.X + 16f && base.position.Y + (float)height > vector19.Y && base.position.Y < vector19.Y + 16f)
									{
										velocity.X = 0f;
										velocity.Y = -0.2f;
									}
								}
							}
						}
					}
					catch
					{
					}
				}
				if (type == 277)
				{
					if (alpha > 0)
					{
						alpha -= 30;
						if (alpha < 0)
						{
							alpha = 0;
						}
					}
					if (Main.expertMode)
					{
						float num160 = 12f;
						int num161 = Player.FindClosest(base.Center, 1, 1);
						Vector2 vector20 = Main.player[num161].Center - base.Center;
						vector20.Normalize();
						vector20 *= num160;
						int num162 = 200;
						velocity.X = (velocity.X * (float)(num162 - 1) + vector20.X) / (float)num162;
						if (velocity.Length() > 16f)
						{
							velocity.Normalize();
							velocity *= 16f;
						}
					}
				}
				if (type == 261)
				{
					if (localAI[1] == 0f)
					{
						localAI[1] = 1f;
						localAI[0] = 80f;
					}
					rotation += velocity.X * 0.05f;
					if (velocity.Y != 0f)
					{
						rotation += (float)spriteDirection * 0.01f;
					}
					this.ai[0]++;
					if (this.ai[0] > 15f)
					{
						if (velocity.Y == 0f && velocity.X != 0f)
						{
							velocity.X *= 0.97f;
							Math.Abs(velocity.X);
							_ = 2f;
							if (Math.Abs(velocity.X) <= 0.01f)
							{
								Kill();
							}
						}
						this.ai[0] = 15f;
						velocity.Y += 0.2f;
					}
					if (localAI[0] > 0f)
					{
						localAI[0]--;
						int num163 = 5;
						int maxValue = num163;
						if (localAI[0] < 20f)
						{
							maxValue = num163 + num163;
						}
						if (localAI[0] < 10f)
						{
							maxValue = num163 + num163 + num163;
						}
						if (Main.rand.Next(maxValue) == 0)
						{
							Dust dust8 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(width / 2, height / 2), 31);
							Dust dust2 = dust8;
							dust2.velocity *= 0.33f;
							dust8.scale = 0.7f;
						}
						if (Main.rand.Next(maxValue) == 0)
						{
							Dust dust9 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(width / 2, height / 2), 228, Main.rand.NextVector2Circular(3f, 3f));
							dust9.scale = 0.6f;
							Dust dust2 = dust9;
							dust2.velocity *= 0.33f;
						}
					}
				}
				else if (type == 277)
				{
					this.ai[0] += 1f;
					if (this.ai[0] > 15f)
					{
						this.ai[0] = 15f;
						if (velocity.Y == 0f && velocity.X != 0f)
						{
							velocity.X *= 0.97f;
							if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
							{
								Kill();
							}
						}
						velocity.Y += 0.2f;
					}
					rotation += velocity.X * 0.05f;
				}
				else if (type == 378)
				{
					if (localAI[0] == 0f)
					{
						SoundEngine.PlaySound(SoundID.Item17, base.position);
						localAI[0] += 1f;
					}
					Rectangle rectangle2 = new Rectangle((int)base.position.X, (int)base.position.Y, width, height);
					for (int num164 = 0; num164 < 200; num164++)
					{
						if (Main.npc[num164].CanBeChasedBy(this, ignoreDontTakeDamage: true))
						{
							Rectangle value2 = new Rectangle((int)Main.npc[num164].position.X, (int)Main.npc[num164].position.Y, Main.npc[num164].width, Main.npc[num164].height);
							if (rectangle2.Intersects(value2))
							{
								Kill();
								return;
							}
						}
					}
					this.ai[0] += 1f;
					if (this.ai[0] > 10f)
					{
						this.ai[0] = 90f;
						if (velocity.Y == 0f && velocity.X != 0f)
						{
							velocity.X *= 0.96f;
							if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
							{
								Kill();
							}
						}
						velocity.Y += 0.2f;
					}
					rotation += velocity.X * 0.1f;
				}
				else if (type == 483)
				{
					this.ai[0] += 1f;
					if (this.ai[0] > 5f)
					{
						if (owner == Main.myPlayer && this.ai[0] > (float)Main.rand.Next(20, 130))
						{
							Kill();
						}
						if (velocity.Y == 0f && velocity.X != 0f)
						{
							velocity.X *= 0.97f;
							if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
							{
								velocity.X = 0f;
								netUpdate = true;
							}
						}
						velocity.Y += 0.3f;
						velocity.X *= 0.99f;
					}
					rotation += velocity.X * 0.05f;
				}
				else if (type == 538)
				{
					this.ai[0] += 1f;
					if (this.ai[0] > 60f || velocity.Y >= 0f)
					{
						alpha += 6;
						velocity *= 0.5f;
					}
					else if (this.ai[0] > 5f)
					{
						velocity.Y += 0.1f;
						velocity.X *= 1.025f;
						alpha -= 23;
						scale = 0.8f * (255f - (float)alpha) / 255f;
						if (alpha < 0)
						{
							alpha = 0;
						}
					}
					if (alpha >= 255 && this.ai[0] > 5f)
					{
						Kill();
						return;
					}
				}
				else
				{
					this.ai[0] += 1f;
					if (this.ai[0] > 5f)
					{
						this.ai[0] = 5f;
						if (velocity.Y == 0f && velocity.X != 0f)
						{
							velocity.X *= 0.97f;
							if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
							{
								velocity.X = 0f;
								netUpdate = true;
							}
						}
						velocity.Y += 0.2f;
					}
					rotation += velocity.X * 0.1f;
				}
				if (type == 538)
				{
					if (localAI[1] == 0f)
					{
						localAI[1] = 1f;
						SoundEngine.PlaySound(4, (int)base.position.X, (int)base.position.Y, 7);
					}
					if (velocity.Y < 0f && this.ai[0] < 60f)
					{
						if (Main.rand.Next(4) == 0)
						{
							int num165 = Dust.NewDust(base.position, width, height, 180, 0f, 0f, 100);
							Main.dust[num165].position = base.Center;
							Dust dust2 = Main.dust[num165];
							dust2.scale += (float)Main.rand.Next(50) * 0.01f;
							Main.dust[num165].noGravity = true;
							Main.dust[num165].velocity.Y -= 2f;
						}
						if (Main.rand.Next(6) == 0)
						{
							int num166 = Dust.NewDust(base.position, width, height, 176, 0f, 0f, 100);
							Main.dust[num166].position = base.Center;
							Dust dust2 = Main.dust[num166];
							dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
							Main.dust[num166].noGravity = true;
							dust2 = Main.dust[num166];
							dust2.velocity *= 0.1f;
						}
					}
				}
				if (type == 450)
				{
					if (this.ai[1] == 0f)
					{
						this.ai[1] = 1f;
						SoundEngine.PlaySound(SoundID.Item13, base.position);
					}
					if (Main.rand.Next(2) == 0)
					{
						int num167 = Dust.NewDust(base.position, width, height, 228, 0f, 0f, 100);
						Main.dust[num167].position.X -= 2f;
						Main.dust[num167].position.Y += 2f;
						Dust dust2 = Main.dust[num167];
						dust2.scale += (float)Main.rand.Next(50) * 0.01f;
						Main.dust[num167].noGravity = true;
						Main.dust[num167].velocity.Y -= 2f;
					}
					if (Main.rand.Next(4) == 0)
					{
						int num168 = Dust.NewDust(base.position, width, height, 228, 0f, 0f, 100);
						Main.dust[num168].position.X -= 2f;
						Main.dust[num168].position.Y += 2f;
						Dust dust2 = Main.dust[num168];
						dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
						Main.dust[num168].noGravity = true;
						dust2 = Main.dust[num168];
						dust2.velocity *= 0.1f;
					}
					if (++frameCounter >= 3)
					{
						frameCounter = 0;
						if (++frame >= 5)
						{
							frame = 0;
						}
					}
					if ((double)velocity.Y < 0.25 && (double)velocity.Y > 0.15)
					{
						velocity.X *= 0.8f;
					}
					rotation = (0f - velocity.X) * 0.05f;
				}
				if (type == 480)
				{
					alpha = 255;
					int num169 = Dust.NewDust(base.position, width, height, 75, 0f, 0f, 100);
					Main.dust[num169].position.X -= 2f;
					Main.dust[num169].position.Y += 2f;
					Dust dust2 = Main.dust[num169];
					dust2.scale += (float)Main.rand.Next(50) * 0.01f;
					Main.dust[num169].noGravity = true;
					Main.dust[num169].velocity.Y -= 2f;
					if (Main.rand.Next(2) == 0)
					{
						int num170 = Dust.NewDust(base.position, width, height, 75, 0f, 0f, 100);
						Main.dust[num170].position.X -= 2f;
						Main.dust[num170].position.Y += 2f;
						dust2 = Main.dust[num170];
						dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
						Main.dust[num170].noGravity = true;
						dust2 = Main.dust[num170];
						dust2.velocity *= 0.1f;
					}
				}
				if (type >= 326 && type <= 328)
				{
					if (wet)
					{
						Kill();
					}
					if (this.ai[1] == 0f && type >= 326 && type <= 328)
					{
						this.ai[1] = 1f;
						SoundEngine.PlaySound(SoundID.Item13, base.position);
					}
					if (Main.rand.Next(3) != 0)
					{
						Dust dust10 = Dust.NewDustDirect(base.position, width, height, 6);
						dust10.velocity.Y -= 2f;
						dust10.noGravity = true;
						Dust dust2 = dust10;
						dust2.scale += Main.rand.NextFloat() * 0.8f + 0.3f;
						dust2 = dust10;
						dust2.velocity += velocity * 1f;
					}
					if ((double)velocity.Y < 0.25 && (double)velocity.Y > 0.15)
					{
						velocity.X *= 0.8f;
					}
					rotation = (0f - velocity.X) * 0.05f;
				}
				if (type >= 400 && type <= 402)
				{
					if (wet)
					{
						Kill();
					}
					if (this.ai[1] == 0f && type >= 326 && type <= 328)
					{
						this.ai[1] = 1f;
						SoundEngine.PlaySound(SoundID.Item13, base.position);
					}
					int num171 = Dust.NewDust(base.position, width, height, 6, 0f, 0f, 100);
					Main.dust[num171].position.X -= 2f;
					Main.dust[num171].position.Y += 2f;
					Dust dust2 = Main.dust[num171];
					dust2.scale += (float)Main.rand.Next(50) * 0.01f;
					Main.dust[num171].noGravity = true;
					Main.dust[num171].velocity.Y -= 2f;
					if (Main.rand.Next(2) == 0)
					{
						int num172 = Dust.NewDust(base.position, width, height, 6, 0f, 0f, 100);
						Main.dust[num172].position.X -= 2f;
						Main.dust[num172].position.Y += 2f;
						dust2 = Main.dust[num172];
						dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
						Main.dust[num172].noGravity = true;
						dust2 = Main.dust[num172];
						dust2.velocity *= 0.1f;
					}
					if ((double)velocity.Y < 0.25 && (double)velocity.Y > 0.15)
					{
						velocity.X *= 0.8f;
					}
					rotation = (0f - velocity.X) * 0.05f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
			}
			else if (aiStyle == 15)
			{
				AI_015_Flails();
			}
			else if (aiStyle == 16)
			{
				AI_016();
			}
			else if (aiStyle == 17)
			{
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.98f;
				}
				rotation += velocity.X * 0.1f;
				velocity.Y += 0.2f;
				if (Main.getGoodWorld && Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 1f)
				{
					damage = 0;
					knockBack = 0f;
				}
				if (owner != Main.myPlayer)
				{
					return;
				}
				int num173 = (int)((base.position.X + (float)(width / 2)) / 16f);
				int num174 = (int)((base.position.Y + (float)height - 4f) / 16f);
				if (Main.tile[num173, num174] == null)
				{
					return;
				}
				int style = 0;
				if (type >= 201 && type <= 205)
				{
					style = type - 200;
				}
				if (type >= 527 && type <= 531)
				{
					style = type - 527 + 6;
				}
				bool flag7 = false;
				TileObject objectData = default(TileObject);
				if (TileObject.CanPlace(num173, num174, 85, style, direction, out objectData))
				{
					flag7 = TileObject.Place(objectData);
				}
				if (flag7)
				{
					NetMessage.SendObjectPlacement(-1, num173, num174, objectData.type, objectData.style, objectData.alternate, objectData.random, direction);
					SoundEngine.PlaySound(0, num173 * 16, num174 * 16);
					int num175 = Sign.ReadSign(num173, num174);
					if (num175 >= 0)
					{
						Sign.TextSign(num175, miscText);
						NetMessage.SendData(47, -1, -1, null, num175, 0f, (int)(byte)new BitsByte(b1: true));
					}
					Kill();
				}
			}
			else if (aiStyle == 18)
			{
				if (this.ai[1] == 0f && type == 44)
				{
					this.ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item8, base.position);
				}
				if (type == 263 || type == 274)
				{
					if (type == 274 && velocity.X < 0f)
					{
						spriteDirection = -1;
					}
					rotation += (float)direction * 0.05f;
					rotation += (float)direction * 0.5f * ((float)timeLeft / 180f);
					if (type == 274)
					{
						velocity *= 0.96f;
					}
					else
					{
						velocity *= 0.95f;
					}
					return;
				}
				rotation += (float)direction * 0.8f;
				this.ai[0] += 1f;
				if (!(this.ai[0] < 30f))
				{
					if (this.ai[0] < 100f)
					{
						velocity *= 1.06f;
					}
					else
					{
						this.ai[0] = 200f;
					}
				}
				for (int num176 = 0; num176 < 2; num176++)
				{
					int num177 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 27, 0f, 0f, 100);
					Main.dust[num177].noGravity = true;
				}
			}
			else if (aiStyle == 19)
			{
				AI_019_Spears();
			}
			else if (aiStyle == 20)
			{
				timeLeft = 60;
				if (type == 252)
				{
					frameCounter++;
					if (frameCounter >= 4)
					{
						frameCounter = 0;
						frame++;
					}
					if (frame > 3)
					{
						frame = 0;
					}
				}
				if (type == 509)
				{
					frameCounter++;
					if (frameCounter >= 2)
					{
						frameCounter = 0;
						frame++;
					}
					if (frame > 1)
					{
						frame = 0;
					}
				}
				if (soundDelay <= 0)
				{
					SoundEngine.PlaySound(SoundID.Item22, base.position);
					soundDelay = 30;
				}
				Vector2 vector21 = Main.player[owner].RotatedRelativePoint(Main.player[owner].MountedCenter);
				if (Main.myPlayer == owner)
				{
					if (Main.player[owner].channel)
					{
						float num178 = Main.player[owner].inventory[Main.player[owner].selectedItem].shootSpeed * scale;
						Vector2 vector22 = vector21;
						float num179 = (float)Main.mouseX + Main.screenPosition.X - vector22.X;
						float num180 = (float)Main.mouseY + Main.screenPosition.Y - vector22.Y;
						if (Main.player[owner].gravDir == -1f)
						{
							num180 = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector22.Y;
						}
						float num181 = (float)Math.Sqrt(num179 * num179 + num180 * num180);
						num181 = (float)Math.Sqrt(num179 * num179 + num180 * num180);
						num181 = num178 / num181;
						num179 *= num181;
						num180 *= num181;
						if (num179 != velocity.X || num180 != velocity.Y)
						{
							netUpdate = true;
						}
						velocity.X = num179;
						velocity.Y = num180;
					}
					else
					{
						Kill();
					}
				}
				if (velocity.X > 0f)
				{
					Main.player[owner].ChangeDir(1);
				}
				else if (velocity.X < 0f)
				{
					Main.player[owner].ChangeDir(-1);
				}
				spriteDirection = direction;
				Main.player[owner].ChangeDir(direction);
				Main.player[owner].heldProj = whoAmI;
				Main.player[owner].SetDummyItemTime(2);
				base.position.X = vector21.X - (float)(width / 2);
				base.position.Y = vector21.Y - (float)(height / 2);
				rotation = (float)(Math.Atan2(velocity.Y, velocity.X) + 1.5700000524520874);
				if (Main.player[owner].direction == 1)
				{
					Main.player[owner].itemRotation = (float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction);
				}
				else
				{
					Main.player[owner].itemRotation = (float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction);
				}
				velocity.X *= 1f + (float)Main.rand.Next(-3, 4) * 0.01f;
				if (Main.rand.Next(6) == 0)
				{
					int num182 = Dust.NewDust(base.position + velocity * Main.rand.Next(6, 10) * 0.1f, width, height, 31, 0f, 0f, 80, default(Color), 1.4f);
					Main.dust[num182].position.X -= 4f;
					Main.dust[num182].noGravity = true;
					Dust dust2 = Main.dust[num182];
					dust2.velocity *= 0.2f;
					Main.dust[num182].velocity.Y = (float)(-Main.rand.Next(7, 13)) * 0.15f;
				}
			}
			else if (aiStyle == 21)
			{
				rotation = velocity.X * 0.1f;
				spriteDirection = -direction;
				if (Main.rand.Next(3) == 0)
				{
					int num183 = Dust.NewDust(base.position, width, height, 27, 0f, 0f, 80);
					Main.dust[num183].noGravity = true;
					Dust dust2 = Main.dust[num183];
					dust2.velocity *= 0.2f;
				}
				if (this.ai[1] == 1f)
				{
					this.ai[1] = 0f;
					Main.musicPitch = this.ai[0];
					SoundEngine.PlaySound(SoundID.Item26, base.position);
				}
			}
			else if (aiStyle == 22)
			{
				if (velocity.X == 0f && velocity.Y == 0f)
				{
					alpha = 255;
				}
				Dust dust2;
				if (this.ai[1] < 0f)
				{
					if (timeLeft > 60)
					{
						timeLeft = 60;
					}
					if (velocity.X > 0f)
					{
						rotation += 0.3f;
					}
					else
					{
						rotation -= 0.3f;
					}
					int num184 = (int)(base.position.X / 16f) - 1;
					int num185 = (int)((base.position.X + (float)width) / 16f) + 2;
					int num186 = (int)(base.position.Y / 16f) - 1;
					int num187 = (int)((base.position.Y + (float)height) / 16f) + 2;
					if (num184 < 0)
					{
						num184 = 0;
					}
					if (num185 > Main.maxTilesX)
					{
						num185 = Main.maxTilesX;
					}
					if (num186 < 0)
					{
						num186 = 0;
					}
					if (num187 > Main.maxTilesY)
					{
						num187 = Main.maxTilesY;
					}
					int num188 = (int)base.position.X + 4;
					int num189 = (int)base.position.Y + 4;
					Vector2 vector23 = default(Vector2);
					for (int num190 = num184; num190 < num185; num190++)
					{
						for (int num191 = num186; num191 < num187; num191++)
						{
							if (Main.tile[num190, num191] != null && Main.tile[num190, num191].active() && Main.tile[num190, num191].type != 127 && Main.tileSolid[Main.tile[num190, num191].type] && !Main.tileSolidTop[Main.tile[num190, num191].type])
							{
								vector23.X = num190 * 16;
								vector23.Y = num191 * 16;
								if ((float)(num188 + 8) > vector23.X && (float)num188 < vector23.X + 16f && (float)(num189 + 8) > vector23.Y && (float)num189 < vector23.Y + 16f)
								{
									Kill();
								}
							}
						}
					}
					int num192 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 67);
					Main.dust[num192].noGravity = true;
					dust2 = Main.dust[num192];
					dust2.velocity *= 0.3f;
					return;
				}
				if (this.ai[0] < 0f)
				{
					if (this.ai[0] == -1f)
					{
						for (int num193 = 0; num193 < 10; num193++)
						{
							int num194 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 67, 0f, 0f, 0, default(Color), 1.1f);
							Main.dust[num194].noGravity = true;
							dust2 = Main.dust[num194];
							dust2.velocity *= 1.3f;
						}
					}
					else if (Main.rand.Next(30) == 0)
					{
						int num195 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 67, 0f, 0f, 100);
						dust2 = Main.dust[num195];
						dust2.velocity *= 0.2f;
					}
					int num196 = (int)base.position.X / 16;
					int num197 = (int)base.position.Y / 16;
					if (Main.tile[num196, num197] == null || !Main.tile[num196, num197].active())
					{
						Kill();
					}
					this.ai[0] -= 1f;
					if (this.ai[0] <= -900f && (Main.myPlayer == owner || Main.netMode == 2) && Main.tile[num196, num197].active() && Main.tile[num196, num197].type == 127)
					{
						WorldGen.KillTile(num196, num197);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(17, -1, -1, null, 0, num196, num197);
						}
						Kill();
					}
					return;
				}
				int num198 = (int)(base.position.X / 16f) - 1;
				int num199 = (int)((base.position.X + (float)width) / 16f) + 2;
				int num200 = (int)(base.position.Y / 16f) - 1;
				int num201 = (int)((base.position.Y + (float)height) / 16f) + 2;
				if (num198 < 0)
				{
					num198 = 0;
				}
				if (num199 > Main.maxTilesX)
				{
					num199 = Main.maxTilesX;
				}
				if (num200 < 0)
				{
					num200 = 0;
				}
				if (num201 > Main.maxTilesY)
				{
					num201 = Main.maxTilesY;
				}
				int num202 = (int)base.position.X + 4;
				int num203 = (int)base.position.Y + 4;
				Vector2 vector24 = default(Vector2);
				for (int num204 = num198; num204 < num199; num204++)
				{
					for (int num205 = num200; num205 < num201; num205++)
					{
						if (Main.tile[num204, num205] != null && Main.tile[num204, num205].nactive() && Main.tile[num204, num205].type != 127 && Main.tileSolid[Main.tile[num204, num205].type] && !Main.tileSolidTop[Main.tile[num204, num205].type])
						{
							vector24.X = num204 * 16;
							vector24.Y = num205 * 16;
							if ((float)(num202 + 8) > vector24.X && (float)num202 < vector24.X + 16f && (float)(num203 + 8) > vector24.Y && (float)num203 < vector24.Y + 16f)
							{
								Kill();
							}
						}
					}
				}
				if (lavaWet)
				{
					Kill();
				}
				int num206 = (int)(base.Center.X / 16f);
				int num207 = (int)(base.Center.Y / 16f);
				if (WorldGen.InWorld(num206, num207) && Main.tile[num206, num207] != null && Main.tile[num206, num207].liquid > 0 && Main.tile[num206, num207].shimmer())
				{
					Kill();
				}
				if (!active)
				{
					return;
				}
				int num208 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 67);
				Main.dust[num208].noGravity = true;
				dust2 = Main.dust[num208];
				dust2.velocity *= 0.3f;
				int num209 = (int)this.ai[0];
				int num210 = (int)this.ai[1];
				if (WorldGen.InWorld(num209, num210) && WorldGen.SolidTile(num209, num210))
				{
					if (Math.Abs(velocity.X) > Math.Abs(velocity.Y))
					{
						if (base.Center.Y < (float)(num210 * 16 + 8) && WorldGen.InWorld(num209, num210 - 1) && !WorldGen.SolidTile(num209, num210 - 1))
						{
							num210--;
						}
						else if (WorldGen.InWorld(num209, num210 + 1) && !WorldGen.SolidTile(num209, num210 + 1))
						{
							num210++;
						}
						else if (WorldGen.InWorld(num209, num210 - 1) && !WorldGen.SolidTile(num209, num210 - 1))
						{
							num210--;
						}
						else if (base.Center.X < (float)(num209 * 16 + 8) && WorldGen.InWorld(num209 - 1, num210) && !WorldGen.SolidTile(num209 - 1, num210))
						{
							num209--;
						}
						else if (WorldGen.InWorld(num209 + 1, num210) && !WorldGen.SolidTile(num209 + 1, num210))
						{
							num209++;
						}
						else if (WorldGen.InWorld(num209 - 1, num210) && !WorldGen.SolidTile(num209 - 1, num210))
						{
							num209--;
						}
					}
					else if (base.Center.X < (float)(num209 * 16 + 8) && WorldGen.InWorld(num209 - 1, num210) && !WorldGen.SolidTile(num209 - 1, num210))
					{
						num209--;
					}
					else if (WorldGen.InWorld(num209 + 1, num210) && !WorldGen.SolidTile(num209 + 1, num210))
					{
						num209++;
					}
					else if (WorldGen.InWorld(num209 - 1, num210) && !WorldGen.SolidTile(num209 - 1, num210))
					{
						num209--;
					}
					else if (base.Center.Y < (float)(num210 * 16 + 8) && WorldGen.InWorld(num209, num210 - 1) && !WorldGen.SolidTile(num209, num210 - 1))
					{
						num210--;
					}
					else if (WorldGen.InWorld(num209, num210 + 1) && !WorldGen.SolidTile(num209, num210 + 1))
					{
						num210++;
					}
					else if (WorldGen.InWorld(num209, num210 - 1) && !WorldGen.SolidTile(num209, num210 - 1))
					{
						num210--;
					}
				}
				if (velocity.X > 0f)
				{
					rotation += 0.3f;
				}
				else
				{
					rotation -= 0.3f;
				}
				if (Main.myPlayer != owner)
				{
					return;
				}
				int num211 = (int)((base.position.X + (float)(width / 2)) / 16f);
				int num212 = (int)((base.position.Y + (float)(height / 2)) / 16f);
				bool flag8 = false;
				if (num211 == num209 && num212 == num210)
				{
					flag8 = true;
				}
				if (((velocity.X <= 0f && num211 <= num209) || (velocity.X >= 0f && num211 >= num209)) && ((velocity.Y <= 0f && num212 <= num210) || (velocity.Y >= 0f && num212 >= num210)))
				{
					flag8 = true;
				}
				if (!flag8)
				{
					return;
				}
				if (WorldGen.PlaceTile(num209, num210, 127, mute: false, forced: false, owner))
				{
					if (Main.netMode == 1)
					{
						NetMessage.SendData(17, -1, -1, null, 1, num209, num210, 127f);
					}
					damage = 0;
					this.ai[0] = -1f;
					velocity *= 0f;
					alpha = 255;
					base.position.X = num209 * 16;
					base.position.Y = num210 * 16;
					netUpdate = true;
				}
				else
				{
					this.ai[1] = -1f;
				}
			}
			else if (aiStyle == 23)
			{
				if (type == 188)
				{
					if (this.ai[0] < 8f)
					{
						this.ai[0] = 8f;
					}
					localAI[0]++;
				}
				if (timeLeft > 60)
				{
					timeLeft = 60;
				}
				if (this.ai[0] > 7f)
				{
					float num213 = 1f;
					if (this.ai[0] == 8f)
					{
						num213 = 0.25f;
					}
					else if (this.ai[0] == 9f)
					{
						num213 = 0.5f;
					}
					else if (this.ai[0] == 10f)
					{
						num213 = 0.75f;
					}
					this.ai[0] += 1f;
					int num214 = 6;
					if (type == 101)
					{
						num214 = 75;
					}
					if (num214 == 6 || Main.rand.Next(2) == 0)
					{
						for (int num215 = 0; num215 < 1; num215++)
						{
							int num216 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, num214, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
							Dust dust2;
							if (Main.rand.Next(3) != 0 || (num214 == 75 && Main.rand.Next(3) == 0))
							{
								Main.dust[num216].noGravity = true;
								dust2 = Main.dust[num216];
								dust2.scale *= 3f;
								Main.dust[num216].velocity.X *= 2f;
								Main.dust[num216].velocity.Y *= 2f;
							}
							if (type == 188)
							{
								dust2 = Main.dust[num216];
								dust2.scale *= 1.25f;
							}
							else
							{
								dust2 = Main.dust[num216];
								dust2.scale *= 1.5f;
							}
							Main.dust[num216].velocity.X *= 1.2f;
							Main.dust[num216].velocity.Y *= 1.2f;
							dust2 = Main.dust[num216];
							dust2.scale *= num213;
							if (num214 == 75)
							{
								dust2 = Main.dust[num216];
								dust2.velocity += velocity;
								if (!Main.dust[num216].noGravity)
								{
									dust2 = Main.dust[num216];
									dust2.velocity *= 0.5f;
								}
							}
						}
					}
				}
				else
				{
					this.ai[0] += 1f;
				}
				rotation += 0.3f * (float)direction;
			}
			else if (aiStyle == 24)
			{
				light = scale * 0.5f;
				rotation += velocity.X * 0.2f;
				this.ai[1] += 1f;
				if (type == 94)
				{
					if (Main.rand.Next(4) == 0)
					{
						int num217 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 70);
						Main.dust[num217].noGravity = true;
						Dust dust2 = Main.dust[num217];
						dust2.velocity *= 0.5f;
						dust2 = Main.dust[num217];
						dust2.scale *= 0.9f;
					}
					velocity *= 0.985f;
					if (this.ai[1] > 130f)
					{
						scale -= 0.05f;
						if ((double)scale <= 0.2)
						{
							scale = 0.2f;
							Kill();
						}
					}
					return;
				}
				velocity *= 0.96f;
				if (this.ai[1] > 15f)
				{
					scale -= 0.05f;
					if ((double)scale <= 0.2)
					{
						scale = 0.2f;
						Kill();
					}
				}
			}
			else if (aiStyle == 25)
			{
				if (type == 1013)
				{
					localAI[0]++;
				}
				if (type == 1014)
				{
					frame = Main.tileFrame[665];
				}
				if (this.ai[0] != 0f && velocity.Y <= 0f && velocity.X == 0f)
				{
					float num218 = 0.5f;
					int i2 = (int)((base.position.X - 8f) / 16f);
					int num219 = (int)(base.position.Y / 16f);
					bool flag9 = false;
					bool flag10 = false;
					if (WorldGen.SolidTile(i2, num219) || WorldGen.SolidTile(i2, num219 + 1))
					{
						flag9 = true;
					}
					i2 = (int)((base.position.X + (float)width + 8f) / 16f);
					if (WorldGen.SolidTile(i2, num219) || WorldGen.SolidTile(i2, num219 + 1))
					{
						flag10 = true;
					}
					if (flag9)
					{
						velocity.X = num218;
					}
					else if (flag10)
					{
						velocity.X = 0f - num218;
					}
					else
					{
						i2 = (int)((base.position.X - 8f - 16f) / 16f);
						num219 = (int)(base.position.Y / 16f);
						flag9 = false;
						flag10 = false;
						if (WorldGen.SolidTile(i2, num219) || WorldGen.SolidTile(i2, num219 + 1))
						{
							flag9 = true;
						}
						i2 = (int)((base.position.X + (float)width + 8f + 16f) / 16f);
						if (WorldGen.SolidTile(i2, num219) || WorldGen.SolidTile(i2, num219 + 1))
						{
							flag10 = true;
						}
						if (flag9)
						{
							velocity.X = num218;
						}
						else if (flag10)
						{
							velocity.X = 0f - num218;
						}
						else
						{
							i2 = (int)((base.position.X - 8f - 32f) / 16f);
							num219 = (int)(base.position.Y / 16f);
							flag9 = false;
							flag10 = false;
							if (WorldGen.SolidTile(i2, num219) || WorldGen.SolidTile(i2, num219 + 1))
							{
								flag9 = true;
							}
							i2 = (int)((base.position.X + (float)width + 8f + 32f) / 16f);
							if (WorldGen.SolidTile(i2, num219) || WorldGen.SolidTile(i2, num219 + 1))
							{
								flag10 = true;
							}
							if (!flag9 && !flag10)
							{
								if ((int)(base.Center.X / 16f) % 2 == 0)
								{
									flag9 = true;
								}
								else
								{
									flag10 = true;
								}
							}
							if (flag9)
							{
								velocity.X = num218;
							}
							else if (flag10)
							{
								velocity.X = 0f - num218;
							}
						}
					}
				}
				rotation += velocity.X * 0.06f;
				this.ai[0] = 1f;
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				if (type == 1021)
				{
					if (Math.Abs(velocity.Y) <= 1f)
					{
						if (velocity.X > 0f && (double)velocity.X < 3.5)
						{
							velocity.X += 0.025f;
						}
						if (velocity.X < 0f && (double)velocity.X > -3.5)
						{
							velocity.X -= 0.025f;
						}
					}
				}
				else if (velocity.Y <= 6f)
				{
					if (velocity.X > 0f && velocity.X < 7f)
					{
						velocity.X += 0.05f;
					}
					if (velocity.X < 0f && velocity.X > -7f)
					{
						velocity.X -= 0.05f;
					}
				}
				if (type == 1021)
				{
					velocity.Y += 0.06f;
				}
				else
				{
					velocity.Y += 0.3f;
				}
				if (type == 655 && wet)
				{
					Kill();
				}
			}
			else if (aiStyle == 26)
			{
				AI_026();
			}
			else if (aiStyle == 27)
			{
				if (type == 115)
				{
					this.ai[0] += 1f;
					if (this.ai[0] < 30f)
					{
						velocity *= 1.125f;
					}
				}
				if (type == 115 && localAI[1] < 5f)
				{
					localAI[1] = 5f;
					for (int num220 = 5; num220 < 25; num220++)
					{
						float num221 = velocity.X * (30f / (float)num220);
						float num222 = velocity.Y * (30f / (float)num220);
						num221 *= 80f;
						num222 *= 80f;
						int num223 = Dust.NewDust(new Vector2(base.position.X - num221, base.position.Y - num222), 8, 8, 27, oldVelocity.X, oldVelocity.Y, 100, default(Color), 0.9f);
						Dust dust2 = Main.dust[num223];
						dust2.velocity *= 0.25f;
						dust2 = Main.dust[num223];
						dust2.velocity -= velocity * 5f;
					}
				}
				if (localAI[1] > 7f && type == 173)
				{
					int num224 = Main.rand.Next(3);
					int num225 = Dust.NewDust(new Vector2(base.position.X - velocity.X * 4f + 2f, base.position.Y + 2f - velocity.Y * 4f), 8, 8, num224 switch
					{
						0 => 15, 
						1 => 57, 
						_ => 58, 
					}, 0f, 0f, 100, default(Color), 1.25f);
					Dust dust2 = Main.dust[num225];
					dust2.velocity *= 0.1f;
				}
				if (localAI[1] > 7f && type == 132)
				{
					int num226 = Dust.NewDust(new Vector2(base.position.X - velocity.X * 4f + 2f, base.position.Y + 2f - velocity.Y * 4f), 8, 8, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.25f);
					Dust dust2 = Main.dust[num226];
					dust2.velocity *= -0.25f;
					num226 = Dust.NewDust(new Vector2(base.position.X - velocity.X * 4f + 2f, base.position.Y + 2f - velocity.Y * 4f), 8, 8, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.25f);
					dust2 = Main.dust[num226];
					dust2.velocity *= -0.25f;
					dust2 = Main.dust[num226];
					dust2.position -= velocity * 0.5f;
				}
				if (localAI[1] < 15f)
				{
					localAI[1] += 1f;
				}
				else
				{
					if (type == 114 || type == 115)
					{
						int num227 = Dust.NewDust(new Vector2(base.position.X, base.position.Y + 4f), 8, 8, 27, oldVelocity.X, oldVelocity.Y, 100, default(Color), 0.6f);
						Dust dust2 = Main.dust[num227];
						dust2.velocity *= -0.25f;
					}
					else if (type == 116)
					{
						int num228 = Dust.NewDust(new Vector2(base.position.X - velocity.X * 5f + 2f, base.position.Y + 2f - velocity.Y * 5f), 8, 8, 64, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num228];
						dust2.velocity *= -0.25f;
						Main.dust[num228].noGravity = true;
					}
					if (localAI[0] == 0f)
					{
						scale -= 0.02f;
						alpha += 30;
						if (alpha >= 250)
						{
							alpha = 255;
							localAI[0] = 1f;
						}
					}
					else if (localAI[0] == 1f)
					{
						scale += 0.02f;
						alpha -= 30;
						if (alpha <= 0)
						{
							alpha = 0;
							localAI[0] = 0f;
						}
					}
				}
				if (this.ai[1] == 0f)
				{
					this.ai[1] = 1f;
					if (type == 132)
					{
						SoundEngine.PlaySound(SoundID.Item60, base.position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item8, base.position);
					}
				}
				if (type == 157)
				{
					rotation += (float)direction * 0.4f;
					spriteDirection = direction;
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 0.785f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
			}
			else if (aiStyle == 28)
			{
				if (type == 967)
				{
					localAI[0]++;
					if (localAI[0] >= 5f && timeLeft % 3 == 0)
					{
						localAI[0] = 5f;
						int num229 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 219, velocity.X, velocity.Y, 0, default(Color), 0.35f + (float)Main.rand.Next(-5, 5) * 0.01f);
						Main.dust[num229].noGravity = true;
						Main.dust[num229].velocity = velocity * 1.5f;
					}
					if (++frameCounter > 6)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
				}
				if (type == 177)
				{
					for (int num230 = 0; num230 < 3; num230++)
					{
						int num231 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 137, velocity.X, velocity.Y, Main.rand.Next(0, 101), default(Color), 1f + (float)Main.rand.Next(-20, 40) * 0.01f);
						Main.dust[num231].noGravity = true;
						Dust dust2 = Main.dust[num231];
						dust2.velocity *= 0.3f;
					}
				}
				if (type == 118)
				{
					for (int num232 = 0; num232 < 2; num232++)
					{
						int num233 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 92, velocity.X, velocity.Y, 50, default(Color), 1.2f);
						Main.dust[num233].noGravity = true;
						Dust dust2 = Main.dust[num233];
						dust2.velocity *= 0.3f;
					}
				}
				if (type == 119 || type == 128 || type == 359)
				{
					for (int num234 = 0; num234 < 3; num234++)
					{
						int num235 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 92, velocity.X, velocity.Y, 50, default(Color), 1.2f);
						Main.dust[num235].noGravity = true;
						Dust dust2 = Main.dust[num235];
						dust2.velocity *= 0.3f;
					}
				}
				if (type == 309)
				{
					for (int num236 = 0; num236 < 3; num236++)
					{
						int num237 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 185, velocity.X, velocity.Y, 50, default(Color), 1.2f);
						Main.dust[num237].noGravity = true;
						Dust dust2 = Main.dust[num237];
						dust2.velocity *= 0.3f;
					}
				}
				if (type == 129)
				{
					for (int num238 = 0; num238 < 6; num238++)
					{
						int num239 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 106, velocity.X, velocity.Y, 100);
						Main.dust[num239].noGravity = true;
						Dust dust2 = Main.dust[num239];
						dust2.velocity *= 0.1f + (float)Main.rand.Next(4) * 0.1f;
						dust2 = Main.dust[num239];
						dust2.scale *= 1f + (float)Main.rand.Next(5) * 0.1f;
					}
				}
				if (this.ai[1] != 0f)
				{
					return;
				}
				this.ai[1] = 1f;
				if (type == 967)
				{
					for (int num240 = 0; num240 < 10; num240++)
					{
						int num241 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 219, velocity.X, velocity.Y, 0, default(Color), 0.4f + (float)Main.rand.Next(-20, 40) * 0.01f);
						Main.dust[num241].noGravity = true;
						Main.dust[num241].velocity = (velocity * 0.5f).RotatedByRandom(0.5);
					}
					SoundEngine.PlaySound(SoundID.Item60, base.position);
				}
				else
				{
					SoundEngine.PlaySound(SoundID.Item28, base.position);
				}
			}
			else if (aiStyle == 29)
			{
				if (type == 619)
				{
					int num242 = (int)this.ai[0];
					for (int num243 = 0; num243 < 3; num243++)
					{
						int num244 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 254, velocity.X, velocity.Y, num242, default(Color), 1.2f);
						Main.dust[num244].position = (Main.dust[num244].position + base.Center) / 2f;
						Main.dust[num244].noGravity = true;
						Dust dust2 = Main.dust[num244];
						dust2.velocity *= 0.5f;
					}
					for (int num245 = 0; num245 < 2; num245++)
					{
						int num244 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 255, velocity.X, velocity.Y, num242, default(Color), 0.4f);
						switch (num245)
						{
						case 0:
							Main.dust[num244].position = (Main.dust[num244].position + base.Center * 5f) / 6f;
							break;
						case 1:
							Main.dust[num244].position = (Main.dust[num244].position + (base.Center + velocity / 2f) * 5f) / 6f;
							break;
						}
						Dust dust2 = Main.dust[num244];
						dust2.velocity *= 0.1f;
						Main.dust[num244].noGravity = true;
						Main.dust[num244].fadeIn = 1f;
					}
				}
				else if (type == 620)
				{
					int num246 = (int)this.ai[0];
					this.ai[1] += 1f;
					float num247 = (60f - this.ai[1]) / 60f;
					if (this.ai[1] > 40f)
					{
						Kill();
					}
					velocity.Y += 0.2f;
					if (velocity.Y > 18f)
					{
						velocity.Y = 18f;
					}
					velocity.X *= 0.98f;
					for (int num248 = 0; num248 < 2; num248++)
					{
						int num249 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, num246, velocity.X, velocity.Y, 50, default(Color), 1.1f);
						Main.dust[num249].position = (Main.dust[num249].position + base.Center) / 2f;
						Main.dust[num249].noGravity = true;
						Dust dust2 = Main.dust[num249];
						dust2.velocity *= 0.3f;
						dust2 = Main.dust[num249];
						dust2.scale *= num247;
					}
					for (int num250 = 0; num250 < 1; num250++)
					{
						int num249 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, num246, velocity.X, velocity.Y, 50, default(Color), 0.6f);
						Main.dust[num249].position = (Main.dust[num249].position + base.Center * 5f) / 6f;
						Dust dust2 = Main.dust[num249];
						dust2.velocity *= 0.1f;
						Main.dust[num249].noGravity = true;
						Main.dust[num249].fadeIn = 0.9f * num247;
						dust2 = Main.dust[num249];
						dust2.scale *= num247;
					}
				}
				else if (type == 521)
				{
					for (int num251 = 0; num251 < 3; num251++)
					{
						int num252 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 254, velocity.X, velocity.Y, 50, default(Color), 1.2f);
						Main.dust[num252].position = (Main.dust[num252].position + base.Center) / 2f;
						Main.dust[num252].noGravity = true;
						Dust dust2 = Main.dust[num252];
						dust2.velocity *= 0.5f;
					}
					for (int num253 = 0; num253 < 2; num253++)
					{
						int num252 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 255, velocity.X, velocity.Y, 50, default(Color), 0.4f);
						switch (num253)
						{
						case 0:
							Main.dust[num252].position = (Main.dust[num252].position + base.Center * 5f) / 6f;
							break;
						case 1:
							Main.dust[num252].position = (Main.dust[num252].position + (base.Center + velocity / 2f) * 5f) / 6f;
							break;
						}
						Dust dust2 = Main.dust[num252];
						dust2.velocity *= 0.1f;
						Main.dust[num252].noGravity = true;
						Main.dust[num252].fadeIn = 1f;
					}
				}
				else if (type == 522)
				{
					this.ai[1] += 1f;
					float num254 = (60f - this.ai[1]) / 60f;
					if (this.ai[1] > 40f)
					{
						Kill();
					}
					velocity.Y += 0.2f;
					if (velocity.Y > 18f)
					{
						velocity.Y = 18f;
					}
					velocity.X *= 0.98f;
					for (int num255 = 0; num255 < 2; num255++)
					{
						int num256 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 254, velocity.X, velocity.Y, 50, default(Color), 1.1f);
						Main.dust[num256].position = (Main.dust[num256].position + base.Center) / 2f;
						Main.dust[num256].noGravity = true;
						Dust dust2 = Main.dust[num256];
						dust2.velocity *= 0.3f;
						dust2 = Main.dust[num256];
						dust2.scale *= num254;
					}
					for (int num257 = 0; num257 < 1; num257++)
					{
						int num256 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 255, velocity.X, velocity.Y, 50, default(Color), 0.6f);
						Main.dust[num256].position = (Main.dust[num256].position + base.Center * 5f) / 6f;
						Dust dust2 = Main.dust[num256];
						dust2.velocity *= 0.1f;
						Main.dust[num256].noGravity = true;
						Main.dust[num256].fadeIn = 0.9f * num254;
						dust2 = Main.dust[num256];
						dust2.scale *= num254;
					}
				}
				else if (type == 731)
				{
					if (++frameCounter >= 4)
					{
						frameCounter = 0;
						if (++frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
					alpha -= 15;
					if (alpha < 0)
					{
						alpha = 0;
					}
					this.ai[0]++;
					if ((int)this.ai[0] % 2 != 0 && Main.rand.Next(4) == 0)
					{
						this.ai[0]++;
					}
					float num258 = 5f;
					switch ((int)this.ai[0])
					{
					case 10:
						velocity.Y -= num258;
						break;
					case 12:
						velocity.Y += num258;
						break;
					case 18:
						velocity.Y += num258;
						break;
					case 20:
						velocity.Y -= num258;
						this.ai[0] = 0f;
						break;
					}
					if (Main.rand.Next(3) == 0)
					{
						Dust dust11 = Dust.NewDustDirect(base.position, width, height, 226, velocity.X, velocity.Y, 50, default(Color), 0.4f);
						dust11.noGravity = true;
						dust11.velocity = dust11.velocity * 0f + velocity * 0.5f;
						if (Main.rand.Next(3) != 0)
						{
							Dust dust2 = dust11;
							dust2.velocity *= 1.4f;
						}
					}
					Lighting.AddLight(base.Center, 0.2f, 0.5f, 0.7f);
				}
				else
				{
					int num259 = type - 121 + 86;
					if (type == 597)
					{
						num259 = 262;
					}
					for (int num260 = 0; num260 < 2; num260++)
					{
						int num261 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, num259, velocity.X, velocity.Y, 50, default(Color), 1.2f);
						Main.dust[num261].noGravity = true;
						Dust dust2 = Main.dust[num261];
						dust2.velocity *= 0.3f;
					}
					if (this.ai[1] == 0f)
					{
						this.ai[1] = 1f;
						SoundEngine.PlaySound(SoundID.Item8, base.position);
					}
				}
			}
			else if (aiStyle == 30)
			{
				if (type == 907)
				{
					float num262 = 100f;
					float num263 = num262 - 50f;
					if (Main.rand.Next(Math.Max(4, 8 - (int)velocity.Length())) == 0)
					{
						int num264 = 5;
						int num265 = Dust.NewDust(base.position + new Vector2(num264, num264), width - num264 * 2, height - num264 * 2, 43, 0f, 0f, 254, new Color(255, 255, 0));
						Main.dust[num265].velocity = velocity * 0.75f;
					}
					if (this.ai[0] > num263)
					{
						velocity *= 0.9f;
						rotation *= 0.9f;
					}
					else
					{
						rotation += 0.2f;
						if (rotation > MathF.PI * 2f)
						{
							rotation -= MathF.PI * 2f;
						}
					}
					float num266 = this.ai[0];
					this.ai[0]++;
					if (Main.myPlayer == owner && this.ai[0] < num263 && this.ai[0] % 10f == 0f)
					{
						float num267 = MathF.PI / 2f * (float)((this.ai[0] % 20f != 0f) ? 1 : (-1));
						num267 *= (float)((whoAmI % 2 != 0) ? 1 : (-1));
						num267 += (float)Main.rand.Next(-5, 5) * MathHelper.Lerp(0.2f, 0.03f, this.ai[0] / num263);
						Vector2 v3 = velocity.RotatedBy(num267);
						v3 = v3.SafeNormalize(Vector2.Zero);
						v3 *= Math.Max(2.5f, (num263 - this.ai[0]) / num263 * (7f + (-2f + (float)Main.rand.Next(2) * 2f)));
						int num268 = NewProjectile(GetProjectileSource_FromThis(), base.Center, v3, 335, damage, knockBack * 0.25f, owner, 0f, Main.rand.Next(4));
					}
					if (num266 <= num263 && this.ai[0] > num263)
					{
						netUpdate = true;
					}
					if (this.ai[0] > num262)
					{
						Kill();
					}
				}
				else if (type == 335)
				{
					int num269 = (frame = (int)this.ai[1]);
					if (this.ai[0] < 0f)
					{
						velocity.Y += 0.25f;
						if (velocity.Y > 14f)
						{
							velocity.Y = 14f;
						}
					}
					else
					{
						if (Main.rand.Next(Math.Max(4, 8 - (int)velocity.Length())) == 0)
						{
							Color newColor = Color.White;
							switch (num269)
							{
							case 0:
								newColor = new Color(255, 100, 100);
								break;
							case 1:
								newColor = new Color(100, 255, 100);
								break;
							case 2:
								newColor = new Color(100, 100, 255);
								break;
							case 3:
								newColor = new Color(255, 255, 100);
								break;
							}
							int num270 = 5;
							int num271 = Dust.NewDust(base.position + new Vector2(num270, num270), width - num270 * 2, height - num270 * 2, 43, 0f, 0f, 254, newColor);
							Main.dust[num271].velocity = velocity * 0.75f;
						}
						velocity *= 0.95f;
					}
					if (this.ai[0] >= 0f && velocity.Length() < 0.25f)
					{
						if (velocity != Vector2.Zero)
						{
							velocity = Vector2.Zero;
							if (Main.netMode != 1)
							{
								this.ai[0] = 50f;
								netUpdate = true;
							}
						}
						this.ai[0]--;
					}
					localAI[0]++;
					rotation = (float)Math.Sin(localAI[0] / 10f);
				}
				else
				{
					velocity *= 0.8f;
					rotation += 0.2f;
					alpha += 4;
					if (alpha >= 255)
					{
						Kill();
					}
				}
			}
			else if (aiStyle == 31)
			{
				bool flag11 = this.ai[1] == 1f;
				short num272 = 110;
				int num273 = 0;
				switch (type)
				{
				default:
					num272 = 110;
					num273 = 0;
					break;
				case 147:
					num272 = 112;
					num273 = 1;
					break;
				case 146:
					num272 = 111;
					num273 = 2;
					break;
				case 148:
					num272 = 113;
					num273 = 3;
					break;
				case 149:
					num272 = 114;
					num273 = 4;
					break;
				case 1015:
					num272 = 311;
					num273 = 5;
					break;
				case 1016:
					num272 = 312;
					num273 = 6;
					break;
				case 1017:
					num272 = 313;
					num273 = 7;
					break;
				}
				if (owner == Main.myPlayer)
				{
					int size = 2;
					if (flag11)
					{
						size = 3;
					}
					Point point = base.Center.ToTileCoordinates();
					WorldGen.Convert(point.X, point.Y, num273, size);
				}
				if (timeLeft > 133)
				{
					timeLeft = 133;
				}
				int num274 = 7;
				if (flag11)
				{
					num274 = 3;
				}
				if (this.ai[0] > (float)num274)
				{
					float num275 = 1f;
					if (this.ai[0] == (float)(num274 + 1))
					{
						num275 = 0.2f;
					}
					else if (this.ai[0] == (float)(num274 + 2))
					{
						num275 = 0.4f;
					}
					else if (this.ai[0] == (float)(num274 + 3))
					{
						num275 = 0.6f;
					}
					else if (this.ai[0] == (float)(num274 + 4))
					{
						num275 = 0.8f;
					}
					int num276 = 0;
					if (flag11)
					{
						num275 *= 1.2f;
						num276 = (int)(12f * num275);
					}
					this.ai[0]++;
					for (int num277 = 0; num277 < 1; num277++)
					{
						int num278 = Dust.NewDust(new Vector2(base.position.X - (float)num276, base.position.Y - (float)num276), width + num276 * 2, height + num276 * 2, num272, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
						Main.dust[num278].noGravity = true;
						Dust dust2 = Main.dust[num278];
						dust2.scale *= 1.75f;
						Main.dust[num278].velocity.X *= 2f;
						Main.dust[num278].velocity.Y *= 2f;
						dust2 = Main.dust[num278];
						dust2.scale *= num275;
					}
				}
				else
				{
					this.ai[0]++;
				}
				rotation += 0.3f * (float)direction;
			}
			else if (aiStyle == 32)
			{
				timeLeft = 10;
				this.ai[0] += 1f;
				if (this.ai[0] >= 20f)
				{
					this.ai[0] = 18f;
					Rectangle rectangle3 = new Rectangle((int)base.position.X, (int)base.position.Y, width, height);
					for (int num279 = 0; num279 < 255; num279++)
					{
						Entity entity = Main.player[num279];
						if (entity.active && rectangle3.Intersects(entity.Hitbox))
						{
							this.ai[0] = 0f;
							velocity.Y = -4.5f;
							if (velocity.X > 2f)
							{
								velocity.X = 2f;
							}
							if (velocity.X < -2f)
							{
								velocity.X = -2f;
							}
							velocity.X = (velocity.X + (float)entity.direction * 1.75f) / 2f;
							velocity.X += entity.velocity.X * 3f;
							velocity.Y += entity.velocity.Y;
							if (velocity.X > 6f)
							{
								velocity.X = 6f;
							}
							if (velocity.X < -6f)
							{
								velocity.X = -6f;
							}
							if (velocity.Length() > 16f)
							{
								velocity = velocity.SafeNormalize(Vector2.Zero) * 16f;
							}
							netUpdate = true;
							this.ai[1] += 1f;
						}
					}
					for (int num280 = 0; num280 < 1000; num280++)
					{
						if (num280 == whoAmI)
						{
							continue;
						}
						Entity entity = Main.projectile[num280];
						if (entity.active && rectangle3.Intersects(entity.Hitbox))
						{
							this.ai[0] = 0f;
							velocity.Y = -4.5f;
							if (velocity.X > 2f)
							{
								velocity.X = 2f;
							}
							if (velocity.X < -2f)
							{
								velocity.X = -2f;
							}
							velocity.X = (velocity.X + (float)entity.direction * 1.75f) / 2f;
							velocity.X += entity.velocity.X * 3f;
							velocity.Y += entity.velocity.Y;
							if (velocity.X > 6f)
							{
								velocity.X = 6f;
							}
							if (velocity.X < -6f)
							{
								velocity.X = -6f;
							}
							if (velocity.Length() > 16f)
							{
								velocity = velocity.SafeNormalize(Vector2.Zero) * 16f;
							}
							netUpdate = true;
							this.ai[1] += 1f;
						}
					}
				}
				if (velocity.X == 0f && velocity.Y == 0f)
				{
					Kill();
				}
				rotation += 0.02f * velocity.X;
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.98f;
				}
				else if (wet)
				{
					velocity.X *= 0.99f;
				}
				else
				{
					velocity.X *= 0.995f;
				}
				if ((double)velocity.X > -0.03 && (double)velocity.X < 0.03)
				{
					velocity.X = 0f;
				}
				if (wet)
				{
					this.ai[1] = 0f;
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.95f;
					}
					velocity.Y -= 0.1f;
					if (velocity.Y < -4f)
					{
						velocity.Y = -4f;
					}
					if (velocity.X == 0f)
					{
						Kill();
					}
				}
				else
				{
					velocity.Y += 0.1f;
				}
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else if (aiStyle == 33)
			{
				if (alpha > 0)
				{
					alpha -= 50;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				float num281 = 4f;
				float num282 = this.ai[0];
				float num283 = this.ai[1];
				if (num282 == 0f && num283 == 0f)
				{
					num282 = 1f;
				}
				float num284 = (float)Math.Sqrt(num282 * num282 + num283 * num283);
				num284 = num281 / num284;
				num282 *= num284;
				num283 *= num284;
				if (alpha < 70)
				{
					short num285 = 127;
					switch (type)
					{
					case 163:
						num285 = 127;
						break;
					case 310:
						num285 = 187;
						break;
					case 1008:
						num285 = 169;
						break;
					case 1009:
						num285 = 75;
						break;
					case 1010:
						num285 = 66;
						break;
					case 1011:
						num285 = 310;
						break;
					}
					int num286 = Dust.NewDust(new Vector2(base.position.X, base.position.Y - 2f), 6, 6, num285, velocity.X, velocity.Y, 100, default(Color), 1.6f);
					Main.dust[num286].noGravity = true;
					Main.dust[num286].position.X -= num282 * 1f;
					Main.dust[num286].position.Y -= num283 * 1f;
					Main.dust[num286].velocity.X -= num282;
					Main.dust[num286].velocity.Y -= num283;
					if (type == 1010)
					{
						Main.dust[num286].color = Main.hslToRgb(Main.GlobalTimeWrappedHourly * 0.6f % 1f, 1f, 0.5f);
						Dust dust2 = Main.dust[num286];
						dust2.scale *= 0.5f;
						dust2 = Main.dust[num286];
						dust2.velocity *= 0.75f;
					}
				}
				if (localAI[0] == 0f)
				{
					this.ai[0] = velocity.X;
					this.ai[1] = velocity.Y;
					localAI[1] += 1f;
					if (localAI[1] >= 30f)
					{
						velocity.Y += 0.09f;
						localAI[1] = 30f;
					}
				}
				else
				{
					if (!Collision.SolidCollision(base.position, width, height))
					{
						localAI[0] = 0f;
						localAI[1] = 30f;
					}
					if (type == 1008 && Main.netMode != 2)
					{
						int num287 = 30;
						if ((base.Center - Main.player[Main.myPlayer].Center).Length() < (float)(Main.screenWidth + num287 * 16))
						{
							Main.instance.SpelunkerProjectileHelper.AddSpotToCheck(base.Center);
						}
					}
					damage = 0;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				rotation = (float)Math.Atan2(this.ai[1], this.ai[0]) + 1.57f;
			}
			else if (aiStyle == 34)
			{
				rotation = velocity.ToRotation() + MathF.PI / 2f;
				if (this.ai[1] == 1f)
				{
					this.ai[0]++;
					if (this.ai[0] == 1f)
					{
						for (int num288 = 0; num288 < 8; num288++)
						{
							int num289 = Dust.NewDust(base.position, width, height, 6, 0f, 0f, 100, default(Color), 1.8f);
							Main.dust[num289].noGravity = true;
							Dust dust2 = Main.dust[num289];
							dust2.velocity *= 3f;
							Main.dust[num289].fadeIn = 0.5f;
							dust2 = Main.dust[num289];
							dust2.position += velocity / 2f;
							dust2 = Main.dust[num289];
							dust2.velocity += velocity / 4f + Main.player[owner].velocity * 0.1f;
						}
					}
					if (this.ai[0] > 2f)
					{
						int num290 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 20f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
						Main.dust[num290].noGravity = true;
						Dust dust2 = Main.dust[num290];
						dust2.velocity *= 0.2f;
						Main.dust[num290].position = Main.dust[num290].position.RotatedBy(rotation, base.Center);
						num290 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 15f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
						Main.dust[num290].noGravity = true;
						dust2 = Main.dust[num290];
						dust2.velocity *= 0.2f;
						Main.dust[num290].position = Main.dust[num290].position.RotatedBy(rotation, base.Center);
						num290 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 10f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
						Main.dust[num290].noGravity = true;
						dust2 = Main.dust[num290];
						dust2.velocity *= 0.2f;
						Main.dust[num290].position = Main.dust[num290].position.RotatedBy(rotation, base.Center);
					}
				}
				else if (type >= 415 && type <= 418)
				{
					this.ai[0]++;
					if (this.ai[0] > 4f)
					{
						int num291 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 20f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
						Main.dust[num291].noGravity = true;
						Dust dust2 = Main.dust[num291];
						dust2.velocity *= 0.2f;
						Main.dust[num291].position = Main.dust[num291].position.RotatedBy(rotation, base.Center);
					}
				}
				else
				{
					int num292 = Dust.NewDust(new Vector2(base.position.X + 2f, base.position.Y + 20f), 8, 8, 6, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num292].noGravity = true;
					Dust dust2 = Main.dust[num292];
					dust2.velocity *= 0.2f;
					Main.dust[num292].position = Main.dust[num292].position.RotatedBy(rotation, base.Center);
				}
			}
			else if (aiStyle == 35)
			{
				this.ai[0] += 1f;
				if (this.ai[0] > 30f)
				{
					velocity.Y += 0.2f;
					velocity.X *= 0.985f;
					if (velocity.Y > 14f)
					{
						velocity.Y = 14f;
					}
				}
				rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * (float)direction * 0.02f;
				if (owner != Main.myPlayer)
				{
					return;
				}
				Vector2 vector25 = Collision.TileCollision(base.position, velocity, width, height, fallThrough: true, fall2: true);
				bool flag12 = false;
				if (vector25 != velocity)
				{
					flag12 = true;
				}
				else
				{
					int num293 = (int)(base.Center.X + velocity.X) / 16;
					int num294 = (int)(base.Center.Y + velocity.Y) / 16;
					if (Main.tile[num293, num294] != null && Main.tile[num293, num294].active() && Main.tile[num293, num294].bottomSlope())
					{
						flag12 = true;
						base.position.Y = num294 * 16 + 16 + 8;
						base.position.X = num293 * 16 + 8;
					}
				}
				if (!flag12)
				{
					return;
				}
				int num295 = 213;
				if (type == 475)
				{
					num295 = 353;
				}
				if (type == 506)
				{
					num295 = 366;
				}
				if (type == 505)
				{
					num295 = 365;
				}
				int num296 = (int)(base.position.X + (float)(width / 2)) / 16;
				int num297 = (int)(base.position.Y + (float)(height / 2)) / 16;
				base.position += vector25;
				int num298 = 10;
				if (Main.tile[num296, num297] == null)
				{
					return;
				}
				for (; Main.tile[num296, num297] != null && Main.tile[num296, num297].active() && Main.tileRope[Main.tile[num296, num297].type]; num297++)
				{
				}
				while (num298 > 0)
				{
					num298--;
					if (Main.tile[num296, num297] == null)
					{
						break;
					}
					if (Main.tile[num296, num297].active() && (Main.tileCut[Main.tile[num296, num297].type] || Main.tile[num296, num297].type == 165))
					{
						WorldGen.KillTile(num296, num297);
						NetMessage.SendData(17, -1, -1, null, 0, num296, num297);
					}
					if (!Main.tile[num296, num297].active())
					{
						WorldGen.PlaceTile(num296, num297, num295);
						NetMessage.SendData(17, -1, -1, null, 1, num296, num297, num295);
						this.ai[1] += 1f;
					}
					else
					{
						num298 = 0;
					}
					num297++;
				}
				Kill();
			}
			else if (aiStyle == 36)
			{
				if (type != 307 && wet && !honeyWet && !shimmerWet)
				{
					Kill();
				}
				if (alpha > 0)
				{
					alpha -= 50;
				}
				else
				{
					extraUpdates = 0;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (type == 307)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
					frameCounter++;
					if (frameCounter >= 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame >= 2)
					{
						frame = 0;
					}
					for (int num299 = 0; num299 < 3; num299++)
					{
						float num300 = velocity.X / 3f * (float)num299;
						float num301 = velocity.Y / 3f * (float)num299;
						int num302 = Dust.NewDust(base.position, width, height, 184);
						Main.dust[num302].position.X = base.Center.X - num300;
						Main.dust[num302].position.Y = base.Center.Y - num301;
						Dust dust2 = Main.dust[num302];
						dust2.velocity *= 0f;
						Main.dust[num302].scale = 0.5f;
					}
				}
				else
				{
					if (type == 316)
					{
						if (velocity.X > 0f)
						{
							spriteDirection = -1;
						}
						else if (velocity.X < 0f)
						{
							spriteDirection = 1;
						}
					}
					else if (velocity.X > 0f)
					{
						spriteDirection = 1;
					}
					else if (velocity.X < 0f)
					{
						spriteDirection = -1;
					}
					rotation = velocity.X * 0.1f;
					frameCounter++;
					if (frameCounter >= 3)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame >= 3)
					{
						frame = 0;
					}
				}
				float num303 = base.position.X;
				float num304 = base.position.Y;
				float num305 = 100000f;
				bool flag13 = false;
				this.ai[0] += 1f;
				if (this.ai[0] > 30f)
				{
					this.ai[0] = 30f;
					for (int num306 = 0; num306 < 200; num306++)
					{
						if (Main.npc[num306].CanBeChasedBy(this) && (!Main.npc[num306].wet || Main.npc[num306].type == 370 || type == 307))
						{
							float num307 = Main.npc[num306].position.X + (float)(Main.npc[num306].width / 2);
							float num308 = Main.npc[num306].position.Y + (float)(Main.npc[num306].height / 2);
							float num309 = Math.Abs(base.position.X + (float)(width / 2) - num307) + Math.Abs(base.position.Y + (float)(height / 2) - num308);
							if (num309 < 800f && num309 < num305 && Collision.CanHit(base.position, width, height, Main.npc[num306].position, Main.npc[num306].width, Main.npc[num306].height))
							{
								num305 = num309;
								num303 = num307;
								num304 = num308;
								flag13 = true;
							}
						}
					}
				}
				if (!flag13)
				{
					num303 = base.position.X + (float)(width / 2) + velocity.X * 100f;
					num304 = base.position.Y + (float)(height / 2) + velocity.Y * 100f;
				}
				else if (type == 307)
				{
					friendly = true;
				}
				float num310 = 6f;
				float num311 = 0.1f;
				if (type == 189)
				{
					num310 = 9f;
					num311 = 0.2f;
				}
				if (type == 307)
				{
					num310 = 13f;
					num311 = 0.35f;
				}
				if (type == 316)
				{
					if (flag13)
					{
						num310 = 13f;
						num311 = 0.325f;
					}
					else
					{
						num310 = 10f;
						num311 = 0.25f;
					}
				}
				if (type == 566)
				{
					num310 = 6.8f;
					num311 = 0.14f;
				}
				Vector2 vector26 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
				float num312 = num303 - vector26.X;
				float num313 = num304 - vector26.Y;
				float num314 = (float)Math.Sqrt(num312 * num312 + num313 * num313);
				float num315 = num314;
				num314 = num310 / num314;
				num312 *= num314;
				num313 *= num314;
				if (velocity.X < num312)
				{
					velocity.X += num311;
					if (velocity.X < 0f && num312 > 0f)
					{
						velocity.X += num311 * 2f;
					}
				}
				else if (velocity.X > num312)
				{
					velocity.X -= num311;
					if (velocity.X > 0f && num312 < 0f)
					{
						velocity.X -= num311 * 2f;
					}
				}
				if (velocity.Y < num313)
				{
					velocity.Y += num311;
					if (velocity.Y < 0f && num313 > 0f)
					{
						velocity.Y += num311 * 2f;
					}
				}
				else if (velocity.Y > num313)
				{
					velocity.Y -= num311;
					if (velocity.Y > 0f && num313 < 0f)
					{
						velocity.Y -= num311 * 2f;
					}
				}
			}
			else if (aiStyle == 37)
			{
				if (this.ai[1] == 0f)
				{
					this.ai[1] = 1f;
					localAI[0] = base.Center.X - velocity.X * 1.5f;
					localAI[1] = base.Center.Y - velocity.Y * 1.5f;
				}
				Vector2 vector27 = new Vector2(localAI[0], localAI[1]);
				rotation = (base.Center - vector27).ToRotation() - MathF.PI / 2f;
				if (this.ai[0] == 0f)
				{
					if (Collision.SolidCollision(base.position, width, height))
					{
						velocity *= -1f;
						this.ai[0] += 1f;
						return;
					}
					float num316 = Vector2.Distance(base.Center, vector27);
					if (num316 > 300f)
					{
						velocity *= -1f;
						this.ai[0] += 1f;
					}
				}
				else if (Collision.SolidCollision(base.position, width, height) || Vector2.Distance(base.Center, vector27) < velocity.Length())
				{
					Kill();
				}
			}
			else if (aiStyle == 38)
			{
				this.ai[0] += 1f;
				if (this.ai[0] >= 6f)
				{
					this.ai[0] = 0f;
					SoundEngine.PlaySound(SoundID.Item34, base.position);
					if (Main.myPlayer == owner)
					{
						NewProjectile(GetProjectileSource_FromThis(), base.position.X, base.position.Y, velocity.X, velocity.Y, 188, damage, knockBack, owner);
					}
				}
			}
			else if (aiStyle == 39)
			{
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (!active || !Main.player[owner].active || Main.player[owner].dead || Vector2.Distance(Main.player[owner].Center, base.Center) > 2000f)
				{
					Kill();
					return;
				}
				if (active && alpha == 0)
				{
					Main.player[owner].SetDummyItemTime(5);
					if (base.Center.X > Main.player[owner].Center.X)
					{
						Main.player[owner].ChangeDir(1);
					}
					else
					{
						Main.player[owner].ChangeDir(-1);
					}
				}
				Vector2 center = base.Center;
				float num317 = Main.player[owner].Center.X - center.X;
				float num318 = Main.player[owner].Center.Y - center.Y;
				float num319 = (float)Math.Sqrt(num317 * num317 + num318 * num318);
				if (!Main.player[owner].channel && active && alpha == 0)
				{
					this.ai[0] = 1f;
					this.ai[1] = -1f;
				}
				if (this.ai[1] > 0f && num319 > 1500f)
				{
					this.ai[1] = 0f;
					this.ai[0] = 1f;
				}
				if (this.ai[1] > 0f)
				{
					tileCollide = false;
					int num320 = (int)this.ai[1] - 1;
					if (Main.npc[num320].active && Main.npc[num320].life > 0)
					{
						float num321 = 16f;
						center = base.Center;
						num317 = Main.npc[num320].Center.X - center.X;
						num318 = Main.npc[num320].Center.Y - center.Y;
						num319 = (float)Math.Sqrt(num317 * num317 + num318 * num318);
						if (num319 < num321)
						{
							velocity.X = num317;
							velocity.Y = num318;
							if (num319 > num321 / 3f)
							{
								if (velocity.X < 0f)
								{
									spriteDirection = -1;
									rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
								}
								else
								{
									spriteDirection = 1;
									rotation = (float)Math.Atan2(velocity.Y, velocity.X);
								}
								if (type == 190)
								{
									velocity.X = 0f;
									velocity.Y = 0f;
								}
							}
						}
						else
						{
							if (num319 == 0f)
							{
								num319 = 0.0001f;
							}
							num319 = num321 / num319;
							num317 *= num319;
							num318 *= num319;
							velocity.X = num317;
							velocity.Y = num318;
							if (velocity.X < 0f)
							{
								spriteDirection = -1;
								rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
							}
							else
							{
								spriteDirection = 1;
								rotation = (float)Math.Atan2(velocity.Y, velocity.X);
							}
						}
						if (type == 190)
						{
							base.position += Main.npc[num320].velocity;
							for (int num322 = 0; num322 < 1000; num322++)
							{
								if (num322 != whoAmI && Main.projectile[num322].active && Main.projectile[num322].owner == owner && Main.projectile[num322].type == 190 && Vector2.Distance(base.Center, Main.projectile[num322].Center) < 8f)
								{
									if (base.position.X < Main.projectile[num322].position.X)
									{
										velocity.X -= 4f;
									}
									else
									{
										velocity.X += 4f;
									}
									if (base.position.Y < Main.projectile[num322].position.Y)
									{
										velocity.Y -= 4f;
									}
									else
									{
										velocity.Y += 4f;
									}
								}
							}
						}
						if (Main.myPlayer == owner)
						{
							float num323 = this.ai[0];
							this.ai[0] = 1f;
							if (num323 != this.ai[0])
							{
								netUpdate = true;
							}
						}
					}
					else if (Main.myPlayer == owner)
					{
						float num324 = this.ai[1];
						this.ai[1] = 0f;
						if (num324 != this.ai[1])
						{
							netUpdate = true;
						}
						float num325 = base.position.X;
						float num326 = base.position.Y;
						float num327 = 3000f;
						int num328 = -1;
						for (int num329 = 0; num329 < 200; num329++)
						{
							if (Main.npc[num329].CanBeChasedBy(this))
							{
								float x = Main.npc[num329].Center.X;
								float y = Main.npc[num329].Center.Y;
								float num330 = Math.Abs(base.Center.X - x) + Math.Abs(base.Center.Y - y);
								if (num330 < num327 && Collision.CanHit(base.position, width, height, Main.npc[num329].position, Main.npc[num329].width, Main.npc[num329].height))
								{
									num327 = num330;
									num325 = x;
									num326 = y;
									num328 = num329;
								}
							}
						}
						if (num328 >= 0)
						{
							float num331 = 16f;
							center = base.Center;
							num317 = num325 - center.X;
							num318 = num326 - center.Y;
							num319 = (float)Math.Sqrt(num317 * num317 + num318 * num318);
							if (num319 == 0f)
							{
								num319 = 0.0001f;
							}
							num319 = num331 / num319;
							num317 *= num319;
							num318 *= num319;
							velocity.X = num317;
							velocity.Y = num318;
							this.ai[0] = 0f;
							this.ai[1] = num328 + 1;
							netUpdate = true;
						}
					}
				}
				else if (this.ai[0] == 0f)
				{
					if (Main.myPlayer == owner && num319 > 700f)
					{
						this.ai[0] = 1f;
						netUpdate = true;
					}
					if (velocity.X < 0f)
					{
						spriteDirection = -1;
						rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
					}
					else
					{
						spriteDirection = 1;
						rotation = (float)Math.Atan2(velocity.Y, velocity.X);
					}
				}
				else if (this.ai[0] == 1f)
				{
					tileCollide = false;
					if (velocity.X < 0f)
					{
						spriteDirection = 1;
						rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
					}
					else
					{
						spriteDirection = -1;
						rotation = (float)Math.Atan2(velocity.Y, velocity.X);
					}
					if (velocity.X < 0f)
					{
						spriteDirection = -1;
						rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
					}
					else
					{
						spriteDirection = 1;
						rotation = (float)Math.Atan2(velocity.Y, velocity.X);
					}
					float num332 = 20f;
					if (Main.myPlayer == owner && num319 < 70f)
					{
						Kill();
					}
					num319 = num332 / num319;
					num317 *= num319;
					num318 *= num319;
					velocity.X = num317;
					velocity.Y = num318;
					if (type == 190)
					{
						base.position += Main.player[owner].velocity;
					}
				}
				frameCounter++;
				if (frameCounter >= 4)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame >= 4)
				{
					frame = 0;
				}
			}
			else if (aiStyle == 40)
			{
				localAI[0] += 1f;
				if (localAI[0] > 3f)
				{
					localAI[0] = 100f;
					alpha -= 50;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame >= 5)
				{
					frame = 0;
				}
				velocity.X += this.ai[0];
				velocity.Y += this.ai[1];
				localAI[1] += 1f;
				if (localAI[1] == 50f)
				{
					localAI[1] = 51f;
					this.ai[0] = (float)Main.rand.Next(-100, 101) * 6E-05f;
					this.ai[1] = (float)Main.rand.Next(-100, 101) * 6E-05f;
				}
				if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) > 16f)
				{
					velocity.X *= 0.95f;
					velocity.Y *= 0.95f;
				}
				if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 12f)
				{
					velocity.X *= 1.05f;
					velocity.Y *= 1.05f;
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 3.14f;
			}
			else if (aiStyle == 41)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					frame = Main.rand.Next(3);
				}
				rotation += velocity.X * 0.01f;
			}
			else if (aiStyle == 42)
			{
				if (!Main.player[owner].crystalLeaf)
				{
					Kill();
					return;
				}
				base.position.X = Main.player[owner].Center.X - (float)(width / 2);
				base.position.Y = Main.player[owner].Center.Y - (float)(height / 2) + Main.player[owner].gfxOffY - 60f;
				if (Main.player[owner].gravDir == -1f)
				{
					base.position.Y += 120f;
					rotation = 3.14f;
				}
				else
				{
					rotation = 0f;
				}
				base.position.X = (int)base.position.X;
				base.position.Y = (int)base.position.Y;
				float num333 = (float)(int)Main.mouseTextColor / 200f - 0.35f;
				num333 *= 0.2f;
				scale = num333 + 0.95f;
				if (owner != Main.myPlayer)
				{
					return;
				}
				if (this.ai[0] == 0f)
				{
					float x2 = base.position.X;
					float y2 = base.position.Y;
					float num334 = 700f;
					NPC nPC = null;
					for (int num335 = 0; num335 < 200; num335++)
					{
						if (Main.npc[num335].CanBeChasedBy(this))
						{
							float num336 = Main.npc[num335].position.X + (float)(Main.npc[num335].width / 2);
							float num337 = Main.npc[num335].position.Y + (float)(Main.npc[num335].height / 2);
							float num338 = Math.Abs(base.position.X + (float)(width / 2) - num336) + Math.Abs(base.position.Y + (float)(height / 2) - num337);
							if (num338 < num334 && Collision.CanHit(base.position, width, height, Main.npc[num335].position, Main.npc[num335].width, Main.npc[num335].height))
							{
								num334 = num338;
								nPC = Main.npc[num335];
							}
						}
					}
					if (nPC != null)
					{
						float num339 = 12f;
						Vector2 vector28 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
						float num340 = x2 - vector28.X;
						float num341 = y2 - vector28.Y;
						float num342 = (float)Math.Sqrt(num340 * num340 + num341 * num341);
						float num343 = num342;
						num342 = num339 / num342;
						num340 *= num342;
						num341 *= num342;
						int num344 = 180;
						Utils.ChaseResults chaseResults = Utils.GetChaseResults(base.Center, num339 * (float)num344, nPC.Center, nPC.velocity);
						if (chaseResults.InterceptionHappens && chaseResults.InterceptionTime <= 180f)
						{
							Vector2 vector29 = chaseResults.ChaserVelocity / num344;
							num340 = vector29.X;
							num341 = vector29.Y;
						}
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X - 4f, base.Center.Y, num340, num341, 227, Player.crystalLeafDamage, Player.crystalLeafKB, owner);
						this.ai[0] = 40f;
					}
				}
				else
				{
					this.ai[0] -= 1f;
				}
			}
			else if (aiStyle == 43)
			{
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 3.14f;
				if (soundDelay == 0 && type == 227)
				{
					soundDelay = -1;
					SoundEngine.PlaySound(6, (int)base.position.X, (int)base.position.Y);
					for (int num345 = 0; num345 < 8; num345++)
					{
						int num346 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 157);
						Main.dust[num346].noGravity = true;
						Dust dust2 = Main.dust[num346];
						dust2.velocity *= 3f;
						Main.dust[num346].scale = 1.5f;
						dust2 = Main.dust[num346];
						dust2.velocity += velocity * Main.rand.NextFloat();
					}
				}
				float num347 = 1f - (float)timeLeft / 180f;
				float num348 = ((num347 * -6f * 0.85f + 0.33f) % 1f + 1f) % 1f;
				Color value3 = Main.hslToRgb(num348, 1f, 0.5f);
				value3 = Color.Lerp(value3, Color.Red, Utils.Remap(num348, 0.33f, 0.7f, 0f, 1f));
				value3 = Color.Lerp(value3, Color.Lerp(Color.LimeGreen, Color.Gold, 0.3f), (float)(int)value3.R / 255f * 1f);
				if (frameCounter++ >= 1)
				{
					frameCounter = 0;
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.ChlorophyteLeafCrystalShot, new ParticleOrchestraSettings
					{
						PositionInWorld = base.Center,
						MovementVector = velocity,
						UniqueInfoPiece = (byte)(Main.rgbToHsl(value3).X * 255f)
					});
				}
				Lighting.AddLight(base.Center, new Vector3(0.05f, 0.2f, 0.1f) * 1.5f);
				if (Main.rand.Next(5) == 0)
				{
					Dust dust12 = Dust.NewDustDirect(new Vector2(base.position.X, base.position.Y), width, height, 63);
					dust12.noGravity = true;
					Dust dust2 = dust12;
					dust2.velocity *= 0.1f;
					dust12.scale = 1.5f;
					dust2 = dust12;
					dust2.velocity += velocity * Main.rand.NextFloat();
					dust12.color = value3;
					dust12.color.A /= 4;
					dust12.alpha = 100;
					dust12.noLight = true;
				}
			}
			else if (aiStyle == 44)
			{
				int num349 = 6;
				if (type == 228)
				{
					velocity *= 0.96f;
					alpha += 2;
					if (alpha > 200)
					{
						Kill();
					}
				}
				else if (type == 732)
				{
					num349 = 3;
					alpha += 20;
					if (alpha > 255)
					{
						Kill();
					}
					if (Main.rand.Next(5) == 0)
					{
						Dust dust13 = Dust.NewDustDirect(base.position, width, height, 226, 0f, 0f, 150, default(Color), 0.8f);
						dust13.noGravity = true;
						Dust dust2 = dust13;
						dust2.velocity *= 1.2f;
					}
					rotation = velocity.ToRotation();
					Lighting.AddLight(base.Center, 0.3f, 0.6f, 0.8f);
				}
				else if (type == 229)
				{
					if (this.ai[0] == 0f)
					{
						SoundEngine.PlaySound(SoundID.Item8, base.position);
					}
					this.ai[0] += 1f;
					if (this.ai[0] > 20f)
					{
						velocity.Y += 0.3f;
						velocity.X *= 0.98f;
					}
				}
				if (++frameCounter >= num349)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
			}
			else if (aiStyle == 45)
			{
				if (type == 237 || type == 243)
				{
					float num350 = this.ai[0];
					float num351 = this.ai[1];
					if (num350 != 0f && num351 != 0f)
					{
						bool flag14 = false;
						bool flag15 = false;
						if (velocity.X == 0f || (velocity.X < 0f && base.Center.X < num350) || (velocity.X > 0f && base.Center.X > num350))
						{
							velocity.X = 0f;
							flag14 = true;
						}
						if (velocity.Y == 0f || (velocity.Y < 0f && base.Center.Y < num351) || (velocity.Y > 0f && base.Center.Y > num351))
						{
							velocity.Y = 0f;
							flag15 = true;
						}
						if (owner == Main.myPlayer && flag14 && flag15)
						{
							Kill();
						}
					}
					rotation += velocity.X * 0.02f;
					frameCounter++;
					if (frameCounter > 4)
					{
						frameCounter = 0;
						frame++;
						if (frame > 3)
						{
							frame = 0;
						}
					}
				}
				else if (type == 238 || type == 244)
				{
					bool flag16 = true;
					int num352 = (int)base.Center.X;
					int num353 = (int)(base.position.Y + (float)height);
					if (Collision.SolidTiles(new Vector2(num352, num353), 2, 20))
					{
						flag16 = false;
					}
					frameCounter++;
					if (frameCounter > 8)
					{
						frameCounter = 0;
						frame++;
						if ((!flag16 && frame > 2) || frame > 5)
						{
							frame = 0;
						}
					}
					this.ai[1] += 1f;
					if (type == 244 && this.ai[1] >= 18000f)
					{
						alpha += 5;
						if (alpha > 255)
						{
							alpha = 255;
							Kill();
						}
					}
					else if (type == 238 && this.ai[1] >= 18000f)
					{
						alpha += 5;
						if (alpha > 255)
						{
							alpha = 255;
							Kill();
						}
					}
					else if (flag16)
					{
						this.ai[0] += 1f;
						if (type == 244)
						{
							if (this.ai[0] > 10f)
							{
								this.ai[0] = 0f;
								if (owner == Main.myPlayer)
								{
									num352 += Main.rand.Next(-14, 15);
									NewProjectile(GetProjectileSource_FromThis(), num352, num353, 0f, 5f, 245, damage, 0f, owner);
								}
							}
						}
						else if (this.ai[0] > 8f)
						{
							this.ai[0] = 0f;
							if (owner == Main.myPlayer)
							{
								num352 += Main.rand.Next(-14, 15);
								NewProjectile(GetProjectileSource_FromThis(), num352, num353, 0f, 5f, 239, damage, 0f, owner);
							}
						}
					}
					localAI[0] += 1f;
					if (!(localAI[0] >= 10f))
					{
						return;
					}
					localAI[0] = 0f;
					int num354 = 0;
					int num355 = 0;
					float num356 = 0f;
					int num357 = type;
					for (int num358 = 0; num358 < 1000; num358++)
					{
						if (Main.projectile[num358].active && Main.projectile[num358].owner == owner && Main.projectile[num358].type == num357 && Main.projectile[num358].ai[1] < 18000f)
						{
							num354++;
							if (Main.projectile[num358].ai[1] > num356)
							{
								num355 = num358;
								num356 = Main.projectile[num358].ai[1];
							}
						}
					}
					if (type == 244)
					{
						if (num354 > 1)
						{
							Main.projectile[num355].netUpdate = true;
							Main.projectile[num355].ai[1] = 18000f;
						}
					}
					else if (num354 > 2)
					{
						Main.projectile[num355].netUpdate = true;
						Main.projectile[num355].ai[1] = 18000f;
					}
				}
				else if (type == 239 || type == 245 || type == 264)
				{
					int num359 = (int)(base.Center.X / 16f);
					int num360 = (int)((base.position.Y + (float)height) / 16f);
					if (WorldGen.InWorld(num359, num360) && Main.tile[num359, num360] != null && Main.tile[num359, num360].liquid == byte.MaxValue && Main.tile[num359, num360].shimmer() && velocity.Y > 0f)
					{
						velocity.Y *= -1f;
						netUpdate = true;
					}
					if (type == 239)
					{
						alpha = 50;
					}
					else if (type == 245)
					{
						alpha = 100;
					}
					else if (type == 264)
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					}
				}
			}
			else if (aiStyle == 46)
			{
				int num361 = (int)(base.Center.X / 16f);
				int num362 = (int)(base.Center.Y / 16f);
				if (WorldGen.InWorld(num361, num362) && Main.tile[num361, num362] != null && Main.tile[num361, num362].liquid > 0 && Main.tile[num361, num362].shimmer())
				{
					Kill();
				}
				int num363 = 2400;
				if (type == 250)
				{
					Point point2 = base.Center.ToTileCoordinates();
					if (!WorldGen.InWorld(point2.X, point2.Y, 2) || Main.tile[point2.X, point2.Y] == null)
					{
						Kill();
						return;
					}
					if (owner == Main.myPlayer)
					{
						localAI[0] += 1f;
						if (localAI[0] > 4f)
						{
							localAI[0] = 3f;
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, velocity.X * 0.001f, velocity.Y * 0.001f, 251, damage, knockBack, owner);
						}
						if (timeLeft > num363)
						{
							timeLeft = num363;
						}
					}
					float num364 = 1f;
					if (velocity.Y < 0f)
					{
						num364 -= velocity.Y / 3f;
					}
					this.ai[0] += num364;
					if (this.ai[0] > 30f)
					{
						velocity.Y += 0.5f;
						if (velocity.Y > 0f)
						{
							velocity.X *= 0.95f;
						}
						else
						{
							velocity.X *= 1.05f;
						}
					}
					float x3 = velocity.X;
					float y3 = velocity.Y;
					float num365 = (float)Math.Sqrt(x3 * x3 + y3 * y3);
					num365 = 15.95f * scale / num365;
					x3 *= num365;
					y3 *= num365;
					velocity.X = x3;
					velocity.Y = y3;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
					return;
				}
				if (localAI[0] == 0f)
				{
					if (velocity.X > 0f)
					{
						spriteDirection = -1;
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
					}
					else
					{
						spriteDirection = 1;
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
					}
					localAI[0] = 1f;
					timeLeft = num363;
				}
				velocity.X *= 0.98f;
				velocity.Y *= 0.98f;
				if (rotation == 0f)
				{
					alpha = 255;
				}
				else if (timeLeft < 10)
				{
					alpha = 255 - (int)(255f * (float)timeLeft / 10f);
				}
				else if (timeLeft > num363 - 10)
				{
					int num366 = num363 - timeLeft;
					alpha = 255 - (int)(255f * (float)num366 / 10f);
				}
				else
				{
					alpha = 0;
				}
			}
			else if (aiStyle == 47)
			{
				AI_047_MagnetSphere();
			}
			else if (aiStyle == 48)
			{
				if (type == 255)
				{
					for (int num367 = 0; num367 < 4; num367++)
					{
						Vector2 vector30 = base.position;
						vector30 -= velocity * ((float)num367 * 0.25f);
						alpha = 255;
						int num368 = Dust.NewDust(vector30, 1, 1, 160);
						Main.dust[num368].position = vector30;
						Main.dust[num368].position.X += width / 2;
						Main.dust[num368].position.Y += height / 2;
						Main.dust[num368].scale = (float)Main.rand.Next(70, 110) * 0.013f;
						Dust dust2 = Main.dust[num368];
						dust2.velocity *= 0.2f;
					}
					return;
				}
				if (type == 433)
				{
					for (int num369 = 0; num369 < 2; num369++)
					{
						Vector2 vector31 = base.position;
						vector31 -= velocity * ((float)num369 * 0.25f);
						alpha = 255;
						int num370 = Dust.NewDust(vector31, 1, 1, 160);
						Main.dust[num370].position = vector31;
						Main.dust[num370].position.X += width / 2;
						Main.dust[num370].position.Y += height / 2;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num370].color = Color.LimeGreen;
						}
						else
						{
							Main.dust[num370].color = Color.CornflowerBlue;
						}
						Main.dust[num370].scale = (float)Main.rand.Next(70, 110) * 0.013f;
						Dust dust2 = Main.dust[num370];
						dust2.velocity *= 0.2f;
					}
					return;
				}
				if (type == 290)
				{
					if (localAI[0] == 0f)
					{
						SoundEngine.PlaySound(SoundID.Item8, base.position);
					}
					localAI[0] += 1f;
					if (localAI[0] > 3f)
					{
						for (int num371 = 0; num371 < 3; num371++)
						{
							Vector2 vector32 = base.position;
							vector32 -= velocity * ((float)num371 * 0.3334f);
							alpha = 255;
							int num372 = Dust.NewDust(vector32, 1, 1, 173);
							Main.dust[num372].position = vector32;
							Main.dust[num372].scale = (float)Main.rand.Next(70, 110) * 0.013f;
							Dust dust2 = Main.dust[num372];
							dust2.velocity *= 0.2f;
						}
					}
					return;
				}
				if (type == 294)
				{
					localAI[0] += 1f;
					if (localAI[0] > 9f)
					{
						for (int num373 = 0; num373 < 4; num373++)
						{
							Vector2 vector33 = base.position;
							vector33 -= velocity * ((float)num373 * 0.25f);
							alpha = 255;
							int num374 = Dust.NewDust(vector33, 1, 1, 173);
							Main.dust[num374].position = vector33;
							Main.dust[num374].scale = (float)Main.rand.Next(70, 110) * 0.013f;
							Dust dust2 = Main.dust[num374];
							dust2.velocity *= 0.2f;
						}
					}
					return;
				}
				localAI[0] += 1f;
				if (localAI[0] > 3f)
				{
					for (int num375 = 0; num375 < 4; num375++)
					{
						Vector2 vector34 = base.position;
						vector34 -= velocity * ((float)num375 * 0.25f);
						alpha = 255;
						int num376 = Dust.NewDust(vector34, 1, 1, 162);
						Main.dust[num376].position = vector34;
						Main.dust[num376].position.X += width / 2;
						Main.dust[num376].position.Y += height / 2;
						Main.dust[num376].scale = (float)Main.rand.Next(70, 110) * 0.013f;
						Dust dust2 = Main.dust[num376];
						dust2.velocity *= 0.2f;
					}
				}
			}
			else if (aiStyle == 49)
			{
				if (this.ai[0] == -2f)
				{
					hostile = true;
					Kill();
					return;
				}
				if (this.ai[0] == -3f)
				{
					Kill();
					return;
				}
				if (soundDelay == 0)
				{
					soundDelay = 3000;
					SoundEngine.PlaySound(SoundID.Item14, base.position);
				}
				if (this.ai[0] >= 0f)
				{
					if (velocity.X > 0f)
					{
						direction = 1;
					}
					else if (velocity.X < 0f)
					{
						direction = -1;
					}
					spriteDirection = direction;
					this.ai[0] += 1f;
					rotation += velocity.X * 0.05f + (float)direction * 0.05f;
					if (this.ai[0] >= 18f)
					{
						velocity.Y += 0.28f;
						velocity.X *= 0.99f;
					}
					if ((double)velocity.Y > 15.9)
					{
						velocity.Y = 15.9f;
					}
					if (!(this.ai[0] > 2f))
					{
						return;
					}
					alpha = 0;
					if (this.ai[0] == 3f)
					{
						for (int num377 = 0; num377 < 10; num377++)
						{
							int num378 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num378];
							dust2.velocity *= 0.5f;
							dust2 = Main.dust[num378];
							dust2.velocity += velocity * 0.1f;
						}
						for (int num379 = 0; num379 < 5; num379++)
						{
							int num380 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
							Main.dust[num380].noGravity = true;
							Dust dust2 = Main.dust[num380];
							dust2.velocity *= 3f;
							dust2 = Main.dust[num380];
							dust2.velocity += velocity * 0.2f;
							num380 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100);
							dust2 = Main.dust[num380];
							dust2.velocity *= 2f;
							dust2 = Main.dust[num380];
							dust2.velocity += velocity * 0.3f;
						}
						for (int num381 = 0; num381 < 1; num381++)
						{
							int num382 = Gore.NewGore(new Vector2(base.position.X - 10f, base.position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
							Gore gore = Main.gore[num382];
							gore.position += velocity * 1.25f;
							Main.gore[num382].scale = 1.5f;
							gore = Main.gore[num382];
							gore.velocity += velocity * 0.5f;
							gore = Main.gore[num382];
							gore.velocity *= 0.02f;
						}
					}
				}
				else if (this.ai[0] == -1f)
				{
					rotation = 0f;
					velocity.X *= 0.95f;
					velocity.Y += 0.2f;
				}
			}
			else if (aiStyle == 50)
			{
				if (type == 291)
				{
					if (localAI[0] == 0f)
					{
						SoundEngine.PlaySound(SoundID.Item20, base.position);
						localAI[0] += 1f;
					}
					bool flag17 = false;
					bool flag18 = false;
					if (velocity.X < 0f && base.position.X < this.ai[0])
					{
						flag17 = true;
					}
					if (velocity.X > 0f && base.position.X > this.ai[0])
					{
						flag17 = true;
					}
					if (velocity.Y < 0f && base.position.Y < this.ai[1])
					{
						flag18 = true;
					}
					if (velocity.Y > 0f && base.position.Y > this.ai[1])
					{
						flag18 = true;
					}
					if (flag17 && flag18)
					{
						Kill();
					}
					for (int num383 = 0; num383 < 10; num383++)
					{
						int num384 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 174, 0f, 0f, 100, default(Color), 1.2f);
						Main.dust[num384].noGravity = true;
						Dust dust2 = Main.dust[num384];
						dust2.velocity *= 0.5f;
						dust2 = Main.dust[num384];
						dust2.velocity += velocity * 0.1f;
					}
					return;
				}
				if (type == 295)
				{
					for (int num385 = 0; num385 < 8; num385++)
					{
						int num386 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 174, 0f, 0f, 100, default(Color), 1.2f);
						Main.dust[num386].noGravity = true;
						Dust dust2 = Main.dust[num386];
						dust2.velocity *= 0.5f;
						dust2 = Main.dust[num386];
						dust2.velocity += velocity * 0.1f;
					}
					return;
				}
				if (localAI[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item74, base.position);
					localAI[0] += 1f;
				}
				this.ai[0] += 1f;
				if (type == 296)
				{
					this.ai[0] += 3f;
				}
				float num387 = 25f;
				if (this.ai[0] > 540f)
				{
					num387 -= (this.ai[0] - 180f) / 2f;
				}
				if (num387 <= 0f)
				{
					num387 = 0f;
					Kill();
				}
				if (type == 296)
				{
					num387 *= 0.7f;
				}
				for (int num388 = 0; (float)num388 < num387; num388++)
				{
					float num389 = Main.rand.Next(-10, 11);
					float num390 = Main.rand.Next(-10, 11);
					float num391 = Main.rand.Next(3, 9);
					float num392 = (float)Math.Sqrt(num389 * num389 + num390 * num390);
					num392 = num391 / num392;
					num389 *= num392;
					num390 *= num392;
					int num393 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 174, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num393].noGravity = true;
					Main.dust[num393].position.X = base.Center.X;
					Main.dust[num393].position.Y = base.Center.Y;
					Main.dust[num393].position.X += Main.rand.Next(-10, 11);
					Main.dust[num393].position.Y += Main.rand.Next(-10, 11);
					Main.dust[num393].velocity.X = num389;
					Main.dust[num393].velocity.Y = num390;
				}
			}
			else if (aiStyle == 51)
			{
				if (type == 297)
				{
					localAI[0] += 1f;
					if (localAI[0] > 4f)
					{
						for (int num394 = 0; num394 < 5; num394++)
						{
							int num395 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 175, 0f, 0f, 100, default(Color), 2f);
							Main.dust[num395].noGravity = true;
							Dust dust2 = Main.dust[num395];
							dust2.velocity *= 0f;
						}
					}
				}
				else
				{
					if (localAI[0] == 0f)
					{
						SoundEngine.PlaySound(SoundID.Item8, base.position);
						localAI[0] += 1f;
					}
					for (int num396 = 0; num396 < 9; num396++)
					{
						int num397 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 175, 0f, 0f, 100, default(Color), 1.3f);
						Main.dust[num397].noGravity = true;
						Dust dust2 = Main.dust[num397];
						dust2.velocity *= 0f;
					}
				}
				float num398 = base.Center.X;
				float num399 = base.Center.Y;
				float num400 = 400f;
				bool flag19 = false;
				int num401 = 0;
				if (type == 297)
				{
					for (int num402 = 0; num402 < 200; num402++)
					{
						if (Main.npc[num402].CanBeChasedBy(this) && Distance(Main.npc[num402].Center) < num400 && Collision.CanHit(base.Center, 1, 1, Main.npc[num402].Center, 1, 1))
						{
							float num403 = Main.npc[num402].position.X + (float)(Main.npc[num402].width / 2);
							float num404 = Main.npc[num402].position.Y + (float)(Main.npc[num402].height / 2);
							float num405 = Math.Abs(base.position.X + (float)(width / 2) - num403) + Math.Abs(base.position.Y + (float)(height / 2) - num404);
							if (num405 < num400)
							{
								num400 = num405;
								num398 = num403;
								num399 = num404;
								flag19 = true;
								num401 = num402;
							}
						}
					}
				}
				else
				{
					num400 = 200f;
					for (int num406 = 0; num406 < 255; num406++)
					{
						if (Main.player[num406].active && !Main.player[num406].dead)
						{
							float num407 = Main.player[num406].position.X + (float)(Main.player[num406].width / 2);
							float num408 = Main.player[num406].position.Y + (float)(Main.player[num406].height / 2);
							float num409 = Math.Abs(base.position.X + (float)(width / 2) - num407) + Math.Abs(base.position.Y + (float)(height / 2) - num408);
							if (num409 < num400)
							{
								num400 = num409;
								num398 = num407;
								num399 = num408;
								flag19 = true;
								num401 = num406;
							}
						}
					}
				}
				if (flag19)
				{
					float num410 = 3f;
					if (type == 297)
					{
						num410 = 6f;
					}
					Vector2 vector35 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
					float num411 = num398 - vector35.X;
					float num412 = num399 - vector35.Y;
					float num413 = (float)Math.Sqrt(num411 * num411 + num412 * num412);
					float num414 = num413;
					num413 = num410 / num413;
					num411 *= num413;
					num412 *= num413;
					if (type == 297)
					{
						velocity.X = (velocity.X * 20f + num411) / 21f;
						velocity.Y = (velocity.Y * 20f + num412) / 21f;
					}
					else
					{
						velocity.X = (velocity.X * 100f + num411) / 101f;
						velocity.Y = (velocity.Y * 100f + num412) / 101f;
					}
				}
			}
			else if (aiStyle == 52)
			{
				int num415 = (int)this.ai[0];
				float num416 = 4f;
				Vector2 vector36 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
				float num417 = Main.player[num415].Center.X - vector36.X;
				float num418 = Main.player[num415].Center.Y - vector36.Y;
				float num419 = (float)Math.Sqrt(num417 * num417 + num418 * num418);
				float num420 = num419;
				if (num419 < 50f && base.position.X < Main.player[num415].position.X + (float)Main.player[num415].width && base.position.X + (float)width > Main.player[num415].position.X && base.position.Y < Main.player[num415].position.Y + (float)Main.player[num415].height && base.position.Y + (float)height > Main.player[num415].position.Y)
				{
					if (owner == Main.myPlayer && !Main.player[Main.myPlayer].moonLeech)
					{
						int num421 = (int)this.ai[1];
						Main.player[num415].HealEffect(num421, broadcast: false);
						Player player3 = Main.player[num415];
						player3.statLife += num421;
						if (Main.player[num415].statLife > Main.player[num415].statLifeMax2)
						{
							Main.player[num415].statLife = Main.player[num415].statLifeMax2;
						}
						NetMessage.SendData(66, -1, -1, null, num415, num421);
					}
					Kill();
				}
				num419 = num416 / num419;
				num417 *= num419;
				num418 *= num419;
				velocity.X = (velocity.X * 15f + num417) / 16f;
				velocity.Y = (velocity.Y * 15f + num418) / 16f;
				if (type == 305)
				{
					for (int num422 = 0; num422 < 3; num422++)
					{
						float num423 = velocity.X * 0.334f * (float)num422;
						float num424 = (0f - velocity.Y * 0.334f) * (float)num422;
						int num425 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 183, 0f, 0f, 100, default(Color), 1.1f);
						Main.dust[num425].noGravity = true;
						Dust dust2 = Main.dust[num425];
						dust2.velocity *= 0f;
						Main.dust[num425].position.X -= num423;
						Main.dust[num425].position.Y -= num424;
					}
				}
				else
				{
					for (int num426 = 0; num426 < 5; num426++)
					{
						float num427 = velocity.X * 0.2f * (float)num426;
						float num428 = (0f - velocity.Y * 0.2f) * (float)num426;
						int num429 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 175, 0f, 0f, 100, default(Color), 1.3f);
						Main.dust[num429].noGravity = true;
						Dust dust2 = Main.dust[num429];
						dust2.velocity *= 0f;
						Main.dust[num429].position.X -= num427;
						Main.dust[num429].position.Y -= num428;
					}
				}
			}
			else if (aiStyle == 53)
			{
				if (localAI[0] == 0f)
				{
					localAI[1] = 1f;
					localAI[0] = 1f;
					this.ai[0] = 120f;
					int num430 = 80;
					SoundEngine.PlaySound(SoundID.Item46, base.position);
					if (type == 308)
					{
						for (int num431 = 0; num431 < num430; num431++)
						{
							int num432 = Dust.NewDust(new Vector2(base.position.X, base.position.Y + 16f), width, height - 16, 185);
							Dust dust2 = Main.dust[num432];
							dust2.velocity *= 2f;
							Main.dust[num432].noGravity = true;
							dust2 = Main.dust[num432];
							dust2.scale *= 1.15f;
						}
					}
					if (type == 377)
					{
						frame = 4;
						num430 = 40;
						for (int num433 = 0; num433 < num430; num433++)
						{
							int num434 = Dust.NewDust(base.position + Vector2.UnitY * 16f, width, height - 16, 171, 0f, 0f, 100);
							Main.dust[num434].scale = (float)Main.rand.Next(1, 10) * 0.1f;
							Main.dust[num434].noGravity = true;
							Main.dust[num434].fadeIn = 1.5f;
							Dust dust2 = Main.dust[num434];
							dust2.velocity *= 0.75f;
						}
					}
					if (type == 966)
					{
						this.ai[1] = -1f;
						frame = 0;
						num430 = 30;
						int num435 = 25;
						int num436 = 30;
						for (int num437 = 0; num437 < num430; num437++)
						{
							int num438 = Dust.NewDust(base.Center - new Vector2(num435, num436), num435 * 2, num436 * 2, 219);
							Dust dust2 = Main.dust[num438];
							dust2.velocity *= 2f;
							Main.dust[num438].noGravity = true;
							dust2 = Main.dust[num438];
							dust2.scale *= 0.5f;
						}
					}
				}
				velocity.X = 0f;
				velocity.Y += 0.2f;
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				bool flag20 = false;
				float num439 = base.Center.X;
				float num440 = base.Center.Y;
				float num441 = 1000f;
				int num442 = -1;
				NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
				if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
				{
					float num443 = ownerMinionAttackTargetNPC.position.X + (float)(ownerMinionAttackTargetNPC.width / 2);
					float num444 = ownerMinionAttackTargetNPC.position.Y + (float)(ownerMinionAttackTargetNPC.height / 2);
					float num445 = Math.Abs(base.position.X + (float)(width / 2) - num443) + Math.Abs(base.position.Y + (float)(height / 2) - num444);
					if (num445 < num441 && Collision.CanHit(base.position, width, height, ownerMinionAttackTargetNPC.position, ownerMinionAttackTargetNPC.width, ownerMinionAttackTargetNPC.height))
					{
						num441 = num445;
						num439 = num443;
						num440 = num444;
						flag20 = true;
						num442 = ownerMinionAttackTargetNPC.whoAmI;
					}
				}
				if (!flag20)
				{
					for (int num446 = 0; num446 < 200; num446++)
					{
						if (Main.npc[num446].CanBeChasedBy(this))
						{
							float num447 = Main.npc[num446].position.X + (float)(Main.npc[num446].width / 2);
							float num448 = Main.npc[num446].position.Y + (float)(Main.npc[num446].height / 2);
							float num449 = Math.Abs(base.position.X + (float)(width / 2) - num447) + Math.Abs(base.position.Y + (float)(height / 2) - num448);
							if (num449 < num441 && Collision.CanHit(base.position, width, height, Main.npc[num446].position, Main.npc[num446].width, Main.npc[num446].height))
							{
								num441 = num449;
								num439 = num447;
								num440 = num448;
								flag20 = true;
								num442 = Main.npc[num446].whoAmI;
							}
						}
					}
				}
				if (flag20)
				{
					if (type == 966 && this.ai[1] != (float)num442)
					{
						this.ai[1] = num442;
						netUpdate = true;
					}
					float num450 = num439;
					float num451 = num440;
					num439 -= base.Center.X;
					num440 -= base.Center.Y;
					int num452 = 0;
					if (type != 966)
					{
						if (frameCounter > 0)
						{
							frameCounter--;
						}
						if (frameCounter <= 0)
						{
							int num453 = spriteDirection;
							if (num439 < 0f)
							{
								spriteDirection = -1;
							}
							else
							{
								spriteDirection = 1;
							}
							num452 = ((!(num440 > 0f)) ? ((Math.Abs(num440) > Math.Abs(num439) * 3f) ? 4 : ((Math.Abs(num440) > Math.Abs(num439) * 2f) ? 3 : ((!(Math.Abs(num439) > Math.Abs(num440) * 3f)) ? ((Math.Abs(num439) > Math.Abs(num440) * 2f) ? 1 : 2) : 0))) : 0);
							int num454 = frame;
							if (type == 308)
							{
								frame = num452 * 2;
							}
							else if (type == 377)
							{
								frame = num452;
							}
							if (this.ai[0] > 40f && localAI[1] == 0f && type == 308)
							{
								frame++;
							}
							if (num454 != frame || num453 != spriteDirection)
							{
								frameCounter = 8;
								if (this.ai[0] <= 0f)
								{
									frameCounter = 4;
								}
							}
						}
					}
					if (this.ai[0] <= 0f)
					{
						float num455 = 60f;
						if (type == 966)
						{
							num455 = 90f;
						}
						localAI[1] = 0f;
						this.ai[0] = num455;
						netUpdate = true;
						if (Main.myPlayer == owner)
						{
							float num456 = 6f;
							int num457 = 309;
							if (type == 308)
							{
								num457 = 309;
								num456 = 9f;
							}
							if (type == 377)
							{
								num457 = 378;
								num456 = 9f;
							}
							if (type == 966)
							{
								num457 = 967;
								num456 = 12.5f;
							}
							Vector2 vector37 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
							if (type == 966)
							{
								vector37.Y -= 16f;
							}
							else
							{
								switch (num452)
								{
								case 0:
									vector37.Y += 12f;
									vector37.X += 24 * spriteDirection;
									break;
								case 1:
									vector37.Y += 0f;
									vector37.X += 24 * spriteDirection;
									break;
								case 2:
									vector37.Y -= 2f;
									vector37.X += 24 * spriteDirection;
									break;
								case 3:
									vector37.Y -= 6f;
									vector37.X += 14 * spriteDirection;
									break;
								case 4:
									vector37.Y -= 14f;
									vector37.X += 2 * spriteDirection;
									break;
								}
							}
							if (type != 966 && spriteDirection < 0)
							{
								vector37.X += 10f;
							}
							float num458 = num450 - vector37.X;
							float num459 = num451 - vector37.Y;
							float num460 = (float)Math.Sqrt(num458 * num458 + num459 * num459);
							float num461 = num460;
							num460 = num456 / num460;
							num458 *= num460;
							num459 *= num460;
							int num462 = damage;
							int num463 = NewProjectile(GetProjectileSource_FromThis(), vector37.X, vector37.Y, num458, num459, num457, num462, knockBack, Main.myPlayer);
						}
					}
				}
				else
				{
					if (type == 966 && this.ai[1] != -1f)
					{
						this.ai[1] = -1f;
						netUpdate = true;
					}
					if (type != 966 && this.ai[0] <= 60f && (frame == 1 || frame == 3 || frame == 5 || frame == 7 || frame == 9))
					{
						frame--;
					}
				}
				if (this.ai[0] > 0f)
				{
					this.ai[0] -= 1f;
				}
			}
			else if (aiStyle == 54)
			{
				if (type == 317)
				{
					if (Main.player[Main.myPlayer].dead)
					{
						Main.player[Main.myPlayer].raven = false;
					}
					if (Main.player[Main.myPlayer].raven)
					{
						timeLeft = 2;
					}
				}
				for (int num464 = 0; num464 < 1000; num464++)
				{
					if (num464 != whoAmI && Main.projectile[num464].active && Main.projectile[num464].owner == owner && Main.projectile[num464].type == type && Math.Abs(base.position.X - Main.projectile[num464].position.X) + Math.Abs(base.position.Y - Main.projectile[num464].position.Y) < (float)width)
					{
						if (base.position.X < Main.projectile[num464].position.X)
						{
							velocity.X -= 0.05f;
						}
						else
						{
							velocity.X += 0.05f;
						}
						if (base.position.Y < Main.projectile[num464].position.Y)
						{
							velocity.Y -= 0.05f;
						}
						else
						{
							velocity.Y += 0.05f;
						}
					}
				}
				float num465 = base.position.X;
				float num466 = base.position.Y;
				float num467 = 900f;
				bool flag21 = false;
				int num468 = 500;
				if (this.ai[1] != 0f || friendly)
				{
					num468 = 1400;
				}
				if (Math.Abs(base.Center.X - Main.player[owner].Center.X) + Math.Abs(base.Center.Y - Main.player[owner].Center.Y) > (float)num468)
				{
					this.ai[0] = 1f;
				}
				if (this.ai[0] == 0f)
				{
					tileCollide = true;
					NPC ownerMinionAttackTargetNPC2 = OwnerMinionAttackTargetNPC;
					if (ownerMinionAttackTargetNPC2 != null && ownerMinionAttackTargetNPC2.CanBeChasedBy(this))
					{
						float num469 = ownerMinionAttackTargetNPC2.position.X + (float)(ownerMinionAttackTargetNPC2.width / 2);
						float num470 = ownerMinionAttackTargetNPC2.position.Y + (float)(ownerMinionAttackTargetNPC2.height / 2);
						float num471 = Math.Abs(base.position.X + (float)(width / 2) - num469) + Math.Abs(base.position.Y + (float)(height / 2) - num470);
						if (num471 < num467 && Collision.CanHit(base.position, width, height, ownerMinionAttackTargetNPC2.position, ownerMinionAttackTargetNPC2.width, ownerMinionAttackTargetNPC2.height))
						{
							num467 = num471;
							num465 = num469;
							num466 = num470;
							flag21 = true;
						}
					}
					if (!flag21)
					{
						for (int num472 = 0; num472 < 200; num472++)
						{
							if (Main.npc[num472].CanBeChasedBy(this))
							{
								float num473 = Main.npc[num472].position.X + (float)(Main.npc[num472].width / 2);
								float num474 = Main.npc[num472].position.Y + (float)(Main.npc[num472].height / 2);
								float num475 = Math.Abs(base.position.X + (float)(width / 2) - num473) + Math.Abs(base.position.Y + (float)(height / 2) - num474);
								if (num475 < num467 && Collision.CanHit(base.position, width, height, Main.npc[num472].position, Main.npc[num472].width, Main.npc[num472].height))
								{
									num467 = num475;
									num465 = num473;
									num466 = num474;
									flag21 = true;
								}
							}
						}
					}
				}
				else
				{
					tileCollide = false;
				}
				if (!flag21)
				{
					friendly = true;
					float num476 = 8f;
					if (this.ai[0] == 1f)
					{
						num476 = 12f;
					}
					Vector2 vector38 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
					float num477 = Main.player[owner].Center.X - vector38.X;
					float num478 = Main.player[owner].Center.Y - vector38.Y - 60f;
					float num479 = (float)Math.Sqrt(num477 * num477 + num478 * num478);
					float num480 = num479;
					if (num479 < 100f && this.ai[0] == 1f && !Collision.SolidCollision(base.position, width, height))
					{
						this.ai[0] = 0f;
					}
					if (num479 > 2000f)
					{
						base.position.X = Main.player[owner].Center.X - (float)(width / 2);
						base.position.Y = Main.player[owner].Center.Y - (float)(width / 2);
					}
					if (type == 317 && num479 > 100f)
					{
						num476 = 12f;
						if (this.ai[0] == 1f)
						{
							num476 = 15f;
						}
					}
					if (num479 > 70f)
					{
						num479 = num476 / num479;
						num477 *= num479;
						num478 *= num479;
						velocity.X = (velocity.X * 20f + num477) / 21f;
						velocity.Y = (velocity.Y * 20f + num478) / 21f;
					}
					else
					{
						if (velocity.X == 0f && velocity.Y == 0f)
						{
							velocity.X = -0.15f;
							velocity.Y = -0.05f;
						}
						velocity *= 1.01f;
					}
					friendly = false;
					rotation = velocity.X * 0.05f;
					frameCounter++;
					if (frameCounter >= 4)
					{
						frameCounter = 0;
						frame++;
					}
					if (frame > 3)
					{
						frame = 0;
					}
					if ((double)Math.Abs(velocity.X) > 0.2)
					{
						spriteDirection = -direction;
					}
					return;
				}
				if (this.ai[1] == -1f)
				{
					this.ai[1] = 17f;
				}
				if (this.ai[1] > 0f)
				{
					this.ai[1] -= 1f;
				}
				if (this.ai[1] == 0f)
				{
					friendly = true;
					float num481 = 16f;
					Vector2 vector39 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
					float num482 = num465 - vector39.X;
					float num483 = num466 - vector39.Y;
					float num484 = (float)Math.Sqrt(num482 * num482 + num483 * num483);
					float num485 = num484;
					if (num484 < 100f)
					{
						num481 = 10f;
					}
					num484 = num481 / num484;
					num482 *= num484;
					num483 *= num484;
					velocity.X = (velocity.X * 14f + num482) / 15f;
					velocity.Y = (velocity.Y * 14f + num483) / 15f;
				}
				else
				{
					friendly = false;
					if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 10f)
					{
						velocity *= 1.05f;
					}
				}
				rotation = velocity.X * 0.05f;
				frameCounter++;
				if (frameCounter >= 4)
				{
					frameCounter = 0;
					frame++;
				}
				if (frame < 4)
				{
					frame = 4;
				}
				if (frame > 7)
				{
					frame = 4;
				}
				if ((double)Math.Abs(velocity.X) > 0.2)
				{
					spriteDirection = -direction;
				}
			}
			else if (aiStyle == 55)
			{
				frameCounter++;
				if (frameCounter > 0)
				{
					frame++;
					frameCounter = 0;
					if (frame > 2)
					{
						frame = 0;
					}
				}
				if (velocity.X < 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
				}
				else
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				}
				if (this.ai[0] >= 0f && this.ai[0] < 200f)
				{
					int num486 = (int)this.ai[0];
					if (Main.npc[num486].active)
					{
						float num487 = 8f;
						Vector2 vector40 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
						float num488 = Main.npc[num486].position.X - vector40.X;
						float num489 = Main.npc[num486].position.Y - vector40.Y;
						float num490 = (float)Math.Sqrt(num488 * num488 + num489 * num489);
						float num491 = num490;
						num490 = num487 / num490;
						num488 *= num490;
						num489 *= num490;
						velocity.X = (velocity.X * 14f + num488) / 15f;
						velocity.Y = (velocity.Y * 14f + num489) / 15f;
					}
					else
					{
						float num492 = 1000f;
						for (int num493 = 0; num493 < 200; num493++)
						{
							if (Main.npc[num493].CanBeChasedBy(this))
							{
								float num494 = Main.npc[num493].position.X + (float)(Main.npc[num493].width / 2);
								float num495 = Main.npc[num493].position.Y + (float)(Main.npc[num493].height / 2);
								float num496 = Math.Abs(base.position.X + (float)(width / 2) - num494) + Math.Abs(base.position.Y + (float)(height / 2) - num495);
								if (num496 < num492 && Collision.CanHit(base.position, width, height, Main.npc[num493].position, Main.npc[num493].width, Main.npc[num493].height))
								{
									num492 = num496;
									this.ai[0] = num493;
								}
							}
						}
					}
					int num497 = 8;
					int num498 = Dust.NewDust(new Vector2(base.position.X + (float)num497, base.position.Y + (float)num497), width - num497 * 2, height - num497 * 2, 6);
					Dust dust2 = Main.dust[num498];
					dust2.velocity *= 0.5f;
					dust2 = Main.dust[num498];
					dust2.velocity += velocity * 0.5f;
					Main.dust[num498].noGravity = true;
					Main.dust[num498].noLight = true;
					Main.dust[num498].scale = 1.4f;
				}
				else
				{
					Kill();
				}
			}
			else if (aiStyle == 56)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					rotation = this.ai[0];
					spriteDirection = -(int)this.ai[1];
				}
				if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 16f)
				{
					velocity *= 1.05f;
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.025f * (float)direction;
			}
			else if (aiStyle == 57)
			{
				this.ai[0] += 1f;
				if (this.ai[0] > 30f)
				{
					this.ai[0] = 30f;
					velocity.Y += 0.25f;
					if (velocity.Y > 16f)
					{
						velocity.Y = 16f;
					}
					velocity.X *= 0.995f;
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (owner == Main.myPlayer)
				{
					if (localAI[1] == 0f)
					{
						localAI[1] = Main.rand.Next(7);
					}
					localAI[0]++;
					int num499 = 8;
					if (localAI[1] > 0f)
					{
						num499 += (int)localAI[1];
					}
					if (localAI[0] >= (float)num499)
					{
						localAI[0] = 0f;
						localAI[1] = -1f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 344, (int)((float)damage * 0.7f), knockBack * 0.55f, owner, 0f, Main.rand.Next(3));
					}
				}
			}
			else if (aiStyle == 58)
			{
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (this.ai[0] == 0f)
				{
					frame = 0;
					this.ai[1] += 1f;
					if (this.ai[1] > 30f)
					{
						velocity.Y += 0.1f;
					}
					if (velocity.Y >= 0f)
					{
						this.ai[0] = 1f;
					}
				}
				if (this.ai[0] == 1f)
				{
					frame = 1;
					velocity.Y += 0.1f;
					if (velocity.Y > 3f)
					{
						velocity.Y = 3f;
					}
					velocity.X *= 0.99f;
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
			}
			else if (aiStyle == 59)
			{
				this.ai[1] += 1f;
				if (this.ai[1] >= 60f)
				{
					friendly = true;
					int num500 = (int)this.ai[0];
					if (Main.myPlayer == owner && (num500 == -1 || !Main.npc[num500].CanBeChasedBy(this)))
					{
						num500 = -1;
						int[] array = new int[200];
						int num501 = 0;
						for (int num502 = 0; num502 < 200; num502++)
						{
							if (Main.npc[num502].CanBeChasedBy(this))
							{
								float num503 = Math.Abs(Main.npc[num502].position.X + (float)(Main.npc[num502].width / 2) - base.position.X + (float)(width / 2)) + Math.Abs(Main.npc[num502].position.Y + (float)(Main.npc[num502].height / 2) - base.position.Y + (float)(height / 2));
								if (num503 < 800f)
								{
									array[num501] = num502;
									num501++;
								}
							}
						}
						if (num501 == 0)
						{
							Kill();
							return;
						}
						num500 = array[Main.rand.Next(num501)];
						this.ai[0] = num500;
						netUpdate = true;
					}
					if (num500 != -1)
					{
						float num504 = 4f;
						Vector2 vector41 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
						float num505 = Main.npc[num500].Center.X - vector41.X;
						float num506 = Main.npc[num500].Center.Y - vector41.Y;
						float num507 = (float)Math.Sqrt(num505 * num505 + num506 * num506);
						float num508 = num507;
						num507 = num504 / num507;
						num505 *= num507;
						num506 *= num507;
						int num509 = 30;
						velocity.X = (velocity.X * (float)(num509 - 1) + num505) / (float)num509;
						velocity.Y = (velocity.Y * (float)(num509 - 1) + num506) / (float)num509;
					}
				}
				for (int num510 = 0; num510 < 5; num510++)
				{
					float num511 = velocity.X * 0.2f * (float)num510;
					float num512 = (0f - velocity.Y * 0.2f) * (float)num510;
					int num513 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 175, 0f, 0f, 100, default(Color), 1.3f);
					Main.dust[num513].noGravity = true;
					Dust dust2 = Main.dust[num513];
					dust2.velocity *= 0f;
					Main.dust[num513].position.X -= num511;
					Main.dust[num513].position.Y -= num512;
				}
			}
			else if (aiStyle == 60)
			{
				scale -= 0.015f;
				if (scale <= 0f)
				{
					velocity *= 5f;
					oldVelocity = velocity;
					Kill();
				}
				if (this.ai[0] > 3f)
				{
					int num514 = 103;
					if (type == 406)
					{
						num514 = 137;
					}
					if (owner == Main.myPlayer)
					{
						Rectangle rectangle4 = new Rectangle((int)base.position.X, (int)base.position.Y, width, height);
						for (int num515 = 0; num515 < 200; num515++)
						{
							if (Main.npc[num515].active && !Main.npc[num515].dontTakeDamage && Main.npc[num515].lifeMax > 1)
							{
								Rectangle value4 = new Rectangle((int)Main.npc[num515].position.X, (int)Main.npc[num515].position.Y, Main.npc[num515].width, Main.npc[num515].height);
								if (rectangle4.Intersects(value4))
								{
									Main.npc[num515].AddBuff(num514, 1500);
									Kill();
								}
							}
						}
						for (int num516 = 0; num516 < 255; num516++)
						{
							if (num516 != owner && Main.player[num516].active && !Main.player[num516].dead)
							{
								Rectangle value5 = new Rectangle((int)Main.player[num516].position.X, (int)Main.player[num516].position.Y, Main.player[num516].width, Main.player[num516].height);
								if (rectangle4.Intersects(value5))
								{
									Main.player[num516].AddBuff(num514, 1500, quiet: false);
									Kill();
								}
							}
						}
					}
					this.ai[0] += this.ai[1];
					if (this.ai[0] > 30f)
					{
						velocity.Y += 0.1f;
					}
					if (type == 358)
					{
						for (int num517 = 0; num517 < 1; num517++)
						{
							for (int num518 = 0; num518 < 6; num518++)
							{
								float num519 = velocity.X / 6f * (float)num518;
								float num520 = velocity.Y / 6f * (float)num518;
								int num521 = 6;
								int num522 = Dust.NewDust(new Vector2(base.position.X + (float)num521, base.position.Y + (float)num521), width - num521 * 2, height - num521 * 2, 211, 0f, 0f, 75, default(Color), 1.2f);
								Dust dust2;
								if (Main.rand.Next(2) == 0)
								{
									dust2 = Main.dust[num522];
									dust2.alpha += 25;
								}
								if (Main.rand.Next(2) == 0)
								{
									dust2 = Main.dust[num522];
									dust2.alpha += 25;
								}
								if (Main.rand.Next(2) == 0)
								{
									dust2 = Main.dust[num522];
									dust2.alpha += 25;
								}
								Main.dust[num522].noGravity = true;
								dust2 = Main.dust[num522];
								dust2.velocity *= 0.3f;
								dust2 = Main.dust[num522];
								dust2.velocity += velocity * 0.5f;
								Main.dust[num522].position = base.Center;
								Main.dust[num522].position.X -= num519;
								Main.dust[num522].position.Y -= num520;
								dust2 = Main.dust[num522];
								dust2.velocity *= 0.2f;
							}
							if (Main.rand.Next(4) == 0)
							{
								int num523 = 6;
								int num524 = Dust.NewDust(new Vector2(base.position.X + (float)num523, base.position.Y + (float)num523), width - num523 * 2, height - num523 * 2, 211, 0f, 0f, 75, default(Color), 0.65f);
								Dust dust2 = Main.dust[num524];
								dust2.velocity *= 0.5f;
								dust2 = Main.dust[num524];
								dust2.velocity += velocity * 0.5f;
							}
						}
					}
					if (type != 406)
					{
						return;
					}
					int num525 = 175;
					Color newColor2 = new Color(0, 80, 255, 100);
					for (int num526 = 0; num526 < 6; num526++)
					{
						Vector2 vector42 = velocity * num526 / 6f;
						int num527 = 6;
						int num528 = Dust.NewDust(base.position + Vector2.One * 6f, width - num527 * 2, height - num527 * 2, 4, 0f, 0f, num525, newColor2, 1.2f);
						Dust dust2;
						if (Main.rand.Next(2) == 0)
						{
							dust2 = Main.dust[num528];
							dust2.alpha += 25;
						}
						if (Main.rand.Next(2) == 0)
						{
							dust2 = Main.dust[num528];
							dust2.alpha += 25;
						}
						if (Main.rand.Next(2) == 0)
						{
							dust2 = Main.dust[num528];
							dust2.alpha += 25;
						}
						Main.dust[num528].noGravity = true;
						dust2 = Main.dust[num528];
						dust2.velocity *= 0.3f;
						dust2 = Main.dust[num528];
						dust2.velocity += velocity * 0.5f;
						Main.dust[num528].position = base.Center;
						Main.dust[num528].position.X -= vector42.X;
						Main.dust[num528].position.Y -= vector42.Y;
						dust2 = Main.dust[num528];
						dust2.velocity *= 0.2f;
					}
					if (Main.rand.Next(4) == 0)
					{
						int num529 = 6;
						int num530 = Dust.NewDust(base.position + Vector2.One * 6f, width - num529 * 2, height - num529 * 2, 4, 0f, 0f, num525, newColor2, 1.2f);
						Dust dust2 = Main.dust[num530];
						dust2.velocity *= 0.5f;
						dust2 = Main.dust[num530];
						dust2.velocity += velocity * 0.5f;
					}
				}
				else
				{
					this.ai[0] += 1f;
				}
			}
			else if (aiStyle == 61)
			{
				AI_061_FishingBobber();
			}
			else if (aiStyle == 62)
			{
				AI_062();
			}
			else if (aiStyle == 63)
			{
				if (!Main.player[owner].active)
				{
					active = false;
					return;
				}
				Vector2 center2 = base.position;
				bool flag22 = false;
				float num531 = 2000f;
				for (int num532 = 0; num532 < 200; num532++)
				{
					NPC nPC2 = Main.npc[num532];
					if (nPC2.CanBeChasedBy(this))
					{
						float num533 = Vector2.Distance(nPC2.Center, base.Center);
						if (!(num533 >= num531) && Collision.CanHit(base.position, width, height, nPC2.position, nPC2.width, nPC2.height))
						{
							num531 = num533;
							center2 = nPC2.Center;
							flag22 = true;
						}
					}
				}
				if (!flag22)
				{
					velocity.X *= 0.95f;
				}
				else
				{
					float num534 = 5f;
					float num535 = 0.08f;
					if (velocity.Y == 0f)
					{
						bool flag23 = false;
						if (base.Center.Y - 50f > center2.Y)
						{
							flag23 = true;
						}
						if (flag23)
						{
							velocity.Y = -6f;
						}
					}
					else
					{
						num534 = 8f;
						num535 = 0.12f;
					}
					velocity.X += (float)Math.Sign(center2.X - base.Center.X) * num535;
					if (velocity.X < 0f - num534)
					{
						velocity.X = 0f - num534;
					}
					if (velocity.X > num534)
					{
						velocity.X = num534;
					}
				}
				float num536 = 0f;
				Collision.StepUp(ref base.position, ref velocity, width, height, ref num536, ref gfxOffY);
				if (velocity.Y != 0f)
				{
					frame = 3;
				}
				else
				{
					if (Math.Abs(velocity.X) > 0.2f)
					{
						frameCounter++;
					}
					if (frameCounter >= 9)
					{
						frameCounter = 0;
					}
					if (frameCounter >= 6)
					{
						frame = 2;
					}
					else if (frameCounter >= 3)
					{
						frame = 1;
					}
					else
					{
						frame = 0;
					}
				}
				if (velocity.X != 0f)
				{
					direction = Math.Sign(velocity.X);
				}
				spriteDirection = -direction;
				velocity.Y += 0.2f;
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
			}
			else if (aiStyle == 64)
			{
				int num537 = 10;
				int num538 = 15;
				float num539 = 1f;
				int num540 = 150;
				int num541 = 42;
				if (type == 386)
				{
					num537 = 16;
					num538 = 16;
					num539 = 1.5f;
				}
				if (velocity.X != 0f)
				{
					direction = (spriteDirection = -Math.Sign(velocity.X));
				}
				frameCounter++;
				if (frameCounter > 2)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame >= 6)
				{
					frame = 0;
				}
				if (localAI[0] == 0f && Main.myPlayer == owner)
				{
					localAI[0] = 1f;
					base.position.X += width / 2;
					base.position.Y += height / 2;
					scale = ((float)(num537 + num538) - this.ai[1]) * num539 / (float)(num538 + num537);
					width = (int)((float)num540 * scale);
					height = (int)((float)num541 * scale);
					base.position.X -= width / 2;
					base.position.Y -= height / 2;
					netUpdate = true;
				}
				if (this.ai[1] != -1f)
				{
					scale = ((float)(num537 + num538) - this.ai[1]) * num539 / (float)(num538 + num537);
					width = (int)((float)num540 * scale);
					height = (int)((float)num541 * scale);
				}
				if (!Collision.SolidCollision(base.position, width, height))
				{
					alpha -= 30;
					if (alpha < 60)
					{
						alpha = 60;
					}
					if (type == 386 && alpha < 100)
					{
						alpha = 100;
					}
				}
				else
				{
					alpha += 30;
					if (alpha > 150)
					{
						alpha = 150;
					}
				}
				if (this.ai[0] > 0f)
				{
					this.ai[0]--;
				}
				if (this.ai[0] == 1f && this.ai[1] > 0f && owner == Main.myPlayer)
				{
					netUpdate = true;
					Vector2 center3 = base.Center;
					center3.Y -= (float)num541 * scale / 2f;
					float num542 = ((float)(num537 + num538) - this.ai[1] + 1f) * num539 / (float)(num538 + num537);
					center3.Y -= (float)num541 * num542 / 2f;
					center3.Y += 2f;
					NewProjectile(GetProjectileSource_FromThis(), center3.X, center3.Y, velocity.X, velocity.Y, type, damage, knockBack, owner, 10f, this.ai[1] - 1f);
					int num543 = 4;
					if (type == 386)
					{
						num543 = 2;
					}
					if ((int)this.ai[1] % num543 == 0 && this.ai[1] != 0f)
					{
						int num544 = 372;
						if (type == 386)
						{
							num544 = 373;
						}
						int num545 = NPC.NewNPC(GetNPCSource_FromThis(), (int)center3.X, (int)center3.Y, num544);
						Main.npc[num545].velocity = velocity;
						Main.npc[num545].netUpdate = true;
						if (type == 386)
						{
							Main.npc[num545].ai[2] = width;
							Main.npc[num545].ai[3] = -1.5f;
						}
					}
				}
				if (this.ai[0] <= 0f)
				{
					float num546 = MathF.PI / 30f;
					float num547 = (float)width / 5f;
					if (type == 386)
					{
						num547 *= 2f;
					}
					float num548 = (float)(Math.Cos(num546 * (0f - this.ai[0])) - 0.5) * num547;
					base.position.X -= num548 * (float)(-direction);
					this.ai[0]--;
					num548 = (float)(Math.Cos(num546 * (0f - this.ai[0])) - 0.5) * num547;
					base.position.X += num548 * (float)(-direction);
				}
			}
			else if (aiStyle == 65)
			{
				if (this.ai[1] > 0f)
				{
					int num549 = (int)this.ai[1] - 1;
					if (num549 < 255)
					{
						localAI[0]++;
						if (localAI[0] > 10f)
						{
							int num550 = 6;
							for (int num551 = 0; num551 < num550; num551++)
							{
								Vector2 spinningpoint = Vector2.Normalize(velocity) * new Vector2((float)width / 2f, height) * 0.75f;
								spinningpoint = spinningpoint.RotatedBy((double)(num551 - (num550 / 2 - 1)) * Math.PI / (double)num550) + base.Center;
								Vector2 vector43 = ((float)(Main.rand.NextDouble() * 3.1415927410125732) - MathF.PI / 2f).ToRotationVector2() * Main.rand.Next(3, 8);
								int num552 = Dust.NewDust(spinningpoint + vector43, 0, 0, 172, vector43.X * 2f, vector43.Y * 2f, 100, default(Color), 1.4f);
								Main.dust[num552].noGravity = true;
								Main.dust[num552].noLight = true;
								Dust dust2 = Main.dust[num552];
								dust2.velocity /= 4f;
								dust2 = Main.dust[num552];
								dust2.velocity -= velocity;
							}
							alpha -= 5;
							if (alpha < 100)
							{
								alpha = 100;
							}
							rotation += velocity.X * 0.1f;
							frame = (int)(localAI[0] / 3f) % 3;
						}
						Vector2 value6 = Main.player[num549].Center - base.Center;
						float num553 = 4f;
						if (this.ai[2] == 1f)
						{
							num553 += 12f;
						}
						num553 += localAI[0] / 20f;
						velocity = Vector2.Normalize(value6) * num553;
						if (value6.Length() < 50f)
						{
							Kill();
						}
					}
				}
				else
				{
					float num554 = MathF.PI / 15f;
					float num555 = 4f;
					float num556 = (float)(Math.Cos(num554 * this.ai[0]) - 0.5) * num555;
					velocity.Y -= num556;
					this.ai[0]++;
					num556 = (float)(Math.Cos(num554 * this.ai[0]) - 0.5) * num555;
					velocity.Y += num556;
					localAI[0]++;
					if (localAI[0] > 10f)
					{
						alpha -= 5;
						if (alpha < 100)
						{
							alpha = 100;
						}
						rotation += velocity.X * 0.1f;
						frame = (int)(localAI[0] / 3f) % 3;
					}
				}
				if (wet)
				{
					base.position.Y -= 16f;
					Kill();
				}
			}
			else if (aiStyle == 66)
			{
				float num557 = 0f;
				float num558 = 0f;
				float num559 = 0f;
				float num560 = 0f;
				bool flag24 = type == 387 || type == 388;
				if (flag24)
				{
					num557 = 2000f;
					num558 = 800f;
					num559 = 1200f;
					num560 = 150f;
					if (Main.player[owner].dead)
					{
						Main.player[owner].twinsMinion = false;
					}
					if (Main.player[owner].twinsMinion)
					{
						timeLeft = 2;
					}
				}
				if (type == 533)
				{
					num557 = 2000f;
					num558 = 900f;
					num559 = 1500f;
					num560 = 450f;
					if (Main.player[owner].dead)
					{
						Main.player[owner].DeadlySphereMinion = false;
					}
					if (Main.player[owner].DeadlySphereMinion)
					{
						timeLeft = 2;
					}
				}
				float num561 = 0.05f;
				for (int num562 = 0; num562 < 1000; num562++)
				{
					bool flag25 = (Main.projectile[num562].type == 387 || Main.projectile[num562].type == 388) && (type == 387 || type == 388);
					if (!flag25)
					{
						flag25 = type == 533 && Main.projectile[num562].type == 533;
					}
					if (num562 != whoAmI && Main.projectile[num562].active && Main.projectile[num562].owner == owner && flag25 && Math.Abs(base.position.X - Main.projectile[num562].position.X) + Math.Abs(base.position.Y - Main.projectile[num562].position.Y) < (float)width)
					{
						if (base.position.X < Main.projectile[num562].position.X)
						{
							velocity.X -= num561;
						}
						else
						{
							velocity.X += num561;
						}
						if (base.position.Y < Main.projectile[num562].position.Y)
						{
							velocity.Y -= num561;
						}
						else
						{
							velocity.Y += num561;
						}
					}
				}
				if (type == 533)
				{
					if ((int)this.ai[0] % 3 != 2)
					{
						Lighting.AddLight(base.Center, 0.8f, 0.3f, 0.1f);
					}
					else
					{
						Lighting.AddLight(base.Center, 0.3f, 0.5f, 0.7f);
					}
				}
				bool flag26 = false;
				if (this.ai[0] == 2f && type == 388)
				{
					this.ai[1]++;
					extraUpdates = 1;
					rotation = velocity.ToRotation() + MathF.PI;
					frameCounter++;
					if (frameCounter > 1)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 2)
					{
						frame = 0;
					}
					if (this.ai[1] > 40f)
					{
						this.ai[1] = 1f;
						this.ai[0] = 0f;
						extraUpdates = 0;
						numUpdates = 0;
						netUpdate = true;
					}
					else
					{
						flag26 = true;
					}
				}
				if (type == 533 && this.ai[0] >= 3f && this.ai[0] <= 5f)
				{
					int num563 = 2;
					flag26 = true;
					velocity *= 0.9f;
					this.ai[1]++;
					int num564 = (int)this.ai[1] / num563 + (int)(this.ai[0] - 3f) * 8;
					if (num564 < 4)
					{
						frame = 17 + num564;
					}
					else if (num564 < 5)
					{
						frame = 0;
					}
					else if (num564 < 8)
					{
						frame = 1 + num564 - 5;
					}
					else if (num564 < 11)
					{
						frame = 11 - num564;
					}
					else if (num564 < 12)
					{
						frame = 0;
					}
					else if (num564 < 16)
					{
						frame = num564 - 2;
					}
					else if (num564 < 20)
					{
						frame = 29 - num564;
					}
					else if (num564 < 21)
					{
						frame = 0;
					}
					else
					{
						frame = num564 - 4;
					}
					if (this.ai[1] > (float)(num563 * 8))
					{
						this.ai[0] -= 3f;
						this.ai[1] = 0f;
					}
				}
				if (type == 533 && this.ai[0] >= 6f && this.ai[0] <= 8f)
				{
					this.ai[1]++;
					MaxUpdates = 2;
					if (this.ai[0] == 7f)
					{
						rotation = velocity.ToRotation() + MathF.PI;
					}
					else
					{
						rotation += MathF.PI / 6f;
					}
					int num565 = 0;
					switch ((int)this.ai[0])
					{
					case 6:
						frame = 5;
						num565 = 40;
						break;
					case 7:
						frame = 13;
						num565 = 30;
						break;
					case 8:
						frame = 17;
						num565 = 30;
						break;
					}
					if (this.ai[1] > (float)num565)
					{
						this.ai[1] = 1f;
						this.ai[0] -= 6f;
						localAI[0]++;
						extraUpdates = 0;
						numUpdates = 0;
						netUpdate = true;
					}
					else
					{
						flag26 = true;
					}
					if (this.ai[0] == 8f)
					{
						for (int num566 = 0; num566 < 4; num566++)
						{
							int num567 = Utils.SelectRandom<int>(Main.rand, 226, 228, 75);
							int num568 = Dust.NewDust(base.Center, 0, 0, num567);
							Dust dust14 = Main.dust[num568];
							Vector2 vector44 = Vector2.One.RotatedBy((float)num566 * (MathF.PI / 2f)).RotatedBy(rotation);
							dust14.position = base.Center + vector44 * 10f;
							dust14.velocity = vector44 * 1f;
							dust14.scale = 0.6f + Main.rand.NextFloat() * 0.5f;
							dust14.noGravity = true;
						}
					}
				}
				if (flag26)
				{
					return;
				}
				Vector2 center4 = base.position;
				Vector2 zero = Vector2.Zero;
				bool flag27 = false;
				if (this.ai[0] != 1f && flag24)
				{
					tileCollide = true;
				}
				if (type == 533 && this.ai[0] < 9f)
				{
					tileCollide = true;
				}
				if (tileCollide && WorldGen.SolidTile(Framing.GetTileSafely((int)base.Center.X / 16, (int)base.Center.Y / 16)))
				{
					tileCollide = false;
				}
				NPC ownerMinionAttackTargetNPC3 = OwnerMinionAttackTargetNPC;
				if (ownerMinionAttackTargetNPC3 != null && ownerMinionAttackTargetNPC3.CanBeChasedBy(this))
				{
					float num569 = Vector2.Distance(ownerMinionAttackTargetNPC3.Center, base.Center);
					float num570 = num557 * 3f;
					if (num569 < num570 && !flag27 && Collision.CanHitLine(base.position, width, height, ownerMinionAttackTargetNPC3.position, ownerMinionAttackTargetNPC3.width, ownerMinionAttackTargetNPC3.height))
					{
						num557 = num569;
						center4 = ownerMinionAttackTargetNPC3.Center;
						flag27 = true;
					}
				}
				if (!flag27)
				{
					for (int num571 = 0; num571 < 200; num571++)
					{
						NPC nPC3 = Main.npc[num571];
						if (nPC3.CanBeChasedBy(this))
						{
							float num572 = Vector2.Distance(nPC3.Center, base.Center);
							if (!(num572 >= num557) && Collision.CanHitLine(base.position, width, height, nPC3.position, nPC3.width, nPC3.height))
							{
								num557 = num572;
								center4 = nPC3.Center;
								zero = nPC3.velocity;
								flag27 = true;
							}
						}
					}
				}
				float num573 = num558;
				if (flag27)
				{
					num573 = num559;
				}
				Player player4 = Main.player[owner];
				if (Vector2.Distance(player4.Center, base.Center) > num573)
				{
					if (flag24)
					{
						this.ai[0] = 1f;
					}
					if (type == 533 && this.ai[0] < 9f)
					{
						this.ai[0] += 3 * (3 - (int)(this.ai[0] / 3f));
					}
					tileCollide = false;
					netUpdate = true;
				}
				if (flag24 && flag27 && this.ai[0] == 0f)
				{
					Vector2 vector45 = center4 - base.Center;
					float num574 = vector45.Length();
					vector45.Normalize();
					if (num574 > 200f)
					{
						float num575 = 6f;
						if (type == 388)
						{
							num575 = 14f;
						}
						vector45 *= num575;
						velocity = (velocity * 40f + vector45) / 41f;
					}
					else
					{
						float num576 = 4f;
						vector45 *= 0f - num576;
						velocity = (velocity * 40f + vector45) / 41f;
					}
				}
				else
				{
					bool flag28 = false;
					if (!flag28 && flag24)
					{
						flag28 = this.ai[0] == 1f;
					}
					if (!flag28 && type == 533)
					{
						flag28 = this.ai[0] >= 9f;
					}
					float num577 = 6f;
					float num578 = 40f;
					if (type == 533)
					{
						num577 = 12f;
					}
					if (flag28)
					{
						num577 = 15f;
					}
					Vector2 center5 = base.Center;
					Vector2 vector46 = player4.Center - center5 + new Vector2(0f, -60f);
					float num579 = vector46.Length();
					float num580 = num579;
					if (num579 > 200f && num577 < 8f)
					{
						num577 = 8f;
					}
					if (num577 < Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y))
					{
						num578 = 30f;
						num577 = Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y);
						if (num579 > 200f)
						{
							num578 = 20f;
							num577 += 4f;
						}
						else if (num579 > 100f)
						{
							num577 += 3f;
						}
					}
					if (flag28 && num579 > 300f)
					{
						num577 += 6f;
						num578 -= 10f;
					}
					if (num579 < num560 && flag28 && !Collision.SolidCollision(base.position, width, height))
					{
						if (type == 387 || type == 388)
						{
							this.ai[0] = 0f;
						}
						if (type == 533)
						{
							this.ai[0] -= 9f;
						}
						netUpdate = true;
					}
					if (num579 > 2000f)
					{
						base.position.X = Main.player[owner].Center.X - (float)(width / 2);
						base.position.Y = Main.player[owner].Center.Y - (float)(height / 2);
						netUpdate = true;
					}
					if (num579 > 70f)
					{
						Vector2 vector47 = vector46;
						vector46.Normalize();
						vector46 *= num577;
						velocity = (velocity * num578 + vector46) / (num578 + 1f);
					}
					else if (velocity.X == 0f && velocity.Y == 0f)
					{
						velocity.X = -0.15f;
						velocity.Y = -0.05f;
					}
					if (velocity.Length() > num577)
					{
						velocity *= 0.95f;
					}
				}
				if (type == 388)
				{
					rotation = velocity.ToRotation() + MathF.PI;
				}
				if (type == 387)
				{
					if (this.ai[0] != 1f && flag27)
					{
						rotation = (center4 - base.Center).ToRotation() + MathF.PI;
					}
					else
					{
						rotation = velocity.ToRotation() + MathF.PI;
					}
				}
				if (type == 533 && (this.ai[0] < 3f || this.ai[0] >= 9f))
				{
					rotation += velocity.X * 0.04f;
				}
				if (type == 388 || type == 387)
				{
					frameCounter++;
					if (frameCounter > 3)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 2)
					{
						frame = 0;
					}
				}
				else if (type == 533)
				{
					if (this.ai[0] < 3f || this.ai[0] >= 9f)
					{
						frameCounter++;
						if (frameCounter >= 24)
						{
							frameCounter = 0;
						}
						int num581 = frameCounter / 4;
						frame = 4 + num581;
						switch ((int)this.ai[0])
						{
						case 0:
						case 9:
							frame = 4 + num581;
							break;
						case 1:
						case 10:
							num581 = frameCounter / 8;
							frame = 14 + num581;
							break;
						case 2:
						case 11:
							num581 = frameCounter / 3;
							if (num581 >= 4)
							{
								num581 -= 4;
							}
							frame = 17 + num581;
							break;
						}
					}
					if (this.ai[0] == 2f && Main.rand.Next(2) == 0)
					{
						for (int num582 = 0; num582 < 4; num582++)
						{
							if (Main.rand.Next(2) != 0)
							{
								int num583 = Utils.SelectRandom<int>(Main.rand, 226, 228, 75);
								int num584 = Dust.NewDust(base.Center, 0, 0, num583);
								Dust dust15 = Main.dust[num584];
								Vector2 vector48 = Vector2.One.RotatedBy((float)num582 * (MathF.PI / 2f)).RotatedBy(rotation);
								dust15.position = base.Center + vector48 * 10f;
								dust15.velocity = vector48 * 1f;
								dust15.scale = 0.3f + Main.rand.NextFloat() * 0.5f;
								dust15.noGravity = true;
								dust15.customData = this;
								dust15.noLight = true;
							}
						}
					}
				}
				if (this.ai[1] > 0f && flag24)
				{
					this.ai[1] += Main.rand.Next(1, 4);
				}
				if (this.ai[1] > 90f && type == 387)
				{
					this.ai[1] = 0f;
					netUpdate = true;
				}
				if (this.ai[1] > 40f && type == 388)
				{
					this.ai[1] = 0f;
					netUpdate = true;
				}
				if (this.ai[1] > 0f && type == 533)
				{
					this.ai[1]++;
					int num585 = 10;
					if (this.ai[1] > (float)num585)
					{
						this.ai[1] = 0f;
						netUpdate = true;
					}
				}
				if (this.ai[0] == 0f && flag24)
				{
					if (type == 387)
					{
						float num586 = 8f;
						int num587 = 389;
						if (flag27 && this.ai[1] == 0f)
						{
							this.ai[1]++;
							if (Main.myPlayer == owner && Collision.CanHitLine(base.position, width, height, center4, 0, 0))
							{
								Vector2 vector49 = center4 - base.Center;
								vector49.Normalize();
								vector49 *= num586;
								int num588 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector49.X, vector49.Y, num587, (int)((float)damage * 1.25f), 0f, Main.myPlayer);
								Main.projectile[num588].timeLeft = 300;
								netUpdate = true;
							}
						}
					}
					if (type == 388 && this.ai[1] == 0f && flag27 && num557 < 500f)
					{
						this.ai[1]++;
						if (Main.myPlayer == owner)
						{
							this.ai[0] = 2f;
							Vector2 v4 = center4 - base.Center;
							v4 = v4.SafeNormalize(velocity);
							float num589 = 8f;
							velocity = v4 * num589;
							AI_066_TryInterceptingTarget(center4, zero, num589);
							netUpdate = true;
						}
					}
				}
				else
				{
					if (type != 533 || !(this.ai[0] < 9f))
					{
						return;
					}
					int num590 = 0;
					num590 = 800;
					if (!(this.ai[1] == 0f && flag27) || !(num557 < (float)num590))
					{
						return;
					}
					this.ai[1]++;
					if (Main.myPlayer != owner)
					{
						return;
					}
					if (localAI[0] >= 3f)
					{
						this.ai[0] += 4f;
						if (this.ai[0] == 6f)
						{
							this.ai[0] = 3f;
						}
						localAI[0] = 0f;
					}
					else
					{
						this.ai[0] += 6f;
						Vector2 v5 = center4 - base.Center;
						v5 = v5.SafeNormalize(Vector2.Zero);
						float num591 = ((this.ai[0] == 8f) ? 12f : 10f);
						velocity = v5 * num591;
						AI_066_TryInterceptingTarget(center4, zero, num591);
						netUpdate = true;
					}
				}
			}
			else if (aiStyle == 67)
			{
				AI_067_FreakingPirates();
			}
			else if (aiStyle == 68)
			{
				rotation += 0.25f * (float)direction;
				bool flag29 = type == 399;
				bool flag30 = type == 669;
				this.ai[0] += 1f;
				if (this.ai[0] >= 3f)
				{
					alpha -= 40;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				if (this.ai[0] >= 15f)
				{
					velocity.Y += 0.2f;
					if (velocity.Y > 16f)
					{
						velocity.Y = 16f;
					}
					velocity.X *= 0.99f;
				}
				if (alpha == 0)
				{
					if (flag29)
					{
						Vector2 spinningpoint2 = new Vector2(4f, -8f);
						float num592 = rotation;
						if (direction == -1)
						{
							spinningpoint2.X = -4f;
						}
						spinningpoint2 = spinningpoint2.RotatedBy(num592);
						for (int num593 = 0; num593 < 1; num593++)
						{
							int num594 = Dust.NewDust(base.Center + spinningpoint2 - Vector2.One * 5f, 4, 4, 6);
							Main.dust[num594].scale = 1.5f;
							Main.dust[num594].noGravity = true;
							Main.dust[num594].velocity = Main.dust[num594].velocity * 0.25f + Vector2.Normalize(spinningpoint2) * 1f;
							Main.dust[num594].velocity = Main.dust[num594].velocity.RotatedBy(-MathF.PI / 2f * (float)direction);
						}
					}
					if (flag30)
					{
						for (int num595 = 0; num595 < 2; num595++)
						{
							Vector2 spinningpoint3 = new Vector2(MathHelper.Lerp(-8f, 8f, Main.rand.NextFloat()), -4f);
							float num596 = rotation;
							spinningpoint3 = spinningpoint3.RotatedBy(num596);
							int num597 = Dust.NewDust(base.Center + spinningpoint3 - Vector2.One * 5f, 4, 4, 4);
							Main.dust[num597].scale = 0.8f - Main.rand.NextFloat() * 0.2f;
							Main.dust[num597].velocity = Main.dust[num597].velocity * 0.25f + Vector2.Normalize(spinningpoint3) * 1f;
							Main.dust[num597].velocity = Main.dust[num597].velocity.RotatedBy(-MathF.PI / 2f * (float)direction);
							Main.dust[num597].color = Utils.SelectRandom<Color>(Main.rand, new Color(255, 255, 255, 110), new Color(245, 200, 30, 110));
						}
					}
				}
				spriteDirection = direction;
				if (timeLeft <= 3)
				{
					tileCollide = false;
					alpha = 255;
					base.position.X += width / 2;
					base.position.Y += height / 2;
					width = 80;
					height = 80;
					base.position.X -= width / 2;
					base.position.Y -= height / 2;
					knockBack = 8f;
				}
				if (wet && timeLeft > 3)
				{
					timeLeft = 3;
				}
			}
			else if (aiStyle == 69)
			{
				Vector2 vector50 = Main.player[owner].Center - base.Center;
				rotation = vector50.ToRotation() - 1.57f;
				if (Main.player[owner].dead)
				{
					Kill();
					return;
				}
				Main.player[owner].SetDummyItemTime(10);
				_ = vector50.X;
				_ = 0f;
				if (vector50.X < 0f)
				{
					Main.player[owner].ChangeDir(1);
					direction = 1;
				}
				else
				{
					Main.player[owner].ChangeDir(-1);
					direction = -1;
				}
				Main.player[owner].itemRotation = (vector50 * -1f * direction).ToRotation();
				spriteDirection = ((!(vector50.X > 0f)) ? 1 : (-1));
				if (this.ai[0] == 0f && vector50.Length() > 400f)
				{
					this.ai[0] = 1f;
				}
				if (this.ai[0] == 1f || this.ai[0] == 2f)
				{
					float num598 = vector50.Length();
					if (num598 > 1500f)
					{
						Kill();
						return;
					}
					if (num598 > 600f)
					{
						this.ai[0] = 2f;
					}
					tileCollide = false;
					float num599 = 20f;
					if (this.ai[0] == 2f)
					{
						num599 = 40f;
					}
					velocity = Vector2.Normalize(vector50) * num599;
					if (vector50.Length() < num599)
					{
						Kill();
						return;
					}
				}
				this.ai[1]++;
				if (this.ai[1] > 5f)
				{
					alpha = 0;
				}
				if ((int)this.ai[1] % 4 == 0 && owner == Main.myPlayer)
				{
					Vector2 spinningpoint4 = vector50 * -1f;
					spinningpoint4.Normalize();
					spinningpoint4 *= (float)Main.rand.Next(45, 65) * 0.1f;
					spinningpoint4 = spinningpoint4.RotatedBy((Main.rand.NextDouble() - 0.5) * 1.5707963705062866);
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, spinningpoint4.X, spinningpoint4.Y, 405, damage, knockBack, owner, -10f);
				}
			}
			else if (aiStyle == 70)
			{
				if (this.ai[0] == 0f)
				{
					float num600 = 650f;
					int num601 = -1;
					for (int num602 = 0; num602 < 200; num602++)
					{
						NPC nPC4 = Main.npc[num602];
						float num603 = (nPC4.Center - base.Center).Length();
						if (!(num603 >= num600) && nPC4.CanBeChasedBy(this) && Collision.CanHit(base.position, width, height, nPC4.position, nPC4.width, nPC4.height))
						{
							num601 = num602;
							num600 = num603;
						}
					}
					this.ai[0] = num601 + 1;
					if (this.ai[0] == 0f)
					{
						this.ai[0] = -15f;
					}
					if (this.ai[0] > 0f)
					{
						float num604 = (float)Main.rand.Next(35, 75) / 30f;
						velocity = (velocity * 20f + Vector2.Normalize(Main.npc[(int)this.ai[0] - 1].Center - base.Center + new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101))) * num604) / 21f;
						netUpdate = true;
					}
				}
				else if (this.ai[0] > 0f)
				{
					Vector2 vector51 = Vector2.Normalize(Main.npc[(int)this.ai[0] - 1].Center - base.Center);
					velocity = (velocity * 40f + vector51 * 12f) / 41f;
				}
				else
				{
					this.ai[0]++;
					alpha -= 25;
					if (alpha < 50)
					{
						alpha = 50;
					}
					velocity *= 0.95f;
				}
				if (this.ai[1] == 0f)
				{
					this.ai[1] = (float)Main.rand.Next(80, 121) / 100f;
					netUpdate = true;
				}
				scale = this.ai[1];
			}
			else if (aiStyle == 71)
			{
				localAI[1]++;
				if (localAI[1] > 10f && Main.rand.Next(3) == 0)
				{
					int num605 = 6;
					for (int num606 = 0; num606 < num605; num606++)
					{
						Vector2 spinningpoint5 = Vector2.Normalize(velocity) * new Vector2(width, height) / 2f;
						spinningpoint5 = spinningpoint5.RotatedBy((double)(num606 - (num605 / 2 - 1)) * Math.PI / (double)num605) + base.Center;
						Vector2 vector52 = ((float)(Main.rand.NextDouble() * 3.1415927410125732) - MathF.PI / 2f).ToRotationVector2() * Main.rand.Next(3, 8);
						int num607 = Dust.NewDust(spinningpoint5 + vector52, 0, 0, 217, vector52.X * 2f, vector52.Y * 2f, 100, default(Color), 1.4f);
						Main.dust[num607].noGravity = true;
						Main.dust[num607].noLight = true;
						Dust dust2 = Main.dust[num607];
						dust2.velocity /= 4f;
						dust2 = Main.dust[num607];
						dust2.velocity -= velocity;
					}
					alpha -= 5;
					if (alpha < 50)
					{
						alpha = 50;
					}
					rotation += velocity.X * 0.1f;
					frame = (int)(localAI[1] / 3f) % 3;
					Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.1f, 0.4f, 0.6f);
				}
				int num608 = -1;
				Vector2 vector53 = base.Center;
				float num609 = 500f;
				if (localAI[0] > 0f)
				{
					localAI[0]--;
				}
				if (this.ai[0] == 0f && localAI[0] == 0f)
				{
					for (int num610 = 0; num610 < 200; num610++)
					{
						NPC nPC5 = Main.npc[num610];
						if (nPC5.CanBeChasedBy(this) && (this.ai[0] == 0f || this.ai[0] == (float)(num610 + 1)))
						{
							Vector2 center6 = nPC5.Center;
							float num611 = Vector2.Distance(center6, vector53);
							if (num611 < num609 && Collision.CanHit(base.position, width, height, nPC5.position, nPC5.width, nPC5.height))
							{
								num609 = num611;
								vector53 = center6;
								num608 = num610;
							}
						}
					}
					if (num608 >= 0)
					{
						this.ai[0] = num608 + 1;
						netUpdate = true;
					}
					num608 = -1;
				}
				if (localAI[0] == 0f && this.ai[0] == 0f)
				{
					localAI[0] = 30f;
				}
				bool flag31 = false;
				if (this.ai[0] != 0f)
				{
					int num612 = (int)(this.ai[0] - 1f);
					if (Main.npc[num612].active && !Main.npc[num612].dontTakeDamage && Main.npc[num612].immune[owner] == 0)
					{
						float num613 = Main.npc[num612].position.X + (float)(Main.npc[num612].width / 2);
						float num614 = Main.npc[num612].position.Y + (float)(Main.npc[num612].height / 2);
						float num615 = Math.Abs(base.position.X + (float)(width / 2) - num613) + Math.Abs(base.position.Y + (float)(height / 2) - num614);
						if (num615 < 1000f)
						{
							flag31 = true;
							vector53 = Main.npc[num612].Center;
						}
					}
					else
					{
						this.ai[0] = 0f;
						flag31 = false;
						netUpdate = true;
					}
				}
				if (flag31)
				{
					Vector2 v6 = vector53 - base.Center;
					float num616 = velocity.ToRotation();
					float num617 = v6.ToRotation();
					double num618 = num617 - num616;
					if (num618 > Math.PI)
					{
						num618 -= Math.PI * 2.0;
					}
					if (num618 < -Math.PI)
					{
						num618 += Math.PI * 2.0;
					}
					velocity = velocity.RotatedBy(num618 * 0.10000000149011612);
				}
				float num619 = velocity.Length();
				velocity.Normalize();
				velocity *= num619 + 0.0025f;
			}
			else if (aiStyle == 72)
			{
				localAI[0]++;
				if (localAI[0] > 3f)
				{
					alpha -= 25;
					if (alpha < 50)
					{
						alpha = 50;
					}
				}
				velocity *= 0.96f;
				if (this.ai[1] == 0f)
				{
					this.ai[1] = (float)Main.rand.Next(60, 121) / 100f;
					netUpdate = true;
				}
				scale = this.ai[1];
				base.position = base.Center;
				int num620 = 14;
				int num621 = 14;
				width = (int)((float)num620 * this.ai[1]);
				height = (int)((float)num621 * this.ai[1]);
				base.position -= new Vector2(width / 2, height / 2);
			}
			else if (aiStyle == 73)
			{
				int num622 = (int)this.ai[0];
				int num623 = (int)this.ai[1];
				Tile tile2 = Main.tile[num622, num623];
				if (tile2 == null || !tile2.active() || tile2.type != 338)
				{
					Kill();
					return;
				}
				float num624 = 2f;
				float num625 = (float)timeLeft / 60f;
				if (num625 < 1f)
				{
					num624 *= num625;
				}
				if (type == 419)
				{
					for (int num626 = 0; num626 < 2; num626++)
					{
						Vector2 spinningpoint6 = new Vector2(0f, 0f - num624);
						spinningpoint6 *= 0.85f + (float)Main.rand.NextDouble() * 0.2f;
						spinningpoint6 = spinningpoint6.RotatedBy((Main.rand.NextDouble() - 0.5) * 1.5707963705062866);
						int num627 = Dust.NewDust(base.position, width, height, 222, 0f, 0f, 100);
						Dust dust16 = Main.dust[num627];
						dust16.scale = 1f + (float)Main.rand.NextDouble() * 0.3f;
						Dust dust2 = dust16;
						dust2.velocity *= 0.5f;
						if (dust16.velocity.Y > 0f)
						{
							dust16.velocity.Y *= -1f;
						}
						dust2 = dust16;
						dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
						dust2 = dust16;
						dust2.velocity += spinningpoint6;
						dust16.scale = 0.6f;
						dust16.fadeIn = dust16.scale + 0.2f;
						dust16.velocity.Y *= 2f;
					}
				}
				if (type == 420)
				{
					for (int num628 = 0; num628 < 2; num628++)
					{
						Vector2 spinningpoint7 = new Vector2(0f, 0f - num624);
						spinningpoint7 *= 0.85f + (float)Main.rand.NextDouble() * 0.2f;
						spinningpoint7 = spinningpoint7.RotatedBy((Main.rand.NextDouble() - 0.5) * 1.5707963705062866);
						int num629 = 219;
						if (Main.rand.Next(5) == 0)
						{
							num629 = 222;
						}
						int num630 = Dust.NewDust(base.position, width, height, num629, 0f, 0f, 100);
						Dust dust17 = Main.dust[num630];
						dust17.scale = 1f + (float)Main.rand.NextDouble() * 0.3f;
						Dust dust2 = dust17;
						dust2.velocity *= 0.5f;
						if (dust17.velocity.Y > 0f)
						{
							dust17.velocity.Y *= -1f;
						}
						dust2 = dust17;
						dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
						dust2 = dust17;
						dust2.velocity += spinningpoint7;
						dust17.velocity.X *= 0.5f;
						dust17.scale = 0.6f;
						dust17.fadeIn = dust17.scale + 0.2f;
						dust17.velocity.Y *= 2f;
					}
				}
				if (type == 421)
				{
					for (int num631 = 0; num631 < 2; num631++)
					{
						Vector2 spinningpoint8 = new Vector2(0f, 0f - num624);
						spinningpoint8 *= 0.85f + (float)Main.rand.NextDouble() * 0.2f;
						spinningpoint8 = spinningpoint8.RotatedBy((Main.rand.NextDouble() - 0.5) * 0.7853981852531433);
						int num632 = Dust.NewDust(base.position, width, height, 221, 0f, 0f, 100);
						Dust dust18 = Main.dust[num632];
						dust18.scale = 1f + (float)Main.rand.NextDouble() * 0.3f;
						Dust dust2 = dust18;
						dust2.velocity *= 0.1f;
						if (dust18.velocity.Y > 0f)
						{
							dust18.velocity.Y *= -1f;
						}
						dust2 = dust18;
						dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
						dust2 = dust18;
						dust2.velocity += spinningpoint8;
						dust18.scale = 0.6f;
						dust18.fadeIn = dust18.scale + 0.2f;
						dust18.velocity.Y *= 2.5f;
					}
					if (timeLeft % 10 == 0)
					{
						float num633 = 0.85f + (float)Main.rand.NextDouble() * 0.2f;
						for (int num634 = 0; num634 < 9; num634++)
						{
							Vector2 vector54 = new Vector2((float)(num634 - 4) / 5f, (0f - num624) * num633);
							int num635 = Dust.NewDust(base.position, width, height, 222, 0f, 0f, 100);
							Dust dust19 = Main.dust[num635];
							dust19.scale = 0.7f + (float)Main.rand.NextDouble() * 0.3f;
							Dust dust2 = dust19;
							dust2.velocity *= 0f;
							if (dust19.velocity.Y > 0f)
							{
								dust19.velocity.Y *= -1f;
							}
							dust2 = dust19;
							dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
							dust2 = dust19;
							dust2.velocity += vector54;
							dust19.scale = 0.6f;
							dust19.fadeIn = dust19.scale + 0.2f;
							dust19.velocity.Y *= 2f;
						}
					}
				}
				if (type != 422)
				{
					return;
				}
				for (int num636 = 0; num636 < 2; num636++)
				{
					Vector2 spinningpoint9 = new Vector2(0f, 0f - num624);
					spinningpoint9 *= 0.85f + (float)Main.rand.NextDouble() * 0.2f;
					spinningpoint9 = spinningpoint9.RotatedBy((Main.rand.NextDouble() - 0.5) * 1.5707963705062866);
					int num637 = Dust.NewDust(base.position, width, height, 219 + Main.rand.Next(5), 0f, 0f, 100);
					Dust dust20 = Main.dust[num637];
					dust20.scale = 1f + (float)Main.rand.NextDouble() * 0.3f;
					Dust dust2 = dust20;
					dust2.velocity *= 0.5f;
					if (dust20.velocity.Y > 0f)
					{
						dust20.velocity.Y *= -1f;
					}
					dust2 = dust20;
					dust2.position -= new Vector2(2 + Main.rand.Next(-2, 3), 0f);
					dust2 = dust20;
					dust2.velocity += spinningpoint9;
					dust20.scale = 0.6f;
					dust20.fadeIn = dust20.scale + 0.2f;
					dust20.velocity.Y *= 2f;
				}
			}
			else if (aiStyle == 74)
			{
				if (extraUpdates == 1)
				{
					localAI[0] *= localAI[1];
					localAI[1] -= 0.001f;
					if ((double)localAI[0] < 0.01)
					{
						Kill();
					}
				}
			}
			else if (aiStyle == 75)
			{
				AI_075();
			}
			else if (aiStyle == 76)
			{
				Player player5 = Main.player[owner];
				player5.heldProj = whoAmI;
				if (type == 441)
				{
					if (player5.mount.Type != 9)
					{
						Kill();
						return;
					}
				}
				else if (type == 453 && player5.mount.Type != 8)
				{
					Kill();
					return;
				}
				if (Main.myPlayer == owner)
				{
					base.position.X = Main.screenPosition.X + (float)Main.mouseX;
					base.position.Y = Main.screenPosition.Y + (float)Main.mouseY;
					if (this.ai[0] != base.position.X - player5.position.X || this.ai[1] != base.position.Y - player5.position.Y)
					{
						netUpdate = true;
					}
					this.ai[0] = base.position.X - player5.position.X;
					this.ai[1] = base.position.Y - player5.position.Y;
					player5.mount.AimAbility(player5, base.position);
					if (!player5.channel)
					{
						player5.mount.UseAbility(player5, base.position, toggleOn: false);
						Kill();
					}
					return;
				}
				base.position.X = player5.position.X + this.ai[0];
				base.position.Y = player5.position.Y + this.ai[1];
				if (type == 441)
				{
					if (!player5.mount.AbilityCharging)
					{
						player5.mount.StartAbilityCharge(player5);
					}
				}
				else if (type == 453 && !player5.mount.AbilityActive)
				{
					player5.mount.UseAbility(player5, base.position, toggleOn: false);
				}
				player5.mount.AimAbility(player5, base.position);
			}
			else if (aiStyle == 77)
			{
				ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[0]));
				SlotId invalid;
				if (activeSound != null)
				{
					if (activeSound.Volume == 0f)
					{
						activeSound.Stop();
						float[] array2 = localAI;
						invalid = SlotId.Invalid;
						array2[0] = ((SlotId)(ref invalid)).ToFloat();
					}
					activeSound.Volume = Math.Max(0f, activeSound.Volume - 0.05f);
				}
				else
				{
					float[] array3 = localAI;
					invalid = SlotId.Invalid;
					array3[0] = ((SlotId)(ref invalid)).ToFloat();
				}
				if (this.ai[1] == 1f)
				{
					friendly = false;
					if (alpha < 255)
					{
						alpha += 51;
					}
					if (alpha >= 255)
					{
						alpha = 255;
						Kill();
						return;
					}
				}
				else
				{
					if (alpha > 0)
					{
						alpha -= 50;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				float num638 = 30f;
				float num639 = num638 * 4f;
				this.ai[0]++;
				if (this.ai[0] > num639)
				{
					this.ai[0] = 0f;
				}
				Vector2 vector55 = -Vector2.UnitY.RotatedBy(MathF.PI * 2f * this.ai[0] / num638);
				float val = 0.75f + vector55.Y * 0.25f;
				float val2 = 0.8f - vector55.Y * 0.2f;
				float num640 = Math.Max(val, val2);
				base.position += new Vector2(width, height) / 2f;
				width = (height = (int)(80f * num640));
				base.position -= new Vector2(width, height) / 2f;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frameCounter = 0;
					frame++;
					if (frame >= 4)
					{
						frame = 0;
					}
				}
				for (int num641 = 0; num641 < 1; num641++)
				{
					float num642 = 55f * num640;
					float num643 = 11f * num640;
					float num644 = 0.5f;
					int num645 = Dust.NewDust(base.position, width, height, 226, 0f, 0f, 100, default(Color), 0.5f);
					Main.dust[num645].noGravity = true;
					Dust dust2 = Main.dust[num645];
					dust2.velocity *= 2f;
					Main.dust[num645].position = ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2() * (num643 + num644 * (float)Main.rand.NextDouble() * num642) + base.Center;
					Main.dust[num645].velocity = Main.dust[num645].velocity / 2f + Vector2.Normalize(Main.dust[num645].position - base.Center);
					if (Main.rand.Next(2) == 0)
					{
						num645 = Dust.NewDust(base.position, width, height, 226, 0f, 0f, 100, default(Color), 0.9f);
						Main.dust[num645].noGravity = true;
						dust2 = Main.dust[num645];
						dust2.velocity *= 1.2f;
						Main.dust[num645].position = ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2() * (num643 + num644 * (float)Main.rand.NextDouble() * num642) + base.Center;
						Main.dust[num645].velocity = Main.dust[num645].velocity / 2f + Vector2.Normalize(Main.dust[num645].position - base.Center);
					}
					if (Main.rand.Next(4) == 0)
					{
						num645 = Dust.NewDust(base.position, width, height, 226, 0f, 0f, 100, default(Color), 0.7f);
						Main.dust[num645].noGravity = true;
						dust2 = Main.dust[num645];
						dust2.velocity *= 1.2f;
						Main.dust[num645].position = ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2() * (num643 + num644 * (float)Main.rand.NextDouble() * num642) + base.Center;
						Main.dust[num645].velocity = Main.dust[num645].velocity / 2f + Vector2.Normalize(Main.dust[num645].position - base.Center);
					}
				}
			}
			else if (aiStyle == 78)
			{
				if (alpha > 0)
				{
					alpha -= 30;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				Vector2 v7 = this.ai[0].ToRotationVector2();
				float num646 = velocity.ToRotation();
				float num647 = v7.ToRotation();
				double num648 = num647 - num646;
				if (num648 > Math.PI)
				{
					num648 -= Math.PI * 2.0;
				}
				if (num648 < -Math.PI)
				{
					num648 += Math.PI * 2.0;
				}
				velocity = velocity.RotatedBy(num648 * 0.05000000074505806);
				velocity *= 0.96f;
				rotation = velocity.ToRotation() - MathF.PI / 2f;
				if (Main.myPlayer == owner && timeLeft > 60)
				{
					timeLeft = 60;
				}
			}
			else if (aiStyle == 79)
			{
				bool flag32 = true;
				int num649 = (int)this.ai[0] - 1;
				if (type == 447 && (this.ai[0] == 0f || ((!Main.npc[num649].active || Main.npc[num649].type != 392) && (!Main.npc[num649].active || Main.npc[num649].type != 395 || !(Main.npc[num649].ai[3] % 120f >= 60f) || Main.npc[num649].ai[0] != 2f))))
				{
					flag32 = false;
				}
				if (!flag32)
				{
					Kill();
					return;
				}
				NPC nPC6 = Main.npc[num649];
				float num650 = nPC6.Center.Y + 46f;
				float num651 = num650;
				if (type == 447)
				{
					int target = nPC6.target;
					if (nPC6.type == 392)
					{
						target = Main.npc[(int)nPC6.ai[0]].target;
					}
					Player player6 = Main.player[target];
					if (player6 != null && player6.active && !player6.dead)
					{
						num651 = player6.Bottom.Y;
					}
				}
				num651 /= 16f;
				int num652 = (int)nPC6.Center.X / 16;
				int num653 = (int)num650 / 16;
				int num654 = 0;
				if ((float)num653 >= num651 && Main.tile[num652, num653].nactive() && Main.tileSolid[Main.tile[num652, num653].type] && !Main.tileSolidTop[Main.tile[num652, num653].type])
				{
					num654 = 1;
				}
				else
				{
					for (; num654 < 150 && num653 + num654 < Main.maxTilesY; num654++)
					{
						int num655 = num653 + num654;
						if ((float)num655 >= num651 && Main.tile[num652, num655].nactive() && Main.tileSolid[Main.tile[num652, num655].type] && !Main.tileSolidTop[Main.tile[num652, num655].type])
						{
							num654--;
							break;
						}
					}
				}
				base.position.X = nPC6.Center.X - (float)(width / 2);
				base.position.Y = num650;
				height = (num654 + 1) * 16;
				int num656 = (int)base.position.Y + height;
				if (Main.tile[num652, num656 / 16].nactive() && Main.tileSolid[Main.tile[num652, num656 / 16].type] && !Main.tileSolidTop[Main.tile[num652, num656 / 16].type])
				{
					int num657 = num656 % 16;
					height -= num657 - 2;
				}
				if (type == 447)
				{
					for (int num658 = 0; num658 < 2; num658++)
					{
						int num659 = Dust.NewDust(new Vector2(base.position.X, base.position.Y + (float)height - 16f), width, 16, 228);
						Main.dust[num659].noGravity = true;
						Dust dust2 = Main.dust[num659];
						dust2.velocity *= 0.5f;
						Main.dust[num659].velocity.X -= (float)num658 - nPC6.velocity.X * 2f / 3f;
						Main.dust[num659].scale = 2.8f;
					}
					if (Main.rand.Next(5) == 0)
					{
						int num660 = Dust.NewDust(new Vector2(base.position.X + (float)(width / 2) - (float)(width / 2 * Math.Sign(nPC6.velocity.X)) - 4f, base.position.Y + (float)height - 16f), 4, 16, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num660];
						dust2.velocity *= 0.5f;
						Main.dust[num660].velocity.X -= nPC6.velocity.X / 2f;
						Main.dust[num660].velocity.Y = 0f - Math.Abs(Main.dust[num660].velocity.Y);
					}
				}
				if (type == 447 && ++frameCounter >= 5)
				{
					frameCounter = 0;
					if (++frame >= 4)
					{
						frame = 0;
					}
				}
			}
			else if (aiStyle == 80)
			{
				if (this.ai[0] == 0f && this.ai[1] > 0f)
				{
					this.ai[1]--;
				}
				else if (this.ai[0] == 0f && this.ai[1] == 0f)
				{
					this.ai[0] = 1f;
					this.ai[1] = (int)Player.FindClosest(base.position, width, height);
					netUpdate = true;
					float num661 = velocity.Length();
					velocity = Vector2.Normalize(velocity) * (num661 + 4f);
					for (int num662 = 0; num662 < 8; num662++)
					{
						Vector2 spinningpoint10 = Vector2.UnitX * -8f;
						spinningpoint10 += -Vector2.UnitY.RotatedBy((float)num662 * MathF.PI / 4f) * new Vector2(2f, 8f);
						spinningpoint10 = spinningpoint10.RotatedBy(rotation - MathF.PI / 2f);
						int num663 = Dust.NewDust(base.Center, 0, 0, 228);
						Main.dust[num663].scale = 1.5f;
						Main.dust[num663].noGravity = true;
						Main.dust[num663].position = base.Center + spinningpoint10;
						Main.dust[num663].velocity = velocity * 0f;
					}
				}
				else if (this.ai[0] == 1f)
				{
					tileCollide = true;
					localAI[1]++;
					float num664 = 180f;
					float num665 = 0f;
					float num666 = 30f;
					if (localAI[1] == num664)
					{
						Kill();
						return;
					}
					if (localAI[1] >= num665 && localAI[1] < num665 + num666)
					{
						Vector2 v8 = Main.player[(int)this.ai[1]].Center - base.Center;
						float num667 = velocity.ToRotation();
						float num668 = v8.ToRotation();
						double num669 = num668 - num667;
						if (num669 > Math.PI)
						{
							num669 -= Math.PI * 2.0;
						}
						if (num669 < -Math.PI)
						{
							num669 += Math.PI * 2.0;
						}
						velocity = velocity.RotatedBy(num669 * 0.20000000298023224);
					}
					if (localAI[1] % 5f == 0f)
					{
						for (int num670 = 0; num670 < 4; num670++)
						{
							Vector2 spinningpoint11 = Vector2.UnitX * -8f;
							spinningpoint11 += -Vector2.UnitY.RotatedBy((float)num670 * MathF.PI / 4f) * new Vector2(2f, 4f);
							spinningpoint11 = spinningpoint11.RotatedBy(rotation - MathF.PI / 2f);
							int num671 = Dust.NewDust(base.Center, 0, 0, 228);
							Main.dust[num671].scale = 1.5f;
							Main.dust[num671].noGravity = true;
							Main.dust[num671].position = base.Center + spinningpoint11;
							Main.dust[num671].velocity = velocity * 0f;
						}
					}
				}
				rotation = velocity.ToRotation() + MathF.PI / 2f;
				if (++frameCounter >= 3)
				{
					frameCounter = 0;
					if (++frame >= 3)
					{
						frame = 0;
					}
				}
				for (int num672 = 0; (float)num672 < 1f + this.ai[0]; num672++)
				{
					Vector2 vector56 = Vector2.UnitY.RotatedBy(rotation) * 8f * (num672 + 1);
					int num673 = Dust.NewDust(base.Center, 0, 0, 228);
					Main.dust[num673].position = base.Center + vector56;
					Main.dust[num673].scale = 1f;
					Main.dust[num673].noGravity = true;
				}
				for (int num674 = 0; num674 < 255; num674++)
				{
					Player player7 = Main.player[num674];
					if (player7.active && !player7.dead && Vector2.Distance(player7.Center, base.Center) <= 42f)
					{
						Kill();
						break;
					}
				}
			}
			else if (aiStyle == 81)
			{
				int num675 = penetrate;
				if (this.ai[0] == 0f)
				{
					tileCollide = true;
					localAI[0]++;
					if (localAI[0] > 7f)
					{
						int num676 = Utils.SelectRandom<int>(Main.rand, 226, 229);
						Vector2 center7 = base.Center;
						Vector2 spinningpoint12 = new Vector2(-16f, 16f);
						float num677 = 1f;
						spinningpoint12 += new Vector2(-16f, 16f);
						spinningpoint12 = spinningpoint12.RotatedBy(rotation);
						int num678 = 4;
						int num679 = Dust.NewDust(center7 + spinningpoint12 + Vector2.One * -num678, num678 * 2, num678 * 2, num676, 0f, 0f, 100, default(Color), num677);
						Dust dust2 = Main.dust[num679];
						dust2.velocity *= 0.1f;
						if (Main.rand.Next(6) != 0)
						{
							Main.dust[num679].noGravity = true;
						}
					}
					float num680 = 0.01f;
					int num681 = 5;
					int num682 = num681 * 15;
					int num683 = 0;
					if (localAI[0] > 7f)
					{
						if (localAI[1] == 0f)
						{
							scale -= num680;
							alpha += num681;
							if (alpha > num682)
							{
								alpha = num682;
								localAI[1] = 1f;
							}
						}
						else if (localAI[1] == 1f)
						{
							scale += num680;
							alpha -= num681;
							if (alpha <= num683)
							{
								alpha = num683;
								localAI[1] = 0f;
							}
						}
					}
					rotation = velocity.ToRotation() + MathF.PI / 4f;
				}
				else if (this.ai[0] >= 1f && this.ai[0] < (float)(1 + num675))
				{
					tileCollide = false;
					alpha += 15;
					velocity *= 0.98f;
					localAI[0] = 0f;
					int num684 = -1;
					Vector2 vector57 = base.Center;
					float num685 = 250f;
					for (int num686 = 0; num686 < 200; num686++)
					{
						NPC nPC7 = Main.npc[num686];
						if (nPC7.CanBeChasedBy(this))
						{
							Vector2 center8 = nPC7.Center;
							float num687 = Vector2.Distance(center8, base.Center);
							if (num687 < num685)
							{
								num685 = num687;
								vector57 = center8;
								num684 = num686;
							}
						}
					}
					if (alpha >= 255)
					{
						if (this.ai[0] == 1f)
						{
							Kill();
							return;
						}
						if (num684 >= 0)
						{
							netUpdate = true;
							this.ai[0] += num675;
							base.position = vector57 + ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2() * 100f - new Vector2(width, height) / 2f;
							velocity = Vector2.Normalize(vector57 - base.Center) * 15f;
							rotation = velocity.ToRotation() + MathF.PI / 4f;
						}
						else
						{
							Kill();
						}
					}
					if (active && num684 >= 0)
					{
						base.position += Main.npc[num684].velocity;
					}
					if (Main.rand.Next(3) == 0)
					{
						int num688 = Utils.SelectRandom<int>(Main.rand, 226, 229);
						Vector2 center9 = base.Center;
						Vector2 vector58 = new Vector2(-16f, 16f);
						vector58 = vector58;
						float num689 = 0.6f;
						vector58 += new Vector2(-16f, 16f);
						vector58 = vector58.RotatedBy(rotation);
						int num690 = 4;
						int num691 = Dust.NewDust(center9 + vector58 + Vector2.One * -num690, num690 * 2, num690 * 2, num688, 0f, 0f, 100, default(Color), num689);
						Dust dust2 = Main.dust[num691];
						dust2.velocity *= 0.1f;
						Main.dust[num691].noGravity = true;
					}
				}
				else if (this.ai[0] >= (float)(1 + num675) && this.ai[0] < (float)(1 + num675 * 2))
				{
					scale = 0.9f;
					tileCollide = false;
					rotation = velocity.ToRotation() + MathF.PI / 4f;
					this.ai[1]++;
					if (this.ai[1] >= 15f)
					{
						alpha += 51;
						velocity *= 0.8f;
						if (alpha >= 255)
						{
							Kill();
						}
					}
					else
					{
						alpha -= 125;
						if (alpha < 0)
						{
							alpha = 0;
						}
						velocity *= 0.98f;
					}
					localAI[0]++;
					int num692 = -1;
					Vector2 center10 = base.Center;
					float num693 = 250f;
					for (int num694 = 0; num694 < 200; num694++)
					{
						NPC nPC8 = Main.npc[num694];
						if (nPC8.CanBeChasedBy(this))
						{
							Vector2 center11 = nPC8.Center;
							float num695 = Vector2.Distance(center11, base.Center);
							if (num695 < num693)
							{
								num693 = num695;
								center10 = center11;
								num692 = num694;
							}
						}
					}
					if (num692 >= 0)
					{
						base.position += Main.npc[num692].velocity;
					}
					int num696 = Utils.SelectRandom<int>(Main.rand, 226, 229);
					Vector2 center12 = base.Center;
					Vector2 spinningpoint13 = new Vector2(-16f, 16f);
					float num697 = 0.6f;
					spinningpoint13 += new Vector2(-16f, 16f);
					spinningpoint13 = spinningpoint13.RotatedBy(rotation);
					int num698 = 4;
					int num699 = Dust.NewDust(center12 + spinningpoint13 + Vector2.One * -num698, num698 * 2, num698 * 2, num696, 0f, 0f, 100, default(Color), num697);
					Dust dust2 = Main.dust[num699];
					dust2.velocity *= 0.1f;
					Main.dust[num699].noGravity = true;
				}
				float num700 = (float)alpha / 255f;
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.3f * num700, 0.4f * num700, 1f * num700);
			}
			else if (aiStyle == 82)
			{
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (this.ai[0] == 0f)
				{
					localAI[0]++;
					if (localAI[0] >= 45f)
					{
						localAI[0] = 0f;
						this.ai[0] = 1f;
						this.ai[1] = 0f - this.ai[1];
						netUpdate = true;
					}
					velocity.X = velocity.RotatedBy(this.ai[1]).X;
					velocity.X = MathHelper.Clamp(velocity.X, -6f, 6f);
					velocity.Y -= 0.08f;
					if (velocity.Y > 0f)
					{
						velocity.Y -= 0.2f;
					}
					if (velocity.Y < -7f)
					{
						velocity.Y = -7f;
					}
				}
				else if (this.ai[0] == 1f)
				{
					localAI[0]++;
					if (localAI[0] >= 90f)
					{
						localAI[0] = 0f;
						this.ai[0] = 2f;
						this.ai[1] = (int)Player.FindClosest(base.position, width, height);
						netUpdate = true;
					}
					velocity.X = velocity.RotatedBy(this.ai[1]).X;
					velocity.X = MathHelper.Clamp(velocity.X, -6f, 6f);
					velocity.Y -= 0.08f;
					if (velocity.Y > 0f)
					{
						velocity.Y -= 0.2f;
					}
					if (velocity.Y < -7f)
					{
						velocity.Y = -7f;
					}
				}
				else if (this.ai[0] == 2f)
				{
					Vector2 value7 = Main.player[(int)this.ai[1]].Center - base.Center;
					if (value7.Length() < 30f)
					{
						Kill();
						return;
					}
					value7.Normalize();
					value7 *= 14f;
					value7 = Vector2.Lerp(velocity, value7, 0.6f);
					if (value7.Y < 6f)
					{
						value7.Y = 6f;
					}
					float num701 = 0.4f;
					if (velocity.X < value7.X)
					{
						velocity.X += num701;
						if (velocity.X < 0f && value7.X > 0f)
						{
							velocity.X += num701;
						}
					}
					else if (velocity.X > value7.X)
					{
						velocity.X -= num701;
						if (velocity.X > 0f && value7.X < 0f)
						{
							velocity.X -= num701;
						}
					}
					if (velocity.Y < value7.Y)
					{
						velocity.Y += num701;
						if (velocity.Y < 0f && value7.Y > 0f)
						{
							velocity.Y += num701;
						}
					}
					else if (velocity.Y > value7.Y)
					{
						velocity.Y -= num701;
						if (velocity.Y > 0f && value7.Y < 0f)
						{
							velocity.Y -= num701;
						}
					}
				}
				if (alpha < 40)
				{
					int num702 = Dust.NewDust(base.Center - Vector2.One * 5f, 10, 10, 229, (0f - velocity.X) / 3f, (0f - velocity.Y) / 3f, 150, Color.Transparent, 1.2f);
					Main.dust[num702].noGravity = true;
				}
				rotation = velocity.ToRotation() + MathF.PI / 2f;
			}
			else if (aiStyle == 83)
			{
				if (alpha > 200)
				{
					alpha = 200;
				}
				alpha -= 5;
				if (alpha < 0)
				{
					alpha = 0;
				}
				float num703 = (float)alpha / 255f;
				scale = 1f - num703;
				if (this.ai[0] >= 0f)
				{
					this.ai[0]++;
				}
				if (this.ai[0] == -1f)
				{
					frame = 1;
					extraUpdates = 1;
				}
				else if (this.ai[0] < 30f)
				{
					base.position = Main.npc[(int)this.ai[1]].Center - new Vector2(width, height) / 2f - velocity;
				}
				else
				{
					velocity *= 0.96f;
					if (++frameCounter >= 6)
					{
						frameCounter = 0;
						if (++frame >= 2)
						{
							frame = 0;
						}
					}
				}
				if (alpha >= 40)
				{
					return;
				}
				for (int num704 = 0; num704 < 2; num704++)
				{
					float num705 = (float)Main.rand.NextDouble() * 1f - 0.5f;
					if (num705 < -0.5f)
					{
						num705 = -0.5f;
					}
					if (num705 > 0.5f)
					{
						num705 = 0.5f;
					}
					Vector2 vector59 = new Vector2((float)(-width) * 0.65f * scale, 0f).RotatedBy(num705 * (MathF.PI * 2f)).RotatedBy(velocity.ToRotation());
					int num706 = Dust.NewDust(base.Center - Vector2.One * 5f, 10, 10, 229, (0f - velocity.X) / 3f, (0f - velocity.Y) / 3f, 150, Color.Transparent, 0.7f);
					Main.dust[num706].velocity = Vector2.Zero;
					Main.dust[num706].position = base.Center + vector59;
					Main.dust[num706].noGravity = true;
				}
			}
			else if (aiStyle == 84)
			{
				Vector2? vector60 = null;
				if (velocity.HasNaNs() || velocity == Vector2.Zero)
				{
					velocity = -Vector2.UnitY;
				}
				if (type == 455 && Main.npc[(int)this.ai[1]].active && Main.npc[(int)this.ai[1]].type == 396)
				{
					if (Main.npc[(int)this.ai[1]].ai[0] == -2f)
					{
						Kill();
						return;
					}
					Vector2 vector61 = Utils.Vector2FromElipse(elipseSizes: new Vector2(27f, 59f) * Main.npc[(int)this.ai[1]].localAI[1], angleVector: Main.npc[(int)this.ai[1]].localAI[0].ToRotationVector2());
					base.position = Main.npc[(int)this.ai[1]].Center + vector61 - new Vector2(width, height) / 2f;
				}
				else if (type == 455 && Main.npc[(int)this.ai[1]].active && Main.npc[(int)this.ai[1]].type == 400)
				{
					Vector2 vector62 = Utils.Vector2FromElipse(elipseSizes: new Vector2(30f, 30f) * Main.npc[(int)this.ai[1]].localAI[1], angleVector: Main.npc[(int)this.ai[1]].localAI[0].ToRotationVector2());
					base.position = Main.npc[(int)this.ai[1]].Center + vector62 - new Vector2(width, height) / 2f;
				}
				else if (type == 537 && Main.npc[(int)this.ai[1]].active && Main.npc[(int)this.ai[1]].type == 411)
				{
					Vector2 vector63 = new Vector2(Main.npc[(int)this.ai[1]].direction * 6, -4f);
					base.position = Main.npc[(int)this.ai[1]].Center + vector63 - base.Size / 2f + new Vector2(0f, 0f - Main.npc[(int)this.ai[1]].gfxOffY);
				}
				else if (type == 461 && Main.projectile[(int)this.ai[1]].active && Main.projectile[(int)this.ai[1]].type == 460)
				{
					Vector2 vector64 = Vector2.Normalize(Main.projectile[(int)this.ai[1]].velocity);
					base.position = Main.projectile[(int)this.ai[1]].Center + vector64 * 16f - new Vector2(width, height) / 2f + new Vector2(0f, 0f - Main.projectile[(int)this.ai[1]].gfxOffY);
					velocity = Vector2.Normalize(Main.projectile[(int)this.ai[1]].velocity);
				}
				else if (type == 642 && Main.projectile[(int)this.ai[1]].active && Main.projectile[(int)this.ai[1]].type == 641)
				{
					Projectile projectile = Main.projectile[(int)this.ai[1]];
					base.Center = projectile.Center;
					Vector2 vector65 = this.ai[0].ToRotationVector2().RotatedBy((float)(-projectile.direction) * (MathF.PI / 3f) / 50f);
					this.ai[0] = vector65.ToRotation();
					velocity = Vector2.Normalize(vector65);
				}
				else
				{
					if (type != 632 || !Main.projectile[(int)this.ai[1]].active || Main.projectile[(int)this.ai[1]].type != 633)
					{
						Kill();
						return;
					}
					float num707 = (float)(int)this.ai[0] - 2.5f;
					Vector2 vector66 = Vector2.Normalize(Main.projectile[(int)this.ai[1]].velocity);
					Projectile projectile2 = Main.projectile[(int)this.ai[1]];
					float num708 = num707 * (MathF.PI / 6f);
					float num709 = 20f;
					Vector2 zero2 = Vector2.Zero;
					float num710 = 1f;
					float num711 = 15f;
					float num712 = -2f;
					if (projectile2.ai[0] < 180f)
					{
						num710 = 1f - projectile2.ai[0] / 180f;
						num711 = 20f - projectile2.ai[0] / 180f * 14f;
						if (projectile2.ai[0] < 120f)
						{
							num709 = 20f - 4f * (projectile2.ai[0] / 120f);
							Opacity = projectile2.ai[0] / 120f * 0.4f;
						}
						else
						{
							num709 = 16f - 10f * ((projectile2.ai[0] - 120f) / 60f);
							Opacity = 0.4f + (projectile2.ai[0] - 120f) / 60f * 0.6f;
						}
						num712 = -22f + projectile2.ai[0] / 180f * 20f;
					}
					else
					{
						num710 = 0f;
						num709 = 1.75f;
						num711 = 6f;
						Opacity = 1f;
						num712 = -2f;
					}
					float num713 = (projectile2.ai[0] + num707 * num709) / (num709 * 6f) * (MathF.PI * 2f);
					num708 = Vector2.UnitY.RotatedBy(num713).Y * (MathF.PI / 6f) * num710;
					zero2 = (Vector2.UnitY.RotatedBy(num713) * new Vector2(4f, num711)).RotatedBy(projectile2.velocity.ToRotation());
					base.position = projectile2.Center + vector66 * 16f - base.Size / 2f + new Vector2(0f, 0f - Main.projectile[(int)this.ai[1]].gfxOffY);
					base.position += projectile2.velocity.ToRotation().ToRotationVector2() * num712;
					base.position += zero2;
					velocity = Vector2.Normalize(projectile2.velocity).RotatedBy(num708);
					scale = 1.4f * (1f - num710);
					damage = projectile2.damage;
					if (projectile2.ai[0] >= 180f)
					{
						damage *= 3;
						vector60 = projectile2.Center;
					}
					if (!Collision.CanHitLine(Main.player[owner].Center, 0, 0, projectile2.Center, 0, 0))
					{
						vector60 = Main.player[owner].Center;
					}
					friendly = projectile2.ai[0] > 30f;
				}
				if (velocity.HasNaNs() || velocity == Vector2.Zero)
				{
					velocity = -Vector2.UnitY;
				}
				if (type == 461)
				{
					this.ai[0]++;
					if (this.ai[0] >= 300f)
					{
						Kill();
						return;
					}
					scale = (float)Math.Sin(this.ai[0] * MathF.PI / 300f) * 10f;
					if (scale > 1f)
					{
						scale = 1f;
					}
				}
				if (type == 455)
				{
					if (localAI[0] == 0f)
					{
						SoundEngine.PlaySound(29, (int)base.position.X, (int)base.position.Y, 104);
					}
					float num714 = 1f;
					if (Main.npc[(int)this.ai[1]].type == 400)
					{
						num714 = 0.4f;
					}
					localAI[0]++;
					if (localAI[0] >= 180f)
					{
						Kill();
						return;
					}
					scale = (float)Math.Sin(localAI[0] * MathF.PI / 180f) * 10f * num714;
					if (scale > num714)
					{
						scale = num714;
					}
				}
				if (type == 642)
				{
					float num715 = 1f;
					localAI[0]++;
					if (localAI[0] >= 50f)
					{
						Kill();
						return;
					}
					scale = (float)Math.Sin(localAI[0] * MathF.PI / 50f) * 10f * num715;
					if (scale > num715)
					{
						scale = num715;
					}
				}
				if (type == 537)
				{
					float num716 = 0.8f;
					localAI[0]++;
					if (localAI[0] >= 90f)
					{
						Kill();
						return;
					}
					scale = (float)Math.Sin(localAI[0] * MathF.PI / 90f) * 10f * num716;
					if (scale > num716)
					{
						scale = num716;
					}
				}
				float num717 = velocity.ToRotation();
				if (type == 455)
				{
					num717 += this.ai[0];
				}
				rotation = num717 - MathF.PI / 2f;
				velocity = num717.ToRotationVector2();
				float num718 = 0f;
				float num719 = 0f;
				Vector2 samplingPoint = base.Center;
				if (vector60.HasValue)
				{
					samplingPoint = vector60.Value;
				}
				if (type == 455)
				{
					num718 = 3f;
					num719 = width;
				}
				else if (type == 461)
				{
					num718 = 2f;
					num719 = 0f;
				}
				else if (type == 642)
				{
					num718 = 2f;
					num719 = 0f;
				}
				else if (type == 632)
				{
					num718 = 2f;
					num719 = 0f;
				}
				else if (type == 537)
				{
					num718 = 2f;
					num719 = 0f;
				}
				float[] array4 = new float[(int)num718];
				Collision.LaserScan(samplingPoint, velocity, num719 * scale, 2400f, array4);
				float num720 = 0f;
				for (int num721 = 0; num721 < array4.Length; num721++)
				{
					num720 += array4[num721];
				}
				num720 /= num718;
				float amount = 0.5f;
				if (type == 455)
				{
					NPC nPC9 = Main.npc[(int)this.ai[1]];
					if (nPC9.type == 396)
					{
						Player player8 = Main.player[nPC9.target];
						if (!Collision.CanHitLine(nPC9.position, nPC9.width, nPC9.height, player8.position, player8.width, player8.height))
						{
							num720 = Math.Min(2400f, Vector2.Distance(nPC9.Center, player8.Center) + 150f);
							amount = 0.75f;
						}
					}
				}
				if (type == 632)
				{
					amount = 0.75f;
				}
				localAI[1] = MathHelper.Lerp(localAI[1], num720, amount);
				if (type == 455)
				{
					Vector2 vector67 = base.Center + velocity * (localAI[1] - 14f);
					for (int num722 = 0; num722 < 2; num722++)
					{
						float num723 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
						float num724 = (float)Main.rand.NextDouble() * 2f + 2f;
						Vector2 vector68 = new Vector2((float)Math.Cos(num723) * num724, (float)Math.Sin(num723) * num724);
						int num725 = Dust.NewDust(vector67, 0, 0, 229, vector68.X, vector68.Y);
						Main.dust[num725].noGravity = true;
						Main.dust[num725].scale = 1.7f;
					}
					if (Main.rand.Next(5) == 0)
					{
						Vector2 vector69 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
						int num726 = Dust.NewDust(vector67 + vector69 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num726];
						dust2.velocity *= 0.5f;
						Main.dust[num726].velocity.Y = 0f - Math.Abs(Main.dust[num726].velocity.Y);
					}
					DelegateMethods.v3_1 = new Vector3(0.3f, 0.65f, 0.7f);
					Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
				}
				else if (type == 642)
				{
					Vector2 vector70 = base.Center + velocity * (localAI[1] - 14f);
					for (int num727 = 0; num727 < 2; num727++)
					{
						float num728 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
						float num729 = (float)Main.rand.NextDouble() * 2f + 2f;
						Vector2 vector71 = new Vector2((float)Math.Cos(num728) * num729, (float)Math.Sin(num728) * num729);
						int num730 = Dust.NewDust(vector70, 0, 0, 229, vector71.X, vector71.Y);
						Main.dust[num730].noGravity = true;
						Main.dust[num730].scale = 1.7f;
					}
					if (Main.rand.Next(5) == 0)
					{
						Vector2 vector72 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
						int num731 = Dust.NewDust(vector70 + vector72 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num731];
						dust2.velocity *= 0.5f;
						Main.dust[num731].velocity.Y = 0f - Math.Abs(Main.dust[num731].velocity.Y);
					}
					DelegateMethods.v3_1 = new Vector3(0.3f, 0.65f, 0.7f);
					Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
				}
				if (type == 461)
				{
					Vector2 vector73 = base.Center + velocity * (localAI[1] - 8f);
					for (int num732 = 0; num732 < 2; num732++)
					{
						float num733 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
						float num734 = (float)Main.rand.NextDouble() * 0.8f + 1f;
						Vector2 vector74 = new Vector2((float)Math.Cos(num733) * num734, (float)Math.Sin(num733) * num734);
						int num735 = Dust.NewDust(vector73, 0, 0, 226, vector74.X, vector74.Y);
						Main.dust[num735].noGravity = true;
						Main.dust[num735].scale = 1.2f;
					}
					if (Main.rand.Next(5) == 0)
					{
						Vector2 vector75 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
						int num736 = Dust.NewDust(vector73 + vector75 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num736];
						dust2.velocity *= 0.5f;
						Main.dust[num736].velocity.Y = 0f - Math.Abs(Main.dust[num736].velocity.Y);
					}
					DelegateMethods.v3_1 = new Vector3(0.4f, 0.85f, 0.9f);
					Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
				}
				if (type == 537)
				{
					float num737 = MathHelper.Clamp(MathHelper.Lerp(0f, 1f, localAI[0] / 30f), 0f, 1f);
					Vector2 vector76 = base.Center + velocity * (localAI[1] - 8f);
					int num738 = (int)(2f * num737);
					if (num738 > 0)
					{
						for (int num739 = 0; num739 < num738; num739++)
						{
							float num740 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
							float num741 = (float)Main.rand.NextDouble() * 0.8f + 1f;
							Vector2 vector77 = new Vector2((float)Math.Cos(num740) * num741, (float)Math.Sin(num740) * num741);
							int num742 = Dust.NewDust(vector76, 0, 0, 226, vector77.X, vector77.Y);
							Main.dust[num742].noGravity = true;
							Main.dust[num742].scale = 1.2f;
						}
					}
					int maxValue2 = 5 + (int)((1f - num737) * 5f);
					if (Main.rand.Next(maxValue2) == 0)
					{
						Vector2 vector78 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
						int num743 = Dust.NewDust(vector76 + vector78 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num743];
						dust2.velocity *= 0.5f;
						Main.dust[num743].velocity.Y = 0f - Math.Abs(Main.dust[num743].velocity.Y);
					}
					DelegateMethods.v3_1 = new Vector3(0.4f, 0.85f, 0.9f);
					Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
				}
				if (type != 632 || !(Math.Abs(localAI[1] - num720) < 100f) || !(scale > 0.15f))
				{
					return;
				}
				float laserLuminance = 0.5f;
				float laserAlphaMultiplier = 0f;
				float lastPrismHue = GetLastPrismHue(this.ai[0], ref laserLuminance, ref laserAlphaMultiplier);
				Color color = Main.hslToRgb(lastPrismHue, 1f, laserLuminance);
				color.A = (byte)((float)(int)color.A * laserAlphaMultiplier);
				Color color2 = color;
				Vector2 vector79 = base.Center + velocity * (localAI[1] - 14.5f * scale);
				float x4 = Main.rgbToHsl(new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB)).X;
				for (int num744 = 0; num744 < 2; num744++)
				{
					float num745 = velocity.ToRotation() + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
					float num746 = (float)Main.rand.NextDouble() * 0.8f + 1f;
					Vector2 vector80 = new Vector2((float)Math.Cos(num745) * num746, (float)Math.Sin(num745) * num746);
					int num747 = Dust.NewDust(vector79, 0, 0, 267, vector80.X, vector80.Y);
					Main.dust[num747].color = color;
					Main.dust[num747].scale = 1.2f;
					if (scale > 1f)
					{
						Dust dust2 = Main.dust[num747];
						dust2.velocity *= scale;
						dust2 = Main.dust[num747];
						dust2.scale *= scale;
					}
					Main.dust[num747].noGravity = true;
					if (scale != 1.4f && num747 != 6000)
					{
						Dust dust21 = Dust.CloneDust(num747);
						dust21.color = Color.White;
						Dust dust2 = dust21;
						dust2.scale /= 2f;
					}
					float hue = (x4 + Main.rand.NextFloat() * 0.4f) % 1f;
					Main.dust[num747].color = Color.Lerp(color, Main.hslToRgb(hue, 1f, 0.75f), scale / 1.4f);
				}
				if (Main.rand.Next(5) == 0)
				{
					Vector2 vector81 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
					int num748 = Dust.NewDust(vector79 + vector81 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num748];
					dust2.velocity *= 0.5f;
					Main.dust[num748].velocity.Y = 0f - Math.Abs(Main.dust[num748].velocity.Y);
				}
				DelegateMethods.v3_1 = color.ToVector3() * 0.3f;
				float value8 = 0.1f * (float)Math.Sin(Main.GlobalTimeWrappedHourly * 20f);
				Vector2 size2 = new Vector2(velocity.Length() * localAI[1], (float)width * scale);
				float num749 = velocity.ToRotation();
				if (Main.netMode != 2)
				{
					((WaterShaderData)Filters.Scene["WaterDistortion"].GetShader()).QueueRipple(base.position + new Vector2(size2.X * 0.5f, 0f).RotatedBy(num749), new Color(0.5f, 0.1f * (float)Math.Sign(value8) + 0.5f, 0f, 1f) * Math.Abs(value8), size2, RippleShape.Square, num749);
				}
				Utils.PlotTileLine(base.Center, base.Center + velocity * localAI[1], (float)width * scale, DelegateMethods.CastLight);
			}
			else if (aiStyle == 85)
			{
				Vector2 vector82 = new Vector2(0f, 216f);
				alpha -= 15;
				if (alpha < 0)
				{
					alpha = 0;
				}
				int num750 = (int)Math.Abs(this.ai[0]) - 1;
				int num751 = (int)this.ai[1];
				if (!Main.npc[num750].active || Main.npc[num750].type != 396)
				{
					Kill();
					return;
				}
				localAI[0]++;
				if (localAI[0] >= 330f && this.ai[0] > 0f && Main.netMode != 1)
				{
					this.ai[0] *= -1f;
					netUpdate = true;
				}
				if (Main.netMode != 1 && this.ai[0] > 0f && (!Main.player[(int)this.ai[1]].active || Main.player[(int)this.ai[1]].dead))
				{
					this.ai[0] *= -1f;
					netUpdate = true;
				}
				rotation = (Main.npc[(int)Math.Abs(this.ai[0]) - 1].Center - Main.player[(int)this.ai[1]].Center + vector82).ToRotation() + MathF.PI / 2f;
				if (this.ai[0] > 0f)
				{
					Vector2 value9 = Main.player[(int)this.ai[1]].Center - base.Center;
					if (value9.X != 0f || value9.Y != 0f)
					{
						velocity = Vector2.Normalize(value9) * Math.Min(16f, value9.Length());
					}
					else
					{
						velocity = Vector2.Zero;
					}
					if (value9.Length() < 20f && localAI[1] == 0f)
					{
						localAI[1] = 1f;
						int timeToAdd = 840;
						if (Main.expertMode)
						{
							timeToAdd = 960;
						}
						if (!Main.player[num751].creativeGodMode)
						{
							Main.player[num751].AddBuff(145, timeToAdd);
						}
					}
				}
				else
				{
					Vector2 value10 = Main.npc[(int)Math.Abs(this.ai[0]) - 1].Center - base.Center + vector82;
					if (value10.X != 0f || value10.Y != 0f)
					{
						velocity = Vector2.Normalize(value10) * Math.Min(16f, value10.Length());
					}
					else
					{
						velocity = Vector2.Zero;
					}
					if (value10.Length() < 20f)
					{
						Kill();
					}
				}
			}
			else if (aiStyle == 86)
			{
				if (localAI[1] == 0f)
				{
					localAI[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item120, base.position);
				}
				this.ai[0]++;
				if (this.ai[1] == 1f)
				{
					if (this.ai[0] >= 130f)
					{
						alpha += 10;
					}
					else
					{
						alpha -= 10;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (alpha > 255)
					{
						alpha = 255;
					}
					if (this.ai[0] >= 150f)
					{
						Kill();
						return;
					}
					if (this.ai[0] % 30f == 0f && Main.netMode != 1)
					{
						Vector2 vector83 = rotation.ToRotationVector2();
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector83.X, vector83.Y, 464, damage, knockBack, owner);
					}
					rotation += MathF.PI / 30f;
					Lighting.AddLight(base.Center, 0.3f, 0.75f, 0.9f);
					return;
				}
				base.position -= velocity;
				if (this.ai[0] >= 40f)
				{
					alpha += 3;
				}
				else
				{
					alpha -= 40;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha > 255)
				{
					alpha = 255;
				}
				if (this.ai[0] >= 45f)
				{
					Kill();
					return;
				}
				Vector2 vector84 = new Vector2(0f, -720f).RotatedBy(velocity.ToRotation());
				float num752 = this.ai[0] % 45f / 45f;
				Vector2 spinningpoint14 = vector84 * num752;
				for (int num753 = 0; num753 < 6; num753++)
				{
					Vector2 vector85 = base.Center + spinningpoint14.RotatedBy((float)num753 * (MathF.PI * 2f) / 6f);
					Lighting.AddLight(vector85, 0.3f, 0.75f, 0.9f);
					for (int num754 = 0; num754 < 2; num754++)
					{
						int num755 = Dust.NewDust(vector85 + Utils.RandomVector2(Main.rand, -8f, 8f) / 2f, 8, 8, 197, 0f, 0f, 100, Color.Transparent);
						Main.dust[num755].noGravity = true;
					}
				}
			}
			else if (aiStyle == 87)
			{
				base.position.Y = this.ai[0];
				height = (int)this.ai[1];
				if (base.Center.X > Main.player[owner].Center.X)
				{
					direction = 1;
				}
				else
				{
					direction = -1;
				}
				velocity.X = (float)direction * 1E-06f;
				if (owner == Main.myPlayer)
				{
					for (int num756 = 0; num756 < 1000; num756++)
					{
						if (Main.projectile[num756].active && num756 != whoAmI && Main.projectile[num756].type == type && Main.projectile[num756].owner == owner && Main.projectile[num756].timeLeft > timeLeft)
						{
							Kill();
							return;
						}
					}
				}
				float num757 = (float)(width * height) * 0.0045f;
				for (int num758 = 0; (float)num758 < num757; num758++)
				{
					int num759 = Dust.NewDust(base.position, width, height, 75, 0f, 0f, 100);
					Main.dust[num759].noGravity = true;
					Dust dust2 = Main.dust[num759];
					dust2.velocity *= 0.5f;
					Main.dust[num759].velocity.Y -= 0.5f;
					Main.dust[num759].scale = 1.4f;
					Main.dust[num759].position.X += 6f;
					Main.dust[num759].position.Y -= 2f;
				}
			}
			else if (aiStyle == 88)
			{
				if (type == 465)
				{
					if (localAI[1] == 0f)
					{
						SoundEngine.PlaySound(SoundID.Item121, base.position);
						localAI[1] = 1f;
					}
					if (this.ai[0] < 180f)
					{
						alpha -= 5;
						if (alpha < 0)
						{
							alpha = 0;
						}
					}
					else
					{
						alpha += 5;
						if (alpha > 255)
						{
							alpha = 255;
							Kill();
							return;
						}
					}
					this.ai[0]++;
					if (this.ai[0] % 30f == 0f && this.ai[0] < 180f && Main.netMode != 1)
					{
						int[] array5 = new int[5];
						Vector2[] array6 = new Vector2[5];
						int num760 = 0;
						float num761 = 2000f;
						for (int num762 = 0; num762 < 255; num762++)
						{
							if (!Main.player[num762].active || Main.player[num762].dead)
							{
								continue;
							}
							Vector2 center13 = Main.player[num762].Center;
							float num763 = Vector2.Distance(center13, base.Center);
							if (num763 < num761 && Collision.CanHit(base.Center, 1, 1, center13, 1, 1))
							{
								array5[num760] = num762;
								array6[num760] = center13;
								int num38 = num760 + 1;
								num760 = num38;
								if (num38 >= array6.Length)
								{
									break;
								}
							}
						}
						for (int num764 = 0; num764 < num760; num764++)
						{
							Vector2 vector86 = array6[num764] - base.Center;
							float ai = Main.rand.Next(100);
							Vector2 vector87 = Vector2.Normalize(vector86.RotatedByRandom(0.7853981852531433)) * 7f;
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector87.X, vector87.Y, 466, damage, 0f, Main.myPlayer, vector86.ToRotation(), ai);
						}
					}
					Lighting.AddLight(base.Center, 0.4f, 0.85f, 0.9f);
					if (++frameCounter >= 4)
					{
						frameCounter = 0;
						if (++frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
					if (alpha >= 150 || !(this.ai[0] < 180f))
					{
						return;
					}
					for (int num765 = 0; num765 < 1; num765++)
					{
						float num766 = (float)Main.rand.NextDouble() * 1f - 0.5f;
						if (num766 < -0.5f)
						{
							num766 = -0.5f;
						}
						if (num766 > 0.5f)
						{
							num766 = 0.5f;
						}
						Vector2 vector88 = new Vector2((float)(-width) * 0.2f * scale, 0f).RotatedBy(num766 * (MathF.PI * 2f)).RotatedBy(velocity.ToRotation());
						int num767 = Dust.NewDust(base.Center - Vector2.One * 5f, 10, 10, 226, (0f - velocity.X) / 3f, (0f - velocity.Y) / 3f, 150, Color.Transparent, 0.7f);
						Main.dust[num767].position = base.Center + vector88;
						Main.dust[num767].velocity = Vector2.Normalize(Main.dust[num767].position - base.Center) * 2f;
						Main.dust[num767].noGravity = true;
					}
					for (int num768 = 0; num768 < 1; num768++)
					{
						float num769 = (float)Main.rand.NextDouble() * 1f - 0.5f;
						if (num769 < -0.5f)
						{
							num769 = -0.5f;
						}
						if (num769 > 0.5f)
						{
							num769 = 0.5f;
						}
						Vector2 vector89 = new Vector2((float)(-width) * 0.6f * scale, 0f).RotatedBy(num769 * (MathF.PI * 2f)).RotatedBy(velocity.ToRotation());
						int num770 = Dust.NewDust(base.Center - Vector2.One * 5f, 10, 10, 226, (0f - velocity.X) / 3f, (0f - velocity.Y) / 3f, 150, Color.Transparent, 0.7f);
						Main.dust[num770].velocity = Vector2.Zero;
						Main.dust[num770].position = base.Center + vector89;
						Main.dust[num770].noGravity = true;
					}
				}
				else if (type == 466)
				{
					frameCounter++;
					Lighting.AddLight(base.Center, 0.3f, 0.45f, 0.5f);
					if (velocity == Vector2.Zero)
					{
						if (frameCounter >= extraUpdates * 2)
						{
							frameCounter = 0;
							bool flag33 = true;
							for (int num771 = 1; num771 < oldPos.Length; num771++)
							{
								if (oldPos[num771] != oldPos[0])
								{
									flag33 = false;
								}
							}
							if (flag33)
							{
								Kill();
								return;
							}
						}
						if (Main.rand.Next(extraUpdates) == 0)
						{
							for (int num772 = 0; num772 < 2; num772++)
							{
								float num773 = rotation + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
								float num774 = (float)Main.rand.NextDouble() * 0.8f + 1f;
								Vector2 vector90 = new Vector2((float)Math.Cos(num773) * num774, (float)Math.Sin(num773) * num774);
								int num775 = Dust.NewDust(base.Center, 0, 0, 226, vector90.X, vector90.Y);
								Main.dust[num775].noGravity = true;
								Main.dust[num775].scale = 1.2f;
							}
							if (Main.rand.Next(5) == 0)
							{
								Vector2 vector91 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
								int num776 = Dust.NewDust(base.Center + vector91 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
								Dust dust2 = Main.dust[num776];
								dust2.velocity *= 0.5f;
								Main.dust[num776].velocity.Y = 0f - Math.Abs(Main.dust[num776].velocity.Y);
							}
						}
					}
					else
					{
						if (frameCounter < extraUpdates * 2)
						{
							return;
						}
						frameCounter = 0;
						float num777 = velocity.Length();
						UnifiedRandom unifiedRandom = new UnifiedRandom((int)this.ai[1]);
						int num778 = 0;
						Vector2 spinningpoint15 = -Vector2.UnitY;
						while (true)
						{
							int num779 = unifiedRandom.Next();
							this.ai[1] = num779;
							num779 %= 100;
							float f = (float)num779 / 100f * (MathF.PI * 2f);
							Vector2 vector92 = f.ToRotationVector2();
							if (vector92.Y > 0f)
							{
								vector92.Y *= -1f;
							}
							bool flag34 = false;
							if (vector92.Y > -0.02f)
							{
								flag34 = true;
							}
							if (vector92.X * (float)(extraUpdates + 1) * 2f * num777 + localAI[0] > 40f)
							{
								flag34 = true;
							}
							if (vector92.X * (float)(extraUpdates + 1) * 2f * num777 + localAI[0] < -40f)
							{
								flag34 = true;
							}
							if (flag34)
							{
								if (num778++ >= 100)
								{
									velocity = Vector2.Zero;
									localAI[1] = 1f;
									break;
								}
								continue;
							}
							spinningpoint15 = vector92;
							break;
						}
						if (velocity != Vector2.Zero)
						{
							localAI[0] += spinningpoint15.X * (float)(extraUpdates + 1) * 2f * num777;
							velocity = spinningpoint15.RotatedBy(this.ai[0] + MathF.PI / 2f) * num777;
							rotation = velocity.ToRotation() + MathF.PI / 2f;
						}
					}
				}
				else
				{
					if (type != 580)
					{
						return;
					}
					if (localAI[1] == 0f && this.ai[0] >= 900f)
					{
						this.ai[0] -= 1000f;
						localAI[1] = -1f;
					}
					frameCounter++;
					Lighting.AddLight(base.Center, 0.3f, 0.45f, 0.5f);
					if (velocity == Vector2.Zero)
					{
						if (frameCounter >= extraUpdates * 2)
						{
							frameCounter = 0;
							bool flag35 = true;
							for (int num780 = 1; num780 < oldPos.Length; num780++)
							{
								if (oldPos[num780] != oldPos[0])
								{
									flag35 = false;
								}
							}
							if (flag35)
							{
								Kill();
								return;
							}
						}
						if (Main.rand.Next(extraUpdates) == 0 && (velocity != Vector2.Zero || Main.rand.Next((localAI[1] == 2f) ? 2 : 6) == 0))
						{
							for (int num781 = 0; num781 < 2; num781++)
							{
								float num782 = rotation + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
								float num783 = (float)Main.rand.NextDouble() * 0.8f + 1f;
								Vector2 vector93 = new Vector2((float)Math.Cos(num782) * num783, (float)Math.Sin(num782) * num783);
								int num784 = Dust.NewDust(base.Center, 0, 0, 226, vector93.X, vector93.Y);
								Main.dust[num784].noGravity = true;
								Main.dust[num784].scale = 1.2f;
							}
							if (Main.rand.Next(5) == 0)
							{
								Vector2 vector94 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
								int num785 = Dust.NewDust(base.Center + vector94 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
								Dust dust2 = Main.dust[num785];
								dust2.velocity *= 0.5f;
								Main.dust[num785].velocity.Y = 0f - Math.Abs(Main.dust[num785].velocity.Y);
							}
						}
					}
					else
					{
						if (frameCounter < extraUpdates * 2)
						{
							return;
						}
						frameCounter = 0;
						float num786 = velocity.Length();
						UnifiedRandom unifiedRandom2 = new UnifiedRandom((int)this.ai[1]);
						int num787 = 0;
						Vector2 spinningpoint16 = -Vector2.UnitY;
						while (true)
						{
							int num788 = unifiedRandom2.Next();
							this.ai[1] = num788;
							num788 %= 100;
							float f2 = (float)num788 / 100f * (MathF.PI * 2f);
							Vector2 vector95 = f2.ToRotationVector2();
							if (vector95.Y > 0f)
							{
								vector95.Y *= -1f;
							}
							bool flag36 = false;
							if (vector95.Y > -0.02f)
							{
								flag36 = true;
							}
							if (vector95.X * (float)(extraUpdates + 1) * 2f * num786 + localAI[0] > 40f)
							{
								flag36 = true;
							}
							if (vector95.X * (float)(extraUpdates + 1) * 2f * num786 + localAI[0] < -40f)
							{
								flag36 = true;
							}
							if (flag36)
							{
								if (num787++ >= 100)
								{
									velocity = Vector2.Zero;
									if (localAI[1] < 1f)
									{
										localAI[1] += 2f;
									}
									break;
								}
								continue;
							}
							spinningpoint16 = vector95;
							break;
						}
						if (!(velocity != Vector2.Zero))
						{
							return;
						}
						localAI[0] += spinningpoint16.X * (float)(extraUpdates + 1) * 2f * num786;
						velocity = spinningpoint16.RotatedBy(this.ai[0] + MathF.PI / 2f) * num786;
						rotation = velocity.ToRotation() + MathF.PI / 2f;
						if (Main.rand.Next(4) == 0 && Main.netMode != 1 && localAI[1] == 0f)
						{
							float num789 = (float)Main.rand.Next(-3, 4) * (MathF.PI / 3f) / 3f;
							Vector2 vector96 = this.ai[0].ToRotationVector2().RotatedBy(num789) * velocity.Length();
							if (!Collision.CanHitLine(base.Center, 0, 0, base.Center + vector96 * 50f, 0, 0))
							{
								NewProjectile(GetProjectileSource_FromThis(), base.Center.X - vector96.X, base.Center.Y - vector96.Y, vector96.X, vector96.Y, type, damage, knockBack, owner, vector96.ToRotation() + 1000f, this.ai[1]);
							}
						}
					}
				}
			}
			else if (aiStyle == 89)
			{
				if (this.ai[1] == -1f)
				{
					alpha += 12;
				}
				else if (this.ai[0] < 300f)
				{
					alpha -= 5;
				}
				else
				{
					alpha += 12;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha > 255)
				{
					alpha = 255;
				}
				scale = 1f - (float)alpha / 255f;
				scale *= 0.6f;
				rotation += MathF.PI / 210f;
				if (localAI[1] == 0f)
				{
					localAI[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item123, base.position);
				}
				if (alpha == 0)
				{
					for (int num790 = 0; num790 < 2; num790++)
					{
						float num791 = Main.rand.Next(2, 4);
						float num792 = scale;
						if (num790 == 1)
						{
							num792 *= 0.42f;
							num791 *= -0.75f;
						}
						Vector2 vector97 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
						vector97.Normalize();
						int num793 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 228, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num793].noGravity = true;
						Main.dust[num793].noLight = true;
						Main.dust[num793].position = base.Center + vector97 * 204f * num792;
						if (Main.rand.Next(8) == 0)
						{
							Main.dust[num793].velocity = vector97 * (0f - num791) * 2f;
							Dust dust2 = Main.dust[num793];
							dust2.scale += 0.5f;
						}
						else
						{
							Main.dust[num793].velocity = vector97 * (0f - num791);
						}
					}
				}
				this.ai[0]++;
				if (this.ai[0] >= 60f)
				{
					int num794 = (int)(this.ai[0] - 0f) / 60;
					float num795 = scale * 0.4f;
					for (int num796 = 0; num796 < 1; num796++)
					{
						float num797 = Main.rand.Next(1, 3);
						Vector2 vector98 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
						vector98.Normalize();
						int num798 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 228, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num798].noGravity = true;
						Main.dust[num798].noLight = true;
						Main.dust[num798].position = base.Center;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num798].velocity = vector98 * num797 * 2f;
							Dust dust2 = Main.dust[num798];
							dust2.scale += 0.5f;
						}
						else
						{
							Main.dust[num798].velocity = vector98 * num797;
						}
						Main.dust[num798].fadeIn = 2f;
					}
				}
				if (this.ai[0] == 300f && this.ai[1] != -1f && Main.netMode != 1)
				{
					if (!NPC.AnyNPCs(454))
					{
						this.ai[1] = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 454);
					}
					else
					{
						this.ai[1] = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 521);
					}
				}
				else if (this.ai[0] == 320f)
				{
					Kill();
					return;
				}
				bool flag37 = false;
				if (this.ai[1] == -1f)
				{
					if (alpha == 255)
					{
						flag37 = true;
					}
				}
				else
				{
					flag37 = !(this.ai[1] >= 0f) || !Main.npc[(int)this.ai[1]].active;
					if ((flag37 || Main.npc[(int)this.ai[1]].type != 439) && (flag37 || Main.npc[(int)this.ai[1]].type != 454) && (flag37 || Main.npc[(int)this.ai[1]].type != 521))
					{
						flag37 = true;
					}
				}
				if (flag37)
				{
					Kill();
				}
				else
				{
					Lighting.AddLight(base.Center, 1.1f, 0.9f, 0.4f);
				}
			}
			else if (aiStyle == 90)
			{
				if (Main.player[owner].dead)
				{
					Kill();
				}
				if (Main.player[owner].magicLantern)
				{
					timeLeft = 2;
				}
				if (tileCollide)
				{
					if (!Collision.CanHit(base.position, width, height, Main.player[owner].Center, 1, 1))
					{
						tileCollide = false;
					}
					else if (!Collision.SolidCollision(base.position, width, height) && Collision.CanHitLine(base.position, width, height, Main.player[owner].Center, 1, 1))
					{
						tileCollide = true;
					}
				}
				direction = Main.player[owner].direction;
				spriteDirection = direction;
				Lighting.AddLight(base.position, 0.35f, 0.35f, 0.1f);
				localAI[0] += 1f;
				if (localAI[0] >= 10f)
				{
					localAI[0] = 0f;
					int num799 = 17;
					if ((base.Center - Main.player[Main.myPlayer].Center).Length() < (float)(Main.screenWidth + num799 * 16))
					{
						int num800 = (int)base.Center.X / 16;
						int num801 = (int)base.Center.Y / 16;
						for (int num802 = num800 - num799; num802 <= num800 + num799; num802++)
						{
							for (int num803 = num801 - num799; num803 <= num801 + num799; num803++)
							{
								if (Main.rand.Next(4) == 0 && new Vector2(num800 - num802, num801 - num803).Length() < (float)num799 && num802 > 0 && num802 < Main.maxTilesX - 1 && num803 > 0 && num803 < Main.maxTilesY - 1 && Main.tile[num802, num803] != null && Main.tile[num802, num803].active() && Main.IsTileSpelunkable(Main.tile[num802, num803]))
								{
									int num804 = Dust.NewDust(new Vector2(num802 * 16, num803 * 16), 16, 16, 204, 0f, 0f, 150, default(Color), 0.3f);
									Main.dust[num804].fadeIn = 0.75f;
									Dust dust2 = Main.dust[num804];
									dust2.velocity *= 0.1f;
									Main.dust[num804].noLight = true;
								}
							}
						}
					}
				}
				Vector2 vector99 = Main.player[owner].Center - base.Center;
				vector99.X += 40 * direction;
				vector99.Y -= 40f;
				float num805 = vector99.Length();
				if (num805 > 1000f)
				{
					base.Center = Main.player[owner].Center;
				}
				float num806 = 3f;
				float num807 = 4f;
				if (num805 > 200f)
				{
					num807 += (num805 - 200f) * 0.1f;
					tileCollide = false;
				}
				if (num805 < num807)
				{
					velocity *= 0.25f;
					num807 = num805;
				}
				if (vector99.X != 0f || vector99.Y != 0f)
				{
					vector99.Normalize();
					vector99 *= num807;
				}
				velocity = (velocity * (num806 - 1f) + vector99) / num806;
				if (velocity.Length() > 6f)
				{
					float num808 = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					if ((double)Math.Abs(rotation - num808) >= 3.14)
					{
						if (num808 < rotation)
						{
							rotation -= 6.28f;
						}
						else
						{
							rotation += 6.28f;
						}
					}
					rotation = (rotation * 4f + num808) / 5f;
					frameCounter++;
					if (frameCounter > 4)
					{
						frameCounter = 0;
						frame++;
						if (frame > 7)
						{
							frame = 4;
						}
					}
					if (frame < 4)
					{
						frame = 7;
					}
					return;
				}
				if ((double)rotation > 3.14)
				{
					rotation -= 6.28f;
				}
				if ((double)rotation > -0.01 && (double)rotation < 0.01)
				{
					rotation = 0f;
				}
				else
				{
					rotation *= 0.9f;
				}
				frameCounter++;
				if (frameCounter > 6)
				{
					frameCounter = 0;
					frame++;
					if (frame > 3)
					{
						frame = 0;
					}
				}
			}
			else if (aiStyle == 91)
			{
				Vector2 center14 = base.Center;
				scale = 1f - localAI[0];
				width = (int)(20f * scale);
				height = width;
				base.position.X = center14.X - (float)(width / 2);
				base.position.Y = center14.Y - (float)(height / 2);
				if ((double)localAI[0] < 0.1)
				{
					localAI[0] += 0.01f;
				}
				else
				{
					localAI[0] += 0.025f;
				}
				if (localAI[0] >= 0.95f)
				{
					Kill();
				}
				velocity.X += this.ai[0] * 1.5f;
				velocity.Y += this.ai[1] * 1.5f;
				if (velocity.Length() > 16f)
				{
					velocity.Normalize();
					velocity *= 16f;
				}
				this.ai[0] *= 1.05f;
				this.ai[1] *= 1.05f;
				if (scale < 1f)
				{
					for (int num809 = 0; (float)num809 < scale * 10f; num809++)
					{
						int num810 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 27, velocity.X, velocity.Y, 100, default(Color), 1.1f);
						Main.dust[num810].position = (Main.dust[num810].position + base.Center) / 2f;
						Main.dust[num810].noGravity = true;
						Dust dust2 = Main.dust[num810];
						dust2.velocity *= 0.1f;
						dust2 = Main.dust[num810];
						dust2.velocity -= velocity * (1.3f - scale);
						Main.dust[num810].fadeIn = 100 + owner;
						dust2 = Main.dust[num810];
						dust2.scale += scale * 0.75f;
					}
				}
			}
			else if (aiStyle == 92)
			{
				bool flag38 = type == 1007;
				bool flag39 = type >= 511 && type <= 513;
				tileCollide = false;
				if (Main.netMode != 1 && flag38 && localAI[0] == 0f)
				{
					if (direction == 0)
					{
						direction = 1;
					}
					ParticleOrchestrator.BroadcastParticleSpawn(ParticleOrchestraType.GasTrap, new ParticleOrchestraSettings
					{
						PositionInWorld = base.Center,
						MovementVector = Vector2.Zero
					});
				}
				this.ai[0] += 1f;
				if (this.ai[1] >= 1f)
				{
					this.ai[0] += 2f;
				}
				float num811 = 260f;
				if (flag38)
				{
					num811 = 80f;
				}
				if (this.ai[0] > num811)
				{
					Kill();
					this.ai[0] = num811;
					return;
				}
				float fromValue = this.ai[0] / num811;
				if (flag38)
				{
					scale = Utils.Remap(fromValue, 0f, 0.95f, 1f, 6f);
					Vector2 center15 = base.Center;
					width = (int)(50f * scale);
					height = (int)(50f * scale);
					base.Center = center15;
					Opacity = MathHelper.Clamp(Utils.Remap(fromValue, 0f, 0.25f, 0f, 1f) * Utils.Remap(fromValue, 0.75f, 1f, 1f, 0f), 0f, 1f) * 0.85f;
				}
				else
				{
					Opacity = Utils.Remap(fromValue, 0f, 0.3f, 0f, 1f) * Utils.Remap(fromValue, 0.3f, 1f, 1f, 0f) * 0.7f;
				}
				localAI[0] += direction;
				rotation = (float)whoAmI * 0.4002029f + localAI[0] * (MathF.PI * 2f) / 480f;
				if (flag38)
				{
					velocity = Vector2.Zero;
				}
				else
				{
					velocity *= 0.96f;
				}
				if (flag39)
				{
					Rectangle rectangle5 = new Rectangle((int)base.position.X, (int)base.position.Y, width, height);
					for (int num812 = 0; num812 < 1000; num812++)
					{
						if (num812 == whoAmI)
						{
							continue;
						}
						Projectile projectile3 = Main.projectile[num812];
						if (!projectile3.active || projectile3.type < 511 || projectile3.type > 513)
						{
							continue;
						}
						Rectangle value11 = new Rectangle((int)projectile3.position.X, (int)projectile3.position.Y, projectile3.width, projectile3.height);
						if (!rectangle5.Intersects(value11))
						{
							continue;
						}
						Vector2 vector100 = projectile3.Center - base.Center;
						if (vector100 == Vector2.Zero)
						{
							if (num812 < whoAmI)
							{
								vector100.X = -1f;
								vector100.Y = 1f;
							}
							else
							{
								vector100.X = 1f;
								vector100.Y = -1f;
							}
						}
						Vector2 vector101 = vector100.SafeNormalize(Vector2.UnitX) * 0.005f;
						velocity = Vector2.Lerp(velocity, velocity - vector101, 0.6f);
						projectile3.velocity = Vector2.Lerp(projectile3.velocity, projectile3.velocity + vector101, 0.6f);
					}
				}
				Vector2 vector102 = velocity.SafeNormalize(Vector2.Zero);
				Vector2 pos = base.Center + vector102 * 16f;
				if (!flag38 && Collision.IsWorldPointSolid(pos))
				{
					velocity = Vector2.Lerp(velocity, velocity - vector102 * 1f, 0.5f);
				}
				if (!flag38)
				{
					return;
				}
				int num813 = 20;
				int num814 = 2940;
				float num815 = MathHelper.Clamp(Utils.Remap(fromValue, 0f, 0.2f, 0f, 1f), 0f, 1f) * 180f;
				if (localAI[1] > 0f)
				{
					localAI[1]--;
				}
				if (!(localAI[1] <= 0f))
				{
					return;
				}
				localAI[1] = 15f;
				if (Main.netMode != 2)
				{
					Player localPlayer = Main.LocalPlayer;
					if (localPlayer.active && !localPlayer.DeadOrGhost && localPlayer.Center.Distance(base.Center) <= num815)
					{
						localPlayer.AddBuff(num813, num814);
					}
				}
				if (Main.netMode == 1)
				{
					return;
				}
				for (int num816 = 0; num816 < 200; num816++)
				{
					NPC nPC10 = Main.npc[num816];
					if (nPC10.active && !nPC10.buffImmune[num813] && nPC10.Center.Distance(base.Center) <= num815)
					{
						nPC10.AddBuff(num813, num814);
					}
				}
			}
			else if (aiStyle == 93)
			{
				if (alpha > 0)
				{
					alpha -= 25;
					if (alpha <= 0)
					{
						alpha = 0;
					}
				}
				if (velocity.Y > 18f)
				{
					velocity.Y = 18f;
				}
				if (this.ai[0] == 0f)
				{
					this.ai[1] += 1f;
					if (this.ai[1] > 20f)
					{
						velocity.Y += 0.1f;
						velocity.X *= 0.992f;
					}
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					return;
				}
				tileCollide = false;
				if (this.ai[0] == 1f)
				{
					tileCollide = false;
					velocity *= 0.6f;
				}
				else
				{
					tileCollide = false;
					int num817 = (int)(0f - this.ai[0]);
					num817--;
					base.position = Main.npc[num817].Center - velocity;
					base.position.X -= width / 2;
					base.position.Y -= height / 2;
					if (!Main.npc[num817].active || Main.npc[num817].life < 0)
					{
						tileCollide = true;
						this.ai[0] = 0f;
						this.ai[1] = 20f;
						velocity = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						velocity.Normalize();
						velocity *= 6f;
						netUpdate = true;
					}
					else if (velocity.Length() > (float)((Main.npc[num817].width + Main.npc[num817].height) / 3))
					{
						velocity *= 0.99f;
					}
				}
				if (this.ai[0] != 0f)
				{
					this.ai[1] += 1f;
					if (this.ai[1] > 90f)
					{
						Kill();
					}
				}
			}
			else if (aiStyle == 94)
			{
				if (++frameCounter >= 4)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				this.ai[0]++;
				if (this.ai[0] <= 40f)
				{
					alpha -= 5;
					if (alpha < 0)
					{
						alpha = 0;
					}
					velocity *= 0.85f;
					if (this.ai[0] == 40f)
					{
						netUpdate = true;
						switch (Main.rand.Next(3))
						{
						case 0:
							this.ai[1] = 10f;
							break;
						case 1:
							this.ai[1] = 15f;
							break;
						case 2:
							this.ai[1] = 30f;
							break;
						}
					}
				}
				else if (this.ai[0] <= 60f)
				{
					velocity = Vector2.Zero;
					if (this.ai[0] == 60f)
					{
						netUpdate = true;
					}
				}
				else if (this.ai[0] <= 210f)
				{
					if (Main.netMode != 1 && (localAI[0] += 1f) >= this.ai[1])
					{
						localAI[0] = 0f;
						int num818 = Item.NewItem(GetItemSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 0, 0, 73);
						Main.item[num818].velocity = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * new Vector2(3f, 2f) * (Main.rand.NextFloat() * 0.5f + 0.5f) - Vector2.UnitY * 1f;
					}
					if (this.ai[0] == 210f)
					{
						netUpdate = true;
					}
				}
				else
				{
					scale -= 1f / 30f;
					alpha += 15;
					if (this.ai[0] == 239f)
					{
						netUpdate = true;
					}
					if (this.ai[0] == 240f)
					{
						Kill();
					}
				}
				if (alpha < 90 && Main.rand.Next(3) == 0)
				{
					Vector2 vector103 = new Vector2(width, height) * scale * 0.85f;
					vector103 /= 2f;
					Vector2 vector104 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * vector103;
					int num819 = Dust.NewDust(base.Center + vector104, 0, 0, 246);
					Main.dust[num819].position = base.Center + vector104;
					Main.dust[num819].velocity = Vector2.Zero;
				}
				float num820 = 0.8f;
				float num821 = 0.70980394f;
				float num822 = 24f / 85f;
				Lighting.AddLight(base.Center, num820 * 0.3f, num821 * 0.3f, num822 * 0.3f);
			}
			else if (aiStyle == 95)
			{
				if (localAI[0] > 2f)
				{
					alpha -= 20;
					if (alpha < 100)
					{
						alpha = 100;
					}
				}
				else
				{
					localAI[0] += 1f;
				}
				if (this.ai[0] > 30f)
				{
					if (velocity.Y > -8f)
					{
						velocity.Y -= 0.05f;
					}
					velocity.X *= 0.98f;
				}
				else
				{
					this.ai[0] += 1f;
				}
				rotation = velocity.X * 0.1f;
				if (wet)
				{
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.98f;
					}
					if (velocity.Y > -8f)
					{
						velocity.Y -= 0.2f;
					}
					velocity.X *= 0.94f;
				}
			}
			else if (aiStyle == 96)
			{
				this.ai[0] += 0.6f;
				if (this.ai[0] > 500f)
				{
					Kill();
				}
				for (int num823 = 0; num823 < 2; num823++)
				{
					if (Main.rand.Next(3) != 0)
					{
						int num824 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 170, 0f, 0f, 100);
						Main.dust[num824].position = (Main.dust[num824].position + base.Center) / 2f;
						Main.dust[num824].noGravity = true;
						Dust dust2 = Main.dust[num824];
						dust2.velocity *= 0.1f;
						if (num823 == 1)
						{
							dust2 = Main.dust[num824];
							dust2.position += velocity / 2f;
						}
						float num825 = (800f - this.ai[0]) / 800f;
						dust2 = Main.dust[num824];
						dust2.scale *= num825 + 0.1f;
					}
				}
				velocity.Y += 0.008f;
			}
			else if (aiStyle == 97)
			{
				frameCounter++;
				float num826 = 4f;
				if ((float)frameCounter < num826 * 1f)
				{
					frame = 0;
				}
				else if ((float)frameCounter < num826 * 2f)
				{
					frame = 1;
				}
				else if ((float)frameCounter < num826 * 3f)
				{
					frame = 2;
				}
				else if ((float)frameCounter < num826 * 4f)
				{
					frame = 3;
				}
				else if ((float)frameCounter < num826 * 5f)
				{
					frame = 4;
				}
				else if ((float)frameCounter < num826 * 6f)
				{
					frame = 3;
				}
				else if ((float)frameCounter < num826 * 7f)
				{
					frame = 2;
				}
				else if ((float)frameCounter < num826 * 8f)
				{
					frame = 1;
				}
				else
				{
					frameCounter = 0;
					frame = 0;
				}
				Main.CurrentFrameFlags.HadAnActiveInteractibleProjectile = true;
				if (owner == Main.myPlayer)
				{
					for (int num827 = 0; num827 < 1000; num827++)
					{
						if (num827 != whoAmI && Main.projectile[num827].active && Main.projectile[num827].owner == owner && Main.projectile[num827].type == type)
						{
							if (timeLeft >= Main.projectile[num827].timeLeft)
							{
								Main.projectile[num827].Kill();
							}
							else
							{
								Kill();
							}
						}
					}
				}
				if (this.ai[0] == 0f)
				{
					if ((double)velocity.Length() < 0.1)
					{
						velocity.X = 0f;
						velocity.Y = 0f;
						this.ai[0] = 1f;
						this.ai[1] = 45f;
						return;
					}
					velocity *= 0.94f;
					if (velocity.X < 0f)
					{
						direction = -1;
					}
					else
					{
						direction = 1;
					}
					spriteDirection = direction;
					return;
				}
				if (Main.player[owner].Center.X < base.Center.X)
				{
					direction = -1;
				}
				else
				{
					direction = 1;
				}
				spriteDirection = direction;
				this.ai[1] += 1f;
				float num828 = 0.005f;
				if (this.ai[1] > 0f)
				{
					velocity.Y -= num828;
				}
				else
				{
					velocity.Y += num828;
				}
				if (this.ai[1] >= 90f)
				{
					this.ai[1] *= -1f;
				}
			}
			else if (aiStyle == 98)
			{
				Vector2 vector105 = new Vector2(this.ai[0], this.ai[1]);
				Vector2 value12 = vector105 - base.Center;
				if (value12.Length() < velocity.Length())
				{
					Kill();
					return;
				}
				value12.Normalize();
				value12 *= 15f;
				velocity = Vector2.Lerp(velocity, value12, 0.1f);
				for (int num829 = 0; num829 < 2; num829++)
				{
					int num830 = Dust.NewDust(base.Center, 0, 0, 228, 0f, 0f, 100);
					Main.dust[num830].noGravity = true;
					Dust dust2 = Main.dust[num830];
					dust2.position += new Vector2(4f);
					dust2 = Main.dust[num830];
					dust2.scale += Main.rand.NextFloat() * 1f;
				}
			}
			else if (aiStyle == 99 && type >= 556 && type <= 561)
			{
				AI_099_1();
			}
			else if (aiStyle == 99)
			{
				AI_099_2();
			}
			else if (aiStyle == 100)
			{
				AI_100_Medusa();
			}
			else if (aiStyle == 101)
			{
				float num831 = 20f;
				localAI[0]++;
				alpha = (int)MathHelper.Lerp(0f, 255f, localAI[0] / num831);
				int num832 = (int)this.ai[0];
				int num833 = -1;
				int num834 = -1;
				switch (type)
				{
				case 536:
					num833 = 535;
					num834 = 0;
					break;
				case 591:
					num834 = 1;
					break;
				}
				switch (num834)
				{
				case 1:
					if (localAI[0] >= num831 || num832 < 0 || num832 > 255 || !Main.player[num832].active || Main.player[num832].dead)
					{
						Kill();
						return;
					}
					if (type == 591)
					{
						base.position -= velocity;
						base.position += Main.player[owner].position - Main.player[owner].oldPosition;
						rotation = velocity.ToRotation() + MathF.PI / 2f;
						if (Math.Sign(velocity.X) != Math.Sign(Main.player[num832].velocity.X) && Main.player[num832].velocity.X != 0f)
						{
							Kill();
							return;
						}
					}
					else
					{
						base.Center = Main.player[num832].Center - velocity;
					}
					break;
				case 0:
					if (localAI[0] >= num831 || num832 < 0 || num832 > 1000 || !Main.projectile[num832].active || Main.projectile[num832].type != num833)
					{
						Kill();
						return;
					}
					base.Center = Main.projectile[num832].Center - velocity;
					break;
				}
				rotation = velocity.ToRotation() + MathF.PI / 2f;
			}
			else if (aiStyle == 102)
			{
				int num835 = 0;
				float num836 = 0f;
				float x5 = 0f;
				float y4 = 0f;
				int num837 = -1;
				int num838 = 0;
				float num839 = 0f;
				bool flag40 = true;
				bool flag41 = false;
				bool flag42 = false;
				switch (type)
				{
				case 539:
					num835 = 407;
					num836 = 210f;
					x5 = 0.15f;
					y4 = 0.075f;
					num839 = 16f;
					break;
				case 573:
					num835 = 424;
					num836 = 90f;
					num839 = 20f;
					flag40 = false;
					flag41 = true;
					break;
				case 574:
					num835 = 420;
					num836 = 180f;
					x5 = 0.15f;
					y4 = 0.075f;
					num839 = 8f;
					flag40 = false;
					num837 = 576;
					num838 = 65;
					if (Main.expertMode)
					{
						num838 = 50;
					}
					flag42 = true;
					break;
				}
				if (flag42)
				{
					int num840 = (int)this.ai[1];
					if (!Main.npc[num840].active || Main.npc[num840].type != num835)
					{
						Kill();
						return;
					}
					timeLeft = 2;
				}
				this.ai[0]++;
				if (this.ai[0] < num836)
				{
					bool flag43 = true;
					int num841 = (int)this.ai[1];
					if (Main.npc[num841].active && Main.npc[num841].type == num835)
					{
						if (!flag41 && Main.npc[num841].oldPos[1] != Vector2.Zero)
						{
							base.position += Main.npc[num841].position - Main.npc[num841].oldPos[1];
						}
					}
					else
					{
						this.ai[0] = num836;
						flag43 = false;
					}
					if (flag43 && !flag41)
					{
						velocity += new Vector2(Math.Sign(Main.npc[num841].Center.X - base.Center.X), Math.Sign(Main.npc[num841].Center.Y - base.Center.Y)) * new Vector2(x5, y4);
						if (velocity.Length() > 6f)
						{
							velocity *= 6f / velocity.Length();
						}
					}
					if (type == 539)
					{
						if (Main.rand.Next(12) == 0)
						{
							int num842 = Dust.NewDust(base.Center, 8, 8, 180);
							Main.dust[num842].position = base.Center;
							Dust dust2 = Main.dust[num842];
							dust2.velocity *= 0.2f;
							Main.dust[num842].noGravity = true;
						}
						if (++frameCounter >= 4)
						{
							frameCounter = 0;
							if (++frame >= Main.projFrames[type])
							{
								frame = 0;
							}
						}
						rotation = velocity.X * 0.1f;
					}
					if (type == 573)
					{
						if (Main.rand.Next(2) == 0)
						{
							int num843 = Dust.NewDust(base.Center, 8, 8, 242);
							Main.dust[num843].position = base.Center;
							Main.dust[num843].velocity = velocity;
							Main.dust[num843].noGravity = true;
							Main.dust[num843].scale = 1.5f;
						}
						alpha = 255;
					}
					if (type == 574)
					{
						if (Main.rand.Next(10) == 0)
						{
							int num844 = Dust.NewDust(base.Center, 8, 8, 242);
							Main.dust[num844].position = base.Center;
							Main.dust[num844].velocity = velocity;
							Main.dust[num844].noGravity = true;
							Main.dust[num844].scale = 1.5f;
						}
						if (flag43)
						{
							int target2 = Main.npc[num841].target;
							float num845 = velocity.ToRotation();
							if (Collision.CanHitLine(base.Center, 0, 0, Main.player[target2].Center, 0, 0))
							{
								num845 = DirectionTo(Main.player[target2].Center).ToRotation();
							}
							rotation = rotation.AngleLerp(num845 + MathF.PI / 2f, 0.2f);
						}
						frame = 1;
					}
				}
				if (this.ai[0] == num836)
				{
					bool flag44 = true;
					int num846 = -1;
					if (!flag40)
					{
						int num847 = (int)this.ai[1];
						if (Main.npc[num847].active && Main.npc[num847].type == num835)
						{
							num846 = Main.npc[num847].target;
						}
						else
						{
							flag44 = false;
						}
					}
					else
					{
						flag44 = false;
					}
					if (!flag44)
					{
						num846 = Player.FindClosest(base.position, width, height);
					}
					Vector2 value13 = Main.player[num846].Center - base.Center;
					value13.X += Main.rand.Next(-50, 51);
					value13.Y += Main.rand.Next(-50, 51);
					value13.X *= (float)Main.rand.Next(80, 121) * 0.01f;
					value13.Y *= (float)Main.rand.Next(80, 121) * 0.01f;
					Vector2 vector106 = Vector2.Normalize(value13);
					if (vector106.HasNaNs())
					{
						vector106 = Vector2.UnitY;
					}
					if (num837 == -1)
					{
						velocity = vector106 * num839;
						netUpdate = true;
					}
					else
					{
						if (Main.netMode != 1 && Collision.CanHitLine(base.Center, 0, 0, Main.player[num846].Center, 0, 0))
						{
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector106.X * num839, vector106.Y * num839, num837, num838, 1f, Main.myPlayer);
						}
						this.ai[0] = 0f;
					}
				}
				if (!(this.ai[0] >= num836))
				{
					return;
				}
				rotation = rotation.AngleLerp(velocity.ToRotation() + MathF.PI / 2f, 0.4f);
				if (type == 539)
				{
					if (++frameCounter >= 2)
					{
						frameCounter = 0;
						if (++frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
					if (Main.rand.Next(2) == 0)
					{
						int num848 = Dust.NewDust(base.position, width, height, 180, 0f, 0f, 100);
						Dust dust2 = Main.dust[num848];
						dust2.scale += (float)Main.rand.Next(50) * 0.01f;
						Main.dust[num848].noGravity = true;
						dust2 = Main.dust[num848];
						dust2.velocity *= 0.1f;
						Main.dust[num848].fadeIn = Main.rand.NextFloat() * 1.5f;
					}
					if (Main.rand.Next(3) == 0)
					{
						int num849 = Dust.NewDust(base.position, width, height, 176, 0f, 0f, 100);
						Dust dust2 = Main.dust[num849];
						dust2.scale += 0.3f + (float)Main.rand.Next(50) * 0.01f;
						Main.dust[num849].noGravity = true;
						dust2 = Main.dust[num849];
						dust2.velocity *= 0.1f;
						Main.dust[num849].fadeIn = Main.rand.NextFloat() * 1.5f;
					}
				}
				if (type == 573)
				{
					if (Main.rand.Next(4) == 0)
					{
						int num850 = Dust.NewDust(base.Center, 8, 8, 242);
						Main.dust[num850].position = base.Center;
						Dust dust2 = Main.dust[num850];
						dust2.velocity *= 0.2f;
						Main.dust[num850].noGravity = true;
						Main.dust[num850].scale = 1.5f;
					}
					alpha = 0;
				}
			}
			else if (aiStyle == 103)
			{
				scale = this.ai[1];
				this.ai[0]++;
				if (this.ai[0] >= 30f)
				{
					alpha += 25;
					if (alpha >= 250)
					{
						Kill();
					}
				}
				else
				{
					if (!(this.ai[0] >= 0f))
					{
						return;
					}
					alpha -= 25;
					if (alpha < 0)
					{
						alpha = 0;
						if (localAI[1] == 0f && Main.netMode != 1 && localAI[0] != 0f)
						{
							localAI[1] = 1f;
							NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Bottom.Y, (int)localAI[0]);
						}
					}
				}
			}
			else if (aiStyle == 104)
			{
				if (this.ai[0] == 1f)
				{
					scale *= 0.995f;
					alpha += 3;
					if (alpha >= 250)
					{
						Kill();
					}
				}
				else
				{
					scale *= 1.01f;
					alpha -= 7;
					if (alpha < 0)
					{
						alpha = 0;
						this.ai[0] = 1f;
					}
				}
				frameCounter++;
				if (frameCounter > 6)
				{
					frameCounter = 0;
					frame++;
					if (frame > 3)
					{
						frame = 0;
					}
				}
				velocity.Y -= 0.03f;
				velocity.X *= 0.97f;
			}
			else if (aiStyle == 105)
			{
				float num851 = 1f - (float)alpha / 255f;
				num851 *= scale;
				Lighting.AddLight(base.Center, 0.2f * num851, 0.275f * num851, 0.075f * num851);
				localAI[0] += 1f;
				if (localAI[0] >= 90f)
				{
					localAI[0] *= -1f;
				}
				if (localAI[0] >= 0f)
				{
					scale += 0.003f;
				}
				else
				{
					scale -= 0.003f;
				}
				rotation += 0.0025f * scale;
				float num852 = 1f;
				float num853 = 1f;
				if (identity % 6 == 0)
				{
					num853 *= -1f;
				}
				if (identity % 6 == 1)
				{
					num852 *= -1f;
				}
				if (identity % 6 == 2)
				{
					num853 *= -1f;
					num852 *= -1f;
				}
				if (identity % 6 == 3)
				{
					num853 = 0f;
				}
				if (identity % 6 == 4)
				{
					num852 = 0f;
				}
				localAI[1] += 1f;
				if (localAI[1] > 60f)
				{
					localAI[1] = -180f;
				}
				if (localAI[1] >= -60f)
				{
					velocity.X += 0.002f * num853;
					velocity.Y += 0.002f * num852;
				}
				else
				{
					velocity.X -= 0.002f * num853;
					velocity.Y -= 0.002f * num852;
				}
				this.ai[0] += 1f;
				if (this.ai[0] > 5400f)
				{
					damage = 0;
					this.ai[1] = 1f;
					if (alpha < 255)
					{
						alpha += 5;
						if (alpha > 255)
						{
							alpha = 255;
						}
					}
					else if (owner == Main.myPlayer)
					{
						Kill();
					}
				}
				else
				{
					float num854 = (base.Center - Main.player[owner].Center).Length() / 100f;
					if (num854 > 4f)
					{
						num854 *= 1.1f;
					}
					if (num854 > 5f)
					{
						num854 *= 1.2f;
					}
					if (num854 > 6f)
					{
						num854 *= 1.3f;
					}
					if (num854 > 7f)
					{
						num854 *= 1.4f;
					}
					if (num854 > 8f)
					{
						num854 *= 1.5f;
					}
					if (num854 > 9f)
					{
						num854 *= 1.6f;
					}
					if (num854 > 10f)
					{
						num854 *= 1.7f;
					}
					if (!Main.player[owner].sporeSac)
					{
						num854 += 100f;
					}
					this.ai[0] += num854;
					if (alpha > 50)
					{
						alpha -= 10;
						if (alpha < 50)
						{
							alpha = 50;
						}
					}
				}
				bool flag45 = false;
				Vector2 vector107 = new Vector2(0f, 0f);
				float num855 = 340f;
				for (int num856 = 0; num856 < 200; num856++)
				{
					if (Main.npc[num856].CanBeChasedBy(this))
					{
						float num857 = Main.npc[num856].position.X + (float)(Main.npc[num856].width / 2);
						float num858 = Main.npc[num856].position.Y + (float)(Main.npc[num856].height / 2);
						float num859 = Math.Abs(base.position.X + (float)(width / 2) - num857) + Math.Abs(base.position.Y + (float)(height / 2) - num858);
						if (num859 < num855)
						{
							num855 = num859;
							vector107 = Main.npc[num856].Center;
							flag45 = true;
						}
					}
				}
				if (flag45)
				{
					Vector2 vector108 = vector107 - base.Center;
					vector108.Normalize();
					vector108 *= 4f;
					velocity = (velocity * 40f + vector108) / 41f;
				}
				else if ((double)velocity.Length() > 0.2)
				{
					velocity *= 0.98f;
				}
			}
			else if (aiStyle == 106)
			{
				rotation += velocity.X * 0.02f;
				if (velocity.X < 0f)
				{
					rotation -= Math.Abs(velocity.Y) * 0.02f;
				}
				else
				{
					rotation += Math.Abs(velocity.Y) * 0.02f;
				}
				velocity *= 0.98f;
				this.ai[0] += 1f;
				if (this.ai[0] >= 60f)
				{
					if (alpha < 255)
					{
						alpha += 5;
						if (alpha > 255)
						{
							alpha = 255;
						}
					}
					else if (owner == Main.myPlayer)
					{
						Kill();
					}
				}
				else if (alpha > 80)
				{
					alpha -= 30;
					if (alpha < 80)
					{
						alpha = 80;
					}
				}
			}
			else if (aiStyle == 107)
			{
				float num860 = 10f;
				float num861 = 5f;
				float num862 = 40f;
				if (type == 575)
				{
					if (timeLeft > 30 && alpha > 0)
					{
						alpha -= 25;
					}
					if (timeLeft > 30 && alpha < 128 && Collision.SolidCollision(base.position, width, height))
					{
						alpha = 128;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (++frameCounter > 4)
					{
						frameCounter = 0;
						if (++frame >= 4)
						{
							frame = 0;
						}
					}
					Lighting.AddLight(base.Center, 0.5f, 0.1f, 0.3f);
				}
				else if (type == 596)
				{
					num860 = 10f;
					num861 = 7.5f;
					if (timeLeft > 30 && alpha > 0)
					{
						alpha -= 25;
					}
					if (timeLeft > 30 && alpha < 128 && Collision.SolidCollision(base.position, width, height))
					{
						alpha = 128;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (++frameCounter > 4)
					{
						frameCounter = 0;
						if (++frame >= 4)
						{
							frame = 0;
						}
					}
					float num863 = 0.5f;
					if (timeLeft < 120)
					{
						num863 = 1.1f;
					}
					if (timeLeft < 60)
					{
						num863 = 1.6f;
					}
					this.ai[1]++;
					float num864 = this.ai[1] / 180f * (MathF.PI * 2f);
					for (float num865 = 0f; num865 < 3f; num865++)
					{
						if (Main.rand.Next(3) != 0)
						{
							return;
						}
						Dust dust22 = Main.dust[Dust.NewDust(base.Center, 0, 0, 27, 0f, -2f)];
						dust22.position = base.Center + Vector2.UnitY.RotatedBy(num865 * (MathF.PI * 2f) / 3f + this.ai[1]) * 10f;
						dust22.noGravity = true;
						dust22.velocity = DirectionFrom(dust22.position);
						dust22.scale = num863;
						dust22.fadeIn = 0.5f;
						dust22.alpha = 200;
					}
					if (timeLeft < 4)
					{
						int num866 = 30;
						if (Main.expertMode)
						{
							num866 = 22;
						}
						base.position = base.Center;
						width = (height = 60);
						base.Center = base.position;
						damage = num866;
						for (int num867 = 0; num867 < 10; num867++)
						{
							Dust dust22 = Main.dust[Dust.NewDust(base.position, width, height, Utils.SelectRandom<int>(Main.rand, 27, 6), 0f, -2f)];
							dust22.noGravity = true;
							if (dust22.position != base.Center)
							{
								dust22.velocity = DirectionTo(dust22.position) * 3f;
							}
						}
					}
				}
				int num868 = (int)this.ai[0];
				if (num868 >= 0 && Main.player[num868].active && !Main.player[num868].dead)
				{
					if (Distance(Main.player[num868].Center) > num862)
					{
						Vector2 vector109 = DirectionTo(Main.player[num868].Center);
						if (vector109.HasNaNs())
						{
							vector109 = Vector2.UnitY;
						}
						velocity = (velocity * (num860 - 1f) + vector109 * num861) / num860;
					}
				}
				else
				{
					if (timeLeft > 30)
					{
						timeLeft = 30;
					}
					if (this.ai[0] != -1f)
					{
						this.ai[0] = -1f;
						netUpdate = true;
					}
				}
			}
			else if (aiStyle == 108)
			{
				bool flag46 = type == 579 || type == 578;
				if (flag46 && this.ai[1] == 1f && Main.netMode != 2)
				{
					this.ai[1] = 0f;
					for (int num869 = 0; num869 < 25; num869++)
					{
						int num870 = Utils.SelectRandom<int>(Main.rand, 229, 229, 161);
						Dust dust23 = Main.dust[Dust.NewDust(base.position, width, height, num870)];
						dust23.noGravity = true;
						dust23.scale = 1.75f + Main.rand.NextFloat() * 1.25f;
						dust23.fadeIn = 0.25f;
						Dust dust2 = dust23;
						dust2.velocity *= 3.5f + Main.rand.NextFloat() * 0.5f;
						dust23.noLight = true;
					}
				}
				if (flag46 && localAI[1] == 0f)
				{
					localAI[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item117, base.position);
				}
				if (type == 578 && localAI[0] == 0f)
				{
					localAI[0] = 1f;
					int num871 = Player.FindClosest(base.Center, 0, 0);
					Vector2 vector110 = Main.player[num871].Center - base.Center;
					if (vector110 == Vector2.Zero)
					{
						vector110 = Vector2.UnitY;
					}
					this.ai[1] = vector110.ToRotation();
					netUpdate = true;
				}
				this.ai[0]++;
				if (this.ai[0] <= 50f)
				{
					if (type == 579)
					{
						if (Main.rand.Next(4) == 0)
						{
							Vector2 vector111 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust24 = Main.dust[Dust.NewDust(base.Center - vector111 * 30f, 0, 0, 229)];
							dust24.noGravity = true;
							dust24.position = base.Center - vector111 * Main.rand.Next(10, 21);
							dust24.velocity = vector111.RotatedBy(1.5707963705062866) * 4f;
							dust24.scale = 0.5f + Main.rand.NextFloat();
							dust24.fadeIn = 0.5f;
						}
						if (Main.rand.Next(4) == 0)
						{
							Vector2 vector112 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust25 = Main.dust[Dust.NewDust(base.Center - vector112 * 30f, 0, 0, 240)];
							dust25.noGravity = true;
							dust25.position = base.Center - vector112 * 30f;
							dust25.velocity = vector112.RotatedBy(-1.5707963705062866) * 2f;
							dust25.scale = 0.5f + Main.rand.NextFloat();
							dust25.fadeIn = 0.5f;
						}
					}
					if (type == 578 && Main.rand.Next(2) == 0)
					{
						Vector2 vector113 = this.ai[1].ToRotationVector2();
						Vector2 vector114 = vector113.RotatedBy(1.5707963705062866) * (Main.rand.Next(2) == 0).ToDirectionInt() * Main.rand.Next(10, 21);
						Vector2 vector115 = vector113 * Main.rand.Next(-80, 81);
						Vector2 vector116 = vector115 - vector114;
						vector116 /= 10f;
						int num872 = 229;
						Dust dust26 = Main.dust[Dust.NewDust(base.Center, 0, 0, num872)];
						dust26.noGravity = true;
						dust26.position = base.Center + vector114;
						dust26.velocity = vector116;
						dust26.scale = 0.5f + Main.rand.NextFloat();
						dust26.fadeIn = 0.5f;
						vector115 = vector113 * Main.rand.Next(40, 121);
						vector116 = vector115 - vector114 / 2f;
						vector116 /= 10f;
						dust26 = Main.dust[Dust.NewDust(base.Center, 0, 0, num872)];
						dust26.noGravity = true;
						dust26.position = base.Center + vector114 / 2f;
						dust26.velocity = vector116;
						dust26.scale = 1f + Main.rand.NextFloat();
					}
					if (type == 813)
					{
						if (Main.rand.Next(4) == 0)
						{
							Vector2 vector117 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust27 = Main.dust[Dust.NewDust(base.Center - vector117 * 30f, 0, 0, 5)];
							dust27.noGravity = true;
							dust27.position = base.Center - vector117 * Main.rand.Next(10, 21);
							dust27.velocity = vector117.RotatedBy(1.5707963705062866) * 4f;
							dust27.scale = 0.5f + Main.rand.NextFloat();
							dust27.fadeIn = 0.5f;
						}
						if (Main.rand.Next(4) == 0)
						{
							Vector2 vector118 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust28 = Main.dust[Dust.NewDust(base.Center - vector118 * 30f, 0, 0, 240)];
							dust28.noGravity = true;
							dust28.position = base.Center - vector118 * 30f;
							dust28.velocity = vector118.RotatedBy(-1.5707963705062866) * 2f;
							dust28.scale = 0.5f + Main.rand.NextFloat();
							dust28.fadeIn = 0.5f;
						}
					}
				}
				else if (this.ai[0] <= 90f)
				{
					if (this.ai[0] == 90f)
					{
						if (flag46)
						{
							SoundEngine.PlaySound(SoundID.Item113, base.position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item8, base.position);
						}
					}
					scale = (this.ai[0] - 50f) / 40f;
					alpha = 255 - (int)(255f * scale);
					rotation -= MathF.PI / 20f;
					if (type == 579)
					{
						if (Main.rand.Next(2) == 0)
						{
							Vector2 vector119 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust29 = Main.dust[Dust.NewDust(base.Center - vector119 * 30f, 0, 0, 229)];
							dust29.noGravity = true;
							dust29.position = base.Center - vector119 * Main.rand.Next(10, 21);
							dust29.velocity = vector119.RotatedBy(1.5707963705062866) * 6f;
							dust29.scale = 0.5f + Main.rand.NextFloat();
							dust29.fadeIn = 0.5f;
							dust29.customData = base.Center;
						}
						if (Main.rand.Next(2) == 0)
						{
							Vector2 vector120 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust30 = Main.dust[Dust.NewDust(base.Center - vector120 * 30f, 0, 0, 240)];
							dust30.noGravity = true;
							dust30.position = base.Center - vector120 * 30f;
							dust30.velocity = vector120.RotatedBy(-1.5707963705062866) * 3f;
							dust30.scale = 0.5f + Main.rand.NextFloat();
							dust30.fadeIn = 0.5f;
							dust30.customData = base.Center;
						}
					}
					if (type == 578)
					{
						Vector2 vector121 = this.ai[1].ToRotationVector2();
						Vector2 vector122 = vector121.RotatedBy(1.5707963705062866) * (Main.rand.Next(2) == 0).ToDirectionInt() * Main.rand.Next(10, 21);
						vector121 *= (float)Main.rand.Next(-80, 81);
						Vector2 vector123 = vector121 - vector122;
						vector123 /= 10f;
						int num873 = Utils.SelectRandom<int>(Main.rand, 229, 229);
						Dust dust31 = Main.dust[Dust.NewDust(base.Center, 0, 0, num873)];
						dust31.noGravity = true;
						dust31.position = base.Center + vector122;
						dust31.velocity = vector123;
						dust31.scale = 0.5f + Main.rand.NextFloat();
						dust31.fadeIn = 0.5f;
						if (this.ai[0] == 90f && Main.netMode != 1)
						{
							Vector2 vector124 = this.ai[1].ToRotationVector2() * 8f;
							float ai2 = Main.rand.Next(80);
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X - vector124.X, base.Center.Y - vector124.Y, vector124.X, vector124.Y, 580, 50, 1f, Main.myPlayer, this.ai[1], ai2);
						}
					}
					else if (type == 579)
					{
						if (this.ai[0] == 90f && Main.netMode != 1)
						{
							this.ai[1] = 1f;
							netUpdate = true;
							for (int num874 = 0; num874 < 2; num874++)
							{
								int num875 = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 427, whoAmI);
								Main.npc[num875].velocity = -Vector2.UnitY.RotatedByRandom(6.2831854820251465) * Main.rand.Next(4, 9) - Vector2.UnitY * 2f;
								Main.npc[num875].netUpdate = true;
							}
						}
					}
					else if (type == 813)
					{
						if (Main.rand.Next(2) == 0)
						{
							Vector2 vector125 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust32 = Main.dust[Dust.NewDust(base.Center - vector125 * 30f, 0, 0, 5)];
							dust32.noGravity = true;
							dust32.position = base.Center - vector125 * Main.rand.Next(10, 21);
							dust32.velocity = vector125.RotatedBy(1.5707963705062866) * 6f;
							dust32.scale = 0.5f + Main.rand.NextFloat();
							dust32.fadeIn = 0.5f;
							dust32.customData = base.Center;
						}
						if (Main.rand.Next(2) == 0)
						{
							Vector2 vector126 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust33 = Main.dust[Dust.NewDust(base.Center - vector126 * 30f, 0, 0, 240)];
							dust33.noGravity = true;
							dust33.position = base.Center - vector126 * 30f;
							dust33.velocity = vector126.RotatedBy(-1.5707963705062866) * 3f;
							dust33.scale = 0.5f + Main.rand.NextFloat();
							dust33.fadeIn = 0.5f;
							dust33.customData = base.Center;
						}
						if (this.ai[0] == 90f && Main.netMode != 1)
						{
							int num876 = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, 619, whoAmI);
							Main.npc[num876].netUpdate = true;
						}
					}
				}
				else if (this.ai[0] <= 120f)
				{
					scale = 1f;
					alpha = 0;
					rotation -= MathF.PI / 60f;
					if (type == 813)
					{
						if (Main.rand.Next(2) == 0)
						{
							Vector2 vector127 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust34 = Main.dust[Dust.NewDust(base.Center - vector127 * 30f, 0, 0, 5)];
							dust34.noGravity = true;
							dust34.position = base.Center - vector127 * Main.rand.Next(10, 21);
							dust34.velocity = vector127.RotatedBy(1.5707963705062866) * 6f;
							dust34.scale = 0.5f + Main.rand.NextFloat();
							dust34.fadeIn = 0.5f;
							dust34.customData = base.Center;
						}
						else
						{
							Vector2 vector128 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust35 = Main.dust[Dust.NewDust(base.Center - vector128 * 30f, 0, 0, 240)];
							dust35.noGravity = true;
							dust35.position = base.Center - vector128 * 30f;
							dust35.velocity = vector128.RotatedBy(-1.5707963705062866) * 3f;
							dust35.scale = 0.5f + Main.rand.NextFloat();
							dust35.fadeIn = 0.5f;
							dust35.customData = base.Center;
						}
					}
					else if (Main.rand.Next(2) == 0)
					{
						Vector2 vector129 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust36 = Main.dust[Dust.NewDust(base.Center - vector129 * 30f, 0, 0, 229)];
						dust36.noGravity = true;
						dust36.position = base.Center - vector129 * Main.rand.Next(10, 21);
						dust36.velocity = vector129.RotatedBy(1.5707963705062866) * 6f;
						dust36.scale = 0.5f + Main.rand.NextFloat();
						dust36.fadeIn = 0.5f;
						dust36.customData = base.Center;
					}
					else
					{
						Vector2 vector130 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust37 = Main.dust[Dust.NewDust(base.Center - vector130 * 30f, 0, 0, 240)];
						dust37.noGravity = true;
						dust37.position = base.Center - vector130 * 30f;
						dust37.velocity = vector130.RotatedBy(-1.5707963705062866) * 3f;
						dust37.scale = 0.5f + Main.rand.NextFloat();
						dust37.fadeIn = 0.5f;
						dust37.customData = base.Center;
					}
				}
				else
				{
					scale = 1f - (this.ai[0] - 120f) / 60f;
					alpha = 255 - (int)(255f * scale);
					rotation -= MathF.PI / 30f;
					if (alpha >= 255)
					{
						Kill();
					}
					if (type == 813)
					{
						for (int num877 = 0; num877 < 2; num877++)
						{
							switch (Main.rand.Next(3))
							{
							case 0:
							{
								Vector2 vector132 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * scale;
								Dust dust39 = Main.dust[Dust.NewDust(base.Center - vector132 * 30f, 0, 0, 5)];
								dust39.noGravity = true;
								dust39.position = base.Center - vector132 * Main.rand.Next(10, 21);
								dust39.velocity = vector132.RotatedBy(1.5707963705062866) * 6f;
								dust39.scale = 0.5f + Main.rand.NextFloat();
								dust39.fadeIn = 0.5f;
								dust39.customData = base.Center;
								break;
							}
							case 1:
							{
								Vector2 vector131 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * scale;
								Dust dust38 = Main.dust[Dust.NewDust(base.Center - vector131 * 30f, 0, 0, 240)];
								dust38.noGravity = true;
								dust38.position = base.Center - vector131 * 30f;
								dust38.velocity = vector131.RotatedBy(-1.5707963705062866) * 3f;
								dust38.scale = 0.5f + Main.rand.NextFloat();
								dust38.fadeIn = 0.5f;
								dust38.customData = base.Center;
								break;
							}
							}
						}
					}
					else
					{
						for (int num878 = 0; num878 < 2; num878++)
						{
							switch (Main.rand.Next(3))
							{
							case 0:
							{
								Vector2 vector134 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * scale;
								Dust dust41 = Main.dust[Dust.NewDust(base.Center - vector134 * 30f, 0, 0, 229)];
								dust41.noGravity = true;
								dust41.position = base.Center - vector134 * Main.rand.Next(10, 21);
								dust41.velocity = vector134.RotatedBy(1.5707963705062866) * 6f;
								dust41.scale = 0.5f + Main.rand.NextFloat();
								dust41.fadeIn = 0.5f;
								dust41.customData = base.Center;
								break;
							}
							case 1:
							{
								Vector2 vector133 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * scale;
								Dust dust40 = Main.dust[Dust.NewDust(base.Center - vector133 * 30f, 0, 0, 240)];
								dust40.noGravity = true;
								dust40.position = base.Center - vector133 * 30f;
								dust40.velocity = vector133.RotatedBy(-1.5707963705062866) * 3f;
								dust40.scale = 0.5f + Main.rand.NextFloat();
								dust40.fadeIn = 0.5f;
								dust40.customData = base.Center;
								break;
							}
							}
						}
					}
				}
				if (type == 813 && Main.rand.NextFloat() < Opacity)
				{
					Dust dust42 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(3f, 20f), 90);
					dust42.velocity = Vector2.UnitY;
					dust42.noGravity = true;
					dust42.scale = scale;
				}
			}
			else if (aiStyle == 109)
			{
				if (localAI[1] == 0f)
				{
					localAI[1] = velocity.Length();
				}
				if (this.ai[0] == 0f)
				{
					localAI[0]++;
					if (localAI[0] > 30f)
					{
						this.ai[0] = 1f;
						localAI[0] = 0f;
						return;
					}
				}
				else if (this.ai[0] == 1f)
				{
					Vector2 zero3 = Vector2.Zero;
					if (type != 582 || !Main.npc[(int)this.ai[1]].active || Main.npc[(int)this.ai[1]].type != 124)
					{
						Kill();
						return;
					}
					NPC.lazyNPCOwnedProjectileSearchArray[(int)this.ai[1]] = whoAmI;
					zero3 = Main.npc[(int)this.ai[1]].Center;
					tileCollide = false;
					float num879 = localAI[1];
					Vector2 value14 = zero3 - base.Center;
					if (value14.Length() < num879)
					{
						Kill();
						return;
					}
					value14.Normalize();
					value14 *= num879;
					velocity = Vector2.Lerp(velocity, value14, 0.04f);
				}
				rotation += MathF.PI / 10f;
			}
			else if (aiStyle == 110)
			{
				if (localAI[1] == 0f)
				{
					localAI[1] = velocity.Length();
				}
				Vector2 zero4 = Vector2.Zero;
				if (Main.npc[(int)this.ai[0]].active && Main.npc[(int)this.ai[0]].townNPC)
				{
					zero4 = Main.npc[(int)this.ai[0]].Center;
					float num880 = localAI[1];
					Vector2 value15 = zero4 - base.Center;
					if (value15.Length() < num880 || base.Hitbox.Intersects(Main.npc[(int)this.ai[0]].Hitbox))
					{
						Kill();
						int num881 = Main.npc[(int)this.ai[0]].lifeMax - Main.npc[(int)this.ai[0]].life;
						if (num881 > 20)
						{
							num881 = 20;
						}
						if (num881 > 0)
						{
							NPC nPC11 = Main.npc[(int)this.ai[0]];
							nPC11.life += num881;
							Main.npc[(int)this.ai[0]].HealEffect(num881);
						}
					}
					else
					{
						value15.Normalize();
						value15 *= num880;
						if (value15.Y < velocity.Y)
						{
							value15.Y = velocity.Y;
						}
						value15.Y += 1f;
						velocity = Vector2.Lerp(velocity, value15, 0.04f);
						rotation += velocity.X * 0.05f;
					}
				}
				else
				{
					Kill();
				}
			}
			else if (aiStyle == 111)
			{
				AI_111_DryadsWard();
			}
			else if (aiStyle == 112)
			{
				if (type == 836)
				{
					if (localAI[0] == 0f)
					{
						localAI[0] = 1f;
						for (int num882 = 0; num882 < 3; num882++)
						{
							int num883 = Dust.NewDust(base.position, width, height, 31, 0f, 0f, 50, Color.White, 1.2f);
							Dust dust2 = Main.dust[num883];
							dust2.velocity *= 0.3f;
							Main.dust[num883].noGravity = true;
						}
					}
					if (++frameCounter >= 6)
					{
						frameCounter = 0;
						if (++frame >= 4)
						{
							frame = 0;
						}
					}
					Player player9 = Main.player[(int)this.ai[1]];
					bool flag47 = player9.active && !player9.dead && Vector2.Distance(player9.Center, base.Center) < 800f;
					int num884 = (spriteDirection = ((Main.WindForVisuals > 0f) ? 1 : (-1)));
					direction = ((player9.Center.X > base.Center.X) ? 1 : (-1));
					bool flag48 = num884 != direction;
					float num885 = 2.5f;
					float num886 = 2f;
					if (flag48)
					{
						num885 = 1.5f;
						num886 = 1f;
					}
					if (flag47)
					{
						if (!flag48)
						{
							float num887 = player9.Center.X - base.Center.X;
							velocity.X += 0.05f * (float)direction * (0.6f + Math.Abs(Main.WindForVisuals));
							if (velocity.X > num885)
							{
								velocity.X -= 0.1f;
							}
							if (velocity.X < 0f - num885)
							{
								velocity.X += 0.1f;
							}
						}
						if (player9.Top.Y >= base.Center.Y || flag48)
						{
							velocity.Y += 0.05f;
							if (velocity.Y > num885)
							{
								velocity.Y -= 0.1f;
							}
						}
						else if (player9.Top.Y < base.Center.Y)
						{
							velocity.Y -= 0.1f;
							if (velocity.Y < 0f - num886)
							{
								velocity.Y += 0.2f;
							}
						}
					}
					else
					{
						velocity.Y += 0.2f;
						if (velocity.Y < 0f - num886)
						{
							velocity.Y += 0.2f;
						}
						if (velocity.Y > num886)
						{
							velocity.Y -= 0.2f;
						}
					}
					rotation = velocity.X * 0.125f;
				}
				if (type == 590)
				{
					if (++frameCounter >= 4)
					{
						int num888 = 0;
						int num889 = 3;
						if (this.ai[2] == 1f)
						{
							num888 = 3;
							num889 = 6;
						}
						frameCounter = 0;
						if (++frame >= num889)
						{
							frame = num888;
						}
					}
					if (alpha > 0)
					{
						alpha -= 15;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (alpha == 0)
					{
						float num890 = (float)Main.rand.Next(28, 42) * 0.005f;
						num890 += (float)(270 - Main.mouseTextColor) / 500f;
						float num891 = 0.1f;
						float num892 = 0.3f + num890 / 2f;
						float num893 = 0.6f + num890;
						float num894 = 0.35f;
						num891 *= num894;
						num892 *= num894;
						num893 *= num894;
						Lighting.AddLight(base.Center, num891, num892, num893);
					}
					velocity = new Vector2(0f, (float)Math.Sin(MathF.PI * 2f * this.ai[0] / 180f) * 0.15f);
					this.ai[0]++;
					if (this.ai[0] >= 180f)
					{
						this.ai[0] = 0f;
					}
				}
				if (type != 644)
				{
					return;
				}
				Color newColor3 = Main.hslToRgb(this.ai[0], 1f, 0.5f);
				int num895 = (int)this.ai[1];
				if (num895 < 0 || num895 >= 1000 || (!Main.projectile[num895].active && Main.projectile[num895].type != 643))
				{
					this.ai[1] = -1f;
				}
				else
				{
					DelegateMethods.v3_1 = newColor3.ToVector3() * 0.5f;
					Utils.PlotTileLine(base.Center, Main.projectile[num895].Center, 8f, DelegateMethods.CastLight);
				}
				if (localAI[0] == 0f)
				{
					localAI[0] = Main.rand.NextFloat() * 0.8f + 0.8f;
					direction = ((Main.rand.Next(2) > 0) ? 1 : (-1));
				}
				rotation = localAI[1] / 40f * (MathF.PI * 2f) * (float)direction;
				if (alpha > 0)
				{
					alpha -= 8;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha == 0)
				{
					Lighting.AddLight(base.Center, newColor3.ToVector3() * 0.5f);
				}
				for (int num896 = 0; num896 < 2; num896++)
				{
					if (Main.rand.Next(10) == 0)
					{
						Vector2 vector135 = Vector2.UnitY.RotatedBy((float)num896 * MathF.PI).RotatedBy(rotation);
						Dust dust43 = Main.dust[Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 225, newColor3, 1.5f)];
						dust43.noGravity = true;
						dust43.noLight = true;
						dust43.scale = Opacity * localAI[0];
						dust43.position = base.Center;
						dust43.velocity = vector135 * 2.5f;
					}
				}
				for (int num897 = 0; num897 < 2; num897++)
				{
					if (Main.rand.Next(10) == 0)
					{
						Vector2 vector136 = Vector2.UnitY.RotatedBy((float)num897 * MathF.PI);
						Dust dust44 = Main.dust[Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 225, newColor3, 1.5f)];
						dust44.noGravity = true;
						dust44.noLight = true;
						dust44.scale = Opacity * localAI[0];
						dust44.position = base.Center;
						dust44.velocity = vector136 * 2.5f;
					}
				}
				if (Main.rand.Next(10) == 0)
				{
					float num898 = 1f + Main.rand.NextFloat() * 2f;
					float fadeIn = 1f + Main.rand.NextFloat();
					float num899 = 1f + Main.rand.NextFloat();
					Vector2 vector137 = Utils.RandomVector2(Main.rand, -1f, 1f);
					if (vector137 != Vector2.Zero)
					{
						vector137.Normalize();
					}
					vector137 *= 20f + Main.rand.NextFloat() * 100f;
					Vector2 vec = base.Center + vector137;
					Point point3 = vec.ToTileCoordinates();
					bool flag49 = true;
					if (!WorldGen.InWorld(point3.X, point3.Y))
					{
						flag49 = false;
					}
					if (flag49 && WorldGen.SolidTile(point3.X, point3.Y))
					{
						flag49 = false;
					}
					if (flag49)
					{
						Dust dust45 = Main.dust[Dust.NewDust(vec, 0, 0, 267, 0f, 0f, 127, newColor3)];
						dust45.noGravity = true;
						dust45.position = vec;
						dust45.velocity = -Vector2.UnitY * num898 * (Main.rand.NextFloat() * 0.9f + 1.6f);
						dust45.fadeIn = fadeIn;
						dust45.scale = num899;
						dust45.noLight = true;
						if (dust45.dustIndex != 6000)
						{
							Dust dust46 = Dust.CloneDust(dust45);
							Dust dust2 = dust46;
							dust2.scale *= 0.65f;
							dust2 = dust46;
							dust2.fadeIn *= 0.65f;
							dust46.color = new Color(255, 255, 255, 255);
						}
					}
				}
				scale = Opacity / 2f * localAI[0];
				velocity = Vector2.Zero;
				localAI[1]++;
				if (localAI[1] >= 60f)
				{
					Kill();
				}
				if (localAI[1] == 30f)
				{
					DoRainbowCrystalStaffExplosion();
					if (Main.myPlayer == owner)
					{
						friendly = true;
						int num900 = width;
						int num901 = height;
						int num902 = penetrate;
						base.position = base.Center;
						width = (height = 60);
						base.Center = base.position;
						penetrate = -1;
						maxPenetrate = -1;
						Damage();
						penetrate = num902;
						base.position = base.Center;
						width = num900;
						height = num901;
						base.Center = base.position;
						friendly = false;
					}
				}
			}
			else if (aiStyle == 113)
			{
				int num903 = 25;
				if (type == 614)
				{
					num903 = 63;
				}
				if (alpha > 0)
				{
					alpha -= num903;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (this.ai[0] == 0f)
				{
					if (type == 614)
					{
						int num904 = (int)this.ai[1];
						if (!Main.npc[num904].CanBeChasedBy(this))
						{
							Kill();
							return;
						}
						float num905 = velocity.ToRotation();
						Vector2 vector138 = Main.npc[num904].Center - base.Center;
						if (vector138 != Vector2.Zero)
						{
							vector138.Normalize();
							vector138 *= 14f;
						}
						float num906 = 5f;
						velocity = (velocity * (num906 - 1f) + vector138) / num906;
					}
					else
					{
						this.ai[1]++;
						if (this.ai[1] >= 45f)
						{
							float num907 = 0.98f;
							float num908 = 0.35f;
							if (type == 636)
							{
								num907 = 0.995f;
								num908 = 0.15f;
							}
							this.ai[1] = 45f;
							velocity.X *= num907;
							velocity.Y += num908;
						}
						rotation = velocity.ToRotation() + MathF.PI / 2f;
					}
				}
				if (this.ai[0] == 1f)
				{
					Vector2 center16 = base.Center;
					ignoreWater = true;
					tileCollide = false;
					int num909 = 15;
					if (type == 636)
					{
						num909 = 5 * MaxUpdates;
					}
					if (type == 971)
					{
						num909 = 9 * MaxUpdates;
					}
					if (type == 975)
					{
						num909 = 9 * MaxUpdates;
					}
					bool flag50 = false;
					bool flag51 = false;
					localAI[0]++;
					if (localAI[0] % 30f == 0f)
					{
						flag51 = true;
					}
					int num910 = (int)this.ai[1];
					if (localAI[0] >= (float)(60 * num909))
					{
						flag50 = true;
					}
					else if (num910 < 0 || num910 >= 200)
					{
						flag50 = true;
					}
					else if (Main.npc[num910].active && !Main.npc[num910].dontTakeDamage)
					{
						base.Center = Main.npc[num910].Center - velocity * 2f;
						gfxOffY = Main.npc[num910].gfxOffY;
						if (flag51)
						{
							Main.npc[num910].HitEffect(0, 1.0);
						}
					}
					else
					{
						flag50 = true;
					}
					if (flag50)
					{
						Kill();
					}
					if (!flag50 && type == 971)
					{
						if (num910 > 0 && num910 < 200 && timeLeft % 2 == 0)
						{
							Vector2 vector139 = center16 - velocity.SafeNormalize(Vector2.Zero) * 8f;
							Vector2 value16 = Main.npc[num910].velocity + new Vector2(Main.rand.NextFloatDirection() * 0.35f, 2.5f);
							Dust dust47 = Dust.NewDustPerfect(vector139, 4, value16, 0, new Color(120, 50, 120), 0.65f);
							dust47.fadeIn = 0.25f;
							dust47.noGravity = true;
						}
						if (localAI[1] == 0f)
						{
							localAI[1] = 1f;
							rotation = velocity.ToRotation() + MathF.PI / 2f;
						}
					}
					if (!flag50 && type == 975)
					{
						if (num910 > 0 && num910 < 200 && timeLeft % 2 == 0)
						{
							Vector2 vector140 = center16;
							Vector2 vector141 = velocity.SafeNormalize(Vector2.Zero) * -7f + velocity.SafeNormalize(Vector2.Zero).RotatedByRandom(0.19634954631328583);
							Dust dust48 = Dust.NewDustPerfect(vector140, 5, Vector2.Zero, 0, default(Color), 1.5f);
							dust48.scale = 1.1f;
							dust48.velocity = vector141 * 0.85f + new Vector2(0f, 0.85f);
							Vector2 spinningpoint17 = dust48.velocity;
							dust48.velocity = spinningpoint17.RotatedBy(MathF.PI * 2f * Main.rand.NextFloatDirection() * 0.025f);
							dust48 = Dust.CloneDust(dust48.dustIndex);
							dust48.velocity = spinningpoint17.RotatedBy(MathF.PI * 2f * Main.rand.NextFloatDirection() * 0.025f);
							Dust dust2 = dust48;
							dust2.position += dust48.velocity;
							if (Main.rand.Next(3) == 0)
							{
								dust48 = Dust.CloneDust(dust48.dustIndex);
								dust48.velocity = dust48.velocity.RotatedByRandom(0.39269909262657166) * 0.9f;
							}
						}
						if (localAI[1] == 0f)
						{
							localAI[1] = 1f;
							rotation = velocity.ToRotation() + MathF.PI / 2f;
							Vector2 vector142 = center16;
							for (int num911 = 0; num911 < 10; num911++)
							{
								Vector2 vector143 = Main.rand.NextVector2CircularEdge(4f, 4f);
								Dust dust49 = Dust.NewDustPerfect(vector142, 5, Vector2.Zero, 0, default(Color), 1.5f);
								dust49.scale = 1.5f;
								dust49.velocity = vector143;
								dust49.noGravity = true;
							}
						}
					}
				}
				if (type == 614)
				{
					Lighting.AddLight(base.Center, 0.2f, 0.6f, 0.7f);
				}
				if (type == 636)
				{
					Lighting.AddLight(base.Center, 0.8f, 0.7f, 0.4f);
				}
			}
			else if (aiStyle == 114)
			{
				if (Main.netMode == 2 && localAI[0] == 0f)
				{
					PortalHelper.SyncPortalSections(base.Center, 1);
					localAI[0] = 1f;
				}
				timeLeft = 3;
				bool flag52 = false;
				if (owner != 255 && (!Main.player[owner].active || Main.player[owner].dead || Distance(Main.player[owner].Center) > 12800f))
				{
					flag52 = true;
				}
				if (!flag52 && !WorldGen.InWorld((int)base.Center.X / 16, (int)base.Center.Y / 16, Lighting.OffScreenTiles))
				{
					flag52 = true;
				}
				if (!flag52 && !PortalHelper.SupportedTilesAreFine(base.Center, this.ai[0]))
				{
					flag52 = true;
				}
				if (flag52)
				{
					Kill();
					return;
				}
				Color portalColor = PortalHelper.GetPortalColor(owner, (int)this.ai[1]);
				alpha -= 25;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha == 0)
				{
					Lighting.AddLight(base.Center + velocity * 3f, portalColor.ToVector3() * 0.5f);
				}
				if (++frameCounter >= 6)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				rotation = this.ai[0] - MathF.PI / 2f;
			}
			else if (aiStyle == 115)
			{
				Lighting.AddLight(base.Center, new Vector3(0.075f, 0.3f, 0.15f));
				velocity *= 0.985f;
				rotation += velocity.X * 0.2f;
				if (velocity.X > 0f)
				{
					rotation += 0.08f;
				}
				else
				{
					rotation -= 0.08f;
				}
				this.ai[1] += 1f;
				if (this.ai[1] > 30f)
				{
					alpha += 10;
					if (alpha >= 255)
					{
						alpha = 255;
						Kill();
					}
				}
			}
			else if (aiStyle == 116)
			{
				if (localAI[0] == 0f)
				{
					rotation = this.ai[1];
					localAI[0] = 1f;
				}
				Player player10 = Main.player[owner];
				if (player10.setSolar)
				{
					timeLeft = 2;
				}
				float angle = (float)player10.miscCounter / 300f * (MathF.PI * 4f) + this.ai[1];
				angle = MathHelper.WrapAngle(angle);
				rotation = rotation.AngleLerp(angle, 0.05f);
				alpha -= 15;
				if (alpha < 0)
				{
					alpha = 0;
				}
				velocity = rotation.ToRotationVector2() * 100f - player10.velocity;
				base.Center = player10.Center - velocity;
			}
			else if (aiStyle == 117)
			{
				this.ai[1] += 0.01f;
				scale = this.ai[1];
				this.ai[0]++;
				if (this.ai[0] >= (float)(3 * Main.projFrames[type]))
				{
					Kill();
					return;
				}
				if (++frameCounter >= 3)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						hide = true;
					}
				}
				alpha -= 63;
				if (alpha < 0)
				{
					alpha = 0;
				}
				bool flag53 = type == 612 || type == 953 || type == 978;
				bool flag54 = type == 624;
				if (flag53)
				{
					Lighting.AddLight(base.Center, 0.9f, 0.8f, 0.6f);
				}
				if (this.ai[0] != 1f)
				{
					return;
				}
				base.position = base.Center;
				width = (height = (int)(52f * scale));
				base.Center = base.position;
				Damage();
				if (flag53)
				{
					SoundEngine.PlaySound(SoundID.Item14, base.position);
					for (int num912 = 0; num912 < 4; num912++)
					{
						int num913 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Main.dust[num913].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					}
					for (int num914 = 0; num914 < 10; num914++)
					{
						int num915 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 200, default(Color), 2.7f);
						Main.dust[num915].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
						Main.dust[num915].noGravity = true;
						Dust dust2 = Main.dust[num915];
						dust2.velocity *= 3f;
						num915 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						Main.dust[num915].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
						dust2 = Main.dust[num915];
						dust2.velocity *= 2f;
						Main.dust[num915].noGravity = true;
						Main.dust[num915].fadeIn = 2.5f;
					}
					for (int num916 = 0; num916 < 5; num916++)
					{
						int num917 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
						Main.dust[num917].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
						Main.dust[num917].noGravity = true;
						Dust dust2 = Main.dust[num917];
						dust2.velocity *= 3f;
					}
					for (int num918 = 0; num918 < 10; num918++)
					{
						int num919 = Dust.NewDust(new Vector2(base.position.X, base.position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
						Main.dust[num919].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
						Main.dust[num919].noGravity = true;
						Dust dust2 = Main.dust[num919];
						dust2.velocity *= 3f;
					}
				}
				if (!flag54)
				{
					return;
				}
				SoundEngine.PlaySound(SoundID.Item14, base.position);
				for (int num920 = 0; num920 < 20; num920++)
				{
					int num921 = Dust.NewDust(base.position, width, height, 135, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num921].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Dust dust2 = Main.dust[num921];
					dust2.velocity *= 2f;
					Main.dust[num921].noGravity = true;
					Main.dust[num921].fadeIn = 2.5f;
					Main.dust[num921].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
				}
				for (int num922 = 0; num922 < 15; num922++)
				{
					int num923 = Dust.NewDust(base.position, width, height, 135, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num923].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num923].noGravity = true;
					Dust dust2 = Main.dust[num923];
					dust2.velocity *= 3f;
					Main.dust[num923].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
				}
				float num924 = (float)Main.rand.NextDouble() * (MathF.PI * 2f);
				float num925 = (float)Main.rand.NextDouble() * (MathF.PI * 2f);
				float num926 = (float)Main.rand.NextDouble() * (MathF.PI * 2f);
				float num927 = 7f + (float)Main.rand.NextDouble() * 7f;
				float num928 = 7f + (float)Main.rand.NextDouble() * 7f;
				float num929 = 7f + (float)Main.rand.NextDouble() * 7f;
				float num930 = num927;
				if (num928 > num930)
				{
					num930 = num928;
				}
				if (num929 > num930)
				{
					num930 = num929;
				}
				for (int num931 = 0; num931 < 200; num931++)
				{
					int num932 = 135;
					float num933 = num930;
					if (num931 > 50)
					{
						num933 = num928;
					}
					if (num931 > 100)
					{
						num933 = num927;
					}
					if (num931 > 150)
					{
						num933 = num929;
					}
					int num934 = Dust.NewDust(base.position, 6, 6, num932, 0f, 0f, 100);
					Vector2 vector144 = Main.dust[num934].velocity;
					Main.dust[num934].position = base.Center;
					vector144.Normalize();
					vector144 *= num933;
					if (num931 > 150)
					{
						vector144.Y *= 0.5f;
						vector144 = vector144.RotatedBy(num926);
					}
					else if (num931 > 100)
					{
						vector144.X *= 0.5f;
						vector144 = vector144.RotatedBy(num924);
					}
					else if (num931 > 50)
					{
						vector144.Y *= 0.5f;
						vector144 = vector144.RotatedBy(num925);
					}
					Dust dust2 = Main.dust[num934];
					dust2.velocity *= 0.2f;
					dust2 = Main.dust[num934];
					dust2.velocity += vector144;
					Main.dust[num934].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
					if (num931 <= 200)
					{
						Main.dust[num934].scale = 2f;
						Main.dust[num934].noGravity = true;
						Main.dust[num934].fadeIn = Main.rand.NextFloat() * 2f;
						if (Main.rand.Next(4) == 0)
						{
							Main.dust[num934].fadeIn = 2.5f;
						}
						Main.dust[num934].noLight = true;
						if (num931 < 100)
						{
							dust2 = Main.dust[num934];
							dust2.position += Main.dust[num934].velocity * 20f;
							dust2 = Main.dust[num934];
							dust2.velocity *= -1f;
						}
					}
				}
			}
			else if (aiStyle == 118)
			{
				this.ai[0]++;
				int num935 = 0;
				if (velocity.Length() <= 4f)
				{
					num935 = 1;
				}
				alpha -= 15;
				if (alpha < 0)
				{
					alpha = 0;
				}
				switch (num935)
				{
				case 0:
					rotation -= MathF.PI / 30f;
					if (Main.rand.Next(3) == 0)
					{
						if (Main.rand.Next(2) == 0)
						{
							Vector2 vector150 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust52 = Main.dust[Dust.NewDust(base.Center - vector150 * 30f, 0, 0, Utils.SelectRandom<int>(Main.rand, 86, 90))];
							dust52.noGravity = true;
							dust52.position = base.Center - vector150 * Main.rand.Next(10, 21);
							dust52.velocity = vector150.RotatedBy(1.5707963705062866) * 6f;
							dust52.scale = 0.5f + Main.rand.NextFloat();
							dust52.fadeIn = 0.5f;
							dust52.customData = this;
						}
						else
						{
							Vector2 vector151 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust53 = Main.dust[Dust.NewDust(base.Center - vector151 * 30f, 0, 0, 240)];
							dust53.noGravity = true;
							dust53.position = base.Center - vector151 * 30f;
							dust53.velocity = vector151.RotatedBy(-1.5707963705062866) * 3f;
							dust53.scale = 0.5f + Main.rand.NextFloat();
							dust53.fadeIn = 0.5f;
							dust53.customData = this;
						}
					}
					if (this.ai[0] >= 30f)
					{
						velocity *= 0.98f;
						scale += 0.0074468083f;
						if (scale > 1.3f)
						{
							scale = 1.3f;
						}
						rotation -= MathF.PI / 180f;
					}
					if (velocity.Length() < 4.1f)
					{
						velocity.Normalize();
						velocity *= 4f;
						this.ai[0] = 0f;
					}
					break;
				case 1:
				{
					rotation -= MathF.PI / 30f;
					for (int num936 = 0; num936 < 1; num936++)
					{
						if (Main.rand.Next(2) == 0)
						{
							Vector2 vector145 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust50 = Main.dust[Dust.NewDust(base.Center - vector145 * 30f, 0, 0, 86)];
							dust50.noGravity = true;
							dust50.position = base.Center - vector145 * Main.rand.Next(10, 21);
							dust50.velocity = vector145.RotatedBy(1.5707963705062866) * 6f;
							dust50.scale = 0.9f + Main.rand.NextFloat();
							dust50.fadeIn = 0.5f;
							dust50.customData = this;
							vector145 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							dust50 = Main.dust[Dust.NewDust(base.Center - vector145 * 30f, 0, 0, 90)];
							dust50.noGravity = true;
							dust50.position = base.Center - vector145 * Main.rand.Next(10, 21);
							dust50.velocity = vector145.RotatedBy(1.5707963705062866) * 6f;
							dust50.scale = 0.9f + Main.rand.NextFloat();
							dust50.fadeIn = 0.5f;
							dust50.customData = this;
							dust50.color = Color.Crimson;
						}
						else
						{
							Vector2 vector146 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
							Dust dust51 = Main.dust[Dust.NewDust(base.Center - vector146 * 30f, 0, 0, 240)];
							dust51.noGravity = true;
							dust51.position = base.Center - vector146 * Main.rand.Next(20, 31);
							dust51.velocity = vector146.RotatedBy(-1.5707963705062866) * 5f;
							dust51.scale = 0.9f + Main.rand.NextFloat();
							dust51.fadeIn = 0.5f;
							dust51.customData = this;
						}
					}
					if (this.ai[0] % 30f == 0f && this.ai[0] < 241f && Main.myPlayer == owner)
					{
						Vector2 vector147 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * 12f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector147.X, vector147.Y, 618, damage / 2, 0f, owner, 0f, whoAmI);
					}
					Vector2 vector148 = base.Center;
					float num937 = 800f;
					bool flag55 = false;
					int num938 = 0;
					if (this.ai[1] == 0f)
					{
						for (int num939 = 0; num939 < 200; num939++)
						{
							if (Main.npc[num939].CanBeChasedBy(this))
							{
								Vector2 center17 = Main.npc[num939].Center;
								if (Distance(center17) < num937 && Collision.CanHit(new Vector2(base.position.X + (float)(width / 2), base.position.Y + (float)(height / 2)), 1, 1, Main.npc[num939].position, Main.npc[num939].width, Main.npc[num939].height))
								{
									num937 = Distance(center17);
									vector148 = center17;
									flag55 = true;
									num938 = num939;
								}
							}
						}
						if (flag55)
						{
							if (this.ai[1] != (float)(num938 + 1))
							{
								netUpdate = true;
							}
							this.ai[1] = num938 + 1;
						}
						flag55 = false;
					}
					if (this.ai[1] != 0f)
					{
						int num940 = (int)(this.ai[1] - 1f);
						if (Main.npc[num940].active && Main.npc[num940].CanBeChasedBy(this, ignoreDontTakeDamage: true) && Distance(Main.npc[num940].Center) < 1000f)
						{
							flag55 = true;
							vector148 = Main.npc[num940].Center;
						}
					}
					if (!friendly)
					{
						flag55 = false;
					}
					if (flag55)
					{
						float num941 = 4f;
						int num942 = 8;
						Vector2 vector149 = new Vector2(base.position.X + (float)width * 0.5f, base.position.Y + (float)height * 0.5f);
						float num943 = vector148.X - vector149.X;
						float num944 = vector148.Y - vector149.Y;
						float num945 = (float)Math.Sqrt(num943 * num943 + num944 * num944);
						float num946 = num945;
						num945 = num941 / num945;
						num943 *= num945;
						num944 *= num945;
						velocity.X = (velocity.X * (float)(num942 - 1) + num943) / (float)num942;
						velocity.Y = (velocity.Y * (float)(num942 - 1) + num944) / (float)num942;
					}
					break;
				}
				}
				if (alpha < 150)
				{
					Lighting.AddLight(base.Center, 0.7f, 0.2f, 0.6f);
				}
				if (this.ai[0] >= 600f)
				{
					Kill();
				}
			}
			else if (aiStyle == 119)
			{
				int num947 = 0;
				float num948 = 0f;
				float x6 = 0f;
				float y5 = 0f;
				bool flag56 = false;
				bool flag57 = false;
				int num38 = type;
				if (num38 == 618)
				{
					num947 = 617;
					num948 = 420f;
					x6 = 0.15f;
					y5 = 0.15f;
				}
				if (flag57)
				{
					int num949 = (int)this.ai[1];
					if (!Main.projectile[num949].active || Main.projectile[num949].type != num947)
					{
						Kill();
						return;
					}
					timeLeft = 2;
				}
				this.ai[0]++;
				if (!(this.ai[0] < num948))
				{
					return;
				}
				bool flag58 = true;
				int num950 = (int)this.ai[1];
				if (Main.projectile[num950].active && Main.projectile[num950].type == num947)
				{
					if (!flag56 && Main.projectile[num950].oldPos[1] != Vector2.Zero)
					{
						base.position += Main.projectile[num950].position - Main.projectile[num950].oldPos[1];
					}
					if (base.Center.HasNaNs())
					{
						Kill();
						return;
					}
				}
				else
				{
					this.ai[0] = num948;
					flag58 = false;
					Kill();
				}
				if (flag58 && !flag56)
				{
					velocity += new Vector2(Math.Sign(Main.projectile[num950].Center.X - base.Center.X), Math.Sign(Main.projectile[num950].Center.Y - base.Center.Y)) * new Vector2(x6, y5);
					if (velocity.Length() > 6f)
					{
						velocity *= 6f / velocity.Length();
					}
				}
				if (type == 618)
				{
					if (Main.rand.Next(2) == 0)
					{
						int num951 = Dust.NewDust(base.Center, 8, 8, 86);
						Main.dust[num951].position = base.Center;
						Main.dust[num951].velocity = velocity;
						Main.dust[num951].noGravity = true;
						Main.dust[num951].scale = 1.5f;
						if (flag58)
						{
							Main.dust[num951].customData = Main.projectile[(int)this.ai[1]];
						}
					}
					alpha = 255;
				}
				else
				{
					Kill();
				}
			}
			else if (aiStyle == 120)
			{
				AI_120_StardustGuardian();
			}
			else if (aiStyle == 121)
			{
				AI_121_StardustDragon();
			}
			else if (aiStyle == 122)
			{
				int num952 = (int)this.ai[0];
				bool flag59 = false;
				if (num952 == -1 || !Main.npc[num952].active)
				{
					flag59 = true;
				}
				if (flag59)
				{
					if (type == 629)
					{
						Kill();
						return;
					}
					if (type == 631 && this.ai[0] != -1f)
					{
						this.ai[0] = -1f;
						netUpdate = true;
					}
				}
				if (!flag59 && base.Hitbox.Intersects(Main.npc[num952].Hitbox))
				{
					Kill();
					if (type == 631)
					{
						localAI[1] = 1f;
						Damage();
					}
					return;
				}
				if (type == 629)
				{
					Vector2 value17 = Main.npc[num952].Center - base.Center;
					velocity = Vector2.Normalize(value17) * 5f;
					Dust.QuickDust(base.Center, Color.Red);
				}
				if (type != 631)
				{
					return;
				}
				if (this.ai[1] > 0f)
				{
					this.ai[1]--;
					velocity = Vector2.Zero;
					return;
				}
				if (flag59)
				{
					if (velocity == Vector2.Zero)
					{
						Kill();
					}
					tileCollide = true;
					alpha += 10;
					if (alpha > 255)
					{
						Kill();
					}
				}
				else
				{
					Vector2 value18 = Main.npc[num952].Center - base.Center;
					velocity = Vector2.Normalize(value18) * 12f;
					alpha -= 15;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				rotation = velocity.ToRotation() - MathF.PI / 2f;
			}
			else if (aiStyle == 123)
			{
				bool flag60 = type == 641;
				bool flag61 = type == 643;
				float num953 = 1000f;
				velocity = Vector2.Zero;
				if (flag60)
				{
					alpha -= 5;
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (direction == 0)
					{
						direction = Main.player[owner].direction;
					}
					rotation -= (float)direction * (MathF.PI * 2f) / 120f;
					scale = Opacity;
					Lighting.AddLight(base.Center, new Vector3(0.3f, 0.9f, 0.7f) * Opacity);
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector152 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust54 = Main.dust[Dust.NewDust(base.Center - vector152 * 30f, 0, 0, 229)];
						dust54.noGravity = true;
						dust54.position = base.Center - vector152 * Main.rand.Next(10, 21);
						dust54.velocity = vector152.RotatedBy(1.5707963705062866) * 6f;
						dust54.scale = 0.5f + Main.rand.NextFloat();
						dust54.fadeIn = 0.5f;
						dust54.customData = base.Center;
					}
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector153 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
						Dust dust55 = Main.dust[Dust.NewDust(base.Center - vector153 * 30f, 0, 0, 240)];
						dust55.noGravity = true;
						dust55.position = base.Center - vector153 * 30f;
						dust55.velocity = vector153.RotatedBy(-1.5707963705062866) * 3f;
						dust55.scale = 0.5f + Main.rand.NextFloat();
						dust55.fadeIn = 0.5f;
						dust55.customData = base.Center;
					}
					if (this.ai[0] < 0f)
					{
						Vector2 center18 = base.Center;
						int num954 = Dust.NewDust(center18 - Vector2.One * 8f, 16, 16, 229, velocity.X / 2f, velocity.Y / 2f);
						Dust dust2 = Main.dust[num954];
						dust2.velocity *= 2f;
						Main.dust[num954].noGravity = true;
						Main.dust[num954].scale = Utils.SelectRandom<float>(Main.rand, 0.8f, 1.65f);
						Main.dust[num954].customData = this;
					}
				}
				if (flag61)
				{
					alpha -= 5;
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (direction == 0)
					{
						direction = Main.player[owner].direction;
					}
					if (++frameCounter >= 3)
					{
						frameCounter = 0;
						if (++frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
					if (alpha == 0 && Main.rand.Next(15) == 0)
					{
						Dust dust56 = Main.dust[Dust.NewDust(base.Top, 0, 0, 261, 0f, 0f, 100)];
						dust56.velocity.X = 0f;
						dust56.noGravity = true;
						dust56.fadeIn = 1f;
						dust56.position = base.Center + Vector2.UnitY.RotatedByRandom(6.2831854820251465) * (4f * Main.rand.NextFloat() + 26f);
						dust56.scale = 0.5f;
					}
					localAI[0]++;
					if (localAI[0] >= 60f)
					{
						localAI[0] = 0f;
					}
				}
				if (this.ai[0] < 0f)
				{
					this.ai[0]++;
					if (flag60)
					{
						this.ai[1] -= (float)direction * (MathF.PI / 8f) / 50f;
					}
				}
				if (this.ai[0] == 0f)
				{
					int num955 = -1;
					float num956 = num953;
					NPC ownerMinionAttackTargetNPC4 = OwnerMinionAttackTargetNPC;
					if (ownerMinionAttackTargetNPC4 != null && ownerMinionAttackTargetNPC4.CanBeChasedBy(this))
					{
						float num957 = Distance(ownerMinionAttackTargetNPC4.Center);
						if (num957 < num956 && Collision.CanHitLine(base.Center, 0, 0, ownerMinionAttackTargetNPC4.Center, 0, 0))
						{
							num956 = num957;
							num955 = ownerMinionAttackTargetNPC4.whoAmI;
						}
					}
					if (num955 < 0)
					{
						for (int num958 = 0; num958 < 200; num958++)
						{
							NPC nPC12 = Main.npc[num958];
							if (nPC12.CanBeChasedBy(this))
							{
								float num959 = Distance(nPC12.Center);
								if (num959 < num956 && Collision.CanHitLine(base.Center, 0, 0, nPC12.Center, 0, 0))
								{
									num956 = num959;
									num955 = num958;
								}
							}
						}
					}
					if (num955 != -1)
					{
						this.ai[0] = 1f;
						this.ai[1] = num955;
						netUpdate = true;
						return;
					}
				}
				if (!(this.ai[0] > 0f))
				{
					return;
				}
				int num960 = (int)this.ai[1];
				if (!Main.npc[num960].CanBeChasedBy(this))
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
					netUpdate = true;
					return;
				}
				this.ai[0]++;
				float num961 = 30f;
				if (flag60)
				{
					num961 = 10f;
				}
				if (flag61)
				{
					num961 = 5f;
				}
				if (!(this.ai[0] >= num961))
				{
					return;
				}
				Vector2 vector154 = DirectionTo(Main.npc[num960].Center);
				if (vector154.HasNaNs())
				{
					vector154 = Vector2.UnitY;
				}
				float num962 = vector154.ToRotation();
				int num963 = ((vector154.X > 0f) ? 1 : (-1));
				if (flag60)
				{
					direction = num963;
					this.ai[0] = -20f;
					this.ai[1] = num962 + (float)num963 * MathF.PI / 6f;
					netUpdate = true;
					if (owner == Main.myPlayer)
					{
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector154.X, vector154.Y, 642, damage, knockBack, owner, this.ai[1], whoAmI);
					}
				}
				if (!flag61)
				{
					return;
				}
				direction = num963;
				this.ai[0] = -20f;
				netUpdate = true;
				if (owner != Main.myPlayer)
				{
					return;
				}
				NPC nPC13 = Main.npc[num960];
				Vector2 vector155 = nPC13.position + nPC13.Size * Utils.RandomVector2(Main.rand, 0f, 1f) - base.Center;
				for (int num964 = 0; num964 < 3; num964++)
				{
					Vector2 other = base.Center + vector155;
					Vector2 vector156 = nPC13.velocity * 30f;
					other += vector156;
					float num965 = MathHelper.Lerp(0.1f, 0.75f, Utils.GetLerpValue(800f, 200f, Distance(other)));
					if (num964 > 0)
					{
						other = base.Center + vector155.RotatedByRandom(0.7853981852531433) * (Main.rand.NextFloat() * num965 + 0.5f);
					}
					float x7 = Main.rgbToHsl(new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB)).X;
					NewProjectile(GetProjectileSource_FromThis(), other.X, other.Y, 0f, 0f, 644, damage, knockBack, owner, x7, whoAmI);
				}
			}
			else if (aiStyle == 124)
			{
				bool flag62 = type == 650;
				Player player11 = Main.player[owner];
				if (player11.dead)
				{
					Kill();
					return;
				}
				if (type == 650 && player11.suspiciouslookingTentacle)
				{
					timeLeft = 2;
				}
				if (type == 882 && player11.petFlagEyeOfCthulhuPet)
				{
					timeLeft = 2;
				}
				if (type == 888 && player11.petFlagTwinsPet)
				{
					timeLeft = 2;
				}
				if (type == 895 && player11.petFlagFairyQueenPet)
				{
					timeLeft = 2;
				}
				if (type == 896 && player11.petFlagPumpkingPet)
				{
					timeLeft = 2;
				}
				if (type == 898 && player11.petFlagIceQueenPet)
				{
					timeLeft = 2;
				}
				if (type == 957 && player11.petFlagGlommerPet)
				{
					timeLeft = 2;
				}
				direction = (spriteDirection = player11.direction);
				if (type == 650)
				{
					Vector3 vector157 = (DelegateMethods.v3_1 = new Vector3(0.5f, 0.9f, 1f) * 2f);
					Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 20f, DelegateMethods.CastLightOpen);
					Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
					Utils.PlotTileLine(player11.Center, player11.Center + player11.velocity * 6f, 40f, DelegateMethods.CastLightOpen);
					Utils.PlotTileLine(player11.Left, player11.Right, 40f, DelegateMethods.CastLightOpen);
				}
				if (type == 895)
				{
					Vector3 vector158 = new Vector3(1f, 0.6f, 1f) * 1.5f;
					DelegateMethods.v3_1 = vector158 * 0.75f;
					Utils.PlotTileLine(player11.Center, player11.Center + player11.velocity * 6f, 40f, DelegateMethods.CastLightOpen);
					Utils.PlotTileLine(player11.Left, player11.Right, 40f, DelegateMethods.CastLightOpen);
					DelegateMethods.v3_1 = vector158 * 1.5f;
					Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 30f, DelegateMethods.CastLightOpen);
					Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
				}
				if (type == 896)
				{
					Vector3 vector159 = new Vector3(1f, 0.7f, 0.05f) * 1.5f;
					DelegateMethods.v3_1 = vector159 * 0.75f;
					Utils.PlotTileLine(player11.Center, player11.Center + player11.velocity * 6f, 40f, DelegateMethods.CastLightOpen);
					Utils.PlotTileLine(player11.Left, player11.Right, 40f, DelegateMethods.CastLightOpen);
					DelegateMethods.v3_1 = vector159 * 1.5f;
					Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 30f, DelegateMethods.CastLightOpen);
					Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
				}
				float num966 = 30f;
				float y6 = -20f;
				int num967 = player11.direction;
				if (type == 882 && player11.ownedProjectileCounts[650] > 0)
				{
					num967 *= -1;
				}
				if (type == 888)
				{
					num966 = 30f;
					y6 = -50f;
					if (player11.ownedProjectileCounts[650] > 0)
					{
						y6 = -70f;
					}
				}
				if (type == 895)
				{
					num966 = -36f;
					y6 = -50f;
				}
				if (type == 896)
				{
					num966 = 30f;
					y6 = -60f;
					if (player11.ownedProjectileCounts[888] > 0)
					{
						num966 = -30f;
					}
				}
				if (type == 898)
				{
					num966 = -30f;
					y6 = -50f;
					if (player11.ownedProjectileCounts[895] > 0)
					{
						num966 = 30f;
					}
				}
				if (type == 957)
				{
					num966 = -40f;
					y6 = -40f;
					if (player11.ownedProjectileCounts[895] > 0)
					{
						num966 = 40f;
					}
				}
				Vector2 vector160 = new Vector2((float)num967 * num966, y6);
				Vector2 vector161 = player11.MountedCenter + vector160;
				float num968 = Vector2.Distance(base.Center, vector161);
				if (num968 > 1000f)
				{
					base.Center = player11.Center + vector160;
				}
				Vector2 vector162 = vector161 - base.Center;
				float num969 = 4f;
				if (num968 < num969)
				{
					velocity *= 0.25f;
				}
				if (vector162 != Vector2.Zero)
				{
					if (vector162.Length() < num969)
					{
						velocity = vector162;
					}
					else
					{
						velocity = vector162 * 0.1f;
					}
				}
				if (num968 > 50f && (type == 895 || type == 898 || type == 957))
				{
					direction = (spriteDirection = 1);
					if (velocity.X < 0f)
					{
						direction = (spriteDirection = -1);
					}
				}
				if (velocity.Length() > 6f)
				{
					if (type == 650)
					{
						float num970 = velocity.ToRotation() + MathF.PI / 2f;
						if (Math.Abs(rotation - num970) >= MathF.PI)
						{
							if (num970 < rotation)
							{
								rotation -= MathF.PI * 2f;
							}
							else
							{
								rotation += MathF.PI * 2f;
							}
						}
						float num971 = 12f;
						rotation = (rotation * (num971 - 1f) + num970) / num971;
						if (++frameCounter >= 4)
						{
							frameCounter = 0;
							if (++frame >= Main.projFrames[type])
							{
								frame = 0;
							}
						}
					}
					else if (type == 882)
					{
						rotation = velocity.X * 0.125f;
						if (++frameCounter >= 3)
						{
							frameCounter = 0;
							if (frame < 6)
							{
								frame = 6;
							}
							else
							{
								frame++;
								if (frame > 15)
								{
									frame = 10;
								}
							}
						}
					}
					else if (type == 888)
					{
						float num972 = velocity.ToRotation() + MathF.PI / 2f;
						if (Math.Abs(rotation - num972) >= MathF.PI)
						{
							if (num972 < rotation)
							{
								rotation -= MathF.PI * 2f;
							}
							else
							{
								rotation += MathF.PI * 2f;
							}
						}
						float num973 = 12f;
						rotation = (rotation * (num973 - 1f) + num972) / num973;
						if (++frameCounter >= 3)
						{
							frameCounter = 0;
							if (frame < 6)
							{
								frame = 6;
							}
							else
							{
								frame++;
								if (frame > 17)
								{
									frame = 6;
								}
							}
						}
					}
					else if (type == 895)
					{
						float num974 = velocity.X * 0.1f;
						if (Math.Abs(rotation - num974) >= MathF.PI)
						{
							if (num974 < rotation)
							{
								rotation -= MathF.PI * 2f;
							}
							else
							{
								rotation += MathF.PI * 2f;
							}
						}
						float num975 = 12f;
						rotation = (rotation * (num975 - 1f) + num974) / num975;
						if (++frameCounter >= 3)
						{
							frameCounter = 0;
							frame++;
							if (frame >= Main.projFrames[type])
							{
								frame = 0;
							}
						}
						if (frameCounter == 0)
						{
							int num976 = Dust.NewDust(base.position, width, height, 242, 0f, 0f, 50, default(Color), 2f);
							Main.dust[num976].noGravity = true;
						}
					}
					else if (type == 896)
					{
						float num977 = velocity.ToRotation() + MathF.PI / 2f;
						if (Math.Abs(rotation - num977) >= MathF.PI)
						{
							if (num977 < rotation)
							{
								rotation -= MathF.PI * 2f;
							}
							else
							{
								rotation += MathF.PI * 2f;
							}
						}
						float num978 = 12f;
						rotation = (rotation * (num978 - 1f) + num977) / num978;
						if (++frameCounter >= 4)
						{
							frameCounter = 0;
							if (frame < 8)
							{
								frame = 8;
							}
							else
							{
								frame++;
								if (frame >= Main.projFrames[type])
								{
									frame = 8;
								}
							}
						}
					}
					else if (type == 898)
					{
						float num979 = velocity.X * 0.1f;
						if (Math.Abs(rotation - num979) >= MathF.PI)
						{
							if (num979 < rotation)
							{
								rotation -= MathF.PI * 2f;
							}
							else
							{
								rotation += MathF.PI * 2f;
							}
						}
						float num980 = 12f;
						rotation = (rotation * (num980 - 1f) + num979) / num980;
						if (++frameCounter >= 3)
						{
							frameCounter = 0;
							frame++;
							if (frame >= Main.projFrames[type])
							{
								frame = 0;
							}
						}
						if (frameCounter == 0)
						{
							int num981 = Dust.NewDust(base.position, width, height, 80, 0f, 0f, 50);
							Main.dust[num981].noGravity = true;
						}
					}
					else if (type == 957)
					{
						float num982 = velocity.X * 0.05f;
						if (Math.Abs(rotation - num982) >= MathF.PI)
						{
							if (num982 < rotation)
							{
								rotation -= MathF.PI * 2f;
							}
							else
							{
								rotation += MathF.PI * 2f;
							}
						}
						float num983 = 12f;
						rotation = (rotation * (num983 - 1f) + num982) / num983;
						if (++frameCounter >= 4)
						{
							frameCounter = 0;
							frame++;
							if (frame >= Main.projFrames[type] * 2)
							{
								frame = 0;
							}
						}
					}
				}
				else if (type == 650)
				{
					if (rotation > MathF.PI)
					{
						rotation -= MathF.PI * 2f;
					}
					if (rotation > -0.005f && rotation < 0.005f)
					{
						rotation = 0f;
					}
					else
					{
						rotation *= 0.96f;
					}
					if (++frameCounter >= 6)
					{
						frameCounter = 0;
						if (++frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
				}
				else if (type == 882)
				{
					rotation = velocity.X * 0.125f;
					if (++frameCounter >= 5)
					{
						frameCounter = 0;
						frame++;
						if (frame == 6 || frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
				}
				else if (type == 888)
				{
					if (rotation > MathF.PI)
					{
						rotation -= MathF.PI * 2f;
					}
					if (rotation > -0.005f && rotation < 0.005f)
					{
						rotation = 0f;
					}
					else
					{
						rotation *= 0.96f;
					}
					if (++frameCounter >= 5)
					{
						frameCounter = 0;
						frame++;
						if (frame == 6 || frame >= 18)
						{
							frame = 0;
						}
					}
				}
				else if (type == 895)
				{
					if (rotation > MathF.PI)
					{
						rotation -= MathF.PI * 2f;
					}
					if (rotation > -0.005f && rotation < 0.005f)
					{
						rotation = 0f;
					}
					else
					{
						rotation *= 0.96f;
					}
					if (++frameCounter >= 5)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
				}
				else if (type == 896)
				{
					if (rotation > MathF.PI)
					{
						rotation -= MathF.PI * 2f;
					}
					if (rotation > -0.005f && rotation < 0.005f)
					{
						rotation = 0f;
					}
					else
					{
						rotation *= 0.96f;
					}
					if (++frameCounter >= 5)
					{
						frameCounter = 0;
						frame++;
						if (frame == 8 || frame >= Main.projFrames[type])
						{
							frame = 0;
							if (Main.rand.Next(15) == 0)
							{
								frame = 8;
							}
						}
					}
				}
				else if (type == 898)
				{
					if (rotation > MathF.PI)
					{
						rotation -= MathF.PI * 2f;
					}
					if (rotation > -0.005f && rotation < 0.005f)
					{
						rotation = 0f;
					}
					else
					{
						rotation *= 0.96f;
					}
					if (++frameCounter >= 5)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 0;
						}
					}
				}
				else if (type == 957)
				{
					int num984 = Main.projFrames[type];
					if (rotation > MathF.PI)
					{
						rotation -= MathF.PI * 2f;
					}
					if (rotation > -0.005f && rotation < 0.005f)
					{
						rotation = 0f;
					}
					else
					{
						rotation *= 0.96f;
					}
					if (velocity.Length() <= 0.01f)
					{
						bool flag63 = true;
						int num985 = (int)base.Center.X / 16;
						int num986 = (int)base.Center.Y / 16;
						int num987 = 4;
						for (int num988 = 0; num988 < num987 + 1; num988++)
						{
							if (num985 < 0 || num985 >= Main.maxTilesX || num986 < 0 || num986 >= Main.maxTilesY)
							{
								flag63 = false;
								break;
							}
							bool flag64 = WorldGen.SolidTileAllowBottomSlope(num985, num986);
							if ((num988 == num987 && !flag64) || (num988 < num987 && flag64))
							{
								flag63 = false;
								break;
							}
							num986++;
						}
						if (flag63)
						{
							localAI[0]--;
							if (localAI[0] <= 0f)
							{
								localAI[0] = 0f;
								if (frame < num984 * 2)
								{
									frame = num984 * 2;
								}
								int num989 = 3;
								if (frame <= 30 && frame <= 33)
								{
									num989 = 2;
								}
								if (++frameCounter >= num989)
								{
									frameCounter = 0;
									frame++;
									if (frame >= num984 * 3)
									{
										localAI[0] = 200 + Main.rand.Next(150);
										frame = 0;
									}
									if (frame == 32)
									{
										SoundEngine.PlaySound(SoundID.GlommerBounce, base.Bottom);
									}
								}
							}
							else if (++frameCounter >= 4)
							{
								frameCounter = 0;
								frame++;
								if (frame >= num984 * 2)
								{
									frame = 0;
								}
							}
						}
						else
						{
							localAI[0] = 300f;
							if (++frameCounter >= 4)
							{
								frameCounter = 0;
								frame++;
								if (frame >= num984 * 2)
								{
									frame = 0;
								}
							}
						}
					}
					else
					{
						localAI[0] = 300f;
						if (++frameCounter >= 4)
						{
							frameCounter = 0;
							frame++;
							if (frame >= num984 * 2)
							{
								frame = 0;
							}
						}
					}
				}
				if (flag62 && this.ai[0] > 0f && (this.ai[0] += 1f) >= 60f)
				{
					this.ai[0] = 0f;
					this.ai[1] = 0f;
				}
				if (flag62 && Main.rand.Next(15) == 0)
				{
					int num990 = -1;
					int num991 = -1;
					float num992 = -1f;
					int num993 = 17;
					if ((base.Center - player11.Center).Length() < (float)Main.screenWidth)
					{
						int num994 = (int)base.Center.X / 16;
						int num995 = (int)base.Center.Y / 16;
						num994 = (int)MathHelper.Clamp(num994, num993 + 1, Main.maxTilesX - num993 - 1);
						num995 = (int)MathHelper.Clamp(num995, num993 + 1, Main.maxTilesY - num993 - 1);
						for (int num996 = num994 - num993; num996 <= num994 + num993; num996++)
						{
							for (int num997 = num995 - num993; num997 <= num995 + num993; num997++)
							{
								int num998 = Main.rand.Next(8);
								if (num998 < 4 && new Vector2(num994 - num996, num995 - num997).Length() < (float)num993 && Main.tile[num996, num997] != null && Main.tile[num996, num997].active() && Main.IsTileSpelunkable(Main.tile[num996, num997]))
								{
									float num999 = Distance(new Vector2(num996 * 16 + 8, num997 * 16 + 8));
									if (num999 < num992 || num992 == -1f)
									{
										num992 = num999;
										num990 = num996;
										num991 = num997;
										this.ai[0] = 1f;
										this.ai[1] = AngleTo(new Vector2(num996 * 16 + 8, num997 * 16 + 8));
									}
									if (num998 < 2)
									{
										int num1000 = Dust.NewDust(new Vector2(num996 * 16, num997 * 16), 16, 16, 204, 0f, 0f, 150, default(Color), 0.3f);
										Main.dust[num1000].fadeIn = 0.75f;
										Dust dust2 = Main.dust[num1000];
										dust2.velocity *= 0.1f;
									}
								}
							}
						}
					}
				}
				if (!flag62)
				{
					return;
				}
				float f3 = localAI[0] % (MathF.PI * 2f) - MathF.PI;
				float num1001 = (float)Math.IEEERemainder(localAI[1], 1.0);
				if (num1001 < 0f)
				{
					num1001 += 1f;
				}
				float num1002 = (float)Math.Floor(localAI[1]);
				float max = 0.999f;
				float num1003 = 0f;
				int num1004 = 0;
				float amount2 = 0.1f;
				bool flag65 = player11.velocity.Length() > 3f;
				int num1005 = -1;
				int num1006 = -1;
				float num1007 = 300f;
				float num1008 = 500f;
				for (int num1009 = 0; num1009 < 200; num1009++)
				{
					NPC nPC14 = Main.npc[num1009];
					if (!nPC14.active || !nPC14.chaseable || nPC14.dontTakeDamage || nPC14.immortal)
					{
						continue;
					}
					float num1010 = Distance(nPC14.Center);
					if (nPC14.friendly || nPC14.lifeMax <= 5)
					{
						if (num1010 < num1007 && !flag65)
						{
							num1007 = num1010;
							num1006 = num1009;
						}
					}
					else if (num1010 < num1008)
					{
						num1008 = num1010;
						num1005 = num1009;
					}
				}
				if (flag65)
				{
					num1003 = AngleTo(base.Center + player11.velocity);
					num1004 = 1;
					num1001 = MathHelper.Clamp(num1001 + 0.05f, 0f, max);
					num1002 += (float)Math.Sign(-10f - num1002);
				}
				else if (num1005 != -1)
				{
					num1003 = AngleTo(Main.npc[num1005].Center);
					num1004 = 2;
					num1001 = MathHelper.Clamp(num1001 + 0.05f, 0f, max);
					num1002 += (float)Math.Sign(-12f - num1002);
				}
				else if (num1006 != -1)
				{
					num1003 = AngleTo(Main.npc[num1006].Center);
					num1004 = 3;
					num1001 = MathHelper.Clamp(num1001 + 0.05f, 0f, max);
					num1002 += (float)Math.Sign(6f - num1002);
				}
				else if (this.ai[0] > 0f)
				{
					num1003 = this.ai[1];
					num1001 = MathHelper.Clamp(num1001 + (float)Math.Sign(0.75f - num1001) * 0.05f, 0f, max);
					num1004 = 4;
					num1002 += (float)Math.Sign(10f - num1002);
					if (Main.rand.Next(10) == 0)
					{
						int num1011 = Dust.NewDust(base.Center + f3.ToRotationVector2() * 6f * num1001 - Vector2.One * 4f, 8, 8, 204, 0f, 0f, 150, default(Color), 0.3f);
						Main.dust[num1011].fadeIn = 0.75f;
						Dust dust2 = Main.dust[num1011];
						dust2.velocity *= 0.1f;
					}
				}
				else
				{
					num1003 = ((player11.direction == 1) ? 0f : 3.1416028f);
					num1001 = MathHelper.Clamp(num1001 + (float)Math.Sign(0.75f - num1001) * 0.05f, 0f, max);
					num1002 += (float)Math.Sign(0f - num1002);
					amount2 = 0.12f;
				}
				Vector2 value19 = num1003.ToRotationVector2();
				num1003 = Vector2.Lerp(f3.ToRotationVector2(), value19, amount2).ToRotation();
				localAI[0] = num1003 + (float)num1004 * (MathF.PI * 2f) + MathF.PI;
				localAI[1] = num1002 + num1001;
			}
			else if (aiStyle == 125)
			{
				Player player12 = Main.player[owner];
				if (Main.myPlayer == owner)
				{
					if (localAI[1] > 0f)
					{
						localAI[1]--;
					}
					if (player12.noItems || player12.CCed || player12.dead)
					{
						Kill();
					}
					else if (Main.mouseRight && Main.mouseRightRelease)
					{
						Kill();
						player12.mouseInterface = true;
						Main.blockMouse = true;
					}
					else if (!player12.channel)
					{
						if (localAI[0] == 0f)
						{
							localAI[0] = 1f;
						}
						Kill();
					}
					else if (localAI[1] == 0f)
					{
						Vector2 vector163 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY);
						if (player12.gravDir == -1f)
						{
							vector163.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y;
						}
						if (vector163 != base.Center)
						{
							netUpdate = true;
							base.Center = vector163;
							localAI[1] = 1f;
						}
						if (this.ai[0] == 0f && this.ai[1] == 0f)
						{
							this.ai[0] = (int)base.Center.X / 16;
							this.ai[1] = (int)base.Center.Y / 16;
							netUpdate = true;
							velocity = Vector2.Zero;
						}
					}
					velocity = Vector2.Zero;
					Point point4 = new Vector2(this.ai[0], this.ai[1]).ToPoint();
					Point point5 = base.Center.ToTileCoordinates();
					int num1012 = Math.Abs(point4.X - point5.X);
					int num1013 = Math.Abs(point4.Y - point5.Y);
					int num1014 = Math.Sign(point5.X - point4.X);
					int num1015 = Math.Sign(point5.Y - point4.Y);
					Point point6 = default(Point);
					bool flag66 = false;
					bool flag67 = player12.direction == 1;
					int num1016;
					int num1017;
					int num1018;
					if (flag67)
					{
						point6.X = point4.X;
						num1016 = point4.Y;
						num1017 = point5.Y;
						num1018 = num1015;
					}
					else
					{
						point6.Y = point4.Y;
						num1016 = point4.X;
						num1017 = point5.X;
						num1018 = num1014;
					}
					for (int num1019 = num1016; num1019 != num1017; num1019 += num1018)
					{
						if (flag66)
						{
							break;
						}
						if (flag67)
						{
							point6.Y = num1019;
						}
						else
						{
							point6.X = num1019;
						}
						if (WorldGen.InWorld(point6.X, point6.Y, 1))
						{
							Tile tile3 = Main.tile[point6.X, point6.Y];
						}
					}
					if (flag67)
					{
						point6.Y = point5.Y;
						num1016 = point4.X;
						num1017 = point5.X;
						num1018 = num1014;
					}
					else
					{
						point6.X = point5.X;
						num1016 = point4.Y;
						num1017 = point5.Y;
						num1018 = num1015;
					}
					for (int num1020 = num1016; num1020 != num1017; num1020 += num1018)
					{
						if (flag66)
						{
							break;
						}
						if (!flag67)
						{
							point6.Y = num1020;
						}
						else
						{
							point6.X = num1020;
						}
						if (WorldGen.InWorld(point6.X, point6.Y, 1))
						{
							Tile tile3 = Main.tile[point6.X, point6.Y];
						}
					}
				}
				int num1021 = Math.Sign(player12.velocity.X);
				if (num1021 != 0)
				{
					player12.ChangeDir(num1021);
				}
				player12.heldProj = whoAmI;
				player12.SetDummyItemTime(2);
				player12.itemRotation = 0f;
			}
			else if (aiStyle == 126)
			{
				int num1022 = Math.Sign(velocity.Y);
				int num1023 = ((num1022 != -1) ? 1 : 0);
				if (this.ai[0] == 0f)
				{
					if (!Collision.SolidCollision(base.position + new Vector2(0f, (num1022 == -1) ? (height - 48) : 0), width, 48) && !Collision.WetCollision(base.position + new Vector2(0f, (num1022 == -1) ? (height - 20) : 0), width, 20))
					{
						velocity = new Vector2(0f, (float)Math.Sign(velocity.Y) * 0.001f);
						this.ai[0] = 1f;
						this.ai[1] = 0f;
						timeLeft = 60;
					}
					this.ai[1]++;
					if (this.ai[1] >= 60f)
					{
						Kill();
					}
					for (int num1024 = 0; num1024 < 3; num1024++)
					{
						int num1025 = Dust.NewDust(base.position, width, height, 31, 0f, 0f, 100);
						Main.dust[num1025].scale = 0.1f + (float)Main.rand.Next(5) * 0.1f;
						Main.dust[num1025].fadeIn = 1.5f + (float)Main.rand.Next(5) * 0.1f;
						Main.dust[num1025].noGravity = true;
						Main.dust[num1025].position = base.Center + new Vector2(0f, -height / 2).RotatedBy(rotation) * 1.1f;
					}
				}
				if (this.ai[0] != 1f)
				{
					return;
				}
				velocity = new Vector2(0f, (float)Math.Sign(velocity.Y) * 0.001f);
				if (num1022 != 0)
				{
					int num1026 = 16;
					int num1027 = 320;
					if (type == 670)
					{
						num1027 -= (int)Math.Abs(localAI[1]) * 64;
					}
					for (; num1026 < num1027 && !Collision.SolidCollision(base.position + new Vector2(0f, (num1022 == -1) ? (height - num1026 - 16) : 0), width, num1026 + 16); num1026 += 16)
					{
					}
					if (num1022 == -1)
					{
						base.position.Y += height;
						height = num1026;
						base.position.Y -= num1026;
					}
					else
					{
						height = num1026;
					}
				}
				this.ai[1]++;
				if (type == 670 && owner == Main.myPlayer && this.ai[1] == 12f && localAI[1] < 3f && localAI[1] > -3f)
				{
					if (localAI[1] == 0f)
					{
						int num1028 = NewProjectile(GetProjectileSource_FromThis(), base.Bottom + new Vector2(-50f, -10f), -Vector2.UnitY, type, damage, knockBack, owner);
						Main.projectile[num1028].localAI[1] = localAI[1] - 1f;
						num1028 = NewProjectile(GetProjectileSource_FromThis(), base.Bottom + new Vector2(50f, -10f), -Vector2.UnitY, type, damage, knockBack, owner);
						Main.projectile[num1028].localAI[1] = localAI[1] + 1f;
					}
					else
					{
						int num1029 = Math.Sign(localAI[1]);
						int num1030 = NewProjectile(GetProjectileSource_FromThis(), base.Bottom + new Vector2(50 * num1029, -10f), -Vector2.UnitY, type, damage, knockBack, owner);
						Main.projectile[num1030].localAI[1] = localAI[1] + (float)num1029;
					}
				}
				if (this.ai[1] >= 60f)
				{
					Kill();
				}
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					for (int num1031 = 0; (float)num1031 < 60f; num1031++)
					{
						int num1032 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
						int num1033 = Dust.NewDust(base.position, width, height, num1032, 0f, -2.5f * (float)(-num1022));
						Main.dust[num1033].alpha = 200;
						Dust dust2 = Main.dust[num1033];
						dust2.velocity *= new Vector2(0.3f, 2f);
						Main.dust[num1033].velocity.Y += 2 * num1022;
						dust2 = Main.dust[num1033];
						dust2.scale += Main.rand.NextFloat();
						Main.dust[num1033].position = new Vector2(base.Center.X, base.Center.Y + (float)height * 0.5f * (float)(-num1022));
						Main.dust[num1033].customData = num1023;
						if (num1022 == -1 && Main.rand.Next(4) != 0)
						{
							Main.dust[num1033].velocity.Y -= 0.2f;
						}
					}
					SoundEngine.PlaySound(SoundID.Item34, base.position);
				}
				if (num1022 == 1)
				{
					for (int num1034 = 0; (float)num1034 < 9f; num1034++)
					{
						int num1035 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
						int num1036 = Dust.NewDust(base.position, width, height, num1035, 0f, -2.5f * (float)(-num1022));
						Main.dust[num1036].alpha = 200;
						Dust dust2 = Main.dust[num1036];
						dust2.velocity *= new Vector2(0.3f, 2f);
						Main.dust[num1036].velocity.Y += 2 * num1022;
						dust2 = Main.dust[num1036];
						dust2.scale += Main.rand.NextFloat();
						Main.dust[num1036].position = new Vector2(base.Center.X, base.Center.Y + (float)height * 0.5f * (float)(-num1022));
						Main.dust[num1036].customData = num1023;
						if (num1022 == -1 && Main.rand.Next(4) != 0)
						{
							Main.dust[num1036].velocity.Y -= 0.2f;
						}
					}
				}
				int num1037 = (int)(this.ai[1] / 60f * (float)height) * 3;
				if (num1037 > height)
				{
					num1037 = height;
				}
				Vector2 vector164 = base.position + ((num1022 == -1) ? new Vector2(0f, height - num1037) : Vector2.Zero);
				Vector2 vector165 = base.position + ((num1022 == -1) ? new Vector2(0f, height) : Vector2.Zero);
				for (int num1038 = 0; (float)num1038 < 6f; num1038++)
				{
					if (Main.rand.Next(3) < 2)
					{
						int num1039 = Dust.NewDust(vector164, width, num1037, 6, 0f, 0f, 90, default(Color), 2.5f);
						Main.dust[num1039].noGravity = true;
						Main.dust[num1039].fadeIn = 1f;
						if (Main.dust[num1039].velocity.Y > 0f)
						{
							Main.dust[num1039].velocity.Y *= -1f;
						}
						if (Main.rand.Next(6) < 3)
						{
							Main.dust[num1039].position.Y = MathHelper.Lerp(Main.dust[num1039].position.Y, vector165.Y, 0.5f);
							Dust dust2 = Main.dust[num1039];
							dust2.velocity *= 5f;
							Main.dust[num1039].velocity.Y -= 3f;
							Main.dust[num1039].position.X = base.Center.X;
							Main.dust[num1039].noGravity = false;
							Main.dust[num1039].noLight = true;
							Main.dust[num1039].fadeIn = 0.4f;
							dust2 = Main.dust[num1039];
							dust2.scale *= 0.3f;
						}
						else
						{
							Main.dust[num1039].velocity = DirectionFrom(Main.dust[num1039].position) * Main.dust[num1039].velocity.Length() * 0.25f;
						}
						Main.dust[num1039].velocity.Y *= -num1022;
						Main.dust[num1039].customData = num1023;
					}
				}
				for (int num1040 = 0; (float)num1040 < 6f; num1040++)
				{
					if (!(Main.rand.NextFloat() < 0.5f))
					{
						int num1041 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
						int num1042 = Dust.NewDust(vector164, width, num1037, num1041, 0f, -2.5f * (float)(-num1022));
						Main.dust[num1042].alpha = 200;
						Dust dust2 = Main.dust[num1042];
						dust2.velocity *= new Vector2(0.6f, 1.5f);
						dust2 = Main.dust[num1042];
						dust2.scale += Main.rand.NextFloat();
						if (num1022 == -1 && Main.rand.Next(4) != 0)
						{
							Main.dust[num1042].velocity.Y -= 0.2f;
						}
						Main.dust[num1042].customData = num1023;
					}
				}
			}
			else if (aiStyle == 127)
			{
				float num1043 = 900f;
				if (type == 657)
				{
					num1043 = 300f;
				}
				if (soundDelay == 0)
				{
					soundDelay = -1;
					SoundEngine.PlaySound(SoundID.Item82, base.Center);
				}
				this.ai[0]++;
				if (this.ai[0] >= num1043)
				{
					Kill();
				}
				if (type == 656 && localAI[0] >= 30f)
				{
					damage = 0;
					if (this.ai[0] < num1043 - 120f)
					{
						float num1044 = this.ai[0] % 60f;
						this.ai[0] = num1043 - 120f + num1044;
						netUpdate = true;
					}
				}
				float num1045 = 15f;
				float num1046 = 15f;
				Point point7 = base.Center.ToTileCoordinates();
				Collision.ExpandVertically(point7.X, point7.Y, out var topY, out var bottomY, (int)num1045, (int)num1046);
				topY++;
				bottomY--;
				Vector2 value20 = new Vector2(point7.X, topY) * 16f + new Vector2(8f);
				Vector2 value21 = new Vector2(point7.X, bottomY) * 16f + new Vector2(8f);
				Vector2 vector166 = Vector2.Lerp(value20, value21, 0.5f);
				Vector2 vector167 = new Vector2(0f, value21.Y - value20.Y);
				vector167.X = vector167.Y * 0.2f;
				width = (int)(vector167.X * 0.65f);
				height = (int)vector167.Y;
				base.Center = vector166;
				if (type == 656 && owner == Main.myPlayer)
				{
					bool flag68 = false;
					Vector2 center19 = Main.player[owner].Center;
					Vector2 top = Main.player[owner].Top;
					for (float num1047 = 0f; num1047 < 1f; num1047 += 0.05f)
					{
						Vector2 position = Vector2.Lerp(value20, value21, num1047);
						if (Collision.CanHitLine(position, 0, 0, center19, 0, 0) || Collision.CanHitLine(position, 0, 0, top, 0, 0))
						{
							flag68 = true;
							break;
						}
					}
					if (!flag68 && this.ai[0] < num1043 - 120f)
					{
						float num1048 = this.ai[0] % 60f;
						this.ai[0] = num1043 - 120f + num1048;
						netUpdate = true;
					}
				}
				if (!(this.ai[0] < num1043 - 120f))
				{
					return;
				}
				for (int num1049 = 0; num1049 < 1; num1049++)
				{
					float value22 = -0.5f;
					float value23 = 0.9f;
					float amount3 = Main.rand.NextFloat();
					Vector2 vector168 = new Vector2(MathHelper.Lerp(0.1f, 1f, Main.rand.NextFloat()), MathHelper.Lerp(value22, value23, amount3));
					vector168.X *= MathHelper.Lerp(2.2f, 0.6f, amount3);
					vector168.X *= -1f;
					Vector2 vector169 = new Vector2(6f, 10f);
					Vector2 vector170 = vector166 + vector167 * vector168 * 0.5f + vector169;
					Dust dust57 = Main.dust[Dust.NewDust(vector170, 0, 0, 269)];
					dust57.position = vector170;
					dust57.customData = vector166 + vector169;
					dust57.fadeIn = 1f;
					dust57.scale = 0.3f;
					if (vector168.X > -1.2f)
					{
						dust57.velocity.X = 1f + Main.rand.NextFloat();
					}
					dust57.velocity.Y = Main.rand.NextFloat() * -0.5f - 1f;
				}
			}
			else if (aiStyle == 128)
			{
				Color newColor4 = new Color(255, 255, 255);
				if (soundDelay == 0)
				{
					soundDelay = -1;
					SoundEngine.PlaySound(SoundID.Item60, base.Center);
				}
				if (localAI[1] < 30f)
				{
					for (int num1050 = 0; num1050 < 1; num1050++)
					{
						float value24 = -0.5f;
						float value25 = 0.9f;
						float amount4 = Main.rand.NextFloat();
						Vector2 vector171 = new Vector2(MathHelper.Lerp(0.1f, 1f, Main.rand.NextFloat()), MathHelper.Lerp(value24, value25, amount4));
						vector171.X *= MathHelper.Lerp(2.2f, 0.6f, amount4);
						vector171.X *= -1f;
						Vector2 vector172 = new Vector2(2f, 10f);
						Vector2 vector173 = base.Center + new Vector2(60f, 200f) * vector171 * 0.5f + vector172;
						Dust dust58 = Main.dust[Dust.NewDust(vector173, 0, 0, 269)];
						dust58.position = vector173;
						dust58.customData = base.Center + vector172;
						dust58.fadeIn = 1f;
						dust58.scale = 0.3f;
						if (vector171.X > -1.2f)
						{
							dust58.velocity.X = 1f + Main.rand.NextFloat();
						}
						dust58.velocity.Y = Main.rand.NextFloat() * -0.5f - 1f;
					}
				}
				if (localAI[0] == 0f)
				{
					localAI[0] = 0.8f;
					direction = 1;
					Point point8 = base.Center.ToTileCoordinates();
					base.Center = new Vector2(point8.X * 16 + 8, point8.Y * 16 + 8);
				}
				rotation = localAI[1] / 40f * (MathF.PI * 2f) * (float)direction;
				if (localAI[1] < 33f)
				{
					if (alpha > 0)
					{
						alpha -= 8;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				if (localAI[1] > 103f)
				{
					if (alpha < 255)
					{
						alpha += 16;
					}
					if (alpha > 255)
					{
						alpha = 255;
					}
				}
				if (alpha == 0)
				{
					Lighting.AddLight(base.Center, newColor4.ToVector3() * 0.5f);
				}
				for (int num1051 = 0; num1051 < 2; num1051++)
				{
					if (Main.rand.Next(10) == 0)
					{
						Vector2 vector174 = Vector2.UnitY.RotatedBy((float)num1051 * MathF.PI).RotatedBy(rotation);
						Dust dust59 = Main.dust[Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 225, newColor4, 1.5f)];
						dust59.noGravity = true;
						dust59.noLight = true;
						dust59.scale = Opacity * localAI[0];
						dust59.position = base.Center;
						dust59.velocity = vector174 * 2.5f;
					}
				}
				for (int num1052 = 0; num1052 < 2; num1052++)
				{
					if (Main.rand.Next(10) == 0)
					{
						Vector2 vector175 = Vector2.UnitY.RotatedBy((float)num1052 * MathF.PI);
						Dust dust60 = Main.dust[Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 225, newColor4, 1.5f)];
						dust60.noGravity = true;
						dust60.noLight = true;
						dust60.scale = Opacity * localAI[0];
						dust60.position = base.Center;
						dust60.velocity = vector175 * 2.5f;
					}
				}
				if (localAI[1] < 33f || localAI[1] > 87f)
				{
					scale = Opacity / 2f * localAI[0];
				}
				velocity = Vector2.Zero;
				localAI[1]++;
				if (localAI[1] == 60f && owner == Main.myPlayer)
				{
					int num1053 = 30;
					if (Main.expertMode)
					{
						num1053 = 22;
					}
					NewProjectile(GetProjectileSource_FromThis(), base.Center, Vector2.Zero, 657, num1053, 3f, owner);
				}
				if (localAI[1] >= 120f)
				{
					Kill();
				}
			}
			else if (aiStyle == 129)
			{
				float num1054 = 10f;
				float num1055 = 5f;
				float num1056 = 40f;
				int num1057 = 300;
				int num1058 = 180;
				if (type == 659)
				{
					num1057 = 420;
					num1058 = 240;
					num1054 = 3f;
					num1055 = 7.5f;
					num1056 = 1f;
					if (localAI[0] > 0f)
					{
						localAI[0]--;
					}
					if (localAI[0] == 0f && this.ai[0] < 0f && owner == Main.myPlayer)
					{
						localAI[0] = 5f;
						for (int num1059 = 0; num1059 < 200; num1059++)
						{
							NPC nPC15 = Main.npc[num1059];
							if (nPC15.CanBeChasedBy(this))
							{
								bool flag69 = this.ai[0] < 0f || Main.npc[(int)this.ai[0]].Distance(base.Center) > nPC15.Distance(base.Center);
								if ((flag69 & (nPC15.Distance(base.Center) < 400f)) && (Collision.CanHitLine(base.Center, 0, 0, nPC15.Center, 0, 0) || Collision.CanHitLine(base.Center, 0, 0, nPC15.Top, 0, 0)))
								{
									this.ai[0] = num1059;
								}
							}
						}
						if (this.ai[0] >= 0f)
						{
							timeLeft = num1057;
							netUpdate = true;
						}
					}
					if (timeLeft > 30 && alpha > 0)
					{
						alpha -= 12;
					}
					if (timeLeft > 30 && alpha < 128 && Collision.SolidCollision(base.position, width, height))
					{
						alpha = 128;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (++frameCounter > 4)
					{
						frameCounter = 0;
						if (++frame >= 4)
						{
							frame = 0;
						}
					}
					float num1060 = 0.5f;
					if (timeLeft < 120)
					{
						num1060 = 1.1f;
					}
					if (timeLeft < 60)
					{
						num1060 = 1.6f;
					}
					this.ai[1]++;
					float num1061 = this.ai[1] / 180f * (MathF.PI * 2f);
					for (float num1062 = 0f; num1062 < 3f; num1062++)
					{
						if (Main.rand.Next(3) == 0)
						{
							Dust dust61 = Main.dust[Dust.NewDust(base.Center, 0, 0, 27, 0f, -2f)];
							dust61.position = base.Center + Vector2.UnitY.RotatedBy(num1062 * (MathF.PI * 2f) / 3f + this.ai[1]) * 10f;
							dust61.noGravity = true;
							dust61.velocity = DirectionFrom(dust61.position);
							dust61.scale = num1060;
							dust61.fadeIn = 0.5f;
							dust61.alpha = 200;
						}
					}
				}
				if (timeLeft > 2 && Collision.SolidCollision(base.position, width, height))
				{
					timeLeft = 2;
				}
				int num1063 = (int)this.ai[0];
				if (num1063 >= 0 && Main.npc[num1063].active)
				{
					if (Distance(Main.npc[num1063].Center) > num1056)
					{
						Vector2 vector176 = DirectionTo(Main.npc[num1063].Center);
						if (vector176.HasNaNs())
						{
							vector176 = Vector2.UnitY;
						}
						velocity = (velocity * (num1054 - 1f) + vector176 * num1055) / num1054;
					}
					return;
				}
				if (this.ai[0] == -1f && timeLeft > 5)
				{
					timeLeft = 5;
				}
				if (this.ai[0] == -2f && timeLeft > num1058)
				{
					timeLeft = num1058;
				}
				if (this.ai[0] >= 0f)
				{
					this.ai[0] = -1f;
					netUpdate = true;
				}
			}
			else if (aiStyle == 130)
			{
				AI_130_FlameBurstTower();
			}
			else if (aiStyle == 131)
			{
				AI_131_FlameBurstShot();
			}
			else if (aiStyle == 132)
			{
				if (localAI[1] == 0f)
				{
					if (localAI[0] == 0f)
					{
						SoundEngine.PlayTrackedSound(SoundID.DD2_DefeatScene, base.Center);
					}
					if (localAI[0] == 105f)
					{
						for (int num1064 = 0; num1064 < 20; num1064++)
						{
							float num1065 = (float)num1064 / 20f;
							Vector2 vector177 = new Vector2(Main.rand.NextFloat() * 10f, 0f).RotatedBy(num1065 * -MathF.PI + Main.rand.NextFloat() * 0.1f - 0.05f);
							Gore gore2 = Gore.NewGoreDirect(base.Center + vector177 * 3f, vector177, Utils.SelectRandom<int>(Main.rand, 1027, 1028, 1029, 1030));
							if (gore2.velocity.Y > 0f)
							{
								Gore gore = gore2;
								gore.velocity *= -0.5f;
							}
							if (gore2.velocity.Y < -5f)
							{
								gore2.velocity.Y *= 0.8f;
							}
							gore2.velocity.Y *= 1.1f;
							gore2.velocity.X *= 0.88f;
						}
					}
					if (!Main.dedServ)
					{
						if (!Filters.Scene["CrystalDestructionVortex"].IsActive())
						{
							Filters.Scene.Activate("CrystalDestructionVortex", default(Vector2));
						}
						if (!Filters.Scene["CrystalDestructionColor"].IsActive())
						{
							Filters.Scene.Activate("CrystalDestructionColor", default(Vector2));
						}
						float num1066 = Math.Min(1f, localAI[0] / 120f);
						Filters.Scene["CrystalDestructionColor"].GetShader().UseIntensity(num1066);
						Filters.Scene["CrystalDestructionVortex"].GetShader().UseIntensity(num1066 * 2f).UseProgress(0f)
							.UseTargetPosition(base.Center);
					}
					if (localAI[0] == 120f)
					{
						localAI[0] = 0f;
						localAI[1]++;
					}
				}
				else if (localAI[1] == 1f)
				{
					if (!Main.dedServ)
					{
						float num1067 = localAI[0] / 300f;
						float num1068 = Math.Min(1f, localAI[0] / 150f);
						velocity.Y = num1068 * -0.25f;
						if (!Filters.Scene["CrystalDestructionVortex"].IsActive())
						{
							Filters.Scene.Activate("CrystalDestructionVortex", default(Vector2));
						}
						if (!Filters.Scene["CrystalDestructionColor"].IsActive())
						{
							Filters.Scene.Activate("CrystalDestructionColor", default(Vector2));
						}
						num1068 = 1f;
						Filters.Scene["CrystalDestructionColor"].GetShader().UseIntensity(num1068);
						Filters.Scene["CrystalDestructionVortex"].GetShader().UseIntensity(num1068 * 2f).UseProgress(0f)
							.UseTargetPosition(base.Center);
					}
					if (localAI[0] == 300f)
					{
						localAI[0] = 0f;
						localAI[1]++;
					}
				}
				else if (localAI[1] == 2f)
				{
					float num1069 = localAI[0] / 300f;
					if (Main.netMode != 2)
					{
						Filters.Scene["CrystalDestructionVortex"].GetShader().UseIntensity(2f).UseProgress(num1069 * 30f);
					}
					velocity.Y -= 1f;
					if (localAI[0] == 60f)
					{
						localAI[0] = 0f;
						localAI[1]++;
					}
				}
				else if (localAI[1] == 3f)
				{
					if (!Main.dedServ)
					{
						Filters.Scene.Deactivate("CrystalDestructionVortex");
						Filters.Scene.Deactivate("CrystalDestructionColor");
					}
					Kill();
				}
				if (localAI[1] >= 1f)
				{
					for (int num1070 = 0; num1070 < 1 + (int)(0f - velocity.Y); num1070++)
					{
						if (Main.rand.Next(2) == 0)
						{
							float num1071 = Main.rand.NextFloat() * (0f - velocity.Y);
							Vector2 vector178 = new Vector2(Main.rand.NextFloat() * 0.1f - 0.05f, 0f);
							vector178.X += (float)Math.Sin((double)((base.position.Y + num1071) * 0.01f) + 6.2831854820251465 * ((double)Main.rand.Next(3) / 3.0)) * 0.5f;
							vector178.X = MathHelper.Lerp(Main.rand.NextFloat() - 0.5f, vector178.X, MathHelper.Clamp(0f - velocity.Y, 0f, 1f));
							vector178.Y = 0.5f - Math.Abs(vector178.X);
							vector178 *= new Vector2(100f, 50f);
							vector178.Y += num1071;
							Vector2 vector179 = base.Center + vector178;
							Dust dust62 = Dust.NewDustPerfect(vector179, 27, Vector2.Zero, 0, Color.White * 0.1f, 1.1f);
							dust62.velocity.Y = Main.rand.NextFloat() * 2f;
							dust62.fadeIn = 0.1f;
						}
					}
				}
				localAI[0]++;
			}
			else if (aiStyle == 133)
			{
				if (type == 673)
				{
					if (this.ai[0] == 70f)
					{
						SoundEngine.PlayTrackedSound(SoundID.DD2_SkeletonSummoned, base.Center);
					}
					this.ai[0]++;
					float opacity = 0f;
					if (this.ai[0] < 20f)
					{
						opacity = Utils.GetLerpValue(0f, 20f, this.ai[0], clamped: true);
					}
					else if (this.ai[0] < 60f)
					{
						opacity = 1f;
					}
					else if (this.ai[0] < 80f)
					{
						opacity = Utils.GetLerpValue(80f, 60f, this.ai[0], clamped: true);
					}
					else
					{
						Kill();
					}
					Opacity = opacity;
					_ = owner;
					_ = Main.myPlayer;
				}
				if (type != 674)
				{
					return;
				}
				if (this.ai[0] == 0f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_DarkMageHealImpact, base.Center);
				}
				this.ai[0]++;
				if (!(this.ai[0] >= 40f))
				{
					return;
				}
				for (int num1072 = 0; num1072 < 200; num1072++)
				{
					NPC nPC16 = Main.npc[num1072];
					if (nPC16.active && nPC16.damage >= 1 && nPC16.lifeMax >= 30 && !(Distance(nPC16.Center) > 1000f) && nPC16.type != 564 && nPC16.type != 565)
					{
						int num1073 = 500;
						int num1074 = nPC16.lifeMax - nPC16.life;
						if (num1073 > num1074)
						{
							num1073 = num1074;
						}
						if (num1073 > 0)
						{
							NPC nPC11 = nPC16;
							nPC11.life += num1073;
							nPC16.HealEffect(num1073);
							nPC16.netUpdate = true;
						}
					}
				}
				Kill();
			}
			else if (aiStyle == 134)
			{
				AI_134_Ballista();
			}
			else if (aiStyle == 135)
			{
				AI_135_OgreStomp();
			}
			else if (aiStyle == 136)
			{
				AI_136_BetsyBreath();
			}
			else if (aiStyle == 137)
			{
				AI_137_LightningAura();
			}
			else if (aiStyle == 138)
			{
				AI_138_ExplosiveTrap();
			}
			else if (aiStyle == 139)
			{
				AI_139_ExplosiveTrapExplosion();
			}
			else if (aiStyle == 140)
			{
				AI_140_MonkStaffT1();
			}
			else if (aiStyle == 141)
			{
				AI_141_MonkStaffT1Explosion();
			}
			else if (aiStyle == 142)
			{
				AI_142_MonkStaffT2And3();
			}
			else if (aiStyle == 143)
			{
				AI_143_MonkStaffT2Ghast();
			}
			else if (aiStyle == 144)
			{
				AI_144_DD2Pet();
			}
			else if (aiStyle == 145)
			{
				AI_145_BookStaffStorm();
			}
			else if (aiStyle == 146)
			{
				AI_146_DD2Victory();
			}
			else if (aiStyle == 147)
			{
				AI_147_Celeb2Rocket();
			}
			else if (aiStyle == 148)
			{
				AI_148_StarSpawner();
			}
			else if (aiStyle == 149)
			{
				AI_149_GolfBall();
			}
			else if (aiStyle == 150)
			{
				AI_150_GolfClubHelper();
			}
			else if (aiStyle == 151)
			{
				AI_151_SuperStar();
			}
			else if (aiStyle == 152)
			{
				AI_152_SuperStarSlash();
			}
			else if (aiStyle == 153)
			{
				AI_153_ToiletPop();
			}
			else if (aiStyle == 154)
			{
				AI_154_VoidLens();
			}
			else if (aiStyle == 155)
			{
				AI_155_MysticSnakeCoil();
			}
			else if (aiStyle == 156)
			{
				AI_156_BatOfLight();
			}
			else if (aiStyle == 157)
			{
				AI_157_SharpTears();
			}
			else if (aiStyle == 158)
			{
				AI_158_BabyBird();
			}
			else if (aiStyle == 159)
			{
				AI_159_PaperAirplanes();
			}
			else if (aiStyle == 160)
			{
				AI_160_Kites();
			}
			else if (aiStyle == 161)
			{
				AI_161_RapierStabs();
			}
			else if (aiStyle == 162)
			{
				AI_162_TigerPounce();
			}
			else if (aiStyle == 163)
			{
				AI_163_Chum();
			}
			else if (aiStyle == 164)
			{
				AI_164_StormTigerGem();
			}
			else if (aiStyle == 165)
			{
				AI_165_Whip();
			}
			else if (aiStyle == 166)
			{
				AI_166_Dove();
			}
			else if (aiStyle == 167)
			{
				AI_167_SparkleGuitar();
			}
			else if (aiStyle == 168)
			{
				AI_168_FirstFractal();
			}
			else if (aiStyle == 169)
			{
				AI_169_Smolstars();
			}
			else if (aiStyle == 170)
			{
				AI_170_FairyGlowstick();
			}
			else if (aiStyle == 171)
			{
				AI_171_HallowBossRainbowStreak();
			}
			else if (aiStyle == 172)
			{
				AI_172_HallowBossRainbowPelletStorm();
			}
			else if (aiStyle == 173)
			{
				AI_173_HallowBossRainbowTrail();
			}
			else if (aiStyle == 174)
			{
				AI_174_MultisegmentPet();
			}
			else if (aiStyle == 175)
			{
				AI_175_TitaniumStormShards();
			}
			else if (aiStyle == 176)
			{
				AI_176_EdgyLightning();
			}
			else if (aiStyle == 177)
			{
				AI_177_IceWhipSlicer();
			}
			else if (aiStyle == 178)
			{
				AI_178_FireExplosion();
			}
			else if (aiStyle == 179)
			{
				AI_179_FairyQueenLance();
			}
			else if (aiStyle == 180)
			{
				AI_180_FairyQueenSunDance();
			}
			else if (aiStyle == 181)
			{
				AI_181_FairyQueenRangedItemShot();
			}
			else if (aiStyle == 182)
			{
				AI_182_FinalFractal();
			}
			else if (aiStyle == 183)
			{
				AI_183_ZoologistStrike();
			}
			else if (aiStyle == 184)
			{
				AI_184_BadTorchLuck();
			}
			else if (aiStyle == 185)
			{
				AI_185_LifeDrain();
			}
			else if (aiStyle == 186)
			{
				AI_186_PrincessWeapon();
			}
			else if (aiStyle == 187)
			{
				AI_187_ShadowHand();
			}
			else if (aiStyle == 188)
			{
				AI_188_LightsBane();
			}
			else if (aiStyle == 189)
			{
				AI_189_Volcano();
			}
			else if (aiStyle == 190)
			{
				AI_190_NightsEdge();
			}
			else if (aiStyle == 191)
			{
				AI_191_TrueNightsEdge();
			}
			else if (aiStyle == 192)
			{
				AI_192_JuminoAnimation();
			}
			else if (aiStyle == 193)
			{
				AI_193_Flamethrower();
			}
			else if (aiStyle == 194)
			{
				AI_194_HorsemanPumpkin();
			}
			else if (aiStyle == 195)
			{
				AI_195_JimsDrone();
			}
		}

		private void AI_195_JimsDrone()
		{
			//IL_0219: Unknown result type (might be due to invalid IL or missing references)
			//IL_0255: Unknown result type (might be due to invalid IL or missing references)
			//IL_025a: Unknown result type (might be due to invalid IL or missing references)
			//IL_026c: Unknown result type (might be due to invalid IL or missing references)
			Player player = Main.player[owner];
			bool flag = false;
			if (player.dead)
			{
				flag = true;
			}
			if (owner == Main.myPlayer)
			{
				if (player.HeldItem.type != 5451)
				{
					flag = true;
				}
				bool flag2 = player.gravDir == -1f;
				BitsByte bitsByte = (byte)0;
				Player.DirectionalInputSyncCache localInputCache = player.LocalInputCache;
				bitsByte[0] = localInputCache.controlLeft ^ flag2;
				bitsByte[1] = localInputCache.controlRight ^ flag2;
				bitsByte[2] = localInputCache.controlUp;
				bitsByte[3] = localInputCache.controlDown;
				float num = (int)(byte)bitsByte;
				if (ai[0] != num)
				{
					ai[0] = num;
					netUpdate = true;
				}
				Main.DroneCameraTracker.Track(this);
			}
			if (flag)
			{
				Kill();
				return;
			}
			BitsByte bitsByte2 = (byte)ai[0];
			rotation = ai[1];
			bool flag3 = bitsByte2[0];
			bool flag4 = bitsByte2[1];
			bool flag5 = bitsByte2[2];
			_ = bitsByte2[3];
			localAI[0] += 1f;
			if (!flag3 && !flag4)
			{
				localAI[0] = 0f;
			}
			bool flag6 = velocity.Y == 0f;
			int num2 = 0;
			if (!flag6)
			{
				num2 = 10;
			}
			if (flag5)
			{
				num2 = 100;
			}
			localAI[1] = MathHelper.Lerp(localAI[1], num2, 0.2f);
			float num3 = Utils.Remap(localAI[0], 0f, 5f, 0f, 1f) * Utils.Remap(localAI[0], 5f, 15f, 1f, 0f);
			float num4 = Utils.Clamp(MathHelper.Max(Utils.Remap(localAI[1], 0f, 100f, 0f, 25f), num3 * 12f), 0f, 100f);
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
			if (activeSound == null && num4 != 0f)
			{
				float[] array = localAI;
				SlotId val = SoundEngine.PlayTrackedLoopedSound(SoundID.JimsDrone, base.Center, new ProjectileAudioTracker(this).IsActiveAndInGame);
				array[2] = ((SlotId)(ref val)).ToFloat();
				activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]));
			}
			if (activeSound != null)
			{
				activeSound.Volume = num4;
				activeSound.Position = base.Center;
				activeSound.Pitch = Utils.Clamp(Utils.Remap(localAI[1], 0f, 100f, -1f, 1f) + num3, -1f, 1f);
			}
			float num5 = 0.15f;
			if (flag6)
			{
				rotation = MathHelper.WrapAngle(rotation) * 0.7f;
				velocity.X *= 0.97f;
				if (flag5)
				{
					Vector2 vector = (rotation - MathF.PI / 2f).ToRotationVector2();
					velocity += vector * 0.5f;
					num5 = 0.05f;
				}
			}
			else
			{
				float num6 = MathF.PI / 15f;
				num6 = Utils.Remap(localAI[0], 0f, 10f, num6 * 0.1f, num6);
				int num7 = flag4.ToInt() - flag3.ToInt();
				rotation += (float)num7 * num6;
				if (flag5)
				{
					Vector2 vector2 = (rotation - MathF.PI / 2f).ToRotationVector2();
					velocity.X *= 0.97f;
					velocity += vector2 * 0.5f;
				}
			}
			velocity.Y += num5;
			ai[1] = rotation;
			if (!flag5 && velocity.Y > 12f)
			{
				velocity.Y *= 0.95f;
			}
			if (velocity.Length() > 16f)
			{
				velocity *= 16f / velocity.Length();
			}
			Lighting.AddLight(base.Center, Vector3.One * 0.3f);
			timeLeft = 2;
			if (!flag6)
			{
				Vector2 vector3 = position;
				float num8 = 0f;
				int num9 = 3;
				int num10 = 16 * num9;
				for (int i = 0; i < num9; i++)
				{
					Vector2 vector4 = new Vector2(0f, 16f);
					Vector2 vector5 = Collision.TileCollision(vector3 + vector4 * i, vector4, width, height);
					num8 += vector5.Y;
					if (vector5 != vector4)
					{
						break;
					}
				}
				if (num8 != (float)num10)
				{
					for (int j = 0; j < 2; j++)
					{
						if (!(Main.rand.NextFloat() < 0.66f))
						{
							Vector2 vector6 = vector3 + new Vector2(0f, num8) + new Vector2((float)width / 2f, height);
							Vector2 value = Main.rand.NextVector2CircularEdge(2.5f, 1f) * 0.5f;
							if (value.Y > 0f)
							{
								value.Y *= -1f;
							}
							Dust.NewDustPerfect(vector6, (Main.rand.Next(2) == 0) ? 31 : 16, value, 127);
						}
					}
				}
			}
			if (Main.netMode == 2 && Main.player.IndexInRange(owner) && Main.player[owner].active)
			{
				RemoteClient.CheckSection(owner, position);
			}
		}

		public static void UseGasTrapInChest(int chestIndex, Chest theChest, int gasTrapIndex, int gasOffsetX, int gasOffsetY)
		{
			if (Main.netMode == 1)
			{
				return;
			}
			bool flag = false;
			int num = -1;
			for (int i = 0; i < 40; i++)
			{
				Item item = theChest.item[i];
				if (item == null)
				{
					continue;
				}
				if (item.IsAir)
				{
					if (num == -1)
					{
						num = i;
					}
				}
				else if (item.type == 5356 && item.stack < item.maxStack)
				{
					flag = true;
					item.stack++;
					if (Main.netMode != 0)
					{
						NetMessage.SendData(32, -1, -1, null, chestIndex, i);
					}
					break;
				}
			}
			theChest.item[gasTrapIndex].stack--;
			if (theChest.item[gasTrapIndex].stack <= 0)
			{
				if (flag)
				{
					theChest.item[gasTrapIndex].TurnToAir();
				}
				else
				{
					flag = true;
					theChest.item[gasTrapIndex].ChangeItemType(5356);
				}
			}
			if (Main.netMode != 0)
			{
				NetMessage.SendData(32, -1, -1, null, chestIndex, gasTrapIndex);
			}
			if (!flag && num > -1)
			{
				flag = true;
				theChest.item[num].ChangeItemType(5356);
				if (Main.netMode != 0)
				{
					NetMessage.SendData(32, -1, -1, null, chestIndex, num);
				}
			}
			if (!flag)
			{
				Item.NewItem(pos: new Vector2(theChest.x * 16 + gasOffsetX, theChest.y * 16 + gasOffsetY), source: new EntitySource_OverfullChest(theChest.x, theChest.y, theChest), randomBox: Vector2.One, Type: 5356);
			}
		}

		private void AI_111_DryadsWard()
		{
			if (!Main.npc[(int)ai[1]].active || Main.npc[(int)ai[1]].type != 20 || Main.npc[(int)ai[1]].ai[0] != 14f)
			{
				Kill();
				return;
			}
			ai[0] += 1f;
			rotation += MathF.PI / 300f;
			scale = ai[0] / 100f;
			if (scale > 1f)
			{
				scale = 1f;
			}
			alpha = (int)(255f * (1f - scale));
			float num = 300f;
			if (ai[0] >= 100f)
			{
				num = MathHelper.Lerp(300f, 600f, (ai[0] - 100f) / 200f);
			}
			if (num > 600f)
			{
				num = 600f;
			}
			if (ai[0] >= 500f)
			{
				alpha = (int)MathHelper.Lerp(0f, 255f, (ai[0] - 500f) / 100f);
				num = MathHelper.Lerp(600f, 1200f, (ai[0] - 500f) / 100f);
				rotation += MathF.PI / 300f;
			}
			int num2 = 163;
			if (ai[2] == 1f)
			{
				float num3 = (float)Math.Sin(ai[0] % 120f * (MathF.PI * 2f) / 120f) * 0.5f + 0.5f;
				if (Main.rand.NextFloat() < num3)
				{
					num2 = 70;
				}
			}
			if (Main.rand.Next(4) == 0)
			{
				float num4 = num;
				Vector2 vector = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
				float num5 = Main.rand.Next(3, 9);
				vector.Normalize();
				int num6 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num2, 0f, 0f, 100);
				Main.dust[num6].noGravity = true;
				Main.dust[num6].position = base.Center + vector * num4;
				if (Main.rand.Next(8) == 0)
				{
					Main.dust[num6].velocity = vector * (0f - num5) * 3f;
					Main.dust[num6].scale += 0.5f;
				}
				else
				{
					Main.dust[num6].velocity = vector * (0f - num5);
				}
			}
			if (Main.rand.Next(2) == 0)
			{
				Vector2 vector2 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
				float num7 = Main.rand.Next(3, 9);
				vector2.Normalize();
				int num8 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num2, 0f, 0f, 100, default(Color), 1.5f);
				Main.dust[num8].noGravity = true;
				Main.dust[num8].position = base.Center + vector2 * 30f;
				if (Main.rand.Next(8) == 0)
				{
					Main.dust[num8].velocity = vector2 * (0f - num7) * 3f;
					Main.dust[num8].scale += 0.5f;
				}
				else
				{
					Main.dust[num8].velocity = vector2 * (0f - num7);
				}
			}
			if (ai[0] >= 30f && Main.netMode != 2)
			{
				Player player = Main.player[Main.myPlayer];
				if (player.active && !player.dead && Distance(player.Center) <= num && player.FindBuffIndex(165) == -1)
				{
					player.AddBuff(165, 120);
				}
			}
			if (ai[0] >= 30f && ai[0] % 10f == 0f && Main.netMode != 1)
			{
				for (int i = 0; i < 200; i++)
				{
					NPC nPC = Main.npc[i];
					if (nPC.type != 488 && nPC.active && Distance(nPC.Center) <= num)
					{
						if (nPC.townNPC && (nPC.FindBuffIndex(165) == -1 || nPC.buffTime[nPC.FindBuffIndex(165)] <= 20))
						{
							nPC.AddBuff(165, 120);
						}
						else if (!nPC.friendly && nPC.lifeMax > 5 && !nPC.dontTakeDamage && (nPC.FindBuffIndex(186) == -1 || nPC.buffTime[nPC.FindBuffIndex(186)] <= 20) && (nPC.dryadBane || Collision.CanHit(base.Center, 1, 1, nPC.position, nPC.width, nPC.height)))
						{
							nPC.AddBuff(186, 120);
						}
					}
				}
			}
			if (ai[0] >= 570f)
			{
				Kill();
			}
		}

		public static bool GasTrapCheck(int x, int y, Player user)
		{
			if (Main.netMode == 1)
			{
				return false;
			}
			int num = Chest.FindChest(x, y);
			if (num < 0)
			{
				return false;
			}
			Chest chest = Main.chest[num];
			int num2 = 16;
			int num3 = 16;
			bool flag = false;
			for (int i = 0; i < 40; i++)
			{
				ushort num4 = Main.tile[chest.x, chest.y].type;
				if (TileObjectData.CustomPlace(num4, 0))
				{
					TileObjectData tileData = TileObjectData.GetTileData(num4, 0);
					if (tileData != null)
					{
						int num5 = (int)Math.Ceiling((float)tileData.Width / 2f);
						int num6 = (int)Math.Ceiling((float)tileData.Width / 2f);
						num2 = num5 * 16;
						num3 = num6 * 16;
						if (num5 % 2 != 0)
						{
							num2 += 8;
						}
						if (num6 % 2 != 0)
						{
							num3 += 8;
						}
					}
				}
				if (chest.item[i] != null && chest.item[i].type == 5346)
				{
					UseGasTrapInChest(num, chest, i, num2, num3);
					flag = true;
					break;
				}
			}
			if (flag)
			{
				num3 -= 8;
				NewProjectile(position: new Vector2(x * 16 + num2, y * 16 + num3), spawnSource: user.GetProjectileSource_TileInteraction(x, y), velocity: Vector2.Zero, Type: 1007, Damage: 10, KnockBack: 0f, Owner: Main.myPlayer);
			}
			return flag;
		}

		private void AI_194_HorsemanPumpkin()
		{
			int num = (int)ai[0];
			Vector2 center = base.Center;
			if (Main.player.IndexInRange(num))
			{
				Player player = Main.player[num];
				if (player.active && !player.dead)
				{
					center = player.Center;
				}
			}
			Vector2 vector = center - base.Center;
			int num2 = 30;
			float num3 = 4f;
			float num4 = 5f;
			float num5 = 0.4f;
			float num6 = 0.4f;
			if (!(vector.Y < (float)num2) || !(vector.Y > (float)(-num2)))
			{
				float num7 = (float)Math.Sign(vector.Y) * num6;
				velocity.Y = Utils.Clamp(velocity.Y + num7, 0f - num4, num4);
			}
			velocity.X = Utils.Clamp(velocity.X + (float)Math.Sign(vector.X) * num5, 0f - num3, num3);
			rotation = velocity.ToRotation();
			spriteDirection = ((!(velocity.X < 0f)) ? 1 : (-1));
			if (timeLeft < 6)
			{
				Opacity -= 0.1f;
			}
			else
			{
				Opacity += 1f / 30f;
			}
			if (Main.rand.Next(3) != 0)
			{
				Dust dust = Dust.NewDustDirect(position, width, height, 6, velocity.X, velocity.Y);
				dust.scale = 0.6f;
				dust.fadeIn = 1.1f;
				dust.noGravity = true;
				dust.noLight = true;
			}
		}

		private void AI_193_Flamethrower()
		{
			localAI[0] += 1f;
			int num = 60;
			int num2 = 12;
			int num3 = num + num2;
			if (localAI[0] >= (float)num3)
			{
				Kill();
			}
			if (localAI[0] >= (float)num)
			{
				velocity *= 0.95f;
			}
			bool flag = ai[0] == 1f;
			int num4 = 50;
			int num5 = num4;
			if (flag)
			{
				num4 = 0;
				num5 = num;
			}
			if (localAI[0] < (float)num5 && Main.rand.NextFloat() < 0.25f)
			{
				short num6 = (short)(flag ? 135 : 6);
				Dust dust = Dust.NewDustDirect(base.Center + Main.rand.NextVector2Circular(60f, 60f) * Utils.Remap(localAI[0], 0f, 72f, 0.5f, 1f), 4, 4, num6, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
				if (Main.rand.Next(4) == 0)
				{
					dust.noGravity = true;
					dust.scale *= 3f;
					dust.velocity.X *= 2f;
					dust.velocity.Y *= 2f;
				}
				else
				{
					dust.scale *= 1.5f;
				}
				dust.scale *= 1.5f;
				dust.velocity *= 1.2f;
				dust.velocity += velocity * 1f * Utils.Remap(localAI[0], 0f, (float)num * 0.75f, 1f, 0.1f) * Utils.Remap(localAI[0], 0f, (float)num * 0.1f, 0.1f, 1f);
				dust.customData = 1;
			}
			if (num4 > 0 && localAI[0] >= (float)num4 && Main.rand.NextFloat() < 0.5f)
			{
				Vector2 center = Main.player[owner].Center;
				Vector2 vector = (base.Center - center).SafeNormalize(Vector2.Zero).RotatedByRandom(0.19634954631328583) * 7f;
				short num7 = 31;
				Dust dust2 = Dust.NewDustDirect(base.Center + Main.rand.NextVector2Circular(50f, 50f) - vector * 2f, 4, 4, num7, 0f, 0f, 150, new Color(80, 80, 80));
				dust2.noGravity = true;
				dust2.velocity = vector;
				dust2.scale *= 1.1f + Main.rand.NextFloat() * 0.2f;
				dust2.customData = -0.3f - 0.15f * Main.rand.NextFloat();
			}
		}

		private void AI_047_MagnetSphere()
		{
			if (ai[0] == 0f)
			{
				ai[0] = velocity.X;
				ai[1] = velocity.Y;
			}
			if (velocity.X > 0f)
			{
				rotation += (Math.Abs(velocity.Y) + Math.Abs(velocity.X)) * 0.001f;
			}
			else
			{
				rotation -= (Math.Abs(velocity.Y) + Math.Abs(velocity.X)) * 0.001f;
			}
			frameCounter++;
			if (frameCounter > 6)
			{
				frameCounter = 0;
				frame++;
				if (frame > 4)
				{
					frame = 0;
				}
			}
			if (velocity.Length() > 2f)
			{
				velocity *= 0.98f;
			}
			for (int i = 0; i < 1000; i++)
			{
				if (i != whoAmI)
				{
					Projectile projectile = Main.projectile[i];
					if (projectile.active && projectile.owner == owner && projectile.type == type && timeLeft > Main.projectile[i].timeLeft && Main.projectile[i].timeLeft > 30)
					{
						Main.projectile[i].timeLeft = 30;
					}
				}
			}
			AI_047_MagnetSphere_TryAttacking();
		}

		private void AI_047_MagnetSphere_TryAttacking()
		{
			int[] array = new int[20];
			int num = 0;
			float num2 = 300f;
			bool flag = false;
			float num3 = 0f;
			float num4 = 0f;
			for (int i = 0; i < 200; i++)
			{
				if (!Main.npc[i].CanBeChasedBy(this))
				{
					continue;
				}
				float num5 = Main.npc[i].position.X + (float)(Main.npc[i].width / 2);
				float num6 = Main.npc[i].position.Y + (float)(Main.npc[i].height / 2);
				if (Math.Abs(position.X + (float)(width / 2) - num5) + Math.Abs(position.Y + (float)(height / 2) - num6) < num2 && Collision.CanHit(base.Center, 1, 1, Main.npc[i].Center, 1, 1))
				{
					if (num < 20)
					{
						array[num] = i;
						num++;
						num3 = num5;
						num4 = num6;
					}
					flag = true;
				}
			}
			if (timeLeft < 30)
			{
				flag = false;
			}
			if (flag)
			{
				int num7 = Main.rand.Next(num);
				num7 = array[num7];
				num3 = Main.npc[num7].position.X + (float)(Main.npc[num7].width / 2);
				num4 = Main.npc[num7].position.Y + (float)(Main.npc[num7].height / 2);
				localAI[0] += 1f;
				if (localAI[0] > 8f)
				{
					localAI[0] = 0f;
					Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					vector += velocity * 4f;
					float num8 = num3 - vector.X;
					float num9 = num4 - vector.Y;
					float num10 = (float)Math.Sqrt(num8 * num8 + num9 * num9);
					num10 = 6f / num10;
					num8 *= num10;
					num9 *= num10;
					NewProjectile(GetProjectileSource_FromThis(), vector.X, vector.Y, num8, num9, 255, damage, knockBack, owner);
				}
			}
		}

		public static void AI_192_GetJuminoFall(Projectile proj, out float timeSinceFall, out float fall)
		{
			int num = 420;
			timeSinceFall = proj.ai[0] - (float)num;
			if (timeSinceFall < 0f)
			{
				timeSinceFall = 0f;
			}
			int num2 = 24;
			int num3 = -4;
			float num4 = 0.2f;
			fall = (float)num3 * timeSinceFall + num4 * (timeSinceFall * timeSinceFall) / 2f;
			if (fall > (float)num2)
			{
				fall = num2;
			}
		}

		private void AI_192_JuminoAnimation()
		{
			float num = 120f;
			float num2 = 420f + num;
			float num3 = num2 - 150f;
			if (Opacity > 0f && Opacity < 1f)
			{
				for (int i = 0; i < 1; i++)
				{
					Rectangle r = Utils.CenteredRectangle(base.Center + new Vector2(0f, 20f), new Vector2(32f, 32f));
					Dust dust = Dust.NewDustDirect(r.TopLeft(), r.Width, r.Height, 263, 0f, 0f, 100, new Color(80, 200, 255), 0.6f);
					dust.noGravity = true;
					dust.fadeIn = 0.9f;
					dust.velocity = new Vector2(0f, -0.3f);
				}
			}
			int num4 = 20;
			int num5 = 4;
			if (frame == 1)
			{
				num5 = 60;
			}
			AI_192_GetJuminoFall(this, out var timeSinceFall, out var fall);
			if (timeSinceFall > 0f)
			{
				if (fall < 20f)
				{
					frame = 0;
				}
				else if (++frameCounter >= num5)
				{
					frameCounter = 0;
					if (++frame >= num4)
					{
						frame = num4 - 1;
					}
				}
			}
			else
			{
				frame = 1;
			}
			float num6 = Main.player[owner].Center.X - base.Center.X;
			direction = (spriteDirection = ((num6 >= 0f) ? 1 : (-1)));
			int num7 = 30;
			float num8 = num2 + (float)(num4 * num5) + (float)num7;
			Opacity = Utils.Remap(ai[0], num3 + 0f, num3 + 20f, 0f, 1f) * Utils.Remap(ai[0], num8 - 5f, num8, 1f, 0.5f);
			ai[0] += 1f;
			if (ai[0] <= 130f && ai[0] >= 60f)
			{
				float num9 = Utils.Remap(ai[0], 60f, 130f, 0f, 1f);
				if (Main.rand.NextFloat() < num9 * 0.5f)
				{
					Rectangle r2 = Utils.CenteredRectangle(base.Center + new Vector2(0f, 0f), new Vector2(70f, 70f) * num9);
					Dust dust2 = Dust.NewDustDirect(r2.TopLeft(), r2.Width, r2.Height, 263, 0f, 0f, 100, new Color(80, 200, 255), 0.6f);
					dust2.noGravity = true;
					dust2.fadeIn = 0.9f;
					dust2.velocity = Main.rand.NextVector2Circular(2f, 2f);
				}
				for (float num10 = 0f; num10 < 1f; num10 += 0.5f)
				{
					if (Main.rand.NextFloat() < 0.5f)
					{
						Dust dust3 = Dust.NewDustPerfect(base.Center, 263, (-Vector2.UnitY).RotatedBy(((0f - num9) * (3f - num9 * 0.6f) + num10 + Main.rand.NextFloatDirection() * 0.05f * (1f - num9)) * (MathF.PI * 2f)) * (2f + Main.rand.NextFloat() + Main.rand.NextFloat() * 3f * num9), 30, new Color(80, 200, 255));
						dust3.noGravity = true;
						dust3.fadeIn = 1.1f;
					}
				}
			}
			if (ai[0] <= 60f)
			{
				float num11 = Utils.Remap(ai[0], 0f, 60f, 0f, 1f);
				for (float num12 = 0f; num12 < 1f; num12 += 0.5f)
				{
					if (Main.rand.NextFloat() < 0.5f)
					{
						Dust dust4 = Dust.NewDustPerfect(base.Center, 263, (-Vector2.UnitY).RotatedBy(((0f - num11) * 3f + num12 + Main.rand.NextFloatDirection() * 0.05f) * (MathF.PI * 2f)) * (2f * num11 + Main.rand.NextFloat() * num11), 100, new Color(80, 200, 255), 2f - num11);
						dust4.noGravity = true;
						dust4.fadeIn = 1.1f;
					}
				}
				if (ai[0] == 58f)
				{
					for (float num13 = 0f; num13 < 1f; num13 += 1f / 12f)
					{
						Dust dust5 = Dust.NewDustPerfect(base.Center, 263, (-Vector2.UnitY).RotatedBy(((0f - num11) * 2f + num13 + Main.rand.NextFloatDirection() * 0.05f) * (MathF.PI * 2f)) * (1f * num11 + Main.rand.NextFloat() * num11 * 2f), 100, new Color(80, 200, 255), 0.8f);
						dust5.noGravity = true;
						dust5.fadeIn = 1.2f;
					}
				}
			}
			if (ai[0] >= num8 - 20f)
			{
				float num14 = Utils.Remap(ai[0], num8 - 20f, num8, 0.25f, 1f);
				Rectangle r3 = Utils.CenteredRectangle(base.Center + new Vector2(0f, 30f + num14 * -20f), new Vector2(82f, 72f) * num14);
				for (int j = 0; j < 5; j++)
				{
					Dust dust6 = Dust.NewDustDirect(r3.TopLeft(), r3.Width, r3.Height, 263, 0f, num14 * -4f, 100, new Color(80, 200, 255) * 0.75f, 0.1f);
					dust6.noGravity = true;
					dust6.fadeIn = 0.6f + Main.rand.NextFloat() * 0.3f;
					dust6.velocity = new Vector2(0f, -0.3f);
				}
				for (int k = 0; k < 1; k++)
				{
					Rectangle r4 = Utils.CenteredRectangle(base.Center + new Vector2(0f, 40f), new Vector2(32f, 32f));
					Dust dust7 = Dust.NewDustDirect(r4.TopLeft(), r4.Width, r4.Height, 263, 0f, 0f, 100, new Color(80, 200, 255), 0.6f);
					dust7.noGravity = true;
					dust7.fadeIn = 0.9f;
					dust7.velocity = new Vector2(0f, -0.3f);
				}
			}
			if (Main.rand.Next(6) == 0 && ai[0] >= 90f && ai[0] < num2)
			{
				Rectangle r5 = Utils.CenteredRectangle(base.Center + new Vector2(0f, 0f), new Vector2(104f, 104f));
				Dust dust8 = Dust.NewDustDirect(r5.TopLeft(), r5.Width, r5.Height, 263, 0f, 0f, 100, new Color(80, 200, 255), 0.6f);
				dust8.noGravity = true;
				dust8.fadeIn = 0.9f;
				dust8.velocity = new Vector2(0f, -0.3f);
			}
			if (ai[0] >= num8)
			{
				int num15 = Item.NewItem(new EntitySource_Gift(this), base.Center + new Vector2(0f, 12f), Vector2.Zero, 5276);
				Main.item[num15].velocity = new Vector2(0f, 0f);
				Kill();
			}
		}

		private void AI_191_TrueNightsEdge()
		{
			float num = 50f;
			float num2 = 15f;
			float num3 = ai[1] + num;
			float num4 = num3 + num2;
			float num5 = 77f;
			if (type == 985)
			{
				num = 0f;
				num3 = ai[1];
				num4 = ai[1] + 25f;
				num5 = num4;
			}
			if (localAI[0] == 0f && type == 973)
			{
				SoundEngine.PlaySound(SoundID.Item8, base.position);
			}
			localAI[0] += 1f;
			if (type == 985 && localAI[1] == 1f)
			{
				localAI[0] += 2f;
			}
			if (type == 973 && damage == 0 && localAI[0] < MathHelper.Lerp(num3, num4, 0.5f))
			{
				localAI[0] += 6f;
			}
			Opacity = Utils.Remap(localAI[0], 0f, ai[1], 0f, 1f) * Utils.Remap(localAI[0], num3, num4, 1f, 0f);
			if (localAI[0] >= num4)
			{
				localAI[1] = 1f;
				Kill();
				return;
			}
			Player player = Main.player[owner];
			float fromValue = localAI[0] / ai[1];
			float num6 = Utils.Remap(localAI[0], ai[1] * 0.4f, num4, 0f, 1f);
			direction = (spriteDirection = (int)ai[0]);
			if (type == 973)
			{
				int num7 = 3;
				if (damage != 0 && localAI[0] >= num5 + (float)num7)
				{
					damage = 0;
				}
				if (damage != 0)
				{
					int num8 = 80;
					bool flag = false;
					float num9 = velocity.ToRotation();
					for (float num10 = -1f; num10 <= 1f; num10 += 0.5f)
					{
						Vector2 position = base.Center + (num9 + num10 * (MathF.PI / 4f) * 0.25f).ToRotationVector2() * num8 * 0.5f * scale;
						Vector2 position2 = base.Center + (num9 + num10 * (MathF.PI / 4f) * 0.25f).ToRotationVector2() * num8 * scale;
						if (!Collision.SolidTiles(base.Center, 0, 0) && Collision.CanHit(position, 0, 0, position2, 0, 0))
						{
							flag = true;
							break;
						}
					}
					if (!flag)
					{
						damage = 0;
					}
				}
				fromValue = localAI[0] / ai[1];
				localAI[1] += 1f;
				num6 = Utils.Remap(localAI[1], ai[1] * 0.4f, num4, 0f, 1f);
				base.Center = player.RotatedRelativePoint(player.MountedCenter) - velocity + velocity * num6 * num6 * num5;
				rotation += ai[0] * (MathF.PI * 2f) * (4f + Opacity * 4f) / 90f;
				scale = Utils.Remap(localAI[0], ai[1] + 2f, num4, 1.12f, 1f) * ai[2];
				float f = rotation + Main.rand.NextFloatDirection() * (MathF.PI / 2f) * 0.7f;
				Vector2 vector = base.Center + f.ToRotationVector2() * 84f * scale;
				if (Main.rand.Next(5) == 0)
				{
					Dust dust = Dust.NewDustPerfect(vector, 14, null, 150, default(Color), 1.4f);
					dust.noLight = (dust.noLightEmittence = true);
				}
				for (int i = 0; (float)i < 3f * Opacity; i++)
				{
					Vector2 vector2 = velocity.SafeNormalize(Vector2.UnitX);
					int num11 = ((Main.rand.NextFloat() < Opacity) ? 75 : 27);
					Dust dust2 = Dust.NewDustPerfect(vector, num11, velocity * 0.2f + vector2 * 3f, 100, default(Color), 1.4f);
					dust2.noGravity = true;
					dust2.customData = Opacity * 0.2f;
				}
			}
			if (type != 985)
			{
				return;
			}
			ownerHitCheck = localAI[0] <= 6f;
			if (localAI[0] >= MathHelper.Lerp(num3, num4, 0.65f))
			{
				damage = 0;
			}
			float fromValue2 = 1f - (1f - num6) * (1f - num6);
			rotation = velocity.ToRotation();
			scale = Utils.Remap(fromValue2, 0f, 1f, 1.5f, 1f) * ai[2];
			num6 = Utils.Remap(localAI[0], ai[1] / 2f, num4, 0f, 1f);
			Opacity = Utils.Remap(localAI[0], 0f, ai[1] * 0.5f, 0f, 1f) * Utils.Remap(localAI[0], num4 - 12f, num4, 1f, 0f);
			if (velocity.Length() > 8f)
			{
				velocity *= 0.94f;
				new Vector2(32f, 32f);
				float num12 = Utils.Remap(fromValue, 0.7f, 1f, 110f, 110f);
				if (localAI[1] == 0f)
				{
					bool flag2 = false;
					for (float num13 = -1f; num13 <= 1f; num13 += 0.5f)
					{
						Vector2 position3 = base.Center + (rotation + num13 * (MathF.PI / 4f) * 0.25f).ToRotationVector2() * num12 * 0.5f * scale;
						Vector2 position4 = base.Center + (rotation + num13 * (MathF.PI / 4f) * 0.25f).ToRotationVector2() * num12 * scale;
						if (Collision.CanHit(position3, 0, 0, position4, 0, 0))
						{
							flag2 = true;
							break;
						}
					}
					if (!flag2)
					{
						localAI[1] = 1f;
					}
				}
				if (localAI[1] == 1f && velocity.Length() > 8f)
				{
					velocity *= 0.8f;
				}
				if (localAI[1] == 1f)
				{
					velocity *= 0.88f;
				}
			}
			float num14 = rotation + Main.rand.NextFloatDirection() * (MathF.PI / 2f) * 0.9f;
			Vector2 vector3 = base.Center + num14.ToRotationVector2() * 85f * scale;
			(num14 + ai[0] * (MathF.PI / 2f)).ToRotationVector2();
			Color value = new Color(64, 220, 96);
			Color value2 = new Color(15, 84, 125);
			Lighting.AddLight(base.Center + rotation.ToRotationVector2() * 85f * scale, value.ToVector3());
			for (int j = 0; j < 3; j++)
			{
				if (Main.rand.NextFloat() < Opacity + 0.1f)
				{
					Color.Lerp(Color.Lerp(Color.Lerp(value2, value, Utils.Remap(fromValue, 0f, 0.6f, 0f, 1f)), Color.White, Utils.Remap(fromValue, 0.6f, 0.8f, 0f, 0.5f)), Color.White, Main.rand.NextFloat() * 0.3f);
					Dust dust3 = Dust.NewDustPerfect(vector3, 107, velocity * 0.7f, 100, default(Color) * Opacity, 0.8f * Opacity);
					dust3.scale *= 0.7f;
					dust3.velocity += player.velocity * 0.1f;
					dust3.position -= dust3.velocity * 6f;
				}
			}
			if (damage == 0)
			{
				localAI[0] += 3f;
				velocity *= 0.76f;
			}
			if (localAI[0] < 10f && (localAI[1] == 1f || damage == 0))
			{
				localAI[0] += 1f;
				velocity *= 0.85f;
				for (int k = 0; k < 4; k++)
				{
					float num15 = Main.rand.NextFloatDirection();
					float num16 = 1f - Math.Abs(num15);
					num14 = rotation + num15 * (MathF.PI / 2f) * 0.9f;
					vector3 = base.Center + num14.ToRotationVector2() * 85f * scale;
					Color.Lerp(Color.Lerp(Color.Lerp(value2, value, Utils.Remap(fromValue, 0f, 0.6f, 0f, 1f)), Color.White, Utils.Remap(fromValue, 0.6f, 0.8f, 0f, 0.5f)), Color.White, Main.rand.NextFloat() * 0.3f);
					Dust dust4 = Dust.NewDustPerfect(vector3, 107, velocity.RotatedBy(num15 * (MathF.PI / 4f)) * 0.2f * Main.rand.NextFloat(), 100, default(Color), 1.4f * num16);
					dust4.velocity += player.velocity * 0.1f;
					dust4.position -= dust4.velocity * Main.rand.NextFloat() * 3f;
				}
			}
		}

		private void AI_190_NightsEdge()
		{
			if (localAI[0] == 0f && type == 984)
			{
				SoundEffectInstance soundEffectInstance = SoundEngine.PlaySound(SoundID.Item60, position);
				if (soundEffectInstance != null)
				{
					soundEffectInstance.Volume *= 0.65f;
				}
			}
			localAI[0] += 1f;
			Player player = Main.player[owner];
			float num = localAI[0] / ai[1];
			float num2 = ai[0];
			float num3 = velocity.ToRotation();
			float num4 = (rotation = MathF.PI * num2 * num + num3 + num2 * MathF.PI + player.fullRotation);
			float num5 = 0.2f;
			float num6 = 1f;
			switch (type)
			{
			case 982:
				num5 = 0.6f;
				break;
			case 997:
				num5 = 0.6f;
				break;
			case 983:
				num5 = 1f;
				num6 = 1.2f;
				break;
			case 984:
				num5 = 0.6f;
				break;
			}
			base.Center = player.RotatedRelativePoint(player.MountedCenter) - velocity;
			scale = num6 + num * num5;
			if (type == 972)
			{
				if (Math.Abs(num2) < 0.2f)
				{
					rotation += MathF.PI * 4f * num2 * 10f * num;
					float num7 = Utils.Remap(localAI[0], 10f, ai[1] - 5f, 0f, 1f);
					position += velocity.SafeNormalize(Vector2.Zero) * (80f * num7);
					scale += num7 * 0.4f;
				}
				if (Main.rand.Next(2) == 0)
				{
					float f = rotation + Main.rand.NextFloatDirection() * (MathF.PI / 2f) * 0.7f;
					Vector2 vector = base.Center + f.ToRotationVector2() * 84f * scale;
					if (Main.rand.Next(5) == 0)
					{
						Dust dust = Dust.NewDustPerfect(vector, 14, null, 150, default(Color), 1.4f);
						dust.noLight = (dust.noLightEmittence = true);
					}
					if (Main.rand.Next(2) == 0)
					{
						Dust.NewDustPerfect(vector, 27, new Vector2(player.velocity.X * 0.2f + (float)(player.direction * 3), player.velocity.Y * 0.2f), 100, default(Color), 1.4f).noGravity = true;
					}
				}
			}
			if (type == 982)
			{
				float num8 = rotation + Main.rand.NextFloatDirection() * (MathF.PI / 2f) * 0.7f;
				Vector2 vector2 = base.Center + num8.ToRotationVector2() * 84f * scale;
				Vector2 vector3 = (num8 + ai[0] * (MathF.PI / 2f)).ToRotationVector2();
				if (Main.rand.NextFloat() * 2f < Opacity)
				{
					Dust dust2 = Dust.NewDustPerfect(base.Center + num8.ToRotationVector2() * (Main.rand.NextFloat() * 80f * scale + 20f * scale), 278, vector3 * 1f, 100, Color.Lerp(Color.Gold, Color.White, Main.rand.NextFloat() * 0.3f), 0.4f);
					dust2.fadeIn = 0.4f + Main.rand.NextFloat() * 0.15f;
					dust2.noGravity = true;
				}
				if (Main.rand.NextFloat() * 1.5f < Opacity)
				{
					Dust.NewDustPerfect(vector2, 43, vector3 * 1f, 100, Color.White * Opacity, 1.2f * Opacity);
				}
			}
			if (type == 997)
			{
				float num9 = rotation + Main.rand.NextFloatDirection() * (MathF.PI / 2f) * 0.7f;
				_ = base.Center + num9.ToRotationVector2() * 84f * scale;
				Vector2 vector4 = (num9 + ai[0] * (MathF.PI / 2f)).ToRotationVector2();
				if (Main.rand.NextFloat() * 2f < Opacity)
				{
					Dust dust3 = Dust.NewDustPerfect(base.Center + num9.ToRotationVector2() * (Main.rand.NextFloat() * 80f * scale + 20f * scale), 6, vector4 * 4f, 0, default(Color), 0.4f);
					dust3.noGravity = true;
					dust3.scale = 1.4f;
				}
			}
			if (type == 983)
			{
				float num10 = rotation + Main.rand.NextFloatDirection() * (MathF.PI / 2f) * 0.7f;
				Vector2 vector5 = base.Center + num10.ToRotationVector2() * 84f * scale;
				Vector2 vector6 = (num10 + ai[0] * (MathF.PI / 2f)).ToRotationVector2();
				if (Main.rand.NextFloat() < Opacity)
				{
					Dust dust4 = Dust.NewDustPerfect(base.Center + num10.ToRotationVector2() * (Main.rand.NextFloat() * 80f * scale + 20f * scale), 278, vector6 * 1f, 100, Color.Lerp(Color.HotPink, Color.White, Main.rand.NextFloat() * 0.3f), 0.4f);
					dust4.fadeIn = 0.4f + Main.rand.NextFloat() * 0.15f;
					dust4.noGravity = true;
				}
				if (Main.rand.NextFloat() * 1.5f < Opacity)
				{
					Dust.NewDustPerfect(vector5, 43, vector6 * 1f, 100, Color.White * Opacity, 1.2f * Opacity);
				}
			}
			if (type == 984)
			{
				float num11 = rotation + Main.rand.NextFloatDirection() * (MathF.PI / 2f) * 0.7f;
				Vector2 vector7 = base.Center + num11.ToRotationVector2() * 85f * scale;
				Vector2 vector8 = (num11 + ai[0] * (MathF.PI / 2f)).ToRotationVector2();
				Color value = new Color(64, 220, 96);
				Color value2 = new Color(15, 84, 125);
				Lighting.AddLight(base.Center, value2.ToVector3());
				if (Main.rand.NextFloat() * 2f < Opacity)
				{
					Color value3 = Color.Lerp(value2, value, Utils.Remap(num, 0f, 0.6f, 0f, 1f));
					value3 = Color.Lerp(value3, Color.White, Utils.Remap(num, 0.6f, 0.8f, 0f, 0.5f));
					Dust dust5 = Dust.NewDustPerfect(base.Center + num11.ToRotationVector2() * (Main.rand.NextFloat() * 80f * scale + 20f * scale), 278, vector8 * 1f, 100, Color.Lerp(value3, Color.White, Main.rand.NextFloat() * 0.3f), 0.4f);
					dust5.fadeIn = 0.4f + Main.rand.NextFloat() * 0.15f;
					dust5.noGravity = true;
				}
				if (Main.rand.NextFloat() < Opacity)
				{
					Color.Lerp(Color.Lerp(Color.Lerp(value2, value, Utils.Remap(num, 0f, 0.6f, 0f, 1f)), Color.White, Utils.Remap(num, 0.6f, 0.8f, 0f, 0.5f)), Color.White, Main.rand.NextFloat() * 0.3f);
					Dust dust6 = Dust.NewDustPerfect(vector7, 107, vector8 * 3f, 100, default(Color) * Opacity, 0.8f * Opacity);
					dust6.velocity += player.velocity * 0.1f;
					dust6.velocity += new Vector2(player.direction, 0f);
					dust6.position -= dust6.velocity * 6f;
				}
			}
			scale *= ai[2];
			if (localAI[0] >= ai[1])
			{
				Kill();
			}
		}

		private void AI_188_LightsBane()
		{
			if (soundDelay == 0)
			{
				soundDelay = -1;
				SoundEffectInstance soundEffectInstance = SoundEngine.PlaySound(SoundID.Item60, base.Center);
				if (soundEffectInstance != null)
				{
					soundEffectInstance.Volume *= 0.15f * ai[0];
				}
			}
			scale = ai[0];
			localAI[0] += 1f;
			if (++frameCounter >= 3)
			{
				frameCounter = 0;
				if (++frame >= 12)
				{
					Kill();
					return;
				}
			}
			rotation = velocity.ToRotation();
			float f = rotation;
			float num = 46f * scale;
			Vector2 vector = f.ToRotationVector2();
			float num2 = localAI[0] / 36f * 4f;
			if (num2 >= 0f && num2 <= 1f)
			{
				Dust dust = Dust.NewDustPerfect(Vector2.Lerp(base.Center - vector * num, base.Center + vector * num, localAI[0] / 36f), 278, vector.RotatedBy(MathF.PI * 2f * Main.rand.NextFloatDirection() * 0.02f) * 8f * Main.rand.NextFloat(), 0, new Color(60, 0, 150), 0.7f * num2);
				dust.noGravity = true;
				dust.noLight = (dust.noLightEmittence = true);
			}
		}

		private void AI_189_Volcano()
		{
			//IL_0014: Unknown result type (might be due to invalid IL or missing references)
			if (soundDelay == 0)
			{
				soundDelay = -1;
				SoundEngine.PlayTrackedSound(SoundID.DD2_ExplosiveTrapExplode);
			}
			alpha = (int)(255f * (1f - Utils.Remap(ai[0], 0f, 2f, 0f, 1f) * Utils.Remap(ai[0], 6f, 10f, 1f, 0f)));
			float num = width / 2;
			float num2 = height / 2;
			num = (num2 = 8f);
			scale = 1f + 1f * (ai[0] / 15f);
			if (++frameCounter >= 2)
			{
				frameCounter = 0;
				if (++frame >= 5)
				{
					Kill();
					return;
				}
			}
			ai[0] += 1f;
			if (ai[0] == 1f)
			{
				for (int i = 0; i < 20; i++)
				{
					int num3 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
					Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(num, num2), num3, velocity.RotatedBy(Main.rand.NextFloatDirection() * (MathF.PI / 4f) * 0.6f) * (2f + 5f * Main.rand.NextFloat()), 200, default(Color), 1f + Main.rand.NextFloat()).customData = 0;
				}
				int num4 = Main.rand.Next(3, 7);
				for (int j = 0; j < num4 * 5; j++)
				{
					Dust dust = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(num, num2), 31, velocity.RotatedBy(Main.rand.NextFloatDirection() * (MathF.PI / 4f) * 0.6f) * (2f + 5f * Main.rand.NextFloat()), 50, default(Color), 1f + Main.rand.NextFloat());
					dust.noGravity = true;
					dust.velocity *= 3f;
				}
				for (int k = 0; k < num4; k++)
				{
					Gore.NewGorePerfect(base.Center + Main.rand.NextVector2Circular(num, num2) - new Vector2(16f, 16f), velocity.RotatedBy(Main.rand.NextFloatDirection() * (MathF.PI / 4f) * 0.6f) * (0f + 4f * Main.rand.NextFloat()), 61 + Main.rand.Next(3));
				}
			}
			for (int l = 0; l < 2; l++)
			{
				if (Main.rand.Next(3) < 2)
				{
					Dust dust2 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(num, num2), 6, velocity.RotatedBy(Main.rand.NextFloatDirection() * (MathF.PI / 4f)) * (1.5f + 2f * Main.rand.NextFloat()), 90, default(Color), 2.5f);
					dust2.noGravity = true;
					dust2.fadeIn = 1f;
					if (Main.rand.Next(6) < 3)
					{
						dust2.noGravity = false;
						dust2.noLight = true;
						dust2.fadeIn = 0.4f;
						dust2.scale *= 0.3f;
					}
					else
					{
						dust2.velocity = DirectionFrom(dust2.position) * dust2.velocity.Length() * 0.25f;
					}
					dust2.customData = 0;
				}
			}
			for (int m = 0; m < 2; m++)
			{
				if (!(Main.rand.NextFloat() < 0.5f))
				{
					int num5 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
					Dust dust3 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(num, num2), num5, velocity.RotatedBy(Main.rand.NextFloatDirection() * (MathF.PI / 4f) * 0.5f) * (1f + 2f * Main.rand.NextFloat()), 200, default(Color), 1f + Main.rand.NextFloat());
					dust3.velocity *= new Vector2(0.6f, 1.5f);
					dust3.customData = 0;
				}
			}
		}

		private void AI_066_TryInterceptingTarget(Vector2 targetDir, Vector2 targetVelocity, float speed)
		{
			float num = 5f;
			float num2 = 30f;
			float num3 = num2 + num;
			int num4 = 1;
			int num5 = 4;
			int num6 = 2;
			bool flag = false;
			if (type == 533)
			{
				num4 = 2;
			}
			if (type == 388)
			{
				num4 = 2;
				num2 = 40f;
			}
			targetVelocity /= (float)num4;
			for (float num7 = 1f; num7 <= 1.5f; num7 += 0.1f)
			{
				Utils.ChaseResults chaseResults = Utils.GetChaseResults(base.Center, speed, targetDir, targetVelocity);
				if (chaseResults.InterceptionHappens && chaseResults.InterceptionTime <= num3)
				{
					velocity = chaseResults.ChaserVelocity;
					if (flag)
					{
						int num8 = (int)Utils.Clamp((float)Math.Ceiling(chaseResults.InterceptionTime) + (float)num6, num5, num2 - 1f) / num4;
						float num9 = num2 / (float)num4 - (float)num8;
						ai[1] += num9 * (float)num4;
					}
					break;
				}
			}
		}

		public static void RandomizeInsanityShadowFor(Entity targetEntity, bool isHostile, out Vector2 spawnposition, out Vector2 spawnvelocity, out float ai0, out float ai1)
		{
			int num = Main.rand.Next(2) * 2 - 1;
			int num2 = Main.rand.Next(4);
			float num3 = (isHostile ? 200f : 100f);
			float num4 = (isHostile ? 30 : 20);
			float num5 = (isHostile ? 30 : 0);
			float num6 = Main.rand.NextFloatDirection() * MathF.PI * 0.125f;
			if (isHostile && targetEntity.velocity.X * (float)num > 0f)
			{
				num *= -1;
			}
			if (num2 == 0 && isHostile)
			{
				num4 += 10f;
			}
			spawnposition = targetEntity.Center + targetEntity.velocity * num5 + new Vector2((float)num * (0f - num3), 0f).RotatedBy(num6);
			spawnvelocity = new Vector2((float)num * num3 / num4, 0f).RotatedBy(num6);
			ai0 = 0f;
			ai1 = 0f;
			if (num2 == 1)
			{
				float num7 = MathF.PI * 2f * Main.rand.NextFloat();
				spawnposition = targetEntity.Center - num7.ToRotationVector2() * (isHostile ? num3 : (num3 * 0.5f));
				ai0 = 180f;
				ai1 = num7 - MathF.PI / 2f;
				spawnvelocity = num7.ToRotationVector2() * (isHostile ? 4 : 2);
			}
			if (num2 == 2)
			{
				float num8 = MathF.PI * 2f * Main.rand.NextFloat();
				spawnposition = targetEntity.Center - num8.ToRotationVector2() * num3;
				ai0 = 300f;
				ai1 = num8;
				spawnvelocity = num8.ToRotationVector2() * (isHostile ? 4 : 2);
			}
			if (num2 == 3)
			{
				float f = MathF.PI * 2f * Main.rand.NextFloat();
				float num9 = (isHostile ? 60 : 30);
				float num10 = MathF.PI / 2f / num9 * Main.rand.NextFloatDirection();
				spawnposition = targetEntity.Center + targetEntity.velocity * num9;
				Vector2 vector = f.ToRotationVector2() * (isHostile ? 8 : 3);
				for (int i = 0; (float)i < num9; i++)
				{
					spawnposition -= vector;
					vector = vector.RotatedBy(0f - num10);
				}
				spawnvelocity = vector;
				ai0 = 390f;
				ai1 = num10;
			}
		}

		private void AI_187_ShadowHand()
		{
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_002f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0041: Unknown result type (might be due to invalid IL or missing references)
			//IL_0058: Unknown result type (might be due to invalid IL or missing references)
			//IL_005d: Unknown result type (might be due to invalid IL or missing references)
			AI_187_ShadowHand_GetVariation(out var variation, out var fakeCounter, out var counterMax);
			float fromValue = fakeCounter / counterMax;
			SlotId val;
			if (fakeCounter == 0f)
			{
				float[] array = localAI;
				val = SoundEngine.PlayTrackedSound(SoundID.DD2_GhastlyGlaiveImpactGhost, base.Center);
				array[1] = ((SlotId)(ref val)).ToFloat();
			}
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
			if (activeSound == null)
			{
				float[] array2 = localAI;
				val = SlotId.Invalid;
				array2[1] = ((SlotId)(ref val)).ToFloat();
			}
			else
			{
				activeSound.Position = base.Center;
			}
			float num = counterMax - 15f;
			if (fakeCounter > num)
			{
				alpha += 25;
				if (alpha > 255)
				{
					alpha = 255;
				}
			}
			else
			{
				alpha -= 25;
				if (alpha < 50)
				{
					alpha = 50;
				}
			}
			if (fakeCounter >= counterMax - 1f)
			{
				Kill();
				return;
			}
			if (variation == 0)
			{
				velocity *= 0.98f;
				direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
				rotation = velocity.ToRotation();
				if (spriteDirection == -1)
				{
					rotation += MathF.PI;
				}
			}
			if (variation == 1)
			{
				float num2 = 70f;
				direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
				if (velocity.Length() > 0.1f)
				{
					velocity *= 0.95f;
				}
				num2 *= (float)direction;
				Vector2 vector = base.Center - rotation.ToRotationVector2() * num2;
				float num3 = Utils.Remap(fromValue, 0.3f, 0.5f, 0f, 1f) * Utils.Remap(fromValue, 0.45f, 0.5f, 1f, 0f);
				float num4 = Utils.Remap(fromValue, 0.5f, 0.55f, 0f, 1f) * Utils.Remap(fromValue, 0.5f, 1f, 1f, 0f);
				float num5 = num3 * MathF.PI * 1f / 60f;
				num5 += num4 * -MathF.PI * 8f / 60f;
				rotation += num5 * (float)(-direction);
				rotation = MathHelper.WrapAngle(rotation);
				base.Center = vector + rotation.ToRotationVector2() * num2;
			}
			if (variation == 2)
			{
				float f = ai[1];
				float num6 = Utils.Remap(fromValue, 0f, 0.4f, 1f, 0f);
				float num7 = Utils.Remap(fromValue, 0.3f, 0.4f, 0f, 1f) * Utils.Remap(fromValue, 0.4f, 1f, 1f, 0f);
				float num8 = num6 * 2f + num7 * 8f + 0.01f;
				velocity = f.ToRotationVector2() * num8;
				direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
				rotation = velocity.ToRotation();
				if (spriteDirection == -1)
				{
					rotation += MathF.PI;
				}
			}
			if (variation == 3)
			{
				float num9 = ai[1];
				velocity = velocity.RotatedBy(num9);
				direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
				rotation = velocity.ToRotation();
				if (spriteDirection == -1)
				{
					rotation += MathF.PI;
				}
			}
			ai[0] += 1f;
		}

		private void AI_187_ShadowHand_GetVariation(out int variation, out float fakeCounter, out float counterMax)
		{
			fakeCounter = ai[0];
			variation = 0;
			float num = 0f;
			float num2 = (counterMax = 180f);
			if (fakeCounter >= num && fakeCounter < num2)
			{
				variation = 0;
				counterMax = num2;
				return;
			}
			num = num2;
			num2 += 120f;
			if (fakeCounter >= num && fakeCounter < num2)
			{
				variation = 1;
				fakeCounter -= num;
				counterMax = num2 - num;
				return;
			}
			num = num2;
			num2 += 90f;
			if (fakeCounter >= num && fakeCounter < num2)
			{
				variation = 2;
				fakeCounter -= num;
				counterMax = num2 - num;
			}
			num = num2;
			num2 += 90f;
			if (fakeCounter >= num && fakeCounter < num2)
			{
				variation = 3;
				fakeCounter -= num;
				counterMax = num2 - num;
			}
		}

		private void AI_185_LifeDrain()
		{
			if (Main.myPlayer != owner || localAI[0] != 0f)
			{
				return;
			}
			Player player = Main.player[owner];
			bool flag = false;
			for (int i = 0; i < 200; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.active && !nPC.townNPC && !nPC.dontTakeDamage && !nPC.friendly && base.Hitbox.Intersects(nPC.Hitbox))
				{
					flag = true;
					break;
				}
			}
			if (!flag)
			{
				for (int j = 0; j < 255; j++)
				{
					Player player2 = Main.player[j];
					if (player2.active && player2.whoAmI != player.whoAmI && player2.hostile && !player2.immune && !player2.dead && player2.team != player.team && base.Hitbox.Intersects(player2.Hitbox))
					{
						flag = true;
						break;
					}
				}
			}
			if (flag)
			{
				player.CheckMana(player.inventory[player.selectedItem].mana, pay: true);
				localAI[0] = 1f;
			}
		}

		private void AI_186_PrincessWeapon()
		{
			float num = 60f;
			ai[0] += 1f;
			if (ai[0] >= num)
			{
				Kill();
				return;
			}
			Opacity = Utils.Remap(ai[0], 0f, num, 1f, 0f);
			float num2 = ai[0] / num;
			float num3 = 1f - (1f - num2) * (1f - num2);
			float num4 = 1f - (1f - num3) * (1f - num3);
			float num5 = Utils.Remap(ai[0], num - 15f, num, 0f, 1f);
			float num6 = num5 * num5;
			float num7 = 1f - num6;
			scale = (0.4f + 0.6f * num4) * num7;
			float num8 = Utils.Remap(ai[0], 20f, num, 0f, 1f);
			float num9 = 1f - (1f - num8) * (1f - num8);
			float num10 = 1f - (1f - num9) * (1f - num9);
			localAI[0] = (0.4f + 0.6f * num10) * num7;
			int num11 = width / 2;
			Color newColor = Main.hslToRgb(0.92f, 1f, 0.5f) * Opacity;
			float num12 = 6f;
			float num13 = 2f;
			if (num2 < 0.9f)
			{
				for (int i = 0; i < 3; i++)
				{
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector = Vector2.UnitX.RotatedBy(Main.rand.NextFloat() * (MathF.PI * 2f));
						Vector2 vector2 = vector * ((float)num11 * scale);
						Vector2 vector3 = base.Center + vector2;
						Vector2 vector4 = vector.RotatedBy(0.7853981852531433);
						vector3 += vector4 * num12;
						int num14 = Dust.NewDust(vector3, 0, 0, 267, 0f, 0f, 0, newColor);
						Main.dust[num14].position = vector3;
						Main.dust[num14].noGravity = true;
						Main.dust[num14].scale = 0.3f;
						Main.dust[num14].fadeIn = Main.rand.NextFloat() * 1.2f * scale;
						Main.dust[num14].velocity = vector4 * scale * (0f - num13);
						Main.dust[num14].scale *= scale;
						Main.dust[num14].velocity += velocity * 0.5f;
						Main.dust[num14].position += Main.dust[num14].velocity * -5f;
						if (num14 != 6000)
						{
							Dust dust = Dust.CloneDust(num14);
							dust.scale /= 2f;
							dust.fadeIn *= 0.85f;
							dust.color = new Color(255, 255, 255, 255);
						}
					}
				}
			}
			if (num2 < 0.9f)
			{
				for (int j = 0; j < 3; j++)
				{
					if (Main.rand.Next(2) == 0)
					{
						Vector2 vector5 = Vector2.UnitX.RotatedBy(Main.rand.NextFloat() * (MathF.PI * 2f));
						Vector2 vector6 = vector5 * ((float)num11 * scale);
						Vector2 vector7 = base.Center + vector6;
						Vector2 vector8 = vector5.RotatedBy(0.7853981852531433);
						vector7 += vector8 * (0f - num12);
						int num15 = Dust.NewDust(vector7, 0, 0, 267, 0f, 0f, 0, newColor);
						Main.dust[num15].position = vector7;
						Main.dust[num15].noGravity = true;
						Main.dust[num15].scale = 0.3f;
						Main.dust[num15].fadeIn = Main.rand.NextFloat() * 1.2f * scale;
						Main.dust[num15].velocity = vector8 * scale * num13;
						Main.dust[num15].scale *= scale;
						Main.dust[num15].velocity = velocity * 0.5f;
						if (num15 != 6000)
						{
							Dust dust2 = Dust.CloneDust(num15);
							dust2.scale /= 2f;
							dust2.fadeIn *= 0.85f;
							dust2.color = new Color(255, 255, 255, 255);
						}
					}
				}
			}
			if (num2 < 0.95f)
			{
				for (float num16 = 0f; num16 < 0.8f; num16 += 1f)
				{
					if (Main.rand.Next(4) == 0)
					{
						Vector2 vector9 = Vector2.UnitX.RotatedBy(Main.rand.NextFloat() * (MathF.PI * 2f) + MathF.PI / 2f) * ((float)num11 * scale);
						Vector2 positionInWorld = base.Center + vector9;
						ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.PrincessWeapon, new ParticleOrchestraSettings
						{
							PositionInWorld = positionInWorld,
							MovementVector = velocity
						}, owner);
					}
				}
			}
			if (ai[0] == num - 10f)
			{
				for (float num17 = 0f; num17 < 1f; num17 += 0.25f)
				{
					Vector2 vector10 = Vector2.UnitX.RotatedBy(MathF.PI * 2f * num17);
					_ = vector10 * ((float)num11 * scale);
					Vector2 center = base.Center;
					float num18 = 1f;
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.PrincessWeapon, new ParticleOrchestraSettings
					{
						PositionInWorld = center,
						MovementVector = vector10 * num18
					}, owner);
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.PrincessWeapon, new ParticleOrchestraSettings
					{
						PositionInWorld = center,
						MovementVector = vector10 * num18 * 2f
					}, owner);
				}
			}
		}

		private void AI_184_BadTorchLuck()
		{
			owner = 255;
			if (Main.player[Main.myPlayer].unlockedBiomeTorches)
			{
				damage = 0;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlaySound(SoundID.Item8, base.Center);
			}
			if (ai[1] > 0f)
			{
				ai[1] -= velocity.Length();
			}
			else
			{
				tileCollide = true;
			}
			int num = (int)ai[0];
			float num2 = 4f;
			for (float num3 = 0f; num3 < num2; num3 += 1f)
			{
				int num4 = Dust.NewDust(position + velocity / num2 * num3, 4, 4, num, 0f, 0f, 100);
				if (Main.rand.Next(3) != 0)
				{
					Main.dust[num4].noGravity = true;
				}
				Main.dust[num4].velocity *= 0.3f;
				if (num == 66)
				{
					Main.dust[num4].color = new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB);
					Main.dust[num4].noGravity = true;
				}
			}
		}

		private void AI_121_StardustDragon()
		{
			Player player = Main.player[owner];
			if ((int)Main.timeForVisualEffects % 120 == 0)
			{
				netUpdate = true;
			}
			if (!player.active)
			{
				active = false;
				return;
			}
			bool num = type == 625;
			bool flag = type == 625 || type == 626 || type == 627 || type == 628;
			int num2 = 10;
			if (flag)
			{
				if (player.dead)
				{
					player.stardustDragon = false;
				}
				if (player.stardustDragon)
				{
					timeLeft = 2;
				}
				num2 = 30;
				if (Main.rand.Next(30) == 0)
				{
					int num3 = Dust.NewDust(position, width, height, 135, 0f, 0f, 0, default(Color), 2f);
					Main.dust[num3].noGravity = true;
					Main.dust[num3].fadeIn = 2f;
					Point point = Main.dust[num3].position.ToTileCoordinates();
					if (WorldGen.InWorld(point.X, point.Y, 5) && WorldGen.SolidTile(point.X, point.Y))
					{
						Main.dust[num3].noLight = true;
					}
				}
			}
			if (num)
			{
				Vector2 center = player.Center;
				float num4 = 700f;
				float num5 = 1000f;
				int num6 = -1;
				if (Distance(center) > 2000f)
				{
					base.Center = center;
					netUpdate = true;
				}
				if (true)
				{
					NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
					if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
					{
						float num7 = Distance(ownerMinionAttackTargetNPC.Center);
						if (num7 < num4 * 2f)
						{
							num6 = ownerMinionAttackTargetNPC.whoAmI;
							if (ownerMinionAttackTargetNPC.boss)
							{
								_ = ownerMinionAttackTargetNPC.whoAmI;
							}
							else
							{
								_ = ownerMinionAttackTargetNPC.whoAmI;
							}
						}
					}
					if (num6 < 0)
					{
						for (int i = 0; i < 200; i++)
						{
							NPC nPC = Main.npc[i];
							if (nPC.CanBeChasedBy(this) && player.Distance(nPC.Center) < num5)
							{
								float num8 = Distance(nPC.Center);
								if (num8 < num4)
								{
									num6 = i;
									_ = nPC.boss;
								}
							}
						}
					}
				}
				if (num6 != -1)
				{
					NPC nPC2 = Main.npc[num6];
					Vector2 vector = nPC2.Center - base.Center;
					(vector.X > 0f).ToDirectionInt();
					(vector.Y > 0f).ToDirectionInt();
					float num9 = 0.4f;
					if (vector.Length() < 600f)
					{
						num9 = 0.6f;
					}
					if (vector.Length() < 300f)
					{
						num9 = 0.8f;
					}
					if (vector.Length() > nPC2.Size.Length() * 0.75f)
					{
						velocity += Vector2.Normalize(vector) * num9 * 1.5f;
						if (Vector2.Dot(velocity, vector) < 0.25f)
						{
							velocity *= 0.8f;
						}
					}
					float num10 = 30f;
					if (velocity.Length() > num10)
					{
						velocity = Vector2.Normalize(velocity) * num10;
					}
				}
				else
				{
					float num11 = 0.2f;
					Vector2 vector2 = center - base.Center;
					if (vector2.Length() < 200f)
					{
						num11 = 0.12f;
					}
					if (vector2.Length() < 140f)
					{
						num11 = 0.06f;
					}
					if (vector2.Length() > 100f)
					{
						if (Math.Abs(center.X - base.Center.X) > 20f)
						{
							velocity.X += num11 * (float)Math.Sign(center.X - base.Center.X);
						}
						if (Math.Abs(center.Y - base.Center.Y) > 10f)
						{
							velocity.Y += num11 * (float)Math.Sign(center.Y - base.Center.Y);
						}
					}
					else if (velocity.Length() > 2f)
					{
						velocity *= 0.96f;
					}
					if (Math.Abs(velocity.Y) < 1f)
					{
						velocity.Y -= 0.1f;
					}
					float num12 = 15f;
					if (velocity.Length() > num12)
					{
						velocity = Vector2.Normalize(velocity) * num12;
					}
				}
				rotation = velocity.ToRotation() + MathF.PI / 2f;
				int num13 = direction;
				direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
				if (num13 != direction)
				{
					netUpdate = true;
				}
				float num14 = MathHelper.Clamp(localAI[0], 0f, 50f);
				position = base.Center;
				scale = 1f + num14 * 0.01f;
				width = (height = (int)((float)num2 * scale));
				base.Center = position;
				if (alpha > 0)
				{
					for (int j = 0; j < 2; j++)
					{
						int num15 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num15].noGravity = true;
						Main.dust[num15].noLight = true;
					}
					alpha -= 42;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
			}
			else
			{
				bool flag2 = false;
				Vector2 vector3 = Vector2.Zero;
				_ = Vector2.Zero;
				float num16 = 0f;
				float num17 = 0f;
				float num18 = 1f;
				if (ai[1] == 1f)
				{
					ai[1] = 0f;
					netUpdate = true;
				}
				int byUUID = GetByUUID(owner, (int)ai[0]);
				if (Main.projectile.IndexInRange(byUUID))
				{
					Projectile projectile = Main.projectile[byUUID];
					if (flag && projectile.active && (projectile.type == 625 || projectile.type == 626 || projectile.type == 627))
					{
						flag2 = true;
						vector3 = projectile.Center;
						_ = projectile.velocity;
						num16 = projectile.rotation;
						num18 = MathHelper.Clamp(projectile.scale, 0f, 50f);
						num17 = 16f;
						_ = projectile.alpha;
						projectile.localAI[0] = localAI[0] + 1f;
						if (projectile.type != 625)
						{
							projectile.localAI[1] = whoAmI;
						}
						if (owner == Main.myPlayer && type == 628 && projectile.type == 625)
						{
							projectile.Kill();
							Kill();
							return;
						}
					}
				}
				if (!flag2)
				{
					for (int k = 0; k < 1000; k++)
					{
						Projectile projectile2 = Main.projectile[k];
						if (projectile2.active && projectile2.owner == owner && ProjectileID.Sets.StardustDragon[projectile2.type] && projectile2.localAI[1] == ai[0])
						{
							ai[0] = projectile2.projUUID;
							projectile2.localAI[1] = whoAmI;
							netUpdate = true;
						}
					}
					return;
				}
				if (alpha > 0)
				{
					for (int l = 0; l < 2; l++)
					{
						int num19 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num19].noGravity = true;
						Main.dust[num19].noLight = true;
					}
				}
				alpha -= 42;
				if (alpha < 0)
				{
					alpha = 0;
				}
				velocity = Vector2.Zero;
				Vector2 vector4 = vector3 - base.Center;
				if (num16 != rotation)
				{
					float num20 = MathHelper.WrapAngle(num16 - rotation);
					vector4 = vector4.RotatedBy(num20 * 0.1f);
				}
				rotation = vector4.ToRotation() + MathF.PI / 2f;
				position = base.Center;
				scale = num18;
				width = (height = (int)((float)num2 * scale));
				base.Center = position;
				if (vector4 != Vector2.Zero)
				{
					base.Center = vector3 - Vector2.Normalize(vector4) * num17 * num18;
				}
				spriteDirection = ((vector4.X > 0f) ? 1 : (-1));
			}
			position.X = MathHelper.Clamp(position.X, 160f, Main.maxTilesX * 16 - 160);
			position.Y = MathHelper.Clamp(position.Y, 160f, Main.maxTilesY * 16 - 160);
		}

		private Projectile FindStardustDragonHeadOfOwner()
		{
			for (int i = 0; i < 1000; i++)
			{
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.owner == owner && projectile.type == 625)
				{
					return projectile;
				}
			}
			return null;
		}

		private void AI_183_ZoologistStrike()
		{
			velocity.X *= 0.2f;
			velocity.Y = 0f;
			spriteDirection = (direction = 1);
			if (velocity.X < 0f)
			{
				spriteDirection = (direction = -1);
			}
			frame++;
			if (frame >= Main.projFrames[type])
			{
				frame = Main.projFrames[type] - 1;
			}
		}

		private void AI_182_FinalFractal()
		{
			if (type == 933 && localAI[1] == 0f)
			{
				localAI[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item169, base.Center);
			}
			Player player = Main.player[owner];
			Vector2 mountedCenter = player.MountedCenter;
			float lerpValue = Utils.GetLerpValue(900f, 0f, velocity.Length() * 2f, clamped: true);
			float num = MathHelper.Lerp(0.7f, 2f, lerpValue);
			localAI[0] += num;
			if (localAI[0] >= 120f)
			{
				Kill();
				return;
			}
			float lerpValue2 = Utils.GetLerpValue(0f, 1f, localAI[0] / 60f, clamped: true);
			float num2 = localAI[0] / 60f;
			float num3 = ai[0];
			float num4 = velocity.ToRotation();
			float num5 = MathF.PI;
			float num6 = ((velocity.X > 0f) ? 1 : (-1));
			float num7 = num5 + num6 * lerpValue2 * (MathF.PI * 2f);
			float num8 = velocity.Length() + Utils.GetLerpValue(0.5f, 1f, lerpValue2, clamped: true) * 40f;
			float num9 = 60f;
			if (num8 < num9)
			{
				num8 = num9;
			}
			Vector2 vector = mountedCenter + velocity;
			Vector2 spinningpoint = new Vector2(1f, 0f).RotatedBy(num7) * new Vector2(num8, num3 * MathHelper.Lerp(2f, 1f, lerpValue));
			Vector2 vector2 = vector + spinningpoint.RotatedBy(num4);
			Vector2 vector3 = (1f - Utils.GetLerpValue(0f, 0.5f, lerpValue2, clamped: true)) * new Vector2((float)((velocity.X > 0f) ? 1 : (-1)) * (0f - num8) * 0.1f, (0f - ai[0]) * 0.3f);
			float num10 = num7 + num4;
			rotation = num10 + MathF.PI / 2f;
			base.Center = vector2 + vector3;
			spriteDirection = (direction = ((velocity.X > 0f) ? 1 : (-1)));
			if (num3 < 0f)
			{
				rotation = num5 + num6 * lerpValue2 * (MathF.PI * -2f) + num4;
				rotation += MathF.PI / 2f;
				spriteDirection = (direction = ((!(velocity.X > 0f)) ? 1 : (-1)));
			}
			if (num2 < 1f)
			{
				FinalFractalHelper.FinalFractalProfile finalFractalProfile = FinalFractalHelper.GetFinalFractalProfile((int)ai[1]);
				Vector2 vector4 = (rotation - MathF.PI / 2f).ToRotationVector2();
				Vector2 center = base.Center;
				int num11 = 1 + (int)(velocity.Length() / 100f);
				num11 = (int)((float)num11 * Utils.GetLerpValue(0f, 0.5f, lerpValue2, clamped: true) * Utils.GetLerpValue(1f, 0.5f, lerpValue2, clamped: true));
				if (num11 < 1)
				{
					num11 = 1;
				}
				for (int i = 0; i < num11; i++)
				{
					finalFractalProfile.dustMethod(center + vector4 * finalFractalProfile.trailWidth * MathHelper.Lerp(0.5f, 1f, Main.rand.NextFloat()), rotation - MathF.PI / 2f + MathF.PI / 2f * (float)spriteDirection, player.velocity);
				}
				Vector3 vector5 = finalFractalProfile.trailColor.ToVector3();
				Vector3 vector6 = Vector3.Lerp(Vector3.One, vector5, 0.7f);
				Lighting.AddLight(base.Center, vector5 * 0.5f * Opacity);
				Lighting.AddLight(mountedCenter, vector6 * Opacity * 0.15f);
			}
			Opacity = Utils.GetLerpValue(0f, 5f, localAI[0], clamped: true) * Utils.GetLerpValue(120f, 115f, localAI[0], clamped: true);
		}

		private void AI_181_FairyQueenRangedItemShot()
		{
			ai[0] += 1f;
			alpha = (int)MathHelper.Lerp(255f, 0f, Utils.GetLerpValue(0f, 10f, ai[0], clamped: true));
			rotation = velocity.ToRotation();
			if (Main.rand.Next(6) == 0)
			{
				Dust dust = Dust.NewDustPerfect(base.Center, 267);
				dust.fadeIn = 1f;
				dust.noGravity = true;
				dust.alpha = 100;
				dust.color = GetFairyQueenWeaponsColor(1f, Main.rand.NextFloat() * 0.4f);
				dust.noLightEmittence = true;
				dust.scale *= 1.5f;
			}
		}

		private void AI_009_MagicMissiles()
		{
			if (type == 491)
			{
				AI_009_MagicMissiles_Old();
				return;
			}
			int num = 32;
			Player player = Main.player[owner];
			int num2 = Main.maxTilesY * 16;
			int num3 = 0;
			if (ai[0] >= 0f)
			{
				num3 = (int)(ai[1] / (float)num2);
			}
			bool flag = ai[0] == -1f || ai[0] == -2f;
			if (type == 34)
			{
				if (frameCounter++ >= 4)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				if (penetrate == 1 && ai[0] >= 0f && num3 == 0)
				{
					ai[1] += num2;
					num3 = 1;
					netUpdate = true;
				}
				if (penetrate == 1 && ai[0] == -1f)
				{
					ai[0] = -2f;
					netUpdate = true;
				}
				if (num3 > 0 || ai[0] == -2f)
				{
					localAI[0] += 1f;
				}
			}
			if (owner == Main.myPlayer)
			{
				if (ai[0] >= 0f)
				{
					if (player.channel)
					{
						Vector2 pointPoisition = Main.MouseWorld;
						player.LimitPointToPlayerReachableArea(ref pointPoisition);
						if (ai[0] != pointPoisition.X || ai[1] != pointPoisition.Y)
						{
							netUpdate = true;
							ai[0] = pointPoisition.X;
							ai[1] = pointPoisition.Y + (float)(num2 * num3);
						}
					}
					else
					{
						netUpdate = true;
						ai[0] = -1f;
						ai[1] = -1f;
						int num4 = FindTargetWithLineOfSight();
						if (num4 != -1)
						{
							ai[1] = num4;
						}
						else if (velocity.Length() < 2f)
						{
							velocity = DirectionFrom(player.Center) * num;
						}
						else
						{
							velocity = velocity.SafeNormalize(Vector2.Zero) * num;
						}
					}
				}
				if (flag && ai[1] == -1f)
				{
					int num5 = FindTargetWithLineOfSight();
					if (num5 != -1)
					{
						ai[1] = num5;
						netUpdate = true;
					}
				}
			}
			Vector2? vector = null;
			float amount = 1f;
			if (ai[0] > 0f && ai[1] > 0f)
			{
				vector = new Vector2(ai[0], ai[1] % (float)num2);
			}
			if (flag && ai[1] >= 0f)
			{
				int num6 = (int)ai[1];
				if (Main.npc.IndexInRange(num6))
				{
					NPC nPC = Main.npc[num6];
					if (nPC.CanBeChasedBy(this))
					{
						vector = nPC.Center;
						float t = Distance(vector.Value);
						float num7 = Utils.GetLerpValue(0f, 100f, t, clamped: true) * Utils.GetLerpValue(600f, 400f, t, clamped: true);
						amount = MathHelper.Lerp(0f, 0.2f, Utils.GetLerpValue(200f, 20f, 1f - num7, clamped: true));
					}
					else
					{
						ai[1] = -1f;
						netUpdate = true;
					}
				}
			}
			bool flag2 = false;
			if (flag)
			{
				flag2 = true;
			}
			if (vector.HasValue)
			{
				Vector2 value = vector.Value;
				if (Distance(value) >= 64f)
				{
					flag2 = true;
					Vector2 v = value - base.Center;
					Vector2 vector2 = v.SafeNormalize(Vector2.Zero);
					float num8 = Math.Min(num, v.Length());
					Vector2 value2 = vector2 * num8;
					if (velocity.Length() < 4f)
					{
						velocity += velocity.SafeNormalize(Vector2.Zero).RotatedBy(0.7853981852531433).SafeNormalize(Vector2.Zero) * 4f;
					}
					if (velocity.HasNaNs())
					{
						Kill();
					}
					velocity = Vector2.Lerp(velocity, value2, amount);
				}
				else
				{
					velocity *= 0.3f;
					velocity += (value - base.Center) * 0.3f;
					flag2 = velocity.Length() >= 2f;
				}
				if (timeLeft < 60)
				{
					timeLeft = 60;
				}
			}
			if (flag && ai[1] < 0f)
			{
				if (velocity.Length() != (float)num)
				{
					velocity = velocity.MoveTowards(velocity.SafeNormalize(Vector2.UnitY) * num, 4f);
				}
				if (timeLeft > 300)
				{
					timeLeft = 300;
				}
			}
			if (flag2 && velocity != Vector2.Zero)
			{
				rotation = rotation.AngleTowards(velocity.ToRotation(), MathF.PI / 4f);
			}
			else
			{
				rotation = rotation.AngleLerp(0f, 0.2f);
			}
			bool flag3 = velocity.Length() > 0.1f && Vector2.Dot(oldVelocity.SafeNormalize(Vector2.Zero), velocity.SafeNormalize(Vector2.Zero)) < 0.2f;
			if (type == 16)
			{
				if (soundDelay == 0 && Math.Abs(velocity.X) + Math.Abs(velocity.Y) > 2f)
				{
					soundDelay = 10;
					SoundEngine.PlaySound(SoundID.Item9, position);
				}
				if (Main.rand.Next(9) == 0)
				{
					int num9 = Dust.NewDust(position, width, height, 15, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num9].velocity *= 0.3f;
					Main.dust[num9].position.X = position.X + (float)(width / 2) + 4f + (float)Main.rand.Next(-4, 5);
					Main.dust[num9].position.Y = position.Y + (float)(height / 2) + (float)Main.rand.Next(-4, 5);
					Main.dust[num9].noGravity = true;
					Main.dust[num9].velocity += Main.rand.NextVector2Circular(2f, 2f);
				}
				if (flag3)
				{
					int num10 = Main.rand.Next(2, 5);
					for (int i = 0; i < num10; i++)
					{
						Dust dust = Dust.NewDustDirect(position, width, height, 15, 0f, 0f, 100, default(Color), 1.5f);
						dust.velocity *= 0.3f;
						dust.position = base.Center;
						dust.noGravity = true;
						dust.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
						dust.fadeIn = 2.2f;
					}
				}
			}
			if (type != 34)
			{
				return;
			}
			float lerpValue = Utils.GetLerpValue(0f, 10f, localAI[0], clamped: true);
			Color newColor = Color.Lerp(Color.Transparent, Color.Crimson, lerpValue);
			if (Main.rand.Next(6) == 0)
			{
				Dust dust2 = Dust.NewDustDirect(base.Center, 0, 0, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, newColor, 3.5f);
				dust2.noGravity = true;
				dust2.velocity *= 1.4f;
				dust2.velocity += Main.rand.NextVector2Circular(1f, 1f);
				dust2.velocity += velocity * 0.15f;
			}
			if (Main.rand.Next(12) == 0)
			{
				Dust dust3 = Dust.NewDustDirect(base.Center, 0, 0, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, newColor, 1.5f);
				dust3.velocity += Main.rand.NextVector2Circular(1f, 1f);
				dust3.velocity += velocity * 0.15f;
			}
			if (flag3)
			{
				int num11 = Main.rand.Next(2, 5 + (int)(lerpValue * 4f));
				for (int j = 0; j < num11; j++)
				{
					Dust dust4 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100, newColor, 1.5f);
					dust4.velocity *= 0.3f;
					dust4.position = base.Center;
					dust4.noGravity = true;
					dust4.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
					dust4.fadeIn = 2.2f;
					dust4.position += (dust4.position - base.Center) * lerpValue * 10f;
				}
			}
		}

		private void AI_009_MagicMissiles_Old()
		{
			if (Main.myPlayer == owner && ai[0] <= 0f)
			{
				if (Main.player[owner].channel)
				{
					float num = 12f;
					if (type == 16)
					{
						num = 15f;
					}
					if (type == 491)
					{
						num = 20f;
					}
					Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					Vector2 pointPoisition = Main.MouseWorld;
					Main.player[owner].LimitPointToPlayerReachableArea(ref pointPoisition);
					float num2 = pointPoisition.X - vector.X;
					float num3 = pointPoisition.Y - vector.Y;
					float num4 = (float)Math.Sqrt(num2 * num2 + num3 * num3);
					if (ai[0] < 0f)
					{
						ai[0] += 1f;
					}
					if (type == 491 && num4 < 100f)
					{
						if (velocity.Length() < num)
						{
							velocity *= 1.1f;
							if (velocity.Length() > num)
							{
								velocity.Normalize();
								velocity *= num;
							}
						}
						if (ai[0] == 0f)
						{
							ai[0] = -10f;
						}
					}
					else if (num4 > num)
					{
						num4 = num / num4;
						num2 *= num4;
						num3 *= num4;
						int num5 = (int)(num2 * 1000f);
						int num6 = (int)(velocity.X * 1000f);
						int num7 = (int)(num3 * 1000f);
						int num8 = (int)(velocity.Y * 1000f);
						if (num5 != num6 || num7 != num8)
						{
							netUpdate = true;
						}
						if (type == 491)
						{
							Vector2 vector2 = new Vector2(num2, num3);
							velocity = (velocity * 4f + vector2) / 5f;
						}
						else
						{
							velocity.X = num2;
							velocity.Y = num3;
						}
					}
					else
					{
						int num9 = (int)(num2 * 1000f);
						int num10 = (int)(velocity.X * 1000f);
						int num11 = (int)(num3 * 1000f);
						int num12 = (int)(velocity.Y * 1000f);
						if (num9 != num10 || num11 != num12)
						{
							netUpdate = true;
						}
						velocity.X = num2;
						velocity.Y = num3;
					}
				}
				else if (ai[0] <= 0f)
				{
					netUpdate = true;
					if (type != 491)
					{
						Vector2 vector3 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						float num13 = (float)Main.mouseX + Main.screenPosition.X - vector3.X;
						float num14 = (float)Main.mouseY + Main.screenPosition.Y - vector3.Y;
						if (Main.player[owner].gravDir == -1f)
						{
							num14 = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY - vector3.Y;
						}
						float num15 = (float)Math.Sqrt(num13 * num13 + num14 * num14);
						if (num15 == 0f || ai[0] < 0f)
						{
							vector3 = new Vector2(Main.player[owner].position.X + (float)(Main.player[owner].width / 2), Main.player[owner].position.Y + (float)(Main.player[owner].height / 2));
							num13 = position.X + (float)width * 0.5f - vector3.X;
							num14 = position.Y + (float)height * 0.5f - vector3.Y;
							num15 = (float)Math.Sqrt(num13 * num13 + num14 * num14);
						}
						num15 = 12f / num15;
						num13 *= num15;
						num14 *= num15;
						velocity.X = num13;
						velocity.Y = num14;
						if (velocity.X == 0f && velocity.Y == 0f)
						{
							Kill();
						}
					}
					ai[0] = 1f;
				}
			}
			bool flag = false;
			if (type == 491)
			{
				localAI[0] += 1f;
				if (ai[0] > 0f && localAI[0] > 15f)
				{
					tileCollide = false;
					Vector2 vector4 = Main.player[owner].Center - base.Center;
					if (vector4.Length() < 20f)
					{
						Kill();
					}
					vector4.Normalize();
					vector4 *= 25f;
					velocity = (velocity * 5f + vector4) / 6f;
				}
				flag = true;
				if (ai[0] < 0f || (velocity.X == 0f && velocity.Y == 0f))
				{
					rotation += 0.3f;
				}
				else if (ai[0] > 0f)
				{
					rotation += 0.3f * (float)direction;
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
				if (Vector2.Distance(base.Center, Main.player[owner].Center) > 2000f)
				{
					Kill();
				}
				if (Main.rand.Next(2) == 0)
				{
					int num16 = Main.rand.Next(3);
					int num17 = Dust.NewDust(position, width, height, num16 switch
					{
						0 => 15, 
						1 => 57, 
						_ => 58, 
					}, velocity.X * 0.25f, velocity.Y * 0.25f, 255, default(Color), 0.7f);
					Main.dust[num17].velocity *= 0.25f;
					Main.dust[num17].position = (Main.dust[num17].position + position) / 2f;
				}
			}
			if (type == 79)
			{
				if (soundDelay == 0 && Math.Abs(velocity.X) + Math.Abs(velocity.Y) > 2f)
				{
					soundDelay = 10;
					SoundEngine.PlaySound(SoundID.Item9, position);
				}
				for (int i = 0; i < 1; i++)
				{
					int num18 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 66, 0f, 0f, 100, new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB), 2.5f);
					Main.dust[num18].velocity *= 0.1f;
					Main.dust[num18].velocity += velocity * 0.2f;
					Main.dust[num18].position.X = position.X + (float)(width / 2) + 4f + (float)Main.rand.Next(-2, 3);
					Main.dust[num18].position.Y = position.Y + (float)(height / 2) + (float)Main.rand.Next(-2, 3);
					Main.dust[num18].noGravity = true;
				}
			}
			if (type == 16)
			{
				if (soundDelay == 0 && Math.Abs(velocity.X) + Math.Abs(velocity.Y) > 2f)
				{
					soundDelay = 10;
					SoundEngine.PlaySound(SoundID.Item9, position);
				}
				if (Main.rand.Next(9) == 0)
				{
					int num19 = Dust.NewDust(position, width, height, 15, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num19].velocity *= 0.3f;
					Main.dust[num19].position.X = position.X + (float)(width / 2) + 4f + (float)Main.rand.Next(-4, 5);
					Main.dust[num19].position.Y = position.Y + (float)(height / 2) + (float)Main.rand.Next(-4, 5);
					Main.dust[num19].noGravity = true;
					Main.dust[num19].velocity += Main.rand.NextVector2Circular(2f, 2f);
				}
				flag = true;
				if (velocity != Vector2.Zero)
				{
					rotation = velocity.ToRotation();
				}
			}
			if (type == 34)
			{
				if (Main.rand.Next(12) == 0)
				{
					Dust dust = Dust.NewDustDirect(base.Center, 0, 0, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 3.5f);
					dust.noGravity = true;
					dust.velocity *= 1.4f;
					dust.velocity += Main.rand.NextVector2Circular(1f, 1f);
					dust.velocity += velocity * 0.15f;
				}
				if (Main.rand.Next(24) == 0)
				{
					Dust dust2 = Dust.NewDustDirect(base.Center, 0, 0, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.5f);
					dust2.velocity += Main.rand.NextVector2Circular(1f, 1f);
					dust2.velocity += velocity * 0.15f;
				}
				flag = true;
				if (velocity != Vector2.Zero)
				{
					rotation = velocity.ToRotation();
				}
			}
			if (!flag && velocity != Vector2.Zero)
			{
				rotation = velocity.ToRotation() - MathF.PI + MathF.PI / 4f;
			}
			if (velocity.Y > 16f)
			{
				velocity.Y = 16f;
			}
		}

		private void AI_015_HandleMovementCollision(ref Vector2 wetVelocity, ref Vector2 lastVelocity)
		{
			int num = 10;
			int num2 = 0;
			Vector2 vector = velocity;
			float num3 = 0.2f;
			if (ai[0] == 1f || ai[0] == 5f)
			{
				num3 = 0.4f;
			}
			if (ai[0] == 6f)
			{
				num3 = 0f;
			}
			if (lastVelocity.X != velocity.X)
			{
				if (Math.Abs(lastVelocity.X) > 4f)
				{
					num2 = 1;
				}
				velocity.X = (0f - lastVelocity.X) * num3;
				localAI[0] += 1f;
			}
			if (lastVelocity.Y != velocity.Y)
			{
				if (Math.Abs(lastVelocity.Y) > 4f)
				{
					num2 = 1;
				}
				velocity.Y = (0f - lastVelocity.Y) * num3;
				localAI[0] += 1f;
			}
			if (ai[0] == 1f)
			{
				ai[0] = 5f;
				localNPCHitCooldown = num;
				netUpdate = true;
				Point scanAreaStart = base.TopLeft.ToTileCoordinates();
				Point scanAreaEnd = base.BottomRight.ToTileCoordinates();
				num2 = 2;
				CreateImpactExplosion(2, base.Center, ref scanAreaStart, ref scanAreaEnd, width, out var causedShockwaves);
				CreateImpactExplosion2_FlailTileCollision(base.Center, causedShockwaves, vector);
				position -= vector;
			}
			if (num2 > 0)
			{
				netUpdate = true;
				for (int i = 0; i < num2; i++)
				{
					Collision.HitTiles(position, vector, width, height);
				}
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			}
			if (ai[0] != 3f && ai[0] != 0f && ai[0] != 5f && ai[0] != 6f && localAI[0] >= 10f)
			{
				ai[0] = 4f;
				netUpdate = true;
			}
			if (wet)
			{
				wetVelocity = velocity;
			}
		}

		private void ResetLocalNPCHitImmunity()
		{
			for (int i = 0; i < 200; i++)
			{
				localNPCImmunity[i] = 0;
			}
		}

		private void AI_015_Flails()
		{
			Player player = Main.player[owner];
			if (!player.active || player.dead || player.noItems || player.CCed || Vector2.Distance(base.Center, player.Center) > 900f)
			{
				Kill();
				return;
			}
			if (Main.myPlayer == owner && Main.mapFullscreen)
			{
				Kill();
				return;
			}
			if (type == 948 && wet && !lavaWet)
			{
				type = 947;
				netUpdate = true;
			}
			Vector2 mountedCenter = player.MountedCenter;
			bool doFastThrowDust = false;
			bool flag = true;
			bool flag2 = false;
			int num = 10;
			float num2 = 24f;
			float num3 = 800f;
			float num4 = 3f;
			float num5 = 16f;
			float num6 = 6f;
			float num7 = 48f;
			float num8 = 1f;
			float num9 = 14f;
			int num10 = 60;
			int num11 = 10;
			int num12 = 15;
			int num13 = 10;
			int num14 = num + 5;
			switch (type)
			{
			case 947:
			case 948:
				num = 13;
				num2 = 12f;
				num5 = 8f;
				num7 = 13f;
				break;
			case 25:
				num = 15;
				num2 = 14f;
				num5 = 10f;
				num7 = 15f;
				break;
			case 154:
				num = 15;
				num2 = 15f;
				num5 = 11f;
				num7 = 16f;
				break;
			case 26:
				num = 15;
				num2 = 16f;
				num5 = 12f;
				num7 = 16f;
				break;
			case 35:
				num = 15;
				num2 = 17f;
				num5 = 14f;
				num7 = 18f;
				break;
			case 63:
				num = 13;
				num2 = 21f;
				num5 = 20f;
				num7 = 24f;
				num12 = 12;
				break;
			case 757:
				num = 13;
				num2 = 22f;
				num5 = 22f;
				num7 = 26f;
				num12 = 12;
				break;
			case 247:
				num = 13;
				num2 = 23f;
				num12 = 12;
				break;
			}
			float meleeSpeed = player.meleeSpeed;
			float num15 = 1f / meleeSpeed;
			num2 *= num15;
			num8 *= num15;
			num9 *= num15;
			num4 *= num15;
			num5 *= num15;
			num6 *= num15;
			num7 *= num15;
			float num16 = num2 * (float)num;
			float num17 = num16 + 160f;
			localNPCHitCooldown = num11;
			switch ((int)ai[0])
			{
			case 0:
			{
				flag2 = true;
				if (owner == Main.myPlayer)
				{
					Vector2 origin = mountedCenter;
					Vector2 mouseWorld = Main.MouseWorld;
					Vector2 vector3 = origin.DirectionTo(mouseWorld).SafeNormalize(Vector2.UnitX * player.direction);
					player.ChangeDir((vector3.X > 0f) ? 1 : (-1));
					if (!player.channel)
					{
						ai[0] = 1f;
						ai[1] = 0f;
						velocity = vector3 * num2 + player.velocity;
						base.Center = mountedCenter;
						netUpdate = true;
						ResetLocalNPCHitImmunity();
						localNPCHitCooldown = num13;
						break;
					}
				}
				localAI[1] += 1f;
				Vector2 vector4 = new Vector2(player.direction).RotatedBy(MathF.PI * 10f * (localAI[1] / 60f) * (float)player.direction);
				vector4.Y *= 0.8f;
				if (vector4.Y * player.gravDir > 0f)
				{
					vector4.Y *= 0.5f;
				}
				base.Center = mountedCenter + vector4 * 30f;
				velocity = Vector2.Zero;
				localNPCHitCooldown = num12;
				break;
			}
			case 1:
			{
				doFastThrowDust = true;
				bool flag3 = ai[1]++ >= (float)num;
				flag3 |= Distance(mountedCenter) >= num3;
				if (player.controlUseItem)
				{
					ai[0] = 6f;
					ai[1] = 0f;
					netUpdate = true;
					velocity *= 0.2f;
					if (Main.myPlayer == owner && type == 757)
					{
						NewProjectile(GetProjectileSource_FromThis(), base.Center, velocity, 928, damage, knockBack, Main.myPlayer);
					}
					break;
				}
				if (flag3)
				{
					ai[0] = 2f;
					ai[1] = 0f;
					netUpdate = true;
					velocity *= 0.3f;
					if (Main.myPlayer == owner && type == 757)
					{
						NewProjectile(GetProjectileSource_FromThis(), base.Center, velocity, 928, damage, knockBack, Main.myPlayer);
					}
				}
				player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
				localNPCHitCooldown = num13;
				break;
			}
			case 2:
			{
				Vector2 vector = DirectionTo(mountedCenter).SafeNormalize(Vector2.Zero);
				if (Distance(mountedCenter) <= num5)
				{
					Kill();
					return;
				}
				if (player.controlUseItem)
				{
					ai[0] = 6f;
					ai[1] = 0f;
					netUpdate = true;
					velocity *= 0.2f;
				}
				else
				{
					velocity *= 0.98f;
					velocity = velocity.MoveTowards(vector * num5, num4);
					player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
				}
				break;
			}
			case 3:
			{
				if (!player.controlUseItem)
				{
					ai[0] = 4f;
					ai[1] = 0f;
					netUpdate = true;
					break;
				}
				float num18 = Distance(mountedCenter);
				tileCollide = ai[1] == 1f;
				bool flag4 = num18 <= num16;
				if (flag4 != tileCollide)
				{
					tileCollide = flag4;
					ai[1] = (tileCollide ? 1 : 0);
					netUpdate = true;
				}
				if (num18 > (float)num10)
				{
					if (num18 >= num16)
					{
						velocity *= 0.5f;
						velocity = velocity.MoveTowards(DirectionTo(mountedCenter).SafeNormalize(Vector2.Zero) * num9, num9);
					}
					velocity *= 0.98f;
					velocity = velocity.MoveTowards(DirectionTo(mountedCenter).SafeNormalize(Vector2.Zero) * num9, num8);
				}
				else
				{
					if (velocity.Length() < 6f)
					{
						velocity.X *= 0.96f;
						velocity.Y += 0.2f;
					}
					if (player.velocity.X == 0f)
					{
						velocity.X *= 0.96f;
					}
				}
				player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
				break;
			}
			case 4:
			{
				tileCollide = false;
				Vector2 vector2 = DirectionTo(mountedCenter).SafeNormalize(Vector2.Zero);
				if (Distance(mountedCenter) <= num7)
				{
					Kill();
					return;
				}
				velocity *= 0.98f;
				velocity = velocity.MoveTowards(vector2 * num7, num6);
				Vector2 target = base.Center + velocity;
				Vector2 value = mountedCenter.DirectionFrom(target).SafeNormalize(Vector2.Zero);
				if (Vector2.Dot(vector2, value) < 0f)
				{
					Kill();
					return;
				}
				player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
				break;
			}
			case 5:
				if (ai[1]++ >= (float)num14)
				{
					ai[0] = 6f;
					ai[1] = 0f;
					netUpdate = true;
				}
				else
				{
					localNPCHitCooldown = num13;
					velocity.Y += 0.6f;
					velocity.X *= 0.95f;
					player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
				}
				break;
			case 6:
				if (!player.controlUseItem || Distance(mountedCenter) > num17)
				{
					ai[0] = 4f;
					ai[1] = 0f;
					netUpdate = true;
					break;
				}
				if (!shimmerWet)
				{
					velocity.Y += 0.8f;
				}
				velocity.X *= 0.95f;
				player.ChangeDir((player.Center.X < base.Center.X) ? 1 : (-1));
				break;
			}
			int num19 = type;
			if (num19 == 247)
			{
				flag = false;
				float num20 = (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
				rotation += ((velocity.X > 0f) ? num20 : (0f - num20));
				if (ai[0] == 0f)
				{
					rotation += MathF.PI * 2f / 15f * (float)player.direction;
				}
				float num21 = 600f;
				NPC nPC = null;
				if (owner == Main.myPlayer)
				{
					localAI[0] += 1f;
					if (localAI[0] >= 20f)
					{
						localAI[0] = 17f;
						for (int i = 0; i < 200; i++)
						{
							NPC nPC2 = Main.npc[i];
							if (nPC2.CanBeChasedBy(this))
							{
								float num22 = Distance(nPC2.Center);
								if (!(num22 >= num21) && Collision.CanHit(position, width, height, nPC2.position, nPC2.width, nPC2.height))
								{
									nPC = nPC2;
									num21 = num22;
								}
							}
						}
					}
					if (nPC != null)
					{
						localAI[0] = 0f;
						float num23 = 14f;
						Vector2 center = base.Center;
						Vector2 vector5 = center.DirectionTo(nPC.Center) * num23;
						NewProjectile(GetProjectileSource_FromThis(), center, vector5, 248, (int)((double)damage / 1.5), knockBack / 2f, Main.myPlayer);
					}
				}
			}
			direction = ((velocity.X > 0f) ? 1 : (-1));
			spriteDirection = direction;
			ownerHitCheck = flag2;
			if (flag)
			{
				if (velocity.Length() > 1f)
				{
					rotation = velocity.ToRotation() + velocity.X * 0.1f;
				}
				else
				{
					rotation += velocity.X * 0.1f;
				}
			}
			timeLeft = 2;
			player.heldProj = whoAmI;
			player.SetDummyItemTime(2);
			player.itemRotation = DirectionFrom(mountedCenter).ToRotation();
			if (base.Center.X < mountedCenter.X)
			{
				player.itemRotation += MathF.PI;
			}
			player.itemRotation = MathHelper.WrapAngle(player.itemRotation);
			AI_015_Flails_Dust(doFastThrowDust);
		}

		private void AI_015_HandleMovementCollision_Old(ref Vector2 wetVelocity, ref Vector2 lastVelocity)
		{
			bool flag = false;
			if (lastVelocity.X != velocity.X)
			{
				if (Math.Abs(lastVelocity.X) > 4f)
				{
					flag = true;
				}
				position.X += velocity.X;
				velocity.X = (0f - lastVelocity.X) * 0.2f;
			}
			if (lastVelocity.Y != velocity.Y)
			{
				if (Math.Abs(lastVelocity.Y) > 4f)
				{
					flag = true;
				}
				position.Y += velocity.Y;
				velocity.Y = (0f - lastVelocity.Y) * 0.2f;
			}
			ai[0] = 1f;
			if (flag)
			{
				netUpdate = true;
				Collision.HitTiles(position, velocity, width, height);
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
			}
			if (wet)
			{
				wetVelocity = velocity;
			}
		}

		private void AI_015_Flails_Old()
		{
			AI_015_Flails_Dust(doFastThrowDust: false);
			bool flag = Main.player[owner].dead;
			if (!flag)
			{
				flag = (Main.player[owner].Center - base.Center).Length() > 2000f;
			}
			if (flag)
			{
				Kill();
				return;
			}
			Main.player[owner].SetDummyItemTime(10);
			if (position.X + (float)(width / 2) > Main.player[owner].position.X + (float)(Main.player[owner].width / 2))
			{
				Main.player[owner].ChangeDir(1);
				direction = 1;
			}
			else
			{
				Main.player[owner].ChangeDir(-1);
				direction = -1;
			}
			Vector2 mountedCenter = Main.player[owner].MountedCenter;
			Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num = mountedCenter.X - vector.X;
			float num2 = mountedCenter.Y - vector.Y;
			float num3 = (float)Math.Sqrt(num * num + num2 * num2);
			if (ai[0] == 0f)
			{
				float num4 = 160f;
				if (type == 63)
				{
					num4 *= 1.5f;
				}
				if (type == 247)
				{
					num4 *= 1.5f;
				}
				if (type == 757)
				{
					num4 *= 1.5f;
				}
				tileCollide = true;
				if (num3 > num4)
				{
					ai[0] = 1f;
					netUpdate = true;
				}
				else if (!Main.player[owner].channel)
				{
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.9f;
					}
					velocity.Y += 1f;
					velocity.X *= 0.9f;
				}
			}
			else if (ai[0] == 1f)
			{
				float meleeSpeed = Main.player[owner].meleeSpeed;
				float num5 = 14f / meleeSpeed;
				float num6 = 0.9f / meleeSpeed;
				float num7 = 300f / meleeSpeed;
				int num8 = 60;
				if (type == 63)
				{
					num7 *= 1.5f;
					num5 *= 1.5f;
					num6 *= 1.5f;
				}
				if (type == 247)
				{
					num7 *= 1.5f;
					num5 = 15.9f;
					num6 *= 2f;
					num8 = 100;
				}
				if (type == 757)
				{
					num7 *= 1.5f;
					num5 = 15.9f;
					num6 *= 2f;
					num8 = 100;
				}
				Math.Abs(num);
				Math.Abs(num2);
				if (ai[1] == 1f)
				{
					tileCollide = false;
				}
				if (!Main.player[owner].channel || num3 > num7 || !tileCollide)
				{
					ai[1] = 1f;
					if (tileCollide)
					{
						netUpdate = true;
					}
					tileCollide = false;
					if (num3 < 20f)
					{
						Kill();
					}
				}
				if (!tileCollide)
				{
					num6 *= 2f;
				}
				if (num3 > (float)num8 || !tileCollide)
				{
					num3 = num5 / num3;
					num *= num3;
					num2 *= num3;
					new Vector2(velocity.X, velocity.Y);
					float num9 = num - velocity.X;
					float num10 = num2 - velocity.Y;
					float num11 = (float)Math.Sqrt(num9 * num9 + num10 * num10);
					num11 = num6 / num11;
					num9 *= num11;
					num10 *= num11;
					velocity.X *= 0.98f;
					velocity.Y *= 0.98f;
					velocity.X += num9;
					velocity.Y += num10;
				}
				else
				{
					if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < 6f)
					{
						velocity.X *= 0.96f;
						velocity.Y += 0.2f;
					}
					if (Main.player[owner].velocity.X == 0f)
					{
						velocity.X *= 0.96f;
					}
				}
			}
			if (type == 247)
			{
				if (velocity.X < 0f)
				{
					rotation -= (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
				}
				else
				{
					rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
				}
				float num12 = position.X;
				float num13 = position.Y;
				float num14 = 600f;
				bool flag2 = false;
				if (owner == Main.myPlayer)
				{
					localAI[1] += 1f;
					if (localAI[1] > 20f)
					{
						localAI[1] = 20f;
						for (int i = 0; i < 200; i++)
						{
							if (Main.npc[i].CanBeChasedBy(this))
							{
								float num15 = Main.npc[i].position.X + (float)(Main.npc[i].width / 2);
								float num16 = Main.npc[i].position.Y + (float)(Main.npc[i].height / 2);
								float num17 = Math.Abs(position.X + (float)(width / 2) - num15) + Math.Abs(position.Y + (float)(height / 2) - num16);
								if (num17 < num14 && Collision.CanHit(position, width, height, Main.npc[i].position, Main.npc[i].width, Main.npc[i].height))
								{
									num14 = num17;
									num12 = num15;
									num13 = num16;
									flag2 = true;
								}
							}
						}
					}
				}
				if (flag2)
				{
					localAI[1] = 0f;
					vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					num = num12 - vector.X;
					num2 = num13 - vector.Y;
					num3 = (float)Math.Sqrt(num * num + num2 * num2);
					num3 = 14f / num3;
					num *= num3;
					num2 *= num3;
					NewProjectile(GetProjectileSource_FromThis(), vector.X, vector.Y, num, num2, 248, (int)((double)damage / 1.5), knockBack / 2f, Main.myPlayer);
				}
			}
			else
			{
				rotation = (float)Math.Atan2(num2, num) - velocity.X * 0.1f;
			}
		}

		private void AI_015_Flails_Dust(bool doFastThrowDust)
		{
			if (type == 25)
			{
				int maxValue = 15;
				if (doFastThrowDust)
				{
					maxValue = 1;
				}
				if (Main.rand.Next(maxValue) == 0)
				{
					Dust.NewDust(position, width, height, 14, 0f, 0f, 150, default(Color), 1.3f);
				}
			}
			else if (type == 757)
			{
				int num = 4;
				if (velocity.Length() < 8f)
				{
					num = 10;
				}
				if (doFastThrowDust)
				{
					num /= 2;
				}
				for (int i = 0; i < 2; i++)
				{
					if (Main.rand.Next(num) == 0)
					{
						Dust dust = Dust.NewDustDirect(position, width, height, 5, 0f, 0f, 0, default(Color), 0.8f);
						dust.velocity += velocity / 4f;
						dust.fadeIn = 1.3f;
					}
				}
				num = 40;
				if (doFastThrowDust)
				{
					num /= 2;
				}
				for (float num2 = 0f; num2 < 1f; num2 += 0.1f)
				{
					if (Main.rand.Next(num) == 0)
					{
						Dust.NewDustDirect(Vector2.Lerp(Main.player[owner].Center, base.Center, Main.rand.NextFloat()) + new Vector2(-8f), 16, 16, 5, 0f, 0f, 0, default(Color), 1.3f).velocity += velocity / 4f;
					}
				}
			}
			else if (type == 26)
			{
				int num3 = Dust.NewDust(position, width, height, 172, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 1.5f);
				Main.dust[num3].noGravity = true;
				Main.dust[num3].velocity.X /= 2f;
				Main.dust[num3].velocity.Y /= 2f;
			}
			else if (type == 948 && !wet)
			{
				int num4 = Dust.NewDust(position, width, height, 6, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 1.2f);
				Main.dust[num4].noGravity = true;
				Main.dust[num4].velocity.X *= 4f;
				Main.dust[num4].velocity.Y *= 4f;
				Main.dust[num4].velocity = (Main.dust[num4].velocity + velocity) / 2f;
			}
			else if (type == 35)
			{
				int num5 = Dust.NewDust(position, width, height, 6, velocity.X * 0.4f, velocity.Y * 0.4f, 100, default(Color), 3f);
				Main.dust[num5].noGravity = true;
				Main.dust[num5].velocity.X *= 2f;
				Main.dust[num5].velocity.Y *= 2f;
			}
			else if (type == 154)
			{
				int num6 = Dust.NewDust(position, width, height, 115, velocity.X * 0.4f, velocity.Y * 0.4f, 140, default(Color), 1.5f);
				Main.dust[num6].noGravity = true;
				Main.dust[num6].velocity *= 0.25f;
			}
		}

		private void AI_100_Medusa()
		{
			Player player = Main.player[owner];
			Vector2 zero = Vector2.Zero;
			if (type == 535)
			{
				zero.X = (float)player.direction * 6f;
				zero.Y = player.gravDir * -14f;
				bool flag = true;
				bool flag2 = ai[0] > 0f;
				if (!player.dead)
				{
					timeLeft = 3;
				}
				if (ai[0] > 0f)
				{
					ai[0] -= 1f;
				}
				if (flag2)
				{
					if (frame < 8)
					{
						frame = 8;
					}
					if (frame >= 12)
					{
						frame = 8;
					}
					frameCounter++;
					if (++frameCounter >= 5)
					{
						frameCounter = 0;
						if (++frame >= 12)
						{
							frame = 8;
						}
					}
				}
				else if (++frameCounter >= 5)
				{
					frameCounter = 0;
					if (++frame >= 8)
					{
						frame = 0;
					}
				}
				Vector2 center = player.Center;
				Vector2 vector = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - center;
				if (player.gravDir == -1f)
				{
					vector.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - center.Y;
				}
				Vector2 vector2 = new Vector2(Math.Sign((vector.X == 0f) ? ((float)player.direction) : vector.X), 0f);
				if (vector2.X != velocity.X || vector2.Y != velocity.Y)
				{
					netUpdate = true;
				}
				velocity = vector2;
				if (flag2 && soundDelay == 0)
				{
					SoundEngine.PlaySound(4, (int)base.position.X, (int)base.position.Y, 17);
				}
				soundDelay = (flag2 ? 4 : 0);
				if (Main.myPlayer == owner)
				{
					Vector2 position = player.Center + new Vector2(player.direction * 4, player.gravDir * 2f);
					if (!player.channel)
					{
						Kill();
						return;
					}
					if (!flag2 || ai[0] % 15f == 0f)
					{
						bool flag3 = false;
						for (int i = 0; i < 200; i++)
						{
							NPC nPC = Main.npc[i];
							if (nPC.active && Distance(nPC.Center) < 320f && nPC.CanBeChasedBy(this) && Collision.CanHitLine(nPC.position, nPC.width, nPC.height, position, 0, 0))
							{
								flag3 = true;
								break;
							}
						}
						if (flag3)
						{
							bool flag4 = false;
							if (!flag || player.CheckMana(player.inventory[player.selectedItem].mana, pay: true))
							{
								int num = damage;
								position = base.Center;
								int num2 = 0;
								float num3 = 0f;
								_medusaHeadTargetList.Clear();
								for (int j = 0; j < 200; j++)
								{
									NPC nPC2 = Main.npc[j];
									float num4 = Distance(nPC2.Center);
									if (nPC2.active && num4 < 320f && nPC2.CanBeChasedBy(this) && Collision.CanHitLine(nPC2.position, nPC2.width, nPC2.height, position, 0, 0))
									{
										_medusaHeadTargetList.Add(Tuple.Create(j, num4));
									}
								}
								_medusaHeadTargetList.Sort(_medusaTargetComparer);
								for (int k = 0; k < _medusaHeadTargetList.Count && k < 3; k++)
								{
									Tuple<int, float> tuple = _medusaHeadTargetList[k];
									NPC nPC3 = Main.npc[tuple.Item1];
									Vector2 v = nPC3.Center - position;
									num3 += v.ToRotation();
									num2++;
									int num5 = NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, v.X, v.Y, 536, 0, 0f, owner, whoAmI);
									Main.projectile[num5].Center = nPC3.Center;
									Main.projectile[num5].damage = num;
									Main.projectile[num5].Damage();
									Main.projectile[num5].damage = 0;
									Main.projectile[num5].Center = position;
									ai[0] = 180f;
								}
								num3 = ((num2 == 0) ? ((player.direction == 1) ? 0f : MathF.PI) : (num3 / (float)num2));
								for (int l = 0; l < 4; l++)
								{
									Vector2 zero2 = Vector2.Zero;
									zero2 = ((Main.rand.Next(4) == 0) ? (Vector2.UnitX.RotatedByRandom(6.2831854820251465) * new Vector2(200f, 50f) * (Main.rand.NextFloat() * 0.7f + 0.3f)) : (Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(num3) * new Vector2(200f, 50f) * (Main.rand.NextFloat() * 0.7f + 0.3f)));
									NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, zero2.X, zero2.Y, 536, 0, 0f, owner, whoAmI);
								}
								ai[0] = 60f;
								netUpdate = true;
							}
						}
					}
				}
				Lighting.AddLight(base.Center, 0.9f, 0.75f, 0.1f);
			}
			rotation = ((player.gravDir == 1f) ? 0f : MathF.PI);
			spriteDirection = direction;
			timeLeft = 2;
			Vector2 vector3 = Main.OffsetsPlayerOnhand[player.bodyFrame.Y / 56] * 2f;
			if (player.direction != 1)
			{
				vector3.X = (float)player.bodyFrame.Width - vector3.X;
			}
			vector3 -= (player.bodyFrame.Size() - new Vector2(player.width, 42f)) / 2f;
			base.Center = (player.position + vector3 + zero - velocity).Floor();
			player.ChangeDir(direction);
			player.heldProj = whoAmI;
			player.SetDummyItemTime(2);
		}

		private void AI_120_StardustGuardian()
		{
			Player player = Main.player[owner];
			if (!player.active)
			{
				active = false;
				return;
			}
			bool flag = type == 623;
			Vector2 vector = player.Center;
			float num = 100f;
			float num2 = 500f;
			float num3 = 500f;
			float num4 = 100f;
			bool flag2 = true;
			if (flag)
			{
				if (player.dead)
				{
					player.stardustGuardian = false;
				}
				if (player.stardustGuardian)
				{
					timeLeft = 2;
				}
				num = 150f;
				vector.X -= (5 + player.width / 2) * player.direction;
				vector.Y -= 25f;
				Lighting.AddLight(base.Center, 0.9f, 0.9f, 0.7f);
				if (ai[0] != 3f && alpha == 255)
				{
					alpha = 0;
					for (int i = 0; i < 30; i++)
					{
						int num5 = Dust.NewDust(position, width, height, 135, 0f, 0f, 200, default(Color), 1.7f);
						Main.dust[num5].noGravity = true;
						Main.dust[num5].velocity *= 3f;
						Main.dust[num5].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
						num5 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100);
						Main.dust[num5].velocity *= 2f;
						Main.dust[num5].noGravity = true;
						Main.dust[num5].fadeIn = 2.5f;
						Main.dust[num5].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
					}
				}
			}
			if (ai[0] != 0f)
			{
				Main.player[owner].tankPet = whoAmI;
				Main.player[owner].tankPetReset = false;
			}
			if (ai[0] == 0f)
			{
				base.Center = Vector2.Lerp(base.Center, vector, 0.05f);
				velocity *= 0.5f;
				direction = (spriteDirection = player.direction);
				if (flag && ++frameCounter >= 9)
				{
					frameCounter = 0;
					if (++frame >= 8)
					{
						frame = 0;
					}
				}
				int targetNPCIndex = -1;
				float distanceToClosestTarget = num2;
				bool flag3 = flag2;
				if (flag && Math.Abs(base.Center.X - vector.X) > num + 20f)
				{
					flag3 = false;
				}
				if (flag3)
				{
					AI_120_StardustGuardian_FindTarget(num2, ref targetNPCIndex, ref distanceToClosestTarget);
				}
				if (targetNPCIndex != -1)
				{
					NPC nPC = Main.npc[targetNPCIndex];
					direction = (spriteDirection = (nPC.Center.X > base.Center.X).ToDirectionInt());
					float num6 = Math.Abs(vector.X - base.Center.X);
					float num7 = Math.Abs(nPC.Center.X - base.Center.X);
					float num8 = Math.Abs(vector.Y - base.Center.Y);
					float num9 = Math.Abs(nPC.Center.Y - base.Bottom.Y);
					float num10 = (nPC.Center.Y > base.Bottom.Y).ToDirectionInt();
					if ((num6 < num || (vector.X - base.Center.X) * (float)direction < 0f) && num7 > 20f && num7 < num - num6 + 100f)
					{
						velocity.X += 0.1f * (float)direction;
					}
					else
					{
						velocity.X *= 0.7f;
					}
					if ((num8 < num4 || (vector.Y - base.Bottom.Y) * num10 < 0f) && num9 > 10f && num9 < num4 - num8 + 10f)
					{
						velocity.Y += 0.1f * num10;
					}
					else
					{
						velocity.Y *= 0.7f;
					}
					if (owner == Main.myPlayer && num7 < num3)
					{
						ai[0] = 2f;
						ai[1] = targetNPCIndex;
						netUpdate = true;
					}
				}
			}
			else if (ai[0] == 1f)
			{
				if (player.HasMinionRestTarget)
				{
					vector = player.MinionRestTargetPoint;
				}
				else
				{
					ai[0] = 0f;
					netUpdate = true;
				}
				int targetNPCIndex2 = -1;
				float distanceToClosestTarget2 = num2;
				bool flag4 = true;
				if (flag && Math.Abs(base.Center.X - vector.X) > num + 20f)
				{
					flag4 = false;
				}
				if (flag4)
				{
					AI_120_StardustGuardian_FindTarget(num2, ref targetNPCIndex2, ref distanceToClosestTarget2);
				}
				if (targetNPCIndex2 != -1)
				{
					NPC nPC2 = Main.npc[targetNPCIndex2];
					direction = (spriteDirection = (nPC2.Center.X > base.Center.X).ToDirectionInt());
					float num11 = Math.Abs(vector.X - base.Center.X);
					float num12 = Math.Abs(nPC2.Center.X - base.Center.X);
					float num13 = Math.Abs(vector.Y - base.Center.Y);
					float num14 = Math.Abs(nPC2.Center.Y - base.Bottom.Y);
					float num15 = (nPC2.Center.Y > base.Bottom.Y).ToDirectionInt();
					if ((num11 < num || (vector.X - base.Center.X) * (float)direction < 0f) && num12 > 20f && num12 < num - num11 + 100f)
					{
						velocity.X += 0.1f * (float)direction;
					}
					else
					{
						velocity.X *= 0.7f;
					}
					if ((num13 < num4 || (vector.Y - base.Bottom.Y) * num15 < 0f) && num14 > 10f && num14 < num4 - num13 + 10f)
					{
						velocity.Y += 0.1f * num15;
					}
					else
					{
						velocity.Y *= 0.7f;
					}
					if (owner == Main.myPlayer && num12 < num3)
					{
						ai[0] = 2f;
						ai[1] = targetNPCIndex2;
						netUpdate = true;
					}
				}
				else
				{
					if (Math.Abs(vector.X - base.Center.X) > num + 40f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					else if (Math.Abs(vector.X - base.Center.X) > 20f)
					{
						direction = (spriteDirection = (vector.X > base.Center.X).ToDirectionInt());
						velocity.X += 0.06f * (float)direction;
					}
					else
					{
						velocity.X *= 0.8f;
						direction = (spriteDirection = (player.Center.X < base.Center.X).ToDirectionInt());
					}
					if (Math.Abs(vector.Y - base.Center.Y) > num4)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					else if (Math.Abs(vector.Y - base.Center.Y) > 10f)
					{
						velocity.Y += 0.06f * (float)Math.Sign(vector.Y - base.Center.Y);
					}
					else
					{
						velocity.Y *= 0.8f;
					}
				}
				if (flag && ++frameCounter >= 9)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type] - 4)
					{
						frame = 0;
					}
				}
			}
			else if (ai[0] == 2f)
			{
				if (flag)
				{
					int num16 = 3;
					if (frame < 12)
					{
						frame = 12;
					}
					if (frame == 12 || frame == 13)
					{
						num16 = 8;
					}
					if (++frameCounter >= num16)
					{
						frameCounter = 0;
						if (++frame >= 19)
						{
							frame = 14;
						}
					}
				}
				bool flag5 = false;
				if (flag2)
				{
					flag5 = Distance(player.Center) < num2;
				}
				NPC nPC3 = null;
				int num17 = (int)ai[1];
				if (Main.npc.IndexInRange(num17))
				{
					nPC3 = Main.npc[num17];
					if (!nPC3.CanBeChasedBy(this) || Distance(nPC3.Center) > num3)
					{
						nPC3 = null;
					}
				}
				if (!flag5 || nPC3 == null)
				{
					ai[1] = 0f;
					ai[0] = 0f;
					netUpdate = true;
					if (frame < 18)
					{
						frame = 18;
					}
				}
				else
				{
					int num18 = (((nPC3.Center - player.Center).X > 1f) ? 1 : (-1));
					Vector2 targetPosition = nPC3.Center + new Vector2((float)(-num18) * ((float)nPC3.width * 0.5f + 70f), -10f) - base.Center;
					float maxAmountAllowedToMove = 6f * Utils.Remap(targetPosition.Length(), 50f, 400f, 1f, 4f);
					int num19 = 32;
					Vector2 targetPosition2 = Vector2.Zero.MoveTowards(targetPosition, maxAmountAllowedToMove);
					velocity = velocity.MoveTowards(targetPosition2, num19);
					direction = (spriteDirection = num18);
					if (localAI[0]++ >= 3f)
					{
						localAI[0] = 0f;
						int targetNPCIndex3 = -1;
						float distanceToClosestTarget3 = -1f;
						AI_120_StardustGuardian_FindTarget(num2, ref targetNPCIndex3, ref distanceToClosestTarget3);
						if (targetNPCIndex3 != -1)
						{
							ai[1] = targetNPCIndex3;
							netUpdate = true;
						}
					}
				}
			}
			else
			{
				_ = ai[0];
				_ = 2f;
			}
			if (ai[0] != 3f)
			{
				return;
			}
			if (player.HasMinionRestTarget)
			{
				vector = player.MinionRestTargetPoint;
			}
			else
			{
				ai[0] = 0f;
				netUpdate = true;
			}
			if (alpha == 0)
			{
				alpha = 255;
				for (int j = 0; j < 30; j++)
				{
					int num20 = Dust.NewDust(position, width, height, 135, 0f, 0f, 200, default(Color), 1.7f);
					Main.dust[num20].noGravity = true;
					Main.dust[num20].velocity *= 3f;
					Main.dust[num20].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
					num20 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100);
					Main.dust[num20].velocity *= 2f;
					Main.dust[num20].noGravity = true;
					Main.dust[num20].fadeIn = 2.5f;
					Main.dust[num20].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
				}
			}
			else
			{
				for (int k = 0; k < 2; k++)
				{
					int num21 = Dust.NewDust(position, width, height, 135, 0f, 0f, 200, default(Color), 1.7f);
					Main.dust[num21].noGravity = true;
					Main.dust[num21].velocity *= 3f;
					Main.dust[num21].noLight = true;
					Main.dust[num21].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
					num21 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100);
					Main.dust[num21].velocity *= 2f;
					Main.dust[num21].noGravity = true;
					Main.dust[num21].fadeIn = 2.5f;
					Main.dust[num21].noLight = true;
					Main.dust[num21].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cPet, Main.player[owner]);
				}
			}
			velocity *= 0.7f;
			base.Center = Vector2.Lerp(base.Center, vector, 0.2f);
			if (Distance(vector) < 10f)
			{
				ai[0] = 1f;
				netUpdate = true;
			}
		}

		private void AI_120_StardustGuardian_FindTarget(float lookupRange, ref int targetNPCIndex, ref float distanceToClosestTarget)
		{
			Vector2 center = Main.player[owner].Center;
			for (int i = 0; i < 200; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.CanBeChasedBy(this))
				{
					float num = center.Distance(nPC.Center);
					if (num < lookupRange)
					{
						targetNPCIndex = i;
						distanceToClosestTarget = num;
						lookupRange = num;
					}
				}
			}
		}

		private void AI_180_FairyQueenSunDance()
		{
			if (localAI[0] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item159, base.Center);
			}
			localAI[0] += 1f;
			float num = 180f;
			_ = ai[0] / (MathF.PI * 2f);
			float num2 = MathF.PI / 9f;
			if (localAI[0] >= num)
			{
				Kill();
				return;
			}
			alpha -= 15;
			if (alpha < 0)
			{
				alpha = 0;
			}
			scale = Utils.GetLerpValue(0f, 20f, localAI[0], clamped: true) * Utils.GetLerpValue(num, num - 60f, localAI[0], clamped: true);
			float lerpValue = Utils.GetLerpValue(50f, num, localAI[0], clamped: true);
			rotation = ai[0] + lerpValue * num2;
			int num3 = (int)ai[1];
			if (Main.npc.IndexInRange(num3))
			{
				NPC nPC = Main.npc[num3];
				if (nPC.active && nPC.type == 636)
				{
					base.Center = nPC.Center;
				}
				velocity = Vector2.Zero;
				Vector2 vector = rotation.ToRotationVector2();
				Vector3 v3_ = Main.hslToRgb((ai[0] / (MathF.PI * 2f) + localAI[0] / num) % 1f, 1f, 0.85f).ToVector3() * scale;
				float num4 = 800f * scale;
				DelegateMethods.v3_1 = v3_;
				for (float num5 = 0f; num5 <= 1f; num5 += 1f / 12f)
				{
					Point point = (base.Center + vector * num4 * num5).ToTileCoordinates();
					DelegateMethods.CastLightOpen(point.X, point.Y);
				}
			}
			else
			{
				Kill();
			}
		}

		private void AI_179_FairyQueenLance()
		{
			localAI[0] += 1f;
			if (localAI[0] >= 60f)
			{
				velocity = ai[0].ToRotationVector2() * 40f;
				if (Main.rand.Next(3) == 0)
				{
					Dust dust = Dust.NewDustPerfect(base.Center, 267);
					dust.fadeIn = 1f;
					dust.noGravity = true;
					dust.alpha = 100;
					dust.color = Color.Lerp(AI_171_GetColor(), Color.White, Main.rand.NextFloat() * 0.4f);
					dust.noLightEmittence = true;
					dust.scale *= 1.5f;
				}
			}
			if (localAI[0] >= 360f)
			{
				Kill();
				return;
			}
			alpha = (int)MathHelper.Lerp(255f, 0f, Utils.GetLerpValue(0f, 20f, localAI[0], clamped: true));
			rotation = ai[0];
		}

		private void AI_176_EdgyLightning()
		{
			int num = (int)ai[0] - 1;
			if (num != -1 && (!Main.npc[num].CanBeChasedBy(this) || localNPCImmunity[num] != 0))
			{
				ai[0] = 0f;
				num = -1;
			}
			if (num == -1)
			{
				NPC nPC = FindTargetWithinRange(400f);
				if (nPC != null)
				{
					num = nPC.whoAmI;
					ai[0] = num + 1;
					netUpdate = true;
				}
			}
			if (num != -1)
			{
				NPC nPC2 = Main.npc[num];
				Vector2 vector = DirectionTo(nPC2.Center);
				float num2 = 10f;
				if (!vector.HasNaNs())
				{
					velocity = vector * num2;
					rotation = velocity.ToRotation();
				}
				if (++frameCounter >= 3)
				{
					frameCounter = 0;
					frame = Main.rand.Next(Main.projFrames[type]);
				}
			}
			else
			{
				Kill();
			}
		}

		public NPC FindTargetWithinRange(float maxRange, bool checkCanHit = false)
		{
			NPC result = null;
			float num = maxRange;
			for (int i = 0; i < 200; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.CanBeChasedBy(this) && localNPCImmunity[i] == 0 && (!checkCanHit || Collision.CanHitLine(position, width, height, nPC.position, nPC.width, nPC.height)))
				{
					float num2 = Distance(nPC.Center);
					if (!(num <= num2))
					{
						num = num2;
						result = nPC;
					}
				}
			}
			return result;
		}

		private void AI_177_IceWhipSlicer()
		{
			//IL_0085: Unknown result type (might be due to invalid IL or missing references)
			//IL_008a: Unknown result type (might be due to invalid IL or missing references)
			//IL_009c: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
			//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
			Player player = Main.player[owner];
			if (type == 917 && (!player.active || player.dead))
			{
				player.coolWhipBuff = false;
				Kill();
				return;
			}
			if (type == 917 && player.coolWhipBuff)
			{
				timeLeft = 2;
			}
			if (type == 969)
			{
				SlotId val;
				if (soundDelay == 0)
				{
					soundDelay = -1;
					float[] array = localAI;
					val = SoundEngine.PlayTrackedSound(SoundID.DD2_BookStaffTwisterLoop, base.Center);
					array[1] = ((SlotId)(ref val)).ToFloat();
				}
				ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
				if (activeSound != null)
				{
					activeSound.Position = base.Center;
					activeSound.Volume = 1f - Math.Max(ai[1] - 555f, 0f) / 15f;
				}
				else
				{
					float[] array2 = localAI;
					val = SlotId.Invalid;
					array2[1] = ((SlotId)(ref val)).ToFloat();
				}
				ai[1] += 1f;
				if (ai[1] > 560f)
				{
					alpha = (int)MathHelper.Lerp(0f, 250f, (ai[1] - 560f) / 10f);
				}
				if (ai[1] >= 570f)
				{
					Kill();
				}
				float num = 555f;
				for (int i = 0; i < 1000; i++)
				{
					if (i != whoAmI && Main.projectile[i].active && Main.projectile[i].owner == owner && Main.projectile[i].type == type && timeLeft > Main.projectile[i].timeLeft && Main.projectile[i].ai[1] < num)
					{
						Main.projectile[i].ai[1] = num;
						Main.projectile[i].netUpdate = true;
					}
				}
			}
			int num2 = (int)ai[0] - 1;
			if (num2 != -1 && (!Main.npc[num2].CanBeChasedBy(this) || localNPCImmunity[num2] > 0))
			{
				ai[0] = 0f;
				num2 = -1;
			}
			if (num2 == -1)
			{
				bool checkCanHit = false;
				if (type == 969)
				{
					checkCanHit = true;
				}
				NPC nPC = FindTargetWithinRange(400f, checkCanHit);
				if (nPC != null)
				{
					num2 = nPC.whoAmI;
					ai[0] = num2 + 1;
					netUpdate = true;
				}
			}
			float num3 = 18f;
			float amount = 0.1f;
			float num4 = 0f;
			if (type == 969)
			{
				num3 = 8f;
				amount = 0.075f;
				num4 = 25f;
			}
			if (num2 != -1)
			{
				NPC nPC2 = Main.npc[num2];
				float num5 = Distance(nPC2.Center);
				if (num3 > num5)
				{
					num3 = num5;
				}
				Vector2 vector = DirectionTo(nPC2.Center);
				if (!vector.HasNaNs() && num5 >= num4)
				{
					velocity = Vector2.Lerp(velocity, vector * num3, amount);
				}
			}
			else if (type == 969)
			{
				Vector2 vector2 = DirectionTo(base.Center + velocity);
				if (!vector2.HasNaNs())
				{
					velocity = Vector2.Lerp(velocity, vector2 * num3, amount);
				}
			}
			else
			{
				velocity *= 0.92f;
			}
			if (type == 969)
			{
				rotation = velocity.X * 0.0125f;
				if (++frameCounter > 4)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				if (timeLeft % 3 == 0)
				{
					int num6 = Dust.NewDust(position, width, height, 16, velocity.X, velocity.Y, 120, default(Color), 0.5f);
					Main.dust[num6].noGravity = true;
					Main.dust[num6].fadeIn = 0.9f;
					Main.dust[num6].velocity = Main.rand.NextVector2Circular(2f, 2f) + new Vector2(0f, -2f) + velocity * 0.75f;
					for (int j = 0; j < 2; j++)
					{
						Dust dust = Dust.NewDustDirect(position, width, height, 16, velocity.X, velocity.Y, 60, default(Color), 0.5f);
						dust.noGravity = true;
						dust.fadeIn = 0.7f;
						dust.velocity = Main.rand.NextVector2Circular(2f, 2f) * 0.2f + new Vector2(0f, -0.4f) + velocity * 1.5f;
						dust.position -= velocity * 3f;
					}
				}
			}
			else
			{
				rotation += 0.020943953f + Math.Abs(velocity.X) * 0.2f;
				if (Main.rand.Next(3) == 0)
				{
					Dust dust2 = Dust.NewDustDirect(base.Center, 0, 0, 43, velocity.X, velocity.Y, 254, Color.White, 0.5f);
					Vector2 vector3 = Main.rand.NextVector2Circular(1f, 1f);
					dust2.position = base.Center + vector3 * 10f;
					dust2.velocity = vector3;
				}
			}
		}

		private void AI_178_FireExplosion()
		{
			if (localAI[0] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
				for (int i = 0; i < 4; i++)
				{
					int num = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int j = 0; j < 30; j++)
				{
					int num2 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 3.7f);
					Main.dust[num2].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num2].noGravity = true;
					Main.dust[num2].velocity *= 3f;
					num2 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num2].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num2].velocity *= 2f;
					Main.dust[num2].noGravity = true;
					Main.dust[num2].fadeIn = 2.5f;
				}
				for (int k = 0; k < 10; k++)
				{
					int num3 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num3].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num3].noGravity = true;
					Main.dust[num3].velocity *= 3f;
				}
				for (int l = 0; l < 10; l++)
				{
					int num4 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num4].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num4].noGravity = true;
					Main.dust[num4].velocity *= 3f;
				}
				for (int m = 0; m < 2; m++)
				{
					int num5 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num5].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.gore[num5].velocity *= 0.3f;
					Main.gore[num5].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num5].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
			}
			localAI[0] += 1f;
			if (localAI[0] >= 10f)
			{
				Kill();
			}
		}

		private void AI_175_TitaniumStormShards()
		{
			Player player = Main.player[owner];
			if (!player.active || player.dead || !player.hasTitaniumStormBuff)
			{
				Kill();
				return;
			}
			if (frameCounter == 0)
			{
				frameCounter = 1;
				frame = Main.rand.Next(12);
				rotation = Main.rand.NextFloat() * (MathF.PI * 2f);
			}
			rotation += MathF.PI / 200f;
			AI_GetMyGroupIndexAndFillBlackList(null, out var index, out var totalIndexesInGroup);
			float f = ((float)index / (float)totalIndexesInGroup + player.miscCounterNormalized * 6f) * (MathF.PI * 2f);
			float num = 24f + (float)totalIndexesInGroup * 6f;
			Vector2 vector = player.position - player.oldPosition;
			base.Center += vector;
			Vector2 vector2 = f.ToRotationVector2();
			localAI[0] = vector2.Y;
			Vector2 value = player.Center + vector2 * new Vector2(1f, 0.05f) * num;
			base.Center = Vector2.Lerp(base.Center, value, 0.3f);
		}

		private void AI_174_MultisegmentPet()
		{
			Player player = Main.player[owner];
			if (!player.active)
			{
				active = false;
				return;
			}
			if (type == 883)
			{
				if (player.dead)
				{
					player.petFlagEaterOfWorldsPet = false;
				}
				if (player.petFlagEaterOfWorldsPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 887)
			{
				if (player.dead)
				{
					player.petFlagDestroyerPet = false;
				}
				if (player.petFlagDestroyerPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 893)
			{
				if (player.dead)
				{
					player.petFlagLunaticCultistPet = false;
				}
				if (player.petFlagLunaticCultistPet)
				{
					timeLeft = 2;
				}
			}
			Vector2 center = player.Center;
			if (Distance(center) > 2000f)
			{
				base.Center = center;
				velocity = Vector2.Zero;
				netUpdate = true;
			}
			float num = (center - base.Center).Length();
			float num2 = Math.Min(12f, Math.Max(4f, player.velocity.Length()));
			velocity.Length();
			if (velocity == Vector2.Zero)
			{
				velocity.X = 2f * (float)player.direction;
				Vector2 vector = position;
				for (int i = 0; i < oldPos.Length; i++)
				{
					vector -= velocity;
					oldPos[i] = vector;
				}
			}
			if (!(num < 120f))
			{
				float targetAngle = AngleTo(center);
				float f = velocity.ToRotation().AngleTowards(targetAngle, MathHelper.ToRadians(5f));
				velocity = f.ToRotationVector2() * num2;
			}
			if (velocity.Length() > num2)
			{
				velocity = velocity.SafeNormalize(Vector2.Zero) * num2;
			}
			if (Math.Abs(velocity.Y) < 1f)
			{
				velocity.Y -= 0.1f;
			}
			rotation = velocity.ToRotation() + MathF.PI / 2f;
			int num3 = direction;
			direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
			if (num3 != direction)
			{
				netUpdate = true;
			}
			position.X = MathHelper.Clamp(position.X, 160f, Main.maxTilesX * 16 - 160);
			position.Y = MathHelper.Clamp(position.Y, 160f, Main.maxTilesY * 16 - 160);
		}

		private void AI_173_HallowBossRainbowTrail()
		{
			Opacity = Utils.GetLerpValue(0f, 60f, timeLeft, clamped: true) * Utils.GetLerpValue(660f, 600f, timeLeft, clamped: true);
			float num = MathF.PI / 360f;
			float num2 = 30f;
			velocity = velocity.RotatedBy(ai[0]);
			if (ai[0] < num)
			{
				ai[0] += num / num2;
			}
			rotation = velocity.ToRotation() + MathF.PI / 2f;
		}

		public Color AI_173_GetColor()
		{
			if (NPC.ShouldEmpressBeEnraged())
			{
				float lerpValue = Utils.GetLerpValue(0f, 60f, (int)Main.time, clamped: true);
				return Color.Lerp(Color.White, Main.OurFavoriteColor, lerpValue) * Opacity;
			}
			return Main.hslToRgb((ai[1] + 0f) % 1f, 1f, 0.5f) * Opacity;
		}

		private void AI_171_HallowBossRainbowStreak()
		{
			bool flag = false;
			bool flag2 = false;
			float num = 140f;
			float num2 = 30f;
			float num3 = 0.98f;
			float value = 0.05f;
			float value2 = 0.1f;
			float num4 = 30f;
			if (type == 931)
			{
				num = 180f;
				num2 = 20f;
				num4 = 30f;
				num3 = 0.97f;
				value = 0.075f;
				value2 = 0.125f;
				if (timeLeft == 238)
				{
					int num5 = alpha;
					alpha = 0;
					Color fairyQueenWeaponsColor = GetFairyQueenWeaponsColor();
					alpha = num5;
					for (int i = 0; i < 3; i++)
					{
						Dust dust = Dust.NewDustPerfect(base.Center, 267, Main.rand.NextVector2CircularEdge(3f, 3f) * (Main.rand.NextFloat() * 0.5f + 0.5f), 0, fairyQueenWeaponsColor);
						dust.scale *= 1.2f;
						dust.noGravity = true;
					}
				}
			}
			if ((float)timeLeft > num)
			{
				flag = true;
			}
			else if ((float)timeLeft > num2)
			{
				flag2 = true;
			}
			if (flag)
			{
				float num6 = (float)Math.Cos((float)whoAmI % 6f / 6f + position.X / 320f + position.Y / 160f);
				velocity *= num3;
				velocity = velocity.RotatedBy(num6 * (MathF.PI * 2f) * 0.125f * 1f / 30f);
			}
			if (friendly)
			{
				int num7 = (int)ai[0];
				if (Main.npc.IndexInRange(num7) && !Main.npc[num7].CanBeChasedBy(this))
				{
					num7 = -1;
					ai[0] = -1f;
					netUpdate = true;
				}
				if (num7 == -1)
				{
					int num8 = FindTargetWithLineOfSight();
					if (num8 != -1)
					{
						num7 = num8;
						ai[0] = num8;
						netUpdate = true;
					}
				}
			}
			if (flag2)
			{
				int num9 = (int)ai[0];
				Vector2 value3 = velocity;
				if (hostile && Main.player.IndexInRange(num9))
				{
					Player player = Main.player[num9];
					value3 = DirectionTo(player.Center) * num4;
				}
				if (friendly)
				{
					if (Main.npc.IndexInRange(num9))
					{
						if (timeLeft < 10)
						{
							timeLeft = 10;
						}
						NPC nPC = Main.npc[num9];
						value3 = DirectionTo(nPC.Center) * num4;
					}
					else
					{
						timeLeft--;
					}
				}
				float amount = MathHelper.Lerp(value, value2, Utils.GetLerpValue(num, 30f, timeLeft, clamped: true));
				velocity = Vector2.SmoothStep(velocity, value3, amount);
				if (type == 931)
				{
					velocity *= MathHelper.Lerp(0.85f, 1f, Utils.GetLerpValue(0f, 90f, timeLeft, clamped: true));
				}
			}
			Opacity = Utils.GetLerpValue(240f, 220f, timeLeft, clamped: true);
			rotation = velocity.ToRotation() + MathF.PI / 2f;
		}

		public Color AI_171_GetColor()
		{
			if (NPC.ShouldEmpressBeEnraged())
			{
				float lerpValue = Utils.GetLerpValue(0f, 60f, (int)Main.time, clamped: true);
				return Color.Lerp(Color.White, Main.OurFavoriteColor, lerpValue) * Opacity;
			}
			return Main.hslToRgb((ai[1] + 0.5f) % 1f, 1f, 0.5f) * Opacity;
		}

		private void AI_172_HallowBossRainbowPelletStorm()
		{
			if (localAI[1] <= 90f)
			{
				localAI[1] += 1f;
				scale = 0.5f;
				Opacity = 0.5f;
				float lerpValue = Utils.GetLerpValue(0f, 90f, localAI[1]);
				scale = MathHelper.Lerp(5f, 1f, lerpValue);
				Opacity = 1f - (1f - lerpValue * lerpValue);
				return;
			}
			scale = 1f;
			Opacity = 1f;
			float num = 150f + 10f * (float)AI_172_GetPelletStormsCount();
			localAI[0] += 1f;
			if (localAI[0] >= num)
			{
				Kill();
				return;
			}
			velocity = Vector2.Zero;
			rotation = 0f;
			int num2 = AI_172_GetPelletStormsCount();
			for (int i = 0; i < num2; i++)
			{
				HallowBossPelletStormInfo hallowBossPelletStormInfo = AI_172_GetPelletStormInfo(i);
				for (int j = 0; j < hallowBossPelletStormInfo.BulletsInStorm; j++)
				{
					if (hallowBossPelletStormInfo.IsValid(j))
					{
						hallowBossPelletStormInfo.GetBulletPosition(j, base.Center);
					}
				}
			}
		}

		public int AI_172_GetPelletStormsCount()
		{
			return 6;
		}

		public HallowBossPelletStormInfo AI_172_GetPelletStormInfo(int stormIndex)
		{
			float from = 0f + (float)stormIndex * 10f;
			float to = 90f + (float)stormIndex * 10f;
			HallowBossPelletStormInfo result = default(HallowBossPelletStormInfo);
			result.StartAngle = (float)stormIndex * (MathF.PI / 3f) - MathF.PI / 2f + (float)stormIndex * (MathF.PI / 5f);
			result.AnglePerBullet = MathF.PI * 2f / 3f;
			result.BulletsInStorm = 3;
			result.BulletsProgressInStormStartNormalized = Utils.GetLerpValue(from, to, localAI[0]);
			result.BulletsProgressInStormBonusByIndexNormalized = 0f;
			result.StormTotalRange = 500f;
			result.BulletSize = new Vector2(16f, 16f);
			return result;
		}

		public int FindTargetWithLineOfSight(float maxRange = 800f)
		{
			float num = maxRange;
			int result = -1;
			for (int i = 0; i < 200; i++)
			{
				NPC nPC = Main.npc[i];
				bool flag = nPC.CanBeChasedBy(this);
				if (localNPCImmunity[i] != 0)
				{
					flag = false;
				}
				if (flag)
				{
					float num2 = Distance(Main.npc[i].Center);
					if (num2 < num && Collision.CanHit(position, width, height, nPC.position, nPC.width, nPC.height))
					{
						num = num2;
						result = i;
					}
				}
			}
			return result;
		}

		private void AI_170_FairyGlowstick()
		{
			Point p = base.Center.ToTileCoordinates();
			Vector2 vector = p.ToVector2();
			int num = 10;
			Vector2 zero = Vector2.Zero;
			int num2 = 0;
			float num3 = 3f;
			if (ai[1] == 1f)
			{
				SoundEngine.PlaySound(SoundID.Item28, position);
				rotation = 0f;
				velocity.X = 0f;
				ai[1] = 2f;
			}
			frameCounter++;
			if (frameCounter > 4)
			{
				frameCounter = 0;
				frame++;
				if (frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			if (velocity.Length() > 1f && timeLeft % 10 == 0)
			{
				for (int i = p.X - num; i < p.X + num + 1; i++)
				{
					for (int j = p.Y - num; j < p.Y + num + 1; j++)
					{
						if (WorldGen.SolidTile(i, j))
						{
							Vector2 v = vector - new Vector2(i, j);
							Vector2 vector2 = v.SafeNormalize(Vector2.Zero) * Math.Max((float)num - v.Length(), 0f);
							vector2 *= num3;
							zero += vector2;
							num2++;
						}
					}
				}
				if (num2 > 0)
				{
					zero /= (float)num2;
				}
				if (zero.Length() > 1f)
				{
					velocity = zero;
				}
			}
			velocity *= 0.95f;
			if (velocity.Length() < 1f)
			{
				velocity = Vector2.Zero;
				netUpdate = true;
			}
		}

		private void AI_169_Smolstars()
		{
			Player player = Main.player[owner];
			bool num = type == 864;
			Vector2 vector = player.Top + new Vector2(0f, -30f);
			if (num)
			{
				if (player.dead)
				{
					player.smolstar = false;
				}
				if (player.smolstar)
				{
					timeLeft = 2;
				}
				if (ai[0] == 0f)
				{
					AI_GetMyGroupIndexAndFillBlackList(null, out var index, out var totalIndexesInGroup);
					float num2 = MathF.PI * 2f / (float)totalIndexesInGroup;
					float num3 = (float)totalIndexesInGroup * 0.66f;
					Vector2 vector2 = new Vector2(30f, 6f) / 5f * (totalIndexesInGroup - 1);
					Vector2 vector3 = Vector2.UnitY.RotatedBy(num2 * (float)index + Main.GlobalTimeWrappedHourly % num3 / num3 * (MathF.PI * 2f));
					vector += vector3 * vector2;
					vector.Y += player.gfxOffY;
					vector = vector.Floor();
				}
			}
			if (ai[0] == 0f)
			{
				Vector2 vector4 = vector - base.Center;
				float num4 = 10f;
				float lerpValue = Utils.GetLerpValue(200f, 600f, vector4.Length(), clamped: true);
				num4 += lerpValue * 30f;
				if (vector4.Length() >= 3000f)
				{
					base.Center = vector;
				}
				velocity = vector4;
				if (velocity.Length() > num4)
				{
					velocity *= num4 / velocity.Length();
				}
				int startAttackRange = 800;
				int attackTarget = -1;
				Minion_FindTargetInRange(startAttackRange, ref attackTarget, skipIfCannotHitWithOwnBody: false);
				if (attackTarget != -1)
				{
					ai[0] = 60f;
					ai[1] = attackTarget;
					netUpdate = true;
				}
				float targetAngle = velocity.SafeNormalize(Vector2.UnitY).ToRotation() + MathF.PI / 2f;
				if (vector4.Length() < 40f)
				{
					targetAngle = Vector2.UnitY.ToRotation() + MathF.PI / 2f;
				}
				rotation = rotation.AngleLerp(targetAngle, 0.2f);
				return;
			}
			if (ai[0] == -1f)
			{
				if (ai[1] == 0f)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int i = 0; i < 2; i++)
					{
						Dust dust = Dust.NewDustDirect(position, width, height, 15, oldVelocity.X * 0.2f, oldVelocity.Y * 0.2f, 0, default(Color), 1.4f);
						if (Main.rand.Next(3) != 0)
						{
							dust.scale *= 1.3f;
							dust.velocity *= 1.1f;
						}
						dust.noGravity = true;
						dust.fadeIn = 0f;
					}
					velocity += Main.rand.NextVector2CircularEdge(4f, 4f);
				}
				ai[1] += 1f;
				rotation += velocity.X * 0.1f + velocity.Y * 0.05f;
				velocity *= 0.92f;
				if (ai[1] >= 9f)
				{
					ai[0] = 0f;
					ai[1] = 0f;
				}
				return;
			}
			NPC nPC = null;
			int num5 = (int)ai[1];
			if (Main.npc.IndexInRange(num5) && Main.npc[num5].CanBeChasedBy(this))
			{
				nPC = Main.npc[num5];
			}
			if (nPC == null)
			{
				ai[0] = -1f;
				ai[1] = 0f;
				netUpdate = true;
			}
			else if (player.Distance(nPC.Center) >= 900f)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				netUpdate = true;
			}
			else
			{
				Vector2 vector5 = nPC.Center - base.Center;
				float num6 = 16f;
				velocity = vector5;
				if (velocity.Length() > num6)
				{
					velocity *= num6 / velocity.Length();
				}
				float targetAngle2 = velocity.SafeNormalize(Vector2.UnitY).ToRotation() + MathF.PI / 2f;
				rotation = rotation.AngleLerp(targetAngle2, 0.4f);
			}
			float num7 = 0.1f;
			float num8 = width * 5;
			for (int j = 0; j < 1000; j++)
			{
				if (j != whoAmI && Main.projectile[j].active && Main.projectile[j].owner == owner && Main.projectile[j].type == type && Math.Abs(position.X - Main.projectile[j].position.X) + Math.Abs(position.Y - Main.projectile[j].position.Y) < num8)
				{
					if (position.X < Main.projectile[j].position.X)
					{
						velocity.X -= num7;
					}
					else
					{
						velocity.X += num7;
					}
					if (position.Y < Main.projectile[j].position.Y)
					{
						velocity.Y -= num7;
					}
					else
					{
						velocity.Y += num7;
					}
				}
			}
		}

		private void AI_019_Spears()
		{
			Player player = Main.player[owner];
			Vector2 center = player.RotatedRelativePoint(player.MountedCenter);
			direction = player.direction;
			player.heldProj = whoAmI;
			player.MatchItemTimeToItemAnimation();
			base.Center = center;
			bool flag = Main.player[owner].itemAnimation < Main.player[owner].itemAnimationMax / 3;
			int itemAnimationMax = player.itemAnimationMax;
			int itemAnimation = player.itemAnimation;
			int num = Main.player[owner].itemAnimationMax / 3;
			float num2 = MathHelper.Min(itemAnimation, num);
			float num3 = (float)itemAnimation - num2;
			float num4 = 0f;
			float num5 = 0f;
			float num6 = 0f;
			bool flag2 = false;
			spriteDirection = -direction;
			switch (type)
			{
			case 46:
				num4 = 3f;
				num6 = 1.6f;
				num5 = 1.4f;
				break;
			case 105:
				num4 = 3f;
				num6 = 2.4f;
				num5 = 2.1f;
				break;
			case 367:
				num4 = 3f;
				num6 = 1.6f;
				num5 = 1.5f;
				break;
			case 368:
				num4 = 3f;
				num6 = 1.5f;
				num5 = 1.4f;
				break;
			case 222:
				num4 = 3f;
				num6 = 2.4f;
				num5 = 2.1f;
				break;
			case 342:
				num4 = 3f;
				num6 = 2.4f;
				num5 = 2.1f;
				break;
			case 47:
				num4 = 4f;
				num6 = 1.2f;
				num5 = 0.9f;
				break;
			case 153:
				num4 = 4f;
				num6 = 1.5f;
				num5 = 1.3f;
				break;
			case 49:
				num4 = 4f;
				num6 = 1.1f;
				num5 = 0.85f;
				break;
			case 730:
				num4 = 8f;
				num6 = 1.5f;
				num5 = 1.2f;
				break;
			case 877:
			case 878:
			case 879:
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				num4 = 28f;
				num6 = 0.4f;
				num5 = 0.4f;
				flag2 = true;
				break;
			case 64:
			case 215:
				spriteDirection = -direction;
				num4 = 3f;
				num6 = 1.9f;
				num5 = 1.7f;
				break;
			case 66:
			case 97:
			case 212:
			case 218:
				num4 = 3f;
				num6 = 2.1f;
				num5 = 1.9f;
				break;
			case 130:
				num4 = 3f;
				num6 = 1.3f;
				num5 = 1f;
				break;
			}
			float num7 = (float)(itemAnimationMax - num) - num3;
			float num8 = (float)num - num2;
			float num9 = num4 + num5 * num7 - num6 * num8;
			position += velocity * num9;
			switch (type)
			{
			case 47:
				if (Main.player[owner].wet && Main.rand.Next(2) == 0)
				{
					int num10 = Dust.NewDust(Main.player[owner].position, Main.player[owner].width, Main.player[owner].height, 15, 0f, 0f, 100, default(Color), 0.8f);
					Main.dust[num10].velocity *= 0.1f;
				}
				break;
			case 130:
				if ((localAI[0] == 0f || localAI[0] == 4f || localAI[0] == 8f || localAI[0] == 12f || localAI[0] == 16f || localAI[0] == 20f || localAI[0] == 24f) && owner == Main.myPlayer)
				{
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, velocity.X, velocity.Y, 131, damage / 3, 0f, owner);
				}
				localAI[0] += 1f;
				break;
			case 730:
				if (localAI[0] == 0f && Main.myPlayer == owner)
				{
					localAI[0] = 1f;
					Vector2 vector = velocity * 4f;
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector.X, vector.Y, 732, (int)((double)damage * 1.5), knockBack * 0.5f, owner);
				}
				break;
			case 342:
				if (flag && localAI[0] == 0f && Main.myPlayer == owner)
				{
					localAI[0] = 1f;
					if (Collision.CanHit(player.position, player.width, player.height, position, width, height))
					{
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, velocity.X * 2.4f, velocity.Y * 2.4f, 343, damage, knockBack * 0.85f, owner);
					}
				}
				break;
			case 222:
				if (flag && localAI[0] == 0f && Main.myPlayer == owner)
				{
					localAI[0] = 1f;
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, velocity.X, velocity.Y, 228, damage, knockBack, owner);
				}
				break;
			}
			if (flag2 && player.channel && player.itemAnimation < num)
			{
				player.SetDummyItemTime(num);
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + MathF.PI / 2f + MathF.PI / 4f;
			if (spriteDirection == -1)
			{
				rotation -= MathF.PI / 2f;
			}
			AI_019_Spears_GetExtensionHitbox(out var _);
			if (type == 878 || type == 879)
			{
				float num11 = 6f;
				float num12 = 0.8f;
				float num13 = Vector2.Dot(velocity.SafeNormalize(Vector2.UnitX * player.direction), player.velocity.SafeNormalize(Vector2.UnitX * player.direction));
				float num14 = player.velocity.Length();
				if (num14 > num11 && num13 > num12)
				{
					int num15 = 8;
					if (num14 > num11 + 1f)
					{
						num15 = 5;
					}
					if (num14 > num11 + 2f)
					{
						num15 = 2;
					}
					int num16 = 14;
					int num17 = 27;
					int num18 = 4;
					if (type == 879)
					{
						num16 = 43;
						num17 = 57;
					}
					if (Main.rand.Next(num15 + 3) == 0)
					{
						Dust.NewDust(base.Center - new Vector2(num18, num18), num18 * 2, num18 * 2, num16, 0f, 0f, 150, default(Color), 1.4f);
					}
					if (Main.rand.Next(num15) == 0)
					{
						int num19 = Dust.NewDust(base.Center - new Vector2(num18, num18), num18 * 2, num18 * 2, num17, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 1.2f);
						Main.dust[num19].noGravity = true;
						Main.dust[num19].velocity *= 0.25f;
						num19 = Dust.NewDust(base.Center - new Vector2(num18, num18), num18 * 2, num18 * 2, num17, 0f, 0f, 150, default(Color), 1.4f);
						Main.dust[num19].velocity *= 0.25f;
					}
				}
			}
			if (type == 46)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust.NewDust(position, width, height, 14, 0f, 0f, 150, default(Color), 1.4f);
				}
				int num20 = Dust.NewDust(position, width, height, 27, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 1.2f);
				Main.dust[num20].noGravity = true;
				Main.dust[num20].velocity /= 2f;
				num20 = Dust.NewDust(position - velocity * 2f, width, height, 27, 0f, 0f, 150, default(Color), 1.4f);
				Main.dust[num20].velocity /= 5f;
			}
			if (type == 730)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 150, default(Color), 0.7f);
					dust.noGravity = true;
					dust.velocity *= 1.4f;
				}
				if (Main.rand.Next(5) == 0)
				{
					Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 150, default(Color), 0.5f).velocity.Y -= 0.5f;
				}
			}
			else if (type == 105)
			{
				if (Main.rand.Next(3) == 0)
				{
					int num21 = Dust.NewDust(position, width, height, 57, velocity.X * 0.2f, velocity.Y * 0.2f, 200, default(Color), 1.2f);
					Main.dust[num21].velocity += velocity * 0.3f;
					Main.dust[num21].velocity *= 0.2f;
				}
				if (Main.rand.Next(4) == 0)
				{
					int num22 = Dust.NewDust(position, width, height, 43, 0f, 0f, 254, default(Color), 0.3f);
					Main.dust[num22].velocity += velocity * 0.5f;
					Main.dust[num22].velocity *= 0.5f;
				}
			}
			else if (type == 153)
			{
				int num23 = Dust.NewDust(position - velocity * 3f, width, height, 115, velocity.X * 0.4f, velocity.Y * 0.4f, 140);
				Main.dust[num23].noGravity = true;
				Main.dust[num23].fadeIn = 1.25f;
				Main.dust[num23].velocity *= 0.25f;
			}
			if (type == 342)
			{
				Lighting.AddLight(base.Center, 0.65f, 0.9f, 1f);
				if (timeLeft % 2 == 0)
				{
					int num24 = 10;
					int num25 = Dust.NewDust(position - velocity * 3f - new Vector2(num24, num24), width + num24 * 2, height + num24 * 2, 135, velocity.X * 0.4f, velocity.Y * 0.4f, 50, default(Color), 1.2f);
					Main.dust[num25].velocity *= 0.5f;
					Main.dust[num25].velocity += velocity * 0.25f;
				}
			}
			ai[0] += 1f;
			bool flag3 = ai[0] >= (float)itemAnimationMax;
			if (flag2)
			{
				flag3 &= !player.channel;
			}
			if (flag3)
			{
				Kill();
			}
		}

		public bool AI_019_Spears_GetExtensionHitbox(out Rectangle extensionBox)
		{
			extensionBox = default(Rectangle);
			Player player = Main.player[owner];
			player.RotatedRelativePoint(player.MountedCenter);
			if (player.itemAnimation < player.itemAnimationMax / 3)
			{
				return false;
			}
			int itemAnimationMax = player.itemAnimationMax;
			int itemAnimation = player.itemAnimation;
			int num = player.itemAnimationMax / 3;
			float num2 = Utils.Remap(itemAnimation, itemAnimationMax, num, 0f, 1f);
			float num3 = 10f;
			float num4 = 30f;
			float num5 = 10f;
			float num6 = 10f;
			switch (type)
			{
			default:
				return false;
			case 105:
				num4 = 50f;
				num6 = 20f;
				break;
			case 46:
				num4 = 50f;
				num6 = 15f;
				break;
			case 153:
				num4 = 40f;
				num6 = 10f;
				break;
			}
			num4 *= 1f / player.meleeSpeed;
			float num7 = num3 + num4 * num2;
			float num8 = num5 + num6 * num2;
			float num9 = rotation - MathF.PI / 4f;
			if (direction == -1)
			{
				num9 -= MathF.PI / 2f;
			}
			Vector2 center = base.Center + num9.ToRotationVector2() * num7;
			extensionBox = Utils.CenteredRectangle(center, new Vector2(num8, num8));
			return true;
		}

		private void AI_019_Spears_Old()
		{
			Vector2 vector = Main.player[owner].RotatedRelativePoint(Main.player[owner].MountedCenter);
			direction = Main.player[owner].direction;
			Main.player[owner].heldProj = whoAmI;
			Main.player[owner].MatchItemTimeToItemAnimation();
			position.X = vector.X - (float)(width / 2);
			position.Y = vector.Y - (float)(height / 2);
			bool flag = Main.player[owner].itemAnimation < Main.player[owner].itemAnimationMax / 3;
			if (!Main.player[owner].frozen)
			{
				if (type == 46)
				{
					if (ai[0] == 0f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 1.6f;
					}
					else
					{
						ai[0] += 1.4f;
					}
				}
				else if (type == 105)
				{
					if (ai[0] == 0f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 2.4f;
					}
					else
					{
						ai[0] += 2.1f;
					}
				}
				else if (type == 367)
				{
					spriteDirection = -direction;
					if (ai[0] == 0f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 1.6f;
					}
					else
					{
						ai[0] += 1.5f;
					}
				}
				else if (type == 368)
				{
					spriteDirection = -direction;
					if (ai[0] == 0f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 1.5f;
					}
					else
					{
						ai[0] += 1.4f;
					}
				}
				else if (type == 222)
				{
					if (ai[0] == 0f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 2.4f;
						if (localAI[0] == 0f && Main.myPlayer == owner)
						{
							localAI[0] = 1f;
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X + velocity.X * ai[0], base.Center.Y + velocity.Y * ai[0], velocity.X, velocity.Y, 228, damage, knockBack, owner);
						}
					}
					else
					{
						ai[0] += 2.1f;
					}
				}
				else if (type == 342)
				{
					if (ai[0] == 0f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 2.4f;
						if (localAI[0] == 0f && Main.myPlayer == owner)
						{
							localAI[0] = 1f;
							if (Collision.CanHit(Main.player[owner].position, Main.player[owner].width, Main.player[owner].height, new Vector2(base.Center.X + velocity.X * ai[0], base.Center.Y + velocity.Y * ai[0]), width, height))
							{
								NewProjectile(GetProjectileSource_FromThis(), base.Center.X + velocity.X * ai[0], base.Center.Y + velocity.Y * ai[0], velocity.X * 2.4f, velocity.Y * 2.4f, 343, (int)((double)damage * 0.8), knockBack * 0.85f, owner);
							}
						}
					}
					else
					{
						ai[0] += 2.1f;
					}
				}
				else if (type == 47)
				{
					if (ai[0] == 0f)
					{
						ai[0] = 4f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 1.2f;
					}
					else
					{
						ai[0] += 0.9f;
					}
				}
				else if (type == 153)
				{
					spriteDirection = -direction;
					if (ai[0] == 0f)
					{
						ai[0] = 4f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 1.5f;
					}
					else
					{
						ai[0] += 1.3f;
					}
				}
				else if (type == 49)
				{
					if (ai[0] == 0f)
					{
						ai[0] = 4f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 1.1f;
					}
					else
					{
						ai[0] += 0.85f;
					}
				}
				else if (type == 730)
				{
					spriteDirection = -direction;
					if (ai[0] == 0f)
					{
						ai[0] = 8f;
						netUpdate = true;
						if (localAI[0] == 0f && Main.myPlayer == owner)
						{
							localAI[0] = 1f;
							Vector2 vector2 = velocity * 4f;
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X + velocity.X * ai[0], base.Center.Y + velocity.Y * ai[0], vector2.X, vector2.Y, 732, (int)((double)damage * 1.25), knockBack * 0.5f, owner);
						}
					}
					if (flag)
					{
						ai[0] -= 1.5f;
					}
					else
					{
						ai[0] += 1.2f;
					}
				}
				else if (type == 64 || type == 215)
				{
					spriteDirection = -direction;
					if (ai[0] == 0f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 1.9f;
					}
					else
					{
						ai[0] += 1.7f;
					}
				}
				else if (type == 66 || type == 97 || type == 212 || type == 218)
				{
					spriteDirection = -direction;
					if (ai[0] == 0f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 2.1f;
					}
					else
					{
						ai[0] += 1.9f;
					}
				}
				else if (type == 130)
				{
					spriteDirection = -direction;
					if (ai[0] == 0f)
					{
						ai[0] = 3f;
						netUpdate = true;
					}
					if (flag)
					{
						ai[0] -= 1.3f;
					}
					else
					{
						ai[0] += 1f;
					}
				}
			}
			position += velocity * ai[0];
			if (type == 130)
			{
				if (ai[1] == 0f || ai[1] == 4f || ai[1] == 8f || ai[1] == 12f || ai[1] == 16f || ai[1] == 20f || ai[1] == 24f)
				{
					NewProjectile(GetProjectileSource_FromThis(), position.X + (float)(width / 2), position.Y + (float)(height / 2), velocity.X, velocity.Y, 131, damage / 3, 0f, owner);
				}
				ai[1] += 1f;
			}
			if (Main.player[owner].itemAnimation == 0)
			{
				Kill();
			}
			rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 2.355f;
			if (spriteDirection == -1)
			{
				rotation -= 1.57f;
			}
			if (type == 46)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust.NewDust(position, width, height, 14, 0f, 0f, 150, default(Color), 1.4f);
				}
				int num = Dust.NewDust(position, width, height, 27, velocity.X * 0.2f + (float)(direction * 3), velocity.Y * 0.2f, 100, default(Color), 1.2f);
				Main.dust[num].noGravity = true;
				Main.dust[num].velocity.X /= 2f;
				Main.dust[num].velocity.Y /= 2f;
				num = Dust.NewDust(position - velocity * 2f, width, height, 27, 0f, 0f, 150, default(Color), 1.4f);
				Main.dust[num].velocity.X /= 5f;
				Main.dust[num].velocity.Y /= 5f;
			}
			if (type == 730)
			{
				if (Main.rand.Next(5) == 0)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 150, default(Color), 0.7f);
					dust.noGravity = true;
					dust.velocity *= 1.4f;
				}
				if (Main.rand.Next(5) == 0)
				{
					Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 150, default(Color), 0.5f).velocity.Y -= 0.5f;
				}
			}
			else if (type == 105)
			{
				if (Main.rand.Next(3) == 0)
				{
					int num2 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 57, velocity.X * 0.2f, velocity.Y * 0.2f, 200, default(Color), 1.2f);
					Main.dust[num2].velocity += velocity * 0.3f;
					Main.dust[num2].velocity *= 0.2f;
				}
				if (Main.rand.Next(4) == 0)
				{
					int num3 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 43, 0f, 0f, 254, default(Color), 0.3f);
					Main.dust[num3].velocity += velocity * 0.5f;
					Main.dust[num3].velocity *= 0.5f;
				}
			}
			else if (type == 153)
			{
				int num4 = Dust.NewDust(position - velocity * 3f, width, height, 115, velocity.X * 0.4f, velocity.Y * 0.4f, 140);
				Main.dust[num4].noGravity = true;
				Main.dust[num4].fadeIn = 1.25f;
				Main.dust[num4].velocity *= 0.25f;
			}
		}

		private void AI_168_FirstFractal()
		{
			float num = 60f;
			if ((localAI[0] += 1f) >= num - 1f)
			{
				Kill();
				return;
			}
			if (frameCounter == 0)
			{
				frameCounter = 1;
				frame = Main.rand.Next(15);
			}
			velocity = velocity.RotatedBy(ai[0]);
			Opacity = Utils.GetLerpValue(0f, 12f, localAI[0], clamped: true) * Utils.GetLerpValue(num, num - 12f, localAI[0], clamped: true);
			direction = ((velocity.X > 0f) ? 1 : (-1));
			spriteDirection = direction;
			rotation = MathF.PI / 4f * (float)spriteDirection + velocity.ToRotation();
			if (spriteDirection == -1)
			{
				rotation += MathF.PI;
			}
			if (localAI[0] > 7f)
			{
				int num2 = 5;
				_ = base.Center - new Vector2(num2);
				if (Main.rand.Next(15) == 0)
				{
					Dust dust = Dust.NewDustPerfect(base.Center, 278, null, 100, Color.Lerp(GetFirstFractalColor(), Color.White, Main.rand.NextFloat() * 0.3f));
					dust.scale = 0.7f;
					dust.noGravity = true;
					dust.velocity *= 0.5f;
					dust.velocity += velocity * 2f;
				}
			}
		}

		private void AI_167_SparkleGuitar()
		{
			float num = 90f;
			if ((localAI[0] += 1f) >= num - 1f)
			{
				Kill();
				return;
			}
			float num2 = localAI[0] / num;
			Vector2 center = Main.player[owner].Center;
			Vector2 vector = new Vector2(ai[0], ai[1]);
			Vector2 vector2 = -velocity;
			Vector2 value = center + vector2 * 2f;
			Vector2 value2 = vector + vector2 * (1f - num2 * 3f);
			base.Center = Vector2.CatmullRom(value, center, vector, value2, num2);
			int num3 = type;
			if (num3 == 856)
			{
				Lighting.AddLight(base.Center, Color.HotPink.ToVector3() * 0.3f);
				rotation = MathF.PI * 2f * num2 * 1f;
			}
		}

		private void AI_164_StormTigerGem()
		{
			Player player = Main.player[owner];
			if (type == 831)
			{
				if (player.dead)
				{
					player.stormTiger = false;
				}
				if (player.stormTiger)
				{
					timeLeft = 2;
				}
				if (++frameCounter >= 4)
				{
					frameCounter = 0;
					if (++frame >= 6)
					{
						frame = 0;
					}
				}
			}
			if (type == 970)
			{
				if (player.ownedProjectileCounts[type] > 1 && localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.AbigailUpgrade, base.Center);
				}
				if (player.dead)
				{
					player.abigailMinion = false;
				}
				if (player.abigailMinion)
				{
					timeLeft = 2;
				}
				if (++frameCounter >= 4)
				{
					frameCounter = 0;
					if (++frame >= 6)
					{
						frame = 0;
					}
				}
			}
			List<int> ai164_blacklistedTargets = _ai164_blacklistedTargets;
			ai164_blacklistedTargets.Clear();
			AI_GetMyGroupIndexAndFillBlackList(ai164_blacklistedTargets, out var index, out var totalIndexesInGroup);
			Vector2 vector2 = (base.Center = AI_164_GetHomeLocation(player, index, totalIndexesInGroup));
		}

		public static Vector2 AI_164_GetHomeLocation(Player master, int stackedIndex, int totalIndexes)
		{
			int num = master.bodyFrame.Height;
			if (num == 0)
			{
				num = 1;
			}
			Vector2 vector = Main.OffsetsPlayerHeadgear[master.bodyFrame.Y / num];
			vector.Y -= 2f;
			float num2 = master.miscCounterNormalized * 2f;
			int num3 = stackedIndex / 4;
			int num4 = totalIndexes / 4;
			if (totalIndexes % 4 > 0)
			{
				num4++;
			}
			int num5 = (totalIndexes - num3 * 4) % 4;
			if (num5 == 0)
			{
				num5 = 4;
			}
			if (num4 - 1 != num3)
			{
				num5 = 4;
			}
			int num6 = stackedIndex % num5;
			float num7 = (float)num6 / (float)num5;
			num2 += (float)num3 / 8f;
			if (stackedIndex >= (num4 - 1) * 4 && num3 > 0)
			{
				num2 = 0f;
				switch (num5)
				{
				case 1:
					num7 = 0f;
					break;
				case 2:
					num7 = 0.25f + (float)num6 * 0.5f;
					break;
				case 3:
					num7 = (float)(num6 - 1) / 6f;
					break;
				case 4:
					num7 = ((float)num6 - 1.5f) / 6f;
					break;
				}
			}
			Vector2 vector2 = new Vector2(0f, -8 - 12 * num3).RotatedBy((num2 + num7) * (MathF.PI * 2f));
			vector += vector2 + new Vector2(0f, master.gravDir * -40f);
			Vector2 mountedCenter = master.MountedCenter;
			_ = master.direction;
			Vector2 vec = mountedCenter + new Vector2(0f, master.gravDir * -21f) + vector;
			vec.Y += master.gfxOffY;
			return vec.Floor();
		}

		private void AI_162_TigerPounce()
		{
			if (ai[0] < 0f)
			{
				Opacity = 0f;
				ai[0] += 1f;
				return;
			}
			bool flag = false;
			flag = true;
			if (frameCounter == 0)
			{
				frameCounter = 1;
				localAI[0] = base.Center.X;
				localAI[1] = base.Center.Y;
				flag = true;
			}
			Vector2 vector = new Vector2(localAI[0], localAI[1]);
			Vector2 vector2 = vector + velocity;
			float y = Vector2.Distance(vector, vector2) * 1.5f;
			float num = 0.1f;
			Vector2 value = Vector2.Lerp(vector, vector2, 0f - num) + new Vector2(0f, y);
			Vector2 value2 = Vector2.Lerp(vector, vector2, 1f + num) + new Vector2(0f, y);
			if (Opacity < 1f)
			{
				Opacity += 0.1f;
			}
			int num2 = Math.Sign(vector2.X - vector.X);
			rotation += (float)num2 * -0.2f;
			spriteDirection = num2;
			if (ai[1] < 1f)
			{
				ai[1] = 60f;
			}
			ai[0] += 1f / ai[1];
			Vector2 vector3 = Vector2.CatmullRom(amount: Utils.Clamp(ai[0], 0f, 1f), value1: value, value2: vector, value3: vector2, value4: value2);
			if (flag)
			{
				for (float num3 = 0f; num3 < 1f; num3 += 0.5f)
				{
					if (Main.rand.Next(19) == 0)
					{
						Vector2 vector4 = base.Center + DirectionTo(vector3).SafeNormalize(Vector2.UnitY) * 100f;
						Dust dust = Dust.NewDustPerfect(base.Center + base.Size * Main.rand.NextVector2Square(0f, 1f), 278, Main.rand.NextVector2Circular(3f, 3f), 100, Color.White * 0.4f);
						dust.velocity.Y += -0.6f;
						dust.velocity += velocity * 0.1f;
						Main.rand.Next(5);
						dust.velocity = (vector4 - base.Center) * 0.05f;
						dust.fadeIn = 0f;
						dust.scale = 0.7f;
						dust.noGravity = true;
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					Dust obj = Main.dust[Dust.NewDust(position, width, height, 269)];
					obj.fadeIn = 0.7f;
					obj.scale = 0.4f;
					obj.velocity += velocity * 0.001f;
					obj.noLight = true;
				}
			}
			base.Center = vector3;
			if (ai[0] >= 1f)
			{
				Kill();
			}
		}

		private void PrepareBombToBlow()
		{
			tileCollide = false;
			ai[1] = 0f;
			alpha = 255;
			if (type == 28 || type == 37 || type == 516 || type == 519)
			{
				Resize(128, 128);
				damage = 100;
				knockBack = 8f;
			}
			else if (type == 773)
			{
				Resize(48, 96);
				damage = 100;
				knockBack = 8f;
			}
			else if (type == 29 || type == 470 || type == 637)
			{
				Resize(250, 250);
				damage = 250;
				knockBack = 10f;
			}
			else if (type == 30 || type == 397 || type == 517 || type == 588)
			{
				Resize(128, 128);
				knockBack = 8f;
			}
			else if (type == 681)
			{
				Resize(80, 80);
				knockBack = 8f;
			}
			else if (type == 779 || type == 783 || type == 862 || type == 863)
			{
				Resize(48, 48);
				knockBack = 8f;
			}
			else if (type == 133 || type == 134 || type == 135 || type == 136 || type == 137 || type == 138 || type == 338 || type == 339 || type == 930)
			{
				Resize(128, 128);
				knockBack = 8f;
			}
			else if (type == 794 || type == 797 || type == 795 || type == 798 || type == 793 || type == 796 || type == 808 || type == 808)
			{
				Resize(250, 250);
				knockBack = 12f;
			}
			else if (type == 776 || type == 780 || type == 777 || type == 781 || type == 778 || type == 782 || type == 803 || type == 804)
			{
				Resize(128, 128);
				knockBack = 12f;
			}
			else if (type == 784 || type == 785 || type == 786 || type == 805 || type == 903 || type == 787 || type == 788 || type == 789 || type == 806 || type == 904 || type == 790 || type == 791 || type == 792 || type == 807 || type == 905 || type == 799 || type == 800 || type == 801 || type == 810 || type == 906 || type == 910 || type == 911)
			{
				if (type == 903 || type == 904 || type == 905 || type == 906 || type == 910 || type == 911)
				{
					damage = 100;
				}
				Resize(48, 48);
				knockBack = 12f;
			}
			else if (type == 139 || type == 140 || type == 141 || type == 142 || type == 143 || type == 144 || type == 340 || type == 341)
			{
				Resize(200, 200);
				knockBack = 10f;
			}
		}

		private void AI_016()
		{
			if (wet && (type == 799 || type == 800 || type == 801 || type == 810 || type == 906 || type == 784 || type == 785 || type == 786 || type == 805 || type == 903 || type == 787 || type == 788 || type == 789 || type == 806 || type == 904 || type == 790 || type == 791 || type == 792 || type == 807 || type == 905))
			{
				timeLeft = 1;
			}
			if (type == 108 || type == 164 || type == 1002)
			{
				ai[0] += 1f;
				if (ai[0] > 3f)
				{
					Kill();
				}
			}
			if (type == 102)
			{
				int num = (int)(base.Center.X / 16f);
				int num2 = (int)(base.Center.Y / 16f);
				if (WorldGen.InWorld(num, num2))
				{
					Tile tile = Main.tile[num, num2];
					if (tile != null && tile.active() && (TileID.Sets.Platforms[tile.type] || tile.type == 380))
					{
						Kill();
						return;
					}
				}
			}
			if (type == 75)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(66, (int)position.X, (int)position.Y);
				}
				for (int i = 0; i < 255; i++)
				{
					if (Main.player[i].active && !Main.player[i].dead && !Main.player[i].ghost && (base.Center - Main.player[i].Center).Length() < 40f)
					{
						Kill();
						return;
					}
				}
			}
			bool flag = false;
			if (type == 37 || type == 397 || type == 470 || type == 519 || type == 773 || type == 911)
			{
				try
				{
					int num3 = (int)(position.X / 16f) - 1;
					int num4 = (int)((position.X + (float)width) / 16f) + 2;
					int num5 = (int)(position.Y / 16f) - 1;
					int num6 = (int)((position.Y + (float)height) / 16f) + 2;
					if (num3 < 0)
					{
						num3 = 0;
					}
					if (num4 > Main.maxTilesX)
					{
						num4 = Main.maxTilesX;
					}
					if (num5 < 0)
					{
						num5 = 0;
					}
					if (num6 > Main.maxTilesY)
					{
						num6 = Main.maxTilesY;
					}
					Vector2 vector = default(Vector2);
					for (int j = num3; j < num4; j++)
					{
						for (int k = num5; k < num6; k++)
						{
							if (Main.tile[j, k] == null || !Main.tile[j, k].nactive() || !Main.tileSolid[Main.tile[j, k].type] || Main.tileSolidTop[Main.tile[j, k].type])
							{
								continue;
							}
							vector.X = j * 16;
							vector.Y = k * 16;
							if (!(position.X + (float)width - 4f > vector.X) || !(position.X + 4f < vector.X + 16f) || !(position.Y + (float)height - 4f > vector.Y) || !(position.Y + 4f < vector.Y + 16f))
							{
								continue;
							}
							if (type == 911 && owner == Main.myPlayer && localAI[0] == 0f)
							{
								float num7 = 12f;
								Vector2 value = vector + new Vector2(8f, 8f);
								if (Vector2.Distance(base.Center, value) < num7)
								{
									base.Center += velocity.SafeNormalize(Vector2.Zero) * -4f;
								}
								localAI[0] = 1f;
								netUpdate = true;
							}
							velocity.X = 0f;
							velocity.Y = -0.2f;
							flag = true;
						}
					}
				}
				catch
				{
				}
			}
			if (flag && type == 911)
			{
				Point p = base.Center.ToTileCoordinates();
				if (WorldGen.SolidOrSlopedTile(Framing.GetTileSafely(p.X, p.Y)))
				{
					Vector2 v = p.ToWorldCoordinates() - base.Center;
					base.Center += v.SafeNormalize(Vector2.Zero) * -4f;
				}
			}
			if (flag && type == 773)
			{
				Player player = Main.player[owner];
				Vector2 v2 = DirectionTo(player.Center).SafeNormalize(Vector2.UnitX * player.direction);
				float num8 = rotation;
				float num9 = v2.ToRotation() + MathF.PI / 2f;
				rotation = rotation.AngleLerp(num9, 0.2f);
				rotation = rotation.AngleTowards(num9, 0.05f);
				Vector2 vector2 = (rotation - MathF.PI / 2f).ToRotationVector2();
				if (Main.rand.Next(3) == 0)
				{
					Dust dust = Dust.NewDustPerfect(base.Center + vector2 * 10f, 59, vector2 * 2f + Main.rand.NextVector2Circular(0.25f, 0.25f), 0, default(Color), 2f);
					dust.noGravity = true;
					if (Main.rand.Next(3) == 0)
					{
						dust.velocity *= 1.5f;
						dust.noGravity = false;
						dust.scale /= 2f;
					}
				}
				if (Main.rand.Next(3) == 0)
				{
					Point scarabBombDigDirectionSnap = GetScarabBombDigDirectionSnap8();
					Dust.NewDustPerfect(base.Center + vector2 * -10f, 59, scarabBombDigDirectionSnap.ToVector2() * 1.5f, 0, default(Color), 2f).noGravity = true;
				}
				if (Main.rand.Next(15) == 0)
				{
					Dust dust2 = Dust.NewDustPerfect(base.Center + vector2 * 10f, 88, vector2 * 3f + Main.rand.NextVector2Circular(0.25f, 0.25f), 0, default(Color), 2f);
					dust2.noGravity = true;
					if (Main.rand.Next(3) == 0)
					{
						dust2.velocity *= 1.5f;
					}
				}
				bool flag2 = Main.rand.Next(30) == 0;
				if (num8 != rotation && Main.rand.Next(40) == 0)
				{
					flag2 = true;
				}
				if (flag2)
				{
					float num10 = MathF.PI * 2f * Main.rand.NextFloat();
					for (float num11 = 0f; num11 < 1f; num11 += 1f / 7f)
					{
						Vector2 spinningpoint = (num11 * (MathF.PI * 2f) + num10).ToRotationVector2();
						spinningpoint *= new Vector2(1f, 0.3f);
						spinningpoint = spinningpoint.RotatedBy(num9);
						Dust dust3 = Dust.NewDustPerfect(base.Center + spinningpoint + vector2 * 8f, 59, vector2 * 3f + spinningpoint);
						dust3.noGravity = true;
						dust3.fadeIn = 1.6f;
					}
				}
				if (++frameCounter >= 3)
				{
					frameCounter = 0;
					if (++frame >= 4)
					{
						frame = 0;
					}
				}
			}
			if (type == 519)
			{
				localAI[1] += 1f;
				float num12 = 180f - localAI[1];
				if (num12 < 0f)
				{
					num12 = 0f;
				}
				frameCounter++;
				if (num12 < 15f)
				{
					frameCounter++;
				}
				if ((float)frameCounter >= (num12 / 10f + 6f) / 2f)
				{
					frame++;
					frameCounter = 0;
					if (frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
			}
			if (type == 681 && localAI[1] == 0f)
			{
				localAI[1] = 1f;
			}
			int num13 = 6;
			if (type == 776 || type == 780 || type == 803 || type == 804)
			{
				num13 = 228;
			}
			else if (type == 784 || type == 805)
			{
				num13 = ((Main.rand.Next(3) == 0) ? 6 : Dust.dustWater());
			}
			else if (type == 787 || type == 806)
			{
				num13 = ((Main.rand.Next(3) == 0) ? 6 : 35);
			}
			else if (type == 790 || type == 807)
			{
				num13 = ((Main.rand.Next(3) == 0) ? 6 : 152);
			}
			if (type == 102)
			{
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item10, position);
				}
				frameCounter++;
				if (frameCounter > 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 1)
				{
					frame = 0;
				}
				if (velocity.Y == 0f)
				{
					position.X += width / 2;
					position.Y += height / 2;
					width = 128;
					height = 128;
					position.X -= width / 2;
					position.Y -= height / 2;
					damage = 40;
					knockBack = 8f;
					timeLeft = 3;
					netUpdate = true;
				}
			}
			if (type == 303 && timeLeft <= 3 && hostile)
			{
				position.X += width / 2;
				position.Y += height / 2;
				width = 128;
				height = 128;
				position.X -= width / 2;
				position.Y -= height / 2;
			}
			if (owner == Main.myPlayer && timeLeft <= 3)
			{
				PrepareBombToBlow();
			}
			else
			{
				if (type != 30 && type != 75 && type != 517 && type != 681 && type != 588 && type != 397 && type != 108 && type != 1002 && type != 133 && type != 134 && type != 135 && type != 136 && type != 137 && type != 138 && type != 139 && type != 140 && type != 141 && type != 142 && type != 143 && type != 144 && type != 164 && type != 303 && type != 338 && type != 339 && type != 340 && type != 341 && (type < 776 || type > 801) && (type < 803 || type > 810) && type != 862 && type != 863 && type != 930)
				{
					damage = 0;
				}
				if (type == 338 || type == 339 || type == 340 || type == 341 || type == 803 || type == 804 || type == 808 || type == 809 || type == 810 || type == 805 || type == 806 || type == 807 || type == 930)
				{
					localAI[1] += 1f;
					if (localAI[1] > 6f)
					{
						alpha = 0;
					}
					else
					{
						alpha = (int)(255f - 42f * localAI[1]) + 100;
						if (alpha > 255)
						{
							alpha = 255;
						}
					}
					for (int l = 0; l < 2; l++)
					{
						float num14 = 0f;
						float num15 = 0f;
						if (l == 1)
						{
							num14 = velocity.X * 0.5f;
							num15 = velocity.Y * 0.5f;
						}
						if (!(localAI[1] > 9f))
						{
							continue;
						}
						if (Main.rand.Next(2) == 0)
						{
							int num16 = Dust.NewDust(new Vector2(position.X + 3f + num14, position.Y + 3f + num15) - velocity * 0.5f, width - 8, height - 8, num13, 0f, 0f, 100);
							Main.dust[num16].scale *= 1.4f + (float)Main.rand.Next(10) * 0.1f;
							Main.dust[num16].velocity *= 0.2f;
							Main.dust[num16].noGravity = true;
							if (Main.dust[num16].type == 152)
							{
								Main.dust[num16].scale *= 0.5f;
								Main.dust[num16].velocity += velocity * 0.1f;
							}
							else if (Main.dust[num16].type == 35)
							{
								Main.dust[num16].scale *= 0.5f;
								Main.dust[num16].velocity += velocity * 0.1f;
							}
							else if (Main.dust[num16].type == Dust.dustWater())
							{
								Main.dust[num16].scale *= 0.65f;
								Main.dust[num16].velocity += velocity * 0.1f;
							}
							if (type == 808 || type == 809)
							{
								Dust dust4 = Main.dust[num16];
								if (dust4.dustIndex != 6000)
								{
									dust4 = Dust.NewDustPerfect(dust4.position, dust4.type, dust4.velocity, dust4.alpha, dust4.color, dust4.scale + 0.5f);
									dust4.velocity = Main.rand.NextVector2Circular(3f, 3f);
									dust4.noGravity = true;
								}
								if (dust4.dustIndex != 6000)
								{
									dust4 = Dust.NewDustPerfect(dust4.position, dust4.type, dust4.velocity, dust4.alpha, dust4.color, dust4.scale + 0.5f);
									dust4.velocity = (MathF.PI * 2f * ((float)timeLeft / 20f)).ToRotationVector2() * 3f;
									dust4.noGravity = true;
								}
							}
						}
						if (Main.rand.Next(2) == 0)
						{
							int num17 = Dust.NewDust(new Vector2(position.X + 3f + num14, position.Y + 3f + num15) - velocity * 0.5f, width - 8, height - 8, 31, 0f, 0f, 100, default(Color), 0.5f);
							Main.dust[num17].fadeIn = 0.5f + (float)Main.rand.Next(5) * 0.1f;
							Main.dust[num17].velocity *= 0.05f;
						}
					}
					float x = position.X;
					float y = position.Y;
					float num18 = 600f;
					if (type == 930)
					{
						num18 = 650f;
					}
					bool flag3 = false;
					ai[0] += 1f;
					if (ai[0] > 30f)
					{
						ai[0] = 30f;
						for (int m = 0; m < 200; m++)
						{
							if (Main.npc[m].CanBeChasedBy(this))
							{
								float num19 = Main.npc[m].position.X + (float)(Main.npc[m].width / 2);
								float num20 = Main.npc[m].position.Y + (float)(Main.npc[m].height / 2);
								float num21 = Math.Abs(position.X + (float)(width / 2) - num19) + Math.Abs(position.Y + (float)(height / 2) - num20);
								if (num21 < num18 && Collision.CanHit(position, width, height, Main.npc[m].position, Main.npc[m].width, Main.npc[m].height))
								{
									num18 = num21;
									x = num19;
									y = num20;
									flag3 = true;
								}
							}
						}
					}
					if (!flag3)
					{
						x = position.X + (float)(width / 2) + velocity.X * 100f;
						y = position.Y + (float)(height / 2) + velocity.Y * 100f;
					}
					float num22 = 16f;
					if (type == 930)
					{
						num22 = 12f;
					}
					Vector2 value2 = (new Vector2(x, y) - base.Center).SafeNormalize(-Vector2.UnitY) * num22;
					velocity = Vector2.Lerp(velocity, value2, 1f / 12f);
				}
				else if (type == 134 || type == 137 || type == 140 || type == 143 || type == 303 || type == 776 || type == 780 || type == 793 || type == 796 || type == 799 || type == 784 || type == 787 || type == 790)
				{
					if (Math.Abs(velocity.X) >= 8f || Math.Abs(velocity.Y) >= 8f)
					{
						for (int n = 0; n < 2; n++)
						{
							float num23 = 0f;
							float num24 = 0f;
							if (n == 1)
							{
								num23 = velocity.X * 0.5f;
								num24 = velocity.Y * 0.5f;
							}
							int num25 = Dust.NewDust(new Vector2(position.X + 3f + num23, position.Y + 3f + num24) - velocity * 0.5f, width - 8, height - 8, num13, 0f, 0f, 100);
							Main.dust[num25].scale *= 2f + (float)Main.rand.Next(10) * 0.1f;
							Main.dust[num25].velocity *= 0.2f;
							Main.dust[num25].noGravity = true;
							if (Main.dust[num25].type == 152)
							{
								Main.dust[num25].scale *= 0.5f;
								Main.dust[num25].velocity += velocity * 0.1f;
							}
							else if (Main.dust[num25].type == 35)
							{
								Main.dust[num25].scale *= 0.5f;
								Main.dust[num25].velocity += velocity * 0.1f;
							}
							else if (Main.dust[num25].type == Dust.dustWater())
							{
								Main.dust[num25].scale *= 0.65f;
								Main.dust[num25].velocity += velocity * 0.1f;
							}
							if (type == 793 || type == 796)
							{
								Dust dust5 = Main.dust[num25];
								if (dust5.dustIndex != 6000)
								{
									dust5 = Dust.NewDustPerfect(dust5.position, dust5.type, dust5.velocity, dust5.alpha, dust5.color, dust5.scale);
									dust5.velocity = Main.rand.NextVector2Circular(3f, 3f);
									dust5.noGravity = true;
								}
								if (dust5.dustIndex != 6000)
								{
									dust5 = Dust.NewDustPerfect(dust5.position, dust5.type, dust5.velocity, dust5.alpha, dust5.color, dust5.scale);
									dust5.velocity = (MathF.PI * 2f * ((float)timeLeft / 20f)).ToRotationVector2() * 3f;
									dust5.noGravity = true;
								}
							}
							num25 = Dust.NewDust(new Vector2(position.X + 3f + num23, position.Y + 3f + num24) - velocity * 0.5f, width - 8, height - 8, 31, 0f, 0f, 100, default(Color), 0.5f);
							Main.dust[num25].fadeIn = 1f + (float)Main.rand.Next(5) * 0.1f;
							Main.dust[num25].velocity *= 0.05f;
						}
					}
					if (Math.Abs(velocity.X) < 15f && Math.Abs(velocity.Y) < 15f)
					{
						velocity *= 1.1f;
					}
				}
				else if (type == 133 || type == 136 || type == 139 || type == 142 || type == 777 || type == 781 || type == 794 || type == 797 || type == 800 || type == 785 || type == 788 || type == 791)
				{
					int num26 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100);
					Main.dust[num26].scale *= 1f + (float)Main.rand.Next(10) * 0.1f;
					Main.dust[num26].velocity *= 0.2f;
					Main.dust[num26].noGravity = true;
				}
				else if (type == 135 || type == 138 || type == 141 || type == 144 || type == 778 || type == 782 || type == 795 || type == 798 || type == 801 || type == 786 || type == 789 || type == 792)
				{
					if ((double)velocity.X > -0.2 && (double)velocity.X < 0.2 && (double)velocity.Y > -0.2 && (double)velocity.Y < 0.2)
					{
						alpha += 2;
						if (alpha > 200)
						{
							alpha = 200;
						}
					}
					else
					{
						alpha = 0;
						int num27 = Dust.NewDust(new Vector2(position.X + 3f, position.Y + 3f) - velocity * 0.5f, width - 8, height - 8, 31, 0f, 0f, 100);
						Main.dust[num27].scale *= 1.6f + (float)Main.rand.Next(5) * 0.1f;
						Main.dust[num27].velocity *= 0.05f;
						Main.dust[num27].noGravity = true;
					}
				}
				else if (type == 779 || type == 783 || type == 862 || type == 863)
				{
					if (Main.rand.Next(25) == 0)
					{
						Dust dust6 = Dust.NewDustDirect(position, width, height, 228, (0f - velocity.X) / 10f, (0f - velocity.Y) / 10f, 100);
						dust6.noGravity = true;
						dust6.velocity *= 0f;
						dust6.scale = 1.3f;
					}
					if (Main.rand.Next(5) == 0)
					{
						Dust dust7 = Dust.NewDustDirect(position, width, height, 31, (0f - velocity.X) / 10f, (0f - velocity.Y) / 10f, 100);
						dust7.noGravity = true;
						dust7.velocity *= 0f;
						dust7.scale = 1.3f;
					}
					if (frameCounter == 0)
					{
						frameCounter = 1;
						frame = Main.rand.Next(4);
					}
				}
				else if (type != 30 && type != 517 && type != 681 && type != 397 && type != 519 && type != 588 && type != 779 && type != 783 && type != 862 && type != 863 && Main.rand.Next(2) == 0)
				{
					int num28 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100);
					Main.dust[num28].scale = 0.1f + (float)Main.rand.Next(5) * 0.1f;
					Main.dust[num28].fadeIn = 1.5f + (float)Main.rand.Next(5) * 0.1f;
					Main.dust[num28].noGravity = true;
					Main.dust[num28].position = base.Center + new Vector2(0f, -height / 2).RotatedBy(rotation) * 1.1f;
					int num29 = 6;
					if (type == 773)
					{
						num29 = 59;
					}
					if (type == 903)
					{
						num29 = Dust.dustWater();
					}
					if (type == 904)
					{
						num29 = 35;
					}
					if (type == 905)
					{
						num29 = 152;
					}
					if (type == 910 || type == 911)
					{
						num29 = 0;
					}
					Dust dust8 = Dust.NewDustDirect(position, width, height, num29, 0f, 0f, 100);
					dust8.scale = 1f + (float)Main.rand.Next(5) * 0.1f;
					dust8.noGravity = true;
					dust8.position = base.Center + new Vector2(0f, -height / 2 - 6).RotatedBy(rotation) * 1.1f;
				}
				else if (type == 681)
				{
					Dust dust9 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100);
					dust9.scale = 1f + (float)Main.rand.Next(5) * 0.1f;
					dust9.noGravity = true;
					dust9.position = base.Center + new Vector2(6 * Math.Sign(velocity.X), -height / 2 - 6).RotatedBy(rotation) * 1.1f;
				}
			}
			ai[0] += 1f;
			if (type == 338 || type == 339 || type == 340 || type == 341 || type == 803 || type == 804 || type == 808 || type == 809 || type == 810 || type == 805 || type == 806 || type == 807 || type == 930)
			{
				if (velocity.X < 0f)
				{
					spriteDirection = -1;
					rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X) - 1.57f;
				}
				else
				{
					spriteDirection = 1;
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			else if (type == 134 || type == 137 || type == 140 || type == 143 || type == 303 || type == 776 || type == 780 || type == 793 || type == 796 || type == 799 || type == 784 || type == 787 || type == 790)
			{
				if (velocity != Vector2.Zero)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			else if (type == 135 || type == 138 || type == 141 || type == 144 || type == 778 || type == 782 || type == 795 || type == 798 || type == 801 || type == 786 || type == 789 || type == 792)
			{
				velocity.Y += 0.2f;
				velocity *= 0.97f;
				if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
				{
					velocity.X = 0f;
				}
				if ((double)velocity.Y > -0.1 && (double)velocity.Y < 0.1)
				{
					velocity.Y = 0f;
				}
			}
			else if (type == 133 || type == 136 || type == 139 || type == 142 || type == 777 || type == 781 || type == 794 || type == 797 || type == 800 || type == 785 || type == 788 || type == 791)
			{
				if (ai[0] > 15f)
				{
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.95f;
					}
					velocity.Y += 0.2f;
				}
			}
			else if (((type == 30 || type == 397 || type == 517 || type == 681 || type == 588 || type == 779 || type == 783 || type == 862 || type == 863) && ai[0] > 10f) || (type != 30 && type != 397 && type != 517 && type != 588 && type != 779 && type != 783 && type != 862 && type != 863 && ai[0] > 5f))
			{
				ai[0] = 10f;
				if (velocity.Y == 0f && velocity.X != 0f)
				{
					velocity.X *= 0.97f;
					if (type == 29 || type == 470 || type == 637)
					{
						velocity.X *= 0.99f;
					}
					if ((double)velocity.X > -0.01 && (double)velocity.X < 0.01)
					{
						velocity.X = 0f;
						netUpdate = true;
					}
				}
				velocity.Y += 0.2f;
				if (type == 911)
				{
					velocity.X = MathHelper.Clamp(velocity.X, -8f, 8f);
					velocity.Y = MathHelper.Clamp(velocity.Y, -8f, 8f);
				}
			}
			if (type == 519)
			{
				rotation += velocity.X * 0.06f;
			}
			else if (type != 134 && type != 137 && type != 140 && type != 143 && type != 303 && (type < 338 || type > 341) && type != 776 && type != 780 && type != 793 && type != 796 && type != 799 && type != 784 && type != 787 && type != 790 && type != 803 && type != 804 && type != 808 && type != 809 && type != 810 && type != 805 && type != 806 && type != 807 && type != 930)
			{
				rotation += velocity.X * 0.1f;
			}
		}

		private void AI_166_Dove()
		{
			bool num = type == 855;
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				frame = Main.rand.Next(4);
			}
			int num2 = 4;
			if (num)
			{
				num2 = 6;
			}
			if (++frameCounter > num2)
			{
				frameCounter = 0;
				if (++frame > 3)
				{
					frame = 0;
				}
			}
			spriteDirection = -1;
			if (velocity.X > 0f)
			{
				spriteDirection = 1;
			}
			if (num)
			{
				float num3 = 1f - (float)alpha / 255f;
				Vector3 rgb = new Vector3(1f, 0.6f, 0.1f) * num3;
				Lighting.AddLight(base.Center, rgb);
				rotation = velocity.X * 0.2f;
				if (velocity.Y < -1f)
				{
					velocity.Y *= 0.99f;
				}
				else
				{
					velocity.Y += (float)Math.Sin((float)(timeLeft % 200) / 200f * (MathF.PI * 2f)) * 0.25f;
					if (velocity.Y > 0.5f)
					{
						velocity.Y *= 0.8f;
					}
					velocity.Y = MathHelper.Clamp(velocity.Y, -1.5f, 1.5f);
				}
				float num4 = Main.WindForVisuals;
				if (num4 == 0f)
				{
					num4 = 0.1f;
				}
				velocity.X += 0.0525f * num4;
				velocity.X = MathHelper.Clamp(velocity.X, -2f, 2f);
			}
			else
			{
				rotation = velocity.X * 0.15f;
				velocity.Y -= 0.025f;
				if (velocity.Y < -3f)
				{
					velocity.Y = -3f;
				}
				velocity.X = MathHelper.Clamp(velocity.X, -5f, 5f);
			}
			if (timeLeft < 90)
			{
				alpha += 3;
			}
			if (alpha >= 255)
			{
				Kill();
			}
		}

		private void AI_161_RapierStabs()
		{
			Player player = Main.player[owner];
			rotation = velocity.ToRotation() + MathF.PI / 2f;
			ai[0] += 1f;
			float num2 = (Opacity = Utils.GetLerpValue(0f, 7f, ai[0], clamped: true) * Utils.GetLerpValue(16f, 12f, ai[0], clamped: true));
			base.Center = player.RotatedRelativePoint(player.MountedCenter, reverseRotation: false, addGfxOffY: false) + velocity * (ai[0] - 1f);
			spriteDirection = ((!(Vector2.Dot(velocity, Vector2.UnitX) < 0f)) ? 1 : (-1));
			if (ai[0] >= 16f)
			{
				Kill();
			}
			else
			{
				player.heldProj = whoAmI;
			}
		}

		private void AI_165_Whip()
		{
			Player player = Main.player[owner];
			rotation = velocity.ToRotation() + MathF.PI / 2f;
			ai[0] += 1f;
			GetWhipSettings(this, out var timeToFlyOut, out var _, out var _);
			base.Center = Main.GetPlayerArmPosition(this) + velocity * (ai[0] - 1f);
			spriteDirection = ((!(Vector2.Dot(velocity, Vector2.UnitX) < 0f)) ? 1 : (-1));
			if (ai[0] >= timeToFlyOut)
			{
				Kill();
				return;
			}
			player.heldProj = whoAmI;
			player.MatchItemTimeToItemAnimation();
			if (ai[0] == (float)(int)(timeToFlyOut / 2f))
			{
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Vector2 vector = WhipPointsForCollision[WhipPointsForCollision.Count - 1];
				SoundEngine.PlaySound(SoundID.Item153, vector);
			}
			switch (type)
			{
			case 848:
			{
				float t3 = ai[0] / timeToFlyOut;
				float num5 = Utils.GetLerpValue(0.1f, 0.7f, t3, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t3, clamped: true);
				if (num5 > 0.1f && Main.rand.NextFloat() < num5 / 2f)
				{
					WhipPointsForCollision.Clear();
					FillWhipControlPoints(this, WhipPointsForCollision);
					Rectangle r4 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
					int num6 = Dust.NewDust(r4.TopLeft(), r4.Width, r4.Height, 172, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num6].noGravity = true;
					Main.dust[num6].velocity.X /= 2f;
					Main.dust[num6].velocity.Y /= 2f;
				}
				break;
			}
			case 847:
			{
				float t2 = ai[0] / timeToFlyOut;
				if (Utils.GetLerpValue(0.1f, 0.7f, t2, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t2, clamped: true) > 0.5f && Main.rand.Next(3) != 0)
				{
					WhipPointsForCollision.Clear();
					FillWhipControlPoints(this, WhipPointsForCollision);
					int num2 = Main.rand.Next(WhipPointsForCollision.Count - 10, WhipPointsForCollision.Count);
					Rectangle r2 = Utils.CenteredRectangle(WhipPointsForCollision[num2], new Vector2(30f, 30f));
					int num3 = 57;
					if (Main.rand.Next(3) == 0)
					{
						num3 = 43;
					}
					Dust dust3 = Dust.NewDustDirect(r2.TopLeft(), r2.Width, r2.Height, num3, 0f, 0f, 100, Color.White);
					dust3.position = WhipPointsForCollision[num2];
					dust3.fadeIn = 0.3f;
					Vector2 spinningpoint = WhipPointsForCollision[num2] - WhipPointsForCollision[num2 - 1];
					dust3.noGravity = true;
					dust3.velocity *= 0.5f;
					dust3.velocity += spinningpoint.RotatedBy((float)player.direction * (MathF.PI / 2f));
					dust3.velocity *= 0.5f;
				}
				break;
			}
			case 849:
			{
				float num4 = ai[0] / timeToFlyOut;
				Utils.GetLerpValue(0.1f, 0.7f, num4, clamped: true);
				Utils.GetLerpValue(0.9f, 0.7f, num4, clamped: true);
				if (num4 > 0.4f && Main.rand.Next(9) != 0)
				{
					WhipPointsForCollision.Clear();
					FillWhipControlPoints(this, WhipPointsForCollision);
					Rectangle r3 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
					Vector2 vector3 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
					Dust dust4 = Dust.NewDustDirect(r3.TopLeft(), r3.Width, r3.Height, 191, 0f, 0f, 0, default(Color), 1.3f);
					dust4.noGravity = true;
					dust4.velocity += vector3 * 2f;
					if (Main.rand.Next(2) == 0)
					{
						ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.BlackLightningSmall, new ParticleOrchestraSettings
						{
							MovementVector = vector3,
							PositionInWorld = r3.Center.ToVector2()
						}, owner);
					}
					Lighting.AddLight(r3.Center.ToVector2(), new Vector3(0.2f, 0f, 0.4f));
				}
				break;
			}
			case 915:
			{
				float t5 = ai[0] / timeToFlyOut;
				if (Utils.GetLerpValue(0.1f, 0.7f, t5, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t5, clamped: true) > 0.1f)
				{
					WhipPointsForCollision.Clear();
					FillWhipControlPoints(this, WhipPointsForCollision);
					Rectangle r6 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
					Vector2 vector5 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
					Dust dust7 = Dust.NewDustDirect(r6.TopLeft(), r6.Width, r6.Height, 267, 0f, 0f, 0, Main.hslToRgb(player.miscCounterNormalized * 9f % 1f, 1f, 0.5f), 1.3f);
					dust7.velocity *= Main.rand.NextFloat() * 0.8f;
					dust7.noGravity = true;
					dust7.scale = 0.9f + Main.rand.NextFloat() * 0.9f;
					dust7.fadeIn = Main.rand.NextFloat() * 0.9f;
					dust7.velocity += vector5 * 2f;
					if (dust7.dustIndex != 6000)
					{
						Dust dust8 = Dust.CloneDust(dust7);
						dust8.scale /= 2f;
						dust8.fadeIn *= 0.85f;
						dust8.color = new Color(255, 255, 255, 255);
					}
				}
				break;
			}
			case 914:
			{
				float t6 = ai[0] / timeToFlyOut;
				float num8 = Utils.GetLerpValue(0.1f, 0.7f, t6, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t6, clamped: true);
				if (num8 > 0.1f && Main.rand.NextFloat() < num8 / 2f)
				{
					WhipPointsForCollision.Clear();
					FillWhipControlPoints(this, WhipPointsForCollision);
					Rectangle r7 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
					Vector2 vector6 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
					Dust dust9 = Dust.NewDustDirect(r7.TopLeft(), r7.Width, r7.Height, 39, 0f, 0f, 0, default(Color), 1.2f);
					dust9.noGravity = Main.rand.Next(3) == 0;
					dust9.velocity += vector6 * 2f;
				}
				break;
			}
			case 952:
			{
				float t7 = ai[0] / timeToFlyOut;
				float num9 = Utils.GetLerpValue(0.1f, 0.7f, t7, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t7, clamped: true);
				if (num9 > 0.15f && Main.rand.NextFloat() < num9)
				{
					WhipPointsForCollision.Clear();
					FillWhipControlPoints(this, WhipPointsForCollision);
					Rectangle r8 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
					Vector2 vector7 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
					Dust dust10 = Dust.NewDustDirect(r8.TopLeft(), r8.Width, r8.Height, 26, 0f, 0f, 0, default(Color), 0.7f);
					dust10.noGravity = Main.rand.Next(3) == 0;
					if (dust10.noGravity)
					{
						dust10.scale += 0.4f;
					}
					dust10.velocity += vector7 * 2f;
				}
				break;
			}
			case 912:
			{
				float t4 = ai[0] / timeToFlyOut;
				float num7 = Utils.GetLerpValue(0.1f, 0.7f, t4, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t4, clamped: true);
				if (!(num7 > 0.1f) || !(Main.rand.NextFloat() < num7 / 2f))
				{
					break;
				}
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Rectangle r5 = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(30f, 30f));
				Vector2 vector4 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
				for (int j = 0; j < 3; j++)
				{
					Dust dust5 = Dust.NewDustDirect(r5.TopLeft(), r5.Width, r5.Height, 16, 0f, 0f, 0, default(Color), 1.2f);
					dust5.noGravity = true;
					dust5.velocity += vector4 * 2f;
				}
				for (int k = 0; k < 1; k++)
				{
					Dust.NewDustDirect(r5.TopLeft(), r5.Width, r5.Height, 13, 0f, 0f, 0, default(Color), 0.8f).velocity += vector4 * 2f;
				}
				for (int l = 0; l < 3; l++)
				{
					if (Main.rand.Next(2) != 0)
					{
						Dust dust6 = Dust.NewDustDirect(r5.TopLeft(), r5.Width, r5.Height, 261, 0f, 0f, 0, Color.Transparent, 0.8f);
						dust6.velocity += vector4 * 2f;
						dust6.velocity *= 0.3f;
						dust6.noGravity = true;
					}
				}
				Lighting.AddLight(r5.Center.ToVector2(), new Vector3(0.1f, 0.1f, 0.2f));
				break;
			}
			case 913:
			{
				float t = ai[0] / timeToFlyOut;
				float num = Utils.GetLerpValue(0.1f, 0.7f, t, clamped: true) * Utils.GetLerpValue(0.9f, 0.7f, t, clamped: true);
				if (!(num > 0.1f) || !(Main.rand.NextFloat() < num))
				{
					break;
				}
				WhipPointsForCollision.Clear();
				FillWhipControlPoints(this, WhipPointsForCollision);
				Rectangle r = Utils.CenteredRectangle(WhipPointsForCollision[WhipPointsForCollision.Count - 1], new Vector2(20f, 20f));
				Vector2 vector2 = WhipPointsForCollision[WhipPointsForCollision.Count - 2].DirectionTo(WhipPointsForCollision[WhipPointsForCollision.Count - 1]).SafeNormalize(Vector2.Zero);
				for (int i = 0; i < 3; i++)
				{
					if (Main.rand.Next(3) != 0)
					{
						continue;
					}
					if (Main.rand.Next(7) == 0)
					{
						Dust dust = Dust.NewDustDirect(r.TopLeft(), r.Width, r.Height, 31);
						dust.velocity.X /= 2f;
						dust.velocity.Y /= 2f;
						dust.velocity += vector2 * 2f;
						dust.fadeIn = 1f + Main.rand.NextFloat() * 0.6f;
						dust.noGravity = true;
						continue;
					}
					Dust dust2 = Dust.NewDustDirect(r.TopLeft(), r.Width, r.Height, 6, 0f, 0f, 0, default(Color), 1.2f);
					dust2.velocity += vector2 * 2f;
					if (Main.rand.Next(3) != 0)
					{
						dust2.fadeIn = 0.7f + Main.rand.NextFloat() * 0.9f;
						dust2.scale = 0.6f;
						dust2.noGravity = true;
					}
				}
				break;
			}
			}
		}

		public static void FillWhipControlPoints(Projectile proj, List<Vector2> controlPoints)
		{
			GetWhipSettings(proj, out var timeToFlyOut, out var segments, out var rangeMultiplier);
			float num = proj.ai[0] / timeToFlyOut;
			float num2 = 0.5f;
			float num3 = 1f + num2;
			float num4 = MathF.PI * 10f * (1f - num * num3) * (float)(-proj.spriteDirection) / (float)segments;
			float num5 = num * num3;
			float num6 = 0f;
			if (num5 > 1f)
			{
				num6 = (num5 - 1f) / num2;
				num5 = MathHelper.Lerp(1f, 0f, num6);
			}
			float num7 = proj.ai[0] - 1f;
			Player player = Main.player[proj.owner];
			Item heldItem = Main.player[proj.owner].HeldItem;
			num7 = (float)(ContentSamples.ItemsByType[heldItem.type].useAnimation * 2) * num * player.whipRangeMultiplier;
			float num8 = proj.velocity.Length() * num7 * num5 * rangeMultiplier / (float)segments;
			float num9 = 1f;
			Vector2 playerArmPosition = Main.GetPlayerArmPosition(proj);
			Vector2 vector = playerArmPosition;
			float num10 = 0f - MathF.PI / 2f;
			Vector2 vector2 = vector;
			float num11 = 0f + MathF.PI / 2f + MathF.PI / 2f * (float)proj.spriteDirection;
			Vector2 vector3 = vector;
			float num12 = 0f + MathF.PI / 2f;
			controlPoints.Add(playerArmPosition);
			for (int i = 0; i < segments; i++)
			{
				float num13 = (float)i / (float)segments;
				float num14 = num4 * num13 * num9;
				Vector2 vector4 = vector + num10.ToRotationVector2() * num8;
				Vector2 vector5 = vector3 + num12.ToRotationVector2() * (num8 * 2f);
				Vector2 vector6 = vector2 + num11.ToRotationVector2() * (num8 * 2f);
				float num15 = 1f - num5;
				float num16 = 1f - num15 * num15;
				Vector2 value = Vector2.Lerp(vector5, vector4, num16 * 0.9f + 0.1f);
				Vector2 vector7 = Vector2.Lerp(vector6, value, num16 * 0.7f + 0.3f);
				Vector2 spinningpoint = playerArmPosition + (vector7 - playerArmPosition) * new Vector2(1f, num3);
				float num17 = num6;
				num17 *= num17;
				Vector2 item = spinningpoint.RotatedBy(proj.rotation + 4.712389f * num17 * (float)proj.spriteDirection, playerArmPosition);
				controlPoints.Add(item);
				num10 += num14;
				num12 += num14;
				num11 += num14;
				vector = vector4;
				vector3 = vector5;
				vector2 = vector6;
			}
		}

		public static void GetWhipSettings(Projectile proj, out float timeToFlyOut, out int segments, out float rangeMultiplier)
		{
			timeToFlyOut = Main.player[proj.owner].itemAnimationMax * proj.MaxUpdates;
			segments = 20;
			rangeMultiplier = 1f;
			switch (proj.type)
			{
			case 913:
				rangeMultiplier *= 1.4f;
				break;
			case 912:
				rangeMultiplier *= 1.5f;
				break;
			case 841:
				rangeMultiplier *= 0.75f;
				break;
			case 914:
				rangeMultiplier *= 1f;
				break;
			case 847:
				segments = 20;
				rangeMultiplier *= 1.75f;
				break;
			case 849:
				segments = 30;
				rangeMultiplier = 2.15f;
				break;
			case 915:
				segments = 40;
				rangeMultiplier = 2.2f;
				break;
			case 848:
				segments = 40;
				rangeMultiplier = 1.6f;
				break;
			case 952:
				rangeMultiplier *= 0.95f;
				break;
			}
		}

		private void AI_160_Kites()
		{
			Player player = Main.player[owner];
			Vector2 vector = player.RotatedRelativePoint(player.MountedCenter);
			timeLeft = 60;
			bool flag = false;
			if (player.CCed || player.noItems)
			{
				flag = true;
			}
			else if (player.inventory[player.selectedItem].shoot != type)
			{
				flag = true;
			}
			else if (player.pulley)
			{
				flag = true;
			}
			else if (player.dead)
			{
				flag = true;
			}
			if (!flag)
			{
				flag = (player.Center - base.Center).Length() > 2000f;
			}
			if (flag)
			{
				Kill();
				return;
			}
			float num = 4f;
			float num2 = 500f;
			float num3 = num2 / 2f;
			if (owner == Main.myPlayer && extraUpdates == 0)
			{
				float num4 = ai[0];
				if (ai[0] == 0f)
				{
					ai[0] = num3;
				}
				float num5 = ai[0];
				if (Main.mouseRight)
				{
					num5 -= 5f;
				}
				if (Main.mouseLeft)
				{
					num5 += 5f;
				}
				ai[0] = MathHelper.Clamp(num5, num, num2);
				if (num4 != num5)
				{
					netUpdate = true;
				}
			}
			if (numUpdates == 1)
			{
				extraUpdates = 0;
			}
			int num6 = 0;
			float cloudAlpha = Main.cloudAlpha;
			float num7 = 0f;
			if (WorldGen.InAPlaceWithWind(position, width, height))
			{
				num7 = Main.WindForVisuals;
			}
			float num8 = Utils.GetLerpValue(0.2f, 0.5f, Math.Abs(num7), clamped: true) * 0.5f;
			switch (num6)
			{
			case 0:
			{
				Vector2 mouseWorld = Main.MouseWorld;
				mouseWorld = base.Center;
				mouseWorld += new Vector2(num7, (float)Math.Sin(Main.GlobalTimeWrappedHourly) + cloudAlpha * 5f) * 25f;
				Vector2 v = mouseWorld - base.Center;
				v = v.SafeNormalize(Vector2.Zero) * (3f + cloudAlpha * 7f);
				if (num8 == 0f)
				{
					v = velocity;
				}
				float num9 = Distance(mouseWorld);
				float lerpValue = Utils.GetLerpValue(5f, 10f, num9, clamped: true);
				float y = velocity.Y;
				if (num9 > 10f)
				{
					velocity = Vector2.Lerp(velocity, v, 0.075f * lerpValue);
				}
				velocity.Y = y;
				velocity.Y -= num8;
				velocity.Y += 0.02f + num8 * 0.25f;
				velocity.Y = MathHelper.Clamp(velocity.Y, -2f, 2f);
				if (base.Center.Y + velocity.Y < mouseWorld.Y)
				{
					velocity.Y = MathHelper.Lerp(velocity.Y, velocity.Y + num8 + 0.01f, 0.75f);
				}
				velocity.X *= 0.98f;
				float num10 = Distance(vector);
				float num11 = ai[0];
				if (num10 > num11)
				{
					Vector2 vector3 = DirectionTo(vector);
					float num12 = num10 - num11;
					base.Center += vector3 * num12;
					bool num13 = Vector2.Dot(vector3, Vector2.UnitY) < 0.8f || num8 > 0f;
					velocity.Y += vector3.Y * 0.05f;
					if (num13)
					{
						velocity.Y -= 0.15f;
					}
					velocity.X += vector3.X * 0.2f;
					if (num11 == num && owner == Main.myPlayer)
					{
						Kill();
						return;
					}
				}
				break;
			}
			case 1:
			{
				Vector2 vector2 = DirectionTo(vector);
				velocity = Vector2.Lerp(velocity, vector2 * 16f, 1f);
				if (Distance(vector) < 10f && owner == Main.myPlayer)
				{
					Kill();
					return;
				}
				break;
			}
			}
			timeLeft = 2;
			Vector2 vector4 = base.Center - vector;
			int dir = ((vector4.X > 0f) ? 1 : (-1));
			if (Math.Abs(vector4.X) > Math.Abs(vector4.Y) / 2f)
			{
				player.ChangeDir(dir);
			}
			Vector2 vector5 = DirectionTo(vector).SafeNormalize(Vector2.Zero);
			if (num8 == 0f && velocity.Y > -0.02f)
			{
				rotation *= 0.95f;
			}
			else
			{
				float num14 = (-vector5).ToRotation() + MathF.PI / 4f;
				if (spriteDirection == -1)
				{
					num14 -= MathF.PI / 2f * (float)player.direction;
				}
				rotation = num14 + velocity.X * 0.05f;
			}
			float num15 = velocity.Length();
			switch (type)
			{
			case 771:
			case 822:
			case 823:
			case 827:
			case 830:
			case 838:
			case 843:
			case 844:
			case 845:
			case 846:
			case 850:
			case 852:
				frame = 0;
				break;
			case 828:
			case 829:
				if (num15 < 6f)
				{
					frame = 1;
				}
				else
				{
					frame = 0;
				}
				break;
			case 826:
				frame = (int)ai[1];
				break;
			case 824:
			case 839:
			case 840:
			case 853:
				if (num8 < 0.15f)
				{
					frame = 0;
					break;
				}
				frameCounter++;
				if ((float)frameCounter > (1f - num8) * 10f)
				{
					frameCounter = 0;
					frame = Main.rand.Next(4);
				}
				break;
			default:
				if (num15 < 3f)
				{
					frame = 0;
				}
				else if (num15 < 5f)
				{
					frame = 1;
				}
				else if (num15 < 7f)
				{
					frame = 2;
				}
				else
				{
					frame = 3;
				}
				break;
			}
			spriteDirection = player.direction;
		}

		private void AI_159_PaperAirplanes()
		{
			if (ai[1] == 0f)
			{
				direction = ((velocity.X > 0f) ? 1 : (-1));
				rotation = velocity.ToRotation();
				ai[1] = 1f;
				ai[0] = -Main.rand.Next(30, 80);
				netUpdate = true;
			}
			if (wet && owner == Main.myPlayer)
			{
				Kill();
			}
			ai[0] += 1f;
			Vector2 vector = rotation.ToRotationVector2() * 8f;
			float y = (float)Math.Sin(MathF.PI * 2f * (float)(Main.timeForVisualEffects % 90.0 / 90.0)) * (float)direction * Main.WindForVisuals;
			Vector2 v = vector + new Vector2(Main.WindForVisuals, y);
			_ = Vector2.UnitX * direction;
			bool flag = direction == Math.Sign(Main.WindForVisuals) && velocity.Length() > 3f;
			bool num = ai[0] >= 20f && ai[0] <= 69f;
			if (ai[0] == 70f)
			{
				ai[0] = -Main.rand.Next(120, 600);
			}
			bool num2 = num && flag;
			if (num2)
			{
				float lerpValue = Utils.GetLerpValue(0f, 30f, ai[0], clamped: true);
				v = vector.RotatedBy((float)(-direction) * (MathF.PI * 2f) * 0.02f * lerpValue);
			}
			velocity = v.SafeNormalize(Vector2.UnitY) * velocity.Length();
			if (!num2)
			{
				float num3 = MathHelper.Lerp(0.15f, 0.05f, Math.Abs(Main.WindForVisuals));
				if (timeLeft % 40 < 20)
				{
					velocity.Y -= num3;
				}
				else
				{
					velocity.Y += num3;
				}
				if (velocity.Y < -2f)
				{
					velocity.Y = -2f;
				}
				if (velocity.Y > 2f)
				{
					velocity.Y = 2f;
				}
				velocity.X = MathHelper.Clamp(velocity.X + Main.WindForVisuals * 0.006f, -6f, 6f);
				if (velocity.X * oldVelocity.X < 0f)
				{
					direction *= -1;
					ai[0] = -Main.rand.Next(120, 300);
					netUpdate = true;
				}
			}
			rotation = velocity.ToRotation();
			spriteDirection = direction;
		}

		private void AI_158_BabyBird()
		{
			Player player = Main.player[owner];
			if (type == 759)
			{
				if (player.dead)
				{
					player.babyBird = false;
				}
				if (player.babyBird)
				{
					timeLeft = 2;
				}
				if (++frameCounter >= 6)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type] - 1)
					{
						frame = 0;
					}
				}
			}
			float num = 6f;
			float num2 = 8f;
			int num3 = 800;
			float num4 = 150f;
			int attackTarget = -1;
			Minion_FindTargetInRange(num3, ref attackTarget, skipIfCannotHitWithOwnBody: false);
			if (attackTarget != -1)
			{
				NPC nPC = Main.npc[attackTarget];
				if (player.Distance(nPC.Center) > (float)num3)
				{
					attackTarget = -1;
				}
			}
			if (attackTarget != -1)
			{
				if (!Collision.SolidCollision(position, width, height))
				{
					tileCollide = true;
				}
				NPC nPC2 = Main.npc[attackTarget];
				float num5 = Distance(nPC2.Center);
				Rectangle rectangle = new Rectangle((int)position.X, (int)position.Y, width, height);
				Rectangle value = new Rectangle((int)nPC2.position.X, (int)nPC2.position.Y, nPC2.width, nPC2.height);
				if (rectangle.Intersects(value))
				{
					tileCollide = false;
					if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < num2)
					{
						velocity *= 1.1f;
					}
					if (velocity.Length() > num2)
					{
						velocity *= num2 / velocity.Length();
					}
				}
				else if (num5 > num4)
				{
					Vector2 vector = DirectionTo(nPC2.Center);
					velocity = Vector2.Lerp(velocity, vector * num, 0.15f);
				}
				else
				{
					tileCollide = false;
					Vector2 vector2 = DirectionTo(nPC2.Center);
					velocity += new Vector2(Math.Sign(vector2.X), Math.Sign(vector2.Y)) * 0.35f;
					if (velocity.Length() > num2)
					{
						velocity *= num2 / velocity.Length();
					}
				}
				float num6 = 0.025f;
				float num7 = width * 3;
				for (int i = 0; i < 1000; i++)
				{
					if (i != whoAmI && Main.projectile[i].active && Main.projectile[i].owner == owner && Main.projectile[i].type == type && Math.Abs(position.X - Main.projectile[i].position.X) + Math.Abs(position.Y - Main.projectile[i].position.Y) < num7)
					{
						if (position.X < Main.projectile[i].position.X)
						{
							velocity.X -= num6;
						}
						else
						{
							velocity.X += num6;
						}
						if (position.Y < Main.projectile[i].position.Y)
						{
							velocity.Y -= num6;
						}
						else
						{
							velocity.Y += num6;
						}
					}
				}
				rotation = velocity.X * 0.1f;
				direction = ((velocity.X > 0f) ? 1 : (-1));
				spriteDirection = ((velocity.X > 0f) ? 1 : (-1));
				return;
			}
			tileCollide = false;
			List<int> ai158_blacklistedTargets = _ai158_blacklistedTargets;
			ai158_blacklistedTargets.Clear();
			AI_GetMyGroupIndexAndFillBlackList(ai158_blacklistedTargets, out var index, out var _);
			localAI[0] = index;
			Vector2 vector3 = AI_158_GetHomeLocation(player, index);
			float num8 = Distance(vector3);
			bool flag = player.gravDir > 0f && player.fullRotation == 0f && player.headRotation == 0f;
			if (num8 > 2000f)
			{
				base.Center = vector3;
				frame = Main.projFrames[type] - 1;
				frameCounter = 0;
				velocity = Vector2.Zero;
				direction = (spriteDirection = player.direction);
				rotation = 0f;
			}
			else if (num8 > 40f)
			{
				float num9 = num + num8 * 0.006f;
				Vector2 vector4 = DirectionTo(vector3);
				vector4 *= MathHelper.Lerp(1f, 5f, Utils.GetLerpValue(40f, 800f, num8, clamped: true));
				velocity = Vector2.Lerp(velocity, vector4 * num9, 0.025f);
				if (velocity.Length() > num9)
				{
					velocity *= num9 / velocity.Length();
				}
				float num10 = 0.05f;
				float num11 = width;
				for (int j = 0; j < 1000; j++)
				{
					if (j != whoAmI && Main.projectile[j].active && Main.projectile[j].owner == owner && Main.projectile[j].type == type && Math.Abs(position.X - Main.projectile[j].position.X) + Math.Abs(position.Y - Main.projectile[j].position.Y) < num11)
					{
						if (position.X < Main.projectile[j].position.X)
						{
							velocity.X -= num10;
						}
						else
						{
							velocity.X += num10;
						}
						if (position.Y < Main.projectile[j].position.Y)
						{
							velocity.Y -= num10;
						}
						else
						{
							velocity.Y += num10;
						}
					}
				}
				rotation = velocity.X * 0.04f;
				direction = ((velocity.X > 0f) ? 1 : (-1));
				spriteDirection = ((velocity.X > 0f) ? 1 : (-1));
			}
			else if (num8 > 8f + player.velocity.Length())
			{
				Vector2 vector5 = DirectionTo(vector3);
				velocity += new Vector2(Math.Sign(vector5.X), Math.Sign(vector5.Y)) * 0.05f;
				if (velocity.Length() > num)
				{
					velocity *= num / velocity.Length();
				}
				rotation = velocity.X * 0.1f;
				direction = ((velocity.X > 0f) ? 1 : (-1));
				spriteDirection = ((velocity.X > 0f) ? 1 : (-1));
			}
			else if (flag)
			{
				base.Center = vector3;
				frame = Main.projFrames[type] - 1;
				frameCounter = 0;
				velocity = Vector2.Zero;
				direction = (spriteDirection = player.direction);
				rotation = 0f;
			}
		}

		public static Vector2 AI_158_GetHomeLocation(Player master, int stackedIndex)
		{
			int num = master.bodyFrame.Height;
			if (num == 0)
			{
				num = 1;
			}
			Vector2 vector = Main.OffsetsPlayerHeadgear[master.bodyFrame.Y / num];
			vector.Y -= 2f;
			if (master.mount.Active && master.mount.Type == 52)
			{
				vector.Y += 6f;
				vector.X -= master.direction * 10;
			}
			switch (stackedIndex % 6)
			{
			case 1:
				vector += new Vector2(master.direction * 8, master.gravDir * -2f);
				break;
			case 2:
				vector += new Vector2(master.direction * -10, master.gravDir * -2f);
				break;
			case 4:
				vector += new Vector2(master.direction * 10, master.gravDir * -10f);
				break;
			case 5:
				vector += new Vector2(master.direction * -12, master.gravDir * -10f);
				break;
			case 3:
			{
				Vector2 vector2 = vector;
				_ = master.direction;
				vector = vector2 + new Vector2(0f, master.gravDir * -10f);
				break;
			}
			}
			vector += new Vector2(0f, master.gravDir * -16f) * (stackedIndex / 6);
			Vector2 vector3 = master.RotatedRelativePoint(master.MountedCenter);
			_ = master.direction;
			return (vector3 + new Vector2(0f, master.gravDir * -21f) + vector).Floor();
		}

		public void Minion_FindTargetInRange(int startAttackRange, ref int attackTarget, bool skipIfCannotHitWithOwnBody, Func<Entity, int, bool> customEliminationCheck = null)
		{
			float num = startAttackRange;
			float num2 = num;
			float num3 = num;
			NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
			if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this) && IsInRangeOfMeOrMyOwner(ownerMinionAttackTargetNPC, num, out var _, out var _, out var _))
			{
				attackTarget = ownerMinionAttackTargetNPC.whoAmI;
			}
			else
			{
				if (attackTarget >= 0)
				{
					return;
				}
				for (int i = 0; i < 200; i++)
				{
					NPC nPC = Main.npc[i];
					if (nPC.CanBeChasedBy(this) && IsInRangeOfMeOrMyOwner(nPC, num, out var myDistance2, out var playerDistance2, out var closerIsMe2) && (!skipIfCannotHitWithOwnBody || CanHitWithOwnBody(nPC)) && (customEliminationCheck == null || customEliminationCheck(nPC, attackTarget)))
					{
						attackTarget = i;
						num = (closerIsMe2 ? myDistance2 : playerDistance2);
						if (num2 > myDistance2)
						{
							num2 = myDistance2;
						}
						if (num3 > playerDistance2)
						{
							num3 = playerDistance2;
						}
						num = Math.Max(num2, num3);
					}
				}
			}
		}

		private bool AI_067_CustomEliminationCheck_Pirates(Entity otherEntity, int currentTarget)
		{
			return true;
		}

		private bool AI_067_TigerSpecialAttack()
		{
			List<NPC> list = new List<NPC>();
			Vector2 center = Main.player[owner].Center;
			Rectangle value = Utils.CenteredRectangle(center, new Vector2(1600f, 800f));
			int num = Main.player[owner].ownedProjectileCounts[831] + 1;
			for (int i = 0; i < 200; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.CanBeChasedBy(this) && nPC.Hitbox.Intersects(value))
				{
					list.Add(nPC);
				}
			}
			if (list.Count == 0)
			{
				return false;
			}
			NPC nPC2 = list[0];
			for (int j = 1; j < list.Count; j++)
			{
				if (Vector2.Distance(nPC2.Center, center) > Vector2.Distance(list[j].Center, center))
				{
					nPC2 = list[j];
				}
			}
			list.Remove(nPC2);
			NPC nPC3 = null;
			if (list.Count > 0)
			{
				nPC3 = list[0];
				for (int k = 1; k < list.Count; k++)
				{
					if (Distance(nPC3.Center) > Distance(list[k].Center))
					{
						nPC3 = list[k];
					}
				}
				list.Remove(nPC3);
			}
			List<Vector2> list2 = new List<Vector2>();
			if (nPC3 != null)
			{
				list2.Add(nPC3.Center);
			}
			int num2 = 0;
			while (list.Count > 0 && list2.Count < num - 1)
			{
				int index = Main.rand.Next(list.Count);
				Vector2 vector = list[index].velocity * 4f * (num2 + 1);
				list2.Add(list[index].Center + vector);
				list.RemoveAt(index);
				num2++;
			}
			if (nPC2 != null)
			{
				list2.Add(nPC2.Center);
			}
			if (list2.Count > 0 && Collision.SolidCollision(list2[list2.Count - 1] - base.Size / 2f, width, height))
			{
				list2.Add(center);
			}
			Vector2 vector2 = base.Center;
			float num3 = Math.Min(20, 30 / list2.Count);
			float num4 = 0f;
			for (int l = 0; l < list2.Count; l++)
			{
				float num5 = 20f;
				Vector2 vector3 = list2[l];
				vector3.X += ((vector2.X < vector3.X) ? num5 : (0f - num5));
				Vector2 vector4 = vector3 - vector2;
				int num6 = (int)Math.Min(num3, 4.0 + Math.Ceiling(vector4.Length() / 50f));
				if (num6 < 5)
				{
					num6 = 5;
				}
				NewProjectile(GetProjectileSource_FromThis(), vector2, vector4, 818, damage, 0f, owner, (0f - num4) * 4f, num6 * 4);
				vector2 = vector3;
				num4 += (float)num6;
			}
			base.Center = vector2;
			ai[0] = 4f;
			ai[1] = num4;
			netUpdate = true;
			return true;
		}

		private void AI_067_FreakingPirates()
		{
			Player player = Main.player[owner];
			if (!player.active)
			{
				active = false;
				return;
			}
			bool flag = type == 393 || type == 394 || type == 395;
			bool flag2 = type == 758;
			bool flag3 = type == 833 || type == 834 || type == 835;
			bool flag4 = type == 834 || type == 835;
			bool flag5 = type == 951;
			int num = 450;
			float num2 = 500f;
			float num3 = 300f;
			int num4 = 15;
			if (flag5)
			{
				if (player.dead)
				{
					player.flinxMinion = false;
				}
				if (player.flinxMinion)
				{
					timeLeft = 2;
				}
				num = 800;
			}
			if (flag)
			{
				if (player.dead)
				{
					player.pirateMinion = false;
				}
				if (player.pirateMinion)
				{
					timeLeft = 2;
				}
				num = 800;
			}
			if (flag3)
			{
				if (player.dead)
				{
					player.stormTiger = false;
				}
				if (player.stormTiger)
				{
					timeLeft = 2;
				}
				num = 800;
				if (ai[0] != 4f)
				{
					if (velocity != Vector2.Zero && Main.rand.Next(18) == 0)
					{
						Dust obj = Main.dust[Dust.NewDust(position, width, height, 269)];
						obj.fadeIn = 0.5f;
						obj.scale = 0.3f;
						obj.noLight = true;
						obj.velocity += velocity * 0.005f;
					}
					if (type == 833)
					{
						Lighting.AddLight(base.Center, Vector3.One * 0.5f);
					}
					if (type == 834)
					{
						Lighting.AddLight(base.Center, Vector3.One * 0.8f);
					}
					if (type == 835)
					{
						Lighting.AddLight(base.Center, Color.Lerp(Main.OurFavoriteColor, Color.White, 0.8f).ToVector3() * 1f);
					}
				}
				if (owner == Main.myPlayer)
				{
					if (localAI[0] <= 0f)
					{
						int num5 = type switch
						{
							834 => 300, 
							835 => 240, 
							_ => 360, 
						};
						if (damage != 0)
						{
							bool flag6 = AI_067_TigerSpecialAttack();
							localAI[0] = (flag6 ? num5 : 10);
						}
					}
					else
					{
						localAI[0] -= 1f;
					}
				}
			}
			if (flag2)
			{
				if (player.dead)
				{
					player.vampireFrog = false;
				}
				if (player.vampireFrog)
				{
					timeLeft = 2;
				}
				num = 800;
			}
			if (type == 500)
			{
				num2 = 200f;
				if (player.dead)
				{
					player.crimsonHeart = false;
				}
				if (player.crimsonHeart)
				{
					timeLeft = 2;
				}
			}
			if (type == 653)
			{
				num2 = 300f;
				if (player.dead)
				{
					player.companionCube = false;
				}
				if (player.companionCube)
				{
					timeLeft = 2;
				}
			}
			if (type == 1018)
			{
				num2 = 200f;
				if (player.dead)
				{
					player.petFlagDirtiestBlock = false;
				}
				if (player.petFlagDirtiestBlock)
				{
					timeLeft = 2;
				}
			}
			if (flag3 && ai[0] == 4f)
			{
				velocity = Vector2.Zero;
				frame = 9;
				if (flag4)
				{
					frame = 11;
				}
				ai[1] -= 1f;
				if (!(ai[1] <= 0f))
				{
					return;
				}
				ai[0] = 0f;
				ai[1] = 0f;
				netUpdate = true;
			}
			Vector2 vector = player.Center;
			if (flag5)
			{
				vector.X -= (45 + player.width / 2) * player.direction;
				vector.X -= minionPos * 30 * player.direction;
			}
			else if (flag)
			{
				vector.X -= (15 + player.width / 2) * player.direction;
				vector.X -= minionPos * 20 * player.direction;
			}
			else if (flag3)
			{
				vector.X -= (15 + player.width / 2) * player.direction;
				vector.X -= minionPos * 40 * player.direction;
			}
			else if (flag2)
			{
				vector.X -= (35 + player.width / 2) * player.direction;
				vector.X -= minionPos * 40 * player.direction;
			}
			else if (type == 500)
			{
				vector.X -= (15 + player.width / 2) * player.direction;
				vector.X -= 40 * player.direction;
			}
			else if (type == 1018)
			{
				vector.X = player.Center.X;
			}
			else if (type == 653)
			{
				vector.X = player.Center.X;
			}
			if (type == 500)
			{
				Lighting.AddLight(base.Center, 0.9f, 0.1f, 0.3f);
				int num6 = 6;
				if (frame == 0 || frame == 2)
				{
					num6 = 12;
				}
				if (++frameCounter >= num6)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				rotation += velocity.X / 20f;
				Vector2 vector2 = (-Vector2.UnitY).RotatedBy(rotation).RotatedBy((float)direction * 0.2f);
				int num7 = Dust.NewDust(base.Center + vector2 * 10f - new Vector2(4f), 0, 0, 5, vector2.X, vector2.Y, 0, Color.Transparent);
				Main.dust[num7].scale = 1f;
				Main.dust[num7].velocity = vector2.RotatedByRandom(0.7853981852531433) * 3.5f;
				Main.dust[num7].noGravity = true;
				Main.dust[num7].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cLight, Main.player[owner]);
			}
			if (type == 1018)
			{
				rotation += velocity.X / 20f;
			}
			if (type == 653)
			{
				rotation += velocity.X / 20f;
				bool flag7 = owner >= 0 && owner < 255;
				if (flag7)
				{
					_CompanionCubeScreamCooldown[owner] -= 1f;
					if (_CompanionCubeScreamCooldown[owner] < 0f)
					{
						_CompanionCubeScreamCooldown[owner] = 0f;
					}
				}
				Tile tileSafely = Framing.GetTileSafely(base.Center);
				if (tileSafely.liquid > 0 && tileSafely.lava())
				{
					localAI[0] += 1f;
				}
				else
				{
					localAI[0] -= 1f;
				}
				localAI[0] = MathHelper.Clamp(localAI[0], 0f, 20f);
				if (localAI[0] >= 20f)
				{
					if (flag7 && _CompanionCubeScreamCooldown[owner] == 0f)
					{
						_CompanionCubeScreamCooldown[owner] = 3600f;
						SoundEngine.PlaySound((Main.rand.Next(10) == 0) ? SoundID.NPCDeath61 : SoundID.NPCDeath59, position);
					}
					Kill();
				}
				if (flag7 && owner == Main.myPlayer && Main.netMode != 2)
				{
					Vector3 vector3 = Lighting.GetColor((int)base.Center.X / 16, (int)base.Center.Y / 16).ToVector3();
					Vector3 vector4 = Lighting.GetColor((int)player.Center.X / 16, (int)player.Center.Y / 16).ToVector3();
					if (vector3.Length() < 0.15f && vector4.Length() < 0.15f)
					{
						localAI[1] += 1f;
					}
					else if (localAI[1] > 0f)
					{
						localAI[1] -= 1f;
					}
					localAI[1] = MathHelper.Clamp(localAI[1], -3600f, 120f);
					if (localAI[1] > (float)Main.rand.Next(30, 120) && !player.immune && player.velocity == Vector2.Zero)
					{
						if (Main.rand.Next(5) == 0)
						{
							SoundEngine.PlaySound(SoundID.Item16, base.Center);
							localAI[1] = -600f;
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item1, base.Center);
							player.Hurt(PlayerDeathReason.ByOther(6), 3, 0);
							player.immune = false;
							player.immuneTime = 0;
							localAI[1] = -300 + Main.rand.Next(30) * -10;
						}
					}
				}
			}
			bool flag8 = true;
			if (type == 500 || type == 653 || type == 1018)
			{
				flag8 = false;
			}
			shouldFallThrough = player.position.Y + (float)player.height - 12f > position.Y + (float)height;
			friendly = false;
			int num8 = 0;
			int num9 = 15;
			int attackTarget = -1;
			bool flag9 = true;
			bool flag10 = ai[0] == 5f;
			if (flag5)
			{
				flag9 = false;
				friendly = true;
			}
			if (flag2)
			{
				friendly = true;
				num9 = 20;
				num8 = 60;
			}
			if (flag3)
			{
				flag9 = false;
				friendly = true;
				originalDamage = player.highestStormTigerGemOriginalDamage;
			}
			bool flag11 = ai[0] == 0f;
			if (flag3 && flag10)
			{
				flag11 = true;
			}
			if (flag11 && flag8)
			{
				Minion_FindTargetInRange(num, ref attackTarget, skipIfCannotHitWithOwnBody: true, AI_067_CustomEliminationCheck_Pirates);
			}
			if (flag3 && flag10)
			{
				if (attackTarget >= 0)
				{
					float maxDistance = num;
					NPC nPC = Main.npc[attackTarget];
					vector = nPC.Center;
					if (!IsInRangeOfMeOrMyOwner(nPC, maxDistance, out var _, out var _, out var _))
					{
						ai[0] = 0f;
						ai[1] = 0f;
						return;
					}
					Point point = nPC.Top.ToTileCoordinates();
					int num10 = 0;
					int num11 = point.Y;
					while (num10 < num4)
					{
						Tile tile = Main.tile[point.X, num11];
						if (tile == null || tile.active())
						{
							break;
						}
						num10++;
						num11++;
					}
					int num12 = num4 / 2;
					if (num10 < num12)
					{
						ai[0] = 0f;
						ai[1] = 0f;
						return;
					}
					if (base.Hitbox.Intersects(nPC.Hitbox) && velocity.Y >= 0f)
					{
						velocity.Y = -8f;
						velocity.X = direction * 10;
					}
					float num13 = 20f;
					float maxAmountAllowedToMove = 4f;
					float num14 = 40f;
					float num15 = 40f;
					Vector2 top = nPC.Top;
					float num16 = (float)Math.Cos(Main.timeForVisualEffects / (double)num14 * 6.2831854820251465);
					if (num16 > 0f)
					{
						num16 *= -1f;
					}
					num16 *= num15;
					top.Y += num16;
					Vector2 vector5 = top - base.Center;
					if (vector5.Length() > num13)
					{
						vector5 = vector5.SafeNormalize(Vector2.Zero) * num13;
					}
					velocity = velocity.MoveTowards(vector5, maxAmountAllowedToMove);
					frame = 8;
					if (flag4)
					{
						frame = 10;
					}
					rotation += 0.6f * (float)spriteDirection;
				}
				else
				{
					ai[0] = 0f;
					ai[1] = 0f;
				}
				return;
			}
			if (ai[0] == 1f)
			{
				tileCollide = false;
				float num17 = 0.2f;
				float num18 = 10f;
				int num19 = 200;
				if (num18 < Math.Abs(player.velocity.X) + Math.Abs(player.velocity.Y))
				{
					num18 = Math.Abs(player.velocity.X) + Math.Abs(player.velocity.Y);
				}
				Vector2 vector6 = player.Center - base.Center;
				float num20 = vector6.Length();
				if (num20 > 2000f)
				{
					position = player.Center - new Vector2(width, height) / 2f;
				}
				if (num20 < (float)num19 && player.velocity.Y == 0f && position.Y + (float)height <= player.position.Y + (float)player.height && !Collision.SolidCollision(position, width, height))
				{
					ai[0] = 0f;
					netUpdate = true;
					if (velocity.Y < -6f)
					{
						velocity.Y = -6f;
					}
				}
				if (!(num20 < 60f))
				{
					vector6.Normalize();
					vector6 *= num18;
					if (velocity.X < vector6.X)
					{
						velocity.X += num17;
						if (velocity.X < 0f)
						{
							velocity.X += num17 * 1.5f;
						}
					}
					if (velocity.X > vector6.X)
					{
						velocity.X -= num17;
						if (velocity.X > 0f)
						{
							velocity.X -= num17 * 1.5f;
						}
					}
					if (velocity.Y < vector6.Y)
					{
						velocity.Y += num17;
						if (velocity.Y < 0f)
						{
							velocity.Y += num17 * 1.5f;
						}
					}
					if (velocity.Y > vector6.Y)
					{
						velocity.Y -= num17;
						if (velocity.Y > 0f)
						{
							velocity.Y -= num17 * 1.5f;
						}
					}
				}
				if (velocity.X != 0f)
				{
					spriteDirection = Math.Sign(velocity.X);
				}
				if (flag5)
				{
					frameCounter++;
					if (frameCounter > 3)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 2 || frame >= Main.projFrames[type])
					{
						frame = 2;
					}
					rotation = rotation.AngleTowards(rotation + 0.25f * (float)spriteDirection, 0.25f);
				}
				if (flag)
				{
					frameCounter++;
					if (frameCounter > 3)
					{
						frame++;
						frameCounter = 0;
					}
					if ((frame < 10) | (frame > 13))
					{
						frame = 10;
					}
					rotation = velocity.X * 0.1f;
				}
				if (flag2)
				{
					int num21 = 3;
					if (++frameCounter >= num21 * 4)
					{
						frameCounter = 0;
					}
					frame = 14 + frameCounter / num21;
					rotation = velocity.X * 0.15f;
				}
				if (flag3)
				{
					frame = 8;
					if (flag4)
					{
						frame = 10;
					}
					rotation += 0.6f * (float)spriteDirection;
				}
				if (type == 1018 && Main.LocalPlayer.miscCounter % 3 == 0)
				{
					int num22 = 2;
					Dust obj2 = Main.dust[Dust.NewDust(position + new Vector2(-num22, -num22), 16 + num22 * 2, 16 + num22 * 2, 0, 0f, 0f, 0, default(Color), 0.8f)];
					obj2.velocity = -velocity * 0.25f;
					obj2.velocity = obj2.velocity.RotatedByRandom(0.2617993950843811);
				}
			}
			if (ai[0] == 2f && ai[1] < 0f)
			{
				friendly = false;
				ai[1] += 1f;
				if (num9 >= 0)
				{
					ai[1] = 0f;
					ai[0] = 0f;
					netUpdate = true;
					return;
				}
			}
			else if (ai[0] == 2f)
			{
				spriteDirection = direction;
				rotation = 0f;
				if (flag)
				{
					friendly = true;
					frame = 4 + (int)((float)num9 - ai[1]) / (num9 / 3);
					if (velocity.Y != 0f)
					{
						frame += 3;
					}
				}
				if (flag2)
				{
					float num23 = ((float)num9 - ai[1]) / (float)num9;
					if ((double)num23 > 0.25 && (double)num23 < 0.75)
					{
						friendly = true;
					}
					int num24 = (int)(num23 * 5f);
					if (num24 > 2)
					{
						num24 = 4 - num24;
					}
					if (velocity.Y != 0f)
					{
						frame = 21 + num24;
					}
					else
					{
						frame = 18 + num24;
					}
					if (velocity.Y == 0f)
					{
						velocity.X *= 0.8f;
					}
				}
				velocity.Y += 0.4f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
				ai[1] -= 1f;
				if (ai[1] <= 0f)
				{
					if (num8 <= 0)
					{
						ai[1] = 0f;
						ai[0] = 0f;
						netUpdate = true;
						return;
					}
					ai[1] = -num8;
				}
			}
			if (attackTarget >= 0)
			{
				float maxDistance2 = num;
				float num25 = 20f;
				if (flag2)
				{
					num25 = 50f;
				}
				NPC nPC2 = Main.npc[attackTarget];
				Vector2 center = nPC2.Center;
				vector = center;
				if (IsInRangeOfMeOrMyOwner(nPC2, maxDistance2, out var _, out var _, out var _))
				{
					shouldFallThrough = nPC2.Center.Y > base.Bottom.Y;
					bool flag12 = velocity.Y == 0f;
					if (wet && velocity.Y > 0f && !shouldFallThrough)
					{
						flag12 = true;
					}
					if (center.Y < base.Center.Y - 30f && flag12)
					{
						float num26 = (center.Y - base.Center.Y) * -1f;
						float num27 = 0.4f;
						float num28 = (float)Math.Sqrt(num26 * 2f * num27);
						if (num28 > 26f)
						{
							num28 = 26f;
						}
						velocity.Y = 0f - num28;
					}
					if (flag9 && Vector2.Distance(base.Center, vector) < num25)
					{
						if (velocity.Length() > 10f)
						{
							velocity /= velocity.Length() / 10f;
						}
						ai[0] = 2f;
						ai[1] = num9;
						netUpdate = true;
						direction = ((center.X - base.Center.X > 0f) ? 1 : (-1));
					}
					if (flag3)
					{
						Point point2 = nPC2.Top.ToTileCoordinates();
						int num29 = 0;
						int num30 = point2.Y;
						while (num29 < num4)
						{
							Tile tile2 = Main.tile[point2.X, num30];
							if (tile2 == null || tile2.active())
							{
								break;
							}
							num29++;
							num30++;
						}
						if (num29 >= num4)
						{
							ai[0] = 5f;
							ai[1] = 0f;
							netUpdate = true;
							return;
						}
						if (base.Hitbox.Intersects(nPC2.Hitbox) && velocity.Y >= 0f)
						{
							velocity.Y = -4f;
							velocity.X = direction * 10;
						}
					}
				}
				if (flag2)
				{
					int num31 = 1;
					if (center.X - base.Center.X < 0f)
					{
						num31 = -1;
					}
					vector.X += 20 * -num31;
				}
			}
			if (ai[0] == 0f && attackTarget < 0)
			{
				if (Main.player[owner].rocketDelay2 > 0)
				{
					ai[0] = 1f;
					netUpdate = true;
				}
				Vector2 vector7 = player.Center - base.Center;
				if (vector7.Length() > 2000f)
				{
					position = player.Center - new Vector2(width, height) / 2f;
				}
				else if (vector7.Length() > num2 || Math.Abs(vector7.Y) > num3)
				{
					ai[0] = 1f;
					netUpdate = true;
					if (velocity.Y > 0f && vector7.Y < 0f)
					{
						velocity.Y = 0f;
					}
					if (velocity.Y < 0f && vector7.Y > 0f)
					{
						velocity.Y = 0f;
					}
				}
			}
			if (ai[0] == 0f)
			{
				if (attackTarget < 0)
				{
					if (Distance(player.Center) > 60f && Distance(vector) > 60f && Math.Sign(vector.X - player.Center.X) != Math.Sign(base.Center.X - player.Center.X))
					{
						vector = player.Center;
					}
					Rectangle r = Utils.CenteredRectangle(vector, base.Size);
					for (int i = 0; i < 20; i++)
					{
						if (Collision.SolidCollision(r.TopLeft(), r.Width, r.Height))
						{
							break;
						}
						r.Y += 16;
						vector.Y += 16f;
					}
					Vector2 vector8 = Collision.TileCollision(player.Center - base.Size / 2f, vector - player.Center, width, height);
					vector = player.Center - base.Size / 2f + vector8;
					if (Distance(vector) < 32f)
					{
						float num32 = player.Center.Distance(vector);
						if (player.Center.Distance(base.Center) < num32)
						{
							vector = base.Center;
						}
					}
					Vector2 vector9 = player.Center - vector;
					if (vector9.Length() > num2 || Math.Abs(vector9.Y) > num3)
					{
						Rectangle r2 = Utils.CenteredRectangle(player.Center, base.Size);
						Vector2 vector10 = vector - player.Center;
						Vector2 vector11 = r2.TopLeft();
						for (float num33 = 0f; num33 < 1f; num33 += 0.05f)
						{
							Vector2 vector12 = r2.TopLeft() + vector10 * num33;
							if (Collision.SolidCollision(r2.TopLeft() + vector10 * num33, r.Width, r.Height))
							{
								break;
							}
							vector11 = vector12;
						}
						vector = vector11 + base.Size / 2f;
					}
				}
				tileCollide = true;
				float num34 = 0.5f;
				float num35 = 4f;
				float num36 = 4f;
				float num37 = 0.1f;
				if (flag5 && attackTarget != -1)
				{
					num34 = 0.65f;
					num35 = 5.5f;
					num36 = 5.5f;
				}
				if (flag && attackTarget != -1)
				{
					num34 = 1f;
					num35 = 8f;
					num36 = 8f;
				}
				if (flag2 && attackTarget != -1)
				{
					num34 = 0.7f;
					num35 = 6f;
					num36 = 6f;
				}
				if (flag3 && attackTarget != -1)
				{
					num34 = 1f;
					num35 = 8f;
					num36 = 8f;
				}
				if (num36 < Math.Abs(player.velocity.X) + Math.Abs(player.velocity.Y))
				{
					num36 = Math.Abs(player.velocity.X) + Math.Abs(player.velocity.Y);
					num34 = 0.7f;
				}
				if (type == 653 || type == 1018)
				{
					float num38 = player.velocity.Length();
					if (num38 < 0.1f)
					{
						num38 = 0f;
					}
					if (num38 != 0f && num38 < num36)
					{
						num36 = num38;
					}
				}
				int num39 = 0;
				bool flag13 = false;
				float num40 = vector.X - base.Center.X;
				Vector2 vector13 = vector - base.Center;
				if (type == 1018 && Math.Abs(num40) < 50f)
				{
					rotation = rotation.AngleTowards(0f, 0.2f);
					velocity.X *= 0.9f;
					if ((double)Math.Abs(velocity.X) < 0.1)
					{
						velocity.X = 0f;
					}
				}
				else if (type == 653 && Math.Abs(num40) < 150f)
				{
					rotation = rotation.AngleTowards(0f, 0.2f);
					velocity.X *= 0.9f;
					if ((double)Math.Abs(velocity.X) < 0.1)
					{
						velocity.X = 0f;
					}
				}
				else if (Math.Abs(num40) > 5f)
				{
					if (num40 < 0f)
					{
						num39 = -1;
						if (velocity.X > 0f - num35)
						{
							velocity.X -= num34;
						}
						else
						{
							velocity.X -= num37;
						}
					}
					else
					{
						num39 = 1;
						if (velocity.X < num35)
						{
							velocity.X += num34;
						}
						else
						{
							velocity.X += num37;
						}
					}
					bool flag14 = true;
					if (flag)
					{
						flag14 = false;
					}
					if (type == 653)
					{
						flag14 = false;
					}
					if (type == 1018)
					{
						flag14 = false;
					}
					if (flag2 && attackTarget == -1)
					{
						flag14 = false;
					}
					if (flag3)
					{
						flag14 = vector13.Y < -80f;
					}
					if (flag5)
					{
						flag14 = attackTarget > -1 && Main.npc[attackTarget].Hitbox.Intersects(base.Hitbox);
					}
					if (flag14)
					{
						flag13 = true;
					}
				}
				else
				{
					velocity.X *= 0.9f;
					if (Math.Abs(velocity.X) < num34 * 2f)
					{
						velocity.X = 0f;
					}
				}
				bool flag15 = Math.Abs(vector13.X) >= 64f || (vector13.Y <= -48f && Math.Abs(vector13.X) >= 8f);
				if (num39 != 0 && flag15)
				{
					int num41 = (int)(position.X + (float)(width / 2)) / 16;
					int num42 = (int)position.Y / 16;
					num41 += num39;
					num41 += (int)velocity.X;
					for (int j = num42; j < num42 + height / 16 + 1; j++)
					{
						if (WorldGen.SolidTile(num41, j))
						{
							flag13 = true;
						}
					}
				}
				if (type == 500 && velocity.X != 0f)
				{
					flag13 = true;
				}
				if (type == 653 && Math.Abs(velocity.X) > 3f)
				{
					flag13 = true;
				}
				if (type == 1018 && Math.Abs(velocity.X) > 3f)
				{
					flag13 = true;
				}
				Collision.StepUp(ref position, ref velocity, width, height, ref stepSpeed, ref gfxOffY);
				float num43 = Utils.GetLerpValue(0f, 100f, vector13.Y, clamped: true) * Utils.GetLerpValue(-2f, -6f, velocity.Y, clamped: true);
				if (velocity.Y == 0f)
				{
					if (flag13)
					{
						for (int k = 0; k < 3; k++)
						{
							int num44 = (int)(position.X + (float)(width / 2)) / 16;
							if (k == 0)
							{
								num44 = (int)position.X / 16;
							}
							if (k == 2)
							{
								num44 = (int)(position.X + (float)width) / 16;
							}
							int num45 = (int)(position.Y + (float)height) / 16;
							if (!WorldGen.SolidTile(num44, num45) && !Main.tile[num44, num45].halfBrick() && Main.tile[num44, num45].slope() <= 0 && (!TileID.Sets.Platforms[Main.tile[num44, num45].type] || !Main.tile[num44, num45].active() || Main.tile[num44, num45].inActive()))
							{
								continue;
							}
							try
							{
								num44 = (int)(position.X + (float)(width / 2)) / 16;
								num45 = (int)(position.Y + (float)(height / 2)) / 16;
								num44 += num39;
								num44 += (int)velocity.X;
								if (!WorldGen.SolidTile(num44, num45 - 1) && !WorldGen.SolidTile(num44, num45 - 2))
								{
									velocity.Y = -5.1f;
								}
								else if (!WorldGen.SolidTile(num44, num45 - 2))
								{
									velocity.Y = -7.1f;
								}
								else if (WorldGen.SolidTile(num44, num45 - 5))
								{
									velocity.Y = -11.1f;
								}
								else if (WorldGen.SolidTile(num44, num45 - 4))
								{
									velocity.Y = -10.1f;
								}
								else
								{
									velocity.Y = -9.1f;
								}
							}
							catch
							{
								velocity.Y = -9.1f;
							}
						}
						if (vector.Y - base.Center.Y < -48f)
						{
							float num46 = vector.Y - base.Center.Y;
							num46 *= -1f;
							if (num46 < 60f)
							{
								velocity.Y = -6f;
							}
							else if (num46 < 80f)
							{
								velocity.Y = -7f;
							}
							else if (num46 < 100f)
							{
								velocity.Y = -8f;
							}
							else if (num46 < 120f)
							{
								velocity.Y = -9f;
							}
							else if (num46 < 140f)
							{
								velocity.Y = -10f;
							}
							else if (num46 < 160f)
							{
								velocity.Y = -11f;
							}
							else if (num46 < 190f)
							{
								velocity.Y = -12f;
							}
							else if (num46 < 210f)
							{
								velocity.Y = -13f;
							}
							else if (num46 < 270f)
							{
								velocity.Y = -14f;
							}
							else if (num46 < 310f)
							{
								velocity.Y = -15f;
							}
							else
							{
								velocity.Y = -16f;
							}
						}
						if (wet && num43 == 0f)
						{
							velocity.Y *= 2f;
						}
					}
					if (type == 1018 && localAI[2] == 0f)
					{
						localAI[2] = 1f;
						for (int l = 0; l < 6; l++)
						{
							Dust obj4 = Main.dust[Dust.NewDust(position + velocity, 16, 16, 0, 0f, 0f, 0, default(Color), 0.8f)];
							obj4.velocity.X = velocity.X * 0.25f;
							obj4.velocity.Y = -2f + Math.Abs(velocity.Y) * 0.25f;
							obj4.velocity = obj4.velocity.RotatedByRandom(0.2617993950843811);
						}
					}
				}
				else if (type == 1018)
				{
					localAI[2] = 0f;
				}
				if (velocity.X > num36)
				{
					velocity.X = num36;
				}
				if (velocity.X < 0f - num36)
				{
					velocity.X = 0f - num36;
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				if (velocity.X == 0f)
				{
					direction = ((player.Center.X > base.Center.X) ? 1 : (-1));
				}
				if (velocity.X > num34 && num39 == 1)
				{
					direction = 1;
				}
				if (velocity.X < 0f - num34 && num39 == -1)
				{
					direction = -1;
				}
				spriteDirection = direction;
				if (flag5)
				{
					if (velocity.Y == 0f)
					{
						rotation = rotation.AngleTowards(0f, 0.3f);
						if (velocity.X == 0f)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if (Math.Abs(velocity.X) >= 0.5f)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 10)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame < 2 || frame >= Main.projFrames[type])
							{
								frame = 2;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y != 0f)
					{
						rotation = Math.Min(4f, velocity.Y) * -0.1f;
						if (spriteDirection == -1)
						{
							rotation -= MathF.PI * 2f;
						}
						frameCounter = 0;
						frame = 1;
					}
				}
				if (flag)
				{
					rotation = 0f;
					if (velocity.Y == 0f)
					{
						if (velocity.X == 0f)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if (Math.Abs(velocity.X) >= 0.5f)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 10)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 4)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y != 0f)
					{
						frameCounter = 0;
						frame = 14;
					}
				}
				if (flag2)
				{
					rotation = 0f;
					if (velocity.Y == 0f)
					{
						if (velocity.X == 0f)
						{
							int num47 = 4;
							if (++frameCounter >= 7 * num47 && Main.rand.Next(50) == 0)
							{
								frameCounter = 0;
							}
							int num48 = frameCounter / num47;
							if (num48 >= 4)
							{
								num48 = 6 - num48;
							}
							if (num48 < 0)
							{
								num48 = 0;
							}
							frame = 1 + num48;
						}
						else if (Math.Abs(velocity.X) >= 0.5f)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							int num49 = 15;
							int num50 = 8;
							if (frameCounter >= num50 * num49)
							{
								frameCounter = 0;
							}
							int num51 = frameCounter / num49;
							frame = num51 + 5;
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y != 0f)
					{
						if (velocity.Y < 0f)
						{
							if (frame > 9 || frame < 5)
							{
								frame = 5;
								frameCounter = 0;
							}
							if (++frameCounter >= 1 && frame < 9)
							{
								frame++;
								frameCounter = 0;
							}
						}
						else
						{
							if (frame > 13 || frame < 9)
							{
								frame = 9;
								frameCounter = 0;
							}
							if (++frameCounter >= 2 && frame < 11)
							{
								frame++;
								frameCounter = 0;
							}
						}
					}
				}
				if (flag3)
				{
					int num52 = 8;
					if (flag4)
					{
						num52 = 10;
					}
					rotation = 0f;
					if (velocity.Y == 0f)
					{
						if (velocity.X == 0f)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if (Math.Abs(velocity.X) >= 0.5f)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 10)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= num52 || frame < 2)
							{
								frame = 2;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y != 0f)
					{
						frameCounter = 0;
						frame = 1;
						if (flag4)
						{
							frame = 9;
						}
					}
				}
				velocity.Y += 0.4f + num43 * 1f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			if (!flag)
			{
				return;
			}
			localAI[0] += 1f;
			if (velocity.X == 0f)
			{
				localAI[0] += 1f;
			}
			if (localAI[0] >= (float)Main.rand.Next(900, 1200))
			{
				localAI[0] = 0f;
				for (int m = 0; m < 6; m++)
				{
					int num53 = Dust.NewDust(base.Center + Vector2.UnitX * -direction * 8f - Vector2.One * 5f + Vector2.UnitY * 8f, 3, 6, 216, -direction, 1f);
					Main.dust[num53].velocity /= 2f;
					Main.dust[num53].scale = 0.8f;
				}
				int num54 = Gore.NewGore(base.Center + Vector2.UnitX * -direction * 8f, Vector2.Zero, Main.rand.Next(580, 583));
				Main.gore[num54].velocity /= 2f;
				Main.gore[num54].velocity.Y = Math.Abs(Main.gore[num54].velocity.Y);
				Main.gore[num54].velocity.X = (0f - Math.Abs(Main.gore[num54].velocity.X)) * (float)direction;
			}
		}

		private void AI_157_SharpTears()
		{
			int num = 5;
			float num2 = 1f;
			int num3 = 30;
			int num4 = 30;
			int num5 = 2;
			int num6 = 2;
			int num7 = 20;
			int num8 = 30;
			int num9 = 35;
			int maxValue = 6;
			if (type == 961)
			{
				num = 16;
				num2 = 0.75f;
				num3 = 5;
				num4 = 5;
				num5 = 0;
				num6 = 0;
				num7 = 10;
				num8 = 10;
				num9 = 20;
				maxValue = 5;
			}
			bool flag = ai[0] < (float)num7;
			bool flag2 = ai[0] >= (float)num8;
			bool flag3 = ai[0] >= (float)num9;
			ai[0] += 1f;
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				rotation = velocity.ToRotation();
				frame = Main.rand.Next(maxValue);
				for (int i = 0; i < num3; i++)
				{
					Dust dust = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(24f, 24f), num, velocity * num2 * MathHelper.Lerp(0.2f, 0.7f, Main.rand.NextFloat()));
					dust.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
					dust.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
				}
				for (int j = 0; j < num4; j++)
				{
					Dust dust2 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(24f, 24f), num, Main.rand.NextVector2Circular(2f, 2f) + velocity * num2 * MathHelper.Lerp(0.2f, 0.5f, Main.rand.NextFloat()));
					dust2.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
					dust2.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
					dust2.fadeIn = 1f;
				}
				if (type == 961)
				{
					SoundEngine.PlaySound(SoundID.DeerclopsIceAttack, base.Center);
				}
				else
				{
					SoundEngine.PlaySound(SoundID.Item60, base.Center);
				}
			}
			if (flag)
			{
				Opacity += 0.1f;
				scale = Opacity * ai[1];
				for (int k = 0; k < num5; k++)
				{
					Dust dust3 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f), num, velocity * num2 * MathHelper.Lerp(0.2f, 0.5f, Main.rand.NextFloat()));
					dust3.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
					dust3.velocity *= 0.5f;
					dust3.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
				}
			}
			if (flag2)
			{
				Opacity -= 0.2f;
				for (int l = 0; l < num6; l++)
				{
					Dust dust4 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f), num, velocity * num2 * MathHelper.Lerp(0.2f, 0.5f, Main.rand.NextFloat()));
					dust4.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
					dust4.velocity *= 0.5f;
					dust4.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
				}
			}
			if (flag3)
			{
				Kill();
			}
			if (type == 756)
			{
				Lighting.AddLight(base.Center, new Vector3(0.5f, 0.1f, 0.1f) * scale);
			}
		}

		public bool IsInRangeOfMeOrMyOwner(Entity entity, float maxDistance, out float myDistance, out float playerDistance, out bool closerIsMe)
		{
			myDistance = Vector2.Distance(entity.Center, base.Center);
			if (myDistance < maxDistance && !CanHitWithOwnBody(entity))
			{
				myDistance = float.PositiveInfinity;
			}
			playerDistance = Vector2.Distance(entity.Center, Main.player[owner].Center);
			if (playerDistance < maxDistance && !CanHitWithMeleeWeapon(entity))
			{
				playerDistance = float.PositiveInfinity;
			}
			closerIsMe = myDistance < playerDistance;
			if (closerIsMe)
			{
				return myDistance <= maxDistance;
			}
			return playerDistance <= maxDistance;
		}

		private void AI_156_BatOfLight()
		{
			List<int> ai156_blacklistedTargets = _ai156_blacklistedTargets;
			Player player = Main.player[owner];
			bool num = type == 755;
			bool flag = type == 946;
			if (num)
			{
				if (player.dead)
				{
					player.batsOfLight = false;
				}
				if (player.batsOfLight)
				{
					timeLeft = 2;
				}
				DelegateMethods.v3_1 = AI_156_GetColor().ToVector3();
				Point point = base.Center.ToTileCoordinates();
				DelegateMethods.CastLightOpen(point.X, point.Y);
				if (++frameCounter >= 6)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type] - 1)
					{
						frame = 0;
					}
				}
				int num2 = player.direction;
				if (velocity.X != 0f)
				{
					num2 = Math.Sign(velocity.X);
				}
				spriteDirection = num2;
			}
			if (flag)
			{
				if (player.dead)
				{
					player.empressBlade = false;
				}
				if (player.empressBlade)
				{
					timeLeft = 2;
				}
				DelegateMethods.v3_1 = AI_156_GetColor().ToVector3();
				Point point2 = base.Center.ToTileCoordinates();
				DelegateMethods.CastLightOpen(point2.X, point2.Y);
			}
			ai156_blacklistedTargets.Clear();
			AI_156_Think(ai156_blacklistedTargets);
		}

		public Color AI_156_GetColor()
		{
			if (aiStyle != 156)
			{
				return Color.Transparent;
			}
			bool num = type == 755;
			_ = type;
			if (num)
			{
				return Color.Crimson;
			}
			return Color.Transparent;
		}

		private void AI_156_Think(List<int> blacklist)
		{
			bool flag = type == 755;
			bool flag2 = type == 946;
			int num = 60;
			int num2 = num - 1;
			int num3 = num + 60;
			int num4 = num3 - 1;
			int num5 = num + 1;
			if (flag)
			{
				num = 66;
			}
			if (flag2)
			{
				num = 40;
				num2 = num - 1;
				num3 = num + 40;
				num4 = num3 - 1;
				num5 = num + 1;
			}
			Player player = Main.player[owner];
			if (player.active && Vector2.Distance(player.Center, base.Center) > 2000f)
			{
				ai[0] = 0f;
				ai[1] = 0f;
				netUpdate = true;
			}
			if (ai[0] == -1f)
			{
				AI_GetMyGroupIndexAndFillBlackList(blacklist, out var index, out var totalIndexesInGroup);
				AI_156_GetIdlePosition(index, totalIndexesInGroup, out var idleSpot, out var idleRotation);
				velocity = Vector2.Zero;
				base.Center = base.Center.MoveTowards(idleSpot, 32f);
				rotation = rotation.AngleLerp(idleRotation, 0.2f);
				if (Distance(idleSpot) < 2f)
				{
					ai[0] = 0f;
					netUpdate = true;
				}
				return;
			}
			if (ai[0] == 0f)
			{
				if (flag)
				{
					AI_GetMyGroupIndexAndFillBlackList(blacklist, out var index2, out var totalIndexesInGroup2);
					AI_156_GetIdlePosition(index2, totalIndexesInGroup2, out var idleSpot2, out var _);
					velocity = Vector2.Zero;
					base.Center = Vector2.SmoothStep(base.Center, idleSpot2, 0.45f);
					if (Main.rand.Next(20) == 0)
					{
						int num6 = AI_156_TryAttackingNPCs(blacklist);
						if (num6 != -1)
						{
							AI_156_StartAttack();
							ai[0] = num;
							ai[1] = num6;
							netUpdate = true;
							return;
						}
					}
				}
				if (!flag2)
				{
					return;
				}
				AI_GetMyGroupIndexAndFillBlackList(blacklist, out var index3, out var totalIndexesInGroup3);
				AI_156_GetIdlePosition(index3, totalIndexesInGroup3, out var idleSpot3, out var idleRotation3);
				velocity = Vector2.Zero;
				base.Center = Vector2.SmoothStep(base.Center, idleSpot3, 0.45f);
				rotation = rotation.AngleLerp(idleRotation3, 0.45f);
				if (Main.rand.Next(20) == 0)
				{
					int num7 = AI_156_TryAttackingNPCs(blacklist);
					if (num7 != -1)
					{
						AI_156_StartAttack();
						ai[0] = Main.rand.NextFromList<int>(num, num3);
						ai[0] = num3;
						ai[1] = num7;
						netUpdate = true;
					}
				}
				return;
			}
			if (flag)
			{
				int num8 = (int)ai[1];
				if (!Main.npc.IndexInRange(num8))
				{
					ai[0] = 0f;
					netUpdate = true;
					return;
				}
				NPC nPC = Main.npc[num8];
				if (!nPC.CanBeChasedBy(this))
				{
					ai[0] = 0f;
					netUpdate = true;
					return;
				}
				ai[0] -= 1f;
				if (ai[0] >= (float)num2)
				{
					velocity *= 0.8f;
					if (ai[0] == (float)num2)
					{
						localAI[0] = base.Center.X;
						localAI[1] = base.Center.Y;
					}
					return;
				}
				float lerpValue = Utils.GetLerpValue(num2, 0f, ai[0], clamped: true);
				Vector2 vector = new Vector2(localAI[0], localAI[1]);
				if (lerpValue >= 0.5f)
				{
					vector = Main.player[owner].Center;
				}
				Vector2 center = nPC.Center;
				float num9 = (center - vector).ToRotation();
				float num10 = ((center.X > vector.X) ? (-MathF.PI) : MathF.PI);
				float num11 = num10 + (0f - num10) * lerpValue * 2f;
				Vector2 spinningpoint = num11.ToRotationVector2();
				spinningpoint.Y *= (float)Math.Sin((float)identity * 2.3f) * 0.5f;
				spinningpoint = spinningpoint.RotatedBy(num9);
				float num12 = (center - vector).Length() / 2f;
				Vector2 vector3 = (base.Center = Vector2.Lerp(vector, center, 0.5f) + spinningpoint * num12);
				Vector2 vector4 = (velocity = MathHelper.WrapAngle(num9 + num11 + 0f).ToRotationVector2() * 10f);
				position -= velocity;
				if (ai[0] == 0f)
				{
					int num13 = AI_156_TryAttackingNPCs(blacklist);
					if (num13 != -1)
					{
						ai[0] = num;
						ai[1] = num13;
						AI_156_StartAttack();
						netUpdate = true;
						return;
					}
					ai[1] = 0f;
					netUpdate = true;
				}
			}
			if (!flag2)
			{
				return;
			}
			bool skipBodyCheck = true;
			int num14 = 0;
			int num15 = num2;
			int num16 = 0;
			if (ai[0] >= (float)num5)
			{
				num14 = 1;
				num15 = num4;
				num16 = num5;
			}
			int num17 = (int)ai[1];
			if (!Main.npc.IndexInRange(num17))
			{
				int num18 = AI_156_TryAttackingNPCs(blacklist, skipBodyCheck);
				if (num18 != -1)
				{
					ai[0] = Main.rand.NextFromList<int>(num, num3);
					ai[1] = num18;
					AI_156_StartAttack();
					netUpdate = true;
				}
				else
				{
					ai[0] = -1f;
					ai[1] = 0f;
					netUpdate = true;
				}
				return;
			}
			NPC nPC2 = Main.npc[num17];
			if (!nPC2.CanBeChasedBy(this))
			{
				int num19 = AI_156_TryAttackingNPCs(blacklist, skipBodyCheck);
				if (num19 != -1)
				{
					ai[0] = Main.rand.NextFromList<int>(num, num3);
					AI_156_StartAttack();
					ai[1] = num19;
					netUpdate = true;
				}
				else
				{
					ai[0] = -1f;
					ai[1] = 0f;
					netUpdate = true;
				}
				return;
			}
			ai[0] -= 1f;
			if (ai[0] >= (float)num15)
			{
				direction = ((base.Center.X < nPC2.Center.X) ? 1 : (-1));
				if (ai[0] == (float)num15)
				{
					localAI[0] = base.Center.X;
					localAI[1] = base.Center.Y;
				}
			}
			float lerpValue2 = Utils.GetLerpValue(num15, num16, ai[0], clamped: true);
			if (num14 == 0)
			{
				Vector2 vector5 = new Vector2(localAI[0], localAI[1]);
				if (lerpValue2 >= 0.5f)
				{
					vector5 = Vector2.Lerp(nPC2.Center, Main.player[owner].Center, 0.5f);
				}
				Vector2 center2 = nPC2.Center;
				float num20 = (center2 - vector5).ToRotation();
				float num21 = ((direction == 1) ? (-MathF.PI) : MathF.PI);
				float num22 = num21 + (0f - num21) * lerpValue2 * 2f;
				Vector2 spinningpoint2 = num22.ToRotationVector2();
				spinningpoint2.Y *= 0.5f;
				spinningpoint2.Y *= 0.8f + (float)Math.Sin((float)identity * 2.3f) * 0.2f;
				spinningpoint2 = spinningpoint2.RotatedBy(num20);
				float num23 = (center2 - vector5).Length() / 2f;
				Vector2 vector7 = (base.Center = Vector2.Lerp(vector5, center2, 0.5f) + spinningpoint2 * num23);
				float num24 = MathHelper.WrapAngle(num20 + num22 + 0f);
				rotation = num24 + MathF.PI / 2f;
				Vector2 vector8 = (velocity = num24.ToRotationVector2() * 10f);
				position -= velocity;
			}
			if (num14 == 1)
			{
				Vector2 vector9 = new Vector2(localAI[0], localAI[1]);
				vector9 += new Vector2(0f, Utils.GetLerpValue(0f, 0.4f, lerpValue2, clamped: true) * -100f);
				Vector2 v = nPC2.Center - vector9;
				Vector2 vector10 = v.SafeNormalize(Vector2.Zero) * MathHelper.Clamp(v.Length(), 60f, 150f);
				Vector2 value = nPC2.Center + vector10;
				float lerpValue3 = Utils.GetLerpValue(0.4f, 0.6f, lerpValue2, clamped: true);
				float lerpValue4 = Utils.GetLerpValue(0.6f, 1f, lerpValue2, clamped: true);
				float targetAngle = v.SafeNormalize(Vector2.Zero).ToRotation() + MathF.PI / 2f;
				rotation = rotation.AngleTowards(targetAngle, MathF.PI / 5f);
				base.Center = Vector2.Lerp(vector9, nPC2.Center, lerpValue3);
				if (lerpValue4 > 0f)
				{
					base.Center = Vector2.Lerp(nPC2.Center, value, lerpValue4);
				}
			}
			if (ai[0] == (float)num16)
			{
				int num25 = AI_156_TryAttackingNPCs(blacklist, skipBodyCheck);
				if (num25 != -1)
				{
					ai[0] = Main.rand.NextFromList<int>(num, num3);
					ai[1] = num25;
					AI_156_StartAttack();
					netUpdate = true;
				}
				else
				{
					ai[0] = -1f;
					ai[1] = 0f;
					netUpdate = true;
				}
			}
		}

		private void AI_156_StartAttack()
		{
			for (int i = 0; i < localNPCImmunity.Length; i++)
			{
				localNPCImmunity[i] = 0;
			}
		}

		private int AI_156_TryAttackingNPCs(List<int> blackListedTargets, bool skipBodyCheck = false)
		{
			Vector2 center = Main.player[owner].Center;
			int result = -1;
			float num = -1f;
			NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
			if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
			{
				bool flag = true;
				if (!ownerMinionAttackTargetNPC.boss && blackListedTargets.Contains(ownerMinionAttackTargetNPC.whoAmI))
				{
					flag = false;
				}
				if (ownerMinionAttackTargetNPC.Distance(center) > 1000f)
				{
					flag = false;
				}
				if (!skipBodyCheck && !CanHitWithOwnBody(ownerMinionAttackTargetNPC))
				{
					flag = false;
				}
				if (flag)
				{
					return ownerMinionAttackTargetNPC.whoAmI;
				}
			}
			for (int i = 0; i < 200; i++)
			{
				NPC nPC = Main.npc[i];
				if (nPC.CanBeChasedBy(this) && (nPC.boss || !blackListedTargets.Contains(i)))
				{
					float num2 = nPC.Distance(center);
					if (!(num2 > 1000f) && (!(num2 > num) || num == -1f) && (skipBodyCheck || CanHitWithOwnBody(nPC)))
					{
						num = num2;
						result = i;
					}
				}
			}
			return result;
		}

		private void AI_GetMyGroupIndexAndFillBlackList(List<int> blackListedTargets, out int index, out int totalIndexesInGroup)
		{
			index = 0;
			totalIndexesInGroup = 0;
			for (int i = 0; i < 1000; i++)
			{
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.owner == owner && projectile.type == type && (projectile.type != 759 || projectile.frame == Main.projFrames[projectile.type] - 1))
				{
					if (whoAmI > i)
					{
						index++;
					}
					totalIndexesInGroup++;
				}
			}
		}

		private void AI_156_GetIdlePosition(int stackedIndex, int totalIndexes, out Vector2 idleSpot, out float idleRotation)
		{
			Player player = Main.player[owner];
			bool num = type == 755;
			bool flag = type == 946;
			idleRotation = 0f;
			idleSpot = Vector2.Zero;
			if (num)
			{
				float num2 = ((float)totalIndexes - 1f) / 2f;
				idleSpot = player.Center + -Vector2.UnitY.RotatedBy(4.3982296f / (float)totalIndexes * ((float)stackedIndex - num2)) * 40f;
				idleRotation = 0f;
			}
			if (flag)
			{
				int num3 = stackedIndex + 1;
				idleRotation = (float)num3 * (MathF.PI * 2f) * (1f / 60f) * (float)player.direction + MathF.PI / 2f;
				idleRotation = MathHelper.WrapAngle(idleRotation);
				int num4 = num3 % totalIndexes;
				Vector2 vector = new Vector2(0f, 0.5f).RotatedBy((player.miscCounterNormalized * (2f + (float)num4) + (float)num4 * 0.5f + (float)player.direction * 1.3f) * (MathF.PI * 2f)) * 4f;
				idleSpot = idleRotation.ToRotationVector2() * 10f + player.MountedCenter + new Vector2(player.direction * (num3 * -6 - 16), player.gravDir * -15f);
				idleSpot += vector;
				idleRotation += MathF.PI / 2f;
			}
		}

		private void AI_155_MysticSnakeCoil()
		{
			if (Main.netMode != 1 && !Main.player[owner].active)
			{
				float num = ai[0];
				float y = position.Y;
				Point point = base.Center.ToTileCoordinates();
				Point end = new Point(point.X, (int)y / 16);
				Point start = new Point(point.X, (int)num / 16);
				AI_155_RemoveRope(start, end);
				Kill();
				return;
			}
			int num2 = 100;
			int num3 = 1800;
			if (ai[1] == 0f)
			{
				spriteDirection = ((!(Main.player[owner].Center.X > base.Center.X)) ? 1 : (-1));
				ai[1] = 1f;
				velocity.Y = -5f;
			}
			if (ai[1] == 1f)
			{
				localAI[1] += 1f;
				float num4 = Utils.Remap(localAI[1], 15f, 30f, 0f, 1f);
				int num5 = ((localAI[1] >= 60f) ? 1 : 0);
				velocity.Y = -3f * (1f - num4) + (float)(-32 * num5);
				velocity.Y = (int)velocity.Y;
				if (localAI[1] == 60f)
				{
					for (int i = 0; i < 30; i++)
					{
						Dust dust = Dust.NewDustDirect(base.TopLeft + new Vector2(-6f, 0f), 24, 16, 27, 0f, 0f, 150, Color.Transparent, 0.6f);
						dust.velocity *= 1f;
						dust.velocity.X *= 0.5f;
						dust.velocity.Y = -3f;
						dust.fadeIn = 1.2f;
						dust.noGravity = true;
						dust.position.X += Main.rand.NextFloatDirection() * 8f;
						dust.velocity = new Vector2(0f, -1f).RotatedBy(MathF.PI / 4f * Main.rand.NextFloatDirection() * 0f) * (Main.rand.NextFloatDirection() * 9f);
						if (dust.velocity.Y < 0f)
						{
							dust.velocity.Y *= 1f + Main.rand.NextFloat() * 3f;
						}
					}
				}
				bool flag = num4 > 0f && num5 <= 0;
				if ((Main.rand.Next(6) == 0 || num5 > 0) && !flag)
				{
					Dust dust2 = Dust.NewDustDirect(base.TopLeft + new Vector2(-6f, 0f), 24, 16, 27, 0f, 0f, 150, Color.Transparent, 0.6f);
					dust2.velocity *= 1f;
					dust2.velocity.X *= 0.5f;
					dust2.velocity.Y = -3f;
					dust2.fadeIn = 1.2f;
					dust2.noGravity = true;
				}
				alpha = Utils.Clamp(alpha - 5, 0, 255);
				if (++frameCounter >= 12)
				{
					frameCounter = 0;
					if (++frame >= 4)
					{
						frame = 0;
					}
				}
				if (Main.myPlayer == owner)
				{
					float num6 = ai[0];
					float y2 = position.Y;
					Point point2 = base.Center.ToTileCoordinates();
					Point point3 = new Point(point2.X, (int)y2 / 16);
					Point point4 = new Point(point2.X, (int)num6 / 16);
					bool flag2 = point4.Y - point3.Y >= num2;
					int x = point4.X;
					if (!WorldGen.InWorld(x, point3.Y, 40) || !WorldGen.InWorld(x, point4.Y, 40))
					{
						flag2 = true;
					}
					if (!flag2)
					{
						for (int num7 = point4.Y; num7 >= point3.Y; num7--)
						{
							if (Main.tile[x, num7].active() && !Main.tileCut[Main.tile[x, num7].type] && Main.tile[x, num7].type != 504)
							{
								flag2 = true;
								break;
							}
						}
					}
					if (flag2)
					{
						int num8 = 0;
						for (int num9 = point4.Y; num9 > point3.Y; num9--)
						{
							if ((WorldGen.TileEmpty(x, num9) || Main.tileCut[Main.tile[x, num9].type]) && WorldGen.PlaceTile(x, num9, 504, mute: false, forced: false, owner))
							{
								num8++;
								if (Main.netMode == 1)
								{
									NetMessage.SendData(17, -1, -1, null, 1, x, num9, 504f);
								}
							}
						}
						timeLeft = num3;
						ai[1] = 2f;
						netUpdate = true;
						base.Top = new Vector2(x * 16 + 8, point3.Y * 16 + 16);
						velocity = Vector2.Zero;
					}
				}
			}
			if (ai[1] != 2f)
			{
				return;
			}
			alpha = 0;
			_ = timeLeft;
			float num10 = ai[0];
			float y3 = position.Y;
			Point point5 = base.Center.ToTileCoordinates();
			Point end2 = new Point(point5.X, (int)y3 / 16);
			Point start2 = new Point(point5.X, (int)num10 / 16);
			int x2 = start2.X;
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				for (int num11 = start2.Y; num11 >= end2.Y; num11--)
				{
					Tile tile = Main.tile[x2, num11];
					if (tile.active() && tile.type == 504)
					{
						AI_155_SpawnRopeIn(x2, num11);
					}
				}
			}
			else
			{
				for (int num12 = start2.Y; num12 >= end2.Y; num12--)
				{
					Tile tile2 = Main.tile[x2, num12];
					if (tile2.active() && tile2.type == 504 && Main.rand.Next(80) == 0)
					{
						Dust dust3 = Dust.NewDustDirect(new Vector2(x2 * 16 - 6, num12 * 16), 28, 16, 27, 0f, 0f, 150, Color.Transparent, 0.6f);
						dust3.velocity *= 1f;
						dust3.velocity.X = 0f;
						dust3.fadeIn = 1.2f;
						dust3.noGravity = true;
					}
				}
			}
			if (timeLeft == 4)
			{
				for (int num13 = start2.Y; num13 >= end2.Y; num13--)
				{
					Tile tile3 = Main.tile[x2, num13];
					if (tile3.active() && tile3.type == 504)
					{
						AI_155_SpawnRopeIn(x2, num13);
					}
				}
			}
			if (timeLeft > 4)
			{
				return;
			}
			if (!WorldGen.InWorld(x2, end2.Y, 20) || !WorldGen.InWorld(x2, start2.Y, 20))
			{
				Kill();
				return;
			}
			if (Main.myPlayer == owner)
			{
				AI_155_RemoveRope(start2, end2);
			}
			Kill();
		}

		private void AI_155_RemoveRope(Point start, Point end)
		{
			int x = start.X;
			for (int num = start.Y; num >= end.Y; num--)
			{
				Tile tile = Main.tile[x, num];
				if (tile.active() && tile.type == 504)
				{
					WorldGen.KillTile(x, num);
					if (Main.netMode != 0)
					{
						NetMessage.SendData(17, -1, -1, null, 0, x, num);
					}
				}
			}
		}

		private void AI_155_SpawnRopeIn(int x, int y)
		{
			Vector2 vector = new Vector2(x * 16 + 8, y * 16 + 8);
			if (Main.rand.Next(4) != 0)
			{
				Gore gore = Gore.NewGoreDirect(vector, Vector2.Zero, Main.rand.Next(61, 64));
				gore.velocity = Main.rand.NextVector2Circular(1.5f, 0.8f);
				gore.velocity.X += 0.1f * (float)((gore.velocity.X > 0f) ? 1 : (-1));
				gore.position = vector - new Vector2(16f, 16f);
				gore.alpha = 170;
			}
			for (int i = 0; i < 5; i++)
			{
				if (Main.rand.Next(8) == 0)
				{
					Dust.NewDustDirect(vector + new Vector2(-8f), 16, 16, 31, 0f, 0f, 100, Color.Transparent).velocity *= 0.4f;
				}
				Dust dust = Dust.NewDustDirect(vector + new Vector2(-8f), 16, 16, 27, 0f, 0f, 100, Color.Transparent, 1.7f);
				dust.velocity *= 2f;
				dust.noGravity = true;
			}
		}

		private void AI_154_VoidLens()
		{
			Main.CurrentFrameFlags.HadAnActiveInteractibleProjectile = true;
			if (owner == Main.myPlayer)
			{
				for (int i = 0; i < 1000; i++)
				{
					if (i == whoAmI)
					{
						continue;
					}
					Projectile projectile = Main.projectile[i];
					if (projectile.active && projectile.owner == owner && projectile.type == type)
					{
						if (timeLeft < Main.projectile[i].timeLeft)
						{
							Kill();
							return;
						}
						Main.projectile[i].Kill();
					}
				}
			}
			velocity *= 0.94f;
			direction = 1;
			if (++frameCounter >= 5)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			if (Opacity < 1f)
			{
				Opacity += 0.03f;
				if (Opacity > 1f)
				{
					Opacity = 1f;
				}
			}
			new VoidLensHelper(this).Update();
		}

		private void AI_153_ToiletPop()
		{
			Vector2 center = base.Center;
			float speedY = -2f;
			int num = 0;
			int num2 = 0;
			if (ai[0] == 0f)
			{
				num = 6;
				num2 = 1;
			}
			else
			{
				if (!(ai[0] <= 10f))
				{
					Kill();
					return;
				}
				if (Main.rand.Next(5) == 0)
				{
					num2 = 1;
				}
				num = 2;
			}
			ai[0] += 1f;
			for (int i = 0; i < num; i++)
			{
				Dust dust = Dust.NewDustDirect(center, 3, 6, 216, 0f, speedY);
				dust.velocity.X *= 0.5f;
				dust.velocity.Y = 0f - Math.Abs(dust.velocity.Y);
				dust.position -= dust.velocity;
				dust.scale = 0.8f;
			}
			for (int j = 0; j < num2; j++)
			{
				Gore gore = Gore.NewGoreDirect(center, Vector2.UnitY * -3f + Main.rand.NextVector2Circular(1f, 1f), Main.rand.Next(580, 583));
				gore.velocity.Y = 0f - Math.Abs(gore.velocity.Y);
			}
		}

		private void AI_150_GolfClubHelper()
		{
			Player player = Main.player[owner];
			if (!player.active)
			{
				Kill();
				return;
			}
			if (player.gravDir == -1f)
			{
				player.SetDummyItemTime(0);
				Kill();
				return;
			}
			bool flag = false;
			Rectangle rectangle = Utils.CenteredRectangle(player.Center, new Vector2(500f, 500f));
			for (int i = 0; i < 1000; i++)
			{
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.owner == Main.myPlayer && ProjectileID.Sets.IsAGolfBall[projectile.type] && rectangle.Contains(projectile.Center.ToPoint()))
				{
					flag = true;
					break;
				}
			}
			if (!flag && owner == Main.myPlayer && ai[0] == 0f)
			{
				player.TryPlacingAGolfBallNearANearbyTee(Main.player[owner].Center);
			}
			if (!player.channel && ai[0] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item1, player.Center);
				for (int j = 0; j < 1000; j++)
				{
					Projectile projectile2 = Main.projectile[j];
					Vector2 shotVector = Main.MouseWorld - projectile2.Center;
					if (!projectile2.active || !ProjectileID.Sets.IsAGolfBall[projectile2.type] || projectile2.owner != owner || !GolfHelper.ValidateShot(projectile2, player, ref shotVector))
					{
						continue;
					}
					float num = Main.rand.NextFloatDirection();
					for (float num2 = 0f; num2 < 1f; num2 += 0.1f)
					{
						Dust dust = Dust.NewDustPerfect(projectile2.Center, 31, (MathF.PI * 2f * num2 + num).ToRotationVector2() * 0.8f, 127);
						dust.fadeIn = 0f;
						if (num2 % 0.2f == 0f)
						{
							dust.velocity *= 0.4f;
						}
					}
					SoundEngine.PlaySound(SoundID.Item126, projectile2.Center);
					if (owner == Main.myPlayer)
					{
						GolfHelper.ShotStrength shotStrength = GolfHelper.CalculateShotStrength(this, projectile2);
						Vector2 vector = Vector2.Normalize(shotVector) * shotStrength.AbsoluteStrength;
						GolfHelper.HitGolfBall(projectile2, vector, shotStrength.RoughLandResistance);
						NetMessage.SendData(27, -1, -1, null, j);
					}
				}
				ai[0] = 1f;
				ai[1] = 0f;
				netUpdate = true;
			}
			if (ai[0] == 1f)
			{
				ai[1] += 1f;
				float num3 = player.HeldItem.useAnimation + 30;
				if (ai[1] >= num3)
				{
					Kill();
					return;
				}
				velocity = Vector2.Zero;
				player.ChangeDir(direction);
				player.heldProj = whoAmI;
				int num4 = player.HeldItem.useAnimation - (int)ai[1];
				if (num4 < 2)
				{
					num4 = 2;
				}
				player.SetDummyItemTime(num4);
			}
			if (ai[0] != 0f)
			{
				return;
			}
			if (owner == Main.myPlayer)
			{
				Vector2 mouseWorld = Main.MouseWorld;
				if (mouseWorld != base.Center)
				{
					netUpdate = true;
					base.Center = mouseWorld;
				}
				if (Main.mouseRight && Main.mouseRightRelease)
				{
					Kill();
					player.mouseInterface = true;
					Main.blockMouse = true;
					player.SetItemTime(0);
					player.itemAnimation = 0;
					player.itemAnimationMax = 0;
					player.reuseDelay = 0;
					return;
				}
			}
			if (position != oldPosition)
			{
				if (base.Center.X - player.Center.X > 0f)
				{
					direction = 1;
				}
				else
				{
					direction = -1;
				}
			}
			velocity = Vector2.Zero;
			player.ChangeDir(direction);
			player.heldProj = whoAmI;
			ai[1] += 1f;
			int num5 = player.HeldItem.useAnimation * 4;
			if (ai[1] > (float)(num5 * 3))
			{
				ai[1] = num5;
			}
			int num6 = player.HeldItem.useAnimation + Math.Min(num5, (int)ai[1]);
			if (num6 < 2)
			{
				num6 = 2;
			}
			player.SetDummyItemTime(num6);
		}

		public Color GetCeleb2Color()
		{
			return (int)ai[0] switch
			{
				0 => Color.Red, 
				1 => Color.DarkOrange, 
				2 => Color.Gold, 
				3 => Color.LimeGreen, 
				4 => Color.RoyalBlue, 
				5 => new Color(80, 20, 180), 
				6 => Color.HotPink, 
				_ => Color.Transparent, 
			};
		}

		private void AI_007_GrapplingHooks()
		{
			if (Main.player[owner].dead || Main.player[owner].stoned || Main.player[owner].webbed || Main.player[owner].frozen)
			{
				Kill();
				return;
			}
			Vector2 mountedCenter = Main.player[owner].MountedCenter;
			Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num = mountedCenter.X - vector.X;
			float num2 = mountedCenter.Y - vector.Y;
			float num3 = (float)Math.Sqrt(num * num + num2 * num2);
			rotation = (float)Math.Atan2(num2, num) - 1.57f;
			if (ai[0] == 2f && type == 865)
			{
				float num4 = MathF.PI / 2f;
				int num5 = (int)Math.Round(rotation / num4);
				rotation = (float)num5 * num4;
			}
			if (Main.myPlayer == owner)
			{
				int num6 = (int)(base.Center.X / 16f);
				int num7 = (int)(base.Center.Y / 16f);
				if (num6 > 0 && num7 > 0 && num6 < Main.maxTilesX && num7 < Main.maxTilesY && Main.tile[num6, num7].nactive() && TileID.Sets.CrackedBricks[Main.tile[num6, num7].type] && Main.rand.Next(16) == 0)
				{
					WorldGen.KillTile(num6, num7);
					if (Main.netMode != 0)
					{
						NetMessage.SendData(17, -1, -1, null, 20, num6, num7);
					}
				}
			}
			if (num3 > 2500f)
			{
				Kill();
			}
			if (type == 256)
			{
				rotation = (float)Math.Atan2(num2, num) + 3.9250002f;
			}
			if (type == 446)
			{
				Lighting.AddLight(mountedCenter, 0f, 0.4f, 0.3f);
				localAI[0] += 1f;
				if (localAI[0] >= 28f)
				{
					localAI[0] = 0f;
				}
				DelegateMethods.v3_1 = new Vector3(0f, 0.4f, 0.3f);
				Utils.PlotTileLine(base.Center, mountedCenter, 8f, DelegateMethods.CastLightOpen);
			}
			if (type == 652 && ++frameCounter >= 7)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			if (type >= 646 && type <= 649)
			{
				Vector3 vector2 = Vector3.Zero;
				switch (type)
				{
				case 646:
					vector2 = new Vector3(0.7f, 0.5f, 0.1f);
					break;
				case 647:
					vector2 = new Vector3(0f, 0.6f, 0.7f);
					break;
				case 648:
					vector2 = new Vector3(0.6f, 0.2f, 0.6f);
					break;
				case 649:
					vector2 = new Vector3(0.6f, 0.6f, 0.9f);
					break;
				}
				Lighting.AddLight(mountedCenter, vector2);
				Lighting.AddLight(base.Center, vector2);
				DelegateMethods.v3_1 = vector2;
				Utils.PlotTileLine(base.Center, mountedCenter, 8f, DelegateMethods.CastLightOpen);
			}
			if (ai[0] == 0f)
			{
				if ((num3 > 300f && type == 13) || (num3 > 400f && type == 32) || (num3 > 440f && type == 73) || (num3 > 440f && type == 74) || (num3 > 375f && type == 165) || (num3 > 350f && type == 256) || (num3 > 500f && type == 315) || (num3 > 550f && type == 322) || (num3 > 400f && type == 331) || (num3 > 550f && type == 332) || (num3 > 400f && type == 372) || (num3 > 300f && type == 396) || (num3 > 550f && type >= 646 && type <= 649) || (num3 > 600f && type == 652) || (num3 > 300f && type == 865) || (num3 > 500f && type == 935) || (num3 > 480f && type >= 486 && type <= 489) || (num3 > 500f && type == 446))
				{
					ai[0] = 1f;
				}
				else if (type >= 230 && type <= 235)
				{
					int num8 = 300 + (type - 230) * 30;
					if (num3 > (float)num8)
					{
						ai[0] = 1f;
					}
				}
				else if (type == 753)
				{
					int num9 = 420;
					if (num3 > (float)num9)
					{
						ai[0] = 1f;
					}
				}
				Vector2 vector3 = base.Center - new Vector2(5f);
				Vector2 vector4 = base.Center + new Vector2(5f);
				Point point = (vector3 - new Vector2(16f)).ToTileCoordinates();
				Point point2 = (vector4 + new Vector2(32f)).ToTileCoordinates();
				int num10 = point.X;
				int num11 = point2.X;
				int num12 = point.Y;
				int num13 = point2.Y;
				if (num10 < 0)
				{
					num10 = 0;
				}
				if (num11 > Main.maxTilesX)
				{
					num11 = Main.maxTilesX;
				}
				if (num12 < 0)
				{
					num12 = 0;
				}
				if (num13 > Main.maxTilesY)
				{
					num13 = Main.maxTilesY;
				}
				Player player = Main.player[owner];
				List<Point> list = new List<Point>();
				for (int i = 0; i < player.grapCount; i++)
				{
					Projectile projectile = Main.projectile[player.grappling[i]];
					if (projectile.aiStyle != 7 || projectile.ai[0] != 2f)
					{
						continue;
					}
					Point pt = projectile.Center.ToTileCoordinates();
					Tile tileSafely = Framing.GetTileSafely(pt);
					if (tileSafely.type != 314 && !TileID.Sets.Platforms[tileSafely.type])
					{
						continue;
					}
					for (int j = -2; j <= 2; j++)
					{
						for (int k = -2; k <= 2; k++)
						{
							Point point3 = new Point(pt.X + j, pt.Y + k);
							Tile tileSafely2 = Framing.GetTileSafely(point3);
							if (tileSafely2.type == 314 || TileID.Sets.Platforms[tileSafely2.type])
							{
								list.Add(point3);
							}
						}
					}
				}
				Vector2 vector5 = default(Vector2);
				for (int l = num10; l < num11; l++)
				{
					for (int m = num12; m < num13; m++)
					{
						if (Main.tile[l, m] == null)
						{
							Main.tile[l, m] = new Tile();
						}
						vector5.X = l * 16;
						vector5.Y = m * 16;
						if (!(vector3.X + 10f > vector5.X) || !(vector3.X < vector5.X + 16f) || !(vector3.Y + 10f > vector5.Y) || !(vector3.Y < vector5.Y + 16f))
						{
							continue;
						}
						Tile tile = Main.tile[l, m];
						if (!tile.nactive() || !AI_007_GrapplingHooks_CanTileBeLatchedOnTo(tile) || list.Contains(new Point(l, m)) || (type == 403 && tile.type != 314) || Main.player[owner].IsBlacklistedForGrappling(new Point(l, m)))
						{
							continue;
						}
						if (Main.player[owner].grapCount < 10)
						{
							Main.player[owner].grappling[Main.player[owner].grapCount] = whoAmI;
							Main.player[owner].grapCount++;
						}
						if (Main.myPlayer != owner)
						{
							continue;
						}
						int num14 = 0;
						int num15 = -1;
						int num16 = 100000;
						if (type == 73 || type == 74)
						{
							for (int n = 0; n < 1000; n++)
							{
								if (n != whoAmI && Main.projectile[n].active && Main.projectile[n].owner == owner && Main.projectile[n].aiStyle == 7 && Main.projectile[n].ai[0] == 2f)
								{
									Main.projectile[n].Kill();
								}
							}
						}
						else
						{
							int num17 = 3;
							if (type == 165)
							{
								num17 = 8;
							}
							if (type == 256)
							{
								num17 = 2;
							}
							if (type == 372)
							{
								num17 = 2;
							}
							if (type == 652)
							{
								num17 = 1;
							}
							if (type >= 646 && type <= 649)
							{
								num17 = 4;
							}
							for (int num18 = 0; num18 < 1000; num18++)
							{
								if (Main.projectile[num18].active && Main.projectile[num18].owner == owner && Main.projectile[num18].aiStyle == 7)
								{
									if (Main.projectile[num18].timeLeft < num16)
									{
										num15 = num18;
										num16 = Main.projectile[num18].timeLeft;
									}
									num14++;
								}
							}
							if (num14 > num17)
							{
								Main.projectile[num15].Kill();
							}
						}
						WorldGen.KillTile(l, m, fail: true, effectOnly: true);
						SoundEngine.PlaySound(0, l * 16, m * 16);
						velocity.X = 0f;
						velocity.Y = 0f;
						ai[0] = 2f;
						position.X = l * 16 + 8 - width / 2;
						position.Y = m * 16 + 8 - height / 2;
						Rectangle? tileVisualHitbox = WorldGen.GetTileVisualHitbox(l, m);
						if (tileVisualHitbox.HasValue)
						{
							base.Center = tileVisualHitbox.Value.Center.ToVector2();
						}
						damage = 0;
						netUpdate = true;
						if (Main.myPlayer == owner)
						{
							if (type == 935)
							{
								Main.player[owner].DoQueenSlimeHookTeleport(base.Center);
							}
							NetMessage.SendData(13, -1, -1, null, owner);
						}
						break;
					}
					if (ai[0] == 2f)
					{
						break;
					}
				}
			}
			else if (ai[0] == 1f)
			{
				float num19 = 11f;
				if (type == 32)
				{
					num19 = 15f;
				}
				if (type == 73 || type == 74)
				{
					num19 = 17f;
				}
				if (type == 315)
				{
					num19 = 20f;
				}
				if (type == 322)
				{
					num19 = 22f;
				}
				if (type >= 230 && type <= 235)
				{
					num19 = 11f + (float)(type - 230) * 0.75f;
				}
				if (type == 753)
				{
					num19 = 15f;
				}
				if (type == 446)
				{
					num19 = 20f;
				}
				if (type >= 486 && type <= 489)
				{
					num19 = 18f;
				}
				if (type >= 646 && type <= 649)
				{
					num19 = 24f;
				}
				if (type == 652)
				{
					num19 = 24f;
				}
				if (type == 332)
				{
					num19 = 17f;
				}
				if (num3 < 24f)
				{
					Kill();
				}
				num3 = num19 / num3;
				num *= num3;
				num2 *= num3;
				velocity.X = num;
				velocity.Y = num2;
			}
			else if (ai[0] == 2f)
			{
				Point point4 = base.Center.ToTileCoordinates();
				if (Main.tile[point4.X, point4.Y] == null)
				{
					Main.tile[point4.X, point4.Y] = new Tile();
				}
				bool flag = true;
				if (Main.tile[point4.X, point4.Y].nactive() && AI_007_GrapplingHooks_CanTileBeLatchedOnTo(Main.tile[point4.X, point4.Y]))
				{
					flag = false;
				}
				if (flag)
				{
					ai[0] = 1f;
				}
				else if (Main.player[owner].grapCount < 10)
				{
					Main.player[owner].grappling[Main.player[owner].grapCount] = whoAmI;
					Main.player[owner].grapCount++;
				}
			}
		}

		private bool AI_007_GrapplingHooks_CanTileBeLatchedOnTo(Tile theTile)
		{
			return Main.tileSolid[theTile.type] | (theTile.type == 314) | (type == 865 && TileID.Sets.IsATreeTrunk[theTile.type]) | (type == 865 && theTile.type == 323);
		}

		private void AI_147_Celeb2Rocket()
		{
			int num = 0;
			int num2 = 1;
			int num3 = 1;
			localAI[num] += 1f;
			alpha = 0;
			rotation = velocity.ToRotation() + MathF.PI / 2f;
			int num4 = (int)ai[0];
			Lighting.AddLight(base.Center, GetCeleb2Color().ToVector3() * 0.5f);
			switch (num4)
			{
			case 0:
				if (localAI[num] >= 20f)
				{
					velocity.Y += 0.12f;
					penetrate = (maxPenetrate = -1);
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				if (localAI[num] > 20f && localAI[num] % 20f == 0f)
				{
					AI_147_Explosion();
				}
				break;
			case 1:
			{
				if (localAI[num] == 10f)
				{
					velocity.Y -= 10f;
				}
				if (localAI[num] >= 10f)
				{
					velocity.Y += 0.25f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				if (!(localAI[num] >= 10f))
				{
					break;
				}
				scale += 0.015f;
				if (scale > 2.5f)
				{
					scale = 2.5f;
				}
				if (localAI[num] % 10f != 0f)
				{
					break;
				}
				_ = velocity.Y;
				_ = 0f;
				for (float num5 = 0f; num5 < 1f; num5 += 0.12f)
				{
					Vector2 spinningpoint = Vector2.UnitX * -8f;
					spinningpoint += -Vector2.UnitY.RotatedBy(num5 * (MathF.PI * 2f)) * new Vector2(2f, 4f);
					spinningpoint = spinningpoint.RotatedBy(rotation - MathF.PI / 2f);
					int num6 = Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 0, Color.Lerp(GetCeleb2Color(), Color.White, Main.rand.NextFloat() * 0.3f));
					Main.dust[num6].scale = 0.9f;
					Main.dust[num6].fadeIn = 1.1f;
					Main.dust[num6].noGravity = true;
					Main.dust[num6].position = base.Center + spinningpoint;
					Main.dust[num6].velocity = -velocity * 0.35f + spinningpoint * 0.35f;
					Main.dust[num6].velocity *= scale;
					if (localAI[num] == 10f)
					{
						Main.dust[num6].velocity = spinningpoint.RotatedBy(velocity.ToRotation()) * 0.3f;
					}
				}
				break;
			}
			case 2:
				if (localAI[num] >= 60f)
				{
					velocity.Y += 0.15f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				break;
			case 3:
			{
				float num7 = localAI[num2];
				if (num7 == 0f)
				{
					float num8 = velocity.Length();
					localAI[num2] = num8;
					num7 = num8;
				}
				if (localAI[num] >= 25f && ai[num3] == 0f)
				{
					if (localAI[num] >= 20f)
					{
						velocity.Y += 0.15f;
					}
					if (velocity.Y > 16f)
					{
						velocity.Y = 16f;
					}
				}
				if (!(localAI[num] >= 20f))
				{
					break;
				}
				float num9 = position.X;
				float num10 = position.Y;
				float num11 = 800f;
				bool flag = false;
				int num12 = 0;
				if (ai[num3] == 0f)
				{
					for (int i = 0; i < 200; i++)
					{
						if (Main.npc[i].CanBeChasedBy(this) && (ai[num3] == 0f || ai[num3] == (float)(i + 1)))
						{
							float num13 = Main.npc[i].position.X + (float)(Main.npc[i].width / 2);
							float num14 = Main.npc[i].position.Y + (float)(Main.npc[i].height / 2);
							float num15 = Math.Abs(position.X + (float)(width / 2) - num13) + Math.Abs(position.Y + (float)(height / 2) - num14);
							if (num15 < num11 && Collision.CanHit(new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2)), 1, 1, Main.npc[i].position, Main.npc[i].width, Main.npc[i].height))
							{
								num11 = num15;
								num9 = num13;
								num10 = num14;
								flag = true;
								num12 = i;
							}
						}
					}
					if (flag)
					{
						ai[1] = num12 + 1;
					}
					flag = false;
				}
				if (ai[num3] != 0f)
				{
					int num16 = (int)(ai[num3] - 1f);
					if (Main.npc[num16].active && Main.npc[num16].CanBeChasedBy(this, ignoreDontTakeDamage: true))
					{
						float num17 = Main.npc[num16].position.X + (float)(Main.npc[num16].width / 2);
						float num18 = Main.npc[num16].position.Y + (float)(Main.npc[num16].height / 2);
						if (Math.Abs(position.X + (float)(width / 2) - num17) + Math.Abs(position.Y + (float)(height / 2) - num18) < 1000f)
						{
							flag = true;
							num9 = Main.npc[num16].position.X + (float)(Main.npc[num16].width / 2);
							num10 = Main.npc[num16].position.Y + (float)(Main.npc[num16].height / 2);
						}
					}
				}
				if (!friendly)
				{
					flag = false;
				}
				if (flag)
				{
					float num19 = num7;
					Vector2 vector2 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num20 = num9 - vector2.X;
					float num21 = num10 - vector2.Y;
					float num22 = (float)Math.Sqrt(num20 * num20 + num21 * num21);
					num22 = num19 / num22;
					num20 *= num22;
					num21 *= num22;
					int num23 = 8;
					velocity.X = (velocity.X * (float)(num23 - 1) + num20) / (float)num23;
					velocity.Y = (velocity.Y * (float)(num23 - 1) + num21) / (float)num23;
				}
				break;
			}
			case 4:
			{
				if (localAI[num] == 1f && ai[1] == 1f)
				{
					localAI[num] += 45f;
				}
				float x = velocity.SafeNormalize(Vector2.Zero).RotatedBy(localAI[num] * (MathF.PI / 45f)).X;
				Vector2 vector = velocity.SafeNormalize(Vector2.Zero).RotatedBy(1.5707963705062866);
				position += vector * x * 3f;
				scale = 2f;
				if (localAI[num] >= 10f)
				{
					velocity.Y += 0.04f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				break;
			}
			case 5:
				if (localAI[num] >= 40f)
				{
					velocity.Y += 0.08f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				break;
			case 6:
				if (localAI[num] >= 30f)
				{
					velocity.Y += 0.1f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
				break;
			}
		}

		private void AI_148_StarSpawner()
		{
			if (Main.dayTime && !Main.remixWorld)
			{
				Kill();
				return;
			}
			ai[0] += Main.dayRate;
			if (localAI[0] == 0f && Main.netMode != 2)
			{
				localAI[0] = 1f;
				if ((double)Main.LocalPlayer.position.Y < Main.worldSurface * 16.0)
				{
					Star.StarFall(position.X);
				}
			}
			if (owner != Main.myPlayer || !(ai[0] >= 180f))
			{
				return;
			}
			if (ai[1] > -1f)
			{
				velocity.X *= 0.35f;
				if (base.Center.X < Main.player[(int)ai[1]].Center.X)
				{
					velocity.X = Math.Abs(velocity.X);
				}
				else
				{
					velocity.X = 0f - Math.Abs(velocity.X);
				}
			}
			NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, velocity.X, velocity.Y, 12, 1000, 10f, Main.myPlayer);
			Kill();
		}

		private void AI_147_Explosion()
		{
			switch ((int)ai[0])
			{
			case 0:
			{
				for (int k = 0; k < 4; k++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				for (int l = 0; l < 20; l++)
				{
					int num5 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 130, 0f, 0f, 200, default(Color), 1.2f);
					Main.dust[num5].noGravity = true;
					Main.dust[num5].velocity *= 3f;
					num5 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 130, 0f, 0f, 200, default(Color), 0.5f);
					Main.dust[num5].velocity *= 1.2f;
					Main.dust[num5].noGravity = true;
				}
				for (int m = 0; m < 1; m++)
				{
					int num6 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num6].velocity *= 0.3f;
					Main.gore[num6].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num6].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				break;
			}
			case 1:
			{
				Color celeb2Color2 = GetCeleb2Color();
				Vector2 center2 = base.Center;
				Main.rand.NextFloat();
				for (float num7 = 0f; num7 < 1f; num7 += 0.0125f)
				{
					Dust dust4 = Dust.NewDustPerfect(center2, 278, null, 200, Color.Lerp(celeb2Color2, Color.White, Main.rand.NextFloat() * 0.6f));
					dust4.scale = 1.1f;
					dust4.fadeIn = 1.3f;
					dust4.velocity *= Main.rand.NextFloat() * 2f + 2f;
					if (dust4.velocity.Y > 0f)
					{
						dust4.velocity *= 0.3f;
					}
					dust4.velocity *= 2f;
				}
				for (int n = 0; n < 3; n++)
				{
					int num8 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num8].velocity *= 0.3f;
					Main.gore[num8].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num8].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				int fluff = 20;
				int distFluff = 100;
				int layerStart = 2;
				int layerEnd = 10;
				int layerJump = 2;
				CreateGroundExplosion(40f, fluff, distFluff, layerStart, layerEnd, layerJump);
				break;
			}
			case 2:
			{
				Vector2 center3 = base.Center;
				Color celeb2Color3 = GetCeleb2Color();
				float num9 = 0.05f;
				float num10 = 0.13f;
				bool flag = Main.rand.Next(4) == 0;
				if (flag)
				{
					num9 = 0.1f;
					num10 = 0.1f;
				}
				float num11 = Main.rand.NextFloatDirection();
				for (float num12 = 0f; num12 < 5f; num12 += 1f)
				{
					Vector2 spinningpoint = new Vector2(0f, -100f);
					Vector2 vector4 = center3 + spinningpoint.RotatedBy(num11 + num12 * (MathF.PI * 2f / 5f));
					Vector2 vector5 = center3 + spinningpoint.RotatedBy(num11 + (num12 + 1f) * (MathF.PI * 2f / 5f));
					Vector2 vector6 = center3 + spinningpoint.RotatedBy(num11 + (num12 + 0.5f) * (MathF.PI * 2f / 5f)) * 0.4f;
					for (int num13 = 0; num13 < 2; num13++)
					{
						Vector2 value = vector4;
						Vector2 value2 = vector6;
						if (num13 == 1)
						{
							value = vector6;
							value2 = vector5;
						}
						for (float num14 = 0f; num14 < 1f; num14 += num10)
						{
							Vector2 vector7 = Vector2.Lerp(value, value2, num14);
							Vector2 vector8 = Vector2.Lerp(vector7, center3, 0.9f);
							Vector2 vector9 = (vector7 - vector8).SafeNormalize(Vector2.Zero);
							Dust dust5 = Dust.NewDustPerfect(vector8, 267, Vector2.Zero, 0, celeb2Color3, 0.5f);
							dust5.fadeIn = 1.2f;
							dust5.noGravity = true;
							dust5.velocity = vector9 * Vector2.Distance(vector7, vector8) * num9;
						}
					}
				}
				if (flag)
				{
					for (int num15 = 0; num15 < 4; num15++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					}
					for (int num16 = 0; num16 < 60; num16++)
					{
						int num17 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 200, default(Color), 2.5f);
						Main.dust[num17].noGravity = true;
						Main.dust[num17].velocity *= 8f;
						num17 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 200, default(Color), 1.5f);
						Main.dust[num17].velocity *= 4.2f;
						Main.dust[num17].noGravity = true;
					}
					for (int num18 = 0; num18 < 1; num18++)
					{
						int num19 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num19].velocity *= 0.3f;
						Main.gore[num19].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
						Main.gore[num19].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
					}
				}
				else
				{
					for (int num20 = 0; num20 < 4; num20++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					}
					for (int num21 = 0; num21 < 40; num21++)
					{
						int num22 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 200, default(Color), 2.5f);
						Main.dust[num22].noGravity = true;
						Main.dust[num22].velocity *= 4f;
						num22 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 200, default(Color), 1.5f);
						Main.dust[num22].velocity *= 2.2f;
						Main.dust[num22].noGravity = true;
					}
					for (int num23 = 0; num23 < 1; num23++)
					{
						int num24 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num24].velocity *= 0.3f;
						Main.gore[num24].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
						Main.gore[num24].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
					}
				}
				break;
			}
			case 3:
			{
				Color celeb2Color5 = GetCeleb2Color();
				Vector2 center4 = base.Center;
				for (int num27 = 0; num27 < 4; num27++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				float num28 = Main.rand.NextFloat() * (MathF.PI * 2f);
				for (int num29 = 0; num29 < 40; num29++)
				{
					Dust dust6 = Dust.NewDustPerfect(center4, 278, null, 100, Color.Lerp(celeb2Color5, Color.White, Main.rand.NextFloat() * 0.3f));
					dust6.scale = 1.3f * (dust6.velocity.Length() / 2f);
					dust6.fadeIn = 1.5f * (dust6.velocity.Length() / 2f);
					dust6.noGravity = true;
					dust6.velocity *= 6f;
					if (Math.Abs(dust6.velocity.X) > Math.Abs(dust6.velocity.Y))
					{
						dust6.velocity.Y *= 0.1f;
					}
					else
					{
						dust6.velocity.X *= 0.1f;
					}
					dust6.velocity = dust6.velocity.RotatedBy(num28);
				}
				for (int num30 = 0; num30 < 1; num30++)
				{
					int num31 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num31].velocity *= 0.3f;
					Main.gore[num31].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num31].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				break;
			}
			case 4:
			{
				GetCeleb2Color();
				Vector2 center5 = base.Center;
				Main.rand.NextFloat();
				for (float num32 = 0f; num32 < 1f; num32 += 0.025f)
				{
					Dust dust7 = Dust.NewDustPerfect(center5, 132, null, 200);
					dust7.scale = 1.1f;
					dust7.fadeIn = 1.5f;
					dust7.velocity *= Main.rand.NextFloat() * 2f + 2f;
					if (dust7.velocity.Y > 0f)
					{
						dust7.velocity *= 0.3f;
					}
					dust7.velocity *= 2f;
				}
				for (int num33 = 0; num33 < 3; num33++)
				{
					int num34 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num34].velocity *= 0.3f;
					Main.gore[num34].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num34].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				break;
			}
			case 5:
			{
				Color celeb2Color4 = GetCeleb2Color();
				_ = base.Center;
				for (int num25 = 0; num25 < 20; num25++)
				{
					int num26 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 278, 0f, 0f, 200, Color.Lerp(celeb2Color4, Color.White, Main.rand.NextFloat() * 0.4f), 2.5f);
					Main.dust[num26].fadeIn = 1.3f;
					Main.dust[num26].scale = 1.1f;
					Main.dust[num26].velocity *= 2f;
					num26 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 200, celeb2Color4, 2.5f);
					Main.dust[num26].velocity *= 1.2f;
					Main.dust[num26].noGravity = true;
				}
				break;
			}
			case 6:
			{
				Color celeb2Color = GetCeleb2Color();
				Vector2 center = base.Center;
				for (int i = 0; i < 4; i++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				for (float num = 0f; num < 1f; num += 0.015f)
				{
					Vector2 vector = Vector2.UnitY.RotatedBy(num * (MathF.PI * 2f)) * (1f + Main.rand.NextFloatDirection() * 0.1f);
					Dust dust = Dust.NewDustPerfect(center + vector, 134, Vector2.Zero, 0, celeb2Color);
					dust.scale = 1.4f;
					dust.velocity = vector * 5f;
					dust.velocity.Y += -3f;
					dust.velocity *= 2f;
				}
				for (float num2 = 0f; num2 < 1f; num2 += 0.025f)
				{
					Vector2 vector2 = Vector2.UnitY.RotatedBy(num2 * (MathF.PI * 2f)) * (1f + Main.rand.NextFloatDirection() * 0.2f);
					Dust dust2 = Dust.NewDustPerfect(center + vector2, 267, Vector2.Zero, 0, celeb2Color);
					dust2.noGravity = true;
					dust2.scale = 0.4f;
					dust2.fadeIn = 1.2f;
					dust2.velocity = vector2 * 4f;
					dust2.velocity.Y += -3f;
					dust2.velocity *= 2f;
				}
				for (float num3 = 0f; num3 < 1f; num3 += 0.07f)
				{
					Vector2 vector3 = Vector2.UnitY.RotatedBy(num3 * (MathF.PI * 2f)) * (1f + Main.rand.NextFloatDirection() * 0.3f);
					Dust dust3 = Dust.NewDustPerfect(center + vector3, 267, Vector2.Zero, 0, celeb2Color);
					dust3.noGravity = true;
					dust3.scale = 0.4f;
					dust3.fadeIn = 1.3f;
					dust3.velocity = vector3 * 7f;
					dust3.velocity.Y += -3f;
					dust3.velocity *= 2f;
				}
				for (int j = 0; j < 1; j++)
				{
					int num4 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num4].velocity *= 0.3f;
					Main.gore[num4].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num4].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				break;
			}
			}
		}

		private void CreateGroundExplosion(float MAX_SPREAD, int fluff, int distFluff, int layerStart, int layerEnd, int layerJump)
		{
			Point point = base.TopLeft.ToTileCoordinates();
			Point point2 = base.BottomRight.ToTileCoordinates();
			point.X -= fluff;
			point.Y -= fluff;
			point2.X += fluff;
			point2.Y += fluff;
			int num = point.X / 2 + point2.X / 2;
			int num2 = width / 2 + distFluff;
			for (int i = layerStart; i < layerEnd; i += layerJump)
			{
				int num3 = i;
				for (int j = point.X; j <= point2.X; j++)
				{
					for (int k = point.Y; k <= point2.Y; k++)
					{
						if (!WorldGen.InWorld(j, k, 10))
						{
							return;
						}
						if (Vector2.Distance(base.Center, new Vector2(j * 16, k * 16)) > (float)num2)
						{
							continue;
						}
						Tile tileSafely = Framing.GetTileSafely(j, k);
						if (!tileSafely.active() || !Main.tileSolid[tileSafely.type] || Main.tileSolidTop[tileSafely.type] || Main.tileFrameImportant[tileSafely.type])
						{
							continue;
						}
						Tile tileSafely2 = Framing.GetTileSafely(j, k - 1);
						if (tileSafely2.active() && Main.tileSolid[tileSafely2.type] && !Main.tileSolidTop[tileSafely2.type])
						{
							continue;
						}
						int num4 = WorldGen.KillTile_GetTileDustAmount(fail: true, tileSafely);
						for (int l = 0; l < num4; l++)
						{
							Dust obj = Main.dust[WorldGen.KillTile_MakeTileDust(j, k, tileSafely)];
							obj.velocity.Y -= 3f + (float)num3 * 1.5f;
							obj.velocity.Y *= Main.rand.NextFloat();
							obj.scale += (float)num3 * 0.03f;
						}
						if (num3 >= 2)
						{
							for (int m = 0; m < num4 - 1; m++)
							{
								Dust obj2 = Main.dust[WorldGen.KillTile_MakeTileDust(j, k, tileSafely)];
								obj2.velocity.Y -= 1f + (float)num3;
								obj2.velocity.Y *= Main.rand.NextFloat();
							}
						}
						if (num4 > 0 && Main.rand.Next(3) != 0)
						{
							float num5 = (float)Math.Abs(num - j) / (MAX_SPREAD / 2f);
							Gore gore = Gore.NewGoreDirect(position, Vector2.Zero, 61 + Main.rand.Next(3), 1f - (float)num3 * 0.15f + num5 * 0.5f);
							gore.velocity.Y -= 0.1f + (float)num3 * 0.5f + num5 * (float)num3 * 1f;
							gore.velocity.Y *= Main.rand.NextFloat();
							gore.position = new Vector2(j * 16 + 20, k * 16 + 20);
						}
					}
				}
			}
		}

		public void CheckUsability(Player player, ref bool currentlyUsable)
		{
			if (aiStyle == 160)
			{
				currentlyUsable = false;
			}
		}

		private void AI_163_Chum()
		{
			float num = 0.05f;
			float num2 = width / 2;
			for (int i = 0; i < 1000; i++)
			{
				if (i != whoAmI && Main.projectile[i].active && Main.projectile[i].type == type && Math.Abs(position.X - Main.projectile[i].position.X) + Math.Abs(position.Y - Main.projectile[i].position.Y) < num2)
				{
					if (position.X < Main.projectile[i].position.X)
					{
						velocity.X -= num;
					}
					else
					{
						velocity.X += num;
					}
					if (position.Y < Main.projectile[i].position.Y)
					{
						velocity.Y -= num;
					}
					else
					{
						velocity.Y += num;
					}
				}
			}
			if (wet)
			{
				velocity.X *= 0.9f;
				int num3 = (int)(base.Center.X + (float)((width / 2 + 8) * direction)) / 16;
				int num4 = (int)(base.Center.Y / 16f);
				_ = position.Y / 16f;
				int num5 = (int)((position.Y + (float)height) / 16f);
				if (Main.tile[num3, num4] == null)
				{
					Main.tile[num3, num4] = new Tile();
				}
				if (Main.tile[num3, num5] == null)
				{
					Main.tile[num3, num5] = new Tile();
				}
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.5f;
				}
				num3 = (int)(base.Center.X / 16f);
				num4 = (int)(base.Center.Y / 16f);
				float num6 = AI_061_FishingBobber_GetWaterLine(num3, num4);
				if (base.Center.Y > num6)
				{
					velocity.Y -= 0.1f;
					if (velocity.Y < -8f)
					{
						velocity.Y = -8f;
					}
					if (base.Center.Y + velocity.Y < num6)
					{
						velocity.Y = num6 - base.Center.Y;
					}
				}
				else
				{
					velocity.Y = num6 - base.Center.Y;
				}
			}
			else
			{
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.95f;
				}
				velocity.X *= 0.98f;
				velocity.Y += 0.3f;
				if (velocity.Y > 15.9f)
				{
					velocity.Y = 15.9f;
				}
			}
			if (frameCounter == 0)
			{
				frameCounter = 1;
				frame = Main.rand.Next(4);
			}
			if (frameCounter < 10 && wet)
			{
				frameCounter++;
				for (float num7 = 0f; num7 < 1f; num7 += 0.5f)
				{
					Gore gore = Gore.NewGoreDirect(position + Vector2.UnitY * 6f, Vector2.Zero, 1201, scale * 0.7f);
					gore.velocity = Main.rand.NextVector2CircularEdge(10f, 10f);
					if (gore.velocity.Y > 0f)
					{
						gore.velocity.Y *= -1f;
					}
				}
				for (float num8 = 0f; num8 < 2f; num8 += 1f)
				{
					Gore gore2 = Gore.NewGoreDirect(position + Vector2.UnitY * 6f, Vector2.Zero, 1208, scale * 0.7f + Main.rand.NextFloat() * 0.15f);
					gore2.velocity = Main.rand.NextVector2CircularEdge(4f, 4f);
					if (gore2.velocity.Y > 0f)
					{
						gore2.velocity.Y *= -1f;
					}
				}
			}
			scale = Utils.GetLerpValue(0f, 60f, timeLeft, clamped: true);
			rotation += velocity.X * 0.14f;
			bool flag = !wet && velocity.Length() < 0.8f;
			int maxValue = (wet ? 90 : 5);
			if (Main.rand.Next(maxValue) == 0 && !flag)
			{
				Gore gore3 = Gore.NewGoreDirect(position + Vector2.UnitY * 6f, Vector2.Zero, 1201, scale * 0.7f);
				if (wet)
				{
					gore3.velocity = Vector2.UnitX * Main.rand.NextFloatDirection() * 0.75f + Vector2.UnitY * Main.rand.NextFloat();
				}
				else if (gore3.velocity.Y < 0f)
				{
					gore3.velocity.Y = 0f - gore3.velocity.Y;
				}
			}
			Vector2 spot = base.Center + Vector2.UnitY * 16f;
			if (ai[0] >= 10f && timeLeft > 60)
			{
				timeLeft = 60;
				netUpdate = true;
			}
			if (ai[0] < 10f && timeLeft > 60)
			{
				Main.instance.ChumBucketProjectileHelper.AddChumLocation(spot);
			}
		}

		private void ReduceRemainingChumsInPool()
		{
			int x = (int)base.Center.X / 16;
			int num = (int)base.Center.Y / 16;
			List<Tuple<int, Point>> list = new List<Tuple<int, Point>>();
			List<int> list2 = new List<int>();
			for (int i = 0; i < 1000; i++)
			{
				Projectile projectile = Main.projectile[i];
				if (projectile.active && projectile.owner == Main.myPlayer && projectile.timeLeft > 60 && projectile.type == 820)
				{
					list.Add(new Tuple<int, Point>(i, (projectile.Center + Vector2.UnitY * 16f).ToTileCoordinates()));
				}
			}
			if (list.Count == 0)
			{
				return;
			}
			GetFishingPondWidth(x, num, out var minX, out var maxX);
			Point point = default(Point);
			for (int j = minX; j <= maxX; j++)
			{
				point.X = j;
				int num2 = num;
				while (Main.tile[j, num2].liquid > 0 && !WorldGen.SolidTile(j, num2) && num2 < Main.maxTilesY - 10)
				{
					num2 = (point.Y = num2 + 1);
					for (int num3 = list.Count - 1; num3 >= 0; num3--)
					{
						if (list[num3].Item2 == point)
						{
							list2.Add(list[num3].Item1);
							list.RemoveAt(num3);
						}
					}
					if (list.Count == 0)
					{
						break;
					}
				}
				if (list.Count == 0)
				{
					break;
				}
			}
			for (int k = 0; k < list2.Count; k++)
			{
				Projectile obj = Main.projectile[list2[k]];
				obj.ai[0] += 1f;
				obj.netUpdate = true;
			}
		}

		private void AI_061_FishingBobber()
		{
			Player player = Main.player[owner];
			bool flag = type >= 986 && type <= 993;
			timeLeft = 60;
			bool flag2 = false;
			if (player.inventory[player.selectedItem].fishingPole == 0 || player.CCed || player.noItems)
			{
				flag2 = true;
			}
			else if (player.inventory[player.selectedItem].shoot != type && !flag)
			{
				flag2 = true;
			}
			else if (player.pulley)
			{
				flag2 = true;
			}
			else if (player.dead)
			{
				flag2 = true;
			}
			if (flag2)
			{
				Kill();
				return;
			}
			if (ai[1] > 0f && localAI[1] != 0f)
			{
				localAI[1] = 0f;
				if (!lavaWet && !honeyWet)
				{
					AI_061_FishingBobber_DoASplash();
				}
			}
			if (ai[0] >= 1f)
			{
				if (ai[0] == 2f)
				{
					ai[0] += 1f;
					SoundEngine.PlaySound(SoundID.Item17, position);
					if (!lavaWet && !honeyWet)
					{
						AI_061_FishingBobber_DoASplash();
					}
				}
				if (localAI[0] < 100f)
				{
					localAI[0] += 1f;
				}
				if (frameCounter == 0)
				{
					frameCounter = 1;
					ReduceRemainingChumsInPool();
				}
				tileCollide = false;
				int num = 10;
				Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num2 = player.position.X + (float)(player.width / 2) - vector.X;
				float num3 = player.position.Y + (float)(player.height / 2) - vector.Y;
				float num4 = (float)Math.Sqrt(num2 * num2 + num3 * num3);
				if (num4 > 3000f)
				{
					Kill();
				}
				num4 = 15.9f / num4;
				num2 *= num4;
				num3 *= num4;
				velocity.X = (velocity.X * (float)(num - 1) + num2) / (float)num;
				velocity.Y = (velocity.Y * (float)(num - 1) + num3) / (float)num;
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				if (Main.myPlayer == owner && base.Hitbox.Intersects(player.Hitbox))
				{
					Kill();
				}
				return;
			}
			bool flag3 = false;
			Vector2 vector2 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
			float num5 = player.position.X + (float)(player.width / 2) - vector2.X;
			float num6 = player.position.Y + (float)(player.height / 2) - vector2.Y;
			rotation = (float)Math.Atan2(num6, num5) + 1.57f;
			if ((float)Math.Sqrt(num5 * num5 + num6 * num6) > 900f)
			{
				ai[0] = 1f;
			}
			if (wet)
			{
				if (shimmerWet)
				{
					if (Main.myPlayer == owner)
					{
						Main.player[owner].AddBuff(353, 60);
					}
					if (localAI[2] == 0f)
					{
						localAI[2] = 1f;
						SoundEngine.PlaySound(19, (int)Main.player[owner].position.X, (int)Main.player[owner].position.Y, 2);
					}
				}
				rotation = 0f;
				velocity.X *= 0.9f;
				int num7 = (int)(base.Center.X + (float)((width / 2 + 8) * direction)) / 16;
				int num8 = (int)(base.Center.Y / 16f);
				_ = position.Y / 16f;
				int num9 = (int)((position.Y + (float)height) / 16f);
				if (Main.tile[num7, num8] == null)
				{
					Main.tile[num7, num8] = new Tile();
				}
				if (Main.tile[num7, num9] == null)
				{
					Main.tile[num7, num9] = new Tile();
				}
				if (velocity.Y > 0f)
				{
					velocity.Y *= 0.5f;
				}
				num7 = (int)(base.Center.X / 16f);
				num8 = (int)(base.Center.Y / 16f);
				float num10 = AI_061_FishingBobber_GetWaterLine(num7, num8);
				if (base.Center.Y > num10)
				{
					velocity.Y -= 0.1f;
					if (velocity.Y < -8f)
					{
						velocity.Y = -8f;
					}
					if (base.Center.Y + velocity.Y < num10)
					{
						velocity.Y = num10 - base.Center.Y;
					}
				}
				else
				{
					velocity.Y = num10 - base.Center.Y;
				}
				if ((double)velocity.Y >= -0.01 && (double)velocity.Y <= 0.01)
				{
					flag3 = true;
				}
			}
			else
			{
				if (velocity.Y == 0f)
				{
					velocity.X *= 0.95f;
				}
				velocity.X *= 0.98f;
				velocity.Y += 0.2f;
				if (velocity.Y > 15.9f)
				{
					velocity.Y = 15.9f;
				}
			}
			if (Main.myPlayer == owner && player.GetFishingConditions().BaitItemType == 2673)
			{
				player.displayedFishingInfo = Language.GetTextValue("GameUI.FishingWarning");
			}
			if (ai[1] != 0f)
			{
				flag3 = true;
			}
			if (!flag3)
			{
				return;
			}
			if (ai[1] == 0f && Main.myPlayer == owner)
			{
				int finalFishingLevel = player.GetFishingConditions().FinalFishingLevel;
				if (Main.rand.Next(300) < finalFishingLevel)
				{
					localAI[1] += Main.rand.Next(1, 3);
				}
				localAI[1] += finalFishingLevel / 30;
				localAI[1] += Main.rand.Next(1, 3);
				if (Main.rand.Next(60) == 0)
				{
					localAI[1] += 60f;
				}
				if (localAI[1] > 660f)
				{
					localAI[1] = 0f;
					FishingCheck();
				}
			}
			else if (ai[1] < 0f)
			{
				if (velocity.Y == 0f || (honeyWet && Math.Abs(velocity.Y) <= 0.01f))
				{
					velocity.Y = (float)Main.rand.Next(100, 500) * 0.015f;
					velocity.X = (float)Main.rand.Next(-100, 101) * 0.015f;
					wet = false;
					lavaWet = false;
					honeyWet = false;
				}
				ai[1] += Main.rand.Next(1, 5);
				if (ai[1] >= 0f)
				{
					ai[1] = 0f;
					localAI[1] = 0f;
					netUpdate = true;
				}
			}
		}

		private float AI_061_FishingBobber_GetWaterLine(int X, int Y)
		{
			float result = position.Y + (float)height;
			if (Main.tile[X, Y - 1] == null)
			{
				Main.tile[X, Y - 1] = new Tile();
			}
			if (Main.tile[X, Y] == null)
			{
				Main.tile[X, Y] = new Tile();
			}
			if (Main.tile[X, Y + 1] == null)
			{
				Main.tile[X, Y + 1] = new Tile();
			}
			if (Main.tile[X, Y - 1].liquid > 0)
			{
				result = Y * 16;
				result -= (float)((int)Main.tile[X, Y - 1].liquid / 16);
			}
			else if (Main.tile[X, Y].liquid > 0)
			{
				result = (Y + 1) * 16;
				result -= (float)((int)Main.tile[X, Y].liquid / 16);
			}
			else if (Main.tile[X, Y + 1].liquid > 0)
			{
				result = (Y + 2) * 16;
				result -= (float)((int)Main.tile[X, Y + 1].liquid / 16);
			}
			return result;
		}

		private void AI_061_FishingBobber_DoASplash()
		{
			for (int i = 0; i < 100; i++)
			{
				int num = Dust.NewDust(new Vector2(position.X - 6f, position.Y - 10f), width + 12, 24, Dust.dustWater());
				Main.dust[num].velocity.Y -= 4f;
				Main.dust[num].velocity.X *= 2.5f;
				Main.dust[num].scale = 0.8f;
				Main.dust[num].alpha = 100;
				Main.dust[num].noGravity = true;
			}
			SoundEngine.PlaySound(19, (int)position.X, (int)position.Y, 0);
		}

		private void AI_061_FishingBobber_GiveItemToPlayer(Player thePlayer, int itemType)
		{
			Item item = new Item();
			item.SetDefaults(itemType);
			if (itemType == 3196)
			{
				int finalFishingLevel = thePlayer.GetFishingConditions().FinalFishingLevel;
				int minValue = (finalFishingLevel / 20 + 3) / 2;
				int num = (finalFishingLevel / 10 + 6) / 2;
				if (Main.rand.Next(50) < finalFishingLevel)
				{
					num++;
				}
				if (Main.rand.Next(100) < finalFishingLevel)
				{
					num++;
				}
				if (Main.rand.Next(150) < finalFishingLevel)
				{
					num++;
				}
				if (Main.rand.Next(200) < finalFishingLevel)
				{
					num++;
				}
				int num2 = (item.stack = Main.rand.Next(minValue, num + 1));
			}
			if (itemType == 3197)
			{
				int finalFishingLevel2 = thePlayer.GetFishingConditions().FinalFishingLevel;
				int minValue2 = (finalFishingLevel2 / 4 + 15) / 2;
				int num3 = (finalFishingLevel2 / 2 + 40) / 2;
				if (Main.rand.Next(50) < finalFishingLevel2)
				{
					num3 += 6;
				}
				if (Main.rand.Next(100) < finalFishingLevel2)
				{
					num3 += 6;
				}
				if (Main.rand.Next(150) < finalFishingLevel2)
				{
					num3 += 6;
				}
				if (Main.rand.Next(200) < finalFishingLevel2)
				{
					num3 += 6;
				}
				int num4 = (item.stack = Main.rand.Next(minValue2, num3 + 1));
			}
			item.newAndShiny = true;
			Item item2 = thePlayer.GetItem(owner, item, default(GetItemSettings));
			if (item2.stack > 0)
			{
				int number = Item.NewItem(new EntitySource_FishedOut(this), (int)position.X, (int)position.Y, width, height, itemType, item2.stack, noBroadcast: false, 0, noGrabDelay: true);
				if (Main.netMode == 1)
				{
					NetMessage.SendData(21, -1, -1, null, number, 1f);
				}
			}
			else
			{
				item.position.X = base.Center.X - (float)(item.width / 2);
				item.position.Y = base.Center.Y - (float)(item.height / 2);
				item.active = true;
				PopupText.NewText(PopupTextContext.RegularItemPickup, item, 0);
			}
		}

		private void AI_146_DD2Victory()
		{
		}

		private void BetsySharpnel(int npcIndex)
		{
			if (ai[1] != -1f && owner == Main.myPlayer)
			{
				Vector2 spinningpoint = new Vector2(0f, 6f);
				Vector2 center = base.Center;
				float num = MathF.PI / 4f;
				int num2 = 5;
				float num3 = (0f - num * 2f) / (float)(num2 - 1);
				for (int i = 0; i < num2; i++)
				{
					int num4 = NewProjectile(GetProjectileSource_FromThis(), center, spinningpoint.RotatedBy(num + num3 * (float)i), 710, damage, knockBack, owner, 0f, -1f);
					Projectile p = Main.projectile[num4];
					CopyLocalNPCImmunityTimes(p);
				}
			}
		}

		private void CopyLocalNPCImmunityTimes(Projectile p)
		{
			for (int i = 0; i < localNPCImmunity.Length; i++)
			{
				p.localNPCImmunity[i] = localNPCImmunity[i];
			}
		}

		private void AI_001()
		{
			//IL_21ea: Unknown result type (might be due to invalid IL or missing references)
			//IL_5967: Unknown result type (might be due to invalid IL or missing references)
			//IL_596c: Unknown result type (might be due to invalid IL or missing references)
			//IL_5a4d: Unknown result type (might be due to invalid IL or missing references)
			//IL_5a73: Unknown result type (might be due to invalid IL or missing references)
			//IL_5a78: Unknown result type (might be due to invalid IL or missing references)
			//IL_7f9f: Unknown result type (might be due to invalid IL or missing references)
			//IL_81c4: Unknown result type (might be due to invalid IL or missing references)
			if (type == 469 && wet && !honeyWet && !shimmerWet)
			{
				Kill();
			}
			if (type == 601)
			{
				Color portalColor = PortalHelper.GetPortalColor(owner, (int)ai[0]);
				Vector3 rgb = portalColor.ToVector3();
				rgb *= 0.5f;
				Lighting.AddLight(base.Center + velocity * 3f, rgb);
				if (alpha > 0 && alpha <= 15)
				{
					Color color = portalColor;
					color.A = byte.MaxValue;
					for (int i = 0; i < 4; i++)
					{
						Dust obj = Main.dust[Dust.NewDust(base.Center, 0, 0, 264)];
						obj.position = base.Center;
						obj.velocity = velocity * 2f + Utils.RandomVector2(Main.rand, -1f, 1f);
						obj.color = color;
						obj.scale = 1.2f;
						obj.noLight = true;
						obj.noGravity = true;
						obj.customData = Main.player[owner];
					}
					if (ai[0] != 0f)
					{
						SoundEngine.PlaySound(SoundID.Item114, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item115, position);
					}
				}
				alpha -= 15;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (++frameCounter >= 4)
				{
					frameCounter = 0;
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				if (alpha == 0)
				{
					Color color2 = portalColor;
					color2.A = byte.MaxValue;
					Dust obj2 = Main.dust[Dust.NewDust(base.Center, 0, 0, 263)];
					obj2.position = base.Center;
					obj2.velocity = velocity / 4f;
					obj2.color = color2;
					obj2.noGravity = true;
					obj2.scale = 0.6f;
				}
			}
			if (type == 472)
			{
				int num = Dust.NewDust(position, width, height, 30);
				Main.dust[num].noGravity = true;
				Main.dust[num].velocity *= 0.25f;
				Main.dust[num].velocity += velocity * 0.75f;
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item17, position);
					for (int j = 0; j < 20; j++)
					{
						num = Dust.NewDust(position, width, height, 30);
						Main.dust[num].noGravity = true;
						Main.dust[num].velocity *= 0.25f;
						Main.dust[num].velocity += velocity;
						Main.dust[num].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
						Main.dust[num].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					}
				}
			}
			if (type == 323)
			{
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (type == 436)
			{
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item12, position);
				}
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
					if (frame >= 4)
					{
						frame = 0;
					}
				}
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.3f, 1.1f, 0.5f);
			}
			if (type == 467)
			{
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item34, position);
				}
				else if (ai[1] == 1f && Main.netMode != 1)
				{
					int num2 = -1;
					float num3 = 2000f;
					for (int k = 0; k < 255; k++)
					{
						if (Main.player[k].active && !Main.player[k].dead)
						{
							Vector2 center = Main.player[k].Center;
							float num4 = Vector2.Distance(center, base.Center);
							if ((num4 < num3 || num2 == -1) && Collision.CanHit(base.Center, 1, 1, center, 1, 1))
							{
								num3 = num4;
								num2 = k;
							}
						}
					}
					if (num3 < 20f)
					{
						Kill();
						return;
					}
					if (num2 != -1)
					{
						ai[1] = 21f;
						ai[0] = num2;
						netUpdate = true;
					}
				}
				else if (ai[1] > 20f && ai[1] < 200f)
				{
					ai[1] += 1f;
					int num5 = (int)ai[0];
					if (!Main.player[num5].active || Main.player[num5].dead)
					{
						ai[1] = 1f;
						ai[0] = 0f;
						netUpdate = true;
					}
					else
					{
						float num6 = velocity.ToRotation();
						Vector2 vector = Main.player[num5].Center - base.Center;
						if (vector.Length() < 20f)
						{
							Kill();
							return;
						}
						float targetAngle = vector.ToRotation();
						if (vector == Vector2.Zero)
						{
							targetAngle = num6;
						}
						float num7 = num6.AngleLerp(targetAngle, 0.008f);
						velocity = new Vector2(velocity.Length(), 0f).RotatedBy(num7);
					}
				}
				if (ai[1] >= 1f && ai[1] < 20f)
				{
					ai[1] += 1f;
					if (ai[1] == 20f)
					{
						ai[1] = 1f;
					}
				}
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
					if (frame >= 4)
					{
						frame = 0;
					}
				}
				Lighting.AddLight(base.Center, 1.1f, 0.9f, 0.4f);
				localAI[0] += 1f;
				if (localAI[0] == 12f)
				{
					localAI[0] = 0f;
					for (int l = 0; l < 12; l++)
					{
						Vector2 spinningpoint = Vector2.UnitX * -width / 2f;
						spinningpoint += -Vector2.UnitY.RotatedBy((float)l * MathF.PI / 6f) * new Vector2(8f, 16f);
						spinningpoint = spinningpoint.RotatedBy(rotation - MathF.PI / 2f);
						int num8 = Dust.NewDust(base.Center, 0, 0, 6, 0f, 0f, 160);
						Main.dust[num8].scale = 1.1f;
						Main.dust[num8].noGravity = true;
						Main.dust[num8].position = base.Center + spinningpoint;
						Main.dust[num8].velocity = velocity * 0.1f;
						Main.dust[num8].velocity = Vector2.Normalize(base.Center - velocity * 3f - Main.dust[num8].position) * 1.25f;
					}
				}
				if (Main.rand.Next(4) == 0)
				{
					for (int m = 0; m < 1; m++)
					{
						Vector2 vector2 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
						int num9 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100);
						Main.dust[num9].velocity *= 0.1f;
						Main.dust[num9].position = base.Center + vector2 * width / 2f;
						Main.dust[num9].fadeIn = 0.9f;
					}
				}
				if (Main.rand.Next(32) == 0)
				{
					for (int n = 0; n < 1; n++)
					{
						Vector2 vector3 = -Vector2.UnitX.RotatedByRandom(0.39269909262657166).RotatedBy(velocity.ToRotation());
						int num10 = Dust.NewDust(position, width, height, 31, 0f, 0f, 155, default(Color), 0.8f);
						Main.dust[num10].velocity *= 0.3f;
						Main.dust[num10].position = base.Center + vector3 * width / 2f;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num10].fadeIn = 1.4f;
						}
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					for (int num11 = 0; num11 < 2; num11++)
					{
						Vector2 vector4 = -Vector2.UnitX.RotatedByRandom(0.7853981852531433).RotatedBy(velocity.ToRotation());
						int num12 = Dust.NewDust(position, width, height, 6, 0f, 0f, 0, default(Color), 1.2f);
						Main.dust[num12].velocity *= 0.3f;
						Main.dust[num12].noGravity = true;
						Main.dust[num12].position = base.Center + vector4 * width / 2f;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num12].fadeIn = 1.4f;
						}
					}
				}
			}
			if (type == 468)
			{
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item34, position);
				}
				else if (ai[1] == 1f && Main.netMode != 1)
				{
					int num13 = -1;
					float num14 = 2000f;
					for (int num15 = 0; num15 < 255; num15++)
					{
						if (Main.player[num15].active && !Main.player[num15].dead)
						{
							Vector2 center2 = Main.player[num15].Center;
							float num16 = Vector2.Distance(center2, base.Center);
							if ((num16 < num14 || num13 == -1) && Collision.CanHit(base.Center, 1, 1, center2, 1, 1))
							{
								num14 = num16;
								num13 = num15;
							}
						}
					}
					if (num14 < 20f)
					{
						Kill();
						return;
					}
					if (num13 != -1)
					{
						ai[1] = 21f;
						ai[0] = num13;
						netUpdate = true;
					}
				}
				else if (ai[1] > 20f && ai[1] < 200f)
				{
					ai[1] += 1f;
					int num17 = (int)ai[0];
					if (!Main.player[num17].active || Main.player[num17].dead)
					{
						ai[1] = 1f;
						ai[0] = 0f;
						netUpdate = true;
					}
					else
					{
						float num18 = velocity.ToRotation();
						Vector2 vector5 = Main.player[num17].Center - base.Center;
						if (vector5.Length() < 20f)
						{
							Kill();
							return;
						}
						float targetAngle2 = vector5.ToRotation();
						if (vector5 == Vector2.Zero)
						{
							targetAngle2 = num18;
						}
						float num19 = num18.AngleLerp(targetAngle2, 0.01f);
						velocity = new Vector2(velocity.Length(), 0f).RotatedBy(num19);
					}
				}
				if (ai[1] >= 1f && ai[1] < 20f)
				{
					ai[1] += 1f;
					if (ai[1] == 20f)
					{
						ai[1] = 1f;
					}
				}
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
					if (frame >= 4)
					{
						frame = 0;
					}
				}
				Lighting.AddLight(base.Center, 0.2f, 0.1f, 0.6f);
				localAI[0] += 1f;
				if (localAI[0] == 12f)
				{
					localAI[0] = 0f;
					for (int num20 = 0; num20 < 12; num20++)
					{
						Vector2 spinningpoint2 = Vector2.UnitX * -width / 2f;
						spinningpoint2 += -Vector2.UnitY.RotatedBy((float)num20 * MathF.PI / 6f) * new Vector2(8f, 16f);
						spinningpoint2 = spinningpoint2.RotatedBy(rotation - MathF.PI / 2f);
						int num21 = Dust.NewDust(base.Center, 0, 0, 27, 0f, 0f, 160);
						Main.dust[num21].scale = 1.1f;
						Main.dust[num21].noGravity = true;
						Main.dust[num21].position = base.Center + spinningpoint2;
						Main.dust[num21].velocity = velocity * 0.1f;
						Main.dust[num21].velocity = Vector2.Normalize(base.Center - velocity * 3f - Main.dust[num21].position) * 1.25f;
					}
				}
				if (Main.rand.Next(4) == 0)
				{
					for (int num22 = 0; num22 < 1; num22++)
					{
						Vector2 vector6 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
						int num23 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100);
						Main.dust[num23].velocity *= 0.1f;
						Main.dust[num23].position = base.Center + vector6 * width / 2f;
						Main.dust[num23].fadeIn = 0.9f;
					}
				}
				if (Main.rand.Next(32) == 0)
				{
					for (int num24 = 0; num24 < 1; num24++)
					{
						Vector2 vector7 = -Vector2.UnitX.RotatedByRandom(0.39269909262657166).RotatedBy(velocity.ToRotation());
						int num25 = Dust.NewDust(position, width, height, 31, 0f, 0f, 155, default(Color), 0.8f);
						Main.dust[num25].velocity *= 0.3f;
						Main.dust[num25].position = base.Center + vector7 * width / 2f;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num25].fadeIn = 1.4f;
						}
					}
				}
				if (Main.rand.Next(2) == 0)
				{
					for (int num26 = 0; num26 < 2; num26++)
					{
						Vector2 vector8 = -Vector2.UnitX.RotatedByRandom(0.7853981852531433).RotatedBy(velocity.ToRotation());
						int num27 = Dust.NewDust(position, width, height, 27, 0f, 0f, 0, default(Color), 1.2f);
						Main.dust[num27].velocity *= 0.3f;
						Main.dust[num27].noGravity = true;
						Main.dust[num27].position = base.Center + vector8 * width / 2f;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num27].fadeIn = 1.4f;
						}
					}
				}
			}
			if (type == 634 || type == 635)
			{
				float num28 = 5f;
				float num29 = 250f;
				float num30 = 6f;
				Vector2 vector9 = new Vector2(8f, 10f);
				float num31 = 1.2f;
				Vector3 rgb2 = new Vector3(0.7f, 0.1f, 0.5f);
				int num32 = 4 * MaxUpdates;
				int num33 = Utils.SelectRandom<int>(Main.rand, 242, 73, 72, 71, 255);
				int num34 = 255;
				if (type == 635)
				{
					vector9 = new Vector2(10f, 20f);
					num31 = 1f;
					num29 = 500f;
					num34 = 88;
					num32 = 3 * MaxUpdates;
					rgb2 = new Vector3(0.4f, 0.6f, 0.9f);
					num33 = Utils.SelectRandom<int>(Main.rand, 242, 59, 88);
				}
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					localAI[0] = -Main.rand.Next(48);
					SoundEngine.PlaySound(SoundID.Item34, position);
				}
				else if (ai[1] == 1f && owner == Main.myPlayer)
				{
					int num35 = -1;
					float num36 = num29;
					for (int num37 = 0; num37 < 200; num37++)
					{
						if (Main.npc[num37].active && Main.npc[num37].CanBeChasedBy(this))
						{
							Vector2 center3 = Main.npc[num37].Center;
							float num38 = Vector2.Distance(center3, base.Center);
							if (num38 < num36 && num35 == -1 && Collision.CanHitLine(base.Center, 1, 1, center3, 1, 1))
							{
								num36 = num38;
								num35 = num37;
							}
						}
					}
					if (num36 < 20f)
					{
						Kill();
						return;
					}
					if (num35 != -1)
					{
						ai[1] = num28 + 1f;
						ai[0] = num35;
						netUpdate = true;
					}
				}
				else if (ai[1] > num28)
				{
					ai[1] += 1f;
					int num39 = (int)ai[0];
					if (!Main.npc[num39].active || !Main.npc[num39].CanBeChasedBy(this))
					{
						ai[1] = 1f;
						ai[0] = 0f;
						netUpdate = true;
					}
					else
					{
						velocity.ToRotation();
						Vector2 vector10 = Main.npc[num39].Center - base.Center;
						if (vector10.Length() < 20f)
						{
							Kill();
							return;
						}
						if (vector10 != Vector2.Zero)
						{
							vector10.Normalize();
							vector10 *= num30;
						}
						float num40 = 30f;
						velocity = (velocity * (num40 - 1f) + vector10) / num40;
					}
				}
				if (ai[1] >= 1f && ai[1] < num28)
				{
					ai[1] += 1f;
					if (ai[1] == num28)
					{
						ai[1] = 1f;
					}
				}
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
				frameCounter++;
				if (frameCounter >= num32)
				{
					frame++;
					frameCounter = 0;
					if (frame >= 4)
					{
						frame = 0;
					}
				}
				Lighting.AddLight(base.Center, rgb2);
				rotation = velocity.ToRotation();
				localAI[0] += 1f;
				if (localAI[0] == 48f)
				{
					localAI[0] = 0f;
				}
				else if (alpha == 0)
				{
					for (int num41 = 0; num41 < 2; num41++)
					{
						Vector2 vector11 = Vector2.UnitX * -30f;
						vector11 = -Vector2.UnitY.RotatedBy(localAI[0] * (MathF.PI / 24f) + (float)num41 * MathF.PI) * vector9 - rotation.ToRotationVector2() * 10f;
						int num42 = Dust.NewDust(base.Center, 0, 0, num34, 0f, 0f, 160);
						Main.dust[num42].scale = num31;
						Main.dust[num42].noGravity = true;
						Main.dust[num42].position = base.Center + vector11 + velocity * 2f;
						Main.dust[num42].velocity = Vector2.Normalize(base.Center + velocity * 2f * 8f - Main.dust[num42].position) * 2f + velocity * 2f;
					}
				}
				if (Main.rand.Next(12) == 0)
				{
					for (int num43 = 0; num43 < 1; num43++)
					{
						Vector2 vector12 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
						int num44 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100);
						Main.dust[num44].velocity *= 0.1f;
						Main.dust[num44].position = base.Center + vector12 * width / 2f + velocity * 2f;
						Main.dust[num44].fadeIn = 0.9f;
					}
				}
				if (Main.rand.Next(64) == 0)
				{
					for (int num45 = 0; num45 < 1; num45++)
					{
						Vector2 vector13 = -Vector2.UnitX.RotatedByRandom(0.39269909262657166).RotatedBy(velocity.ToRotation());
						int num46 = Dust.NewDust(position, width, height, 31, 0f, 0f, 155, default(Color), 0.8f);
						Main.dust[num46].velocity *= 0.3f;
						Main.dust[num46].position = base.Center + vector13 * width / 2f;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num46].fadeIn = 1.4f;
						}
					}
				}
				if (Main.rand.Next(4) == 0)
				{
					for (int num47 = 0; num47 < 2; num47++)
					{
						Vector2 vector14 = -Vector2.UnitX.RotatedByRandom(0.7853981852531433).RotatedBy(velocity.ToRotation());
						int num48 = Dust.NewDust(position, width, height, num33, 0f, 0f, 0, default(Color), 1.2f);
						Main.dust[num48].velocity *= 0.3f;
						Main.dust[num48].noGravity = true;
						Main.dust[num48].position = base.Center + vector14 * width / 2f;
						if (Main.rand.Next(2) == 0)
						{
							Main.dust[num48].fadeIn = 1.4f;
						}
					}
				}
				if (Main.rand.Next(12) == 0 && type == 634)
				{
					Vector2 vector15 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
					int num49 = Dust.NewDust(position, width, height, num34, 0f, 0f, 100);
					Main.dust[num49].velocity *= 0.3f;
					Main.dust[num49].position = base.Center + vector15 * width / 2f;
					Main.dust[num49].fadeIn = 0.9f;
					Main.dust[num49].noGravity = true;
				}
				if (Main.rand.Next(3) == 0 && type == 635)
				{
					Vector2 vector16 = -Vector2.UnitX.RotatedByRandom(0.19634954631328583).RotatedBy(velocity.ToRotation());
					int num50 = Dust.NewDust(position, width, height, num34, 0f, 0f, 100);
					Main.dust[num50].velocity *= 0.3f;
					Main.dust[num50].position = base.Center + vector16 * width / 2f;
					Main.dust[num50].fadeIn = 1.2f;
					Main.dust[num50].scale = 1.5f;
					Main.dust[num50].noGravity = true;
				}
			}
			if (type == 459)
			{
				alpha -= 30;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
					if (frame >= 3)
					{
						frame = 0;
					}
				}
				position = base.Center;
				scale = ai[1];
				width = (height = (int)(22f * scale));
				base.Center = position;
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.4f, 0.85f, 0.9f);
				int num51 = 0;
				if ((double)scale < 0.85)
				{
					num51 = ((Main.rand.Next(3) == 0) ? 1 : 0);
				}
				else
				{
					num51 = 1;
					penetrate = -1;
					maxPenetrate = -1;
				}
				for (int num52 = 0; num52 < num51; num52++)
				{
					int num53 = Dust.NewDust(position, width, height, 226, velocity.X);
					Main.dust[num53].position -= Vector2.One * 3f;
					Main.dust[num53].scale = 0.5f;
					Main.dust[num53].noGravity = true;
					Main.dust[num53].velocity = velocity / 3f;
					Main.dust[num53].alpha = 255 - (int)(255f * scale);
				}
			}
			if (type == 709)
			{
				alpha -= 30;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
					if (frame >= 3)
					{
						frame = 0;
					}
				}
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.4f, 0.85f, 0.9f);
				if (ai[1] == 0f)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_SkyDragonsFuryShot, base.Center);
				}
				ai[1] += 1f;
				if (ai[1] >= 30f)
				{
					Kill();
					return;
				}
			}
			if (type == 442)
			{
				frame = 0;
				if (alpha != 0)
				{
					localAI[0] += 1f;
					if (localAI[0] >= 4f)
					{
						alpha -= 90;
						if (alpha < 0)
						{
							alpha = 0;
							localAI[0] = 2f;
						}
					}
				}
				if (Vector2.Distance(base.Center, new Vector2(ai[0], ai[1]) * 16f + Vector2.One * 8f) <= 16f)
				{
					Kill();
					return;
				}
				if (alpha == 0)
				{
					localAI[1] += 1f;
					if (localAI[1] >= 120f)
					{
						Kill();
						return;
					}
					Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.3f, 0.45f, 0.8f);
					localAI[0] += 1f;
					if (localAI[0] == 3f)
					{
						localAI[0] = 0f;
						for (int num54 = 0; num54 < 8; num54++)
						{
							Vector2 spinningpoint3 = Vector2.UnitX * -8f;
							spinningpoint3 += -Vector2.UnitY.RotatedBy((float)num54 * MathF.PI / 4f) * new Vector2(2f, 4f);
							spinningpoint3 = spinningpoint3.RotatedBy(rotation - MathF.PI / 2f);
							int num55 = Dust.NewDust(base.Center, 0, 0, 135);
							Main.dust[num55].scale = 1.5f;
							Main.dust[num55].noGravity = true;
							Main.dust[num55].position = base.Center + spinningpoint3;
							Main.dust[num55].velocity = velocity * 0.66f;
						}
					}
				}
			}
			if (type == 440 || type == 449 || type == 606)
			{
				if (alpha > 0)
				{
					alpha -= 25;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (type == 440)
				{
					Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.25f, 0.4f, 0.7f);
				}
				if (type == 449)
				{
					Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.7f, 0.65f, 0.3f);
				}
				if (type == 606)
				{
					Lighting.AddLight(base.Center, 0.7f, 0.3f, 0.3f);
				}
				float num56 = 100f;
				float num57 = 3f;
				if (type == 606)
				{
					num56 = 150f;
					num57 = 5f;
				}
				if (ai[1] == 0f)
				{
					localAI[0] += num57;
					if (localAI[0] == num57 * 1f && type == 606)
					{
						for (int num58 = 0; num58 < 4; num58++)
						{
							int num59 = Dust.NewDust(base.Center - velocity / 2f, 0, 0, 182, 0f, 0f, 100, default(Color), 1.4f);
							Main.dust[num59].velocity *= 0.2f;
							Main.dust[num59].velocity += velocity / 10f;
							Main.dust[num59].noGravity = true;
						}
					}
					if (localAI[0] > num56)
					{
						localAI[0] = num56;
					}
				}
				else
				{
					localAI[0] -= num57;
					if (localAI[0] <= 0f)
					{
						Kill();
						return;
					}
				}
			}
			if (type == 438)
			{
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.4f, 0.1f, 0.2f);
			}
			if (type == 593)
			{
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.4f, 0.1f, 0.3f);
				if (++frameCounter >= 12)
				{
					if (++frame >= Main.projFrames[type])
					{
						frame = 0;
					}
					frameCounter = 0;
				}
				if (Main.rand.Next(2) == 0)
				{
					Vector2 vector17 = Vector2.UnitY.RotatedByRandom(6.2831854820251465);
					Dust obj3 = Main.dust[Dust.NewDust(base.Center - vector17 * 8f, 0, 0, 240)];
					obj3.noGravity = true;
					obj3.position = base.Center - vector17 * 8f * scale;
					obj3.velocity = vector17.RotatedBy(-1.5707963705062866) * 2f;
					obj3.velocity = Vector2.Zero;
					obj3.scale = 0.5f + Main.rand.NextFloat();
					obj3.fadeIn = 0.5f;
				}
			}
			if (type == 592)
			{
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.15f, 0.15f, 0.4f);
			}
			if (type == 462)
			{
				int num60 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100);
				Main.dust[num60].noLight = true;
				Main.dust[num60].noGravity = true;
				Main.dust[num60].velocity = velocity;
				Main.dust[num60].position -= Vector2.One * 4f;
				Main.dust[num60].scale = 0.8f;
				if (++frameCounter >= 9)
				{
					frameCounter = 0;
					if (++frame >= 5)
					{
						frame = 0;
					}
				}
			}
			if (type == 437)
			{
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item12, position);
				}
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					for (int num61 = 0; num61 < 4; num61++)
					{
						int num62 = Dust.NewDust(position, width, height, 226, velocity.X);
						Main.dust[num62].position = Vector2.Lerp(Main.dust[num62].position, base.Center, 0.25f);
						Main.dust[num62].scale = 0.5f;
						Main.dust[num62].noGravity = true;
						Main.dust[num62].velocity /= 2f;
						Main.dust[num62].velocity += velocity * 0.66f;
					}
				}
				if (ai[0] < 16f)
				{
					for (int num63 = 0; num63 < 2; num63++)
					{
						int num64 = Dust.NewDust(position, width, height, 226, velocity.X);
						Main.dust[num64].position = position + new Vector2(((direction == 1) ? 1 : 0) * width, 2 + (height - 4) * num63);
						Main.dust[num64].scale = 0.3f;
						Main.dust[num64].noGravity = true;
						Main.dust[num64].velocity = Vector2.Zero;
					}
				}
			}
			if (type == 435)
			{
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item12, position);
				}
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
					if (frame >= 4)
					{
						frame = 0;
					}
				}
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.3f, 0.8f, 1.1f);
			}
			if (type == 682)
			{
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.DD2_LightningBugZap, position);
					for (int num65 = 0; num65 < 8; num65++)
					{
						Dust dust = Dust.NewDustDirect(position, width, height, 272);
						dust.velocity *= 1f;
						dust.velocity += velocity * 0.65f;
						dust.scale = 0.6f;
						dust.fadeIn = 0.8f;
						dust.noGravity = true;
						dust.noLight = true;
						dust.position += dust.velocity * 3f;
					}
				}
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
				frameCounter++;
				if (frameCounter >= 3)
				{
					frame++;
					frameCounter = 0;
					if (frame >= 4)
					{
						frame = 0;
					}
				}
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.5f, 0.2f, 1.1f);
			}
			if (type == 684)
			{
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
				localAI[0] += 1f;
				for (int num66 = 0; num66 < 1; num66++)
				{
					Vector2 spinningpoint4 = Utils.RandomVector2(Main.rand, -0.5f, 0.5f) * new Vector2(20f, 80f);
					spinningpoint4 = spinningpoint4.RotatedBy(velocity.ToRotation());
					Dust dust2 = Dust.NewDustDirect(base.Center, 0, 0, 60);
					dust2.alpha = 127;
					dust2.fadeIn = 1.5f;
					dust2.scale = 1.3f;
					dust2.velocity *= 0.3f;
					dust2.position = base.Center + spinningpoint4;
					dust2.noGravity = true;
					dust2.noLight = true;
					dust2.color = new Color(255, 255, 255, 0);
				}
				Lighting.AddLight(base.Center, 1.1f, 0.3f, 0.4f);
			}
			if (type == 408)
			{
				alpha -= 40;
				if (alpha < 0)
				{
					alpha = 0;
				}
				spriteDirection = direction;
			}
			if (type == 282)
			{
				int num67 = Dust.NewDust(position, width, height, 171, 0f, 0f, 100);
				Main.dust[num67].scale = (float)Main.rand.Next(1, 10) * 0.1f;
				Main.dust[num67].noGravity = true;
				Main.dust[num67].fadeIn = 1.5f;
				Main.dust[num67].velocity *= 0.25f;
				Main.dust[num67].velocity += velocity * 0.25f;
			}
			if (type == 275 || type == 276)
			{
				frameCounter++;
				if (frameCounter > 1)
				{
					frameCounter = 0;
					frame++;
					if (frame > 1)
					{
						frame = 0;
					}
				}
			}
			if (type == 225 && Main.rand.Next(2) == 0)
			{
				int num68 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 40);
				Main.dust[num68].noGravity = true;
				Main.dust[num68].scale = 1.3f;
				Main.dust[num68].velocity *= 0.5f;
			}
			if (type == 174)
			{
				if (alpha == 0)
				{
					int num69 = Dust.NewDust(oldPosition - velocity * 3f, width, height, 76, 0f, 0f, 50);
					Main.dust[num69].noGravity = true;
					Main.dust[num69].noLight = true;
					Main.dust[num69].velocity *= 0.5f;
				}
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item17, position);
				}
			}
			else if (type == 605 || type == 920 || type == 921 || type == 926 || type == 937)
			{
				if (type == 920 && frameCounter == 0)
				{
					frameCounter = 1;
					frame = Main.rand.Next(3);
				}
				if (type != 920 && type != 921 && alpha == 0 && Main.rand.Next(3) == 0)
				{
					int num70 = 4;
					Color newColor = new Color(78, 136, 255, 150);
					float num71 = 1.2f;
					bool noGravity = true;
					int num72 = 0;
					if (type == 921)
					{
						num70 = 243;
						newColor = default(Color);
					}
					if (type == 926)
					{
						num70 = 4;
						newColor = NPC.AI_121_QueenSlime_GetDustColor();
						newColor.A = 150;
						num71 = 1.2f;
						num72 = 8;
						noGravity = Main.rand.Next(2) == 0;
					}
					if (type == 937)
					{
						num70 = 4;
						newColor = NPC.AI_121_QueenSlime_GetDustColor();
						newColor.A = 150;
					}
					int num73 = Dust.NewDust(position - new Vector2(num72, num72) + velocity, width + num72 * 2, height + num72 * 2, num70, 0f, 0f, 50, newColor, num71);
					Main.dust[num73].velocity *= 0.3f;
					Main.dust[num73].velocity += velocity * 0.3f;
					Main.dust[num73].noGravity = noGravity;
				}
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (type != 937 && ai[1] == 0f)
				{
					ai[1] = 1f;
					if (type == 926)
					{
						SoundEngine.PlaySound(SoundID.Item155, position);
					}
					else
					{
						SoundEngine.PlaySound(SoundID.Item154, position);
					}
				}
			}
			else if (type == 176)
			{
				if (alpha == 0)
				{
					int num74 = Dust.NewDust(oldPosition, width, height, 22, 0f, 0f, 100, default(Color), 0.5f);
					Main.dust[num74].noGravity = true;
					Main.dust[num74].noLight = true;
					Main.dust[num74].velocity *= 0.15f;
					Main.dust[num74].fadeIn = 0.8f;
				}
				alpha -= 50;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item17, position);
				}
			}
			if (type == 350)
			{
				alpha -= 100;
				if (alpha < 0)
				{
					alpha = 0;
				}
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.9f, 0.6f, 0.2f);
				if (alpha == 0)
				{
					int num75 = 2;
					if (Main.rand.Next(3) != 0)
					{
						int num76 = Dust.NewDust(new Vector2(base.Center.X - (float)num75, base.Center.Y - (float)num75 - 2f) - velocity * 0.5f, num75 * 2, num75 * 2, 6, 0f, 0f, 100);
						Main.dust[num76].scale *= 1.3f + (float)Main.rand.Next(10) * 0.05f;
						Main.dust[num76].velocity *= 0.2f;
						Main.dust[num76].noGravity = true;
						Main.dust[num76].noLight = true;
						Main.dust[num76].velocity += velocity * 0.25f;
					}
					if (Main.rand.Next(4) == 0)
					{
						int num77 = (num77 = Dust.NewDust(new Vector2(base.Center.X - (float)num75, base.Center.Y - (float)num75 - 2f) - velocity * 0.5f, num75 * 2, num75 * 2, 31, 0f, 0f, 100, default(Color), 0.5f));
						Main.dust[num77].fadeIn = 0.6f + (float)Main.rand.Next(5) * 0.1f;
						Main.dust[num77].velocity *= 0.05f;
						Main.dust[num77].velocity += velocity * 0.25f;
					}
				}
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item42, position);
				}
			}
			if (type == 325)
			{
				alpha -= 100;
				if (alpha < 0)
				{
					alpha = 0;
				}
				Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.9f, 0.6f, 0.2f);
				if (alpha == 0)
				{
					int num78 = 2;
					if (Main.rand.Next(3) != 0)
					{
						int num79 = Dust.NewDust(new Vector2(base.Center.X - (float)num78, base.Center.Y - (float)num78 - 2f) - velocity * 0.5f, num78 * 2, num78 * 2, 6, 0f, 0f, 100);
						Main.dust[num79].scale *= 1.2f + (float)Main.rand.Next(10) * 0.05f;
						Main.dust[num79].velocity *= 0.2f;
						Main.dust[num79].noGravity = true;
						Main.dust[num79].noLight = true;
						Main.dust[num79].velocity += velocity * 0.25f;
					}
					if (Main.rand.Next(4) == 0)
					{
						int num80 = (num80 = Dust.NewDust(new Vector2(base.Center.X - (float)num78, base.Center.Y - (float)num78 - 2f) - velocity * 0.5f, num78 * 2, num78 * 2, 31, 0f, 0f, 100, default(Color), 0.5f));
						Main.dust[num80].fadeIn = 0.5f + (float)Main.rand.Next(5) * 0.05f;
						Main.dust[num80].velocity *= 0.05f;
					}
				}
				if (ai[1] == 0f)
				{
					ai[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item42, position);
				}
			}
			if (type == 469)
			{
				localAI[1] += 1f;
				if (localAI[1] > 2f)
				{
					alpha -= 50;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
			}
			else if (type == 83 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item33, position);
			}
			else if (type == 408 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 19);
			}
			else if (type == 259 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item33, position);
			}
			else if (type == 110 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item11, position);
			}
			else if (type == 302 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item11, position);
			}
			else if (type == 438 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item12, position);
			}
			else if (type == 593 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item11, position);
			}
			else if (type == 592 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item12, position);
			}
			else if (type == 462 && ai[1] == 0f)
			{
				ai[1] = 1f;
				if (Main.rand.Next(2) == 0)
				{
					SoundEngine.PlaySound(SoundID.Item124, position);
				}
				else
				{
					SoundEngine.PlaySound(SoundID.Item125, position);
				}
				Vector2 vector18 = Vector2.Normalize(velocity);
				int num81 = Main.rand.Next(5, 10);
				for (int num82 = 0; num82 < num81; num82++)
				{
					int num83 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100);
					Main.dust[num83].velocity.Y -= 1f;
					Main.dust[num83].velocity += vector18 * 2f;
					Main.dust[num83].position -= Vector2.One * 4f;
					Main.dust[num83].noGravity = true;
				}
			}
			else if (type == 84 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item12, position);
			}
			else if (type == 389 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item12, position);
			}
			else if (type == 257 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item12, position);
			}
			else if (type == 100 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item33, position);
			}
			else if (type == 98 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
			}
			else if (type == 184 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
			}
			else if (type == 980 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
			}
			else if (type == 195 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
			}
			else if (type == 275 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
			}
			else if (type == 276 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item17, position);
			}
			else if ((type == 81 || type == 82) && ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item5, position);
				ai[1] = 1f;
			}
			else if (type == 180 && ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item11, position);
				ai[1] = 1f;
			}
			else if (type == 248 && ai[1] == 0f)
			{
				SoundEngine.PlaySound(SoundID.Item17, position);
				ai[1] = 1f;
			}
			else if (type == 576 && ai[1] == 0f)
			{
				ai[1] = 1f;
				SoundEngine.PlaySound(SoundID.Item12, position);
			}
			else if (type == 577 && soundDelay == 0)
			{
				soundDelay = -1;
				SoundEngine.PlaySound(SoundID.Item36, position);
				for (int num84 = 0; num84 < 5; num84++)
				{
					Vector2 center4 = base.Center;
					int num85 = ((num84 != 0) ? 3 : 0);
					float num86 = ((num84 == 0) ? (12f + 8f * Main.rand.NextFloat()) : (12f * Main.rand.NextFloat()));
					Vector2 vector19 = velocity.SafeNormalize(Vector2.Zero) * num86 + Main.rand.NextVector2Circular(1f, 1f) * num85;
					Dust obj4 = Main.dust[Dust.NewDust(center4, 8, 8, 229, 0f, 0f, 100, Color.Transparent, 1f + Main.rand.NextFloat() * 0.5f)];
					obj4.noGravity = true;
					obj4.velocity = vector19;
					obj4.position = center4;
				}
			}
			else if (type == 710)
			{
				alpha -= 25;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (Main.rand.Next(4) == 0)
				{
					int num87;
					if (Main.rand.Next(2) == 0)
					{
						num87 = Dust.NewDust(position, width, height, 31, 0f, 0f, 100, default(Color), 1.6f);
						Main.dust[num87].noGravity = true;
					}
					num87 = Dust.NewDust(position, width, height, 6, 0f, 0f, 100, default(Color), 1.2f);
					Main.dust[num87].noGravity = true;
					Main.dust[num87].velocity *= 2f;
					Main.dust[num87].velocity += velocity;
					if (ai[1] == -1f)
					{
						Main.dust[num87].fadeIn = 1.5f;
					}
					else
					{
						Main.dust[num87].fadeIn = 1.22f;
					}
					if (wet)
					{
						Kill();
					}
				}
			}
			else if (type == 639)
			{
				if (localAI[0] == 0f && localAI[1] == 0f)
				{
					localAI[0] = base.Center.X;
					localAI[1] = base.Center.Y;
					ai[0] = velocity.X;
					ai[1] = velocity.Y;
				}
				alpha -= 25;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			else if (type == 640)
			{
				alpha -= 25;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (velocity == Vector2.Zero)
				{
					ai[0] = 0f;
					bool flag = true;
					for (int num88 = 1; num88 < oldPos.Length; num88++)
					{
						if (oldPos[num88] != oldPos[0])
						{
							flag = false;
						}
					}
					if (flag)
					{
						Kill();
						return;
					}
					if (Main.rand.Next(extraUpdates) == 0 && (velocity != Vector2.Zero || Main.rand.Next((localAI[1] == 2f) ? 2 : 6) == 0))
					{
						for (int num89 = 0; num89 < 2; num89++)
						{
							float num90 = rotation + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
							float num91 = (float)Main.rand.NextDouble() * 0.8f + 1f;
							Vector2 vector20 = new Vector2((float)Math.Cos(num90) * num91, (float)Math.Sin(num90) * num91);
							int num92 = Dust.NewDust(base.Center, 0, 0, 229, vector20.X, vector20.Y);
							Main.dust[num92].noGravity = true;
							Main.dust[num92].scale = 1.2f;
						}
						if (Main.rand.Next(10) == 0)
						{
							Vector2 vector21 = velocity.RotatedBy(1.5707963705062866) * ((float)Main.rand.NextDouble() - 0.5f) * width;
							int num93 = Dust.NewDust(base.Center + vector21 - Vector2.One * 4f, 8, 8, 31, 0f, 0f, 100, default(Color), 1.5f);
							Main.dust[num93].velocity *= 0.5f;
							Main.dust[num93].velocity.Y = 0f - Math.Abs(Main.dust[num93].velocity.Y);
						}
					}
				}
				else if (numUpdates == 1)
				{
					float num94 = rotation + MathF.PI / 2f + ((Main.rand.Next(2) == 1) ? (-1f) : 1f) * (MathF.PI / 2f);
					float num95 = (float)Main.rand.NextDouble() * 0.25f + 0.25f;
					Vector2 vector22 = new Vector2((float)Math.Cos(num94) * num95, (float)Math.Sin(num94) * num95);
					int num96 = Dust.NewDust(position, 0, 0, 229, vector22.X, vector22.Y);
					Main.dust[num96].noGravity = true;
					Main.dust[num96].scale = 1.2f;
				}
			}
			if (type == 41)
			{
				int num97 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.6f);
				Main.dust[num97].noGravity = true;
				num97 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
				Main.dust[num97].noGravity = true;
			}
			else if (type == 55)
			{
				int num98 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 18, 0f, 0f, 0, default(Color), 0.9f);
				Main.dust[num98].noGravity = true;
			}
			else if (type == 719)
			{
				if (Main.rand.Next(2) == 0)
				{
					Dust.NewDustDirect(position - velocity, width, height, 147, 0f, 0f, 0, default(Color), 0.9f).noGravity = true;
				}
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					for (int num99 = 0; num99 < 20; num99++)
					{
						Dust dust3 = Dust.NewDustDirect(position - velocity, width, height, 147, 0f, 0f, 0, default(Color), 1.3f);
						dust3.noGravity = true;
						dust3.velocity += velocity * 0.75f;
					}
					for (int num100 = 0; num100 < 10; num100++)
					{
						Dust dust4 = Dust.NewDustDirect(position - velocity, width, height, 147, 0f, 0f, 0, default(Color), 1.3f);
						dust4.noGravity = true;
						dust4.velocity *= 2f;
					}
				}
			}
			else if (type == 763)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					for (int num101 = 0; num101 < 5; num101++)
					{
						Dust dust5 = Dust.NewDustDirect(position - velocity, width, height, 40, 0f, 0f, 0, default(Color), 1.1f);
						dust5.noGravity = true;
						dust5.velocity *= 1.5f;
					}
				}
			}
			else if (type == 772)
			{
				if (Main.rand.Next(7) == 0)
				{
					for (int num102 = 0; num102 < 1; num102++)
					{
						Dust dust6 = Dust.NewDustDirect(position - velocity, width, height, Main.rand.NextFromList<int>(86, 87, 88, 89, 90, 91, 138), 0f, 0f, 0, default(Color), 0.7f);
						dust6.noGravity = true;
						dust6.velocity = velocity * 0.6f;
						dust6.fadeIn = 0.8f;
					}
				}
			}
			else if (type == 374)
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item17, position);
					localAI[0] = 1f;
				}
				if (Main.rand.Next(2) == 0)
				{
					int num103 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 18, 0f, 0f, 0, default(Color), 0.9f);
					Main.dust[num103].noGravity = true;
					Main.dust[num103].velocity *= 0.5f;
				}
			}
			else if (type == 376)
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item20, position);
				}
				localAI[0] += 1f;
				if (localAI[0] > 3f)
				{
					int num104 = 1;
					if (localAI[0] > 5f)
					{
						num104 = 2;
					}
					for (int num105 = 0; num105 < num104; num105++)
					{
						int num106 = Dust.NewDust(new Vector2(position.X, position.Y + 2f), width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
						Main.dust[num106].noGravity = true;
						Main.dust[num106].velocity.X *= 0.3f;
						Main.dust[num106].velocity.Y *= 0.3f;
						Main.dust[num106].noLight = true;
					}
					if (wet && !lavaWet)
					{
						Kill();
						return;
					}
				}
			}
			else if (type == 91 && Main.rand.Next(2) == 0)
			{
				int num108 = Dust.NewDust(Type: (Main.rand.Next(2) != 0) ? 58 : 15, Position: position, Width: width, Height: height, SpeedX: velocity.X * 0.25f, SpeedY: velocity.Y * 0.25f, Alpha: 150, newColor: default(Color), Scale: 0.9f);
				Main.dust[num108].velocity *= 0.25f;
			}
			if (type == 163 || type == 310 || type == 1008 || type == 1010 || type == 1009 || type == 1011)
			{
				if (alpha > 0)
				{
					alpha -= 25;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			switch (type)
			{
			case 14:
			case 20:
			case 36:
			case 83:
			case 84:
			case 89:
			case 100:
			case 104:
			case 110:
			case 158:
			case 159:
			case 160:
			case 161:
			case 180:
			case 279:
			case 283:
			case 284:
			case 285:
			case 286:
			case 287:
			case 389:
				if (alpha > 0)
				{
					alpha -= 15;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				break;
			case 576:
			case 577:
				localAI[1] += 1f;
				if (localAI[1] > 2f)
				{
					if (alpha > 0)
					{
						alpha -= 15;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				break;
			}
			if (type == 484)
			{
				int num109 = Dust.NewDust(position, width, height, 78);
				Main.dust[num109].noGravity = true;
				Main.dust[num109].velocity *= 0.1f;
				Main.dust[num109].scale = 0.75f;
				Main.dust[num109].position = (Main.dust[num109].position + base.Center) / 2f;
				Main.dust[num109].position += velocity * Main.rand.Next(0, 101) * 0.01f;
			}
			if (type == 242 || type == 302 || type == 438 || type == 462 || type == 592)
			{
				float num110 = (float)Math.Sqrt(velocity.X * velocity.X + velocity.Y * velocity.Y);
				if (alpha > 0)
				{
					alpha -= (byte)((double)num110 * 0.9);
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (type == 660)
			{
				DelegateMethods.v3_1 = new Vector3(0.6f, 1f, 1f) * 0.2f;
				Utils.PlotTileLine(base.Center, base.Center + velocity * 10f, 8f, DelegateMethods.CastLightOpen);
				if (alpha > 0)
				{
					SoundEngine.PlaySound(SoundID.Item9, base.Center);
					alpha = 0;
					scale = 1.1f;
					frame = Main.rand.Next(14);
					float num111 = 16f;
					for (int num112 = 0; (float)num112 < num111; num112++)
					{
						Vector2 spinningpoint5 = Vector2.UnitX * 0f;
						spinningpoint5 += -Vector2.UnitY.RotatedBy((float)num112 * (MathF.PI * 2f / num111)) * new Vector2(1f, 4f);
						spinningpoint5 = spinningpoint5.RotatedBy(velocity.ToRotation());
						int num113 = Dust.NewDust(base.Center, 0, 0, 180);
						Main.dust[num113].scale = 1.5f;
						Main.dust[num113].noGravity = true;
						Main.dust[num113].position = base.Center + spinningpoint5;
						Main.dust[num113].velocity = velocity * 0f + spinningpoint5.SafeNormalize(Vector2.UnitY) * 1f;
					}
				}
			}
			if (type == 712)
			{
				DelegateMethods.v3_1 = new Vector3(0.4f, 0.4f, 0.4f) * 0.7f;
				Utils.PlotTileLine(base.Center, base.Center + velocity * 10f, 8f, DelegateMethods.CastLightOpen);
				if (alpha == 255)
				{
					frame = Main.rand.Next(2) * 4;
				}
				if (++frameCounter >= 4)
				{
					frameCounter = 0;
					frame++;
					if (frame == 4)
					{
						frame = 0;
					}
					if (frame >= 8)
					{
						frame = 4;
					}
				}
				if (alpha > 0)
				{
					alpha = 0;
					scale = 1.1f;
					frame = Main.rand.Next(14);
					float num114 = 4f;
					for (int num115 = 0; (float)num115 < num114; num115++)
					{
						Vector2 spinningpoint6 = Vector2.UnitX * 0f;
						spinningpoint6 += -Vector2.UnitY.RotatedBy((float)num115 * (MathF.PI * 2f / num114)) * new Vector2(1f, 4f);
						spinningpoint6 = spinningpoint6.RotatedBy(velocity.ToRotation());
						int num116 = Dust.NewDust(base.Center, 0, 0, 15);
						Main.dust[num116].scale = 1.7f;
						Main.dust[num116].noGravity = true;
						Main.dust[num116].position = base.Center + spinningpoint6 + velocity.SafeNormalize(Vector2.Zero) * 50f;
						Main.dust[num116].velocity = Main.dust[num116].velocity * 2f + spinningpoint6.SafeNormalize(Vector2.UnitY) * 0.3f + velocity.SafeNormalize(Vector2.Zero) * 3f;
						Main.dust[num116].velocity *= 0.7f;
						Main.dust[num116].position += Main.dust[num116].velocity * 5f;
					}
				}
			}
			if (type == 661)
			{
				if (alpha <= 0)
				{
					for (int num117 = 0; num117 < 3; num117++)
					{
						int num118 = Dust.NewDust(position, width, height, 240);
						Main.dust[num118].noGravity = true;
						Main.dust[num118].velocity *= 0.3f;
						Main.dust[num118].noLight = true;
					}
				}
				if (alpha > 0)
				{
					alpha -= 55;
					scale = 1.3f;
					if (alpha < 0)
					{
						alpha = 0;
						float num119 = 16f;
						for (int num120 = 0; (float)num120 < num119; num120++)
						{
							Vector2 spinningpoint7 = Vector2.UnitX * 0f;
							spinningpoint7 += -Vector2.UnitY.RotatedBy((float)num120 * (MathF.PI * 2f / num119)) * new Vector2(1f, 4f);
							spinningpoint7 = spinningpoint7.RotatedBy(velocity.ToRotation());
							int num121 = Dust.NewDust(base.Center, 0, 0, 62);
							Main.dust[num121].scale = 1.5f;
							Main.dust[num121].noLight = true;
							Main.dust[num121].noGravity = true;
							Main.dust[num121].position = base.Center + spinningpoint7;
							Main.dust[num121].velocity = Main.dust[num121].velocity * 4f + velocity * 0.3f;
						}
					}
				}
			}
			if (type == 706)
			{
				if (wet)
				{
					Kill();
					return;
				}
				SlotId val;
				if (localAI[1] == 0f)
				{
					float[] array = localAI;
					val = SoundEngine.PlayTrackedSound(SoundID.DD2_PhantomPhoenixShot, base.Center);
					array[0] = ((SlotId)(ref val)).ToFloat();
					localAI[1] += 1f;
					for (int num122 = 0; num122 < 15; num122++)
					{
						if (Main.rand.Next(4) != 0)
						{
							Dust dust7 = Dust.NewDustDirect(base.Center - base.Size / 4f, width / 2, height / 2, Utils.SelectRandom<int>(Main.rand, 6, 31, 31));
							dust7.noGravity = true;
							dust7.velocity *= 2.3f;
							dust7.fadeIn = 1.5f;
							dust7.noLight = true;
						}
					}
				}
				ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[0]));
				if (activeSound != null)
				{
					activeSound.Position = base.Center;
				}
				else
				{
					float[] array2 = localAI;
					val = SlotId.Invalid;
					array2[0] = ((SlotId)(ref val)).ToFloat();
				}
				if (alpha <= 0)
				{
					for (int num123 = 0; num123 < 2; num123++)
					{
						if (Main.rand.Next(4) != 0)
						{
							Dust dust8 = Dust.NewDustDirect(base.Center - base.Size / 4f, width / 2, height / 2, Utils.SelectRandom<int>(Main.rand, 6, 31, 31));
							dust8.noGravity = true;
							dust8.velocity *= 2.3f;
							dust8.fadeIn = 1.5f;
							dust8.noLight = true;
						}
					}
					Vector2 spinningpoint8 = new Vector2(0f, (float)Math.Cos((float)frameCounter * (MathF.PI * 2f) / 40f - MathF.PI / 2f)) * 16f;
					spinningpoint8 = spinningpoint8.RotatedBy(rotation);
					Vector2 vector23 = velocity.SafeNormalize(Vector2.Zero);
					for (int num124 = 0; num124 < 1; num124++)
					{
						Dust dust9 = Dust.NewDustDirect(base.Center - base.Size / 4f, width / 2, height / 2, 6);
						dust9.noGravity = true;
						dust9.position = base.Center + spinningpoint8;
						dust9.velocity *= 0f;
						dust9.fadeIn = 1.4f;
						dust9.scale = 1.15f;
						dust9.noLight = true;
						dust9.position += velocity * 1.2f;
						dust9.velocity += vector23 * 2f;
						Dust dust10 = Dust.NewDustDirect(base.Center - base.Size / 4f, width / 2, height / 2, 6);
						dust10.noGravity = true;
						dust10.position = base.Center + spinningpoint8;
						dust10.velocity *= 0f;
						dust10.fadeIn = 1.4f;
						dust10.scale = 1.15f;
						dust10.noLight = true;
						dust10.position += velocity * 0.5f;
						dust10.position += velocity * 1.2f;
						dust10.velocity += vector23 * 2f;
					}
				}
				if (++frameCounter >= 40)
				{
					frameCounter = 0;
				}
				frame = frameCounter / 5;
				if (alpha > 0)
				{
					alpha -= 55;
					if (alpha < 0)
					{
						alpha = 0;
						float num125 = 16f;
						for (int num126 = 0; (float)num126 < num125; num126++)
						{
							Vector2 spinningpoint9 = Vector2.UnitX * 0f;
							spinningpoint9 += -Vector2.UnitY.RotatedBy((float)num126 * (MathF.PI * 2f / num125)) * new Vector2(1f, 4f);
							spinningpoint9 = spinningpoint9.RotatedBy(velocity.ToRotation());
							int num127 = Dust.NewDust(base.Center, 0, 0, 6);
							Main.dust[num127].scale = 1.5f;
							Main.dust[num127].noLight = true;
							Main.dust[num127].noGravity = true;
							Main.dust[num127].position = base.Center + spinningpoint9;
							Main.dust[num127].velocity = Main.dust[num127].velocity * 4f + velocity * 0.3f;
						}
					}
				}
				DelegateMethods.v3_1 = new Vector3(1f, 0.6f, 0.2f);
				Utils.PlotTileLine(base.Center, base.Center + velocity * 4f, 40f, DelegateMethods.CastLightOpen);
			}
			if (type == 638)
			{
				float num128 = velocity.Length();
				if (alpha > 0)
				{
					alpha -= (byte)((double)num128 * 0.3);
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				Rectangle hitbox = base.Hitbox;
				hitbox.Offset((int)velocity.X, (int)velocity.Y);
				bool flag2 = false;
				for (int num129 = 0; num129 < 200; num129++)
				{
					NPC nPC = Main.npc[num129];
					if (nPC.active && !nPC.dontTakeDamage && nPC.immune[owner] == 0 && localNPCImmunity[num129] == 0 && nPC.Hitbox.Intersects(hitbox) && !nPC.friendly)
					{
						flag2 = true;
						break;
					}
				}
				if (flag2)
				{
					int num130 = Main.rand.Next(15, 31);
					for (int num131 = 0; num131 < num130; num131++)
					{
						int num132 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100, default(Color), 0.8f);
						Main.dust[num132].velocity *= 1.6f;
						Main.dust[num132].velocity.Y -= 1f;
						Main.dust[num132].velocity += velocity;
						Main.dust[num132].noGravity = true;
					}
				}
			}
			if (type == 257 || type == 593)
			{
				if (alpha > 0)
				{
					alpha -= 10;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (type == 876)
			{
				if (ai[1] == 0f)
				{
					tileCollide = true;
				}
				else
				{
					tileCollide = false;
				}
				if (alpha > 0)
				{
					alpha -= 10;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (type == 88)
			{
				if (alpha > 0)
				{
					alpha -= 10;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (type == 532)
			{
				ai[0] += 1f;
			}
			bool flag3 = true;
			bool flag4 = false;
			switch (type)
			{
			case 5:
			case 14:
			case 20:
			case 36:
			case 38:
			case 55:
			case 83:
			case 84:
			case 88:
			case 89:
			case 98:
			case 100:
			case 104:
			case 110:
			case 158:
			case 159:
			case 160:
			case 161:
			case 180:
			case 184:
			case 242:
			case 248:
			case 257:
			case 259:
			case 265:
			case 270:
			case 279:
			case 283:
			case 284:
			case 285:
			case 286:
			case 287:
			case 299:
			case 302:
			case 323:
			case 325:
			case 348:
			case 349:
			case 350:
			case 355:
			case 374:
			case 376:
			case 389:
			case 435:
			case 436:
			case 438:
			case 440:
			case 442:
			case 449:
			case 459:
			case 462:
			case 467:
			case 468:
			case 469:
			case 472:
			case 483:
			case 484:
			case 485:
			case 498:
			case 576:
			case 577:
			case 585:
			case 592:
			case 593:
			case 601:
			case 606:
			case 616:
			case 634:
			case 635:
			case 638:
			case 639:
			case 660:
			case 661:
			case 682:
			case 684:
			case 706:
			case 709:
			case 710:
			case 712:
			case 876:
			case 980:
			case 981:
				flag3 = false;
				break;
			case 1006:
				flag4 = true;
				break;
			}
			if (flag3)
			{
				ai[0] += 1f;
			}
			if (type == 1006 && Main.rand.Next(8) == 0)
			{
				Dust dust11 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(4f, 4f), 306, velocity * 1.25f, 0, Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f), 1f + Main.rand.NextFloat() * 0.4f);
				dust11.noGravity = true;
				dust11.fadeIn = dust11.scale + 0.05f;
				Dust dust12 = Dust.CloneDust(dust11);
				dust12.color = Color.White;
				dust12.scale -= 0.3f;
			}
			if (type == 270)
			{
				int num133 = 0;
				num133 = Player.FindClosest(base.Center, 1, 1);
				ai[1] += 1f;
				if (ai[1] < 110f && ai[1] > 30f)
				{
					float num134 = velocity.Length();
					Vector2 vector24 = Main.player[num133].Center - base.Center;
					vector24.Normalize();
					vector24 *= num134;
					velocity = (velocity * 24f + vector24) / 25f;
					velocity.Normalize();
					velocity *= num134;
				}
				if (velocity.Length() < 18f)
				{
					velocity *= 1.02f;
				}
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item8, position);
					for (int num135 = 0; num135 < 10; num135++)
					{
						int num136 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 5, velocity.X, velocity.Y, 0, default(Color), 2f);
						Main.dust[num136].noGravity = true;
						Main.dust[num136].velocity = base.Center - Main.dust[num136].position;
						Main.dust[num136].velocity.Normalize();
						Main.dust[num136].velocity *= -5f;
						Main.dust[num136].velocity += velocity / 2f;
					}
				}
			}
			if (type == 585)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item8, position);
					for (int num137 = 0; num137 < 3; num137++)
					{
						int num138 = Dust.NewDust(position, width, height, 27, velocity.X, velocity.Y, 0, default(Color), 2f);
						Main.dust[num138].noGravity = true;
						Main.dust[num138].velocity = base.Center - Main.dust[num138].position;
						Main.dust[num138].velocity.Normalize();
						Main.dust[num138].velocity *= -5f;
						Main.dust[num138].velocity += velocity / 2f;
						Main.dust[num138].noLight = true;
					}
				}
				if (alpha > 0)
				{
					alpha -= 50;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				frameCounter++;
				if (frameCounter >= 12)
				{
					frameCounter = 0;
				}
				frame = frameCounter / 2;
				if (frame > 3)
				{
					frame = 6 - frame;
				}
				Vector3 vector25 = NPCID.Sets.MagicAuraColor[54].ToVector3();
				Lighting.AddLight(base.Center, vector25.X, vector25.Y, vector25.Z);
				if (Main.rand.Next(3) == 0)
				{
					int num139 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 27, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
					Main.dust[num139].position -= velocity * 2f;
					Main.dust[num139].noLight = true;
					Main.dust[num139].noGravity = true;
					Main.dust[num139].velocity.X *= 0.3f;
					Main.dust[num139].velocity.Y *= 0.3f;
				}
			}
			if (type == 594)
			{
				int num140 = (int)(43f - ai[1]) / 13;
				if (num140 < 1)
				{
					num140 = 1;
				}
				int num141 = ((ai[1] < 20f) ? 6 : 31);
				for (int num142 = 0; num142 < num140; num142++)
				{
					int num143 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, num141, velocity.X * 0.2f, velocity.Y * 0.2f, 0, default(Color), 2f);
					Main.dust[num143].position -= velocity * 2f;
					Main.dust[num143].noLight = true;
					Main.dust[num143].noGravity = true;
					Main.dust[num143].velocity.X *= 0.3f;
					Main.dust[num143].velocity.Y *= 0.3f;
					if (num141 == 6)
					{
						Main.dust[num143].fadeIn = Main.rand.NextFloat() * 2f;
					}
				}
				ai[1] += 1f;
				if (ai[1] > (float)(43 * MaxUpdates))
				{
					Kill();
					return;
				}
			}
			if (type == 622)
			{
				int num144 = 229;
				if (Main.rand.Next(3) != 0)
				{
					int num145 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, num144, velocity.X * 0.2f, velocity.Y * 0.2f, 0, default(Color), 1.2f);
					Main.dust[num145].position -= velocity * 2f;
					Main.dust[num145].noLight = true;
					Main.dust[num145].noGravity = true;
					Main.dust[num145].velocity.X *= 0.3f;
					Main.dust[num145].velocity.Y *= 0.3f;
				}
				ai[1] += 1f;
				if (ai[1] > (float)(23 * MaxUpdates))
				{
					Kill();
					return;
				}
			}
			if (type == 587)
			{
				Color newColor2 = Main.hslToRgb(ai[1], 1f, 0.5f);
				newColor2.A = 200;
				localAI[0] += 1f;
				if (!(localAI[0] < 2f))
				{
					if (localAI[0] == 2f)
					{
						SoundEngine.PlaySound(SoundID.Item5, position);
						for (int num146 = 0; num146 < 4; num146++)
						{
							int num147 = Dust.NewDust(position, width, height, 76, velocity.X, velocity.Y, 0, newColor2, 1.1f);
							Main.dust[num147].noGravity = true;
							Main.dust[num147].velocity = base.Center - Main.dust[num147].position;
							Main.dust[num147].velocity.Normalize();
							Main.dust[num147].velocity *= -3f;
							Main.dust[num147].velocity += velocity / 2f;
						}
					}
					else
					{
						frame++;
						if (frame > 2)
						{
							frame = 0;
						}
						for (int num148 = 0; num148 < 1; num148++)
						{
							int num149 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 76, velocity.X * 0.2f, velocity.Y * 0.2f, 0, newColor2, 0.9f);
							Main.dust[num149].position = base.Center;
							Main.dust[num149].noGravity = true;
							Main.dust[num149].velocity = velocity * 0.5f;
						}
					}
				}
			}
			if (type == 349)
			{
				frame = (int)ai[0];
				velocity.Y += 0.2f;
				if (localAI[0] == 0f || localAI[0] == 2f)
				{
					scale += 0.01f;
					alpha -= 50;
					if (alpha <= 0)
					{
						localAI[0] = 1f;
						alpha = 0;
					}
				}
				else if (localAI[0] == 1f)
				{
					scale -= 0.01f;
					alpha += 50;
					if (alpha >= 255)
					{
						localAI[0] = 2f;
						alpha = 255;
					}
				}
			}
			if (type == 348)
			{
				if (localAI[1] == 0f)
				{
					localAI[1] = 1f;
					SoundEngine.PlaySound(SoundID.Item8, position);
				}
				if (ai[0] == 0f || ai[0] == 2f)
				{
					scale += 0.01f;
					alpha -= 50;
					if (alpha <= 0)
					{
						ai[0] = 1f;
						alpha = 0;
					}
				}
				else if (ai[0] == 1f)
				{
					scale -= 0.01f;
					alpha += 50;
					if (alpha >= 255)
					{
						ai[0] = 2f;
						alpha = 255;
					}
				}
			}
			if (type == 572)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item17, position);
				}
				for (int num150 = 0; num150 < 2; num150++)
				{
					int num151 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 40, velocity.X, velocity.Y, 100);
					Main.dust[num151].velocity *= 0.5f;
					Main.dust[num151].velocity += velocity;
					Main.dust[num151].velocity *= 0.5f;
					Main.dust[num151].noGravity = true;
					Main.dust[num151].scale = 1.2f;
					Main.dust[num151].position = (base.Center + position) / 2f;
				}
			}
			if (type == 577)
			{
				Lighting.AddLight(base.Center, 0.1f, 0.3f, 0.4f);
			}
			else if (type == 576)
			{
				Lighting.AddLight(base.Center, 0.4f, 0.2f, 0.4f);
				for (int num152 = 0; num152 < 5; num152++)
				{
					Dust obj5 = Main.dust[Dust.NewDust(position, width, height, 242, velocity.X, velocity.Y, 100)];
					obj5.velocity = Vector2.Zero;
					obj5.position -= velocity / 5f * num152;
					obj5.noGravity = true;
					obj5.scale = 0.8f;
					obj5.noLight = true;
				}
			}
			else if (type == 581)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item17, base.Center);
				}
				for (int num153 = 0; num153 < 2; num153++)
				{
					int num154 = Utils.SelectRandom<int>(Main.rand, 229, 161, 161);
					Dust obj6 = Main.dust[Dust.NewDust(position, width, height, num154, velocity.X, velocity.Y, 100)];
					obj6.velocity = obj6.velocity / 4f + velocity / 2f;
					obj6.noGravity = true;
					obj6.scale = 1.2f;
					obj6.position = base.Center;
					obj6.noLight = true;
				}
			}
			else if (type == 671)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					for (int num155 = 0; num155 < 8; num155++)
					{
						int num156 = Utils.SelectRandom<int>(Main.rand, 27, 62);
						Dust obj7 = Main.dust[Dust.NewDust(position, width, height, num156, velocity.X, velocity.Y, 100)];
						obj7.velocity = (Main.rand.NextFloatDirection() * MathF.PI).ToRotationVector2() * 2f + velocity.SafeNormalize(Vector2.Zero) * 3f;
						obj7.noGravity = true;
						obj7.scale = 1.5f;
						obj7.fadeIn = 1.2f;
						obj7.position = base.Center;
						obj7.noLight = true;
					}
				}
				alpha -= 20;
				if (alpha < 0)
				{
					alpha = 0;
				}
				for (int num157 = 0; num157 < 2; num157++)
				{
					int num158 = Utils.SelectRandom<int>(Main.rand, 27, 27, 62);
					Dust obj8 = Main.dust[Dust.NewDust(position, width, height, num158, velocity.X, velocity.Y, 100)];
					obj8.velocity = obj8.velocity / 4f + velocity / 2f;
					obj8.noGravity = true;
					obj8.scale = 1.2f;
					obj8.position = base.Center;
					obj8.noLight = true;
				}
			}
			else if (type == 811)
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item17, base.Center);
					localAI[0] = 1f;
					for (int num159 = 0; num159 < 8; num159++)
					{
						Dust obj9 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
						obj9.velocity = (Main.rand.NextFloatDirection() * MathF.PI).ToRotationVector2() * 2f + velocity.SafeNormalize(Vector2.Zero) * 3f;
						obj9.scale = 1.5f;
						obj9.fadeIn = 1.7f;
						obj9.position = base.Center;
					}
				}
				alpha -= 20;
				if (alpha < 0)
				{
					alpha = 0;
				}
				for (int num160 = 0; num160 < 2; num160++)
				{
					Dust obj10 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
					obj10.velocity = obj10.velocity / 4f + velocity / 2f;
					obj10.scale = 1.2f;
					obj10.position = base.Center + Main.rand.NextFloat() * velocity * 2f;
				}
			}
			else if (type == 819)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					for (int num161 = 0; num161 < 8; num161++)
					{
						Dust obj11 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
						obj11.velocity = (Main.rand.NextFloatDirection() * MathF.PI).ToRotationVector2() * 2f + velocity.SafeNormalize(Vector2.Zero) * 2f;
						obj11.scale = 0.9f;
						obj11.fadeIn = 1.3f;
						obj11.position = base.Center;
					}
				}
				alpha -= 20;
				if (alpha < 0)
				{
					alpha = 0;
				}
				for (int num162 = 1; num162 < 6; num162++)
				{
					Dust obj12 = Main.dust[Dust.NewDust(position, width, height, 5, 0f, 0f, 100)];
					obj12.velocity = obj12.velocity * 0.5f + velocity * 0.5f;
					obj12.velocity *= 0.25f;
					obj12.scale = 0.9f;
					obj12.position = base.Center - velocity * num162 / 5f;
				}
				if (Main.rand.Next(2) == 0)
				{
					Dust dust13 = Dust.NewDustPerfect(base.Center - velocity * 3f, 267, velocity * 0.5f, 0, Color.Red * (Main.rand.NextFloat() * 0.3f + 0.1f));
					dust13.noGravity = true;
					dust13.scale = 0.7f;
				}
				Lighting.AddLight(base.Center, 0.3f, 0.05f, 0.05f);
			}
			else if (type == 814)
			{
				if (localAI[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item171, base.Center);
					localAI[0] = 1f;
					for (int num163 = 0; num163 < 8; num163++)
					{
						Dust obj13 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
						obj13.velocity = (Main.rand.NextFloatDirection() * MathF.PI).ToRotationVector2() * 2f + velocity.SafeNormalize(Vector2.Zero) * 2f;
						obj13.scale = 0.9f;
						obj13.fadeIn = 1.1f;
						obj13.position = base.Center;
					}
				}
				alpha -= 20;
				if (alpha < 0)
				{
					alpha = 0;
				}
				for (int num164 = 0; num164 < 2; num164++)
				{
					Dust obj14 = Main.dust[Dust.NewDust(position, width, height, 5, velocity.X, velocity.Y, 100)];
					obj14.velocity = obj14.velocity / 4f + velocity / 2f;
					obj14.scale = 1.2f;
					obj14.position = base.Center + Main.rand.NextFloat() * velocity * 2f;
				}
				for (int num165 = 1; num165 < oldPos.Length && !(oldPos[num165] == Vector2.Zero); num165++)
				{
					if (Main.rand.Next(3) == 0)
					{
						Dust obj15 = Main.dust[Dust.NewDust(oldPos[num165], width, height, 5, velocity.X, velocity.Y, 100)];
						obj15.velocity = obj15.velocity / 4f + velocity / 2f;
						obj15.scale = 1.2f;
						obj15.position = oldPos[num165] + base.Size / 2f + Main.rand.NextFloat() * velocity * 2f;
					}
				}
			}
			else if (type == 675)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlayTrackedSound(SoundID.DD2_DarkMageAttack, base.Center);
				}
				alpha -= 20;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			else if (type == 676)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item17, base.Center);
				}
				alpha -= 20;
				if (alpha < 0)
				{
					alpha = 0;
				}
				for (int num166 = 0; num166 < 2; num166++)
				{
					if (Main.rand.Next(5) != 0)
					{
						int num167 = Utils.SelectRandom<int>(Main.rand, 4, 256);
						Dust dust14 = Main.dust[Dust.NewDust(position, width, height, num167, velocity.X, velocity.Y, 100)];
						dust14.velocity = dust14.velocity / 4f + velocity / 2f;
						dust14.scale = 0.8f + Main.rand.NextFloat() * 0.4f;
						dust14.position = base.Center;
						dust14.position += new Vector2(width * 2, 0f).RotatedBy(MathF.PI * 2f * Main.rand.NextFloat()) * Main.rand.NextFloat();
						dust14.noLight = true;
						if (dust14.type == 4)
						{
							dust14.color = new Color(80, 170, 40, 120);
						}
					}
				}
			}
			else if (type == 686)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlayTrackedSound(SoundID.DD2_BetsyFireballShot, base.Center);
				}
				if (ai[0] >= 2f)
				{
					alpha -= 25;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				if (Main.rand.Next(4) == 0)
				{
					Dust dust15 = Dust.NewDustDirect(position, width, height, 55, 0f, 0f, 200);
					dust15.scale *= 0.7f;
					dust15.velocity += velocity * 1f;
				}
				if (Main.rand.Next(3) == 0 && oldPos[9] != Vector2.Zero)
				{
					Dust dust16 = Dust.NewDustDirect(oldPos[9], width, height, 55, 0f, 0f, 50);
					dust16.scale *= 0.85f;
					dust16.velocity += velocity * 0.85f;
					dust16.color = Color.Purple;
				}
			}
			else if (type == 711)
			{
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					for (int num168 = 0; num168 < 10; num168++)
					{
						Dust dust17 = Dust.NewDustDirect(position, width, height, 55, 0f, 0f, 200);
						dust17.scale *= 0.65f;
						dust17.velocity *= 1.5f;
						dust17.velocity += velocity * 0.3f;
						dust17.fadeIn = 0.7f;
					}
				}
				if (ai[0] >= 2f)
				{
					alpha -= 25;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				if (Main.rand.Next(4) == 0)
				{
					Dust dust18 = Dust.NewDustDirect(position, width, height, 55, 0f, 0f, 200);
					dust18.scale *= 0.7f;
					dust18.velocity += velocity * 1f;
				}
				if (Main.rand.Next(3) == 0 && oldPos[9] != Vector2.Zero)
				{
					Dust dust19 = Dust.NewDustDirect(oldPos[9], width, height, 55, 0f, 0f, 50);
					dust19.scale *= 0.85f;
					dust19.velocity += velocity * 0.85f;
					dust19.color = Color.Purple;
				}
			}
			if (type == 299)
			{
				if (localAI[0] == 6f)
				{
					SoundEngine.PlaySound(SoundID.Item8, position);
					for (int num169 = 0; num169 < 40; num169++)
					{
						int num170 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 181, 0f, 0f, 100);
						Main.dust[num170].velocity *= 3f;
						Main.dust[num170].velocity += velocity * 0.75f;
						Main.dust[num170].scale *= 1.2f;
						Main.dust[num170].noGravity = true;
					}
				}
				localAI[0] += 1f;
				if (localAI[0] > 6f)
				{
					for (int num171 = 0; num171 < 3; num171++)
					{
						int num172 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 181, velocity.X * 0.2f, velocity.Y * 0.2f, 100);
						Main.dust[num172].velocity *= 0.6f;
						Main.dust[num172].scale *= 1.4f;
						Main.dust[num172].noGravity = true;
					}
				}
			}
			else if (type == 270 || type == 837)
			{
				if (type == 270)
				{
					alpha = 0;
				}
				if (alpha > 0)
				{
					alpha -= 50;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				frame++;
				if (frame > 2)
				{
					frame = 0;
				}
				if (type == 270)
				{
					for (int num173 = 0; num173 < 2; num173++)
					{
						int num174 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 5, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 1.5f);
						Main.dust[num174].position -= velocity;
						Main.dust[num174].noGravity = true;
						Main.dust[num174].velocity.X *= 0.3f;
						Main.dust[num174].velocity.Y *= 0.3f;
					}
				}
				else
				{
					for (int num175 = 0; num175 < 2; num175++)
					{
						int num176 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
						Main.dust[num176].position -= velocity * 2f;
						Main.dust[num176].noGravity = true;
						Main.dust[num176].velocity.X *= 0.3f;
						Main.dust[num176].velocity.Y *= 0.3f;
					}
				}
			}
			if (type == 259)
			{
				if (alpha > 0)
				{
					alpha -= 10;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			if (type == 265)
			{
				if (alpha > 0)
				{
					alpha -= 50;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha == 0)
				{
					int num177 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 163, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num177].noGravity = true;
					Main.dust[num177].velocity *= 0.3f;
					Main.dust[num177].velocity -= velocity * 0.4f;
				}
			}
			if (type == 355)
			{
				if (alpha > 0)
				{
					alpha -= 50;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (alpha == 0)
				{
					int num178 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 205, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num178].noGravity = true;
					Main.dust[num178].velocity *= 0.3f;
					Main.dust[num178].velocity -= velocity * 0.4f;
				}
			}
			if (type == 981 && Main.rand.Next(6) == 0)
			{
				int num179 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 279, velocity.X, velocity.Y, 100, default(Color), 1.2f);
				Main.dust[num179].noLightEmittence = true;
				Main.dust[num179].noGravity = true;
				Main.dust[num179].velocity *= 0.2f;
			}
			if (type == 357)
			{
				if (alpha < 170)
				{
					for (int num180 = 0; num180 < 10; num180++)
					{
						float x = position.X - velocity.X / 10f * (float)num180;
						float y = position.Y - velocity.Y / 10f * (float)num180;
						int num181 = Dust.NewDust(new Vector2(x, y), 1, 1, 206);
						Main.dust[num181].alpha = alpha;
						Main.dust[num181].position.X = x;
						Main.dust[num181].position.Y = y;
						Main.dust[num181].velocity *= 0f;
						Main.dust[num181].noGravity = true;
					}
				}
				if (alpha > 0)
				{
					alpha -= 25;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			else if (type == 207 || type == 837)
			{
				if (type == 207 && alpha < 170)
				{
					for (int num182 = 0; num182 < 10; num182++)
					{
						float x2 = position.X - velocity.X / 10f * (float)num182;
						float y2 = position.Y - velocity.Y / 10f * (float)num182;
						int num183 = Dust.NewDust(new Vector2(x2, y2), 1, 1, 75);
						Main.dust[num183].alpha = alpha;
						Main.dust[num183].position.X = x2;
						Main.dust[num183].position.Y = y2;
						Main.dust[num183].velocity *= 0f;
						Main.dust[num183].noGravity = true;
					}
				}
				float num184 = (float)Math.Sqrt(velocity.X * velocity.X + velocity.Y * velocity.Y);
				float num185 = localAI[0];
				if (num185 == 0f)
				{
					localAI[0] = num184;
					num185 = num184;
				}
				if (alpha > 0)
				{
					alpha -= 25;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				float num186 = position.X;
				float num187 = position.Y;
				float num188 = 300f;
				bool flag5 = false;
				int num189 = 0;
				if (ai[1] == 0f)
				{
					for (int num190 = 0; num190 < 200; num190++)
					{
						if (Main.npc[num190].CanBeChasedBy(this) && (ai[1] == 0f || ai[1] == (float)(num190 + 1)))
						{
							float num191 = Main.npc[num190].position.X + (float)(Main.npc[num190].width / 2);
							float num192 = Main.npc[num190].position.Y + (float)(Main.npc[num190].height / 2);
							float num193 = Math.Abs(position.X + (float)(width / 2) - num191) + Math.Abs(position.Y + (float)(height / 2) - num192);
							if (num193 < num188 && Collision.CanHit(new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2)), 1, 1, Main.npc[num190].position, Main.npc[num190].width, Main.npc[num190].height))
							{
								num188 = num193;
								num186 = num191;
								num187 = num192;
								flag5 = true;
								num189 = num190;
							}
						}
					}
					if (flag5)
					{
						ai[1] = num189 + 1;
					}
					flag5 = false;
				}
				if (ai[1] > 0f)
				{
					int num194 = (int)(ai[1] - 1f);
					if (Main.npc[num194].active && Main.npc[num194].CanBeChasedBy(this, ignoreDontTakeDamage: true) && !Main.npc[num194].dontTakeDamage)
					{
						float num195 = Main.npc[num194].position.X + (float)(Main.npc[num194].width / 2);
						float num196 = Main.npc[num194].position.Y + (float)(Main.npc[num194].height / 2);
						if (Math.Abs(position.X + (float)(width / 2) - num195) + Math.Abs(position.Y + (float)(height / 2) - num196) < 1000f)
						{
							flag5 = true;
							num186 = Main.npc[num194].position.X + (float)(Main.npc[num194].width / 2);
							num187 = Main.npc[num194].position.Y + (float)(Main.npc[num194].height / 2);
						}
					}
					else
					{
						ai[1] = 0f;
					}
				}
				if (!friendly)
				{
					flag5 = false;
				}
				if (flag5)
				{
					float num197 = num185;
					Vector2 vector26 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num198 = num186 - vector26.X;
					float num199 = num187 - vector26.Y;
					float num200 = (float)Math.Sqrt(num198 * num198 + num199 * num199);
					num200 = num197 / num200;
					num198 *= num200;
					num199 *= num200;
					int num201 = 8;
					if (type == 837)
					{
						num201 = 32;
					}
					velocity.X = (velocity.X * (float)(num201 - 1) + num198) / (float)num201;
					velocity.Y = (velocity.Y * (float)(num201 - 1) + num199) / (float)num201;
				}
			}
			else if (type == 81 || type == 91)
			{
				if (ai[0] >= 20f)
				{
					ai[0] = 20f;
					velocity.Y += 0.07f;
				}
			}
			else if (type == 174 || type == 605 || type == 920 || type == 921 || type == 926)
			{
				if (ai[0] >= 5f)
				{
					ai[0] = 5f;
					velocity.Y += 0.15f;
				}
			}
			else if (type == 937)
			{
				if (ai[0] >= 5f)
				{
					ai[0] = 5f;
					velocity.Y += 0.07f;
				}
			}
			else if (type == 962)
			{
				frame = (int)ai[1];
				if (localAI[0] == 0f)
				{
					localAI[0] = 1f;
					rotation = velocity.ToRotation();
					for (int num202 = 0; num202 < 5; num202++)
					{
						Dust dust20 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(24f, 24f), 16, velocity * MathHelper.Lerp(0.2f, 0.7f, Main.rand.NextFloat()));
						dust20.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
						dust20.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
					}
					for (int num203 = 0; num203 < 5; num203++)
					{
						Dust dust21 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(24f, 24f), 16, Main.rand.NextVector2Circular(2f, 2f) + velocity * MathHelper.Lerp(0.2f, 0.5f, Main.rand.NextFloat()));
						dust21.velocity += Main.rand.NextVector2Circular(0.5f, 0.5f);
						dust21.scale = 0.8f + Main.rand.NextFloat() * 0.5f;
						dust21.fadeIn = 1f;
					}
				}
				if (ai[0] >= 5f)
				{
					velocity.Y += 0.15f;
				}
			}
			else if (type == 337)
			{
				if (position.Y > Main.player[owner].position.Y - 300f)
				{
					tileCollide = true;
				}
				if ((double)position.Y < Main.worldSurface * 16.0)
				{
					tileCollide = true;
				}
				frame = (int)ai[1];
				if (Main.rand.Next(2) == 0)
				{
					int num204 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 197);
					Main.dust[num204].velocity *= 0.5f;
					Main.dust[num204].noGravity = true;
				}
			}
			else if (type == 645)
			{
				if (ai[1] != -1f && position.Y > ai[1])
				{
					tileCollide = true;
				}
				if (position.HasNaNs())
				{
					Kill();
					return;
				}
				bool num205 = WorldGen.SolidTile(Framing.GetTileSafely((int)position.X / 16, (int)position.Y / 16));
				Dust dust22 = Main.dust[Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229)];
				dust22.position = base.Center;
				dust22.velocity = Vector2.Zero;
				dust22.noGravity = true;
				if (num205)
				{
					dust22.noLight = true;
				}
				if (ai[1] == -1f)
				{
					ai[0] += 1f;
					velocity = Vector2.Zero;
					tileCollide = false;
					penetrate = -1;
					position = base.Center;
					width = (height = 140);
					base.Center = position;
					alpha -= 10;
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (++frameCounter >= MaxUpdates * 3)
					{
						frameCounter = 0;
						frame++;
					}
					if (ai[0] >= (float)(Main.projFrames[type] * MaxUpdates * 3))
					{
						Kill();
					}
					return;
				}
				alpha = 255;
				if (numUpdates == 0)
				{
					int num206 = -1;
					float num207 = 60f;
					for (int num208 = 0; num208 < 200; num208++)
					{
						NPC nPC2 = Main.npc[num208];
						if (nPC2.CanBeChasedBy(this))
						{
							float num209 = Distance(nPC2.Center);
							if (num209 < num207 && Collision.CanHitLine(base.Center, 0, 0, nPC2.Center, 0, 0))
							{
								num207 = num209;
								num206 = num208;
							}
						}
					}
					if (num206 != -1)
					{
						ai[0] = 0f;
						ai[1] = -1f;
						netUpdate = true;
						return;
					}
				}
			}
			else if (type >= 424 && type <= 426)
			{
				if (position.Y > Main.player[owner].position.Y - 300f)
				{
					tileCollide = true;
				}
				if ((double)position.Y < Main.worldSurface * 16.0)
				{
					tileCollide = true;
				}
				scale = ai[1];
				rotation += velocity.X * 2f;
				Vector2 vector27 = base.Center + Vector2.Normalize(velocity) * 10f;
				Dust obj16 = Main.dust[Dust.NewDust(position, width, height, 6)];
				obj16.position = vector27;
				obj16.velocity = velocity.RotatedBy(1.5707963705062866) * 0.33f + velocity / 4f;
				obj16.position += velocity.RotatedBy(1.5707963705062866);
				obj16.fadeIn = 0.5f;
				obj16.noGravity = true;
				Dust obj17 = Main.dust[Dust.NewDust(position, width, height, 6)];
				obj17.position = vector27;
				obj17.velocity = velocity.RotatedBy(-1.5707963705062866) * 0.33f + velocity / 4f;
				obj17.position += velocity.RotatedBy(-1.5707963705062866);
				obj17.fadeIn = 0.5f;
				obj17.noGravity = true;
				for (int num210 = 0; num210 < 1; num210++)
				{
					int num211 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6);
					Main.dust[num211].velocity *= 0.5f;
					Main.dust[num211].scale *= 1.3f;
					Main.dust[num211].fadeIn = 1f;
					Main.dust[num211].noGravity = true;
				}
			}
			else if (type == 344)
			{
				if (WorldGen.SolidTile((int)position.X / 16, (int)(position.Y + velocity.Y) / 16 + 1) || WorldGen.SolidTile((int)(position.X + (float)width) / 16, (int)(position.Y + velocity.Y) / 16 + 1))
				{
					Kill();
					return;
				}
				localAI[1] += 1f;
				if (localAI[1] > 5f)
				{
					alpha -= 50;
					if (alpha < 0)
					{
						alpha = 0;
					}
				}
				frame = (int)ai[1];
				if (localAI[1] > 20f)
				{
					localAI[1] = 20f;
					velocity.Y += 0.15f;
				}
			}
			else if (type == 336 || type == 345)
			{
				if (type == 345 && localAI[0] == 0f)
				{
					localAI[0] = 1f;
					SoundEngine.PlaySound(SoundID.Item1, position);
				}
				if (ai[0] >= 50f)
				{
					ai[0] = 50f;
					velocity.Y += 0.5f;
				}
			}
			else if (type == 246)
			{
				alpha -= 20;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (ai[0] >= 60f)
				{
					ai[0] = 60f;
					velocity.Y += 0.15f;
				}
			}
			else if (type == 311)
			{
				if (alpha > 0)
				{
					alpha -= 50;
				}
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (ai[0] >= 30f)
				{
					ai[0] = 30f;
					if (ai[1] == 0f)
					{
						ai[1] = 1f;
					}
					velocity.Y += 0.5f;
				}
			}
			else if (type == 312)
			{
				if (ai[0] >= 5f)
				{
					alpha = 0;
				}
				if (ai[0] >= 20f)
				{
					ai[0] = 30f;
					velocity.Y += 0.5f;
				}
				Lighting.AddLight(base.Center, 0.6f, 0.4f, 0.3f);
			}
			else if (type != 239 && type != 264)
			{
				if (type == 176)
				{
					if (ai[0] >= 15f)
					{
						ai[0] = 15f;
						velocity.Y += 0.05f;
					}
				}
				else if (type == 275 || type == 276)
				{
					if (alpha > 0)
					{
						alpha -= 30;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (ai[0] >= 35f)
					{
						ai[0] = 35f;
						velocity.Y += 0.025f;
					}
					if (Main.expertMode)
					{
						float num212 = 18f;
						int num213 = Player.FindClosest(base.Center, 1, 1);
						Vector2 vector28 = Main.player[num213].Center - base.Center;
						vector28.Normalize();
						vector28 *= num212;
						int num214 = 70;
						velocity = (velocity * (num214 - 1) + vector28) / num214;
						if (velocity.Length() < 14f)
						{
							velocity.Normalize();
							velocity *= 14f;
						}
						tileCollide = false;
						if (timeLeft > 180)
						{
							timeLeft = 180;
						}
					}
				}
				else if (type == 172)
				{
					if (ai[0] >= 17f)
					{
						ai[0] = 17f;
						velocity.Y += 0.085f;
					}
				}
				else if (type == 117)
				{
					if (ai[0] >= 35f)
					{
						ai[0] = 35f;
						velocity.Y += 0.06f;
					}
				}
				else if (type == 120)
				{
					int num215 = Dust.NewDust(new Vector2(position.X - velocity.X, position.Y - velocity.Y), width, height, 67, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num215].noGravity = true;
					Main.dust[num215].velocity *= 0.3f;
					if (ai[0] >= 30f)
					{
						ai[0] = 30f;
						velocity.Y += 0.05f;
					}
				}
				else if (type == 195)
				{
					int num216 = 40;
					if (ai[0] >= (float)num216)
					{
						ai[0] = num216;
						velocity.Y += 0.15f;
						tileCollide = true;
					}
					else
					{
						tileCollide = velocity.Y > 0f;
					}
				}
				else if (type == 267 || type == 477 || type == 478 || type == 479)
				{
					localAI[0] += 1f;
					if (localAI[0] > 3f)
					{
						alpha = 0;
					}
					if (ai[0] >= 20f)
					{
						ai[0] = 20f;
						if (type != 477)
						{
							velocity.Y += 0.075f;
						}
					}
					if (type == 479 && Main.myPlayer == owner)
					{
						if (ai[1] >= 0f)
						{
							maxPenetrate = (penetrate = -1);
						}
						else if (penetrate < 0)
						{
							maxPenetrate = (penetrate = 1);
						}
						if (ai[1] >= 0f)
						{
							ai[1] += 1f;
						}
						if (ai[1] > (float)Main.rand.Next(5, 30))
						{
							ai[1] = -1000f;
							float num217 = velocity.Length();
							Vector2 vector29 = velocity;
							vector29.Normalize();
							int num218 = Main.rand.Next(2, 4);
							if (Main.rand.Next(4) == 0)
							{
								num218++;
							}
							for (int num219 = 0; num219 < num218; num219++)
							{
								Vector2 vector30 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
								vector30.Normalize();
								vector30 += vector29 * 2f;
								vector30.Normalize();
								vector30 *= num217;
								NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector30.X, vector30.Y, type, damage, knockBack, owner, 0f, -1000f);
							}
						}
					}
					if (type == 478 && Main.myPlayer == owner)
					{
						ai[1] += 1f;
						if (ai[1] > (float)Main.rand.Next(5, 20))
						{
							if (timeLeft > 40)
							{
								timeLeft -= 20;
							}
							ai[1] = 0f;
							NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 480, (int)((double)damage * 0.8), knockBack * 0.5f, owner);
						}
					}
				}
				else if (type == 408)
				{
					if (ai[0] >= 45f)
					{
						ai[0] = 45f;
						velocity.Y += 0.05f;
					}
				}
				else if (type == 616)
				{
					if (alpha < 170)
					{
						float num220 = 3f;
						for (int num221 = 0; (float)num221 < num220; num221++)
						{
							int num222 = Dust.NewDust(position, 1, 1, 229);
							Main.dust[num222].position = base.Center - velocity / num220 * num221;
							Main.dust[num222].velocity *= 0f;
							Main.dust[num222].noGravity = true;
							Main.dust[num222].alpha = 200;
							Main.dust[num222].scale = 0.5f;
						}
					}
					float num223 = (float)Math.Sqrt(velocity.X * velocity.X + velocity.Y * velocity.Y);
					float num224 = localAI[0];
					if (num224 == 0f)
					{
						localAI[0] = num223;
						num224 = num223;
					}
					if (alpha > 0)
					{
						alpha -= 25;
					}
					if (alpha < 0)
					{
						alpha = 0;
					}
					float num225 = position.X;
					float num226 = position.Y;
					float num227 = 800f;
					bool flag6 = false;
					int num228 = 0;
					ai[0] += 1f;
					if (ai[0] > 20f)
					{
						ai[0] -= 1f;
						if (ai[1] == 0f)
						{
							for (int num229 = 0; num229 < 200; num229++)
							{
								if (Main.npc[num229].CanBeChasedBy(this) && (ai[1] == 0f || ai[1] == (float)(num229 + 1)))
								{
									float num230 = Main.npc[num229].position.X + (float)(Main.npc[num229].width / 2);
									float num231 = Main.npc[num229].position.Y + (float)(Main.npc[num229].height / 2);
									float num232 = Math.Abs(position.X + (float)(width / 2) - num230) + Math.Abs(position.Y + (float)(height / 2) - num231);
									if (num232 < num227 && Collision.CanHit(new Vector2(position.X + (float)(width / 2), position.Y + (float)(height / 2)), 1, 1, Main.npc[num229].position, Main.npc[num229].width, Main.npc[num229].height))
									{
										num227 = num232;
										num225 = num230;
										num226 = num231;
										flag6 = true;
										num228 = num229;
									}
								}
							}
							if (flag6)
							{
								ai[1] = num228 + 1;
							}
							flag6 = false;
						}
						if (ai[1] != 0f)
						{
							int num233 = (int)(ai[1] - 1f);
							if (Main.npc[num233].active && Main.npc[num233].CanBeChasedBy(this, ignoreDontTakeDamage: true))
							{
								float num234 = Main.npc[num233].position.X + (float)(Main.npc[num233].width / 2);
								float num235 = Main.npc[num233].position.Y + (float)(Main.npc[num233].height / 2);
								if (Math.Abs(position.X + (float)(width / 2) - num234) + Math.Abs(position.Y + (float)(height / 2) - num235) < 1000f)
								{
									flag6 = true;
									num225 = Main.npc[num233].position.X + (float)(Main.npc[num233].width / 2);
									num226 = Main.npc[num233].position.Y + (float)(Main.npc[num233].height / 2);
								}
							}
						}
						if (!friendly)
						{
							flag6 = false;
						}
						if (flag6)
						{
							float num236 = num224;
							Vector2 vector31 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
							float num237 = num225 - vector31.X;
							float num238 = num226 - vector31.Y;
							float num239 = (float)Math.Sqrt(num237 * num237 + num238 * num238);
							num239 = num236 / num239;
							num237 *= num239;
							num238 *= num239;
							int num240 = 8;
							velocity.X = (velocity.X * (float)(num240 - 1) + num237) / (float)num240;
							velocity.Y = (velocity.Y * (float)(num240 - 1) + num238) / (float)num240;
						}
					}
				}
				else if (type == 507 || type == 508 || type == 662 || type == 680 || type == 685)
				{
					if (ai[0] > 60f)
					{
						velocity.X *= 0.98f;
						velocity.Y += 0.3f;
					}
				}
				else if (type == 495)
				{
					int num241 = Dust.NewDust(new Vector2(position.X - velocity.X, position.Y - velocity.Y), width, height, 27, velocity.X, velocity.Y, 100, default(Color), 1.2f);
					Main.dust[num241].noGravity = true;
					Main.dust[num241].velocity *= 0.3f;
					if (ai[0] >= 30f)
					{
						ai[0] = 30f;
						velocity.Y += 0.04f;
					}
				}
				else if (type == 498)
				{
					if (localAI[0] == 0f)
					{
						localAI[0] += 1f;
						SoundEngine.PlaySound(SoundID.Item17, position);
					}
					ai[0] += 1f;
					if (ai[0] >= 50f)
					{
						velocity.X *= 0.98f;
						velocity.Y += 0.15f;
						rotation += (float)direction * 0.5f;
					}
					else
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					}
				}
				else if (type == 437)
				{
					if (ai[0] >= 12f)
					{
						if (ai[0] >= 20f)
						{
							Kill();
						}
						alpha += 30;
					}
				}
				else if (type != 442 && type != 634 && type != 635 && type != 675)
				{
					if (type == 686 || type == 711)
					{
						if (ai[0] >= 10f)
						{
							velocity.Y += 0.1f;
						}
						if (ai[0] >= 20f)
						{
							velocity.Y += 0.1f;
						}
						if (ai[0] > 20f)
						{
							ai[0] = 20f;
						}
						velocity.X *= 0.99f;
						if (velocity.Y > 32f)
						{
							velocity.Y = 32f;
						}
					}
					else if (type == 639)
					{
						if (timeLeft <= MaxUpdates * 45 - 14)
						{
							velocity.Y += 0.1f;
						}
					}
					else if (type == 710)
					{
						if (ai[0] >= 0f)
						{
							ai[0] += 1f;
							if (ai[0] >= 20f)
							{
								velocity.Y += 0.2f;
								if (velocity.Y > 0f)
								{
									velocity.X *= 0.98f;
								}
								if (velocity.Y > 12f)
								{
									velocity.Y = 12f;
								}
							}
						}
					}
					else if (ai[0] >= 15f)
					{
						ai[0] = 15f;
						if (flag4)
						{
							velocity.Y -= 0.1f;
						}
						else
						{
							velocity.Y += 0.1f;
						}
					}
				}
			}
			if (type == 921 || type == 926 || type == 937)
			{
				rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.05f;
			}
			else if (type == 248)
			{
				if (velocity.X < 0f)
				{
					rotation -= (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.05f;
				}
				else
				{
					rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.05f;
				}
			}
			else if (type == 270 || type == 585 || type == 601 || type == 706 || type == 837)
			{
				spriteDirection = direction;
				if (direction < 0)
				{
					rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				}
			}
			else if (type == 311)
			{
				if (ai[1] != 0f)
				{
					rotation += velocity.X * 0.1f + (float)Main.rand.Next(-10, 11) * 0.025f;
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			else if (type == 312)
			{
				rotation += velocity.X * 0.02f;
			}
			else if (type == 675)
			{
				rotation += velocity.X * 0.03f;
			}
			else if (type != 676)
			{
				if (type == 408)
				{
					rotation = velocity.ToRotation();
					if (direction == -1)
					{
						rotation += MathF.PI;
					}
				}
				else if (type == 435 || type == 459 || type == 682 || type == 709)
				{
					rotation = velocity.ToRotation();
					if (direction == -1)
					{
						rotation += MathF.PI;
					}
				}
				else if (type == 660)
				{
					rotation = velocity.ToRotation() + MathF.PI / 4f;
				}
				else if (type == 662 || type == 685)
				{
					rotation = velocity.ToRotation() - MathF.PI - MathF.PI / 4f;
				}
				else if (type == 680 || type == 684 || type == 686 || type == 711 || type == 712)
				{
					rotation = velocity.ToRotation() + MathF.PI / 2f;
				}
				else if (type == 436)
				{
					rotation = velocity.ToRotation();
					rotation += MathF.PI;
					if (direction == -1)
					{
						rotation += MathF.PI;
					}
				}
				else if (type == 469)
				{
					if (velocity.X > 0f)
					{
						spriteDirection = -1;
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					}
					else
					{
						spriteDirection = 1;
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					}
				}
				else if (type == 477)
				{
					if (localAI[1] < 5f)
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
						localAI[1] += 1f;
					}
					else
					{
						rotation = (rotation * 2f + (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f) / 3f;
					}
				}
				else if (type == 532)
				{
					rotation += 0.2f + Math.Abs(velocity.X) * 0.1f;
				}
				else if (type == 483)
				{
					rotation += velocity.X * 0.05f;
				}
				else if (type == 772)
				{
					rotation += (float)Math.Sign(velocity.X) * (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.05f;
				}
				else if (type == 485)
				{
					Vector2 vector32 = new Vector2(ai[0], ai[1]);
					velocity = (velocity * 39f + vector32) / 40f;
					int num242 = Dust.NewDust(position, width, height, 6);
					Main.dust[num242].noGravity = true;
					Main.dust[num242].velocity *= 0.2f;
					Main.dust[num242].position = (Main.dust[num242].position + base.Center) / 2f;
					frameCounter++;
					if (frameCounter >= 2)
					{
						frameCounter = 0;
						frame++;
						if (frame >= 5)
						{
							frame = 0;
						}
					}
					if (velocity.X < 0f)
					{
						spriteDirection = -1;
						rotation = (float)Math.Atan2(0f - velocity.Y, 0f - velocity.X);
					}
					else
					{
						spriteDirection = 1;
						rotation = (float)Math.Atan2(velocity.Y, velocity.X);
					}
				}
				else if (type == 640)
				{
					if (velocity != Vector2.Zero)
					{
						rotation = velocity.ToRotation() + MathF.PI / 2f;
					}
				}
				else if (type == 325)
				{
					rotation = velocity.ToRotation() - MathF.PI / 2f;
				}
				else if (type != 344 && type != 498)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
				}
			}
			bool flag7 = true;
			int num243 = type;
			if (num243 == 577)
			{
				flag7 = false;
			}
			if (flag7)
			{
				if (flag4 && velocity.Y < -16f)
				{
					velocity.Y = -16f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
			}
		}

		private void AI_010()
		{
			if (type == 31 && ai[0] != 2f)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 32, 0f, velocity.Y / 2f);
					Main.dust[num].velocity.X *= 0.4f;
				}
			}
			else if (type == 39)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num2 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 38, 0f, velocity.Y / 2f);
					Main.dust[num2].velocity.X *= 0.4f;
				}
			}
			else if (type >= 411 && type <= 414)
			{
				if (Main.rand.Next(3) == 0)
				{
					int num3 = 9;
					if (type == 412 || type == 414)
					{
						num3 = 11;
					}
					if (type == 413)
					{
						num3 = 19;
					}
					int num4 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num3, 0f, velocity.Y / 2f);
					Main.dust[num4].noGravity = true;
					Main.dust[num4].velocity -= velocity * 0.5f;
				}
			}
			else if (type == 40)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num5 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 36, 0f, velocity.Y / 2f);
					Main.dust[num5].velocity *= 0.4f;
				}
			}
			else if (type == 42 || type == 31)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num6 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 32);
					Main.dust[num6].velocity.X *= 0.4f;
				}
			}
			else if (type == 56 || type == 65)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num7 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 14);
					Main.dust[num7].velocity.X *= 0.4f;
				}
			}
			else if (type == 67 || type == 68)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num8 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 51);
					Main.dust[num8].velocity.X *= 0.4f;
				}
			}
			else if (type == 71)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num9 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 53);
					Main.dust[num9].velocity.X *= 0.4f;
				}
			}
			else if (type == 179)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num10 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 149);
					Main.dust[num10].velocity.X *= 0.4f;
				}
			}
			else if (type == 241 || type == 354)
			{
				if (Main.rand.Next(2) == 0)
				{
					int num11 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 36);
					Main.dust[num11].velocity.X *= 0.4f;
				}
			}
			else if (type >= 736 && type <= 738)
			{
				if (Main.rand.Next(40) == 0)
				{
					int num12 = Dust.NewDust(position, width, height, type - 736 + 275);
					if (num12 >= 0)
					{
						Main.dust[num12].velocity = Main.dust[num12].velocity * 0.5f + velocity * 0.5f;
					}
				}
			}
			else if (type != 109 && Main.rand.Next(20) == 0)
			{
				Dust.NewDust(new Vector2(position.X, position.Y), width, height, 0);
			}
			if (type >= 736 && type <= 738)
			{
				if (localAI[0] == 0f)
				{
					frame = Main.rand.Next(3);
					scale = 1f - (float)Main.rand.Next(30) * 0.01f;
				}
				localAI[0] += 1f;
			}
			tileCollide = true;
			localAI[1] = 0f;
			if (Main.myPlayer == owner && ai[0] == 0f)
			{
				tileCollide = false;
				if (Main.player[owner].channel && (type < 736 || type > 738) && type != 40)
				{
					localAI[1] = -1f;
					float num13 = 12f;
					Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num14 = (float)Main.mouseX + Main.screenPosition.X - vector.X;
					float num15 = (float)Main.mouseY + Main.screenPosition.Y - vector.Y;
					if (Main.player[owner].gravDir == -1f)
					{
						num15 = Main.screenPosition.Y + (float)Main.screenHeight - (float)Main.mouseY - vector.Y;
					}
					float num16 = (float)Math.Sqrt(num14 * num14 + num15 * num15);
					num16 = (float)Math.Sqrt(num14 * num14 + num15 * num15);
					if (num16 > num13)
					{
						num16 = num13 / num16;
						num14 *= num16;
						num15 *= num16;
						if (num14 != velocity.X || num15 != velocity.Y)
						{
							netUpdate = true;
						}
						velocity.X = num14;
						velocity.Y = num15;
					}
					else
					{
						if (num14 != velocity.X || num15 != velocity.Y)
						{
							netUpdate = true;
						}
						velocity.X = num14;
						velocity.Y = num15;
					}
				}
				else
				{
					ai[0] = 1f;
					netUpdate = true;
				}
			}
			if (ai[0] == 1f && type != 109)
			{
				if (type == 42 || type == 65 || type == 68 || type == 354)
				{
					ai[1] += 1f;
					if (ai[1] >= 60f)
					{
						ai[1] = 60f;
						velocity.Y += 0.2f;
					}
				}
				else
				{
					velocity.Y += 0.41f;
				}
			}
			else if (ai[0] == 2f && type != 109)
			{
				velocity.Y += 0.2f;
				if ((double)velocity.X < -0.04)
				{
					velocity.X += 0.04f;
				}
				else if ((double)velocity.X > 0.04)
				{
					velocity.X -= 0.04f;
				}
				else
				{
					velocity.X = 0f;
				}
			}
			if (owner == Main.myPlayer && tileCollide)
			{
				for (int i = (int)(position.X / 16f); i <= (int)((position.X + (float)width) / 16f); i++)
				{
					for (int j = (int)(position.Y / 16f); j <= (int)((position.Y + (float)height) / 16f); j++)
					{
						if (!WorldGen.InWorld(i, j))
						{
							continue;
						}
						Tile tile = Main.tile[i, j];
						if (tile == null || !tile.active())
						{
							continue;
						}
						if ((tile.type >= 185 && tile.type <= 187) || tile.type == 165 || tile.type == 12 || tile.type == 665 || tile.type == 639 || tile.type == 105 || tile.type == 178)
						{
							WorldGen.KillTile(i, j);
						}
						else if (tile.topSlope() && !TileID.Sets.Platforms[tile.type])
						{
							WorldGen.SlopeTile(i, j);
							if (Main.netMode != 0)
							{
								NetMessage.SendData(17, -1, -1, null, 14, i, j);
							}
							position.Y -= 16f;
						}
					}
				}
			}
			if (type >= 736 && type <= 738)
			{
				if (frame == 0)
				{
					rotation -= 0.1f;
				}
				else if (frame == 1)
				{
					rotation += 0.1f;
				}
				else
				{
					rotation += 0.15f;
				}
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
			else
			{
				rotation += 0.1f;
				if (velocity.Y > 10f)
				{
					velocity.Y = 10f;
				}
			}
		}

		private void AI_026()
		{
			if (!Main.player[owner].active)
			{
				active = false;
				return;
			}
			bool flag = false;
			bool flag2 = false;
			bool flag3 = false;
			bool flag4 = false;
			bool flag5 = false;
			int num = 85;
			bool flag6 = type >= 191 && type <= 194;
			if (type == 324)
			{
				num = 120;
			}
			if (type == 112)
			{
				num = 100;
			}
			if (type == 127)
			{
				num = 50;
			}
			switch (type)
			{
			case 816:
			case 821:
			case 825:
			case 854:
			case 858:
			case 859:
			case 860:
			case 885:
			case 889:
			case 891:
			case 897:
			case 899:
			case 900:
			case 934:
				num = 95;
				break;
			case 884:
			case 890:
				num = 80;
				break;
			case 881:
				num = 95;
				if (Main.player[owner].ownedProjectileCounts[881] > 0)
				{
					num = 120;
				}
				break;
			}
			if (type == 960)
			{
				Main.CurrentFrameFlags.HadAnActiveInteractibleProjectile = true;
				flag = true;
			}
			if (flag6)
			{
				if (lavaWet)
				{
					ai[0] = 1f;
					ai[1] = 0f;
				}
				num = 60 + 30 * minionPos;
			}
			else if (type == 266)
			{
				num = 60 + 30 * minionPos;
			}
			bool flag7 = ai[0] == -1f || ai[0] == -2f;
			bool num2 = ai[0] == -1f;
			bool flag8 = ai[0] == -2f;
			if (type == 111)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].bunny = false;
				}
				if (Main.player[owner].bunny)
				{
					timeLeft = 2;
				}
			}
			if (type == 112)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].penguin = false;
				}
				if (Main.player[owner].penguin)
				{
					timeLeft = 2;
				}
			}
			if (type == 334)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].puppy = false;
				}
				if (Main.player[owner].puppy)
				{
					timeLeft = 2;
				}
			}
			if (type == 353)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].grinch = false;
				}
				if (Main.player[owner].grinch)
				{
					timeLeft = 2;
				}
			}
			if (type == 127)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].turtle = false;
				}
				if (Main.player[owner].turtle)
				{
					timeLeft = 2;
				}
			}
			if (type == 175)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].eater = false;
				}
				if (Main.player[owner].eater)
				{
					timeLeft = 2;
				}
			}
			if (type == 197)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].skeletron = false;
				}
				if (Main.player[owner].skeletron)
				{
					timeLeft = 2;
				}
			}
			if (type == 198)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].hornet = false;
				}
				if (Main.player[owner].hornet)
				{
					timeLeft = 2;
				}
			}
			if (type == 199)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].tiki = false;
				}
				if (Main.player[owner].tiki)
				{
					timeLeft = 2;
				}
			}
			if (type == 200)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].lizard = false;
				}
				if (Main.player[owner].lizard)
				{
					timeLeft = 2;
				}
			}
			if (type == 208)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].parrot = false;
				}
				if (Main.player[owner].parrot)
				{
					timeLeft = 2;
				}
			}
			if (type == 209)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].truffle = false;
				}
				if (Main.player[owner].truffle)
				{
					timeLeft = 2;
				}
			}
			if (type == 210)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].sapling = false;
				}
				if (Main.player[owner].sapling)
				{
					timeLeft = 2;
				}
			}
			if (type == 324)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].cSapling = false;
				}
				if (Main.player[owner].cSapling)
				{
					timeLeft = 2;
				}
			}
			if (type == 313)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].spider = false;
				}
				if (Main.player[owner].spider)
				{
					timeLeft = 2;
				}
			}
			if (type == 314)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].squashling = false;
				}
				if (Main.player[owner].squashling)
				{
					timeLeft = 2;
				}
			}
			if (type == 211)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].wisp = false;
				}
				if (Main.player[owner].wisp)
				{
					timeLeft = 2;
				}
			}
			if (type == 236)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].dino = false;
				}
				if (Main.player[owner].dino)
				{
					timeLeft = 2;
				}
			}
			if (type == 499)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].babyFaceMonster = false;
				}
				if (Main.player[owner].babyFaceMonster)
				{
					timeLeft = 2;
				}
			}
			if (type == 765)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagSugarGlider = false;
				}
				if (Main.player[owner].petFlagSugarGlider)
				{
					timeLeft = 2;
				}
			}
			if (type == 266)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].slime = false;
				}
				if (Main.player[owner].slime)
				{
					timeLeft = 2;
				}
			}
			if (type == 268)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].eyeSpring = false;
				}
				if (Main.player[owner].eyeSpring)
				{
					timeLeft = 2;
				}
			}
			if (type == 269)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].snowman = false;
				}
				if (Main.player[owner].snowman)
				{
					timeLeft = 2;
				}
			}
			if (type == 319)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].blackCat = false;
				}
				if (Main.player[owner].blackCat)
				{
					timeLeft = 2;
				}
			}
			if (type == 380)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].zephyrfish = false;
				}
				if (Main.player[owner].zephyrfish)
				{
					timeLeft = 2;
				}
			}
			if (type == 774)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagBabyShark = false;
				}
				if (Main.player[owner].petFlagBabyShark)
				{
					timeLeft = 2;
				}
			}
			if (type == 815)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagLilHarpy = false;
				}
				if (Main.player[owner].petFlagLilHarpy)
				{
					timeLeft = 2;
				}
			}
			if (type == 816)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagFennecFox = false;
				}
				if (Main.player[owner].petFlagFennecFox)
				{
					timeLeft = 2;
				}
			}
			if (type == 817)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagGlitteryButterfly = false;
				}
				if (Main.player[owner].petFlagGlitteryButterfly)
				{
					timeLeft = 2;
				}
			}
			if (type == 821)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagBabyImp = false;
				}
				if (Main.player[owner].petFlagBabyImp)
				{
					timeLeft = 2;
				}
			}
			if (type == 825)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagBabyRedPanda = false;
				}
				if (Main.player[owner].petFlagBabyRedPanda)
				{
					timeLeft = 2;
				}
			}
			if (type == 854)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagPlantero = false;
				}
				if (Main.player[owner].petFlagPlantero)
				{
					timeLeft = 2;
				}
			}
			if (type == 858)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagDynamiteKitten = false;
				}
				if (Main.player[owner].petFlagDynamiteKitten)
				{
					timeLeft = 2;
				}
			}
			if (type == 859)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagBabyWerewolf = false;
				}
				if (Main.player[owner].petFlagBabyWerewolf)
				{
					timeLeft = 2;
				}
			}
			if (type == 860)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagShadowMimic = false;
				}
				if (Main.player[owner].petFlagShadowMimic)
				{
					timeLeft = 2;
				}
			}
			if (type == 875)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagVoltBunny = false;
				}
				if (Main.player[owner].petFlagVoltBunny)
				{
					timeLeft = 2;
				}
			}
			if (type == 881)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagKingSlimePet = false;
				}
				if (Main.player[owner].petFlagKingSlimePet)
				{
					timeLeft = 2;
				}
			}
			if (type == 884)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagBrainOfCthulhuPet = false;
				}
				if (Main.player[owner].petFlagBrainOfCthulhuPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 885)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagSkeletronPet = false;
				}
				if (Main.player[owner].petFlagSkeletronPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 886)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagQueenBeePet = false;
				}
				if (Main.player[owner].petFlagQueenBeePet)
				{
					timeLeft = 2;
				}
			}
			if (type == 889)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagSkeletronPrimePet = false;
				}
				if (Main.player[owner].petFlagSkeletronPrimePet)
				{
					timeLeft = 2;
				}
			}
			if (type == 890)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagPlanteraPet = false;
				}
				if (Main.player[owner].petFlagPlanteraPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 891)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagGolemPet = false;
				}
				if (Main.player[owner].petFlagGolemPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 892)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagDukeFishronPet = false;
				}
				if (Main.player[owner].petFlagDukeFishronPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 894)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagMoonLordPet = false;
				}
				if (Main.player[owner].petFlagMoonLordPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 897)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagEverscreamPet = false;
				}
				if (Main.player[owner].petFlagEverscreamPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 899)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagMartianPet = false;
				}
				if (Main.player[owner].petFlagMartianPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 900)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagDD2OgrePet = false;
				}
				if (Main.player[owner].petFlagDD2OgrePet)
				{
					timeLeft = 2;
				}
			}
			if (type == 901)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagDD2BetsyPet = false;
				}
				if (Main.player[owner].petFlagDD2BetsyPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 934)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagQueenSlimePet = false;
				}
				if (Main.player[owner].petFlagQueenSlimePet)
				{
					timeLeft = 2;
				}
			}
			if (type == 956)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagBerniePet = false;
				}
				if (Main.player[owner].petFlagBerniePet)
				{
					timeLeft = 2;
				}
			}
			if (type == 958)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagDeerclopsPet = false;
				}
				if (Main.player[owner].petFlagDeerclopsPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 959)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagPigPet = false;
				}
				if (Main.player[owner].petFlagPigPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 960)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagChesterPet = false;
				}
				if (Main.player[owner].petFlagChesterPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 994)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagJunimoPet = false;
				}
				if (Main.player[owner].petFlagJunimoPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 998)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagBlueChickenPet = false;
				}
				if (Main.player[owner].petFlagBlueChickenPet)
				{
					timeLeft = 2;
				}
			}
			if (type == 1003)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagSpiffo = false;
				}
				if (Main.player[owner].petFlagSpiffo)
				{
					timeLeft = 2;
				}
			}
			if (type == 1004)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].petFlagCaveling = false;
				}
				if (Main.player[owner].petFlagCaveling)
				{
					timeLeft = 2;
				}
			}
			if (flag6)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].pygmy = false;
				}
				if (Main.player[owner].pygmy)
				{
					timeLeft = Main.rand.Next(2, 10);
				}
			}
			if (type >= 390 && type <= 392)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].spiderMinion = false;
				}
				if (Main.player[owner].spiderMinion)
				{
					timeLeft = 2;
				}
			}
			if (type == 398)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].miniMinotaur = false;
				}
				if (Main.player[owner].miniMinotaur)
				{
					timeLeft = 2;
				}
			}
			if (flag7)
			{
				timeLeft = 2;
			}
			if (flag6 || type == 266 || (type >= 390 && type <= 392))
			{
				num = 10;
				int num3 = 40 * (minionPos + 1) * Main.player[owner].direction;
				if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) < position.X + (float)(width / 2) - (float)num + (float)num3)
				{
					flag2 = true;
				}
				else if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) > position.X + (float)(width / 2) + (float)num + (float)num3)
				{
					flag3 = true;
				}
			}
			else if (type == 891)
			{
				num = 30;
				float num4 = -50 * -Main.player[owner].direction;
				float num5 = Main.player[owner].Center.X + num4;
				if (num5 < position.X + (float)(width / 2) - (float)num)
				{
					flag2 = true;
				}
				else if (num5 > position.X + (float)(width / 2) + (float)num)
				{
					flag3 = true;
				}
			}
			else if (type == 960 && !flag7)
			{
				num = 10;
				Player player = Main.player[owner];
				int num6 = ((player.Center.X - base.Center.X > 0f) ? 1 : (-1));
				if (player.velocity.X != 0f)
				{
					num6 = player.direction;
				}
				float num7 = -70 * num6;
				float num8 = player.Center.X + num7;
				if (num8 < base.Center.X - (float)num)
				{
					flag2 = true;
				}
				else if (num8 > base.Center.X + (float)num)
				{
					flag3 = true;
				}
			}
			else if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) < position.X + (float)(width / 2) - (float)num)
			{
				flag2 = true;
			}
			else if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) > position.X + (float)(width / 2) + (float)num)
			{
				flag3 = true;
			}
			if (num2)
			{
				flag2 = false;
				flag3 = true;
				num = 30;
			}
			if (flag8)
			{
				flag2 = false;
				flag3 = false;
			}
			if (type == 175)
			{
				float num9 = 0.1f;
				tileCollide = false;
				int num10 = 300;
				Vector2 vector = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num11 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector.X;
				float num12 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector.Y;
				if (type == 127)
				{
					num12 = Main.player[owner].position.Y - vector.Y;
				}
				float num13 = (float)Math.Sqrt(num11 * num11 + num12 * num12);
				float num14 = 7f;
				float num15 = 2000f;
				bool num16 = num13 > num15;
				if (num13 < (float)num10 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
				{
					ai[0] = 0f;
					if (velocity.Y < -6f)
					{
						velocity.Y = -6f;
					}
				}
				if (num13 < 150f)
				{
					if (Math.Abs(velocity.X) > 2f || Math.Abs(velocity.Y) > 2f)
					{
						velocity *= 0.99f;
					}
					num9 = 0.01f;
					if (num11 < -2f)
					{
						num11 = -2f;
					}
					if (num11 > 2f)
					{
						num11 = 2f;
					}
					if (num12 < -2f)
					{
						num12 = -2f;
					}
					if (num12 > 2f)
					{
						num12 = 2f;
					}
				}
				else
				{
					if (num13 > 300f)
					{
						num9 = 0.2f;
					}
					num13 = num14 / num13;
					num11 *= num13;
					num12 *= num13;
				}
				if (num16)
				{
					int num17 = 17;
					for (int i = 0; i < 12; i++)
					{
						float speedX = 1f - Main.rand.NextFloat() * 2f;
						float speedY = 1f - Main.rand.NextFloat() * 2f;
						int num18 = Dust.NewDust(position, width, height, num17, speedX, speedY);
						Main.dust[num18].noLightEmittence = true;
						Main.dust[num18].noGravity = true;
					}
					base.Center = Main.player[owner].Center;
					velocity = Vector2.Zero;
					if (Main.myPlayer == owner)
					{
						netUpdate = true;
					}
				}
				if (Math.Abs(num11) > Math.Abs(num12) || num9 == 0.05f)
				{
					if (velocity.X < num11)
					{
						velocity.X += num9;
						if (num9 > 0.05f && velocity.X < 0f)
						{
							velocity.X += num9;
						}
					}
					if (velocity.X > num11)
					{
						velocity.X -= num9;
						if (num9 > 0.05f && velocity.X > 0f)
						{
							velocity.X -= num9;
						}
					}
				}
				if (Math.Abs(num11) <= Math.Abs(num12) || num9 == 0.05f)
				{
					if (velocity.Y < num12)
					{
						velocity.Y += num9;
						if (num9 > 0.05f && velocity.Y < 0f)
						{
							velocity.Y += num9;
						}
					}
					if (velocity.Y > num12)
					{
						velocity.Y -= num9;
						if (num9 > 0.05f && velocity.Y > 0f)
						{
							velocity.Y -= num9;
						}
					}
				}
				rotation = (float)Math.Atan2(velocity.Y, velocity.X) - 1.57f;
				frameCounter++;
				if (frameCounter > 6)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 1)
				{
					frame = 0;
				}
				return;
			}
			if (type == 197)
			{
				float num19 = 0.1f;
				tileCollide = false;
				int num20 = 300;
				Vector2 vector2 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num21 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector2.X;
				float num22 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector2.Y;
				if (type == 127)
				{
					num22 = Main.player[owner].position.Y - vector2.Y;
				}
				float num23 = (float)Math.Sqrt(num21 * num21 + num22 * num22);
				float num24 = 3f;
				if (num23 > 500f)
				{
					localAI[0] = 10000f;
				}
				if (localAI[0] >= 10000f)
				{
					num24 = 14f;
				}
				float num25 = 2000f;
				bool num26 = num23 > num25;
				if (num23 < (float)num20 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
				{
					ai[0] = 0f;
					if (velocity.Y < -6f)
					{
						velocity.Y = -6f;
					}
				}
				if (num23 < 150f)
				{
					if (Math.Abs(velocity.X) > 2f || Math.Abs(velocity.Y) > 2f)
					{
						velocity *= 0.99f;
					}
					num19 = 0.01f;
					if (num21 < -2f)
					{
						num21 = -2f;
					}
					if (num21 > 2f)
					{
						num21 = 2f;
					}
					if (num22 < -2f)
					{
						num22 = -2f;
					}
					if (num22 > 2f)
					{
						num22 = 2f;
					}
				}
				else
				{
					if (num23 > 300f)
					{
						num19 = 0.2f;
					}
					num23 = num24 / num23;
					num21 *= num23;
					num22 *= num23;
				}
				if (num26)
				{
					int num27 = 26;
					for (int j = 0; j < 12; j++)
					{
						float speedX2 = 1f - Main.rand.NextFloat() * 2f;
						float speedY2 = 1f - Main.rand.NextFloat() * 2f;
						int num28 = Dust.NewDust(position, width, height, num27, speedX2, speedY2);
						Main.dust[num28].noLightEmittence = true;
						Main.dust[num28].noGravity = true;
					}
					base.Center = Main.player[owner].Center;
					velocity = Vector2.Zero;
					if (Main.myPlayer == owner)
					{
						netUpdate = true;
					}
				}
				if (velocity.X < num21)
				{
					velocity.X += num19;
					if (num19 > 0.05f && velocity.X < 0f)
					{
						velocity.X += num19;
					}
				}
				if (velocity.X > num21)
				{
					velocity.X -= num19;
					if (num19 > 0.05f && velocity.X > 0f)
					{
						velocity.X -= num19;
					}
				}
				if (velocity.Y < num22)
				{
					velocity.Y += num19;
					if (num19 > 0.05f && velocity.Y < 0f)
					{
						velocity.Y += num19;
					}
				}
				if (velocity.Y > num22)
				{
					velocity.Y -= num19;
					if (num19 > 0.05f && velocity.Y > 0f)
					{
						velocity.Y -= num19;
					}
				}
				localAI[0] += Main.rand.Next(10);
				if (localAI[0] > 10000f)
				{
					if (localAI[1] == 0f)
					{
						if (velocity.X < 0f)
						{
							localAI[1] = -1f;
						}
						else
						{
							localAI[1] = 1f;
						}
					}
					rotation += 0.25f * localAI[1];
					if (localAI[0] > 12000f)
					{
						localAI[0] = 0f;
					}
				}
				else
				{
					localAI[1] = 0f;
					float num29 = velocity.X * 0.1f;
					if (rotation > num29)
					{
						rotation -= (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
						if (rotation < num29)
						{
							rotation = num29;
						}
					}
					if (rotation < num29)
					{
						rotation += (Math.Abs(velocity.X) + Math.Abs(velocity.Y)) * 0.01f;
						if (rotation > num29)
						{
							rotation = num29;
						}
					}
				}
				if ((double)rotation > 6.28)
				{
					rotation -= 6.28f;
				}
				if ((double)rotation < -6.28)
				{
					rotation += 6.28f;
				}
				return;
			}
			if (type == 198 || type == 380 || type == 774 || type == 815 || type == 817 || type == 886 || type == 892 || type == 894 || type == 901)
			{
				float num30 = 0.4f;
				if (type == 380)
				{
					num30 = 0.3f;
				}
				if (type == 774)
				{
					num30 = 0.3f;
				}
				tileCollide = false;
				int num31 = 100;
				float num32 = 50f;
				float num33 = 400f;
				float num34 = num33 / 2f;
				float num35 = 2000f;
				bool flag9 = false;
				Vector2 vector3 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num36 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector3.X;
				float num37 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector3.Y;
				if (type == 774)
				{
					num32 = 2f;
					float num38 = (float)Math.Sin(MathF.PI * 2f * ((float)Main.player[owner].miscCounter / 60f));
					float num39 = Utils.GetLerpValue(0.5f, 1f, num38, clamped: true);
					if (new Vector2(num36 - (float)(70 * Main.player[owner].direction), num37 - 60f).Length() > 50f)
					{
						num38 = 0f;
						num39 = 0f;
					}
					num37 += -60f + num39 * -8f + num38 * 8f;
					num36 += (float)(70 * -Main.player[owner].direction);
				}
				else
				{
					if (type != 892 && type != 894)
					{
						num37 += (float)Main.rand.Next(-10, 21);
						num36 += (float)Main.rand.Next(-10, 21);
					}
					num36 += (float)(60 * -Main.player[owner].direction);
					num37 -= 60f;
				}
				Vector2 vector4 = new Vector2(num36, num37);
				if (type == 127)
				{
					num37 = Main.player[owner].position.Y - vector3.Y;
				}
				float num40 = (float)Math.Sqrt(num36 * num36 + num37 * num37);
				float num41 = num40;
				float num42 = 14f;
				if (type == 380)
				{
					num42 = 6f;
				}
				if (type == 815 || type == 817)
				{
					num42 = ((!(num40 < num33)) ? 10f : 6f);
				}
				if (type == 892 || type == 894 || type == 901)
				{
					if (num40 < num34)
					{
						num42 = 6f;
					}
					num42 = ((!(num40 < num33)) ? 12f : 9f);
				}
				if (type == 774)
				{
					num42 = 5f;
				}
				if (num40 < (float)num31 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
				{
					ai[0] = 0f;
					if (velocity.Y < -6f)
					{
						velocity.Y = -6f;
					}
				}
				if (num40 < num32)
				{
					if (Math.Abs(velocity.X) > 2f || Math.Abs(velocity.Y) > 2f)
					{
						if (type == 892 || type == 892)
						{
							velocity *= 0.95f;
						}
						else
						{
							velocity *= 0.99f;
						}
					}
					num30 = 0.01f;
				}
				else
				{
					if (type == 892 || type == 894 || type == 901)
					{
						if (num40 < 100f)
						{
							num30 = 0.1f;
						}
						if (num40 > num35)
						{
							flag9 = true;
						}
						else if (num40 > num33)
						{
							num30 = 0.7f;
						}
						else if (num40 > num34)
						{
							num30 = 0.5f;
						}
					}
					else if (type == 815 || type == 817)
					{
						if (num40 < 100f)
						{
							num30 = 0.1f;
						}
						if (num40 > num35)
						{
							flag9 = true;
						}
						else if (type != 815 && num40 > num33)
						{
							num30 = 0.5f;
						}
					}
					else if (type == 380)
					{
						if (num40 < 100f)
						{
							num30 = 0.1f;
						}
						if (num40 > 300f)
						{
							num30 = 0.4f;
						}
						if (num40 > num35)
						{
							flag9 = true;
						}
					}
					else if (type == 198 || type == 886)
					{
						if (num40 < 100f)
						{
							num30 = 0.1f;
						}
						if (num40 > 300f)
						{
							num30 = 0.6f;
						}
						if (num40 > num35)
						{
							flag9 = true;
						}
					}
					else if (type == 774)
					{
						if (num40 < 40f)
						{
							num30 = 0.1f;
						}
						if (num40 > 300f)
						{
							num30 = 0.6f;
						}
						if (num40 > num35)
						{
							flag9 = true;
						}
					}
					num40 = num42 / num40;
					num36 *= num40;
					num37 *= num40;
				}
				if (velocity.X < num36)
				{
					velocity.X += num30;
					if (num30 > 0.05f && velocity.X < 0f)
					{
						velocity.X += num30;
					}
				}
				if (velocity.X > num36)
				{
					velocity.X -= num30;
					if (num30 > 0.05f && velocity.X > 0f)
					{
						velocity.X -= num30;
					}
				}
				if (velocity.Y < num37)
				{
					velocity.Y += num30;
					if (num30 > 0.05f && velocity.Y < 0f)
					{
						velocity.Y += num30 * 2f;
					}
				}
				if (velocity.Y > num37)
				{
					velocity.Y -= num30;
					if (num30 > 0.05f && velocity.Y > 0f)
					{
						velocity.Y -= num30 * 2f;
					}
				}
				if ((double)velocity.X > 0.25)
				{
					direction = -1;
				}
				else if ((double)velocity.X < -0.25)
				{
					direction = 1;
				}
				spriteDirection = direction;
				rotation = velocity.X * 0.05f;
				if (flag9)
				{
					int num43 = 33;
					if (type == 198 || type == 886)
					{
						num43 = 147;
					}
					if (type == 815)
					{
						num43 = 31;
					}
					if (type == 817)
					{
						num43 = 21;
					}
					for (int k = 0; k < 12; k++)
					{
						float speedX3 = 1f - Main.rand.NextFloat() * 2f;
						float speedY3 = 1f - Main.rand.NextFloat() * 2f;
						int num44 = Dust.NewDust(position, width, height, num43, speedX3, speedY3);
						Main.dust[num44].noLightEmittence = true;
						Main.dust[num44].noGravity = true;
					}
					base.Center = Main.player[owner].Center;
					velocity = Vector2.Zero;
					if (Main.myPlayer == owner)
					{
						netUpdate = true;
					}
				}
				bool flag10 = false;
				int num45 = 3;
				int num46 = 0;
				int num47 = 3;
				if (type == 380)
				{
					num45 = 6;
				}
				if (type == 815)
				{
					num45 = 5;
					num46 = 0;
					num47 = 5;
					if (num41 > num33)
					{
						num46 = 6;
						num47 = 9;
					}
				}
				if (type == 817)
				{
					num45 = 5;
					num46 = 0;
					num47 = 2;
					flag10 = true;
				}
				if (type == 901)
				{
					num45 = 4;
					num46 = 0;
					num47 = 5;
					if (num41 > num33 / 2f)
					{
						num45 = 3;
						num46 = 6;
						num47 = 11;
					}
				}
				if (type == 892)
				{
					num45 = 6;
					num46 = 0;
					num47 = Main.projFrames[type] - 1;
				}
				if (type == 886 || type == 894)
				{
					num45 = 4;
					num46 = 0;
					num47 = Main.projFrames[type] - 1;
				}
				if (type == 774)
				{
					if (Main.player[owner].velocity.Length() < 2f && vector4.Length() < 10f)
					{
						direction = -Main.player[owner].direction;
						spriteDirection = direction;
					}
					num45 = 6;
					if (!wet)
					{
						num46 += 4;
						num47 += 4;
					}
					rotation = velocity.X * 0.05f + Math.Abs(velocity.Y * -0.05f);
				}
				if (flag10)
				{
					int num48 = num45 * (num47 - num46) * 2;
					frameCounter++;
					if (frameCounter >= num48)
					{
						frameCounter = 0;
					}
					frame = frameCounter / num45;
					if (frame > num47)
					{
						frame = num47 + (num47 - frame);
					}
					frame = (int)MathHelper.Clamp(frame, num46, num47);
				}
				else if (++frameCounter >= num45)
				{
					frameCounter = 0;
					frame++;
					if (frame < num46 || frame > num47)
					{
						frame = num46;
					}
				}
				return;
			}
			if (type == 211)
			{
				float num49 = 0.2f;
				float num50 = 5f;
				tileCollide = false;
				Vector2 vector5 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num51 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector5.X;
				float num52 = Main.player[owner].position.Y + Main.player[owner].gfxOffY + (float)(Main.player[owner].height / 2) - vector5.Y;
				if (Main.player[owner].controlLeft)
				{
					num51 -= 120f;
				}
				else if (Main.player[owner].controlRight)
				{
					num51 += 120f;
				}
				if (Main.player[owner].controlDown)
				{
					num52 += 120f;
				}
				else
				{
					if (Main.player[owner].controlUp)
					{
						num52 -= 120f;
					}
					num52 -= 60f;
				}
				float num53 = (float)Math.Sqrt(num51 * num51 + num52 * num52);
				if (num53 > 1000f)
				{
					position.X += num51;
					position.Y += num52;
				}
				if (localAI[0] == 1f)
				{
					if (num53 < 10f)
					{
						Player player2 = Main.player[owner];
						if (Math.Abs(player2.velocity.X) + Math.Abs(player2.velocity.Y) < num50 && (player2.velocity.Y == 0f || (player2.mount.Active && player2.mount.CanFly())))
						{
							localAI[0] = 0f;
						}
					}
					num50 = 12f;
					if (num53 < num50)
					{
						velocity.X = num51;
						velocity.Y = num52;
					}
					else
					{
						num53 = num50 / num53;
						velocity.X = num51 * num53;
						velocity.Y = num52 * num53;
					}
					if ((double)velocity.X > 0.5)
					{
						direction = -1;
					}
					else if ((double)velocity.X < -0.5)
					{
						direction = 1;
					}
					spriteDirection = direction;
					rotation -= (0.2f + Math.Abs(velocity.X) * 0.025f) * (float)direction;
					frameCounter++;
					if (frameCounter > 3)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 5)
					{
						frame = 5;
					}
					if (frame > 9)
					{
						frame = 5;
					}
					for (int l = 0; l < 2; l++)
					{
						int num54 = Dust.NewDust(new Vector2(position.X + 3f, position.Y + 4f), 14, 14, 156);
						Main.dust[num54].velocity *= 0.2f;
						Main.dust[num54].noGravity = true;
						Main.dust[num54].scale = 1.25f;
						Main.dust[num54].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].cLight, Main.player[owner]);
					}
					return;
				}
				if (num53 > 200f)
				{
					localAI[0] = 1f;
				}
				if ((double)velocity.X > 0.5)
				{
					direction = -1;
				}
				else if ((double)velocity.X < -0.5)
				{
					direction = 1;
				}
				spriteDirection = direction;
				if (num53 < 10f)
				{
					velocity.X = num51;
					velocity.Y = num52;
					rotation = velocity.X * 0.05f;
					if (num53 < num50)
					{
						position += velocity;
						velocity *= 0f;
						num49 = 0f;
					}
					direction = -Main.player[owner].direction;
				}
				num53 = num50 / num53;
				num51 *= num53;
				num52 *= num53;
				if (velocity.X < num51)
				{
					velocity.X += num49;
					if (velocity.X < 0f)
					{
						velocity.X *= 0.99f;
					}
				}
				if (velocity.X > num51)
				{
					velocity.X -= num49;
					if (velocity.X > 0f)
					{
						velocity.X *= 0.99f;
					}
				}
				if (velocity.Y < num52)
				{
					velocity.Y += num49;
					if (velocity.Y < 0f)
					{
						velocity.Y *= 0.99f;
					}
				}
				if (velocity.Y > num52)
				{
					velocity.Y -= num49;
					if (velocity.Y > 0f)
					{
						velocity.Y *= 0.99f;
					}
				}
				if (velocity.X != 0f || velocity.Y != 0f)
				{
					rotation = velocity.X * 0.05f;
				}
				frameCounter++;
				if (frameCounter > 3)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 4)
				{
					frame = 0;
				}
				return;
			}
			if (type == 199)
			{
				float num55 = 0.1f;
				tileCollide = false;
				int num56 = 200;
				Vector2 vector6 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num57 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector6.X;
				float num58 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector6.Y;
				num58 -= 60f;
				num57 -= 2f;
				if (type == 127)
				{
					num58 = Main.player[owner].position.Y - vector6.Y;
				}
				float num59 = (float)Math.Sqrt(num57 * num57 + num58 * num58);
				float num60 = 4f;
				float num61 = num59;
				float num62 = 2000f;
				bool num63 = num59 > num62;
				if (num59 < (float)num56 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
				{
					ai[0] = 0f;
					if (velocity.Y < -6f)
					{
						velocity.Y = -6f;
					}
				}
				if (num59 < 4f)
				{
					velocity.X = num57;
					velocity.Y = num58;
					num55 = 0f;
				}
				else
				{
					if (num59 > 350f)
					{
						num55 = 0.2f;
						num60 = 10f;
					}
					num59 = num60 / num59;
					num57 *= num59;
					num58 *= num59;
				}
				if (num63)
				{
					int num64 = 2;
					for (int m = 0; m < 12; m++)
					{
						float speedX4 = 1f - Main.rand.NextFloat() * 2f;
						float speedY4 = 1f - Main.rand.NextFloat() * 2f;
						int num65 = Dust.NewDust(position, width, height, num64, speedX4, speedY4);
						Main.dust[num65].noLightEmittence = true;
						Main.dust[num65].noGravity = true;
					}
					base.Center = Main.player[owner].Center;
					velocity = Vector2.Zero;
					if (Main.myPlayer == owner)
					{
						netUpdate = true;
					}
				}
				if (velocity.X < num57)
				{
					velocity.X += num55;
					if (velocity.X < 0f)
					{
						velocity.X += num55;
					}
				}
				if (velocity.X > num57)
				{
					velocity.X -= num55;
					if (velocity.X > 0f)
					{
						velocity.X -= num55;
					}
				}
				if (velocity.Y < num58)
				{
					velocity.Y += num55;
					if (velocity.Y < 0f)
					{
						velocity.Y += num55;
					}
				}
				if (velocity.Y > num58)
				{
					velocity.Y -= num55;
					if (velocity.Y > 0f)
					{
						velocity.Y -= num55;
					}
				}
				direction = -Main.player[owner].direction;
				spriteDirection = 1;
				rotation = velocity.Y * 0.05f * (float)(-direction);
				if (num61 >= 50f)
				{
					frameCounter++;
					if (frameCounter <= 6)
					{
						return;
					}
					frameCounter = 0;
					if (velocity.X < 0f)
					{
						if (frame < 2)
						{
							frame++;
						}
						if (frame > 2)
						{
							frame--;
						}
					}
					else
					{
						if (frame < 6)
						{
							frame++;
						}
						if (frame > 6)
						{
							frame--;
						}
					}
				}
				else
				{
					frameCounter++;
					if (frameCounter > 6)
					{
						frame += direction;
						frameCounter = 0;
					}
					if (frame > 7)
					{
						frame = 0;
					}
					if (frame < 0)
					{
						frame = 7;
					}
				}
				return;
			}
			if (type == 885 || type == 889)
			{
				Player player3 = Main.player[owner];
				float num66 = 0.15f;
				tileCollide = false;
				int num67 = 150;
				Vector2 center = base.Center;
				float num68 = player3.Center.X - center.X;
				float num69 = player3.Center.Y - center.Y;
				num69 -= 65f;
				num68 -= (float)(30 * player3.direction);
				float num70 = (float)Math.Sqrt(num68 * num68 + num69 * num69);
				float num71 = 8f;
				float num72 = num70;
				float num73 = 2000f;
				bool num74 = num70 > num73;
				if (num70 < (float)num67 && player3.velocity.Y == 0f && position.Y + (float)height <= player3.position.Y + (float)player3.height && !Collision.SolidCollision(position, width, height) && velocity.Y < -6f)
				{
					velocity.Y = -6f;
				}
				if (num70 < 10f)
				{
					velocity *= 0.9f;
					if (velocity.Length() < 0.5f)
					{
						velocity = Vector2.Zero;
					}
					num66 = 0f;
				}
				else
				{
					if (num70 > (float)num67)
					{
						num66 = 0.2f;
						num71 = 12f;
					}
					num70 = num71 / num70;
					num68 *= num70;
					num69 *= num70;
				}
				if (num74)
				{
					int num75 = 234;
					if (type == 889)
					{
						num75 = 60;
					}
					for (int n = 0; n < 12; n++)
					{
						float speedX5 = 1f - Main.rand.NextFloat() * 2f;
						float speedY5 = 1f - Main.rand.NextFloat() * 2f;
						int num76 = Dust.NewDust(position, width, height, num75, speedX5, speedY5);
						Main.dust[num76].noLightEmittence = true;
						Main.dust[num76].noGravity = true;
					}
					base.Center = player3.Center;
					velocity = Vector2.Zero;
					if (Main.myPlayer == owner)
					{
						netUpdate = true;
					}
				}
				if (velocity.X < num68)
				{
					velocity.X += num66;
					if (velocity.X < 0f)
					{
						velocity.X += num66;
					}
				}
				if (velocity.X > num68)
				{
					velocity.X -= num66;
					if (velocity.X > 0f)
					{
						velocity.X -= num66;
					}
				}
				if (velocity.Y < num69)
				{
					velocity.Y += num66;
					if (velocity.Y < 0f)
					{
						velocity.Y += num66;
					}
				}
				if (velocity.Y > num69)
				{
					velocity.Y -= num66;
					if (velocity.Y > 0f)
					{
						velocity.Y -= num66;
					}
				}
				direction = -player3.direction;
				spriteDirection = -direction;
				int num77 = 100;
				if (num72 >= (float)num67)
				{
					rotation += 0.5f;
					if (rotation > MathF.PI * 2f)
					{
						rotation -= MathF.PI * 2f;
					}
					frame = 6;
					frameCounter = 0;
					if (type == 885)
					{
						localAI[0] = 0f;
					}
					if (type == 889)
					{
						localAI[0] += 3f;
						if (localAI[0] > (float)num77)
						{
							localAI[0] = num77;
						}
					}
					return;
				}
				rotation *= 0.95f;
				if (rotation < 0.05f)
				{
					rotation = 0f;
				}
				frameCounter++;
				if (type == 885)
				{
					switch (frameCounter)
					{
					case 10:
						localAI[0] = 0f;
						break;
					case 20:
						localAI[0] = 1f;
						break;
					case 30:
						localAI[0] = 2f;
						break;
					case 40:
						localAI[0] = 1f;
						break;
					}
				}
				if (type == 889)
				{
					localAI[0] -= 3f;
					if (localAI[0] < 0f)
					{
						localAI[0] = 0f;
					}
				}
				if (frameCounter % 5 == 0)
				{
					frame++;
					if (frame > 5)
					{
						frame = 0;
					}
				}
				if (frameCounter >= 40)
				{
					frameCounter = 0;
				}
				return;
			}
			bool flag11 = ai[1] == 0f;
			if (flag)
			{
				flag11 = true;
			}
			if (flag11)
			{
				int num78 = 500;
				if (type == 127)
				{
					num78 = 200;
				}
				if (type == 208)
				{
					num78 = 300;
				}
				switch (type)
				{
				case 816:
				case 825:
				case 854:
				case 858:
				case 859:
				case 860:
				case 881:
				case 884:
				case 890:
				case 891:
				case 897:
				case 900:
				case 934:
					num78 = 400;
					break;
				case 821:
				case 899:
					num78 = 500;
					break;
				}
				if (flag6 || type == 266 || (type >= 390 && type <= 392))
				{
					num78 += 40 * minionPos;
					if (localAI[0] > 0f)
					{
						num78 += 500;
					}
					if (type == 266 && localAI[0] > 0f)
					{
						num78 += 100;
					}
					if (type >= 390 && type <= 392 && localAI[0] > 0f)
					{
						num78 += 400;
					}
				}
				if (Main.player[owner].rocketDelay2 > 0)
				{
					ai[0] = 1f;
				}
				Vector2 vector7 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num79 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector7.X;
				float num80 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector7.Y;
				float num81 = (float)Math.Sqrt(num79 * num79 + num80 * num80);
				if (!flag7)
				{
					if (num81 > 2000f)
					{
						position.X = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - (float)(width / 2);
						position.Y = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - (float)(height / 2);
					}
					else if (num81 > (float)num78 || (Math.Abs(num80) > 300f && ((!flag6 && type != 266 && (type < 390 || type > 392)) || !(localAI[0] > 0f))))
					{
						if (type != 324)
						{
							if (num80 > 0f && velocity.Y < 0f)
							{
								velocity.Y = 0f;
							}
							if (num80 < 0f && velocity.Y > 0f)
							{
								velocity.Y = 0f;
							}
						}
						ai[0] = 1f;
					}
				}
			}
			if ((type == 209 || type == 956) && ai[0] != 0f)
			{
				if (Main.player[owner].velocity.Y == 0f && alpha >= 100)
				{
					position.X = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - (float)(width / 2);
					position.Y = Main.player[owner].position.Y + (float)Main.player[owner].height - (float)height;
					ai[0] = 0f;
				}
				else
				{
					velocity.X = 0f;
					velocity.Y = 0f;
					if (type == 956 && alpha < 100)
					{
						int num82 = Dust.NewDust(position, width, height, 6, velocity.X, velocity.Y, 0, default(Color), 1.2f);
						Main.dust[num82].velocity.X += Main.rand.NextFloat() - 0.5f;
						Main.dust[num82].velocity.Y += (Main.rand.NextFloat() + 0.5f) * -1f;
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num82].noGravity = true;
						}
					}
					alpha += 5;
					if (alpha > 255)
					{
						alpha = 255;
					}
				}
			}
			else if (ai[0] != 0f && !flag7)
			{
				float num83 = 0.2f;
				int num84 = 200;
				if (type == 127)
				{
					num84 = 100;
				}
				if (flag6 || type == 816 || type == 821 || type == 825 || type == 854 || type == 858 || type == 859 || type == 860)
				{
					num83 = 0.5f;
					num84 = 100;
				}
				if (type == 875)
				{
					num83 = 2f;
					num84 = 100;
				}
				tileCollide = false;
				Vector2 vector8 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
				float num85 = Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - vector8.X;
				if (flag6 || type == 266 || (type >= 390 && type <= 392))
				{
					num85 -= (float)(40 * Main.player[owner].direction);
					float num86 = 700f;
					if (flag6)
					{
						num86 += 100f;
					}
					bool flag12 = false;
					int num87 = -1;
					for (int num88 = 0; num88 < 200; num88++)
					{
						if (!Main.npc[num88].CanBeChasedBy(this))
						{
							continue;
						}
						float num89 = Main.npc[num88].position.X + (float)(Main.npc[num88].width / 2);
						float num90 = Main.npc[num88].position.Y + (float)(Main.npc[num88].height / 2);
						if (Math.Abs(Main.player[owner].position.X + (float)(Main.player[owner].width / 2) - num89) + Math.Abs(Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - num90) < num86)
						{
							if (Collision.CanHit(position, width, height, Main.npc[num88].position, Main.npc[num88].width, Main.npc[num88].height))
							{
								num87 = num88;
							}
							flag12 = true;
							break;
						}
					}
					if (!flag12)
					{
						num85 -= (float)(40 * minionPos * Main.player[owner].direction);
					}
					if (flag12 && num87 >= 0)
					{
						ai[0] = 0f;
					}
				}
				float num91 = Main.player[owner].position.Y + (float)(Main.player[owner].height / 2) - vector8.Y;
				if (type == 127)
				{
					num91 = Main.player[owner].position.Y - vector8.Y;
				}
				float num92 = (float)Math.Sqrt(num85 * num85 + num91 * num91);
				float num93 = num92;
				float num94 = 10f;
				float num95 = num92;
				if (type == 111)
				{
					num94 = 11f;
				}
				if (type == 127)
				{
					num94 = 9f;
				}
				if (type == 875)
				{
					num83 = 1.8f;
					num94 = 16f;
				}
				if (type == 324)
				{
					num94 = 20f;
				}
				if (flag6 || type == 816 || type == 821 || type == 825 || type == 854 || type == 858 || type == 859 || type == 860 || type == 956 || type == 958 || type == 959 || type == 960 || type == 994 || type == 998 || type == 1003 || type == 1004)
				{
					num83 = 0.4f;
					num94 = 12f;
					if (flag6)
					{
						num83 = 0.8f;
					}
					if (num94 < Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y))
					{
						num94 = Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y);
					}
				}
				if (type == 208 && Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y) > 4f)
				{
					num84 = -1;
				}
				if (num92 < (float)num84 && Main.player[owner].velocity.Y == 0f && position.Y + (float)height <= Main.player[owner].position.Y + (float)Main.player[owner].height && !Collision.SolidCollision(position, width, height))
				{
					ai[0] = 0f;
					if (velocity.Y < -6f)
					{
						velocity.Y = -6f;
					}
				}
				if (num92 < 60f)
				{
					num85 = velocity.X;
					num91 = velocity.Y;
				}
				else
				{
					num92 = num94 / num92;
					num85 *= num92;
					num91 *= num92;
				}
				if (type == 324)
				{
					if (num95 > 1000f)
					{
						if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num94 - 1.25)
						{
							velocity *= 1.025f;
						}
						if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) > (double)num94 + 1.25)
						{
							velocity *= 0.975f;
						}
					}
					else if (num95 > 600f)
					{
						if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) < num94 - 1f)
						{
							velocity *= 1.05f;
						}
						if (Math.Abs(velocity.X) + Math.Abs(velocity.Y) > num94 + 1f)
						{
							velocity *= 0.95f;
						}
					}
					else if (num95 > 400f)
					{
						if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num94 - 0.5)
						{
							velocity *= 1.075f;
						}
						if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) > (double)num94 + 0.5)
						{
							velocity *= 0.925f;
						}
					}
					else
					{
						if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < (double)num94 - 0.25)
						{
							velocity *= 1.1f;
						}
						if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) > (double)num94 + 0.25)
						{
							velocity *= 0.9f;
						}
					}
					velocity.X = (velocity.X * 34f + num85) / 35f;
					velocity.Y = (velocity.Y * 34f + num91) / 35f;
				}
				else if (type == 875)
				{
					if (num93 < (float)num84)
					{
						if (velocity.X < num85)
						{
							velocity.X += num83;
						}
						else if (velocity.X > num85)
						{
							velocity.X -= num83;
						}
						if (velocity.Y < num91)
						{
							velocity.Y += num83;
						}
						else if (velocity.Y > num91)
						{
							velocity.Y -= num83;
						}
					}
					else
					{
						velocity = Vector2.Lerp(velocity, new Vector2(num85, num91), 0.75f);
					}
				}
				else
				{
					if (velocity.X < num85)
					{
						velocity.X += num83;
						if (velocity.X < 0f)
						{
							velocity.X += num83 * 1.5f;
						}
					}
					if (velocity.X > num85)
					{
						velocity.X -= num83;
						if (velocity.X > 0f)
						{
							velocity.X -= num83 * 1.5f;
						}
					}
					if (velocity.Y < num91)
					{
						velocity.Y += num83;
						if (velocity.Y < 0f)
						{
							velocity.Y += num83 * 1.5f;
						}
					}
					if (velocity.Y > num91)
					{
						velocity.Y -= num83;
						if (velocity.Y > 0f)
						{
							velocity.Y -= num83 * 1.5f;
						}
					}
				}
				if (type == 111)
				{
					frame = 7;
				}
				if (type == 112)
				{
					frame = 2;
				}
				if (flag6 && frame < 12)
				{
					frame = Main.rand.Next(12, 18);
					frameCounter = 0;
				}
				if (type != 313)
				{
					if ((double)velocity.X > 0.5)
					{
						spriteDirection = -1;
					}
					else if ((double)velocity.X < -0.5)
					{
						spriteDirection = 1;
					}
				}
				if (type == 900)
				{
					spriteDirection = -1;
					if (velocity.X > 0f)
					{
						spriteDirection = 1;
					}
					frameCounter++;
					if (frame < 10)
					{
						frame = 10;
						frameCounter = 0;
					}
					if (frameCounter > 3)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 10;
						}
					}
					rotation = velocity.X * 0.125f;
				}
				else if (type == 899)
				{
					spriteDirection = -1;
					if (velocity.X > 0f)
					{
						spriteDirection = 1;
					}
					frameCounter++;
					if (frame < 10)
					{
						frame = 10;
						frameCounter = 0;
					}
					if (frameCounter > 3)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 10;
						}
					}
					Vector2 v = velocity;
					v.Normalize();
					rotation = v.ToRotation();
					if (velocity.X < 0f)
					{
						rotation += MathF.PI;
					}
				}
				else if (type == 897)
				{
					spriteDirection = 1;
					frameCounter++;
					if (frame < 8)
					{
						frame = 8;
						frameCounter = 0;
					}
					if (frameCounter > 3)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 8;
						}
					}
					Vector2 v2 = velocity;
					v2.Normalize();
					rotation = v2.ToRotation() + MathF.PI / 2f;
				}
				else if (type == 891)
				{
					spriteDirection = 1;
					frameCounter++;
					if (frame < 9)
					{
						frame = 9;
						frameCounter = 0;
					}
					if (frameCounter > 3)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 9;
						}
					}
					Vector2 v3 = velocity;
					v3.Normalize();
					rotation = v3.ToRotation() + MathF.PI / 2f;
				}
				else if (type == 890)
				{
					spriteDirection = -1;
					if (velocity.X > 0f)
					{
						spriteDirection = 1;
					}
					frameCounter++;
					if (frame < 9)
					{
						frame = 9;
						frameCounter = 0;
					}
					if (frameCounter > 3)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 9;
						}
					}
					rotation = velocity.X * 0.025f;
				}
				else if (type == 884)
				{
					spriteDirection = -1;
					if (velocity.X > 0f)
					{
						spriteDirection = 1;
					}
					frameCounter++;
					if (frame < 9)
					{
						frame = 9;
						frameCounter = 0;
					}
					if (frameCounter > 3)
					{
						frameCounter = 0;
						frame++;
						if (frame >= Main.projFrames[type])
						{
							frame = 9;
						}
					}
					Vector2 v4 = velocity;
					v4.Normalize();
					rotation = v4.ToRotation() + MathF.PI / 2f;
				}
				else if (type == 881 || type == 934)
				{
					int num96 = 1226;
					if (type == 934)
					{
						num96 = 1261;
					}
					if (frame < 6 || frame > 11)
					{
						Gore.NewGore(new Vector2(base.Center.X, position.Y), velocity * 0.5f, num96);
					}
					frameCounter++;
					if (frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 6 || frame > 11)
					{
						frame = 6;
					}
					Vector2 v5 = velocity;
					v5.Normalize();
					rotation = v5.ToRotation() + MathF.PI / 2f;
				}
				else if (type == 875)
				{
					if (++frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 7 || frame > 10)
					{
						frame = 7;
					}
					Vector2 v6 = velocity;
					v6.Normalize();
					rotation = v6.ToRotation() + ((spriteDirection == -1) ? 0f : MathF.PI);
				}
				else if (type == 825)
				{
					if (++frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 21 || frame > 25)
					{
						frame = 21;
					}
					rotation = velocity.X * 0.025f;
				}
				else if (type == 854)
				{
					if (frame < 13)
					{
						Gore.NewGore(new Vector2(base.Center.X, position.Y), velocity * 0.5f, 1269);
					}
					if (++frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 13 || frame > 18)
					{
						frame = 13;
					}
					Vector2 v7 = velocity;
					v7.Normalize();
					rotation = v7.ToRotation() + MathF.PI / 2f;
				}
				else if (type == 858)
				{
					if (++frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 10 || frame > 13)
					{
						frame = 10;
					}
					Vector2 v8 = velocity;
					v8.Normalize();
					rotation = v8.ToRotation() + ((spriteDirection == -1) ? 0f : MathF.PI);
				}
				else if (type == 859)
				{
					if (++frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 18 || frame > 23)
					{
						frame = 18;
					}
					rotation = velocity.X * 0.025f;
				}
				else if (type == 860)
				{
					if (frame < 6)
					{
						frame = 8;
						frameCounter = 0;
					}
					if (++frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 13)
					{
						frame = 6;
					}
					Vector2 v9 = velocity;
					v9.Normalize();
					rotation = v9.ToRotation() + MathF.PI / 2f;
				}
				else if (type == 816)
				{
					if (++frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 11 || frame > 16)
					{
						frame = 11;
					}
					rotation = velocity.X * 0.025f;
				}
				else if (type == 821)
				{
					if (++frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 19 || frame > 22)
					{
						frame = 19;
					}
					rotation = velocity.X * 0.025f;
				}
				else if (type == 958)
				{
					spriteDirection = -1;
					if (velocity.X > 0f)
					{
						spriteDirection = 1;
					}
					if (frame < 13)
					{
						frame = 13;
						frameCounter = 0;
					}
					if (++frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 16)
					{
						frame = 13;
					}
					rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.4f, 0.4f);
				}
				else if (type == 960)
				{
					spriteDirection = -1;
					if (velocity.X > 0f)
					{
						spriteDirection = 1;
					}
					frame = 4;
					frameCounter = 0;
					Vector2 v10 = velocity;
					v10.Normalize();
					rotation = v10.ToRotation() + MathF.PI / 2f;
				}
				else if (type == 959)
				{
					spriteDirection = -1;
					if (velocity.X > 0f)
					{
						spriteDirection = 1;
					}
					frame = 11;
					frameCounter = 0;
					rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.4f, 0.4f);
					float num97 = Vector2.Dot(velocity.SafeNormalize(Vector2.UnitX), new Vector2(0f, -1f));
					if (num97 > 0f && Main.rand.NextFloat() < 0.3f + num97 * 0.3f)
					{
						Dust dust = Dust.NewDustDirect(position, width, height, 16, velocity.X * 0.7f, velocity.Y * 1.2f, 150, default(Color), 0.6f);
						dust.noGravity = true;
						dust.fadeIn = 1f;
						dust.velocity.X = velocity.X * 0.3f;
						dust.position = base.Top + new Vector2(0f, -10f) + new Vector2(Main.rand.NextFloatDirection() * 30f, Main.rand.NextFloatDirection() * 10f);
						dust.velocity *= 0.7f;
						dust.position += dust.velocity * 2f;
					}
				}
				else if (type == 994)
				{
					spriteDirection = -1;
					if (velocity.X > 0f)
					{
						spriteDirection = 1;
					}
					frameCounter++;
					if (frameCounter > 5)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 13 || frame > 15)
					{
						frame = 13;
					}
					rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.4f, 0.4f);
				}
				else if (type == 998)
				{
					spriteDirection = 1;
					if (velocity.X > 0f)
					{
						spriteDirection = -1;
					}
					frameCounter++;
					if (frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 6 || frame > 9)
					{
						frame = 6;
					}
					rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.4f, 0.4f);
				}
				else if (type == 1003)
				{
					spriteDirection = 1;
					if (velocity.X > 0f)
					{
						spriteDirection = -1;
					}
					frameCounter++;
					if (frameCounter > 3)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 12 || frame > 15)
					{
						frame = 12;
					}
					rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.35f, 0.35f);
				}
				else if (type == 1004)
				{
					spriteDirection = 1;
					if (velocity.X > 0f)
					{
						spriteDirection = -1;
					}
					frameCounter++;
					if (frameCounter > 3)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 10 || frame > 14)
					{
						frame = 10;
					}
					rotation = MathHelper.Clamp(velocity.X * 0.025f, -0.35f, 0.35f);
				}
				else if (type == 112)
				{
					if (spriteDirection == -1)
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					}
					else
					{
						rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.57f;
					}
				}
				else if (type >= 390 && type <= 392)
				{
					int num98 = (int)(base.Center.X / 16f);
					int num99 = (int)(base.Center.Y / 16f);
					if (Main.tile[num98, num99] != null && Main.tile[num98, num99].wall > 0)
					{
						rotation = velocity.ToRotation() + MathF.PI / 2f;
						frameCounter += (int)(Math.Abs(velocity.X) + Math.Abs(velocity.Y));
						if (frameCounter > 5)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 7)
						{
							frame = 4;
						}
						if (frame < 4)
						{
							frame = 7;
						}
					}
					else
					{
						frameCounter++;
						if (frameCounter > 2)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 8 || frame > 10)
						{
							frame = 8;
						}
						rotation = velocity.X * 0.1f;
					}
				}
				else if (type == 334)
				{
					frameCounter++;
					if (frameCounter > 1)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 7 || frame > 10)
					{
						frame = 7;
					}
					rotation = velocity.X * 0.1f;
				}
				else if (type == 353)
				{
					frameCounter++;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 10 || frame > 13)
					{
						frame = 10;
					}
					rotation = velocity.X * 0.05f;
				}
				else if (type == 127)
				{
					frameCounter += 3;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame <= 5 || frame > 15)
					{
						frame = 6;
					}
					rotation = velocity.X * 0.1f;
				}
				else if (type == 269)
				{
					if (frame == 6)
					{
						frameCounter = 0;
					}
					else if (frame < 4 || frame > 6)
					{
						frameCounter = 0;
						frame = 4;
					}
					else
					{
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
					}
					rotation = velocity.X * 0.05f;
				}
				else if (type == 266)
				{
					frameCounter++;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 2 || frame > 5)
					{
						frame = 2;
					}
					rotation = velocity.X * 0.1f;
				}
				else if (type == 324)
				{
					frameCounter++;
					if (frameCounter > 1)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 6 || frame > 9)
					{
						frame = 6;
					}
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.58f;
					Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, 0.9f, 0.6f, 0.2f);
					for (int num100 = 0; num100 < 2; num100++)
					{
						int num101 = 4;
						int num102 = Dust.NewDust(new Vector2(base.Center.X - (float)num101, base.Center.Y - (float)num101) - velocity * 0f, num101 * 2, num101 * 2, 6, 0f, 0f, 100);
						Main.dust[num102].scale *= 1.8f + (float)Main.rand.Next(10) * 0.1f;
						Main.dust[num102].velocity *= 0.2f;
						if (num100 == 1)
						{
							Main.dust[num102].position -= velocity * 0.5f;
						}
						Main.dust[num102].noGravity = true;
						num102 = Dust.NewDust(new Vector2(base.Center.X - (float)num101, base.Center.Y - (float)num101) - velocity * 0f, num101 * 2, num101 * 2, 31, 0f, 0f, 100, default(Color), 0.5f);
						Main.dust[num102].fadeIn = 1f + (float)Main.rand.Next(5) * 0.1f;
						Main.dust[num102].velocity *= 0.05f;
						if (num100 == 1)
						{
							Main.dust[num102].position -= velocity * 0.5f;
						}
					}
				}
				else if (type == 268)
				{
					frameCounter++;
					if (frameCounter > 4)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 6 || frame > 7)
					{
						frame = 6;
					}
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.58f;
				}
				else if (type == 200)
				{
					frameCounter += 3;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame <= 5 || frame > 9)
					{
						frame = 6;
					}
					rotation = velocity.X * 0.1f;
				}
				else if (type == 208)
				{
					rotation = velocity.X * 0.075f;
					frameCounter++;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 4)
					{
						frame = 1;
					}
					if (frame < 1)
					{
						frame = 1;
					}
				}
				else if (type == 236)
				{
					rotation = velocity.Y * 0.05f * (float)direction;
					if (velocity.Y < 0f)
					{
						frameCounter += 2;
					}
					else
					{
						frameCounter++;
					}
					if (frameCounter >= 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 12)
					{
						frame = 9;
					}
					if (frame < 9)
					{
						frame = 9;
					}
				}
				else if (type == 499)
				{
					rotation = velocity.Y * 0.05f * (float)direction;
					if (velocity.Y < 0f)
					{
						frameCounter += 2;
					}
					else
					{
						frameCounter++;
					}
					if (frameCounter >= 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame >= 12)
					{
						frame = 8;
					}
					if (frame < 8)
					{
						frame = 8;
					}
				}
				else if (type == 765)
				{
					rotation = velocity.Y * 0.05f * (float)direction;
					frameCounter++;
					if (frameCounter >= 8)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame >= 10)
					{
						frame = 8;
					}
					if (frame < 6)
					{
						frame = 6;
					}
				}
				else if (type == 314)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.58f;
					frameCounter++;
					if (frameCounter >= 3)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 12)
					{
						frame = 7;
					}
					if (frame < 7)
					{
						frame = 7;
					}
				}
				else if (type == 319)
				{
					rotation = velocity.X * 0.05f;
					frameCounter++;
					if (frameCounter >= 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 10)
					{
						frame = 6;
					}
					if (frame < 6)
					{
						frame = 6;
					}
				}
				else if (type == 210)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 1.58f;
					frameCounter += 3;
					if (frameCounter > 6)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame > 11)
					{
						frame = 7;
					}
					if (frame < 7)
					{
						frame = 7;
					}
				}
				else if (type == 313)
				{
					position.Y += height;
					height = 54;
					position.Y -= height;
					position.X += width / 2;
					width = 54;
					position.X -= width / 2;
					rotation += velocity.X * 0.01f;
					frameCounter = 0;
					frame = 11;
				}
				else if (type == 398)
				{
					if ((double)velocity.X > 0.5)
					{
						spriteDirection = 1;
					}
					else if ((double)velocity.X < -0.5)
					{
						spriteDirection = -1;
					}
					frameCounter++;
					if (frameCounter > 1)
					{
						frame++;
						frameCounter = 0;
					}
					if (frame < 6 || frame > 9)
					{
						frame = 6;
					}
					rotation = velocity.X * 0.1f;
				}
				else if (spriteDirection == -1)
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X);
				}
				else
				{
					rotation = (float)Math.Atan2(velocity.Y, velocity.X) + 3.14f;
				}
				if (!flag6 && type != 499 && type != 765 && type != 816 && type != 821 && type != 825 && type != 859 && type != 881 && type != 884 && type != 890 && type != 891 && type != 900 && type != 934 && type != 958 && type != 959 && type != 960 && type != 994 && type != 998 && type != 1003 && type != 1004)
				{
					if (type == 899)
					{
						int num103 = 6;
						if (Main.rand.Next(4) == 0)
						{
							num103 = 31;
						}
						int num104 = Dust.NewDust(base.Center + new Vector2(-8f, 0f) - velocity * 0.25f, 15, 15, num103, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f, 0, default(Color), 1.3f);
						Main.dust[num104].velocity.X = Main.dust[num104].velocity.X * 0.2f;
						Main.dust[num104].velocity.Y = Main.dust[num104].velocity.Y * 0.2f - 0.2f;
						Main.dust[num104].noGravity = true;
					}
					else if (type == 897)
					{
						int num105 = 6;
						if (Main.rand.Next(4) == 0)
						{
							num105 = 31;
						}
						int num106 = Dust.NewDust(base.Center + new Vector2(-8f, -8f) - velocity * 0.25f, 15, 15, num105, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f, 0, default(Color), 1.3f);
						Main.dust[num106].velocity.X = Main.dust[num106].velocity.X * 0.2f;
						Main.dust[num106].velocity.Y = Main.dust[num106].velocity.Y * 0.2f - 0.2f;
						Main.dust[num106].noGravity = true;
					}
					else if (type == 875)
					{
						if (Main.rand.Next(3) == 0)
						{
							Gore.NewGorePerfect(base.Center + new Vector2(-10f + (float)Main.rand.Next(-20, 20) * 0.5f, -10f + (float)Main.rand.Next(-20, 20) * 0.5f), velocity * 0.1f, 1225, 0.5f + Main.rand.NextFloat() * 1f);
							Vector2 vector9 = Main.rand.NextVector2CircularEdge(2f, 2f) + velocity * -0.5f;
							vector9 *= 0.5f;
							int num107 = Dust.NewDust(base.Center - velocity * 1.5f - new Vector2(7f, 7f), 15, 15, 226, vector9.X, vector9.Y, 0, default(Color), 0.65f);
							Main.dust[num107].noGravity = true;
						}
					}
					else if (type == 860)
					{
						int num108 = Dust.NewDust(new Vector2(position.X + (float)(width / 2) - 4f, position.Y + (float)(height / 2) - 4f) + velocity, 8, 8, 27, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f);
						Main.dust[num108].velocity.X = Main.dust[num108].velocity.X * 0.2f;
						Main.dust[num108].velocity.Y = Main.dust[num108].velocity.Y * 0.2f - 0.2f;
						Main.dust[num108].velocity += new Vector2((float)Main.rand.Next(-10, 10) * 0.4f, (float)Main.rand.Next(-10, 10) * 0.4f) * 0.5f;
						Main.dust[num108].noGravity = true;
					}
					else if (type == 858)
					{
						int num109 = 6;
						if (Main.rand.Next(4) == 0)
						{
							num109 = 31;
						}
						int num110 = Dust.NewDust(new Vector2(position.X + (float)(width / 2) - 4f, position.Y + (float)(height / 2) - 4f) - velocity, 10, 10, num109, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f, 0, default(Color), 1.3f);
						Main.dust[num110].velocity.X = Main.dust[num110].velocity.X * 0.2f;
						Main.dust[num110].velocity.Y = Main.dust[num110].velocity.Y * 0.2f - 0.2f;
						Main.dust[num110].noGravity = true;
					}
					else if (type == 854)
					{
						if (Main.rand.Next(6) == 0)
						{
							Vector2 vector10 = base.Center / 16f;
							int i2 = (int)vector10.X;
							int num111 = (int)vector10.Y;
							Tile tileSafely = Framing.GetTileSafely(i2, num111 + 1);
							if (!WorldGen.SolidTile(tileSafely) && tileSafely.liquid == 0)
							{
								Gore gore = Gore.NewGorePerfect(base.Center + new Vector2((float)Main.rand.Next(-30, 30) * 0.5f, (float)Main.rand.Next(-30, 30) * 0.5f), velocity * -0.2f, 910);
								gore.Frame.CurrentColumn = 0;
								gore.timeLeft = 1;
							}
						}
					}
					else if (type != 398 && type != 390 && type != 391 && type != 392 && type != 127 && type != 200 && type != 208 && type != 210 && type != 236 && type != 266 && type != 268 && type != 269 && type != 313 && type != 314 && type != 319 && type != 324 && type != 334 && type != 353)
					{
						int num112 = Dust.NewDust(new Vector2(position.X + (float)(width / 2) - 4f, position.Y + (float)(height / 2) - 4f) - velocity, 8, 8, 16, (0f - velocity.X) * 0.5f, velocity.Y * 0.5f, 50, default(Color), 1.7f);
						Main.dust[num112].velocity.X = Main.dust[num112].velocity.X * 0.2f;
						Main.dust[num112].velocity.Y = Main.dust[num112].velocity.Y * 0.2f;
						Main.dust[num112].noGravity = true;
					}
				}
			}
			else
			{
				if (flag6)
				{
					float num113 = 40 * minionPos;
					int num114 = 30;
					int num115 = 60;
					localAI[0] -= 1f;
					if (localAI[0] < 0f)
					{
						localAI[0] = 0f;
					}
					if (ai[1] > 0f)
					{
						ai[1] -= 1f;
					}
					else
					{
						float num116 = position.X;
						float num117 = position.Y;
						float num118 = 100000f;
						float num119 = num118;
						int num120 = -1;
						float num121 = 20f;
						NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
						if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
						{
							float num122 = ownerMinionAttackTargetNPC.position.X + (float)(ownerMinionAttackTargetNPC.width / 2);
							float num123 = ownerMinionAttackTargetNPC.position.Y + (float)(ownerMinionAttackTargetNPC.height / 2);
							float num124 = Math.Abs(position.X + (float)(width / 2) - num122) + Math.Abs(position.Y + (float)(height / 2) - num123);
							if (num124 < num118)
							{
								if (num120 == -1 && num124 <= num119)
								{
									num119 = num124;
									num116 = num122;
									num117 = num123;
								}
								if (Collision.CanHit(position, width, height, ownerMinionAttackTargetNPC.position, ownerMinionAttackTargetNPC.width, ownerMinionAttackTargetNPC.height))
								{
									num118 = num124;
									num116 = num122;
									num117 = num123;
									num120 = ownerMinionAttackTargetNPC.whoAmI;
								}
							}
						}
						if (num120 == -1)
						{
							for (int num125 = 0; num125 < 200; num125++)
							{
								if (!Main.npc[num125].CanBeChasedBy(this))
								{
									continue;
								}
								float num126 = Main.npc[num125].position.X + (float)(Main.npc[num125].width / 2);
								float num127 = Main.npc[num125].position.Y + (float)(Main.npc[num125].height / 2);
								float num128 = Math.Abs(position.X + (float)(width / 2) - num126) + Math.Abs(position.Y + (float)(height / 2) - num127);
								if (num128 < num118)
								{
									if (num120 == -1 && num128 <= num119)
									{
										num119 = num128;
										num116 = num126 + Main.npc[num125].velocity.X * num121;
										num117 = num127 + Main.npc[num125].velocity.Y * num121;
									}
									if (Collision.CanHit(position, width, height, Main.npc[num125].position, Main.npc[num125].width, Main.npc[num125].height))
									{
										num118 = num128;
										num116 = num126 + Main.npc[num125].velocity.X * num121;
										num117 = num127 + Main.npc[num125].velocity.Y * num121;
										num120 = num125;
									}
								}
							}
						}
						if (num120 == -1 && num119 < num118)
						{
							num118 = num119;
						}
						float num129 = 400f;
						if ((double)position.Y > Main.worldSurface * 16.0)
						{
							num129 = 200f;
						}
						if (num118 < num129 + num113 && num120 == -1)
						{
							float num130 = num116 - (position.X + (float)(width / 2));
							if (num130 < -5f)
							{
								flag2 = true;
								flag3 = false;
							}
							else if (num130 > 5f)
							{
								flag3 = true;
								flag2 = false;
							}
						}
						else if (num120 >= 0 && num118 < 800f + num113)
						{
							localAI[0] = num115;
							float num131 = num116 - (position.X + (float)(width / 2));
							if (num131 > 450f || num131 < -450f)
							{
								if (num131 < -50f)
								{
									flag2 = true;
									flag3 = false;
								}
								else if (num131 > 50f)
								{
									flag3 = true;
									flag2 = false;
								}
							}
							else if (owner == Main.myPlayer)
							{
								ai[1] = num114;
								Vector2 vector11 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)(height / 2) - 8f);
								float num132 = num116 - vector11.X + (float)Main.rand.Next(-20, 21);
								float num133 = Math.Abs(num132) * 0.1f;
								num133 = num133 * (float)Main.rand.Next(0, 100) * 0.001f;
								float num134 = num117 - vector11.Y + (float)Main.rand.Next(-20, 21) - num133;
								float num135 = (float)Math.Sqrt(num132 * num132 + num134 * num134);
								num135 = 11f / num135;
								num132 *= num135;
								num134 *= num135;
								int num136 = damage;
								int num137 = 195;
								int num138 = NewProjectile(GetProjectileSource_FromThis(), vector11.X, vector11.Y, num132, num134, num137, num136, knockBack, Main.myPlayer);
								Main.projectile[num138].timeLeft = 300;
								if (num132 < 0f)
								{
									direction = -1;
								}
								if (num132 > 0f)
								{
									direction = 1;
								}
								netUpdate = true;
							}
						}
					}
				}
				bool flag13 = false;
				Vector2 vector12 = Vector2.Zero;
				bool flag14 = false;
				if (type == 266 || (type >= 390 && type <= 392))
				{
					float num139 = 40 * minionPos;
					int num140 = 60;
					localAI[0] -= 1f;
					if (localAI[0] < 0f)
					{
						localAI[0] = 0f;
					}
					if (ai[1] > 0f)
					{
						ai[1] -= 1f;
					}
					else
					{
						float num141 = position.X;
						float num142 = position.Y;
						float num143 = 100000f;
						float num144 = num143;
						int num145 = -1;
						NPC ownerMinionAttackTargetNPC2 = OwnerMinionAttackTargetNPC;
						if (ownerMinionAttackTargetNPC2 != null && ownerMinionAttackTargetNPC2.CanBeChasedBy(this))
						{
							float x = ownerMinionAttackTargetNPC2.Center.X;
							float y = ownerMinionAttackTargetNPC2.Center.Y;
							float num146 = Math.Abs(position.X + (float)(width / 2) - x) + Math.Abs(position.Y + (float)(height / 2) - y);
							if (num146 < num143)
							{
								if (num145 == -1 && num146 <= num144)
								{
									num144 = num146;
									num141 = x;
									num142 = y;
								}
								if (Collision.CanHit(position, width, height, ownerMinionAttackTargetNPC2.position, ownerMinionAttackTargetNPC2.width, ownerMinionAttackTargetNPC2.height))
								{
									num143 = num146;
									num141 = x;
									num142 = y;
									num145 = ownerMinionAttackTargetNPC2.whoAmI;
								}
							}
						}
						if (num145 == -1)
						{
							for (int num147 = 0; num147 < 200; num147++)
							{
								if (!Main.npc[num147].CanBeChasedBy(this))
								{
									continue;
								}
								float num148 = Main.npc[num147].position.X + (float)(Main.npc[num147].width / 2);
								float num149 = Main.npc[num147].position.Y + (float)(Main.npc[num147].height / 2);
								float num150 = Math.Abs(position.X + (float)(width / 2) - num148) + Math.Abs(position.Y + (float)(height / 2) - num149);
								if (num150 < num143)
								{
									if (num145 == -1 && num150 <= num144)
									{
										num144 = num150;
										num141 = num148;
										num142 = num149;
									}
									if (Collision.CanHit(position, width, height, Main.npc[num147].position, Main.npc[num147].width, Main.npc[num147].height))
									{
										num143 = num150;
										num141 = num148;
										num142 = num149;
										num145 = num147;
									}
								}
							}
						}
						if (type >= 390 && type <= 392 && !Collision.SolidCollision(position, width, height))
						{
							tileCollide = true;
						}
						if (num145 == -1 && num144 < num143)
						{
							num143 = num144;
						}
						else if (num145 >= 0)
						{
							flag13 = true;
							vector12 = new Vector2(num141, num142) - base.Center;
							if (type >= 390 && type <= 392)
							{
								if (Main.npc[num145].position.Y > position.Y + (float)height)
								{
									int num151 = (int)(base.Center.X / 16f);
									int num152 = (int)((position.Y + (float)height + 1f) / 16f);
									if (Main.tile[num151, num152] != null && Main.tile[num151, num152].active() && TileID.Sets.Platforms[Main.tile[num151, num152].type])
									{
										tileCollide = false;
									}
								}
								Rectangle rectangle = new Rectangle((int)position.X, (int)position.Y, width, height);
								Rectangle value = new Rectangle((int)Main.npc[num145].position.X, (int)Main.npc[num145].position.Y, Main.npc[num145].width, Main.npc[num145].height);
								int num153 = 10;
								value.X -= num153;
								value.Y -= num153;
								value.Width += num153 * 2;
								value.Height += num153 * 2;
								if (rectangle.Intersects(value))
								{
									flag14 = true;
									Vector2 vector13 = Main.npc[num145].Center - base.Center;
									if (velocity.Y > 0f && vector13.Y < 0f)
									{
										velocity.Y *= 0.5f;
									}
									if (velocity.Y < 0f && vector13.Y > 0f)
									{
										velocity.Y *= 0.5f;
									}
									if (velocity.X > 0f && vector13.X < 0f)
									{
										velocity.X *= 0.5f;
									}
									if (velocity.X < 0f && vector13.X > 0f)
									{
										velocity.X *= 0.5f;
									}
									if (vector13.Length() > 14f)
									{
										vector13.Normalize();
										vector13 *= 14f;
									}
									rotation = (rotation * 5f + vector13.ToRotation() + MathF.PI / 2f) / 6f;
									velocity = (velocity * 9f + vector13) / 10f;
									for (int num154 = 0; num154 < 1000; num154++)
									{
										if (whoAmI != num154 && owner == Main.projectile[num154].owner && Main.projectile[num154].type >= 390 && Main.projectile[num154].type <= 392 && (Main.projectile[num154].Center - base.Center).Length() < 15f)
										{
											float num155 = 0.5f;
											if (base.Center.Y > Main.projectile[num154].Center.Y)
											{
												Main.projectile[num154].velocity.Y -= num155;
												velocity.Y += num155;
											}
											else
											{
												Main.projectile[num154].velocity.Y += num155;
												velocity.Y -= num155;
											}
											if (base.Center.X > Main.projectile[num154].Center.X)
											{
												velocity.X += num155;
												Main.projectile[num154].velocity.X -= num155;
											}
											else
											{
												velocity.X -= num155;
												Main.projectile[num154].velocity.Y += num155;
											}
										}
									}
								}
							}
						}
						float num156 = 300f;
						if ((double)position.Y > Main.worldSurface * 16.0)
						{
							num156 = 150f;
						}
						if (type >= 390 && type <= 392)
						{
							num156 = 500f;
							if ((double)position.Y > Main.worldSurface * 16.0)
							{
								num156 = 250f;
							}
						}
						if (num143 < num156 + num139 && num145 == -1)
						{
							float num157 = num141 - (position.X + (float)(width / 2));
							if (num157 < -5f)
							{
								flag2 = true;
								flag3 = false;
							}
							else if (num157 > 5f)
							{
								flag3 = true;
								flag2 = false;
							}
						}
						bool flag15 = false;
						if (type >= 390 && type <= 392 && localAI[1] > 0f)
						{
							flag15 = true;
							localAI[1] -= 1f;
						}
						if (num145 >= 0 && num143 < 800f + num139)
						{
							friendly = true;
							localAI[0] = num140;
							float num158 = num141 - (position.X + (float)(width / 2));
							if (num158 < -10f)
							{
								flag2 = true;
								flag3 = false;
							}
							else if (num158 > 10f)
							{
								flag3 = true;
								flag2 = false;
							}
							if (num142 < base.Center.Y - 100f && num158 > -50f && num158 < 50f && velocity.Y == 0f)
							{
								float num159 = Math.Abs(num142 - base.Center.Y);
								if (num159 < 120f)
								{
									velocity.Y = -10f;
								}
								else if (num159 < 210f)
								{
									velocity.Y = -13f;
								}
								else if (num159 < 270f)
								{
									velocity.Y = -15f;
								}
								else if (num159 < 310f)
								{
									velocity.Y = -17f;
								}
								else if (num159 < 380f)
								{
									velocity.Y = -18f;
								}
							}
							if (flag15)
							{
								friendly = false;
								if (velocity.X < 0f)
								{
									flag2 = true;
								}
								else if (velocity.X > 0f)
								{
									flag3 = true;
								}
							}
						}
						else
						{
							friendly = false;
						}
					}
				}
				if (ai[1] != 0f)
				{
					flag2 = false;
					flag3 = false;
				}
				else if (flag6 && localAI[0] == 0f)
				{
					direction = Main.player[owner].direction;
				}
				else if (type >= 390 && type <= 392)
				{
					int num160 = (int)(base.Center.X / 16f);
					int num161 = (int)(base.Center.Y / 16f);
					if (Main.tile[num160, num161] != null && Main.tile[num160, num161].wall > 0)
					{
						flag2 = (flag3 = false);
					}
				}
				if (type == 127)
				{
					if ((double)rotation > -0.1 && (double)rotation < 0.1)
					{
						rotation = 0f;
					}
					else if (rotation < 0f)
					{
						rotation += 0.1f;
					}
					else
					{
						rotation -= 0.1f;
					}
				}
				else if (type != 313 && !flag14)
				{
					rotation = 0f;
				}
				if (type < 390 || type > 392)
				{
					tileCollide = true;
				}
				float num162 = 0.08f;
				float num163 = 6.5f;
				if (type == 127)
				{
					num163 = 2f;
					num162 = 0.04f;
				}
				if (type == 112)
				{
					num163 = 6f;
					num162 = 0.06f;
				}
				if (type == 334)
				{
					num163 = 8f;
					num162 = 0.08f;
				}
				if (type == 268)
				{
					num163 = 8f;
					num162 = 0.4f;
				}
				if (type == 324)
				{
					num162 = 0.1f;
					num163 = 3f;
				}
				if (type == 858)
				{
					num162 = 0.3f;
					num163 = 7f;
				}
				if (flag6 || type == 266 || (type >= 390 && type <= 392) || type == 816 || type == 821 || type == 825 || type == 859 || type == 860 || type == 881 || type == 884 || type == 890 || type == 891 || type == 897 || type == 899 || type == 900 || type == 934 || type == 956 || type == 958 || type == 959 || type == 960 || type == 994 || type == 998 || type == 1003 || type == 1004)
				{
					num163 = 6f;
					num162 = 0.2f;
					if (num163 < Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y))
					{
						num163 = Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y);
						num162 = 0.3f;
					}
					if (flag6)
					{
						num162 *= 2f;
					}
				}
				if (type == 875)
				{
					num163 = 7f;
					num162 = 0.25f;
					if (num163 < Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y))
					{
						num163 = Math.Abs(Main.player[owner].velocity.X) + Math.Abs(Main.player[owner].velocity.Y);
						num162 = 0.35f;
					}
				}
				if (type >= 390 && type <= 392)
				{
					num162 *= 2f;
				}
				if (flag7)
				{
					num163 = 6f;
				}
				if (flag2)
				{
					if ((double)velocity.X > -3.5)
					{
						velocity.X -= num162;
					}
					else
					{
						velocity.X -= num162 * 0.25f;
					}
				}
				else if (flag3)
				{
					if ((double)velocity.X < 3.5)
					{
						velocity.X += num162;
					}
					else
					{
						velocity.X += num162 * 0.25f;
					}
				}
				else
				{
					velocity.X *= 0.9f;
					if (velocity.X >= 0f - num162 && velocity.X <= num162)
					{
						velocity.X = 0f;
					}
				}
				if (type == 208)
				{
					velocity.X *= 0.95f;
					if ((double)velocity.X > -0.1 && (double)velocity.X < 0.1)
					{
						velocity.X = 0f;
					}
					flag2 = false;
					flag3 = false;
				}
				if (flag2 || flag3)
				{
					int num164 = (int)(position.X + (float)(width / 2)) / 16;
					int j2 = (int)(position.Y + (float)(height / 2)) / 16;
					if (type == 236)
					{
						num164 += direction;
					}
					if (flag2)
					{
						num164--;
					}
					if (flag3)
					{
						num164++;
					}
					num164 += (int)velocity.X;
					if (WorldGen.SolidTile(num164, j2))
					{
						flag5 = true;
					}
				}
				if (Main.player[owner].position.Y + (float)Main.player[owner].height - 8f > position.Y + (float)height)
				{
					flag4 = true;
				}
				if (type == 268 && frameCounter < 10)
				{
					flag5 = false;
				}
				if (type == 860 && velocity.X != 0f)
				{
					flag5 = true;
				}
				if ((type == 881 || type == 934) && velocity.X != 0f)
				{
					flag5 = true;
				}
				Collision.StepUp(ref position, ref velocity, width, height, ref stepSpeed, ref gfxOffY);
				if (velocity.Y == 0f || type == 200)
				{
					if (!flag4 && (velocity.X < 0f || velocity.X > 0f))
					{
						int num165 = (int)(position.X + (float)(width / 2)) / 16;
						int j3 = (int)(position.Y + (float)(height / 2)) / 16 + 1;
						if (flag2)
						{
							num165--;
						}
						if (flag3)
						{
							num165++;
						}
						WorldGen.SolidTile(num165, j3);
					}
					if (flag5)
					{
						int num166 = (int)(position.X + (float)(width / 2)) / 16;
						int num167 = (int)(position.Y + (float)height) / 16;
						if (WorldGen.SolidTileAllowBottomSlope(num166, num167) || Main.tile[num166, num167].halfBrick() || Main.tile[num166, num167].slope() > 0 || type == 200)
						{
							if (type == 200)
							{
								velocity.Y = -3.1f;
							}
							else
							{
								try
								{
									num166 = (int)(position.X + (float)(width / 2)) / 16;
									num167 = (int)(position.Y + (float)(height / 2)) / 16;
									if (flag2)
									{
										num166--;
									}
									if (flag3)
									{
										num166++;
									}
									num166 += (int)velocity.X;
									if (!WorldGen.SolidTile(num166, num167 - 1) && !WorldGen.SolidTile(num166, num167 - 2))
									{
										velocity.Y = -5.1f;
									}
									else if (!WorldGen.SolidTile(num166, num167 - 2))
									{
										velocity.Y = -7.1f;
									}
									else if (WorldGen.SolidTile(num166, num167 - 5))
									{
										velocity.Y = -11.1f;
									}
									else if (WorldGen.SolidTile(num166, num167 - 4))
									{
										velocity.Y = -10.1f;
									}
									else
									{
										velocity.Y = -9.1f;
									}
								}
								catch
								{
									velocity.Y = -9.1f;
								}
							}
							if (type == 127)
							{
								ai[0] = 1f;
							}
						}
					}
					else if (type == 266 && (flag2 || flag3))
					{
						velocity.Y -= 6f;
					}
				}
				if (velocity.X > num163)
				{
					velocity.X = num163;
				}
				if (velocity.X < 0f - num163)
				{
					velocity.X = 0f - num163;
				}
				if (velocity.X < 0f)
				{
					direction = -1;
				}
				if (velocity.X > 0f)
				{
					direction = 1;
				}
				if (velocity.X > num162 && flag3)
				{
					direction = 1;
				}
				if (velocity.X < 0f - num162 && flag2)
				{
					direction = -1;
				}
				if (type != 313)
				{
					if (direction == -1)
					{
						spriteDirection = 1;
					}
					if (direction == 1)
					{
						spriteDirection = -1;
					}
				}
				if (type == 398 || type == 958 || type == 960 || type == 956 || type == 959 || type == 994)
				{
					spriteDirection = direction;
				}
				bool flag16 = position.X - oldPosition.X == 0f;
				if (type == 956)
				{
					if (alpha > 0)
					{
						int num168 = Dust.NewDust(position, width, height, 6, velocity.X, velocity.Y, 0, default(Color), 1.2f);
						Main.dust[num168].velocity.X += Main.rand.NextFloat() - 0.5f;
						Main.dust[num168].velocity.Y += (Main.rand.NextFloat() + 0.5f) * -1f;
						if (Main.rand.Next(3) != 0)
						{
							Main.dust[num168].noGravity = true;
						}
						alpha -= 5;
						if (alpha < 0)
						{
							alpha = 0;
						}
					}
					if (velocity.Y != 0f)
					{
						frame = 10;
					}
					else if (flag16)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
						frame = 0;
					}
					else
					{
						float num169 = velocity.Length();
						frameCounter += (int)num169;
						if (frameCounter > 7)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 1 || frame > 9)
						{
							frame = 1;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 958)
				{
					if (velocity.Y != 0f)
					{
						localAI[0] = 0f;
						frame = 4;
					}
					else if (flag16)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
						localAI[0] += 1f;
						if (localAI[0] > 200f)
						{
							frame = 1 + (int)(localAI[0] - 200f) / 6;
							if (localAI[0] >= 218f)
							{
								frame = 0;
								localAI[0] = Main.rand.Next(100);
							}
						}
						else
						{
							frame = 0;
						}
					}
					else
					{
						localAI[0] = 0f;
						float num170 = velocity.Length();
						frameCounter += (int)num170;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 5 || frame > 12)
						{
							frame = 5;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 959)
				{
					if (velocity.Y != 0f)
					{
						frame = ((velocity.Y > 0f) ? 10 : 9);
					}
					else if (flag16)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
						frame = 0;
					}
					else
					{
						float num171 = velocity.Length();
						frameCounter += (int)num171;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 1 || frame > 8)
						{
							frame = 1;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 998)
				{
					if (velocity.Y != 0f)
					{
						frame = 1;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						frame = 0;
					}
					else
					{
						float num172 = velocity.Length();
						frameCounter += (int)num172;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 0 || frame > 5)
						{
							frame = 0;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 1003)
				{
					if (velocity.Y != 0f)
					{
						frame = 1;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						frame = 0;
					}
					else
					{
						float num173 = velocity.Length();
						frameCounter += (int)num173;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 2 || frame > 11)
						{
							frame = 2;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 1004)
				{
					if (velocity.Y != 0f)
					{
						frame = 1;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						frame = 0;
					}
					else
					{
						float num174 = velocity.Length();
						frameCounter += (int)num174;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 2 || frame > 9)
						{
							frame = 2;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 994)
				{
					if (velocity.Y != 0f)
					{
						frame = 4;
					}
					else if (flag16)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
						frameCounter++;
						if (frameCounter > 5)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 3)
						{
							frame = 0;
						}
					}
					else
					{
						float num175 = velocity.Length();
						frameCounter += (int)num175;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 5 || frame > 12)
						{
							frame = 5;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 960)
				{
					_ = Main.player[owner];
					if (velocity.Y != 0f)
					{
						localAI[0] = 0f;
						localAI[1] = 0f;
						frameCounter = 0;
						frame = 4;
					}
					else if (flag16)
					{
						if (!flag7)
						{
							spriteDirection = 1;
							if (Main.player[owner].Center.X < base.Center.X)
							{
								spriteDirection = -1;
							}
						}
						if (frame >= 5 && frame < 12)
						{
							frameCounter++;
							if (frameCounter > 3)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 12)
							{
								frame = 0;
							}
						}
						else if (Chester_IsAnyPlayerTrackingThisProjectile())
						{
							if (localAI[0] == 0f)
							{
								if (localAI[1] == 0f)
								{
									localAI[1] = 1f;
									frameCounter = 0;
								}
								frame = 13;
								frameCounter++;
								if (frameCounter > 6)
								{
									localAI[0] = 1f;
									frame = 14;
									frameCounter = 0;
								}
							}
							else
							{
								frameCounter++;
								if (frameCounter > 6)
								{
									frame++;
									if (frame > 18)
									{
										frame = 14;
									}
									frameCounter = 0;
								}
							}
						}
						else
						{
							localAI[0] = 0f;
							if (localAI[1] == 1f)
							{
								localAI[1] = 0f;
								frameCounter = 0;
							}
							if (frame >= 12 && frame <= 19)
							{
								frame = 19;
								frameCounter++;
								if (frameCounter > 6)
								{
									frame = 0;
									frameCounter = 0;
								}
							}
							else
							{
								frameCounter++;
								if (frameCounter >= 24)
								{
									frameCounter = 0;
								}
								frame = frameCounter / 6;
							}
						}
					}
					else
					{
						localAI[0] = 0f;
						localAI[1] = 0f;
						float val = velocity.Length();
						frameCounter += (int)Math.Max(2f, val);
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 5 || frame > 12)
						{
							frame = 5;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 816)
				{
					if (velocity.Y != 0f)
					{
						frame = 4;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						if (++frameCounter > 5)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 0 || frame > 3)
						{
							frame = 0;
						}
					}
					else
					{
						int num176 = 5;
						float num177 = velocity.Length();
						if (num177 > 4f)
						{
							num176 = 3;
						}
						else if (num177 > 2f)
						{
							num176 = 4;
						}
						if (++frameCounter > num176)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 4 || frame > 10)
						{
							frame = 4;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				if (type == 860)
				{
					if (velocity.Y != 0f)
					{
						localAI[0] = 0f;
						if (frame >= 5)
						{
							frame = 5;
							frameCounter = 0;
						}
						else if (++frameCounter > 5)
						{
							frame++;
							frameCounter = 0;
						}
					}
					else if (Math.Abs(velocity.X) < 1f)
					{
						if (localAI[0] > 800f)
						{
							frameCounter++;
							if (frameCounter > 3)
							{
								frameCounter = 0;
								frame++;
								if (frame > 3)
								{
									frame = 3;
								}
							}
							localAI[0] += 1f;
							if (localAI[0] > 850f)
							{
								localAI[0] = 0f;
							}
							if (frame == 3 && localAI[0] == 820f)
							{
								for (int num178 = 0; num178 < 3 + Main.rand.Next(3); num178++)
								{
									int num179 = Gore.NewGore(new Vector2(position.X, base.Center.Y - 10f), Vector2.Zero, 1218);
									Main.gore[num179].velocity = new Vector2((float)Main.rand.Next(1, 10) * 0.3f * (float)(-spriteDirection), 0f - (2f + (float)Main.rand.Next(4) * 0.3f));
								}
							}
						}
						else if (frame == 0)
						{
							localAI[0] += 1f;
							frame = 0;
							frameCounter = 0;
						}
						else
						{
							localAI[0] = 0f;
							if (frame > 5)
							{
								frame = 5;
								frameCounter = 0;
							}
							if (++frameCounter > 4)
							{
								frame--;
								frameCounter = 0;
							}
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				if (type == 859)
				{
					if (velocity.Y != 0f)
					{
						frame = 4;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						if (frame == 6)
						{
							if (++frameCounter > 5)
							{
								frame = 0;
								frameCounter = 0;
							}
						}
						else if (frame > 3)
						{
							frame = 6;
							frameCounter = 0;
						}
						else
						{
							if (++frameCounter > 5)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame < 0 || frame > 3)
							{
								frame = 0;
							}
						}
					}
					else
					{
						float num180 = velocity.Length();
						int num181 = 8;
						if (num180 < 3f)
						{
							num181 = 4;
						}
						if (num180 < 1f)
						{
							num181 = 2;
						}
						frameCounter += (int)num180;
						if (frameCounter > num181)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 5 || frame > 17)
						{
							frame = 5;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 858)
				{
					if (velocity.Y != 0f)
					{
						frame = 1;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						frame = 0;
					}
					else
					{
						float num182 = velocity.Length();
						frameCounter += (int)num182;
						if (frameCounter > 3)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 2 || frame > 9)
						{
							frame = 2;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 900)
				{
					spriteDirection = direction;
					if (velocity.Y != 0f)
					{
						frame = 1;
						frameCounter = 0;
					}
					else if (flag16)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
						frame = 0;
						frameCounter = 0;
					}
					else
					{
						frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
						if (frame < 2)
						{
							frame = 2;
							frameCounter = 0;
						}
						if (frameCounter > 4)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 9)
						{
							frame = 2;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 899)
				{
					spriteDirection = direction;
					if (velocity.Y != 0f)
					{
						frame = 1;
						frameCounter = 0;
					}
					else if (flag16)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
						frame = 0;
						frameCounter = 0;
					}
					else
					{
						frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
						if (frame < 2)
						{
							frame = 2;
							frameCounter = 0;
						}
						if (frameCounter > 4)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 9)
						{
							frame = 2;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 897)
				{
					spriteDirection = direction;
					if (velocity.Y != 0f)
					{
						frame = 1;
						frameCounter = 0;
					}
					else if (flag16)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
						frame = 0;
						frameCounter = 0;
					}
					else
					{
						frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
						if (frame < 2)
						{
							frame = 2;
							frameCounter = 0;
						}
						if (frameCounter > 4)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 7)
						{
							frame = 2;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 891)
				{
					spriteDirection = direction;
					if (velocity.Y != 0f)
					{
						frame = 1;
						frameCounter = 0;
					}
					else if (flag16)
					{
						spriteDirection = Main.player[owner].direction;
						frame = 0;
						frameCounter = 0;
					}
					else
					{
						frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
						if (frame < 2)
						{
							frame = 2;
							frameCounter = 0;
						}
						if (frameCounter > 4)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 8)
						{
							frame = 2;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 890)
				{
					spriteDirection = direction;
					if (velocity.Y != 0f)
					{
						frame = 1;
						frameCounter = 0;
					}
					else if (flag16)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
						frame = 0;
						frameCounter = 0;
					}
					else
					{
						frameCounter += 1 + (int)Math.Abs(velocity.X * 0.3f);
						if (frame < 2)
						{
							frame = 2;
							frameCounter = 0;
						}
						if (frameCounter > 4)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 7)
						{
							frame = 2;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 884)
				{
					spriteDirection = direction;
					if (velocity.Y != 0f)
					{
						if (velocity.Y < 0f)
						{
							frame = 9;
						}
						else
						{
							frame = 1;
						}
						frameCounter = 0;
					}
					else if (flag16)
					{
						spriteDirection = 1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = -1;
						}
						frame = 0;
						frameCounter = 0;
					}
					else
					{
						frameCounter += 1 + (int)Math.Abs(velocity.X * 0.5f);
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 8)
						{
							frame = 2;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 881 || type == 934)
				{
					spriteDirection = 1;
					if (Main.player[owner].Center.X < base.Center.X)
					{
						spriteDirection = -1;
					}
					if (velocity.Y > 0f)
					{
						frameCounter++;
						if (frameCounter > 2)
						{
							frame++;
							if (frame >= 2)
							{
								frame = 2;
							}
							frameCounter = 0;
						}
					}
					else if (velocity.Y < 0f)
					{
						frameCounter++;
						if (frameCounter > 2)
						{
							frame++;
							if (frame >= 5)
							{
								frame = 0;
							}
							frameCounter = 0;
						}
					}
					else if (frame == 0)
					{
						frame = 0;
					}
					else if (++frameCounter > 3)
					{
						frame++;
						if (frame >= 6)
						{
							frame = 0;
						}
						frameCounter = 0;
					}
					if (wet && Main.player[owner].position.Y + (float)Main.player[owner].height < position.Y + (float)height && localAI[0] == 0f)
					{
						if (velocity.Y > -4f)
						{
							velocity.Y -= 0.2f;
						}
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.95f;
						}
					}
					else
					{
						velocity.Y += 0.4f;
					}
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 875)
				{
					if (velocity.Y != 0f)
					{
						if (velocity.Y < 0f)
						{
							frame = 3;
						}
						else
						{
							frame = 6;
						}
						frameCounter = 0;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						frame = 0;
						frameCounter = 0;
					}
					else
					{
						frameCounter += 1 + (int)Math.Abs(velocity.X * 0.75f);
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 6)
						{
							frame = 0;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 854)
				{
					if (velocity.Y != 0f)
					{
						frame = 7;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						if (++frameCounter > 5)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 0 || frame > 3)
						{
							frame = 0;
						}
					}
					else
					{
						int num183 = 3;
						float num184 = velocity.Length();
						if (num184 > 4f)
						{
							num183 = 1;
						}
						else if (num184 > 2f)
						{
							num183 = 2;
						}
						if (++frameCounter > num183)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 4 || frame > 12)
						{
							frame = 4;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 825)
				{
					if (velocity.Y != 0f)
					{
						localAI[0] = 0f;
						frame = 12;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						if (frame >= 1 && frame <= 2)
						{
							localAI[0] = 0f;
							if (++frameCounter > 5)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 2)
							{
								frame = 0;
							}
						}
						else if (frame >= 3 && frame <= 11)
						{
							localAI[0] = 0f;
							if (++frameCounter > 5)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 11)
							{
								frame = 0;
							}
						}
						else
						{
							if (frame == 13)
							{
								if (++frameCounter > 8)
								{
									frame++;
									frameCounter = 0;
								}
								if (frame == 14)
								{
									frame = 0;
								}
							}
							if (frame != 0)
							{
								frame = 13;
							}
							else
							{
								frame = 0;
							}
							if (frame == 0)
							{
								localAI[0] += 1f;
								if (localAI[0] > 300f && Main.rand.Next(50) == 0)
								{
									switch (Main.rand.Next(2))
									{
									case 0:
										frame = 1;
										break;
									case 1:
										frame = 3;
										break;
									}
								}
							}
						}
					}
					else
					{
						localAI[0] = 0f;
						int num185 = 3;
						float num186 = velocity.Length();
						if (num186 > 4f)
						{
							num185 = 2;
						}
						else if (num186 > 2f)
						{
							num185 = 1;
						}
						if (++frameCounter > num185)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame < 13)
						{
							frame = 13;
						}
						if (frame > 19)
						{
							frame = 14;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 821)
				{
					if (velocity.Y != 0f)
					{
						localAI[0] = 0f;
						frame = 12;
					}
					else if (flag16)
					{
						spriteDirection = -1;
						if (Main.player[owner].Center.X < base.Center.X)
						{
							spriteDirection = 1;
						}
						localAI[0] += 1f;
						if (localAI[0] > 400f)
						{
							int num187 = 7;
							if (frame == 9)
							{
								num187 = 25;
							}
							if (++frameCounter > num187)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame < 5)
							{
								frame = 5;
							}
							if (frame > 11)
							{
								localAI[0] = 0f;
								frame = 0;
							}
						}
						else
						{
							if (++frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame < 0 || frame > 4)
							{
								frame = 0;
							}
						}
					}
					else
					{
						localAI[0] = 0f;
						int num188 = 4;
						float num189 = velocity.Length();
						if (num189 > 3f)
						{
							num188 = 3;
						}
						if (num189 > 5f)
						{
							num188 = 2;
						}
						if (++frameCounter > num188)
						{
							frame++;
							if (num188 == 0)
							{
								frame++;
							}
							frameCounter = 0;
						}
						if (frame < 13 || frame > 18)
						{
							frame = 13;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (flag6)
				{
					if (ai[1] > 0f)
					{
						if (localAI[1] == 0f)
						{
							localAI[1] = 1f;
							frame = 1;
						}
						if (frame != 0)
						{
							frameCounter++;
							if (frameCounter > 4)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 4)
							{
								frame = 0;
							}
						}
					}
					else if (velocity.Y == 0f)
					{
						localAI[1] = 0f;
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame < 5)
							{
								frame = 5;
							}
							if (frame >= 11)
							{
								frame = 5;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y < 0f)
					{
						frameCounter = 0;
						frame = 4;
					}
					else if (velocity.Y > 0f)
					{
						frameCounter = 0;
						frame = 4;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
					_ = velocity;
				}
				else if (type == 268)
				{
					if (velocity.Y == 0f)
					{
						if (frame > 5)
						{
							frameCounter = 0;
						}
						if (flag16)
						{
							int num190 = 3;
							frameCounter++;
							if (frameCounter < num190)
							{
								frame = 0;
							}
							else if (frameCounter < num190 * 2)
							{
								frame = 1;
							}
							else if (frameCounter < num190 * 3)
							{
								frame = 2;
							}
							else if (frameCounter < num190 * 4)
							{
								frame = 3;
							}
							else
							{
								frameCounter = num190 * 4;
							}
						}
						else
						{
							velocity.X *= 0.8f;
							frameCounter++;
							int num191 = 3;
							if (frameCounter < num191)
							{
								frame = 0;
							}
							else if (frameCounter < num191 * 2)
							{
								frame = 1;
							}
							else if (frameCounter < num191 * 3)
							{
								frame = 2;
							}
							else if (frameCounter < num191 * 4)
							{
								frame = 3;
							}
							else if (flag2 || flag3)
							{
								velocity.X *= 2f;
								frame = 4;
								velocity.Y = -6.1f;
								frameCounter = 0;
								for (int num192 = 0; num192 < 4; num192++)
								{
									int num193 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), width, 4, 5);
									Main.dust[num193].velocity += velocity;
									Main.dust[num193].velocity *= 0.4f;
								}
							}
							else
							{
								frameCounter = num191 * 4;
							}
						}
					}
					else if (velocity.Y < 0f)
					{
						frameCounter = 0;
						frame = 5;
					}
					else
					{
						frame = 4;
						frameCounter = 3;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 269)
				{
					if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							int num194 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), width, 6, 76);
							Main.dust[num194].noGravity = true;
							Main.dust[num194].velocity *= 0.3f;
							Main.dust[num194].noLight = true;
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 3)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frameCounter = 0;
						frame = 2;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 313)
				{
					int i3 = (int)(base.Center.X / 16f);
					int num195 = (int)(base.Center.Y / 16f);
					int num196 = 0;
					Tile tileSafely2 = Framing.GetTileSafely(i3, num195);
					Tile tileSafely3 = Framing.GetTileSafely(i3, num195 - 1);
					Tile tileSafely4 = Framing.GetTileSafely(i3, num195 + 1);
					if (tileSafely2.wall > 0)
					{
						num196++;
					}
					if (tileSafely3.wall > 0)
					{
						num196++;
					}
					if (tileSafely4.wall > 0)
					{
						num196++;
					}
					if (num196 > 1)
					{
						position.Y += height;
						height = 34;
						position.Y -= height;
						position.X += width / 2;
						width = 34;
						position.X -= width / 2;
						Vector2 vector14 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
						float num197 = Main.player[owner].Center.X - vector14.X;
						float num198 = Main.player[owner].Center.Y - vector14.Y;
						float num199 = (float)Math.Sqrt(num197 * num197 + num198 * num198);
						float num200 = 4f / num199;
						num197 *= num200;
						num198 *= num200;
						if (num199 < 120f)
						{
							velocity.X *= 0.9f;
							velocity.Y *= 0.9f;
							if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < 0.1)
							{
								velocity *= 0f;
							}
						}
						else
						{
							velocity.X = (velocity.X * 9f + num197) / 10f;
							velocity.Y = (velocity.Y * 9f + num198) / 10f;
						}
						if (num199 >= 120f)
						{
							spriteDirection = direction;
							rotation = (float)Math.Atan2(velocity.Y * (float)(-direction), velocity.X * (float)(-direction));
						}
						frameCounter += (int)(Math.Abs(velocity.X) + Math.Abs(velocity.Y));
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 10)
						{
							frame = 5;
						}
						if (frame < 5)
						{
							frame = 10;
						}
					}
					else
					{
						rotation = 0f;
						if (direction == -1)
						{
							spriteDirection = 1;
						}
						if (direction == 1)
						{
							spriteDirection = -1;
						}
						position.Y += height;
						height = 30;
						position.Y -= height;
						position.X += width / 2;
						width = 30;
						position.X -= width / 2;
						if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
						{
							if (flag16)
							{
								frame = 0;
								frameCounter = 0;
							}
							else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
							{
								frameCounter += (int)Math.Abs(velocity.X);
								frameCounter++;
								if (frameCounter > 6)
								{
									frame++;
									frameCounter = 0;
								}
								if (frame > 3)
								{
									frame = 0;
								}
							}
							else
							{
								frame = 0;
								frameCounter = 0;
							}
						}
						else
						{
							frameCounter = 0;
							frame = 4;
						}
						velocity.Y += 0.4f;
						if (velocity.Y > 10f)
						{
							velocity.Y = 10f;
						}
					}
				}
				else if (type >= 390 && type <= 392)
				{
					int i4 = (int)(base.Center.X / 16f);
					int num201 = (int)(base.Center.Y / 16f);
					int num202 = 0;
					Tile tileSafely5 = Framing.GetTileSafely(i4, num201);
					Tile tileSafely6 = Framing.GetTileSafely(i4, num201 - 1);
					Tile tileSafely7 = Framing.GetTileSafely(i4, num201 + 1);
					if (tileSafely5.wall > 0)
					{
						num202++;
					}
					if (tileSafely6.wall > 0)
					{
						num202++;
					}
					if (tileSafely7.wall > 0)
					{
						num202++;
					}
					if (num202 > 1)
					{
						position.Y += height;
						height = 34;
						position.Y -= height;
						position.X += width / 2;
						width = 34;
						position.X -= width / 2;
						float num203 = 9f;
						float num204 = 40 * (minionPos + 1);
						Vector2 v11 = Main.player[owner].Center - base.Center;
						if (flag13)
						{
							v11 = vector12;
							num204 = 10f;
						}
						else if (!Collision.CanHitLine(base.Center, 1, 1, Main.player[owner].Center, 1, 1))
						{
							ai[0] = 1f;
						}
						if (v11.Length() < num204)
						{
							velocity *= 0.9f;
							if ((double)(Math.Abs(velocity.X) + Math.Abs(velocity.Y)) < 0.1)
							{
								velocity *= 0f;
							}
						}
						else if (v11.Length() < 800f || !flag13)
						{
							velocity = (velocity * 9f + v11.SafeNormalize(Vector2.Zero) * num203) / 10f;
						}
						if (v11.Length() >= num204)
						{
							spriteDirection = direction;
							rotation = velocity.ToRotation() + MathF.PI / 2f;
						}
						else
						{
							rotation = v11.ToRotation() + MathF.PI / 2f;
						}
						frameCounter += (int)(Math.Abs(velocity.X) + Math.Abs(velocity.Y));
						if (frameCounter > 5)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 7)
						{
							frame = 4;
						}
						if (frame < 4)
						{
							frame = 7;
						}
					}
					else
					{
						if (!flag14)
						{
							rotation = 0f;
						}
						if (direction == -1)
						{
							spriteDirection = 1;
						}
						if (direction == 1)
						{
							spriteDirection = -1;
						}
						position.Y += height;
						height = 30;
						position.Y -= height;
						position.X += width / 2;
						width = 30;
						position.X -= width / 2;
						if (!flag13 && !Collision.CanHitLine(base.Center, 1, 1, Main.player[owner].Center, 1, 1))
						{
							ai[0] = 1f;
						}
						if (!flag14 && frame >= 4 && frame <= 7)
						{
							Vector2 vector15 = Main.player[owner].Center - base.Center;
							if (flag13)
							{
								vector15 = vector12;
							}
							float num205 = 0f - vector15.Y;
							if (!(vector15.Y > 0f))
							{
								if (num205 < 120f)
								{
									velocity.Y = -10f;
								}
								else if (num205 < 210f)
								{
									velocity.Y = -13f;
								}
								else if (num205 < 270f)
								{
									velocity.Y = -15f;
								}
								else if (num205 < 310f)
								{
									velocity.Y = -17f;
								}
								else if (num205 < 380f)
								{
									velocity.Y = -18f;
								}
							}
						}
						if (flag14)
						{
							frameCounter++;
							if (frameCounter > 3)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 8)
							{
								frame = 4;
							}
							if (frame <= 3)
							{
								frame = 7;
							}
						}
						else if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
						{
							if (flag16)
							{
								frame = 0;
								frameCounter = 0;
							}
							else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
							{
								frameCounter += (int)Math.Abs(velocity.X);
								frameCounter++;
								if (frameCounter > 5)
								{
									frame++;
									frameCounter = 0;
								}
								if (frame > 2)
								{
									frame = 0;
								}
							}
							else
							{
								frame = 0;
								frameCounter = 0;
							}
						}
						else
						{
							frameCounter = 0;
							frame = 3;
						}
						velocity.Y += 0.4f;
						if (velocity.Y > 10f)
						{
							velocity.Y = 10f;
						}
					}
				}
				else if (type == 314)
				{
					if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 6)
							{
								frame = 1;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frameCounter = 0;
						frame = 7;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 319)
				{
					if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 8)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 5)
							{
								frame = 2;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frameCounter = 0;
						frame = 1;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 236)
				{
					if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							if (frame < 2)
							{
								frame = 2;
							}
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 8)
							{
								frame = 2;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frameCounter = 0;
						frame = 1;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 499)
				{
					if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							if (frame < 2)
							{
								frame = 2;
							}
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 8)
							{
								frame = 2;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frameCounter = 0;
						frame = 1;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 765)
				{
					if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							if (frame < 1)
							{
								frame = 1;
							}
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 6)
							{
								frame = 1;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 266)
				{
					if (velocity.Y >= 0f && (double)velocity.Y <= 0.8)
					{
						if (flag16)
						{
							frameCounter++;
						}
						else
						{
							frameCounter += 3;
						}
					}
					else
					{
						frameCounter += 5;
					}
					if (frameCounter >= 20)
					{
						frameCounter -= 20;
						frame++;
					}
					if (frame > 1)
					{
						frame = 0;
					}
					if (wet && Main.player[owner].position.Y + (float)Main.player[owner].height < position.Y + (float)height && localAI[0] == 0f)
					{
						if (velocity.Y > -4f)
						{
							velocity.Y -= 0.2f;
						}
						if (velocity.Y > 0f)
						{
							velocity.Y *= 0.95f;
						}
					}
					else
					{
						velocity.Y += 0.4f;
					}
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 334)
				{
					if (velocity.Y == 0f)
					{
						if (flag16)
						{
							if (frame > 0)
							{
								frameCounter += 2;
								if (frameCounter > 6)
								{
									frame++;
									frameCounter = 0;
								}
								if (frame >= 7)
								{
									frame = 0;
								}
							}
							else
							{
								frame = 0;
								frameCounter = 0;
							}
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							frameCounter += (int)Math.Abs((double)velocity.X * 0.75);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 7 || frame < 1)
							{
								frame = 1;
							}
						}
						else if (frame > 0)
						{
							frameCounter += 2;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 7)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y < 0f)
					{
						frameCounter = 0;
						frame = 2;
					}
					else if (velocity.Y > 0f)
					{
						frameCounter = 0;
						frame = 4;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 353)
				{
					if (velocity.Y == 0f)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 9)
							{
								frame = 2;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y < 0f)
					{
						frameCounter = 0;
						frame = 1;
					}
					else if (velocity.Y > 0f)
					{
						frameCounter = 0;
						frame = 1;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 111)
				{
					if (velocity.Y == 0f)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 7)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y < 0f)
					{
						frameCounter = 0;
						frame = 4;
					}
					else if (velocity.Y > 0f)
					{
						frameCounter = 0;
						frame = 6;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 112)
				{
					if (velocity.Y == 0f)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 3)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y < 0f)
					{
						frameCounter = 0;
						frame = 2;
					}
					else if (velocity.Y > 0f)
					{
						frameCounter = 0;
						frame = 2;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 127)
				{
					if (velocity.Y == 0f)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 5)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frame = 0;
						frameCounter = 0;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 200)
				{
					if (velocity.Y == 0f)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 5)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						rotation = velocity.X * 0.1f;
						frameCounter++;
						if (velocity.Y < 0f)
						{
							frameCounter += 2;
						}
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 9)
						{
							frame = 6;
						}
						if (frame < 6)
						{
							frame = 6;
						}
					}
					velocity.Y += 0.1f;
					if (velocity.Y > 4f)
					{
						velocity.Y = 4f;
					}
				}
				else if (type == 208)
				{
					if (velocity.Y == 0f && flag16)
					{
						if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) < position.X + (float)(width / 2))
						{
							direction = -1;
						}
						else if (Main.player[owner].position.X + (float)(Main.player[owner].width / 2) > position.X + (float)(width / 2))
						{
							direction = 1;
						}
						rotation = 0f;
						frame = 0;
					}
					else
					{
						rotation = velocity.X * 0.075f;
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 4)
						{
							frame = 1;
						}
						if (frame < 1)
						{
							frame = 1;
						}
					}
					velocity.Y += 0.1f;
					if (velocity.Y > 4f)
					{
						velocity.Y = 4f;
					}
				}
				else if (type == 209)
				{
					if (alpha > 0)
					{
						alpha -= 5;
						if (alpha < 0)
						{
							alpha = 0;
						}
					}
					if (velocity.Y == 0f)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 11)
							{
								frame = 2;
							}
							if (frame < 2)
							{
								frame = 2;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frame = 1;
						frameCounter = 0;
						rotation = 0f;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 324)
				{
					if (velocity.Y == 0f)
					{
						if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 5)
							{
								frame = 2;
							}
							if (frame < 2)
							{
								frame = 2;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						frameCounter = 0;
						frame = 1;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 14f)
					{
						velocity.Y = 14f;
					}
				}
				else if (type == 210)
				{
					if (velocity.Y == 0f)
					{
						if ((double)velocity.X < -0.1 || (double)velocity.X > 0.1)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame > 6)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else
					{
						rotation = velocity.X * 0.05f;
						frameCounter++;
						if (frameCounter > 6)
						{
							frame++;
							frameCounter = 0;
						}
						if (frame > 11)
						{
							frame = 7;
						}
						if (frame < 7)
						{
							frame = 7;
						}
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
				else if (type == 398)
				{
					if (velocity.Y == 0f)
					{
						if (flag16)
						{
							frame = 0;
							frameCounter = 0;
						}
						else if ((double)velocity.X < -0.8 || (double)velocity.X > 0.8)
						{
							frameCounter += (int)Math.Abs(velocity.X);
							frameCounter++;
							if (frameCounter > 6)
							{
								frame++;
								frameCounter = 0;
							}
							if (frame >= 5)
							{
								frame = 0;
							}
						}
						else
						{
							frame = 0;
							frameCounter = 0;
						}
					}
					else if (velocity.Y != 0f)
					{
						frameCounter = 0;
						frame = 5;
					}
					velocity.Y += 0.4f;
					if (velocity.Y > 10f)
					{
						velocity.Y = 10f;
					}
				}
			}
			if (type == 891)
			{
				_ = Main.player[owner];
				DelegateMethods.v3_1 = new Vector3(1f, 0.61f, 0.16f) * 1.5f;
				Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 20f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
			}
		}

		private bool Chester_IsAnyPlayerTrackingThisProjectile()
		{
			for (int i = 0; i < 255; i++)
			{
				Player player = Main.player[i];
				if (player.active && player.piggyBankProjTracker.IsTracking(this))
				{
					return true;
				}
			}
			return false;
		}

		private void AI_062()
		{
			float num = 0f;
			float num2 = 0f;
			float num3 = 20f;
			float num4 = 40f;
			float num5 = 0.69f;
			if (type == 963)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].abigailMinion = false;
				}
				if (Main.player[owner].abigailMinion)
				{
					timeLeft = 2;
				}
				originalDamage = Main.player[owner].highestAbigailCounterOriginalDamage;
				num2 = Main.player[owner].ownedProjectileCounts[970] - 1;
				num3 = Math.Max(4f, 18f - num2 * 1.75f);
				num = 1.4f;
				num4 = Math.Max(5f, num4 - num2 * 4f);
				num5 = Math.Min(1f, num5 + num2 * 0.03f);
			}
			if (type == 423)
			{
				num4 = 5f;
			}
			if (type == 373)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].hornetMinion = false;
				}
				if (Main.player[owner].hornetMinion)
				{
					timeLeft = 2;
				}
			}
			if (type == 375)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].impMinion = false;
				}
				if (Main.player[owner].impMinion)
				{
					timeLeft = 2;
				}
			}
			if (type == 407)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].sharknadoMinion = false;
				}
				if (Main.player[owner].sharknadoMinion)
				{
					timeLeft = 2;
				}
			}
			if (type == 423)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].UFOMinion = false;
				}
				if (Main.player[owner].UFOMinion)
				{
					timeLeft = 2;
				}
			}
			if (type == 613)
			{
				if (Main.player[owner].dead)
				{
					Main.player[owner].stardustMinion = false;
				}
				if (Main.player[owner].stardustMinion)
				{
					timeLeft = 2;
				}
				Lighting.AddLight(base.Center, 0.2f, 0.6f, 0.7f);
				if (localAI[1] > 0f)
				{
					localAI[1] -= 1f;
				}
			}
			if (type == 423)
			{
				if (ai[0] == 2f)
				{
					ai[1] -= 1f;
					tileCollide = false;
					if (ai[1] > 3f)
					{
						int num6 = Dust.NewDust(base.Center, 0, 0, 220 + Main.rand.Next(2), velocity.X, velocity.Y, 100);
						Main.dust[num6].scale = 0.5f + (float)Main.rand.NextDouble() * 0.3f;
						Main.dust[num6].velocity /= 2.5f;
						Main.dust[num6].noGravity = true;
						Main.dust[num6].noLight = true;
						Main.dust[num6].frame.Y = 80;
					}
					if (ai[1] != 0f)
					{
						return;
					}
					ai[1] = 30f;
					ai[0] = 0f;
					velocity /= 5f;
					velocity.Y = 0f;
					extraUpdates = 0;
					numUpdates = 0;
					netUpdate = true;
					extraUpdates = 0;
					numUpdates = 0;
				}
				if (extraUpdates > 1)
				{
					extraUpdates = 0;
				}
				if (numUpdates > 1)
				{
					numUpdates = 0;
				}
			}
			if (type == 613)
			{
				if (ai[0] == 2f)
				{
					ai[1] -= 1f;
					tileCollide = false;
					if (ai[1] > 3f)
					{
						if (numUpdates < 20)
						{
							for (int i = 0; i < 3; i++)
							{
								Dust obj = Main.dust[Dust.NewDust(position, width, height, 229)];
								obj.noGravity = true;
								obj.position = base.Center;
								obj.velocity *= 3f;
								obj.velocity += velocity * 3f;
								obj.fadeIn = 1f;
							}
						}
						float num7 = 2f - (float)numUpdates / 30f;
						if (scale > 0f)
						{
							float num8 = 2f;
							for (int j = 0; (float)j < num8; j++)
							{
								Dust obj2 = Main.dust[Dust.NewDust(position, width, height, 229)];
								obj2.noGravity = true;
								obj2.position = base.Center + Vector2.UnitY.RotatedBy((float)numUpdates * (MathF.PI / 30f) + (float)whoAmI * (MathF.PI / 4f) + MathF.PI / 2f) * (height / 2) - velocity * ((float)j / num8);
								obj2.velocity = velocity / 3f;
								obj2.fadeIn = num7 / 2f;
								obj2.scale = num7;
							}
						}
					}
					if (ai[1] != 0f)
					{
						return;
					}
					ai[1] = 30f;
					ai[0] = 0f;
					velocity /= 5f;
					velocity.Y = 0f;
					extraUpdates = 0;
					numUpdates = 0;
					netUpdate = true;
					float num9 = 15f;
					for (int k = 0; (float)k < num9; k++)
					{
						Dust dust = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust.noGravity = true;
						dust.position = base.Center - velocity * 5f;
						dust.velocity *= 3f;
						dust.velocity += velocity * 3f;
						dust.fadeIn = 1f;
						if (Main.rand.Next(3) != 0)
						{
							dust.fadeIn = 2f;
							dust.scale = 2f;
							dust.velocity /= 8f;
						}
					}
					for (int l = 0; (float)l < num9; l++)
					{
						Dust dust2 = Main.dust[Dust.NewDust(position, width, height, 229)];
						dust2.noGravity = true;
						dust2.position = base.Center;
						dust2.velocity *= 3f;
						dust2.velocity += velocity * 3f;
						dust2.fadeIn = 1f;
						if (Main.rand.Next(3) != 0)
						{
							dust2.fadeIn = 2f;
							dust2.scale = 2f;
							dust2.velocity /= 8f;
						}
					}
					extraUpdates = 0;
					numUpdates = 0;
				}
				if (extraUpdates > 1)
				{
					extraUpdates = 0;
				}
				if (numUpdates > 1)
				{
					numUpdates = 0;
				}
			}
			if (type == 423 && localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (type == 613 && localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			float num10 = 0.05f;
			float num11 = width;
			if (type == 407)
			{
				num10 = 0.1f;
				num11 *= 2f;
			}
			for (int m = 0; m < 1000; m++)
			{
				if (m != whoAmI && Main.projectile[m].active && Main.projectile[m].owner == owner && Main.projectile[m].type == type && Math.Abs(position.X - Main.projectile[m].position.X) + Math.Abs(position.Y - Main.projectile[m].position.Y) < num11)
				{
					if (position.X < Main.projectile[m].position.X)
					{
						velocity.X -= num10;
					}
					else
					{
						velocity.X += num10;
					}
					if (position.Y < Main.projectile[m].position.Y)
					{
						velocity.Y -= num10;
					}
					else
					{
						velocity.Y += num10;
					}
				}
			}
			Vector2 vector = position;
			float num12 = 400f;
			if (type == 423)
			{
				num12 = 300f;
			}
			if (type == 613)
			{
				num12 = 300f;
			}
			num12 = 2000f;
			if (type == 963)
			{
				num12 = 700f;
			}
			bool flag = false;
			int num13 = -1;
			tileCollide = true;
			if (type == 963)
			{
				tileCollide = false;
			}
			if (type == 407)
			{
				tileCollide = false;
				if (Collision.SolidCollision(position, width, height))
				{
					alpha += 20;
					if (alpha > 150)
					{
						alpha = 150;
					}
				}
				else
				{
					alpha -= 50;
					if (alpha < 60)
					{
						alpha = 60;
					}
				}
			}
			if (type == 407 || type == 613 || type == 423)
			{
				Vector2 center = Main.player[owner].Center;
				Vector2 vector2 = new Vector2(0.5f);
				if (type == 423)
				{
					vector2.Y = 0f;
				}
				NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
				if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
				{
					Vector2 vector3 = ownerMinionAttackTargetNPC.position + ownerMinionAttackTargetNPC.Size * vector2;
					float num14 = num12 * 3f;
					float num15 = Vector2.Distance(vector3, center);
					if (num15 < num14 && !flag && Collision.CanHitLine(position, width, height, ownerMinionAttackTargetNPC.position, ownerMinionAttackTargetNPC.width, ownerMinionAttackTargetNPC.height))
					{
						num12 = num15;
						vector = vector3;
						flag = true;
						num13 = ownerMinionAttackTargetNPC.whoAmI;
					}
				}
				if (!flag)
				{
					for (int n = 0; n < 200; n++)
					{
						NPC nPC = Main.npc[n];
						if (nPC.CanBeChasedBy(this))
						{
							Vector2 vector4 = nPC.position + nPC.Size * vector2;
							float num16 = Vector2.Distance(vector4, center);
							if (!(num16 >= num12) && Collision.CanHitLine(position, width, height, nPC.position, nPC.width, nPC.height))
							{
								num12 = num16;
								vector = vector4;
								flag = true;
								num13 = n;
							}
						}
					}
				}
			}
			else
			{
				NPC ownerMinionAttackTargetNPC2 = OwnerMinionAttackTargetNPC;
				if (ownerMinionAttackTargetNPC2 != null && ownerMinionAttackTargetNPC2.CanBeChasedBy(this))
				{
					float num17 = Vector2.Distance(ownerMinionAttackTargetNPC2.Center, base.Center);
					float num18 = num12 * 3f;
					if (num17 < num18 && !flag)
					{
						bool flag2 = false;
						if ((type != 963) ? Collision.CanHitLine(position, width, height, ownerMinionAttackTargetNPC2.position, ownerMinionAttackTargetNPC2.width, ownerMinionAttackTargetNPC2.height) : Collision.CanHit(base.Center, 1, 1, ownerMinionAttackTargetNPC2.Center, 1, 1))
						{
							num12 = num17;
							vector = ownerMinionAttackTargetNPC2.Center;
							flag = true;
							num13 = ownerMinionAttackTargetNPC2.whoAmI;
						}
					}
				}
				if (!flag)
				{
					for (int num19 = 0; num19 < 200; num19++)
					{
						NPC nPC2 = Main.npc[num19];
						if (!nPC2.CanBeChasedBy(this))
						{
							continue;
						}
						float num20 = Vector2.Distance(nPC2.Center, base.Center);
						if (!(num20 >= num12))
						{
							bool flag3 = false;
							if ((type != 963) ? Collision.CanHitLine(position, width, height, nPC2.position, nPC2.width, nPC2.height) : Collision.CanHit(base.Center, 1, 1, nPC2.Center, 1, 1))
							{
								num12 = num20;
								vector = nPC2.Center;
								flag = true;
								num13 = num19;
							}
						}
					}
				}
			}
			int num21 = 500;
			if (type == 963)
			{
				num21 = 800;
			}
			if (flag)
			{
				num21 = 1000;
			}
			if (flag && type == 423)
			{
				num21 = 1200;
			}
			if (flag && type == 613)
			{
				num21 = 1350;
			}
			Player player = Main.player[owner];
			if (Vector2.Distance(player.Center, base.Center) > (float)num21)
			{
				ai[0] = 1f;
				netUpdate = true;
			}
			if (ai[0] == 1f)
			{
				tileCollide = false;
			}
			bool flag4 = false;
			if (type == 963)
			{
				flag4 = true;
			}
			if (flag4)
			{
				if (ai[0] <= 1f && localAI[1] <= 0f)
				{
					localAI[1] = -1f;
				}
				else
				{
					localAI[1] = Utils.Clamp(localAI[1] + 0.05f, 0f, 1f);
					if (localAI[1] == 1f)
					{
						localAI[1] = -1f;
					}
				}
			}
			if (type == 963 && velocity.Length() > 0.1f && Main.rand.Next(1500) == 0)
			{
				SoundEngine.PlaySound(SoundID.AbigailCry, base.Center);
			}
			bool flag5 = false;
			if (type == 423 || type == 407)
			{
				flag5 = true;
			}
			if (ai[0] >= 2f)
			{
				if (ai[0] == 2f && type == 963)
				{
					SoundEngine.PlaySound(SoundID.AbigailAttack, base.Center);
				}
				ai[0] += 1f;
				if (flag4)
				{
					localAI[1] = ai[0] / num4;
				}
				if (!flag)
				{
					ai[0] += 1f;
				}
				if (ai[0] > num4)
				{
					ai[0] = 0f;
					netUpdate = true;
					if (flag && type == 963 && (vector - base.Center).Length() < 50f)
					{
						ai[0] = 2f;
					}
				}
				velocity *= num5;
			}
			else if (flag && (flag5 || ai[0] == 0f))
			{
				Vector2 v = vector - base.Center;
				float num22 = v.Length();
				v = v.SafeNormalize(Vector2.Zero);
				if (type == 423)
				{
					v = vector - Vector2.UnitY * 80f;
					int num23 = (int)v.Y / 16;
					if (num23 < 0)
					{
						num23 = 0;
					}
					Tile tile = Main.tile[(int)v.X / 16, num23];
					if (tile != null && tile.active() && Main.tileSolid[tile.type] && !Main.tileSolidTop[tile.type])
					{
						v += Vector2.UnitY * 16f;
						tile = Main.tile[(int)v.X / 16, (int)v.Y / 16];
						if (tile != null && tile.active() && Main.tileSolid[tile.type] && !Main.tileSolidTop[tile.type])
						{
							v += Vector2.UnitY * 16f;
						}
					}
					v -= base.Center;
					num22 = v.Length();
					v = v.SafeNormalize(Vector2.Zero);
					if (num22 > 300f && num22 <= 800f && localAI[0] == 0f)
					{
						ai[0] = 2f;
						ai[1] = (int)(num22 / 10f);
						extraUpdates = (int)ai[1];
						velocity = v * 10f;
						localAI[0] = 60f;
						return;
					}
				}
				if (type == 613)
				{
					v = vector;
					Vector2 vector5 = base.Center - v;
					if (vector5 == Vector2.Zero)
					{
						vector5 = -Vector2.UnitY;
					}
					vector5 = vector5.SafeNormalize(Vector2.Zero);
					v += vector5 * 60f;
					int num24 = (int)v.Y / 16;
					if (num24 < 0)
					{
						num24 = 0;
					}
					Tile tile2 = Main.tile[(int)v.X / 16, num24];
					if (tile2 != null && tile2.active() && Main.tileSolid[tile2.type] && !Main.tileSolidTop[tile2.type])
					{
						v += Vector2.UnitY * 16f;
						tile2 = Main.tile[(int)v.X / 16, (int)v.Y / 16];
						if (tile2 != null && tile2.active() && Main.tileSolid[tile2.type] && !Main.tileSolidTop[tile2.type])
						{
							v += Vector2.UnitY * 16f;
						}
					}
					v -= base.Center;
					num22 = v.Length();
					v = v.SafeNormalize(Vector2.Zero);
					if (num22 > 400f && num22 <= 800f && localAI[0] == 0f)
					{
						ai[0] = 2f;
						ai[1] = (int)(num22 / 10f);
						extraUpdates = (int)ai[1];
						velocity = v * 10f;
						localAI[0] = 60f;
						return;
					}
				}
				if (type == 407)
				{
					if (num22 > 400f)
					{
						float num25 = 3f;
						v *= num25;
						velocity = (velocity * 20f + v) / 21f;
					}
					else
					{
						velocity *= 0.96f;
					}
				}
				if (num22 > 200f)
				{
					float num26 = 6f + num2 * num;
					v *= num26;
					float num27 = num3 * 2f;
					velocity.X = (velocity.X * num27 + v.X) / (num27 + 1f);
					velocity.Y = (velocity.Y * num27 + v.Y) / (num27 + 1f);
				}
				else if (type == 963)
				{
					if (num22 < 50f)
					{
						velocity *= 0.5f;
						ai[0] = 2f;
						netUpdate = true;
					}
					else
					{
						float num28 = 4f + num2 * num;
						v *= num28;
						velocity = (velocity * num3 + v) / (num3 + 1f);
					}
				}
				else if (type == 423 || type == 613)
				{
					if (num22 > 70f && num22 < 130f)
					{
						float num29 = 7f;
						if (num22 < 100f)
						{
							num29 = -3f;
						}
						v *= num29;
						velocity = (velocity * 20f + v) / 21f;
						if (Math.Abs(v.X) > Math.Abs(v.Y))
						{
							velocity.X = (velocity.X * 10f + v.X) / 11f;
						}
					}
					else
					{
						velocity *= 0.97f;
					}
				}
				else if (type == 375)
				{
					if (num22 < 150f)
					{
						float num30 = 4f;
						v *= 0f - num30;
						velocity.X = (velocity.X * 40f + v.X) / 41f;
						velocity.Y = (velocity.Y * 40f + v.Y) / 41f;
					}
					else
					{
						velocity *= 0.97f;
					}
				}
				else if (velocity.Y > -1f)
				{
					velocity.Y -= 0.1f;
				}
			}
			else
			{
				if (type != 963 && !Collision.CanHitLine(base.Center, 1, 1, Main.player[owner].Center, 1, 1))
				{
					ai[0] = 1f;
				}
				float num31 = 6f;
				if (ai[0] == 1f)
				{
					num31 = 15f;
				}
				if (type == 407)
				{
					num31 = 9f;
				}
				if (type == 963)
				{
					num31 *= 0.8f;
				}
				Vector2 center2 = base.Center;
				Vector2 v2 = player.Center - center2 + new Vector2(0f, -60f);
				if (type == 407)
				{
					v2 += new Vector2(0f, 40f);
				}
				if (type == 963)
				{
					v2 += new Vector2(-40 * Main.player[owner].direction, 40f);
				}
				if (type == 375)
				{
					ai[1] = 80f;
					netUpdate = true;
					v2 = player.Center - center2;
					int num32 = 1;
					for (int num33 = 0; num33 < whoAmI; num33++)
					{
						if (Main.projectile[num33].active && Main.projectile[num33].owner == owner && Main.projectile[num33].type == type)
						{
							num32++;
						}
					}
					v2.X -= 10 * Main.player[owner].direction;
					v2.X -= num32 * 40 * Main.player[owner].direction;
					v2.Y -= 10f;
				}
				float num34 = v2.Length();
				if (num34 > 200f && num31 < 9f)
				{
					num31 = 9f;
				}
				if ((type == 423 || type == 407) && num34 > 300f && num31 < 12f)
				{
					num31 = 12f;
				}
				if (type == 375)
				{
					num31 = (int)((double)num31 * 0.75);
				}
				if (num34 < 100f && ai[0] == 1f && !Collision.SolidCollision(position, width, height))
				{
					ai[0] = 0f;
					netUpdate = true;
				}
				if (num34 > 2000f)
				{
					position.X = Main.player[owner].Center.X - (float)(width / 2);
					position.Y = Main.player[owner].Center.Y - (float)(width / 2);
				}
				if (type == 375 || type == 963)
				{
					if (num34 > 10f)
					{
						v2 = v2.SafeNormalize(Vector2.Zero);
						if (num34 < 50f)
						{
							num31 /= 2f;
						}
						v2 *= num31;
						velocity = (velocity * 20f + v2) / 21f;
					}
					else
					{
						direction = Main.player[owner].direction;
						velocity *= 0.9f;
					}
				}
				else if (type == 407)
				{
					if (Math.Abs(v2.X) > 40f || Math.Abs(v2.Y) > 10f)
					{
						v2 = v2.SafeNormalize(Vector2.Zero);
						v2 *= num31;
						v2 *= new Vector2(1.25f, 0.65f);
						velocity = (velocity * 20f + v2) / 21f;
					}
					else
					{
						if (velocity.X == 0f && velocity.Y == 0f)
						{
							velocity.X = -0.15f;
							velocity.Y = -0.05f;
						}
						velocity *= 1.01f;
					}
				}
				else if (num34 > 70f)
				{
					v2 = v2.SafeNormalize(Vector2.Zero);
					v2 *= num31;
					velocity = (velocity * 20f + v2) / 21f;
				}
				else
				{
					if (velocity.X == 0f && velocity.Y == 0f)
					{
						velocity.X = -0.15f;
						velocity.Y = -0.05f;
					}
					velocity *= 1.01f;
				}
				if (num34 > 250f && (type == 423 || type == 407))
				{
					float x = Main.player[owner].velocity.X;
					float y = Main.player[owner].velocity.Y;
					if ((velocity.X < 0f && x >= 0f) || (velocity.X >= 0f && x < 0f))
					{
						velocity.X *= 0.95f;
					}
					else
					{
						velocity.X += x * 0.125f;
					}
					if ((velocity.Y < 0f && y >= 0f) || (velocity.Y >= 0f && y < 0f))
					{
						velocity.Y *= 0.95f;
					}
					else
					{
						velocity.Y += y * 0.125f;
					}
					if (velocity.Length() > num31)
					{
						velocity = velocity.SafeNormalize(Vector2.Zero) * num31;
					}
				}
			}
			rotation = velocity.X * 0.05f;
			frameCounter++;
			if (type == 373)
			{
				if (frameCounter > 1)
				{
					frame++;
					frameCounter = 0;
				}
				if (frame > 2)
				{
					frame = 0;
				}
			}
			if (type == 963)
			{
				if (ai[0] >= 2f)
				{
					int num35 = 12;
					if (frame < 8)
					{
						frameCounter = 0;
					}
					frameCounter++;
					frame = frameCounter / num35;
					if (frame > 6)
					{
						frameCounter = 0;
						frame = 5;
					}
					switch (frame)
					{
					case 0:
					case 1:
					case 2:
						frame = 8 + frame;
						break;
					case 3:
					case 5:
					case 7:
						frame = 11;
						break;
					default:
						frame = 12;
						break;
					}
					if (Main.rand.Next(2) == 0)
					{
						float num36 = 1.1f + Main.rand.NextFloat() * 0.3f;
						float num37 = 1.4f + Main.rand.NextFloat() * 0.4f;
						Vector2 vector6 = Main.rand.NextVector2CircularEdge((float)width * num36, (0f - (float)height) * 0.25f * num36);
						float num38 = vector6.ToRotation() + MathF.PI / 2f;
						int num39 = Dust.NewDust(base.Bottom + vector6, 1, 1, 303, 0f, 0f, 50, Color.GhostWhite, num37);
						Main.dust[num39].velocity = vector6 * 0.0125f + new Vector2(1f, 0f).RotatedBy(num38, Vector2.Zero);
						Main.dust[num39].noGravity = true;
					}
				}
				else
				{
					if (frame > 7)
					{
						frame = 0;
						frameCounter = 0;
					}
					if (frameCounter > 6)
					{
						frameCounter = 0;
						frame++;
						if (frame > 7)
						{
							frame = 0;
						}
					}
				}
			}
			if (type == 375)
			{
				if (frameCounter >= 16)
				{
					frameCounter = 0;
				}
				frame = frameCounter / 4;
				if (ai[1] > 0f && ai[1] < 16f)
				{
					frame += 4;
				}
				if (Main.rand.Next(6) == 0)
				{
					int num40 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num40].velocity *= 0.3f;
					Main.dust[num40].noGravity = true;
					Main.dust[num40].noLight = true;
				}
			}
			if (type == 407)
			{
				int num41 = 2;
				if (frameCounter >= 6 * num41)
				{
					frameCounter = 0;
				}
				frame = frameCounter / num41;
				if (Main.rand.Next(5) == 0)
				{
					int num42 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 217, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num42].velocity *= 0.3f;
					Main.dust[num42].noGravity = true;
					Main.dust[num42].noLight = true;
				}
			}
			if (type == 423 || type == 613)
			{
				int num43 = 3;
				if (frameCounter >= 4 * num43)
				{
					frameCounter = 0;
				}
				frame = frameCounter / num43;
			}
			if (velocity.X > 0f)
			{
				spriteDirection = (direction = -1);
			}
			else if (velocity.X < 0f)
			{
				spriteDirection = (direction = 1);
			}
			if (type == 963)
			{
				spriteDirection = (direction *= -1);
				if (!flag && Math.Abs(velocity.X) < 0.1f)
				{
					spriteDirection = ((Main.player[owner].Center.X > base.Center.X) ? 1 : (-1));
				}
			}
			if (type == 373)
			{
				if (ai[1] > 0f)
				{
					ai[1] += Main.rand.Next(1, 4);
				}
				int num44 = 90;
				if (Main.player[owner].strongBees)
				{
					num44 = 70;
				}
				if (ai[1] > (float)num44)
				{
					ai[1] = 0f;
					netUpdate = true;
				}
			}
			else if (type == 375)
			{
				if (ai[1] > 0f)
				{
					ai[1] += 1f;
					if (Main.rand.Next(3) == 0)
					{
						ai[1] += 1f;
					}
				}
				if (ai[1] > 90f)
				{
					ai[1] = 0f;
					netUpdate = true;
				}
			}
			else if (type == 407)
			{
				if (ai[1] > 0f)
				{
					ai[1] += 1f;
					if (Main.rand.Next(3) != 0)
					{
						ai[1] += 1f;
					}
				}
				if (ai[1] > 50f)
				{
					ai[1] = 0f;
					netUpdate = true;
				}
			}
			else if (type == 423)
			{
				if (ai[1] > 0f)
				{
					ai[1] += 1f;
					if (Main.rand.Next(3) != 0)
					{
						ai[1] += 1f;
					}
				}
				if (ai[1] > 36f)
				{
					ai[1] = 0f;
					netUpdate = true;
				}
			}
			else if (type == 613)
			{
				if (ai[1] > 0f)
				{
					ai[1] += 1f;
					if (Main.rand.Next(3) != 0)
					{
						ai[1] += 1f;
					}
				}
				if (ai[1] > 60f)
				{
					ai[1] = 0f;
					netUpdate = true;
				}
			}
			if (!flag5 && ai[0] != 0f)
			{
				return;
			}
			float num45 = 0f;
			int num46 = 0;
			if (type == 373)
			{
				num45 = 10f;
				num46 = 374;
			}
			else if (type == 375)
			{
				num45 = 11f;
				num46 = 376;
			}
			else if (type == 407)
			{
				num45 = 20f;
				num46 = 408;
			}
			else if (type == 423)
			{
				num45 = 4f;
				num46 = 433;
			}
			else if (type == 613)
			{
				num45 = 14f;
				num46 = 614;
			}
			if (!flag)
			{
				return;
			}
			if (type == 375)
			{
				if ((vector - base.Center).X > 0f)
				{
					spriteDirection = (direction = -1);
				}
				else if ((vector - base.Center).X < 0f)
				{
					spriteDirection = (direction = 1);
				}
			}
			if (type == 407 && Collision.SolidCollision(position, width, height))
			{
				return;
			}
			if (type == 423)
			{
				if (Math.Abs((vector - base.Center).ToRotation() - MathF.PI / 2f) > MathF.PI / 4f)
				{
					velocity += (vector - base.Center - Vector2.UnitY * 80f).SafeNormalize(Vector2.Zero);
				}
				if (!((vector - base.Center).Length() > 400f) && ai[1] == 0f)
				{
					ai[1] += 1f;
					if (Main.myPlayer == owner)
					{
						Vector2 v3 = vector - base.Center;
						v3 = v3.SafeNormalize(Vector2.Zero);
						v3 *= num45;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, v3.X, v3.Y, num46, damage, knockBack, Main.myPlayer);
						netUpdate = true;
					}
				}
			}
			else if (ai[1] == 0f && type == 613)
			{
				if ((vector - base.Center).Length() > 500f || ai[1] != 0f)
				{
					return;
				}
				ai[1] += 1f;
				if (Main.myPlayer == owner)
				{
					Vector2 v4 = vector - base.Center;
					v4 = v4.SafeNormalize(Vector2.Zero);
					v4 *= num45;
					int num47 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, v4.X, v4.Y, num46, damage, knockBack, Main.myPlayer, 0f, num13);
					Main.projectile[num47].timeLeft = 300;
					Main.projectile[num47].netUpdate = true;
					velocity -= v4 / 3f;
					netUpdate = true;
				}
				for (int num48 = 0; num48 < 5; num48++)
				{
					int num49 = width / 4;
					_ = ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2() * Main.rand.Next(24, 41) / 8f;
					int num50 = Dust.NewDust(base.Center - Vector2.One * num49, num49 * 2, num49 * 2, 88);
					Dust dust3 = Main.dust[num50];
					Vector2 vector7 = (dust3.position - base.Center).SafeNormalize(Vector2.Zero);
					dust3.position = base.Center + vector7 * num49 * scale - new Vector2(4f);
					if (num48 < 30)
					{
						dust3.velocity = vector7 * dust3.velocity.Length() * 2f;
					}
					else
					{
						dust3.velocity = 2f * vector7 * Main.rand.Next(45, 91) / 10f;
					}
					dust3.noGravity = true;
					dust3.scale = 0.7f + Main.rand.NextFloat();
				}
			}
			else if (ai[1] == 0f)
			{
				Vector2 v5 = vector - base.Center;
				ai[1] += 1f;
				if (Main.myPlayer == owner)
				{
					v5 = v5.SafeNormalize(Vector2.Zero);
					v5 *= num45;
					int num51 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, v5.X, v5.Y, num46, damage, knockBack, Main.myPlayer);
					Main.projectile[num51].timeLeft = 300;
					Main.projectile[num51].netUpdate = true;
					netUpdate = true;
				}
			}
		}

		private void AI_075()
		{
			Player player = Main.player[owner];
			float num = MathF.PI / 2f;
			Vector2 vector = player.RotatedRelativePoint(player.MountedCenter);
			int num2 = 2;
			float num3 = 0f;
			if (type == 439)
			{
				ai[0] += 1f;
				int num4 = 0;
				if (ai[0] >= 40f)
				{
					num4++;
				}
				if (ai[0] >= 80f)
				{
					num4++;
				}
				if (ai[0] >= 120f)
				{
					num4++;
				}
				int num5 = 24;
				int num6 = 6;
				ai[1] += 1f;
				bool flag = false;
				if (ai[1] >= (float)(num5 - num6 * num4))
				{
					ai[1] = 0f;
					flag = true;
				}
				frameCounter += 1 + num4;
				if (frameCounter >= 4)
				{
					frameCounter = 0;
					frame++;
					if (frame >= 6)
					{
						frame = 0;
					}
				}
				if (soundDelay <= 0)
				{
					soundDelay = num5 - num6 * num4;
					if (ai[0] != 1f)
					{
						SoundEngine.PlaySound(SoundID.Item91, position);
					}
				}
				if (ai[1] == 1f && ai[0] != 1f)
				{
					Vector2 spinningpoint = Vector2.UnitX * 24f;
					spinningpoint = spinningpoint.RotatedBy(rotation - MathF.PI / 2f);
					Vector2 vector2 = base.Center + spinningpoint;
					for (int i = 0; i < 2; i++)
					{
						int num7 = Dust.NewDust(vector2 - Vector2.One * 8f, 16, 16, 135, velocity.X / 2f, velocity.Y / 2f, 100);
						Main.dust[num7].velocity *= 0.66f;
						Main.dust[num7].noGravity = true;
						Main.dust[num7].scale = 1.4f;
					}
				}
				if (flag && Main.myPlayer == owner)
				{
					if (player.channel && player.CheckMana(player.inventory[player.selectedItem].mana, pay: true) && !player.noItems && !player.CCed)
					{
						float num8 = player.inventory[player.selectedItem].shootSpeed * scale;
						Vector2 vector3 = vector;
						Vector2 value = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector3;
						if (player.gravDir == -1f)
						{
							value.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector3.Y;
						}
						Vector2 vector4 = Vector2.Normalize(value);
						if (float.IsNaN(vector4.X) || float.IsNaN(vector4.Y))
						{
							vector4 = -Vector2.UnitY;
						}
						vector4 *= num8;
						if (vector4.X != velocity.X || vector4.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = vector4;
						int num9 = 440;
						float num10 = 14f;
						int num11 = 7;
						for (int j = 0; j < 2; j++)
						{
							vector3 = base.Center + new Vector2(Main.rand.Next(-num11, num11 + 1), Main.rand.Next(-num11, num11 + 1));
							Vector2 spinningpoint2 = Vector2.Normalize(velocity) * num10;
							spinningpoint2 = spinningpoint2.RotatedBy(Main.rand.NextDouble() * 0.19634954631328583 - 0.09817477315664291);
							if (float.IsNaN(spinningpoint2.X) || float.IsNaN(spinningpoint2.Y))
							{
								spinningpoint2 = -Vector2.UnitY;
							}
							NewProjectile(GetProjectileSource_FromThis(), vector3.X, vector3.Y, spinningpoint2.X, spinningpoint2.Y, num9, damage, knockBack, owner);
						}
					}
					else
					{
						Kill();
					}
				}
			}
			if (type == 445)
			{
				if (soundDelay <= 0)
				{
					SoundEngine.PlaySound(SoundID.Item132, position);
					soundDelay = 23;
				}
				localAI[0] += 1f;
				if (localAI[0] >= 60f)
				{
					localAI[0] = 0f;
				}
				if (Vector2.Distance(vector, base.Center) >= 5f)
				{
					float num12 = localAI[0] / 60f;
					if (num12 > 0.5f)
					{
						num12 = 1f - num12;
					}
					Vector3 value2 = new Vector3(0f, 1f, 0.7f);
					Vector3 value3 = new Vector3(0f, 0.7f, 1f);
					Vector3 vector5 = Vector3.Lerp(value2, value3, 1f - num12 * 2f) * 0.5f;
					if (Vector2.Distance(vector, base.Center) >= 30f)
					{
						Vector2 vector6 = base.Center - vector;
						vector6.Normalize();
						vector6 *= Vector2.Distance(vector, base.Center) - 30f;
						DelegateMethods.v3_1 = vector5 * 0.8f;
						Utils.PlotTileLine(base.Center - vector6, base.Center, 8f, DelegateMethods.CastLightOpen);
					}
					Lighting.AddLight((int)base.Center.X / 16, (int)base.Center.Y / 16, vector5.X, vector5.Y, vector5.Z);
				}
				if (Main.myPlayer == owner)
				{
					if (localAI[1] > 0f)
					{
						localAI[1] -= 1f;
					}
					if (!player.channel || player.noItems || player.CCed)
					{
						Kill();
					}
					else if (localAI[1] == 0f)
					{
						Vector2 vector7 = vector;
						Vector2 value4 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector7;
						if (player.gravDir == -1f)
						{
							value4.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector7.Y;
						}
						if (Main.tile[Player.tileTargetX, Player.tileTargetY].active())
						{
							value4 = new Vector2(Player.tileTargetX, Player.tileTargetY) * 16f + Vector2.One * 8f - vector7;
							localAI[1] = 2f;
						}
						value4 = Vector2.Lerp(value4, velocity, 0.7f);
						if (float.IsNaN(value4.X) || float.IsNaN(value4.Y))
						{
							value4 = -Vector2.UnitY;
						}
						float num13 = 30f;
						if (value4.Length() < num13)
						{
							value4 = Vector2.Normalize(value4) * num13;
						}
						int tileBoost = player.inventory[player.selectedItem].tileBoost;
						int num14 = -Player.tileRangeX - tileBoost + 1;
						int num15 = Player.tileRangeX + tileBoost - 1;
						int num16 = -Player.tileRangeY - tileBoost;
						int num17 = Player.tileRangeY + tileBoost - 1;
						int num18 = 12;
						bool flag2 = false;
						if (value4.X < (float)(num14 * 16 - num18))
						{
							flag2 = true;
						}
						if (value4.Y < (float)(num16 * 16 - num18))
						{
							flag2 = true;
						}
						if (value4.X > (float)(num15 * 16 + num18))
						{
							flag2 = true;
						}
						if (value4.Y > (float)(num17 * 16 + num18))
						{
							flag2 = true;
						}
						if (flag2)
						{
							Vector2 vector8 = Vector2.Normalize(value4);
							float num19 = -1f;
							if (vector8.X < 0f && ((float)(num14 * 16 - num18) / vector8.X < num19 || num19 == -1f))
							{
								num19 = (float)(num14 * 16 - num18) / vector8.X;
							}
							if (vector8.X > 0f && ((float)(num15 * 16 + num18) / vector8.X < num19 || num19 == -1f))
							{
								num19 = (float)(num15 * 16 + num18) / vector8.X;
							}
							if (vector8.Y < 0f && ((float)(num16 * 16 - num18) / vector8.Y < num19 || num19 == -1f))
							{
								num19 = (float)(num16 * 16 - num18) / vector8.Y;
							}
							if (vector8.Y > 0f && ((float)(num17 * 16 + num18) / vector8.Y < num19 || num19 == -1f))
							{
								num19 = (float)(num17 * 16 + num18) / vector8.Y;
							}
							value4 = vector8 * num19;
						}
						if (value4.X != velocity.X || value4.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = value4;
					}
				}
			}
			if (type == 460)
			{
				ai[0] += 1f;
				int num20 = 0;
				if (ai[0] >= 80f)
				{
					num20++;
				}
				if (ai[0] >= 180f)
				{
					num20++;
				}
				bool flag3 = false;
				_ = ai[0];
				if (ai[0] == 80f || ai[0] == 180f || (ai[0] > 180f && ai[0] % 20f == 0f))
				{
					flag3 = true;
				}
				bool flag4 = ai[0] >= 180f;
				int num21 = 5;
				if (!flag4)
				{
					ai[1] += 1f;
				}
				bool flag5 = false;
				if (ai[0] == 1f)
				{
					flag5 = true;
				}
				if (flag4 && ai[0] % 20f == 0f)
				{
					flag5 = true;
				}
				if ((!flag4 && ai[1] >= (float)num21) || (flag4 && ai[0] % 5f == 0f))
				{
					if (!flag4)
					{
						ai[1] = 0f;
					}
					flag5 = true;
					float num22 = player.inventory[player.selectedItem].shootSpeed * scale;
					Vector2 vector9 = vector;
					Vector2 value5 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector9;
					if (player.gravDir == -1f)
					{
						value5.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector9.Y;
					}
					Vector2 vector10 = Vector2.Normalize(value5);
					if (float.IsNaN(vector10.X) || float.IsNaN(vector10.Y))
					{
						vector10 = -Vector2.UnitY;
					}
					vector10 *= num22;
					if (vector10.X != velocity.X || vector10.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vector10;
				}
				if (soundDelay <= 0 && !flag4)
				{
					soundDelay = num21 - num20;
					soundDelay *= 2;
					if (ai[0] != 1f)
					{
						SoundEngine.PlaySound(SoundID.Item15, position);
					}
				}
				if (ai[0] > 10f && !flag4)
				{
					Vector2 spinningpoint3 = Vector2.UnitX * 18f;
					spinningpoint3 = spinningpoint3.RotatedBy(rotation - MathF.PI / 2f);
					Vector2 vector11 = base.Center + spinningpoint3;
					for (int k = 0; k < num20 + 1; k++)
					{
						int num23 = 226;
						float num24 = 0.4f;
						if (k % 2 == 1)
						{
							num23 = 226;
							num24 = 0.65f;
						}
						Vector2 vector12 = vector11 + ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2() * (12f - (float)(num20 * 2));
						int num25 = Dust.NewDust(vector12 - Vector2.One * 8f, 16, 16, num23, velocity.X / 2f, velocity.Y / 2f);
						Main.dust[num25].velocity = Vector2.Normalize(vector11 - vector12) * 1.5f * (10f - (float)num20 * 2f) / 10f;
						Main.dust[num25].noGravity = true;
						Main.dust[num25].scale = num24;
						Main.dust[num25].customData = player;
					}
				}
				if (flag4)
				{
					Vector2 spinningpoint4 = Vector2.UnitX * 14f;
					spinningpoint4 = spinningpoint4.RotatedBy(rotation - MathF.PI / 2f);
					Vector2 vector13 = base.Center + spinningpoint4;
					for (int l = 0; l < 2; l++)
					{
						int num26 = 226;
						float num27 = 0.35f;
						if (l % 2 == 1)
						{
							num26 = 226;
							num27 = 0.45f;
						}
						float num28 = Main.rand.NextFloatDirection();
						Vector2 vector14 = vector13 + (rotation + num28 * (MathF.PI / 4f) * 0.8f - MathF.PI / 2f).ToRotationVector2() * 6f;
						int num29 = 24;
						int num30 = Dust.NewDust(vector14 - Vector2.One * (num29 / 2), num29, num29, num26, velocity.X / 2f, velocity.Y / 2f);
						Main.dust[num30].velocity = (vector14 - vector13).SafeNormalize(Vector2.Zero) * MathHelper.Lerp(1.5f, 9f, Utils.GetLerpValue(1f, 0f, Math.Abs(num28), clamped: true));
						Main.dust[num30].noGravity = true;
						Main.dust[num30].scale = num27;
						Main.dust[num30].customData = player;
						Main.dust[num30].fadeIn = 0.5f;
					}
				}
				if (flag5 && Main.myPlayer == owner)
				{
					bool flag6 = false;
					flag6 = !flag3 || player.CheckMana(player.inventory[player.selectedItem].mana, pay: true);
					if (player.channel && flag6 && !player.noItems && !player.CCed)
					{
						if (ai[0] == 180f)
						{
							Vector2 center = base.Center;
							Vector2 vector15 = Vector2.Normalize(velocity);
							if (float.IsNaN(vector15.X) || float.IsNaN(vector15.Y))
							{
								vector15 = -Vector2.UnitY;
							}
							int num31 = (int)((float)damage * 1.5f);
							int num32 = NewProjectile(GetProjectileSource_FromThis(), center.X, center.Y, vector15.X, vector15.Y, 461, num31, knockBack, owner, 0f, whoAmI);
							ai[1] = num32;
							netUpdate = true;
						}
						else if (flag4)
						{
							Projectile projectile = Main.projectile[(int)ai[1]];
							if (!projectile.active || projectile.type != 461)
							{
								Kill();
								return;
							}
						}
						else
						{
							bool flag7 = false;
							if (ai[0] == 1f)
							{
								flag7 = true;
							}
							if (ai[0] <= 50f && ai[0] % 10f == 0f)
							{
								flag7 = true;
							}
							if (ai[0] >= 80f && ai[0] < 180f && ai[0] % 30f == 0f)
							{
								flag7 = true;
							}
							if (flag7)
							{
								Vector2 vector16 = vector;
								int num33 = 459;
								float num34 = 10f;
								vector16 = base.Center;
								Vector2 vector17 = Vector2.Normalize(velocity) * num34;
								if (float.IsNaN(vector17.X) || float.IsNaN(vector17.Y))
								{
									vector17 = -Vector2.UnitY;
								}
								float num35 = 0.7f + (float)num20 * 0.3f;
								int num36 = ((num35 < 1f) ? damage : ((int)((float)damage * 2.5f)));
								NewProjectile(GetProjectileSource_FromThis(), vector16.X, vector16.Y, vector17.X, vector17.Y, num33, num36, knockBack, owner, 0f, num35);
							}
						}
					}
					else
					{
						Kill();
					}
				}
			}
			if (type == 633)
			{
				float num37 = 30f;
				if (ai[0] > 90f)
				{
					num37 = 15f;
				}
				if (ai[0] > 120f)
				{
					num37 = 5f;
				}
				damage = (int)((float)player.inventory[player.selectedItem].damage * player.magicDamage);
				ai[0] += 1f;
				ai[1] += 1f;
				bool flag8 = false;
				if (ai[0] % num37 == 0f)
				{
					flag8 = true;
				}
				int num38 = 10;
				bool flag9 = false;
				if (ai[0] % num37 == 0f)
				{
					flag9 = true;
				}
				if (ai[1] >= 1f)
				{
					ai[1] = 0f;
					flag9 = true;
					if (Main.myPlayer == owner)
					{
						float num39 = player.inventory[player.selectedItem].shootSpeed * scale;
						Vector2 vector18 = vector;
						Vector2 value6 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector18;
						if (player.gravDir == -1f)
						{
							value6.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector18.Y;
						}
						Vector2 value7 = Vector2.Normalize(value6);
						if (float.IsNaN(value7.X) || float.IsNaN(value7.Y))
						{
							value7 = -Vector2.UnitY;
						}
						value7 = Vector2.Normalize(Vector2.Lerp(value7, Vector2.Normalize(velocity), 0.92f));
						value7 *= num39;
						if (value7.X != velocity.X || value7.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = value7;
					}
				}
				frameCounter++;
				int num40 = ((!(ai[0] < 120f)) ? 1 : 4);
				if (frameCounter >= num40)
				{
					frameCounter = 0;
					if (++frame >= 5)
					{
						frame = 0;
					}
				}
				if (soundDelay <= 0)
				{
					soundDelay = num38;
					soundDelay *= 2;
					if (ai[0] != 1f)
					{
						SoundEngine.PlaySound(SoundID.Item15, position);
					}
				}
				if (flag9 && Main.myPlayer == owner)
				{
					bool flag10 = false;
					flag10 = !flag8 || player.CheckMana(player.inventory[player.selectedItem].mana, pay: true);
					if (player.channel && flag10 && !player.noItems && !player.CCed)
					{
						if (ai[0] == 1f)
						{
							Vector2 center2 = base.Center;
							Vector2 vector19 = Vector2.Normalize(velocity);
							if (float.IsNaN(vector19.X) || float.IsNaN(vector19.Y))
							{
								vector19 = -Vector2.UnitY;
							}
							int num41 = damage;
							for (int m = 0; m < 6; m++)
							{
								NewProjectile(GetProjectileSource_FromThis(), center2.X, center2.Y, vector19.X, vector19.Y, 632, num41, knockBack, owner, m, whoAmI);
							}
							netUpdate = true;
						}
					}
					else
					{
						Kill();
					}
				}
			}
			if (type == 595)
			{
				num = 0f;
				if (spriteDirection == -1)
				{
					num = MathF.PI;
				}
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
				soundDelay--;
				if (soundDelay <= 0)
				{
					SoundEngine.PlaySound(SoundID.Item1, base.Center);
					soundDelay = 12;
				}
				if (Main.myPlayer == owner)
				{
					if (player.channel && !player.noItems && !player.CCed)
					{
						float num42 = 1f;
						if (player.inventory[player.selectedItem].shoot == type)
						{
							num42 = player.inventory[player.selectedItem].shootSpeed * scale;
						}
						Vector2 vec = Main.MouseWorld - vector;
						vec.Normalize();
						if (vec.HasNaNs())
						{
							vec = Vector2.UnitX * player.direction;
						}
						vec *= num42;
						if (vec.X != velocity.X || vec.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = vec;
					}
					else
					{
						Kill();
					}
				}
				Vector2 vector20 = base.Center + velocity * 3f;
				Lighting.AddLight(vector20, 0.8f, 0.8f, 0.8f);
				if (Main.rand.Next(3) == 0)
				{
					int num43 = Dust.NewDust(vector20 - base.Size / 2f, width, height, 63, velocity.X, velocity.Y, 100, default(Color), 2f);
					Main.dust[num43].noGravity = true;
					Main.dust[num43].position -= velocity;
				}
			}
			if (type == 735)
			{
				num = 0f;
				if (spriteDirection == -1)
				{
					num = MathF.PI;
				}
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
				soundDelay--;
				if (soundDelay <= 0)
				{
					SoundEngine.PlaySound(SoundID.Item1, base.Center);
					soundDelay = 12;
				}
				if (Main.myPlayer == owner)
				{
					if (player.channel && !player.noItems && !player.CCed)
					{
						float num44 = 1f;
						if (player.inventory[player.selectedItem].shoot == type)
						{
							num44 = player.inventory[player.selectedItem].shootSpeed * scale;
						}
						Vector2 vec2 = Main.MouseWorld - vector;
						vec2.Normalize();
						if (vec2.HasNaNs())
						{
							vec2 = Vector2.UnitX * player.direction;
						}
						vec2 *= num44;
						if (vec2.X != velocity.X || vec2.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = vec2;
					}
					else
					{
						Kill();
					}
				}
				Vector2 vector21 = base.Center + velocity * 3f;
				Lighting.AddLight(vector21, 0.8f, 0.8f, 0.8f);
				if (Main.rand.Next(3) == 0)
				{
					int num45 = Dust.NewDust(vector21 - base.Size / 2f, width, height, 302, velocity.X, velocity.Y, 100, default(Color), 2f);
					Main.dust[num45].noGravity = true;
					Main.dust[num45].position -= velocity;
				}
			}
			if (type == 927)
			{
				num = 0f;
				scale = ai[1];
				ai[0] += 1f;
				if (ai[0] >= 8f)
				{
					ai[0] = 0f;
				}
				num2 = 9;
				num3 = Main.rand.NextFloatDirection() * (MathF.PI * 2f) * 0.05f;
				soundDelay--;
				if (soundDelay <= 0)
				{
					SoundEngine.PlaySound(SoundID.Item1, base.Center);
					soundDelay = 6;
				}
				if (Main.myPlayer == owner)
				{
					if (player.channel && !player.noItems && !player.CCed)
					{
						float num46 = 1f;
						if (player.inventory[player.selectedItem].shoot == type)
						{
							num46 = player.inventory[player.selectedItem].shootSpeed;
						}
						Vector2 vec3 = Main.MouseWorld - vector;
						vec3.Normalize();
						if (vec3.HasNaNs())
						{
							vec3 = Vector2.UnitX * player.direction;
						}
						vec3 *= num46;
						if (vec3.X != velocity.X || vec3.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = vec3;
					}
					else
					{
						Kill();
					}
				}
				DelegateMethods.v3_1 = new Vector3(0.5f, 0.5f, 0.5f);
				Utils.PlotTileLine(base.Center - velocity, base.Center + velocity.SafeNormalize(Vector2.Zero) * 80f, 16f, DelegateMethods.CastLightOpen);
			}
			if (type == 600)
			{
				_ = ai[0];
				_ = 0f;
				ai[0] += 1f;
				if (Main.myPlayer == owner && ai[0] == 1f)
				{
					float num47 = player.inventory[player.selectedItem].shootSpeed * scale;
					Vector2 vector22 = vector;
					Vector2 value8 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector22;
					if (player.gravDir == -1f)
					{
						value8.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector22.Y;
					}
					Vector2 vector23 = Vector2.Normalize(value8);
					if (float.IsNaN(vector23.X) || float.IsNaN(vector23.Y))
					{
						vector23 = -Vector2.UnitY;
					}
					vector23 *= num47;
					if (vector23.X != velocity.X || vector23.Y != velocity.Y)
					{
						netUpdate = true;
					}
					velocity = vector23;
					int num48 = 601;
					float num49 = 3f;
					vector22 = base.Center;
					Vector2 vector24 = Vector2.Normalize(velocity) * num49;
					if (float.IsNaN(vector24.X) || float.IsNaN(vector24.Y))
					{
						vector24 = -Vector2.UnitY;
					}
					NewProjectile(GetProjectileSource_FromThis(), vector22.X, vector22.Y, vector24.X, vector24.Y, num48, damage, knockBack, owner, ai[1]);
				}
				if (ai[0] >= 30f)
				{
					Kill();
				}
			}
			if (type == 611)
			{
				if (Main.netMode != 2 && localAI[0] == 0f)
				{
					SoundEngine.PlaySound(SoundID.Item116, base.Center);
				}
				if (localAI[1] > 0f)
				{
					localAI[1] -= 1f;
				}
				alpha -= 42;
				if (alpha < 0)
				{
					alpha = 0;
				}
				if (localAI[0] == 0f)
				{
					localAI[0] = velocity.ToRotation();
				}
				float num50 = ((localAI[0].ToRotationVector2().X >= 0f) ? 1 : (-1));
				if (ai[1] <= 0f)
				{
					num50 *= -1f;
				}
				Vector2 spinningpoint5 = (num50 * (ai[0] / 30f * (MathF.PI * 2f) - MathF.PI / 2f)).ToRotationVector2();
				spinningpoint5.Y *= (float)Math.Sin(ai[1]);
				if (ai[1] <= 0f)
				{
					spinningpoint5.Y *= -1f;
				}
				spinningpoint5 = spinningpoint5.RotatedBy(localAI[0]);
				ai[0] += 1f;
				if (ai[0] < 30f)
				{
					velocity += 48f * spinningpoint5;
				}
				else
				{
					Kill();
				}
			}
			if (type == 615)
			{
				num = 0f;
				if (spriteDirection == -1)
				{
					num = MathF.PI;
				}
				ai[0] += 1f;
				int num51 = 0;
				if (ai[0] >= 40f)
				{
					num51++;
				}
				if (ai[0] >= 80f)
				{
					num51++;
				}
				if (ai[0] >= 120f)
				{
					num51++;
				}
				int num52 = 5;
				int num53 = 0;
				ai[1] -= 1f;
				bool flag11 = false;
				int num54 = -1;
				if (ai[1] <= 0f)
				{
					ai[1] = num52 - num53 * num51;
					flag11 = true;
					if ((int)ai[0] / (num52 - num53 * num51) % 7 == 0)
					{
						num54 = 0;
					}
				}
				frameCounter += 1 + num51;
				if (frameCounter >= 4)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				if (soundDelay <= 0)
				{
					soundDelay = num52 - num53 * num51;
					if (ai[0] != 1f)
					{
						SoundEngine.PlaySound(SoundID.Item36, position);
					}
				}
				if (flag11 && Main.myPlayer == owner)
				{
					bool canShoot = player.channel && player.HasAmmo(player.inventory[player.selectedItem], canUse: true) && !player.noItems && !player.CCed;
					int projToShoot = 14;
					float speed = 14f;
					int Damage = player.GetWeaponDamage(player.inventory[player.selectedItem]);
					float KnockBack = player.inventory[player.selectedItem].knockBack;
					if (canShoot)
					{
						player.PickAmmo(player.inventory[player.selectedItem], ref projToShoot, ref speed, ref canShoot, ref Damage, ref KnockBack, out var usedAmmoItemId);
						IEntitySource projectileSource_Item_WithPotentialAmmo = player.GetProjectileSource_Item_WithPotentialAmmo(player.HeldItem, usedAmmoItemId);
						KnockBack = player.GetWeaponKnockback(player.inventory[player.selectedItem], KnockBack);
						float num55 = player.inventory[player.selectedItem].shootSpeed * scale;
						Vector2 vector25 = vector;
						Vector2 value9 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector25;
						if (player.gravDir == -1f)
						{
							value9.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector25.Y;
						}
						Vector2 spinningpoint6 = Vector2.Normalize(value9);
						if (float.IsNaN(spinningpoint6.X) || float.IsNaN(spinningpoint6.Y))
						{
							spinningpoint6 = -Vector2.UnitY;
						}
						spinningpoint6 *= num55;
						spinningpoint6 = spinningpoint6.RotatedBy(Main.rand.NextDouble() * 0.13089969754219055 - 0.06544984877109528);
						if (spinningpoint6.X != velocity.X || spinningpoint6.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = spinningpoint6;
						for (int n = 0; n < 1; n++)
						{
							Vector2 spinningpoint7 = Vector2.Normalize(velocity) * speed;
							spinningpoint7 = spinningpoint7.RotatedBy(Main.rand.NextDouble() * 0.19634954631328583 - 0.09817477315664291);
							if (float.IsNaN(spinningpoint7.X) || float.IsNaN(spinningpoint7.Y))
							{
								spinningpoint7 = -Vector2.UnitY;
							}
							NewProjectile(projectileSource_Item_WithPotentialAmmo, vector25.X, vector25.Y, spinningpoint7.X, spinningpoint7.Y, projToShoot, Damage, KnockBack, owner);
						}
						if (num54 == 0)
						{
							projToShoot = 616;
							speed = 8f;
							for (int num56 = 0; num56 < 1; num56++)
							{
								Vector2 spinningpoint8 = Vector2.Normalize(velocity) * speed;
								spinningpoint8 = spinningpoint8.RotatedBy(Main.rand.NextDouble() * 0.39269909262657166 - 0.19634954631328583);
								if (float.IsNaN(spinningpoint8.X) || float.IsNaN(spinningpoint8.Y))
								{
									spinningpoint8 = -Vector2.UnitY;
								}
								NewProjectile(projectileSource_Item_WithPotentialAmmo, vector25.X, vector25.Y, spinningpoint8.X, spinningpoint8.Y, projToShoot, Damage + 20, KnockBack * 1.25f, owner);
							}
						}
					}
					else
					{
						Kill();
					}
				}
			}
			if (type == 714)
			{
				num = 0f;
				if (spriteDirection == -1)
				{
					num = MathF.PI;
				}
				ai[0] += 1f;
				int num57 = 0;
				int num58 = 8;
				int num59 = 0;
				ai[1] -= 1f;
				bool flag12 = false;
				int num60 = -1;
				if (ai[1] <= 0f)
				{
					ai[1] = num58 - num59 * num57;
					flag12 = true;
					int num61 = (int)ai[0] / (num58 - num59 * num57);
					if (num61 % 7 == 0)
					{
						num60 = 0;
					}
					num60 = num61 % 7;
				}
				_ = rotation;
				Vector2 center3 = base.Center;
				_ = direction;
				Vector2 v = velocity;
				frameCounter += 1 + num57;
				if (frameCounter >= 4)
				{
					frameCounter = 0;
					frame++;
					if (frame >= Main.projFrames[type])
					{
						frame = 0;
					}
				}
				if (soundDelay <= 0 && Main.player[owner].controlUseItem)
				{
					soundDelay = num58 - num59 * num57;
					if (ai[0] != 1f)
					{
						SoundEngine.PlaySound(SoundID.Item156, position);
					}
				}
				if (flag12 && Main.myPlayer == owner)
				{
					bool canShoot2 = player.channel && player.HasAmmo(player.inventory[player.selectedItem], canUse: true) && !player.noItems && !player.CCed;
					int projToShoot2 = 134;
					float speed2 = 8f;
					int Damage2 = player.GetWeaponDamage(player.inventory[player.selectedItem]);
					float KnockBack2 = player.inventory[player.selectedItem].knockBack;
					if (num60 == 3)
					{
						speed2 += 1f;
					}
					if (canShoot2)
					{
						player.PickAmmo(player.inventory[player.selectedItem], ref projToShoot2, ref speed2, ref canShoot2, ref Damage2, ref KnockBack2, out var usedAmmoItemId2);
						KnockBack2 = player.GetWeaponKnockback(player.inventory[player.selectedItem], KnockBack2);
						IEntitySource projectileSource_Item_WithPotentialAmmo2 = player.GetProjectileSource_Item_WithPotentialAmmo(player.HeldItem, usedAmmoItemId2);
						float num62 = player.inventory[player.selectedItem].shootSpeed * scale;
						Vector2 vector26 = vector;
						Vector2 value10 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector26;
						if (player.gravDir == -1f)
						{
							value10.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector26.Y;
						}
						Vector2 spinningpoint9 = Vector2.Normalize(value10);
						if (float.IsNaN(spinningpoint9.X) || float.IsNaN(spinningpoint9.Y))
						{
							spinningpoint9 = -Vector2.UnitY;
						}
						spinningpoint9 *= num62;
						spinningpoint9 = spinningpoint9.RotatedBy((Main.rand.NextDouble() * 0.13089969754219055 - 0.06544984877109528) * 0.5);
						if (spinningpoint9.X != velocity.X || spinningpoint9.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = spinningpoint9;
						for (int num63 = 0; num63 < 1; num63++)
						{
							Vector2 spinningpoint10 = Vector2.Normalize(velocity) * speed2;
							spinningpoint10 = spinningpoint10.RotatedBy(Main.rand.NextDouble() * 0.19634954631328583 - 0.09817477315664291);
							if (float.IsNaN(spinningpoint10.X) || float.IsNaN(spinningpoint10.Y))
							{
								spinningpoint10 = -Vector2.UnitY;
							}
							NewProjectile(projectileSource_Item_WithPotentialAmmo2, vector26.X, vector26.Y, spinningpoint10.X, spinningpoint10.Y, projToShoot2, Damage2, KnockBack2, owner, num60);
							if (num60 == 5)
							{
								for (float num64 = -1f; num64 <= 1f; num64 += 2f)
								{
									Vector2 vector27 = spinningpoint10.RotatedBy(MathF.PI * 2f * num64 * 1f / 80f);
									if (float.IsNaN(spinningpoint10.X) || float.IsNaN(spinningpoint10.Y))
									{
										vector27 = -Vector2.UnitY;
									}
									NewProjectile(projectileSource_Item_WithPotentialAmmo2, vector26.X, vector26.Y, vector27.X, vector27.Y, projToShoot2, Damage2, KnockBack2, owner, num60);
								}
							}
							if (num60 == 4)
							{
								NewProjectile(projectileSource_Item_WithPotentialAmmo2, vector26.X, vector26.Y, spinningpoint10.X, spinningpoint10.Y, projToShoot2, Damage2, KnockBack2, owner, num60, 1f);
							}
						}
					}
					else
					{
						Kill();
					}
				}
				Vector2 vector28 = base.Center + velocity.ToRotation().ToRotationVector2() * 40f;
				Vector2 vector29 = center3 + v.ToRotation().ToRotationVector2() * 40f;
				Color color = Main.hslToRgb(ai[0] / 90f % 1f, 1f, 0.5f);
				color.A = 120;
				int num65 = 267;
				Dust dust = Dust.NewDustPerfect(vector28, num65, Vector2.Zero);
				dust.color = color;
				dust.scale = 0.6f;
				dust.fadeIn = 0.9f;
				dust.noGravity = true;
				Dust dust2 = Dust.NewDustPerfect(vector28, num65, Vector2.Zero);
				dust2.color = color;
				dust2.scale = 0.6f;
				dust2.fadeIn = 0.7f;
				dust2.noGravity = true;
				dust2.velocity = -velocity.RotatedBy(2.094395160675049) / 10f;
				Dust dust3 = Dust.NewDustPerfect(vector28, num65, Vector2.Zero);
				dust3.color = color;
				dust3.scale = 0.6f;
				dust3.fadeIn = 0.7f;
				dust3.noGravity = true;
				dust3.velocity = -velocity.RotatedBy(-2.094395160675049) / 10f;
				if (vector28 != vector29)
				{
					float num66 = -1f;
					Dust dust4 = Dust.NewDustPerfect(Vector2.Lerp(vector28, vector29, 0.8f), num65, Vector2.Zero);
					dust4.velocity = (vector28 - vector29).SafeNormalize(Vector2.Zero) * 2f;
					dust4.color = color;
					dust4.scale = 0.6f;
					dust4.fadeIn = 0.9f;
					dust4.velocity *= num66;
					dust4.noGravity = true;
					Dust dust5 = Dust.NewDustPerfect(Vector2.Lerp(vector28, vector29, 0.5f), num65, Vector2.Zero);
					dust5.velocity = (vector28 - vector29).SafeNormalize(Vector2.Zero) * 2f;
					dust5.color = color;
					dust5.scale = 0.6f;
					dust5.fadeIn = 0.9f;
					dust5.velocity *= num66;
					dust5.noGravity = true;
					Dust dust6 = Dust.NewDustPerfect(Vector2.Lerp(vector28, vector29, 0.2f), num65, Vector2.Zero);
					dust6.velocity = (vector28 - vector29).SafeNormalize(Vector2.Zero) * 2f;
					dust6.color = color;
					dust6.scale = 0.6f;
					dust6.fadeIn = 0.9f;
					dust6.velocity *= num66;
					dust6.noGravity = true;
				}
			}
			if (type == 630)
			{
				num = 0f;
				if (spriteDirection == -1)
				{
					num = MathF.PI;
				}
				ai[0] += 1f;
				int num67 = 0;
				if (ai[0] >= 40f)
				{
					num67++;
				}
				if (ai[0] >= 80f)
				{
					num67++;
				}
				if (ai[0] >= 120f)
				{
					num67++;
				}
				int num68 = 24;
				int num69 = 2;
				ai[1] -= 1f;
				bool flag13 = false;
				if (ai[1] <= 0f)
				{
					ai[1] = num68 - num69 * num67;
					flag13 = true;
					_ = (int)ai[0] / (num68 - num69 * num67);
				}
				bool canShoot3 = player.channel && player.HasAmmo(player.inventory[player.selectedItem], canUse: true) && !player.noItems && !player.CCed;
				if (localAI[0] > 0f)
				{
					localAI[0] -= 1f;
				}
				if (soundDelay <= 0 && canShoot3)
				{
					soundDelay = num68 - num69 * num67;
					if (ai[0] != 1f)
					{
						SoundEngine.PlaySound(SoundID.Item5, position);
					}
					localAI[0] = 12f;
				}
				player.phantasmTime = 2;
				if (flag13 && Main.myPlayer == owner)
				{
					int projToShoot3 = 14;
					float speed3 = 14f;
					int Damage3 = player.GetWeaponDamage(player.inventory[player.selectedItem]);
					float KnockBack3 = player.inventory[player.selectedItem].knockBack;
					if (canShoot3)
					{
						player.PickAmmo(player.inventory[player.selectedItem], ref projToShoot3, ref speed3, ref canShoot3, ref Damage3, ref KnockBack3, out var usedAmmoItemId3);
						IEntitySource projectileSource_Item_WithPotentialAmmo3 = player.GetProjectileSource_Item_WithPotentialAmmo(player.HeldItem, usedAmmoItemId3);
						KnockBack3 = player.GetWeaponKnockback(player.inventory[player.selectedItem], KnockBack3);
						float num70 = player.inventory[player.selectedItem].shootSpeed * scale;
						Vector2 vector30 = vector;
						Vector2 value11 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector30;
						if (player.gravDir == -1f)
						{
							value11.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector30.Y;
						}
						Vector2 vector31 = Vector2.Normalize(value11);
						if (float.IsNaN(vector31.X) || float.IsNaN(vector31.Y))
						{
							vector31 = -Vector2.UnitY;
						}
						vector31 *= num70;
						if (vector31.X != velocity.X || vector31.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = vector31 * 0.55f;
						for (int num71 = 0; num71 < 4; num71++)
						{
							Vector2 vector32 = Vector2.Normalize(velocity) * speed3 * (0.6f + Main.rand.NextFloat() * 0.8f);
							if (float.IsNaN(vector32.X) || float.IsNaN(vector32.Y))
							{
								vector32 = -Vector2.UnitY;
							}
							Vector2 vector33 = vector30 + Utils.RandomVector2(Main.rand, -15f, 15f);
							int num72 = NewProjectile(projectileSource_Item_WithPotentialAmmo3, vector33.X, vector33.Y, vector32.X, vector32.Y, projToShoot3, Damage3, KnockBack3, owner);
							Main.projectile[num72].noDropItem = true;
						}
					}
					else
					{
						Kill();
					}
				}
			}
			if (type == 705)
			{
				num = 0f;
				if (spriteDirection == -1)
				{
					num = MathF.PI;
				}
				ai[0] += 1f;
				int itemAnimationMax = player.itemAnimationMax;
				ai[1] -= 1f;
				bool flag14 = false;
				if (ai[1] <= 0f)
				{
					ai[1] = itemAnimationMax;
					flag14 = true;
				}
				bool canShoot4 = player.channel && player.HasAmmo(player.inventory[player.selectedItem], canUse: true) && !player.noItems && !player.CCed;
				if (localAI[0] > 0f)
				{
					localAI[0] -= 1f;
				}
				if (soundDelay <= 0 && canShoot4)
				{
					soundDelay = itemAnimationMax;
					if (ai[0] != 1f)
					{
						SoundEngine.PlaySound(SoundID.Item5, position);
					}
					localAI[0] = 12f;
				}
				if (flag14 && Main.myPlayer == owner)
				{
					int projToShoot4 = 14;
					float speed4 = 12f;
					int Damage4 = player.GetWeaponDamage(player.inventory[player.selectedItem]);
					float KnockBack4 = player.inventory[player.selectedItem].knockBack;
					int num73 = 2;
					float num74 = 1.5f;
					if (canShoot4)
					{
						player.PickAmmo(player.inventory[player.selectedItem], ref projToShoot4, ref speed4, ref canShoot4, ref Damage4, ref KnockBack4, out var usedAmmoItemId4);
						IEntitySource projectileSource_Item_WithPotentialAmmo4 = player.GetProjectileSource_Item_WithPotentialAmmo(player.HeldItem, usedAmmoItemId4);
						KnockBack4 = player.GetWeaponKnockback(player.inventory[player.selectedItem], KnockBack4);
						if (projToShoot4 == 1)
						{
							projToShoot4 = 2;
						}
						if (++player.phantomPhoneixCounter >= 3)
						{
							player.phantomPhoneixCounter = 0;
							num73 = 1;
							Damage4 *= 2;
							num74 = 0f;
							ai[1] *= 1.5f;
							projToShoot4 = 706;
							speed4 = 16f;
						}
						float num75 = player.inventory[player.selectedItem].shootSpeed * scale;
						Vector2 vector34 = vector;
						Vector2 value12 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY) - vector34;
						if (player.gravDir == -1f)
						{
							value12.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y - vector34.Y;
						}
						Vector2 vector35 = Vector2.Normalize(value12);
						if (float.IsNaN(vector35.X) || float.IsNaN(vector35.Y))
						{
							vector35 = -Vector2.UnitY;
						}
						vector35 *= num75;
						if (vector35.X != velocity.X || vector35.Y != velocity.Y)
						{
							netUpdate = true;
						}
						velocity = vector35 * 0.55f;
						for (int num76 = 0; num76 < num73; num76++)
						{
							Vector2 vector36 = Vector2.Normalize(velocity) * speed4;
							vector36 += Main.rand.NextVector2Square(0f - num74, num74);
							if (float.IsNaN(vector36.X) || float.IsNaN(vector36.Y))
							{
								vector36 = -Vector2.UnitY;
							}
							Vector2 vector37 = vector34;
							int num77 = NewProjectile(projectileSource_Item_WithPotentialAmmo4, vector37.X, vector37.Y, vector36.X, vector36.Y, projToShoot4, Damage4, KnockBack4, owner);
							Main.projectile[num77].noDropItem = true;
						}
					}
					else
					{
						Kill();
					}
				}
			}
			position = player.RotatedRelativePoint(player.MountedCenter, reverseRotation: false, addGfxOffY: false) - base.Size / 2f;
			rotation = velocity.ToRotation() + num;
			spriteDirection = direction;
			timeLeft = 2;
			player.ChangeDir(direction);
			player.heldProj = whoAmI;
			player.SetDummyItemTime(num2);
			player.itemRotation = MathHelper.WrapAngle((float)Math.Atan2(velocity.Y * (float)direction, velocity.X * (float)direction) + num3);
			if (type == 460 || type == 611)
			{
				Vector2 vector38 = Main.OffsetsPlayerOnhand[player.bodyFrame.Y / 56] * 2f;
				if (player.direction != 1)
				{
					vector38.X = (float)player.bodyFrame.Width - vector38.X;
				}
				if (player.gravDir != 1f)
				{
					vector38.Y = (float)player.bodyFrame.Height - vector38.Y;
				}
				vector38 -= new Vector2(player.bodyFrame.Width - player.width, player.bodyFrame.Height - 42) / 2f;
				base.Center = player.RotatedRelativePoint(player.MountedCenter - new Vector2(20f, 42f) / 2f + vector38, reverseRotation: false, addGfxOffY: false) - velocity;
			}
			if (type == 615)
			{
				position.Y += player.gravDir * 2f;
			}
			if (type == 714)
			{
				position.Y += player.gravDir * 2f;
			}
			if (type == 611 && alpha == 0)
			{
				for (int num78 = 0; num78 < 2; num78++)
				{
					Dust obj = Main.dust[Dust.NewDust(position + velocity * 2f, width, height, 6, 0f, 0f, 100, Color.Transparent, 2f)];
					obj.noGravity = true;
					obj.velocity *= 2f;
					obj.velocity += localAI[0].ToRotationVector2();
					obj.fadeIn = 1.5f;
				}
				float num79 = 18f;
				for (int num80 = 0; (float)num80 < num79; num80++)
				{
					if (Main.rand.Next(4) == 0)
					{
						Vector2 vector39 = position + velocity + velocity * ((float)num80 / num79);
						Dust obj2 = Main.dust[Dust.NewDust(vector39, width, height, 6, 0f, 0f, 100, Color.Transparent)];
						obj2.noGravity = true;
						obj2.fadeIn = 0.5f;
						obj2.velocity += localAI[0].ToRotationVector2();
						obj2.noLight = true;
					}
				}
			}
			if (type == 927)
			{
				player.itemAnimation = num2 - (int)ai[0];
			}
		}

		private void AI_099_1()
		{
			timeLeft = 6;
			bool flag = true;
			float num = 250f;
			float num2 = 0.1f;
			float num3 = 15f;
			float num4 = 12f;
			num *= 0.5f;
			num3 *= 0.8f;
			num4 *= 1.5f;
			if (owner == Main.myPlayer)
			{
				bool flag2 = false;
				for (int i = 0; i < 1000; i++)
				{
					if (Main.projectile[i].active && Main.projectile[i].owner == owner && Main.projectile[i].aiStyle == 99 && (Main.projectile[i].type < 556 || Main.projectile[i].type > 561))
					{
						flag2 = true;
					}
				}
				if (!flag2)
				{
					ai[0] = -1f;
					netUpdate = true;
				}
			}
			if (Main.player[owner].yoyoString)
			{
				num += num * 0.25f + 10f;
			}
			rotation += 0.5f;
			if (Main.player[owner].dead)
			{
				Kill();
				return;
			}
			if (!flag)
			{
				Main.player[owner].heldProj = whoAmI;
				Main.player[owner].SetDummyItemTime(2);
				if (position.X + (float)(width / 2) > Main.player[owner].position.X + (float)(Main.player[owner].width / 2))
				{
					Main.player[owner].ChangeDir(1);
					direction = 1;
				}
				else
				{
					Main.player[owner].ChangeDir(-1);
					direction = -1;
				}
			}
			if (ai[0] == 0f || ai[0] == 1f)
			{
				if (ai[0] == 1f)
				{
					num *= 0.75f;
				}
				num4 *= 0.5f;
				bool flag3 = false;
				Vector2 vector = Main.player[owner].Center - base.Center;
				if ((double)vector.Length() > (double)num * 0.9)
				{
					flag3 = true;
				}
				if (vector.Length() > num)
				{
					float num5 = vector.Length() - num;
					Vector2 vector2 = default(Vector2);
					vector2.X = vector.Y;
					vector2.Y = vector.X;
					vector.Normalize();
					vector *= num;
					position = Main.player[owner].Center - vector;
					position.X -= width / 2;
					position.Y -= height / 2;
					float num6 = velocity.Length();
					velocity.Normalize();
					if (num5 > num6 - 1f)
					{
						num5 = num6 - 1f;
					}
					velocity *= num6 - num5;
					num6 = velocity.Length();
					Vector2 vector3 = new Vector2(base.Center.X, base.Center.Y);
					Vector2 vector4 = new Vector2(Main.player[owner].Center.X, Main.player[owner].Center.Y);
					if (vector3.Y < vector4.Y)
					{
						vector2.Y = Math.Abs(vector2.Y);
					}
					else if (vector3.Y > vector4.Y)
					{
						vector2.Y = 0f - Math.Abs(vector2.Y);
					}
					if (vector3.X < vector4.X)
					{
						vector2.X = Math.Abs(vector2.X);
					}
					else if (vector3.X > vector4.X)
					{
						vector2.X = 0f - Math.Abs(vector2.X);
					}
					vector2.Normalize();
					vector2 *= velocity.Length();
					new Vector2(vector2.X, vector2.Y);
					if (Math.Abs(velocity.X) > Math.Abs(velocity.Y))
					{
						Vector2 vector5 = velocity;
						vector5.Y += vector2.Y;
						vector5.Normalize();
						vector5 *= velocity.Length();
						if ((double)Math.Abs(vector2.X) < 0.1 || (double)Math.Abs(vector2.Y) < 0.1)
						{
							velocity = vector5;
						}
						else
						{
							velocity = (vector5 + velocity * 2f) / 3f;
						}
					}
					else
					{
						Vector2 vector6 = velocity;
						vector6.X += vector2.X;
						vector6.Normalize();
						vector6 *= velocity.Length();
						if ((double)Math.Abs(vector2.X) < 0.2 || (double)Math.Abs(vector2.Y) < 0.2)
						{
							velocity = vector6;
						}
						else
						{
							velocity = (vector6 + velocity * 2f) / 3f;
						}
					}
				}
				if (Main.myPlayer == owner)
				{
					if (Main.player[owner].channel)
					{
						Vector2 vector7 = new Vector2(Main.mouseX - Main.lastMouseX, Main.mouseY - Main.lastMouseY);
						if (velocity.X != 0f || velocity.Y != 0f)
						{
							if (flag)
							{
								vector7 *= -1f;
							}
							if (flag3)
							{
								if (base.Center.X < Main.player[owner].Center.X && vector7.X < 0f)
								{
									vector7.X = 0f;
								}
								if (base.Center.X > Main.player[owner].Center.X && vector7.X > 0f)
								{
									vector7.X = 0f;
								}
								if (base.Center.Y < Main.player[owner].Center.Y && vector7.Y < 0f)
								{
									vector7.Y = 0f;
								}
								if (base.Center.Y > Main.player[owner].Center.Y && vector7.Y > 0f)
								{
									vector7.Y = 0f;
								}
							}
							velocity += vector7 * num2;
							netUpdate = true;
						}
					}
					else
					{
						ai[0] = -1f;
						netUpdate = true;
					}
				}
				if (flag || type == 562 || type == 547 || type == 555 || type == 564 || type == 552 || type == 563 || type == 549 || type == 550 || type == 554 || type == 553 || type == 603 || type == 999)
				{
					float num7 = 800f;
					Vector2 vector8 = default(Vector2);
					bool flag4 = false;
					if (type == 549)
					{
						num7 = 200f;
					}
					if (type == 554)
					{
						num7 = 400f;
					}
					if (type == 553)
					{
						num7 = 250f;
					}
					if (type == 603)
					{
						num7 = 320f;
					}
					for (int j = 0; j < 200; j++)
					{
						if (Main.npc[j].CanBeChasedBy(this))
						{
							float num8 = Main.npc[j].position.X + (float)(Main.npc[j].width / 2);
							float num9 = Main.npc[j].position.Y + (float)(Main.npc[j].height / 2);
							float num10 = Math.Abs(position.X + (float)(width / 2) - num8) + Math.Abs(position.Y + (float)(height / 2) - num9);
							if (num10 < num7 && (type != 563 || !(num10 < 200f)) && Collision.CanHit(position, width, height, Main.npc[j].position, Main.npc[j].width, Main.npc[j].height) && (double)(Main.npc[j].Center - Main.player[owner].Center).Length() < (double)num * 0.9)
							{
								num7 = num10;
								vector8.X = num8;
								vector8.Y = num9;
								flag4 = true;
							}
						}
					}
					if (flag4)
					{
						vector8 -= base.Center;
						vector8.Normalize();
						if (type == 563)
						{
							vector8 *= 4f;
							velocity = (velocity * 14f + vector8) / 15f;
						}
						else if (type == 553)
						{
							vector8 *= 5f;
							velocity = (velocity * 12f + vector8) / 13f;
						}
						else if (type == 603)
						{
							vector8 *= 16f;
							velocity = (velocity * 9f + vector8) / 10f;
						}
						else if (type == 554)
						{
							vector8 *= 8f;
							velocity = (velocity * 6f + vector8) / 7f;
						}
						else
						{
							vector8 *= 6f;
							velocity = (velocity * 7f + vector8) / 8f;
						}
					}
				}
				if (velocity.Length() > num3)
				{
					velocity.Normalize();
					velocity *= num3;
				}
				if (velocity.Length() < num4)
				{
					velocity.Normalize();
					velocity *= num4;
				}
				return;
			}
			tileCollide = false;
			Vector2 vector9 = Main.player[owner].Center - base.Center;
			float num11 = vector9.Length();
			if (num11 < 40f || vector9.HasNaNs() || num11 > 2000f)
			{
				Kill();
				return;
			}
			float num12 = num3 * 1.5f;
			if (type == 546)
			{
				num12 *= 1.5f;
			}
			if (type == 554)
			{
				num12 *= 1.25f;
			}
			if (type == 555)
			{
				num12 *= 1.35f;
			}
			if (type == 562)
			{
				num12 *= 1.25f;
			}
			float num13 = 12f;
			vector9.Normalize();
			vector9 *= num12;
			velocity = (velocity * (num13 - 1f) + vector9) / num13;
		}

		private void AI_099_2()
		{
			bool flag = false;
			for (int i = 0; i < whoAmI; i++)
			{
				if (Main.projectile[i].active && Main.projectile[i].owner == owner && Main.projectile[i].type == type)
				{
					flag = true;
				}
			}
			if (owner == Main.myPlayer)
			{
				localAI[0] += 1f;
				if (flag)
				{
					localAI[0] += (float)Main.rand.Next(10, 31) * 0.1f;
				}
				float num = localAI[0] / 60f;
				num /= (1f + Main.player[owner].meleeSpeed) / 2f;
				float num2 = ProjectileID.Sets.YoyosLifeTimeMultiplier[type];
				if (num2 != -1f && num > num2)
				{
					ai[0] = -1f;
				}
			}
			if (type == 603 && owner == Main.myPlayer)
			{
				localAI[1] += 1f;
				if (localAI[1] >= 6f)
				{
					float num3 = 400f;
					Vector2 vector = velocity;
					Vector2 vector2 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					vector2.Normalize();
					vector2 *= (float)Main.rand.Next(10, 41) * 0.1f;
					if (Main.rand.Next(3) == 0)
					{
						vector2 *= 2f;
					}
					vector *= 0.25f;
					vector += vector2;
					for (int j = 0; j < 200; j++)
					{
						if (Main.npc[j].CanBeChasedBy(this))
						{
							float num4 = Main.npc[j].position.X + (float)(Main.npc[j].width / 2);
							float num5 = Main.npc[j].position.Y + (float)(Main.npc[j].height / 2);
							float num6 = Math.Abs(position.X + (float)(width / 2) - num4) + Math.Abs(position.Y + (float)(height / 2) - num5);
							if (num6 < num3 && Collision.CanHit(position, width, height, Main.npc[j].position, Main.npc[j].width, Main.npc[j].height))
							{
								num3 = num6;
								vector.X = num4;
								vector.Y = num5;
								vector -= base.Center;
								vector.Normalize();
								vector *= 8f;
							}
						}
					}
					vector *= 0.8f;
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X - vector.X, base.Center.Y - vector.Y, vector.X, vector.Y, 604, damage, knockBack, owner);
					localAI[1] = 0f;
				}
			}
			bool flag2 = false;
			if (type >= 556 && type <= 561)
			{
				flag2 = true;
			}
			if (Main.player[owner].dead)
			{
				Kill();
				return;
			}
			if (!flag2 && !flag)
			{
				Main.player[owner].heldProj = whoAmI;
				Main.player[owner].SetDummyItemTime(2);
				if (position.X + (float)(width / 2) > Main.player[owner].position.X + (float)(Main.player[owner].width / 2))
				{
					Main.player[owner].ChangeDir(1);
					direction = 1;
				}
				else
				{
					Main.player[owner].ChangeDir(-1);
					direction = -1;
				}
			}
			if (velocity.HasNaNs())
			{
				Kill();
			}
			timeLeft = 6;
			float num7 = 10f;
			float num8 = 10f;
			float num9 = 3f;
			float num10 = 200f;
			num10 = ProjectileID.Sets.YoyosMaximumRange[type];
			num8 = ProjectileID.Sets.YoyosTopSpeed[type];
			if (type == 545)
			{
				if (Main.rand.Next(6) == 0)
				{
					int num11 = Dust.NewDust(position, width, height, 6);
					Main.dust[num11].noGravity = true;
				}
			}
			else if (type == 553 && Main.rand.Next(2) == 0)
			{
				int num12 = Dust.NewDust(position, width, height, 6);
				Main.dust[num12].noGravity = true;
				Main.dust[num12].scale = 1.6f;
			}
			if (Main.player[owner].yoyoString)
			{
				num10 = num10 * 1.25f + 30f;
			}
			num10 /= (1f + Main.player[owner].meleeSpeed * 3f) / 4f;
			num8 /= (1f + Main.player[owner].meleeSpeed * 3f) / 4f;
			num7 = 14f - num8 / 2f;
			if (num7 < 1f)
			{
				num7 = 1f;
			}
			num9 = 5f + num8 / 2f;
			if (flag)
			{
				num9 += 20f;
			}
			if (ai[0] >= 0f)
			{
				if (velocity.Length() > num8)
				{
					velocity *= 0.98f;
				}
				bool flag3 = false;
				bool flag4 = false;
				Vector2 vector3 = Main.player[owner].Center - base.Center;
				if (vector3.Length() > num10)
				{
					flag3 = true;
					if ((double)vector3.Length() > (double)num10 * 1.3)
					{
						flag4 = true;
					}
				}
				if (owner == Main.myPlayer)
				{
					if (!Main.player[owner].channel || Main.player[owner].stoned || Main.player[owner].frozen)
					{
						ai[0] = -1f;
						ai[1] = 0f;
						netUpdate = true;
					}
					else
					{
						Vector2 vector4 = Main.ReverseGravitySupport(Main.MouseScreen) + Main.screenPosition;
						float x = vector4.X;
						float y = vector4.Y;
						Vector2 vector5 = new Vector2(x, y) - Main.player[owner].Center;
						if (vector5.Length() > num10)
						{
							vector5.Normalize();
							vector5 *= num10;
							vector5 = Main.player[owner].Center + vector5;
							x = vector5.X;
							y = vector5.Y;
						}
						if (ai[0] != x || ai[1] != y)
						{
							Vector2 vector6 = new Vector2(x, y) - Main.player[owner].Center;
							if (vector6.Length() > num10 - 1f)
							{
								vector6.Normalize();
								vector6 *= num10 - 1f;
								Vector2 vector7 = Main.player[owner].Center + vector6;
								x = vector7.X;
								y = vector7.Y;
							}
							ai[0] = x;
							ai[1] = y;
							netUpdate = true;
						}
					}
				}
				if (flag4 && owner == Main.myPlayer)
				{
					ai[0] = -1f;
					netUpdate = true;
				}
				if (ai[0] >= 0f)
				{
					if (flag3)
					{
						num7 /= 2f;
						num8 *= 2f;
						if (base.Center.X > Main.player[owner].Center.X && velocity.X > 0f)
						{
							velocity.X *= 0.5f;
						}
						if (base.Center.Y > Main.player[owner].Center.Y && velocity.Y > 0f)
						{
							velocity.Y *= 0.5f;
						}
						if (base.Center.X < Main.player[owner].Center.X && velocity.X < 0f)
						{
							velocity.X *= 0.5f;
						}
						if (base.Center.Y < Main.player[owner].Center.Y && velocity.Y < 0f)
						{
							velocity.Y *= 0.5f;
						}
					}
					Vector2 vector8 = new Vector2(ai[0], ai[1]) - base.Center;
					if (flag3)
					{
						num7 = 1f;
					}
					velocity.Length();
					float num13 = vector8.Length();
					if (num13 > num9)
					{
						vector8.Normalize();
						float num14 = Math.Min(num13 / 2f, num8);
						if (flag3)
						{
							num14 = Math.Min(num14, num8 / 2f);
						}
						vector8 *= num14;
						velocity = (velocity * (num7 - 1f) + vector8) / num7;
					}
					else if (flag)
					{
						if ((double)velocity.Length() < (double)num8 * 0.6)
						{
							vector8 = velocity;
							vector8.Normalize();
							vector8 *= num8 * 0.6f;
							velocity = (velocity * (num7 - 1f) + vector8) / num7;
						}
					}
					else
					{
						velocity *= 0.8f;
					}
					if (flag && !flag3 && (double)velocity.Length() < (double)num8 * 0.6)
					{
						velocity.Normalize();
						velocity *= num8 * 0.6f;
					}
				}
			}
			else
			{
				num7 = (int)((double)num7 * 0.8);
				num8 *= 1.5f;
				tileCollide = false;
				Vector2 vector9 = Main.player[owner].Center - base.Center;
				float num15 = vector9.Length();
				if (num15 < num8 + 10f || num15 == 0f || num15 > 2000f)
				{
					Kill();
				}
				else
				{
					vector9.Normalize();
					vector9 *= num8;
					velocity = (velocity * (num7 - 1f) + vector9) / num7;
				}
			}
			rotation += 0.45f;
		}

		private void AI_130_FlameBurstTower()
		{
			float num = 900f;
			float angleRatioMax = 1f;
			Vector2 vector = base.Center;
			int num2 = 664;
			int num3 = 12;
			float num4 = 12f;
			int num5 = 1;
			int num6 = 6;
			int num7 = 4;
			int num8 = 80;
			switch (type)
			{
			case 663:
			{
				Lighting.AddLight(base.Center, new Vector3(0.4f, 0.2f, 0.1f));
				Lighting.AddLight(base.Bottom + new Vector2(0f, -10f), new Vector3(0.4f, 0.2f, 0.1f));
				vector = base.Bottom + new Vector2(direction * 6, -40f);
				if ((localAI[0] += 1f) >= 300f)
				{
					localAI[0] = 0f;
				}
				Rectangle r3 = new Rectangle((int)position.X + width / 4, (int)position.Y + height - 16, width / 4 * 3, 6);
				if (direction == 1)
				{
					r3.X -= width / 4;
				}
				for (int m = 0; m < 1; m++)
				{
					if (Main.rand.Next(2) == 0)
					{
						Dust dust5 = Dust.NewDustDirect(r3.TopLeft() + new Vector2(-2f, -2f), r3.Width + 4, r3.Height + 4, 270, -direction * 2, -2f, 200, new Color(255, 255, 255, 0));
						dust5.fadeIn = 0.6f + Main.rand.NextFloat() * 0.6f;
						dust5.scale = 0.4f;
						dust5.noGravity = true;
						dust5.noLight = true;
						dust5.velocity = Vector2.Zero;
						dust5.velocity.X = (float)(-direction) * Main.rand.NextFloat() * dust5.fadeIn;
					}
				}
				r3 = new Rectangle((int)base.Center.X, (int)base.Bottom.Y, width / 4, 10);
				if (direction == -1)
				{
					r3.X -= r3.Width;
				}
				r3.X += direction * 4;
				r3.Y -= height - 10;
				for (int n = 0; n < 1; n++)
				{
					if (Main.rand.Next(5) == 0)
					{
						Dust dust6 = Dust.NewDustDirect(r3.TopLeft(), r3.Width, r3.Height, 6);
						dust6.fadeIn = 1f;
						dust6.scale = 1f;
						dust6.noGravity = true;
						dust6.noLight = true;
						dust6.velocity *= 2f;
					}
				}
				break;
			}
			case 665:
			{
				Lighting.AddLight(base.Center, new Vector3(0.4f, 0.2f, 0.1f) * 1.2f);
				Lighting.AddLight(base.Bottom + new Vector2(0f, -10f), new Vector3(0.4f, 0.2f, 0.1f) * 1.2f);
				num8 = 70;
				num4 += 3f;
				num6 = 8;
				num2 = 666;
				vector = base.Bottom + new Vector2(direction * 6, -44f);
				if ((localAI[0] += 1f) >= 300f)
				{
					localAI[0] = 0f;
				}
				Rectangle r2 = new Rectangle((int)position.X + width / 4, (int)position.Y + height - 16, width / 4 * 2, 6);
				if (direction == 1)
				{
					r2.X -= width / 4;
				}
				for (int k = 0; k < 1; k++)
				{
					if (Main.rand.Next(2) == 0)
					{
						Dust dust3 = Dust.NewDustDirect(r2.TopLeft() + new Vector2(-2f, -2f), r2.Width + 4, r2.Height + 4, 270, -direction * 2, -2f, 200, new Color(255, 255, 255, 0));
						dust3.fadeIn = 0.6f + Main.rand.NextFloat() * 0.6f;
						dust3.scale = 0.4f;
						dust3.noGravity = true;
						dust3.noLight = true;
						dust3.velocity = Vector2.Zero;
						dust3.velocity.X = (float)(-direction) * Main.rand.NextFloat() * dust3.fadeIn;
					}
				}
				r2 = new Rectangle((int)base.Center.X, (int)base.Bottom.Y, width / 4, 10);
				if (direction == -1)
				{
					r2.X -= r2.Width;
				}
				r2.X += direction * 4;
				r2.Y -= height - 10;
				for (int l = 0; l < 2; l++)
				{
					if (Main.rand.Next(5) == 0)
					{
						Dust dust4 = Dust.NewDustDirect(r2.TopLeft(), r2.Width, r2.Height, 6);
						dust4.fadeIn = 1f;
						dust4.scale = 1f;
						dust4.noGravity = true;
						dust4.noLight = true;
						dust4.velocity *= 2f;
					}
				}
				break;
			}
			case 667:
			{
				Lighting.AddLight(base.Center, new Vector3(0.4f, 0.2f, 0.1f) * 1.5f);
				Lighting.AddLight(base.Bottom + new Vector2(0f, -10f), new Vector3(0.4f, 0.2f, 0.1f) * 1.5f);
				num8 = 60;
				num4 += 6f;
				num6 = 8;
				num2 = 668;
				vector = base.Bottom + new Vector2(direction * 6, -46f);
				if ((localAI[0] += 1f) >= 300f)
				{
					localAI[0] = 0f;
				}
				Rectangle r = new Rectangle((int)position.X + width / 4, (int)position.Y + height - 16, width / 4 * 2, 6);
				if (direction == 1)
				{
					r.X -= width / 4;
				}
				for (int i = 0; i < 1; i++)
				{
					if (Main.rand.Next(2) == 0)
					{
						Dust dust = Dust.NewDustDirect(r.TopLeft() + new Vector2(-2f, -2f), r.Width + 4, r.Height + 4, 270, -direction * 2, -2f, 200, new Color(255, 255, 255, 0));
						dust.fadeIn = 0.6f + Main.rand.NextFloat() * 0.6f;
						dust.scale = 0.4f;
						dust.noGravity = true;
						dust.noLight = true;
						dust.velocity = Vector2.Zero;
						dust.velocity.X = (float)(-direction) * Main.rand.NextFloat() * dust.fadeIn;
					}
				}
				r = new Rectangle((int)base.Center.X, (int)base.Bottom.Y, width / 4, 10);
				if (direction == -1)
				{
					r.X -= r.Width;
				}
				r.X += direction * 4;
				r.Y -= height - 10;
				for (int j = 0; j < 3; j++)
				{
					if (Main.rand.Next(5) == 0)
					{
						Dust dust2 = Dust.NewDustDirect(r.TopLeft(), r.Width, r.Height, 6);
						dust2.fadeIn = 1.1f;
						dust2.scale = 1f;
						dust2.noGravity = true;
						dust2.noLight = true;
						dust2.velocity *= 2.4f;
					}
				}
				break;
			}
			}
			if (Main.player[owner].setApprenticeT2)
			{
				angleRatioMax = 0.1f;
				num *= 1.5f;
				num4 *= 1.4f;
			}
			if (ai[0] == 0f)
			{
				direction = (spriteDirection = Main.player[owner].direction);
				ai[0] = 1f;
				ai[1] = 0f;
				netUpdate = true;
			}
			if (ai[0] == 1f)
			{
				frame = 0;
				bool flag = false;
				if (ai[1] > 0f)
				{
					ai[1] -= 1f;
				}
				else
				{
					flag = true;
				}
				if (flag && owner == Main.myPlayer)
				{
					int num9 = AI_130_FlameBurstTower_FindTarget(num, angleRatioMax, vector);
					if (num9 != -1)
					{
						direction = Math.Sign(DirectionTo(Main.npc[num9].Center).X);
						ai[0] = 2f;
						ai[1] = 0f;
						netUpdate = true;
					}
				}
			}
			else if (ai[0] == 2f)
			{
				frame = num5 + (int)(ai[1] / (float)num7);
				if (ai[1] == (float)num3)
				{
					Vector2 vector2 = new Vector2(direction, 0f);
					int num10 = AI_130_FlameBurstTower_FindTarget(num, angleRatioMax, vector, canChangeDirection: false);
					if (num10 != -1)
					{
						vector2 = (Main.npc[num10].Center - vector).SafeNormalize(Vector2.UnitX * direction);
					}
					Vector2 vector3 = vector2 * num4;
					if (owner == Main.myPlayer)
					{
						NewProjectile(GetProjectileSource_FromThis(), vector, vector3, num2, damage, knockBack, owner);
					}
				}
				if ((ai[1] += 1f) >= (float)(num6 * num7))
				{
					ai[0] = 1f;
					ai[1] = num8;
				}
			}
			spriteDirection = direction;
			tileCollide = true;
			velocity.Y += 0.2f;
		}

		private int AI_130_FlameBurstTower_FindTarget(float shot_range, float angleRatioMax, Vector2 shootingSpot, bool canChangeDirection = true)
		{
			int num = -1;
			NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
			if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
			{
				for (int i = 0; i < 1; i++)
				{
					if (!ownerMinionAttackTargetNPC.CanBeChasedBy(this))
					{
						continue;
					}
					float num2 = Vector2.Distance(shootingSpot, ownerMinionAttackTargetNPC.Center);
					if (!(num2 > shot_range))
					{
						Vector2 vector = (ownerMinionAttackTargetNPC.Center - shootingSpot).SafeNormalize(Vector2.UnitY);
						if (!(Math.Abs(vector.X) < Math.Abs(vector.Y) * angleRatioMax) && (canChangeDirection || !((float)direction * vector.X < 0f)) && (num == -1 || num2 < Vector2.Distance(shootingSpot, Main.npc[num].Center)) && Collision.CanHitLine(shootingSpot, 0, 0, ownerMinionAttackTargetNPC.Center, 0, 0))
						{
							num = ownerMinionAttackTargetNPC.whoAmI;
						}
					}
				}
				if (num != -1)
				{
					return num;
				}
			}
			for (int j = 0; j < 200; j++)
			{
				NPC nPC = Main.npc[j];
				if (!nPC.CanBeChasedBy(this))
				{
					continue;
				}
				float num3 = Vector2.Distance(shootingSpot, nPC.Center);
				if (!(num3 > shot_range))
				{
					Vector2 vector2 = (nPC.Center - shootingSpot).SafeNormalize(Vector2.UnitY);
					if (!(Math.Abs(vector2.X) < Math.Abs(vector2.Y) * angleRatioMax) && (canChangeDirection || !((float)direction * vector2.X < 0f)) && (num == -1 || num3 < Vector2.Distance(shootingSpot, Main.npc[num].Center)) && Collision.CanHitLine(shootingSpot, 0, 0, nPC.Center, 0, 0))
					{
						num = j;
					}
				}
			}
			return num;
		}

		private int AI_134_Ballista_FindTarget(float shot_range, float deadBottomAngle, Vector2 shootingSpot)
		{
			int num = -1;
			NPC ownerMinionAttackTargetNPC = OwnerMinionAttackTargetNPC;
			if (ownerMinionAttackTargetNPC != null && ownerMinionAttackTargetNPC.CanBeChasedBy(this))
			{
				for (int i = 0; i < 1; i++)
				{
					if (!ownerMinionAttackTargetNPC.CanBeChasedBy(this))
					{
						continue;
					}
					float num2 = Vector2.Distance(shootingSpot, ownerMinionAttackTargetNPC.Center);
					if (!(num2 > shot_range))
					{
						Vector2 vector = (ownerMinionAttackTargetNPC.Center - shootingSpot).SafeNormalize(Vector2.UnitY);
						if ((!(Math.Abs(vector.X) < Math.Abs(vector.Y) * deadBottomAngle) || !(vector.Y > 0f)) && (num == -1 || num2 < Vector2.Distance(shootingSpot, Main.npc[num].Center)) && Collision.CanHitLine(shootingSpot, 0, 0, ownerMinionAttackTargetNPC.Center, 0, 0))
						{
							num = ownerMinionAttackTargetNPC.whoAmI;
						}
					}
				}
				if (num != -1)
				{
					return num;
				}
			}
			for (int j = 0; j < 200; j++)
			{
				NPC nPC = Main.npc[j];
				if (!nPC.CanBeChasedBy(this))
				{
					continue;
				}
				float num3 = Vector2.Distance(shootingSpot, nPC.Center);
				if (!(num3 > shot_range))
				{
					Vector2 vector2 = (nPC.Center - shootingSpot).SafeNormalize(Vector2.UnitY);
					if ((!(Math.Abs(vector2.X) < Math.Abs(vector2.Y) * deadBottomAngle) || !(vector2.Y > 0f)) && (num == -1 || num3 < Vector2.Distance(shootingSpot, Main.npc[num].Center)) && Collision.CanHitLine(shootingSpot, 0, 0, nPC.Center, 0, 0))
					{
						num = j;
					}
				}
			}
			return num;
		}

		private void AI_131_FlameBurstShot()
		{
			//IL_0051: Unknown result type (might be due to invalid IL or missing references)
			if (type != 664 && type != 666 && type != 668)
			{
				return;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				SoundEngine.PlayTrackedSound(SoundID.DD2_FlameburstTowerShot, base.Center);
			}
			if (alpha > 0)
			{
				alpha -= 25;
				if (alpha < 0)
				{
					alpha = 0;
				}
			}
			int num = 1;
			if (type == 666)
			{
				num = 2;
			}
			if (type == 668)
			{
				num = 3;
			}
			for (int i = 0; i < num; i++)
			{
				if (Main.rand.Next(2) != 0)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 6, velocity.X * 0.2f, velocity.Y * 0.2f, 100, default(Color), 2f);
					dust.noGravity = true;
					dust.velocity *= 0.3f;
					if (Main.rand.Next(1) == 0)
					{
						dust.velocity.Y += (float)Math.Sign(dust.velocity.Y) * 1.2f;
						dust.fadeIn += 0.5f;
					}
				}
			}
			rotation = velocity.ToRotation() + MathF.PI / 2f;
		}

		private void AI_134_Ballista()
		{
			//IL_02dd: Unknown result type (might be due to invalid IL or missing references)
			float shot_range = 900f;
			float deadBottomAngle = 0.75f;
			Vector2 center = base.Center;
			int num = 680;
			int num2 = 12;
			float num3 = 16f;
			int num4 = 1;
			int num5 = 5;
			int num6 = 5;
			if (Main.player[owner].setSquireT2)
			{
				num3 = 21f;
			}
			int ballistraShotDelay = GetBallistraShotDelay(Main.player[owner]);
			num2 = num6;
			int num7 = type;
			if (num7 == 677)
			{
				center.Y -= 4f;
			}
			if (ai[0] == 0f)
			{
				direction = (spriteDirection = Main.player[owner].direction);
				ai[0] = 1f;
				ai[1] = 0f;
				netUpdate = true;
				if (direction == -1)
				{
					rotation = MathF.PI;
				}
			}
			if (ai[0] == 1f)
			{
				frame = 0;
				bool flag = false;
				if (Main.player[owner].ballistaPanic && ai[1] > 60f)
				{
					ai[1] = 60f;
				}
				if (Main.player[owner].ballistaPanic && Main.player[owner].setSquireT3 && ai[1] > 30f)
				{
					ai[1] = 30f;
				}
				if (ai[1] > 0f)
				{
					ai[1] -= 1f;
				}
				else
				{
					flag = true;
				}
				int num8 = AI_134_Ballista_FindTarget(shot_range, deadBottomAngle, center);
				if (num8 != -1)
				{
					Vector2 vector = (vector = (Main.npc[num8].Center - center).SafeNormalize(Vector2.UnitY));
					rotation = rotation.AngleLerp(vector.ToRotation(), 0.08f);
					if (rotation > MathF.PI / 2f || rotation < -MathF.PI / 2f)
					{
						direction = -1;
					}
					else
					{
						direction = 1;
					}
					if (flag && owner == Main.myPlayer)
					{
						direction = Math.Sign(vector.X);
						ai[0] = 2f;
						ai[1] = 0f;
						netUpdate = true;
					}
				}
				else
				{
					float targetAngle = 0f;
					if (direction == -1)
					{
						targetAngle = MathF.PI;
					}
					rotation = rotation.AngleLerp(targetAngle, 0.05f);
				}
			}
			else if (ai[0] == 2f)
			{
				frame = num4 + (int)(ai[1] / (float)num6);
				if (ai[1] == (float)num2)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_BallistaTowerShot, base.Center);
					Vector2 vector2 = new Vector2(direction, 0f);
					int num9 = AI_134_Ballista_FindTarget(shot_range, deadBottomAngle, center);
					if (num9 != -1)
					{
						vector2 = (Main.npc[num9].Center - center).SafeNormalize(Vector2.UnitX * direction);
					}
					rotation = vector2.ToRotation();
					if (rotation > MathF.PI / 2f || rotation < -MathF.PI / 2f)
					{
						direction = -1;
					}
					else
					{
						direction = 1;
					}
					Vector2 vector3 = vector2 * num3;
					if (owner == Main.myPlayer)
					{
						NewProjectile(GetProjectileSource_FromThis(), center, vector3, num, damage, knockBack, owner);
					}
				}
				if ((ai[1] += 1f) >= (float)(num5 * num6))
				{
					ai[0] = 1f;
					ai[1] = ballistraShotDelay;
				}
			}
			spriteDirection = direction;
			tileCollide = true;
			velocity.Y += 0.2f;
		}

		public static int GetBallistraShotDelay(Player player)
		{
			int result = 160;
			if (player.setSquireT3)
			{
				result = 100;
			}
			if (player.ballistaPanic)
			{
				result = 60;
			}
			if (player.ballistaPanic && player.setSquireT3)
			{
				result = 30;
			}
			return result;
		}

		private void AI_135_OgreStomp()
		{
			float num = 40f;
			if (type == 922)
			{
				num = 30f;
			}
			ai[0] += 1f;
			if (ai[0] > 9f)
			{
				Kill();
				return;
			}
			velocity = Vector2.Zero;
			position = base.Center;
			base.Size = new Vector2(16f, 16f) * MathHelper.Lerp(5f, num, Utils.GetLerpValue(0f, 9f, ai[0]));
			base.Center = position;
			Point point = base.TopLeft.ToTileCoordinates();
			Point point2 = base.BottomRight.ToTileCoordinates();
			int num2 = point.X / 2 + point2.X / 2;
			int num3 = width / 2;
			if ((int)ai[0] % 3 != 0)
			{
				return;
			}
			int num4 = (int)ai[0] / 3;
			for (int i = point.X; i <= point2.X; i++)
			{
				for (int j = point.Y; j <= point2.Y; j++)
				{
					if (Vector2.Distance(base.Center, new Vector2(i * 16, j * 16)) > (float)num3)
					{
						continue;
					}
					Tile tileSafely = Framing.GetTileSafely(i, j);
					if (!tileSafely.active() || !Main.tileSolid[tileSafely.type] || Main.tileSolidTop[tileSafely.type] || Main.tileFrameImportant[tileSafely.type])
					{
						continue;
					}
					Tile tileSafely2 = Framing.GetTileSafely(i, j - 1);
					if (tileSafely2.active() && Main.tileSolid[tileSafely2.type] && !Main.tileSolidTop[tileSafely2.type])
					{
						continue;
					}
					int num5 = WorldGen.KillTile_GetTileDustAmount(fail: true, tileSafely);
					for (int k = 0; k < num5; k++)
					{
						Dust obj = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
						obj.velocity.Y -= 3f + (float)num4 * 1.5f;
						obj.velocity.Y *= Main.rand.NextFloat();
						obj.velocity.Y *= 0.75f;
						obj.scale += (float)num4 * 0.03f;
					}
					if (num4 >= 2)
					{
						if (type == 922)
						{
							Color newColor = NPC.AI_121_QueenSlime_GetDustColor();
							newColor.A = 150;
							for (int l = 0; l < num5 - 1; l++)
							{
								int num6 = Dust.NewDust(position, 12, 12, 4, 0f, 0f, 50, newColor, 1.5f);
								Main.dust[num6].velocity.Y -= 0.1f + (float)num4 * 0.5f;
								Main.dust[num6].velocity.Y *= Main.rand.NextFloat();
								Main.dust[num6].velocity.X *= Main.rand.NextFloatDirection() * 3f;
								Main.dust[num6].position = new Vector2(i * 16 + Main.rand.Next(16), j * 16 + Main.rand.Next(16));
								if (Main.rand.Next(3) != 0)
								{
									Main.dust[num6].velocity *= 0.5f;
									Main.dust[num6].noGravity = true;
								}
							}
						}
						else
						{
							for (int m = 0; m < num5 - 1; m++)
							{
								Dust obj2 = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
								obj2.velocity.Y -= 1f + (float)num4;
								obj2.velocity.Y *= Main.rand.NextFloat();
								obj2.velocity.Y *= 0.75f;
							}
						}
					}
					if (num5 <= 0 || Main.rand.Next(3) == 0)
					{
						continue;
					}
					float num7 = (float)Math.Abs(num2 - i) / (num / 2f);
					if (type == 922)
					{
						Color newColor2 = NPC.AI_121_QueenSlime_GetDustColor();
						newColor2.A = 150;
						for (int n = 0; n < 3; n++)
						{
							int num8 = Dust.NewDust(position, width, height, 31, 0f, 0f, 50, newColor2, 2f - (float)num4 * 0.15f + num7 * 0.5f);
							Main.dust[num8].velocity.Y -= 0.1f + (float)num4 * 0.5f + num7 * (float)num4 * 1f;
							Main.dust[num8].velocity.Y *= Main.rand.NextFloat();
							Main.dust[num8].velocity.X *= Main.rand.NextFloatDirection() * 3f;
							Main.dust[num8].position = new Vector2(i * 16 + 20, j * 16 + 20);
							if (Main.rand.Next(3) != 0)
							{
								Main.dust[num8].velocity *= 0.5f;
								Main.dust[num8].noGravity = true;
							}
						}
					}
					else
					{
						Gore gore = Gore.NewGoreDirect(position, Vector2.Zero, 61 + Main.rand.Next(3), 1f - (float)num4 * 0.15f + num7 * 0.5f);
						gore.velocity.Y -= 0.1f + (float)num4 * 0.5f + num7 * (float)num4 * 1f;
						gore.velocity.Y *= Main.rand.NextFloat();
						gore.position = new Vector2(i * 16 + 20, j * 16 + 20);
					}
				}
			}
		}

		private void AI_136_BetsyBreath()
		{
			if (ai[1] < 0f || ai[1] > 200f)
			{
				Kill();
				return;
			}
			NPC nPC = Main.npc[(int)ai[1]];
			float num = -8f;
			Vector2 vector2 = (base.Center = nPC.Center + new Vector2((110f + num) * (float)nPC.spriteDirection, 30f).RotatedBy(nPC.rotation));
			rotation = nPC.DirectionTo(base.Center).ToRotation();
			DelegateMethods.v3_1 = new Vector3(1.2f, 1f, 0.3f);
			float num2 = ai[0] / 40f;
			if (num2 > 1f)
			{
				num2 = 1f;
			}
			float num3 = (ai[0] - 38f) / 40f;
			if (num3 < 0f)
			{
				num3 = 0f;
			}
			Utils.PlotTileLine(base.Center + rotation.ToRotationVector2() * 400f * num3, base.Center + rotation.ToRotationVector2() * 400f * num2, 16f, DelegateMethods.CastLight);
			Utils.PlotTileLine(base.Center + rotation.ToRotationVector2().RotatedBy(0.19634954631328583) * 400f * num3, base.Center + rotation.ToRotationVector2().RotatedBy(0.19634954631328583) * 400f * num2, 16f, DelegateMethods.CastLight);
			Utils.PlotTileLine(base.Center + rotation.ToRotationVector2().RotatedBy(-0.19634954631328583) * 400f * num3, base.Center + rotation.ToRotationVector2().RotatedBy(-0.19634954631328583) * 400f * num2, 16f, DelegateMethods.CastLight);
			if (num3 == 0f && num2 > 0.1f)
			{
				for (int i = 0; i < 3; i++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 6);
					dust.fadeIn = 1.5f;
					dust.velocity = rotation.ToRotationVector2().RotatedBy(Main.rand.NextFloatDirection() * (MathF.PI / 12f)) * (0.5f + Main.rand.NextFloat() * 2.5f) * 15f;
					dust.velocity += nPC.velocity * 2f;
					dust.noLight = true;
					dust.noGravity = true;
					dust.alpha = 200;
				}
			}
			if (Main.rand.Next(5) == 0 && ai[0] >= 15f)
			{
				Gore gore = Gore.NewGoreDirect(base.Center + rotation.ToRotationVector2() * 300f - Utils.RandomVector2(Main.rand, -20f, 20f), Vector2.Zero, 61 + Main.rand.Next(3), 0.5f);
				gore.velocity *= 0.3f;
				gore.velocity += rotation.ToRotationVector2() * 4f;
			}
			for (int j = 0; j < 1; j++)
			{
				Dust dust2 = Dust.NewDustDirect(position, width, height, 31);
				dust2.fadeIn = 1.5f;
				dust2.scale = 0.4f;
				dust2.velocity = rotation.ToRotationVector2().RotatedBy(Main.rand.NextFloatDirection() * (MathF.PI / 12f)) * (0.5f + Main.rand.NextFloat() * 2.5f) * 15f;
				dust2.velocity += nPC.velocity * 2f;
				dust2.velocity *= 0.3f;
				dust2.noLight = true;
				dust2.noGravity = true;
				float num4 = Main.rand.NextFloat();
				dust2.position = Vector2.Lerp(base.Center + rotation.ToRotationVector2() * 400f * num3, base.Center + rotation.ToRotationVector2() * 400f * num2, num4);
				dust2.position += rotation.ToRotationVector2().RotatedBy(1.5707963705062866) * (20f + 100f * (num4 - 0.5f));
			}
			frameCounter++;
			ai[0] += 1f;
			if (ai[0] >= 78f)
			{
				Kill();
			}
		}

		private void AI_137_LightningAura()
		{
			//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
			int num = 10;
			int num2 = 999;
			int num3 = 30;
			int num4 = 40;
			int num5 = 4;
			knockBack = 0f;
			if (Main.player[owner].setMonkT2)
			{
				num3 -= 5;
			}
			if (Main.player[owner].setMonkT3)
			{
				num = 14;
				num5 = 8;
			}
			ai[0] += 1f;
			if (ai[0] >= (float)num3)
			{
				ai[0] = 0f;
			}
			if (ai[0] == 0f)
			{
				bool flag = false;
				for (int i = 0; i < 200; i++)
				{
					NPC nPC = Main.npc[i];
					if (nPC.CanBeChasedBy(this) && nPC.Hitbox.Distance(base.Center) < (float)(width / 2) && Colliding(base.Hitbox, nPC.Hitbox))
					{
						flag = true;
						break;
					}
				}
				if (flag)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_LightningAuraZap, base.Center);
				}
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
				velocity = Vector2.Zero;
				Point origin = base.Center.ToTileCoordinates();
				bool flag2 = true;
				if (!WorldUtils.Find(origin, Searches.Chain(new Searches.Down(500), _cachedConditions_notNull, _cachedConditions_solid), out var result))
				{
					flag2 = false;
					position.Y += 16f;
					return;
				}
				if (!WorldUtils.Find(new Point(result.X, result.Y - 1), Searches.Chain(new Searches.Up(num), _cachedConditions_notNull, _cachedConditions_solid), out var result2))
				{
					result2 = new Point(origin.X, origin.Y - num - 1);
				}
				int num6 = 0;
				if (flag2 && Main.tile[result.X, result.Y] != null && Main.tile[result.X, result.Y].blockType() == 1)
				{
					num6 += 8;
				}
				Vector2 center = result.ToWorldCoordinates(8f, num6);
				Vector2 vector = result2.ToWorldCoordinates(8f, 0f);
				base.Size = new Vector2(1f, center.Y - vector.Y);
				if (height > num * 16)
				{
					height = num * 16;
				}
				if (height < num5 * 16)
				{
					height = num5 * 16;
				}
				height *= 2;
				width = (int)((float)height * 1f);
				if (width > num2)
				{
					width = num2;
				}
				base.Center = center;
			}
			if (++frameCounter >= 8)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			DelegateMethods.v3_1 = new Vector3(0.2f, 0.7f, 1f);
			Utils.PlotTileLine(base.Center + Vector2.UnitX * -40f, base.Center + Vector2.UnitX * 40f, 80f, DelegateMethods.CastLightOpen);
			Vector2 vector2 = new Vector2(base.Top.X, position.Y + (float)num4);
			for (int j = 0; j < 4; j++)
			{
				if (Main.rand.Next(6) != 0)
				{
					continue;
				}
				Vector2 vector3 = Main.rand.NextVector2Unit();
				if (!(Math.Abs(vector3.X) < 0.12f))
				{
					Vector2 targetPosition = base.Center + vector3 * new Vector2((height - num4) / 2);
					if (!WorldGen.SolidTile((int)targetPosition.X / 16, (int)targetPosition.Y / 16) && AI_137_CanHit(targetPosition))
					{
						Dust dust = Dust.NewDustDirect(targetPosition, 0, 0, 226, 0f, 0f, 100);
						dust.position = targetPosition;
						dust.velocity = (vector2 - dust.position).SafeNormalize(Vector2.Zero);
						dust.scale = 0.7f;
						dust.fadeIn = 1f;
						dust.noGravity = true;
						dust.noLight = true;
					}
				}
			}
			for (int k = 0; k < 0; k++)
			{
				if (Main.rand.Next(10) != 0)
				{
					continue;
				}
				Vector2 vector4 = Main.rand.NextVector2Unit();
				if (!(Math.Abs(vector4.X) < 0.12f))
				{
					Vector2 targetPosition2 = base.Center + vector4 * new Vector2((height - num4) / 2) * Main.rand.NextFloat();
					if (!WorldGen.SolidTile((int)targetPosition2.X / 16, (int)targetPosition2.Y / 16) && AI_137_CanHit(targetPosition2))
					{
						Dust dust2 = Dust.NewDustDirect(targetPosition2, 0, 0, 226, 0f, 0f, 100);
						dust2.velocity *= 0.6f;
						dust2.velocity += Vector2.UnitY * -2f;
						dust2.noGravity = true;
						dust2.noLight = true;
					}
				}
			}
			for (int l = 0; l < 4; l++)
			{
				if (Main.rand.Next(10) == 0)
				{
					Dust dust3 = Dust.NewDustDirect(vector2 - new Vector2(8f, 0f), 16, height / 2 - 40, 226, 0f, 0f, 100);
					dust3.velocity *= 0.6f;
					dust3.velocity += Vector2.UnitY * -2f;
					dust3.scale = 0.7f;
					dust3.noGravity = true;
					dust3.noLight = true;
				}
			}
			tileCollide = true;
			velocity.Y += 0.2f;
		}

		private void AI_138_ExplosiveTrap()
		{
			//IL_0173: Unknown result type (might be due to invalid IL or missing references)
			spriteDirection = (direction = 1);
			int num = 694;
			int num2 = 48;
			int explosiveTrapCooldown = GetExplosiveTrapCooldown(Main.player[owner]);
			switch (type)
			{
			case 692:
				num = 695;
				break;
			case 693:
				num = 696;
				break;
			}
			Lighting.AddLight(base.Center, 0.6f, 0.5f, 0.3f);
			if (++frameCounter >= 12)
			{
				frameCounter = 0;
				if (++frame >= Main.projFrames[type])
				{
					frame = 0;
				}
			}
			if (localAI[0] > 0f)
			{
				localAI[0] -= 1f;
			}
			if (localAI[0] <= 0f && owner == Main.myPlayer)
			{
				localAI[0] = 3f;
				bool flag = false;
				Rectangle rectangle = Utils.CenteredRectangle(base.Center + new Vector2(0f, -num2), new Vector2(num2 * 3));
				for (int i = 0; i < 200; i++)
				{
					NPC nPC = Main.npc[i];
					if (nPC.CanBeChasedBy(this) && rectangle.Intersects(nPC.Hitbox))
					{
						flag = true;
						break;
					}
				}
				if (flag)
				{
					SoundEngine.PlayTrackedSound(SoundID.DD2_ExplosiveTrapExplode);
					localAI[0] = explosiveTrapCooldown;
					NewProjectile(GetProjectileSource_FromThis(), base.Center + new Vector2(0f, -num2), Vector2.Zero, num, damage, knockBack, owner);
				}
			}
			tileCollide = true;
			velocity.Y += 0.2f;
		}

		public static int GetExplosiveTrapCooldown(Player player)
		{
			int result = 90;
			if (player.setHuntressT2)
			{
				result = 60;
			}
			if (player.setHuntressT3)
			{
				result = 30;
			}
			return result;
		}

		private void AI_139_ExplosiveTrapExplosion()
		{
			int num = Main.projFrames[type];
			int num2 = 3;
			alpha -= 25;
			if (alpha < 0)
			{
				alpha = 0;
			}
			if (localAI[0] == 0f)
			{
				localAI[0] = 1f;
			}
			if (++frameCounter >= num2)
			{
				frameCounter = 0;
				if (++frame >= num)
				{
					Kill();
					return;
				}
			}
			DelegateMethods.v3_1 = new Vector3(1.3f, 0.9f, 0.2f);
			Utils.PlotTileLine(base.Top, base.Bottom, 2f, DelegateMethods.CastLightOpen);
		}

		private void AI_140_MonkStaffT1()
		{
			//IL_0505: Unknown result type (might be due to invalid IL or missing references)
			//IL_0518: Unknown result type (might be due to invalid IL or missing references)
			float num = 50f;
			float num2 = 2f;
			float num3 = 20f;
			Player player = Main.player[owner];
			float num4 = -MathF.PI / 4f;
			Vector2 vector = player.RotatedRelativePoint(player.MountedCenter);
			Vector2 vector2 = Vector2.Zero;
			if (player.dead)
			{
				Kill();
				return;
			}
			if (type == 697)
			{
				int num5 = damage * 3;
				int num6 = Math.Sign(velocity.X);
				velocity = new Vector2(num6, 0f);
				if (ai[0] == 0f)
				{
					rotation = new Vector2(num6, 0f - player.gravDir).ToRotation() + num4 + MathF.PI;
					if (velocity.X < 0f)
					{
						rotation -= MathF.PI / 2f;
					}
				}
				alpha -= 128;
				if (alpha < 0)
				{
					alpha = 0;
				}
				float num7 = ai[0] / num;
				float num8 = 1f;
				ai[0] += num8;
				rotation += MathF.PI * 2f * num2 / num * (float)num6;
				bool flag = ai[0] == (float)(int)(num / 2f);
				if (ai[0] >= num || (flag && !player.controlUseItem))
				{
					Kill();
					player.reuseDelay = 10;
				}
				else if (flag)
				{
					Vector2 mouseWorld = Main.MouseWorld;
					int num9 = ((player.DirectionTo(mouseWorld).X > 0f) ? 1 : (-1));
					if ((float)num9 != velocity.X)
					{
						player.ChangeDir(num9);
						velocity = new Vector2(num9, 0f);
						netUpdate = true;
						rotation -= MathF.PI;
					}
				}
				float num10 = rotation - MathF.PI / 4f * (float)num6;
				vector2 = (num10 + ((num6 == -1) ? MathF.PI : 0f)).ToRotationVector2() * (ai[0] / num) * num3;
				Vector2 vector3 = base.Center + (num10 + ((num6 == -1) ? MathF.PI : 0f)).ToRotationVector2() * 30f;
				if (Main.rand.Next(2) == 0)
				{
					Dust dust = Dust.NewDustDirect(vector3 - new Vector2(5f), 10, 10, 31, player.velocity.X, player.velocity.Y, 150);
					dust.velocity = DirectionTo(dust.position) * 0.1f + dust.velocity * 0.1f;
				}
				if (num7 >= 0.75f)
				{
					Dust dust2 = Dust.NewDustDirect(vector3 - new Vector2(5f), 10, 10, 55, player.velocity.X, player.velocity.Y, 50);
					dust2.velocity = DirectionTo(dust2.position) * 0.1f + dust2.velocity * 0.1f;
					dust2.noGravity = true;
					dust2.color = new Color(20, 255, 100, 160);
				}
				if (ai[0] >= num - 8f && ai[0] < num - 2f)
				{
					for (int i = 0; i < 5; i++)
					{
						Dust dust3 = Dust.NewDustDirect(vector3 - new Vector2(5f), 10, 10, 55, player.velocity.X, player.velocity.Y, 50);
						dust3.velocity *= 1.2f;
						dust3.noGravity = true;
						dust3.scale += 0.1f;
						dust3.color = new Color(20, 255, 100, 160);
					}
				}
				if (ai[0] == num - 3f && owner == Main.myPlayer)
				{
					if (localAI[1] == 1f || WorldUtils.Find(vector3.ToTileCoordinates(), Searches.Chain(new Searches.Down(4), _cachedConditions_notNull, _cachedConditions_solid), out var _))
					{
						NewProjectile(GetProjectileSource_FromThis(), vector3 + new Vector2(num6 * 20, -60f), Vector2.Zero, 698, num5, 0f, owner);
						SoundEngine.PlayTrackedSound(SoundID.DD2_MonkStaffGroundImpact, base.Center);
					}
					else
					{
						SoundEngine.PlayTrackedSound(SoundID.DD2_MonkStaffGroundMiss, base.Center);
					}
				}
			}
			if (type == 707)
			{
				Lighting.AddLight(player.Center, 0.75f, 0.9f, 1.15f);
				int num11 = Math.Sign(velocity.X);
				velocity = new Vector2(num11, 0f);
				if (ai[0] == 0f)
				{
					rotation = new Vector2(num11, 0f - player.gravDir).ToRotation() + num4 + MathF.PI;
					if (velocity.X < 0f)
					{
						rotation -= MathF.PI / 2f;
					}
				}
				alpha -= 128;
				if (alpha < 0)
				{
					alpha = 0;
				}
				_ = ai[0] / num;
				float num12 = 1f;
				ai[0] += num12;
				rotation += MathF.PI * 2f * num2 / num * (float)num11;
				bool flag2 = ai[0] == (float)(int)(num / 2f);
				if (ai[0] >= num || (flag2 && !player.controlUseItem))
				{
					Kill();
					player.reuseDelay = 2;
				}
				else if (flag2)
				{
					Vector2 mouseWorld2 = Main.MouseWorld;
					int num13 = ((player.DirectionTo(mouseWorld2).X > 0f) ? 1 : (-1));
					if ((float)num13 != velocity.X)
					{
						player.ChangeDir(num13);
						velocity = new Vector2(num13, 0f);
						netUpdate = true;
						rotation -= MathF.PI;
					}
				}
				if ((ai[0] == num12 || (ai[0] == (float)(int)(num / 2f) && active)) && owner == Main.myPlayer)
				{
					Vector2 mouseWorld3 = Main.MouseWorld;
					_ = player.DirectionTo(mouseWorld3) * 0f;
				}
				float num14 = rotation - MathF.PI / 4f * (float)num11;
				vector2 = (num14 + ((num11 == -1) ? MathF.PI : 0f)).ToRotationVector2() * (ai[0] / num) * num3;
				Vector2 vector4 = base.Center + (num14 + ((num11 == -1) ? MathF.PI : 0f)).ToRotationVector2() * 30f;
				Vector2 vector5 = num14.ToRotationVector2();
				Vector2 vector6 = vector5.RotatedBy(MathF.PI / 2f * (float)spriteDirection);
				if (Main.rand.Next(2) == 0)
				{
					Dust dust4 = Dust.NewDustDirect(vector4 - new Vector2(5f), 10, 10, 31, player.velocity.X, player.velocity.Y, 150);
					dust4.velocity = DirectionTo(dust4.position) * 0.1f + dust4.velocity * 0.1f;
				}
				for (int j = 0; j < 4; j++)
				{
					float num15 = 1f;
					float num16 = 1f;
					switch (j)
					{
					case 1:
						num16 = -1f;
						break;
					case 2:
						num16 = 1.25f;
						num15 = 0.5f;
						break;
					case 3:
						num16 = -1.25f;
						num15 = 0.5f;
						break;
					}
					if (Main.rand.Next(6) != 0)
					{
						Dust dust5 = Dust.NewDustDirect(position, 0, 0, 226, 0f, 0f, 100);
						dust5.position = base.Center + vector5 * (60f + Main.rand.NextFloat() * 20f) * num16;
						dust5.velocity = vector6 * (4f + 4f * Main.rand.NextFloat()) * num16 * num15;
						dust5.noGravity = true;
						dust5.noLight = true;
						dust5.scale = 0.5f;
						dust5.customData = this;
						if (Main.rand.Next(4) == 0)
						{
							dust5.noGravity = false;
						}
					}
				}
			}
			position = vector - base.Size / 2f;
			position += vector2;
			spriteDirection = direction;
			timeLeft = 2;
			player.ChangeDir(direction);
			player.heldProj = whoAmI;
			player.SetDummyItemTime(2);
			player.itemRotation = MathHelper.WrapAngle(rotation);
		}

		private void AI_141_MonkStaffT1Explosion()
		{
			Point scanAreaStart = base.TopLeft.ToTileCoordinates();
			Point scanAreaEnd = base.BottomRight.ToTileCoordinates();
			_ = scanAreaStart.X / 2;
			_ = scanAreaEnd.X / 2;
			int explosionRange = width;
			ai[0] += 1f;
			if (ai[0] > 20f)
			{
				Kill();
			}
			else if (ai[0] == 1f)
			{
				CreateImpactExplosion(6, base.Bottom, ref scanAreaStart, ref scanAreaEnd, explosionRange, out var causedShockwaves);
				CreateImpactExplosion2_SleepyOctopod(base.Bottom, causedShockwaves);
			}
		}

		private void CreateImpactExplosion(int dustAmountMultiplier, Vector2 explosionOrigin, ref Point scanAreaStart, ref Point scanAreaEnd, int explosionRange, out bool causedShockwaves)
		{
			causedShockwaves = false;
			int num = 4;
			for (int i = scanAreaStart.X; i <= scanAreaEnd.X; i++)
			{
				for (int j = scanAreaStart.Y; j <= scanAreaEnd.Y; j++)
				{
					if (Vector2.Distance(explosionOrigin, new Vector2(i * 16, j * 16)) > (float)explosionRange)
					{
						continue;
					}
					Tile tileSafely = Framing.GetTileSafely(i, j);
					if (!tileSafely.active() || !Main.tileSolid[tileSafely.type] || Main.tileSolidTop[tileSafely.type] || Main.tileFrameImportant[tileSafely.type])
					{
						continue;
					}
					Tile tileSafely2 = Framing.GetTileSafely(i, j - 1);
					if (tileSafely2.active() && Main.tileSolid[tileSafely2.type] && !Main.tileSolidTop[tileSafely2.type])
					{
						continue;
					}
					int num2 = WorldGen.KillTile_GetTileDustAmount(fail: true, tileSafely) * dustAmountMultiplier;
					for (int k = 0; k < num2; k++)
					{
						Dust obj = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
						obj.velocity.Y -= 3f + (float)num * 1.5f;
						obj.velocity.Y *= Main.rand.NextFloat();
						obj.scale += (float)num * 0.03f;
					}
					if (num >= 2)
					{
						for (int l = 0; l < num2 - 1; l++)
						{
							Dust obj2 = Main.dust[WorldGen.KillTile_MakeTileDust(i, j, tileSafely)];
							obj2.velocity.Y -= 1f + (float)num;
							obj2.velocity.Y *= Main.rand.NextFloat();
						}
					}
					if (num2 > 0)
					{
						causedShockwaves = true;
					}
				}
			}
		}

		private void CreateImpactExplosion2_SleepyOctopod(Vector2 explosionOrigin, bool causedShockwaves)
		{
			Vector2 spinningpoint = new Vector2(7f, 0f);
			Vector2 vector = new Vector2(1f, 0.7f);
			Color color = new Color(20, 255, 100, 200);
			for (float num = 0f; num < 25f; num += 1f)
			{
				Vector2 vector2 = spinningpoint.RotatedBy(num * (MathF.PI * 2f) / 25f) * vector;
				Dust dust = Dust.NewDustDirect(position, width, height, 55);
				dust.alpha = 0;
				if (!causedShockwaves)
				{
					dust.alpha = 50;
				}
				dust.color = color;
				dust.position = explosionOrigin + vector2;
				dust.velocity.Y -= 3f;
				dust.velocity.X *= 0.5f;
				dust.fadeIn = 0.5f + Main.rand.NextFloat() * 0.5f;
				dust.noLight = true;
			}
			if (!causedShockwaves)
			{
				for (float num2 = 0f; num2 < 25f; num2 += 1f)
				{
					Vector2 vector3 = spinningpoint.RotatedBy(num2 * (MathF.PI * 2f) / 25f) * vector;
					Dust dust2 = Dust.NewDustDirect(position, width, height, 55);
					dust2.alpha = 100;
					dust2.color = color;
					dust2.position = explosionOrigin + vector3;
					dust2.velocity.Y -= 5f;
					dust2.velocity.X *= 0.8f;
					dust2.fadeIn = 0.5f + Main.rand.NextFloat() * 0.5f;
					dust2.noLight = true;
				}
			}
		}

		private void CreateImpactExplosion2_FlailTileCollision(Vector2 explosionOrigin, bool causedShockwaves, Vector2 velocityBeforeCollision)
		{
			Vector2 spinningpoint = new Vector2(7f, 0f);
			Vector2 vector = new Vector2(1f, 0.7f);
			Color color = Color.White * 0.5f;
			Vector2 vector2 = velocityBeforeCollision.SafeNormalize(Vector2.Zero);
			for (float num = 0f; num < 8f; num += 1f)
			{
				Vector2 vector3 = spinningpoint.RotatedBy(num * (MathF.PI * 2f) / 8f) * vector;
				Dust dust = Dust.NewDustDirect(position, width, height, 31);
				dust.alpha = 0;
				if (!causedShockwaves)
				{
					dust.alpha = 50;
				}
				dust.color = color;
				dust.position = explosionOrigin + vector3;
				dust.velocity.Y -= 0.8f;
				dust.velocity.X *= 0.8f;
				dust.fadeIn = 0.3f + Main.rand.NextFloat() * 0.4f;
				dust.scale = 0.4f;
				dust.noLight = true;
				dust.velocity += vector2 * 2f;
			}
			if (!causedShockwaves)
			{
				for (float num2 = 0f; num2 < 8f; num2 += 1f)
				{
					Vector2 vector4 = spinningpoint.RotatedBy(num2 * (MathF.PI * 2f) / 8f) * vector;
					Dust dust2 = Dust.NewDustDirect(position, width, height, 31);
					dust2.alpha = 100;
					dust2.color = color;
					dust2.position = explosionOrigin + vector4;
					dust2.velocity.Y -= 1f;
					dust2.velocity.X *= 0.4f;
					dust2.fadeIn = 0.3f + Main.rand.NextFloat() * 0.4f;
					dust2.scale = 0.4f;
					dust2.noLight = true;
					dust2.velocity += vector2 * 1.5f;
				}
			}
		}

		private void AI_142_MonkStaffT2And3()
		{
			Player player = Main.player[owner];
			Vector2 vector = player.RotatedRelativePoint(player.MountedCenter);
			direction = player.direction;
			player.heldProj = whoAmI;
			base.Center = vector;
			if (player.dead)
			{
				Kill();
				return;
			}
			if (!player.frozen)
			{
				if (type == 699)
				{
					spriteDirection = (direction = player.direction);
					Vector2 vector2 = vector;
					alpha -= 127;
					if (alpha < 0)
					{
						alpha = 0;
					}
					if (localAI[0] > 0f)
					{
						localAI[0] -= 1f;
					}
					float num = (float)player.itemAnimation / (float)player.itemAnimationMax;
					float num2 = 1f - num;
					float num3 = velocity.ToRotation();
					float num4 = velocity.Length();
					float num5 = 22f;
					Vector2 spinningpoint = new Vector2(1f, 0f).RotatedBy(MathF.PI + num2 * (MathF.PI * 2f)) * new Vector2(num4, ai[0]);
					position += spinningpoint.RotatedBy(num3) + new Vector2(num4 + num5, 0f).RotatedBy(num3);
					Vector2 target = vector2 + spinningpoint.RotatedBy(num3) + new Vector2(num4 + num5 + 40f, 0f).RotatedBy(num3);
					rotation = vector2.AngleTo(target) + MathF.PI / 4f * (float)player.direction;
					if (spriteDirection == -1)
					{
						rotation += MathF.PI;
					}
					vector2.DirectionTo(base.Center);
					Vector2 vector3 = vector2.DirectionTo(target);
					Vector2 vector4 = velocity.SafeNormalize(Vector2.UnitY);
					float num6 = 2f;
					for (int i = 0; (float)i < num6; i++)
					{
						Dust dust = Dust.NewDustDirect(base.Center, 14, 14, 228, 0f, 0f, 110);
						dust.velocity = vector2.DirectionTo(dust.position) * 2f;
						dust.position = base.Center + vector4.RotatedBy(num2 * (MathF.PI * 2f) * 2f + (float)i / num6 * (MathF.PI * 2f)) * 10f;
						dust.scale = 1f + 0.6f * Main.rand.NextFloat();
						dust.velocity += vector4 * 3f;
						dust.noGravity = true;
					}
					for (int j = 0; j < 1; j++)
					{
						if (Main.rand.Next(3) == 0)
						{
							Dust dust2 = Dust.NewDustDirect(base.Center, 20, 20, 228, 0f, 0f, 110);
							dust2.velocity = vector2.DirectionTo(dust2.position) * 2f;
							dust2.position = base.Center + vector3 * -110f;
							dust2.scale = 0.45f + 0.4f * Main.rand.NextFloat();
							dust2.fadeIn = 0.7f + 0.4f * Main.rand.NextFloat();
							dust2.noGravity = true;
							dust2.noLight = true;
						}
					}
				}
				else if (type == 708)
				{
					Lighting.AddLight(player.Center, 0.75f, 0.9f, 1.15f);
					spriteDirection = (direction = player.direction);
					alpha -= 127;
					if (alpha < 0)
					{
						alpha = 0;
					}
					float num7 = (float)player.itemAnimation / (float)player.itemAnimationMax;
					float num8 = 1f - num7;
					float num9 = velocity.ToRotation();
					float num10 = velocity.Length();
					float num11 = 22f;
					Vector2 spinningpoint2 = new Vector2(1f, 0f).RotatedBy(MathF.PI + num8 * (MathF.PI * 2f)) * new Vector2(num10, ai[0]);
					position += spinningpoint2.RotatedBy(num9) + new Vector2(num10 + num11, 0f).RotatedBy(num9);
					Vector2 vector5 = vector + spinningpoint2.RotatedBy(num9) + new Vector2(num10 + num11 + 40f, 0f).RotatedBy(num9);
					rotation = (vector5 - vector).SafeNormalize(Vector2.UnitX).ToRotation() + MathF.PI / 4f * (float)player.direction;
					if (spriteDirection == -1)
					{
						rotation += MathF.PI;
					}
					(base.Center - vector).SafeNormalize(Vector2.Zero);
					(vector5 - vector).SafeNormalize(Vector2.Zero);
					Vector2 vector6 = velocity.SafeNormalize(Vector2.UnitY);
					if ((player.itemAnimation == 2 || player.itemAnimation == 6 || player.itemAnimation == 10) && owner == Main.myPlayer)
					{
						Vector2 vector7 = vector6 + Main.rand.NextVector2Square(-0.2f, 0.2f);
						vector7 *= 12f;
						switch (player.itemAnimation)
						{
						case 2:
							vector7 = vector6.RotatedBy(0.3839724659919739);
							break;
						case 6:
							vector7 = vector6.RotatedBy(-0.3839724659919739);
							break;
						case 10:
							vector7 = vector6.RotatedBy(0.0);
							break;
						}
						vector7 *= 10f + (float)Main.rand.Next(4);
						NewProjectile(GetProjectileSource_FromThis(), base.Center, vector7, 709, damage, 0f, owner);
					}
					for (int k = 0; k < 3; k += 2)
					{
						float num12 = 1f;
						float num13 = 1f;
						switch (k)
						{
						case 1:
							num13 = -1f;
							break;
						case 2:
							num13 = 1.25f;
							num12 = 0.5f;
							break;
						case 3:
							num13 = -1.25f;
							num12 = 0.5f;
							break;
						}
						if (Main.rand.Next(6) != 0)
						{
							num13 *= 1.2f;
							Dust dust3 = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 100);
							dust3.velocity = vector6 * (4f + 4f * Main.rand.NextFloat()) * num13 * num12;
							dust3.noGravity = true;
							dust3.noLight = true;
							dust3.scale = 0.75f;
							dust3.fadeIn = 0.8f;
							dust3.customData = this;
							if (Main.rand.Next(3) == 0)
							{
								dust3.noGravity = false;
								dust3.fadeIn = 0f;
							}
						}
					}
				}
			}
			if (player.itemAnimation == 2)
			{
				Kill();
				player.reuseDelay = 2;
			}
		}

		private void AI_143_MonkStaffT2Ghast()
		{
			//IL_0021: Unknown result type (might be due to invalid IL or missing references)
			//IL_0026: Unknown result type (might be due to invalid IL or missing references)
			//IL_0037: Unknown result type (might be due to invalid IL or missing references)
			//IL_004c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0051: Unknown result type (might be due to invalid IL or missing references)
			SlotId val;
			if (ai[0] == 0f)
			{
				float[] array = localAI;
				val = SoundEngine.PlayTrackedSound(SoundID.DD2_GhastlyGlaiveImpactGhost, base.Center);
				array[1] = ((SlotId)(ref val)).ToFloat();
			}
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
			if (activeSound == null)
			{
				float[] array2 = localAI;
				val = SlotId.Invalid;
				array2[1] = ((SlotId)(ref val)).ToFloat();
			}
			else
			{
				activeSound.Position = base.Center;
			}
			ai[0] += 1f;
			if (ai[0] > 50f)
			{
				alpha += 25;
				if (alpha > 255)
				{
					alpha = 255;
				}
			}
			else
			{
				alpha -= 25;
				if (alpha < 100)
				{
					alpha = 100;
				}
			}
			velocity *= 0.98f;
			if (++frameCounter >= 5)
			{
				frameCounter = 0;
				if (++frame >= 4)
				{
					frame = 0;
				}
			}
			if (ai[0] >= 60f)
			{
				Kill();
			}
			direction = (spriteDirection = ((velocity.X > 0f) ? 1 : (-1)));
			rotation = velocity.ToRotation();
			if (spriteDirection == -1)
			{
				rotation += MathF.PI;
			}
			if (ai[0] >= 10f && ai[0] < 34f)
			{
				Vector2 vector = velocity.SafeNormalize(Vector2.UnitY);
				float num = ai[0] / 60f;
				float num2 = 2f;
				for (int i = 0; (float)i < num2; i++)
				{
					Dust dust = Dust.NewDustDirect(base.Center, 14, 14, 228, 0f, 0f, 110);
					dust.velocity = vector * 2f;
					dust.position = base.Center + vector.RotatedBy(num * (MathF.PI * 2f) * 2f + (float)i / num2 * (MathF.PI * 2f)) * 7f;
					dust.scale = 1f + 0.6f * Main.rand.NextFloat();
					dust.velocity += vector * 3f;
					dust.noGravity = true;
				}
			}
		}

		private void AI_144_DD2Pet()
		{
			Player player = Main.player[owner];
			float num = 4f;
			int num2 = 6;
			int num3 = 4;
			int num4 = Main.projFrames[type];
			int num5 = 0;
			float num6 = 0.08f;
			bool flag = false;
			float num7 = 0.1f;
			Vector2 vector = new Vector2(player.direction * 30, -20f);
			if (player.dead)
			{
				Kill();
				return;
			}
			bool flag2 = true;
			switch (type)
			{
			case 702:
			{
				if (player.petFlagDD2Ghost)
				{
					timeLeft = 2;
				}
				vector.Y += (float)Math.Cos(localAI[0] * (MathF.PI / 60f)) * 2f;
				num3 = 4;
				num2 = 10;
				flag2 = false;
				num = 6f;
				Vector2 vector3 = new Vector2((spriteDirection == -1) ? (-6) : (-2), -26f).RotatedBy(rotation);
				if (Main.rand.Next(24) == 0)
				{
					Dust dust2 = Dust.NewDustDirect(base.Center + vector3, 4, 4, 135, 0f, 0f, 100);
					if (Main.rand.Next(3) != 0)
					{
						dust2.noGravity = true;
						dust2.velocity.Y -= 3f;
						dust2.noLight = true;
					}
					else if (Main.rand.Next(2) != 0)
					{
						dust2.noLight = true;
					}
					dust2.velocity *= 0.5f;
					dust2.velocity.Y -= 0.9f;
					dust2.scale += 0.1f + Main.rand.NextFloat() * 0.6f;
				}
				DelegateMethods.v3_1 = new Vector3(0.3f, 0.5f, 1f);
				Utils.PlotTileLine(base.Center, base.Center + velocity * 6f, 20f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(base.Left, base.Right, 20f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(player.Center, player.Center + player.velocity * 6f, 40f, DelegateMethods.CastLightOpen);
				Utils.PlotTileLine(player.Left, player.Right, 40f, DelegateMethods.CastLightOpen);
				break;
			}
			case 703:
				if (player.petFlagDD2Gato)
				{
					timeLeft = 2;
				}
				vector.Y += (float)Math.Cos(localAI[0] * (MathF.PI / 30f)) * 2f;
				num2 = 4;
				num3 = 2;
				num = 3f;
				num4 = 4;
				break;
			case 701:
				if (player.petFlagDD2Dragon)
				{
					timeLeft = 2;
				}
				break;
			case 764:
			{
				num7 = 0.025f;
				num6 = 0.04f;
				flag = true;
				localAI[0] += 1f;
				if (localAI[0] > 120f)
				{
					localAI[0] = 0f;
				}
				localAI[1] += velocity.X * 0.01f;
				localAI[1] += 1f / 120f;
				if (localAI[1] < MathF.PI * -2f)
				{
					localAI[1] += MathF.PI * 2f;
				}
				if (localAI[1] > MathF.PI * 2f)
				{
					localAI[1] -= MathF.PI * 2f;
				}
				if (velocity.Length() < 4f)
				{
					localAI[1] *= 0.9f;
					if (velocity.Length() > 0.1f && Main.rand.Next(30) == 0)
					{
						Dust dust = Dust.NewDustDirect(position - velocity, width, height, 292, velocity.X * 0.5f, velocity.Y * 0.5f, 150);
						dust.velocity *= 0.3f;
						dust.noLightEmittence = true;
					}
				}
				else
				{
					Vector2 vector2 = new Vector2(Main.screenWidth, Main.screenHeight);
					base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector2 / 2f, vector2 + new Vector2(400f)));
					if (Main.rand.Next(15) == 0)
					{
						Dust.NewDustDirect(position - velocity, width, height, 292, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 0.9f).noLightEmittence = true;
					}
				}
				float num8 = localAI[0] / 120f * 2f;
				if (num8 > 1f)
				{
					num8 = 2f - num8;
				}
				Opacity = MathHelper.Lerp(0.4f, 0.75f, num8);
				vector.Y += (float)Math.Cos(localAI[0] / 120f * (MathF.PI * 2f)) * 2f;
				if (player.petFlagUpbeatStar)
				{
					timeLeft = 2;
				}
				break;
			}
			}
			if (flag2 && (player.suspiciouslookingTentacle || player.petFlagDD2Ghost))
			{
				vector.X += -player.direction * 64;
			}
			direction = (spriteDirection = player.direction);
			Vector2 vector4 = player.MountedCenter + vector;
			float num9 = Vector2.Distance(base.Center, vector4);
			if (num9 > 1000f)
			{
				base.Center = player.Center + vector;
			}
			Vector2 vector5 = vector4 - base.Center;
			if (num9 < num)
			{
				velocity *= 0.25f;
			}
			if (vector5 != Vector2.Zero)
			{
				if (vector5.Length() < num * 0.5f)
				{
					velocity = vector5;
				}
				else
				{
					velocity = vector5 * num7;
				}
			}
			if (velocity.Length() > 6f)
			{
				float num10 = velocity.X * num6 + velocity.Y * (float)spriteDirection * 0.02f;
				if (Math.Abs(rotation - num10) >= MathF.PI)
				{
					if (num10 < rotation)
					{
						rotation -= MathF.PI * 2f;
					}
					else
					{
						rotation += MathF.PI * 2f;
					}
				}
				float num11 = 12f;
				rotation = (rotation * (num11 - 1f) + num10) / num11;
				if (++frameCounter >= num3)
				{
					frameCounter = 0;
					if (++frame >= num4)
					{
						frame = num5;
					}
				}
			}
			else
			{
				if (rotation > MathF.PI)
				{
					rotation -= MathF.PI * 2f;
				}
				if (rotation > -0.005f && rotation < 0.005f)
				{
					rotation = 0f;
				}
				else
				{
					rotation *= 0.96f;
				}
				if (++frameCounter >= num2)
				{
					frameCounter = 0;
					if (++frame >= num4)
					{
						frame = num5;
					}
				}
			}
			if (!flag)
			{
				localAI[0] += 1f;
				if (localAI[0] > 120f)
				{
					localAI[0] = 0f;
				}
			}
		}

		private void AI_145_BookStaffStorm()
		{
			//IL_0027: Unknown result type (might be due to invalid IL or missing references)
			//IL_002c: Unknown result type (might be due to invalid IL or missing references)
			//IL_003e: Unknown result type (might be due to invalid IL or missing references)
			//IL_008d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0092: Unknown result type (might be due to invalid IL or missing references)
			float num = 300f;
			SlotId val;
			if (soundDelay == 0)
			{
				soundDelay = -1;
				float[] array = localAI;
				val = SoundEngine.PlayTrackedSound(SoundID.DD2_BookStaffTwisterLoop, base.Center);
				array[1] = ((SlotId)(ref val)).ToFloat();
			}
			ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
			if (activeSound != null)
			{
				activeSound.Position = base.Center;
				activeSound.Volume = 1f - Math.Max(ai[0] - (num - 15f), 0f) / 15f;
			}
			else
			{
				float[] array2 = localAI;
				val = SlotId.Invalid;
				array2[1] = ((SlotId)(ref val)).ToFloat();
			}
			if (localAI[0] >= 16f && ai[0] < num - 15f)
			{
				ai[0] = num - 15f;
			}
			ai[0] += 1f;
			if (ai[0] >= num)
			{
				Kill();
			}
			Vector2 top = base.Top;
			Vector2 bottom = base.Bottom;
			Vector2 vector = Vector2.Lerp(top, bottom, 0.5f);
			Vector2 vector2 = new Vector2(0f, bottom.Y - top.Y);
			vector2.X = vector2.Y * 0.2f;
			int num2 = 16;
			int num3 = 160;
			for (int i = 0; i < 1; i++)
			{
				Vector2 vector3 = new Vector2(base.Center.X - (float)(num2 / 2), position.Y + (float)height - (float)num3);
				if (Collision.SolidCollision(vector3, num2, num3) || Collision.WetCollision(vector3, num2, num3))
				{
					if (velocity.Y > 0f)
					{
						velocity.Y = 0f;
					}
					if (velocity.Y > -4f)
					{
						velocity.Y -= 2f;
					}
					else
					{
						velocity.Y -= 4f;
						localAI[0] += 2f;
					}
					if (velocity.Y < -16f)
					{
						velocity.Y = -16f;
					}
					continue;
				}
				localAI[0] -= 1f;
				if (localAI[0] < 0f)
				{
					localAI[0] = 0f;
				}
				if (velocity.Y < 0f)
				{
					velocity.Y = 0f;
				}
				if (velocity.Y < 4f)
				{
					velocity.Y += 2f;
				}
				else
				{
					velocity.Y += 4f;
				}
				if (velocity.Y > 16f)
				{
					velocity.Y = 16f;
				}
			}
			if (ai[0] < num - 30f)
			{
				for (int j = 0; j < 1; j++)
				{
					float value = -1f;
					float value2 = 0.9f;
					float amount = Main.rand.NextFloat();
					Vector2 vector4 = new Vector2(MathHelper.Lerp(0.1f, 1f, Main.rand.NextFloat()), MathHelper.Lerp(value, value2, amount));
					vector4.X *= MathHelper.Lerp(2.2f, 0.6f, amount);
					vector4.X *= -1f;
					Vector2 vector5 = new Vector2(6f, 10f);
					Vector2 vector6 = vector + vector2 * vector4 * 0.5f + vector5;
					Dust dust = Main.dust[Dust.NewDust(vector6, 0, 0, 274)];
					dust.position = vector6;
					dust.fadeIn = 1.3f;
					dust.scale = 0.87f;
					dust.alpha = 211;
					if (vector4.X > -1.2f)
					{
						dust.velocity.X = 1f + Main.rand.NextFloat();
					}
					dust.noGravity = true;
					dust.velocity.Y = Main.rand.NextFloat() * -0.5f - 1.3f;
					dust.velocity.X += velocity.X * 2.1f;
					dust.noLight = true;
				}
			}
			Vector2 vector7 = base.Bottom + new Vector2(-25f, -25f);
			for (int k = 0; k < 4; k++)
			{
				Dust dust2 = Dust.NewDustDirect(vector7, 50, 25, 31, velocity.X, -2f, 100);
				dust2.fadeIn = 1.1f;
				dust2.noGravity = true;
			}
			for (int l = 0; l < 1; l++)
			{
				if (Main.rand.Next(5) == 0)
				{
					Gore gore = Gore.NewGoreDirect(base.TopLeft + Main.rand.NextVector2Square(0f, 1f) * base.Size, new Vector2(velocity.X * 1.5f, (0f - Main.rand.NextFloat()) * 16f), Utils.SelectRandom<int>(Main.rand, 1007, 1008, 1008));
					gore.timeLeft = 60;
					gore.alpha = 50;
					gore.velocity.X += velocity.X;
				}
			}
			for (int m = 0; m < 1; m++)
			{
				if (Main.rand.Next(7) == 0)
				{
					Gore gore2 = Gore.NewGoreDirect(base.TopLeft + Main.rand.NextVector2Square(0f, 1f) * base.Size, new Vector2(velocity.X * 1.5f, (0f - Main.rand.NextFloat()) * 16f), Utils.SelectRandom<int>(Main.rand, 1007, 1008, 1008));
					gore2.timeLeft = 0;
					gore2.alpha = 80;
				}
			}
			for (int n = 0; n < 1; n++)
			{
				if (Main.rand.Next(7) == 0)
				{
					Gore gore3 = Gore.NewGoreDirect(base.TopLeft + Main.rand.NextVector2Square(0f, 1f) * base.Size, new Vector2(velocity.X * 1.5f, (0f - Main.rand.NextFloat()) * 16f), Utils.SelectRandom<int>(Main.rand, 1007, 1008, 1008));
					gore3.timeLeft = 0;
					gore3.alpha = 80;
				}
			}
		}

		public bool AI_137_CanHit(Vector2 targetPosition)
		{
			if (WorldGen.SolidTile((int)targetPosition.X / 16, (int)targetPosition.Y / 16))
			{
				return false;
			}
			Vector2 vector = base.Top + Vector2.UnitY * 20f;
			bool flag = Collision.CanHitLine(vector, 0, 0, targetPosition, 0, 0);
			if (!flag)
			{
				Vector2 v = targetPosition - vector;
				Vector2 spinningpoint = v.SafeNormalize(Vector2.UnitY);
				Vector2 vector2 = Vector2.Lerp(vector, targetPosition, 0.5f);
				Vector2 vector3 = vector2 + spinningpoint.RotatedBy(1.5707963705062866) * v.Length() * 0.2f;
				if (Collision.CanHitLine(vector, 0, 0, vector3, 0, 0) && Collision.CanHitLine(vector3, 0, 0, targetPosition, 0, 0))
				{
					flag = true;
				}
				if (!flag)
				{
					Vector2 vector4 = vector2 + spinningpoint.RotatedBy(-1.5707963705062866) * v.Length() * 0.2f;
					if (Collision.CanHitLine(vector, 0, 0, vector4, 0, 0) && Collision.CanHitLine(vector4, 0, 0, targetPosition, 0, 0))
					{
						flag = true;
					}
				}
			}
			return flag;
		}

		private Point GetScarabBombDigDirectionSnap8()
		{
			Player player = Main.player[owner];
			Vector2 vector = DirectionTo(player.Center);
			Point result = new Point((!(vector.X > 0f)) ? 1 : (-1), (!(vector.Y > 0f)) ? 1 : (-1));
			if (Math.Abs(vector.X) > Math.Abs(vector.Y) * 2f)
			{
				result.Y = 0;
			}
			else if (Math.Abs(vector.Y) > Math.Abs(vector.X) * 2f)
			{
				result.X = 0;
			}
			return result;
		}

		public Color GetFirstFractalColor()
		{
			return Main.hslToRgb(ai[1], 1f, 0.5f);
		}

		public void Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(Point pt, float size, Utils.TileActionAttempt plot)
		{
			Tile tile = Main.tile[pt.X, pt.Y];
			if (tile != null && tile.active() && tile.halfBrick())
			{
				int num = pt.Y - 1;
				if (num >= 0)
				{
					tile = Main.tile[pt.X, num];
					if (!WorldGen.SolidOrSlopedTile(tile))
					{
						pt.Y--;
					}
				}
			}
			DelegateMethods.v2_1 = pt.ToVector2();
			DelegateMethods.f_1 = size;
			Utils.PlotTileArea(pt.X, pt.Y, plot);
		}

		public bool IsAttachedTo(NPC npc)
		{
			if (aiStyle == 113 && ai[0] == 1f && ai[1] == (float)npc.whoAmI)
			{
				return true;
			}
			return false;
		}

		private void BoulderExplosion()
		{
			int num = Main.rand.Next(2, 5);
			for (int i = 0; i < num; i++)
			{
				float num2 = 8f;
				Vector2 vector = new Vector2(Main.rand.NextFloat() - 0.5f, (0f - Main.rand.NextFloat()) / 2f);
				vector.Normalize();
				vector *= num2;
				int num3 = (int)((double)damage * 0.75);
				int num4 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector.X, vector.Y, 1005, num3, 0f, Main.myPlayer);
				Main.projectile[num4].timeLeft = 300;
			}
		}

		private void SpawnWebs()
		{
			int num = 6;
			int num2 = (int)(base.Center.X / 16f);
			int num3 = (int)(base.Center.Y / 16f);
			int num4 = num2 - num;
			int num5 = num2 + num;
			int num6 = num3 - num;
			int num7 = num3 + num;
			if (num4 < 1)
			{
				num4 = 1;
			}
			if (num5 > Main.maxTilesX - 1)
			{
				num5 = Main.maxTilesX - 1;
			}
			if (num6 < 1)
			{
				num6 = 1;
			}
			if (num7 > Main.maxTilesY - 1)
			{
				num7 = Main.maxTilesY - 1;
			}
			for (int i = num4; i < num5; i++)
			{
				for (int j = num6; j < num7; j++)
				{
					if (!Main.tile[i, j].active() && Main.rand.Next(5) != 0 && Math.Abs(i - num2) * Math.Abs(i - num2) + Math.Abs(j - num3) * Math.Abs(j - num3) < num * num)
					{
						WorldGen.PlaceTile(i, j, 51);
						if (Main.tile[i, j].active() && Main.netMode == 2)
						{
							NetMessage.SendTileSquare(-1, i, j);
						}
					}
				}
			}
		}

		public void Kill()
		{
			//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
			//IL_2d1f: Unknown result type (might be due to invalid IL or missing references)
			//IL_2d3f: Unknown result type (might be due to invalid IL or missing references)
			//IL_2d5c: Unknown result type (might be due to invalid IL or missing references)
			//IL_d1a2: Unknown result type (might be due to invalid IL or missing references)
			//IL_d1a7: Unknown result type (might be due to invalid IL or missing references)
			//IL_15b85: Unknown result type (might be due to invalid IL or missing references)
			if (!active)
			{
				return;
			}
			Main.projectileIdentity[owner, identity] = -1;
			int num = timeLeft;
			timeLeft = 0;
			if (owner == Main.myPlayer)
			{
				Main.player[owner].TryCancelChannel(this);
			}
			if (Main.getGoodWorld && aiStyle == 16)
			{
				int num2 = owner;
				owner = Main.myPlayer;
				PrepareBombToBlow();
				Damage();
				owner = num2;
			}
			if (Main.netMode != 1 && Main.getGoodWorld)
			{
				if (type == 472)
				{
					SpawnWebs();
				}
				if (type == 99)
				{
					BoulderExplosion();
				}
			}
			if (type == 1020)
			{
				SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[2]))?.Stop();
				SoundEngine.PlaySound(SoundID.Item62, position);
				Color transparent = Color.Transparent;
				for (int i = 0; i < 15; i++)
				{
					Dust dust = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent, 0.8f);
					dust.fadeIn = 0f;
					Dust dust2 = dust;
					dust2.velocity *= 0.5f;
				}
				for (int j = 0; j < 5; j++)
				{
					Dust dust3 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent, 2.5f);
					dust3.noGravity = true;
					Dust dust2 = dust3;
					dust2.velocity *= 2.5f;
					dust3 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent, 1.1f);
					dust2 = dust3;
					dust2.velocity *= 2f;
					dust3.noGravity = true;
				}
				for (int k = 0; k < 3; k++)
				{
					Dust dust4 = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 100, transparent, 1.1f);
					Dust dust2 = dust4;
					dust2.velocity *= 2f;
					dust4.noGravity = true;
				}
				for (int l = -1; l <= 1; l += 2)
				{
					for (int m = -1; m <= 1; m += 2)
					{
						if (Main.rand.Next(5) == 0)
						{
							Gore gore = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
							Gore gore2 = gore;
							gore2.velocity *= 0.2f;
							gore2 = gore;
							gore2.scale *= 0.65f;
							gore2 = gore;
							gore2.velocity += new Vector2(l, m) * 0.5f;
						}
					}
				}
			}
			else if (type == 949)
			{
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				int num3 = (int)ai[0];
				float num4 = 20f;
				for (float num5 = 0f; num5 < num4; num5++)
				{
					Vector2 vector = position;
					int num6 = Dust.NewDust(vector, 4, 4, num3, 0f, 0f, 100);
					if (Main.rand.Next(3) != 0)
					{
						Main.dust[num6].noGravity = true;
					}
					Dust dust2 = Main.dust[num6];
					dust2.velocity *= 0.8f;
					if (num3 == 66)
					{
						Main.dust[num6].color = new Color(Main.DiscoR, Main.DiscoG, Main.DiscoB);
						Main.dust[num6].noGravity = true;
					}
				}
			}
			else if (type == 985)
			{
				if (localAI[1] != 1f)
				{
					Color value = new Color(64, 220, 96);
					Color value2 = new Color(15, 84, 125);
					for (int n = 0; n < 20; n++)
					{
						float num7 = Main.rand.NextFloatDirection();
						float num8 = 1f - Math.Abs(num7);
						float f = rotation + num7 * (MathF.PI / 2f) * 0.9f;
						Vector2 vector2 = base.Center + f.ToRotationVector2() * Utils.Remap(Main.rand.NextFloat(), 0f, 1f, 60f, 85f) * scale;
						float num9 = Main.rand.NextFloat();
						vector2 -= rotation.ToRotationVector2() * num9 * 70f * scale;
						Color value3 = Color.Lerp(value2, value, 1f);
						value3 = Color.Lerp(value3, Color.White, 0.5f);
						Color.Lerp(value3, Color.White, Main.rand.NextFloat() * 0.3f);
						Dust dust5 = Dust.NewDustPerfect(vector2, 107, velocity.RotatedBy(num7 * (MathF.PI / 4f)) * 0.2f * Main.rand.NextFloat(), 100, default(Color), 1.4f * num8);
						Dust dust2 = dust5;
						dust2.position -= dust5.velocity * Main.rand.NextFloat() * 3f;
						dust2 = dust5;
						dust2.scale *= 1f - num9;
					}
					for (int num10 = 0; num10 < 10; num10++)
					{
						float num11 = Main.rand.NextFloatDirection();
						float num12 = 1f - Math.Abs(num11);
						float f2 = rotation + num11 * (MathF.PI / 2f) * 0.9f;
						Vector2 vector3 = base.Center + f2.ToRotationVector2() * Utils.Remap(Main.rand.NextFloat(), 0f, 1f, 70f, 85f) * scale;
						float num13 = Main.rand.NextFloat() * 0.25f;
						vector3 -= rotation.ToRotationVector2() * (0.2f + num13) * 70f * scale;
						Color value4 = Color.Lerp(value2, value, 0.66f);
						value4 = Color.Lerp(value4, Color.White, 0.33f);
						Color.Lerp(value4, Color.White, Main.rand.NextFloat() * 0.3f);
						Dust dust6 = Dust.NewDustPerfect(vector3, 107, velocity.RotatedBy(num11 * (MathF.PI / 4f)) * 0.2f * Main.rand.NextFloat(), 100, default(Color), 1.4f * num12);
						Dust dust2 = dust6;
						dust2.position -= dust6.velocity * Main.rand.NextFloat() * 3f;
						dust2 = dust6;
						dust2.scale *= 1f - num13;
					}
					for (int num14 = 0; num14 < 10; num14++)
					{
						float num15 = Main.rand.NextFloatDirection();
						float num16 = 1f - Math.Abs(num15);
						float f3 = rotation + num15 * (MathF.PI / 2f) * 0.9f;
						Vector2 vector4 = base.Center + f3.ToRotationVector2() * Utils.Remap(Main.rand.NextFloat(), 0f, 1f, 60f, 75f) * scale;
						float num17 = Main.rand.NextFloat() * 0.25f;
						vector4 -= rotation.ToRotationVector2() * (0.5f + num17) * 70f * scale;
						Color value5 = Color.Lerp(value2, value, 0.33f);
						value5 = Color.Lerp(value5, Color.White, 0.16f);
						Color.Lerp(value5, Color.White, Main.rand.NextFloat() * 0.3f);
						Dust dust7 = Dust.NewDustPerfect(vector4, 107, velocity.RotatedBy(num15 * (MathF.PI / 4f)) * 0.2f * Main.rand.NextFloat(), 100, default(Color), 1.4f * num16);
						Dust dust2 = dust7;
						dust2.position -= dust7.velocity * Main.rand.NextFloat() * 3f;
						dust2 = dust7;
						dust2.scale *= 1f - num17;
					}
				}
			}
			else if (type == 756)
			{
				for (float num18 = 0f; num18 < 1f; num18 += 0.025f)
				{
					Dust dust8 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f) * scale + velocity.SafeNormalize(Vector2.UnitY) * num18 * 200f * scale, 5, Main.rand.NextVector2Circular(3f, 3f));
					dust8.velocity.Y += -0.3f;
					Dust dust2 = dust8;
					dust2.velocity += velocity * 0.2f;
					dust8.scale = 1f;
					dust8.alpha = 100;
				}
			}
			else if (type == 961)
			{
				for (float num19 = 0f; num19 < 1f; num19 += 0.25f)
				{
					Dust dust9 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f) * scale + velocity.SafeNormalize(Vector2.UnitY) * num19 * 200f * scale, 16, Main.rand.NextVector2Circular(3f, 3f));
					dust9.velocity.Y += -0.3f;
					Dust dust2 = dust9;
					dust2.velocity += velocity * 0.2f;
					dust9.scale = 1f;
					dust9.alpha = 100;
				}
			}
			else if (type == 962)
			{
				for (int num20 = 0; num20 < 20; num20++)
				{
					Dust dust10 = Dust.NewDustPerfect(base.Center + Main.rand.NextVector2Circular(16f, 16f) * scale, 16, Main.rand.NextVector2Circular(2f, 2f));
					Dust dust2 = dust10;
					dust2.velocity += velocity * 0.1f;
					dust10.scale = 1f;
					dust10.alpha = 100;
				}
			}
			else if (type == 932)
			{
				Color fairyQueenWeaponsColor = GetFairyQueenWeaponsColor();
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				Vector2 target = base.Center;
				Main.rand.NextFloat();
				int num21 = 10;
				for (int num22 = 0; num22 < num21; num22++)
				{
					Vector2 vector5 = position - velocity * num22;
					int num23 = Main.rand.Next(1, 3);
					float num24 = MathHelper.Lerp(0.3f, 1f, Utils.GetLerpValue(num21, 0f, num22, clamped: true));
					if ((float)num22 >= (float)oldPos.Length * 0.3f)
					{
						num23--;
					}
					if ((float)num22 >= (float)oldPos.Length * 0.75f)
					{
						num23 -= 2;
					}
					vector5.DirectionTo(target).SafeNormalize(Vector2.Zero);
					target = vector5;
					for (float num25 = 0f; num25 < (float)num23; num25++)
					{
						int num26 = Dust.NewDust(vector5, width, height, 267, 0f, 0f, 0, fairyQueenWeaponsColor);
						Dust dust2 = Main.dust[num26];
						dust2.velocity *= Main.rand.NextFloat() * 0.8f;
						Main.dust[num26].noGravity = true;
						Main.dust[num26].scale = 0.9f + Main.rand.NextFloat() * 1.2f;
						Main.dust[num26].fadeIn = Main.rand.NextFloat() * 1.2f * num24;
						dust2 = Main.dust[num26];
						dust2.scale *= num24;
						if (num26 != 6000)
						{
							Dust dust11 = Dust.CloneDust(num26);
							dust2 = dust11;
							dust2.scale /= 2f;
							dust2 = dust11;
							dust2.fadeIn *= 0.85f;
							dust11.color = new Color(255, 255, 255, 255);
						}
					}
				}
			}
			else if (type == 931)
			{
				Color fairyQueenWeaponsColor2 = GetFairyQueenWeaponsColor();
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				Vector2 target2 = base.Center;
				Main.rand.NextFloat();
				for (int num27 = 0; num27 < oldPos.Length; num27++)
				{
					Vector2 vector6 = oldPos[num27];
					if (vector6 == Vector2.Zero)
					{
						break;
					}
					int num28 = Main.rand.Next(1, 3);
					float num29 = MathHelper.Lerp(0.3f, 1f, Utils.GetLerpValue(oldPos.Length, 0f, num27, clamped: true));
					if ((float)num27 >= (float)oldPos.Length * 0.3f)
					{
						num28--;
					}
					if ((float)num27 >= (float)oldPos.Length * 0.75f)
					{
						num28 -= 2;
					}
					vector6.DirectionTo(target2).SafeNormalize(Vector2.Zero);
					target2 = vector6;
					for (float num30 = 0f; num30 < (float)num28; num30++)
					{
						int num31 = Dust.NewDust(vector6, width, height, 267, 0f, 0f, 0, fairyQueenWeaponsColor2);
						Dust dust2 = Main.dust[num31];
						dust2.velocity *= Main.rand.NextFloat() * 0.8f;
						Main.dust[num31].noGravity = true;
						Main.dust[num31].scale = 0.9f + Main.rand.NextFloat() * 1.2f;
						Main.dust[num31].fadeIn = Main.rand.NextFloat() * 1.2f * num29;
						dust2 = Main.dust[num31];
						dust2.scale *= num29;
						if (num31 != 6000)
						{
							Dust dust12 = Dust.CloneDust(num31);
							dust2 = dust12;
							dust2.scale /= 2f;
							dust2 = dust12;
							dust2.fadeIn *= 0.85f;
							dust12.color = new Color(255, 255, 255, 255);
						}
					}
				}
			}
			else if (type == 79)
			{
				int newWidth = width;
				int newHeight = height;
				Resize(128, 128);
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				Resize(newWidth, newHeight);
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				Vector2 target3 = base.Center;
				float num32 = Main.rand.NextFloat();
				for (int num33 = 0; num33 < oldPos.Length; num33++)
				{
					Vector2 vector7 = oldPos[num33];
					if (vector7 == Vector2.Zero)
					{
						break;
					}
					Color newColor = Main.hslToRgb((num32 + Utils.GetLerpValue(oldPos.Length, 0f, num33, clamped: true)) % 1f, 1f, 0.65f);
					int num34 = Main.rand.Next(1, 4);
					float lerpValue = Utils.GetLerpValue(oldPos.Length, 0f, num33, clamped: true);
					float num35 = MathHelper.Lerp(0.3f, 1f, lerpValue);
					if ((float)num33 >= (float)oldPos.Length * 0.3f)
					{
						num34--;
					}
					if ((float)num33 >= (float)oldPos.Length * 0.65f)
					{
						num34 -= 2;
					}
					if ((float)num33 >= (float)oldPos.Length * 0.85f)
					{
						num34 -= 3;
					}
					Vector2 vector8 = vector7.DirectionTo(target3).SafeNormalize(Vector2.Zero);
					target3 = vector7;
					Vector2 vector9 = base.Size / 2f;
					for (float num36 = 0f; num36 < (float)num34; num36++)
					{
						int num37 = Dust.NewDust(vector7, width, height, 267, 0f, 0f, 0, newColor);
						Dust dust2 = Main.dust[num37];
						dust2.velocity *= Main.rand.NextFloat() * 0.8f;
						Main.dust[num37].noGravity = true;
						Main.dust[num37].scale = 0.9f + Main.rand.NextFloat() * 1.2f;
						Main.dust[num37].fadeIn = Main.rand.NextFloat() * 1.2f * num35;
						dust2 = Main.dust[num37];
						dust2.velocity += vector8 * 6f;
						dust2 = Main.dust[num37];
						dust2.scale *= num35;
						Main.dust[num37].position = Vector2.Lerp(vector7 + vector9, Main.dust[num37].position, lerpValue);
						if (num37 != 6000)
						{
							Dust dust13 = Dust.CloneDust(num37);
							dust2 = dust13;
							dust2.scale /= 2f;
							dust2 = dust13;
							dust2.fadeIn *= 0.85f;
							dust13.color = new Color(255, 255, 255, 255);
						}
					}
				}
				for (float num38 = 0f; num38 < 0.5f; num38 += 0.25f)
				{
					ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.RainbowRodHit, new ParticleOrchestraSettings
					{
						PositionInWorld = base.Center,
						MovementVector = Vector2.UnitX.RotatedBy(num38 * (MathF.PI * 2f)) * 16f
					}, owner);
				}
				for (int num39 = 0; num39 < 14; num39++)
				{
					int num40 = Dust.NewDust(position, width, height, 66, 0f, 0f, 100, Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f), 1.7f);
					Main.dust[num40].noGravity = true;
					Dust dust2 = Main.dust[num40];
					dust2.velocity *= 3f;
				}
			}
			else if (type == 16)
			{
				int newWidth2 = width;
				int newHeight2 = height;
				Resize(128, 128);
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				Resize(newWidth2, newHeight2);
				SoundEngine.PlaySound(SoundID.Item10, base.Center);
				Vector2 target4 = base.Center;
				for (int num41 = 0; num41 < oldPos.Length; num41++)
				{
					Vector2 vector10 = oldPos[num41];
					if (vector10 == Vector2.Zero)
					{
						break;
					}
					Color newColor2 = Main.hslToRgb(4f / 9f + Main.rand.NextFloat() * (2f / 9f), 1f, 0.65f);
					int num42 = Main.rand.Next(1, 4);
					float num43 = MathHelper.Lerp(0.3f, 1f, Utils.GetLerpValue(oldPos.Length, 0f, num41, clamped: true));
					if ((float)num41 >= (float)oldPos.Length * 0.3f)
					{
						num42--;
					}
					if ((float)num41 >= (float)oldPos.Length * 0.75f)
					{
						num42 -= 2;
					}
					Vector2 vector11 = vector10.DirectionTo(target4).SafeNormalize(Vector2.Zero);
					target4 = vector10;
					for (float num44 = 0f; num44 < (float)num42; num44++)
					{
						if (Main.rand.Next(3) == 0)
						{
							int num45 = Dust.NewDust(vector10, width, height, 267, 0f, 0f, 0, newColor2);
							Dust dust2 = Main.dust[num45];
							dust2.velocity *= Main.rand.NextFloat() * 0.8f;
							Main.dust[num45].noGravity = true;
							Main.dust[num45].scale = Main.rand.NextFloat() * 0.8f;
							Main.dust[num45].fadeIn = Main.rand.NextFloat() * 1.2f * num43;
							dust2 = Main.dust[num45];
							dust2.velocity += vector11 * 6f;
							dust2 = Main.dust[num45];
							dust2.scale *= num43;
							if (num45 != 6000)
							{
								Dust dust14 = Dust.CloneDust(num45);
								dust2 = dust14;
								dust2.scale /= 2f;
								dust2 = dust14;
								dust2.fadeIn /= 2f;
								dust14.color = new Color(255, 255, 255, 255);
							}
						}
						else
						{
							Dust dust15 = Dust.NewDustDirect(vector10, width, height, 15, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
							Main.rand.Next(2);
							dust15.noGravity = true;
							Dust dust2 = dust15;
							dust2.velocity *= 2f;
							dust2 = dust15;
							dust2.velocity += vector11 * 9f;
							dust2 = dust15;
							dust2.scale *= num43;
							dust15.fadeIn = (0.6f + Main.rand.NextFloat() * 0.4f) * num43;
							dust15.noLightEmittence = (dust15.noLight = true);
						}
					}
				}
				for (int num46 = 0; num46 < 20; num46++)
				{
					Dust dust16 = Dust.NewDustDirect(position, width, height, 15);
					dust16.noGravity = true;
					dust16.velocity = Main.rand.NextVector2Circular(1f, 1f) * 1.5f;
					dust16.scale = 1.2f + Main.rand.NextFloat() * 0.5f;
					dust16.noLightEmittence = (dust16.noLight = true);
					Dust dust2 = dust16;
					dust2.velocity += velocity * 0.01f;
					dust2 = dust16;
					dust2.position += dust16.velocity * Main.rand.Next(1, 16);
					dust16 = Dust.NewDustDirect(position, width, height, 15, 0f, 0f, 100);
					dust2 = dust16;
					dust2.velocity *= 1.2f;
					dust16.noLightEmittence = (dust16.noLight = true);
					dust2 = dust16;
					dust2.velocity += velocity * 0.01f;
					dust2 = dust16;
					dust2.scale *= 0.8f + Main.rand.NextFloat() * 0.2f;
					dust2 = dust16;
					dust2.position += dust16.velocity * Main.rand.Next(1, 16);
				}
			}
			else if (type == 34)
			{
				int newWidth3 = width;
				int newHeight3 = height;
				Resize(96, 96);
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				Resize(newWidth3, newHeight3);
				SoundEngine.PlaySound(SoundID.Item10, position);
				Vector2 target5 = base.Center;
				for (int num47 = 0; num47 < oldPos.Length; num47++)
				{
					Vector2 vector12 = oldPos[num47];
					if (vector12 == Vector2.Zero)
					{
						break;
					}
					Color newColor3 = Main.hslToRgb(Main.rand.NextFloat() * (1f / 9f), 1f, 0.5f);
					int num48 = Main.rand.Next(1, 5);
					float num49 = MathHelper.Lerp(0.3f, 1f, Utils.GetLerpValue(oldPos.Length, 0f, num47, clamped: true));
					if ((float)num47 >= (float)oldPos.Length * 0.3f)
					{
						num48--;
					}
					if ((float)num47 >= (float)oldPos.Length * 0.75f)
					{
						num48 -= 2;
					}
					Vector2 vector13 = vector12.DirectionTo(target5).SafeNormalize(Vector2.Zero);
					target5 = vector12;
					for (float num50 = 0f; num50 < (float)num48; num50++)
					{
						if (Main.rand.Next(3) == 0)
						{
							int num51 = Dust.NewDust(vector12, width, height, 267, 0f, 0f, 0, newColor3);
							Dust dust2 = Main.dust[num51];
							dust2.velocity *= Main.rand.NextFloat() * 0.8f;
							Main.dust[num51].noGravity = true;
							Main.dust[num51].scale = Main.rand.NextFloat() * 1f;
							Main.dust[num51].fadeIn = Main.rand.NextFloat() * 2f;
							dust2 = Main.dust[num51];
							dust2.velocity += vector13 * 8f;
							dust2 = Main.dust[num51];
							dust2.scale *= num49;
							if (num51 != 6000)
							{
								Dust dust17 = Dust.CloneDust(num51);
								dust2 = dust17;
								dust2.scale /= 2f;
								dust2 = dust17;
								dust2.fadeIn /= 2f;
								dust17.color = new Color(255, 255, 255, 255);
							}
						}
						else
						{
							Dust dust18 = Dust.NewDustDirect(vector12, width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
							Dust dust2;
							if (Main.rand.Next(2) == 0)
							{
								dust18.noGravity = true;
								dust2 = dust18;
								dust2.scale *= 2.5f;
							}
							dust2 = dust18;
							dust2.velocity *= 2f;
							dust2 = dust18;
							dust2.velocity += vector13 * 6f;
							dust2 = dust18;
							dust2.scale *= num49;
							dust18.noLightEmittence = (dust18.noLight = true);
						}
					}
				}
				for (int num52 = 0; num52 < 20; num52++)
				{
					Dust dust19 = Dust.NewDustDirect(position, width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
					dust19.noGravity = true;
					dust19.velocity = Main.rand.NextVector2Circular(1f, 1f) * 6f;
					dust19.scale = 1.6f;
					dust19.fadeIn = 1.3f + Main.rand.NextFloat() * 1f;
					dust19.noLightEmittence = (dust19.noLight = true);
					Dust dust2 = dust19;
					dust2.velocity += velocity * 0.1f;
					dust19 = Dust.NewDustDirect(position, width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
					dust2 = dust19;
					dust2.velocity *= 2f;
					dust19.noLightEmittence = (dust19.noLight = true);
					dust2 = dust19;
					dust2.velocity += velocity * 0.1f;
				}
			}
			if (type == 873)
			{
				int num53 = 20;
				float num54 = MathF.PI * 2f / (float)num53;
				float num55 = velocity.ToRotation();
				Color value6 = AI_171_GetColor();
				for (int num56 = 0; num56 < num53; num56++)
				{
					Dust dust20 = Dust.NewDustPerfect(base.Center, 267);
					dust20.fadeIn = 1f;
					dust20.noGravity = true;
					dust20.alpha = 100;
					dust20.color = Color.Lerp(value6, Color.White, Main.rand.NextFloat() * 0.4f);
					if (num56 % 4 == 0)
					{
						dust20.velocity = num55.ToRotationVector2() * 3.2f;
						dust20.scale = 2.3f;
					}
					else if (num56 % 2 == 0)
					{
						dust20.velocity = num55.ToRotationVector2() * 1.8f;
						dust20.scale = 1.9f;
					}
					else
					{
						dust20.velocity = num55.ToRotationVector2();
						dust20.scale = 1.6f;
					}
					num55 += num54;
					Dust dust2 = dust20;
					dust2.velocity += velocity * Main.rand.NextFloat() * 0.5f;
				}
			}
			_ = type;
			_ = 857;
			if (type == 1012)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num57 = 0; num57 < 40; num57++)
				{
					Vector2 vector14 = Vector2.UnitY.RotatedBy((float)num57 * (MathF.PI * 2f)) * (2f + Main.rand.NextFloat() * 0.5f);
					vector14 += velocity * Main.rand.NextFloat();
					Color white = Color.White;
					if (Main.rand.Next(3) == 0)
					{
						Dust dust21 = Dust.NewDustDirect(newColor: Main.rand.Next(3) switch
						{
							0 => new Color(226, 116, 56), 
							1 => new Color(243, 175, 93), 
							2 => new Color(254, 210, 146), 
							_ => new Color(176, 64, 36), 
						}, Position: position + Main.rand.NextVector2Circular(18f, 18f) * scale, Width: 2, Height: 2, Type: 284, SpeedX: vector14.X, SpeedY: vector14.Y, Alpha: 0, Scale: Main.rand.NextFloat() * 1f + 1f);
						Dust dust2 = dust21;
						dust2.position -= velocity;
						dust21.fadeIn = 1f;
					}
					else
					{
						vector14 *= 0.3f;
						Dust dust22 = Dust.NewDustDirect(position + Main.rand.NextVector2Circular(18f, 18f) * scale, 2, 2, 138, vector14.X, vector14.Y, 0, default(Color), Main.rand.NextFloat() * 0.3f + 0.6f);
						Dust dust2 = dust22;
						dust2.position -= velocity;
					}
				}
			}
			if (type == 920)
			{
				for (int num58 = 0; num58 < 6; num58++)
				{
					Vector2 vector15 = Vector2.UnitY.RotatedBy((float)num58 * (MathF.PI * 2f) + Main.rand.NextFloat() * (MathF.PI * 2f) * 0.5f) * (2f + Main.rand.NextFloat() * 0.5f);
					int num59 = Dust.NewDust(position + base.Size * Main.rand.NextVector2Square(0f, 1f), 4, 4, 4, vector15.X, vector15.Y, 80, new Color(78, 136, 255, 150), 1.5f);
					Main.dust[num59].noGravity = true;
				}
			}
			if (type == 921)
			{
				for (int num60 = 0; num60 < 12; num60++)
				{
					Vector2 vector16 = Vector2.UnitY.RotatedBy((float)num60 * (MathF.PI * 2f) + Main.rand.NextFloat() * (MathF.PI * 2f) * 0.5f) * (3f + Main.rand.NextFloat() * 0.5f);
					int num61 = Dust.NewDust(position + base.Size * Main.rand.NextVector2Square(0f, 1f), 6, 6, 243, vector16.X, vector16.Y, 80, default(Color), 1.5f);
					Main.dust[num61].noGravity = true;
				}
			}
			if (type == 926)
			{
				for (int num62 = 0; num62 < 22; num62++)
				{
					Vector2 vector17 = Vector2.UnitY.RotatedBy((float)num62 * (MathF.PI * 2f) + Main.rand.NextFloat() * (MathF.PI * 2f) * 0.5f) * (3f + Main.rand.NextFloat() * 0.5f);
					int num63 = Dust.NewDust(position - new Vector2(8f, 8f), width + 16, height + 16, 31, vector17.X, vector17.Y, 40, NPC.AI_121_QueenSlime_GetDustColor(), 1.5f);
					Main.dust[num63].noGravity = true;
				}
			}
			if (type == 937)
			{
				for (int num64 = 0; num64 < 12; num64++)
				{
					Vector2 vector18 = Vector2.UnitY.RotatedBy((float)num64 * (MathF.PI * 2f) + Main.rand.NextFloat() * (MathF.PI * 2f) * 0.5f) * (3f + Main.rand.NextFloat() * 0.5f);
					int num65 = Dust.NewDust(position - new Vector2(8f, 8f), width + 16, height + 16, 31, vector18.X, vector18.Y, 40, NPC.AI_121_QueenSlime_GetDustColor(), 1.5f);
					Main.dust[num65].noGravity = true;
				}
			}
			if (type == 818)
			{
				for (float num66 = 0f; num66 < 1f; num66 += 0.34f)
				{
					Dust.NewDustPerfect(position + base.Size * Main.rand.NextVector2Square(0f, 1f), 278, Vector2.UnitY.RotatedBy(num66 * (MathF.PI * 2f) + Main.rand.NextFloat() * (MathF.PI * 2f) * 0.5f) * (2f + Main.rand.NextFloat() * 0.5f), 150, Color.Lerp(Color.White, Color.Gold, Main.rand.NextFloat()), 0.4f).noGravity = true;
				}
				for (float num67 = 0f; num67 < 1f; num67 += 0.34f)
				{
					Dust.NewDustPerfect(position + base.Size * Main.rand.NextVector2Square(0f, 1f), 278, Vector2.UnitY.RotatedBy(num67 * (MathF.PI * 2f) + Main.rand.NextFloat() * (MathF.PI * 2f) * 0.5f) * (1f + Main.rand.NextFloat() * 0.5f), 150, Color.Lerp(Color.White, Main.OurFavoriteColor, Main.rand.NextFloat()), 0.7f).noGravity = true;
				}
			}
			if (type == 856)
			{
				for (int num68 = 0; num68 < 6; num68++)
				{
					Dust.NewDust(position, width, height, 58, 0f, 0f, 150, default(Color), 0.8f);
				}
				for (float num69 = 0f; num69 < 1f; num69 += 0.34f)
				{
					Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num69 * (MathF.PI * 2f) + Main.rand.NextFloat() * (MathF.PI * 2f) * 0.5f) * (4f + Main.rand.NextFloat() * 2f), 150, Color.Lerp(Color.White, Color.HotPink, Main.rand.NextFloat() * 0.5f + 0.5f)).noGravity = true;
				}
				for (float num70 = 0f; num70 < 1f; num70 += 0.34f)
				{
					Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num70 * (MathF.PI * 2f) + Main.rand.NextFloat() * (MathF.PI * 2f) * 0.5f) * (2f + Main.rand.NextFloat() * 1f), 150, Color.Lerp(Color.White, Color.Orange, Main.rand.NextFloat() * 0.5f + 0.5f)).noGravity = true;
				}
				Vector2 vector19 = new Vector2(Main.screenWidth, Main.screenHeight);
				if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector19 / 2f, vector19 + new Vector2(400f))))
				{
					for (int num71 = 0; num71 < 1; num71++)
					{
						Gore.NewGore(position, Main.rand.NextVector2CircularEdge(0.5f, 0.5f) * 3f, Utils.SelectRandom<int>(Main.rand, 16));
					}
				}
				ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.StellarTune, new ParticleOrchestraSettings
				{
					PositionInWorld = base.Center
				}, owner);
				position = base.Center;
				width = (height = 128);
				base.Center = position;
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
			}
			if (type == 818)
			{
				Damage();
			}
			if (type == 686)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_BetsyFireballImpact, base.Center);
			}
			else if (type == 711)
			{
				SoundEngine.PlayTrackedSound(SoundID.DD2_BetsysWrathImpact, base.Center);
			}
			else if (type == 704)
			{
				ActiveSound activeSound = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
				if (activeSound != null)
				{
					activeSound.Volume = 0f;
					activeSound.Stop();
				}
			}
			if (type == 710)
			{
				ai[1] = -1f;
				position = base.Center;
				width = (height = 40);
				base.Center = position;
				Damage();
				SoundEngine.PlaySound(SoundID.Item14, position);
				for (int num72 = 0; num72 < 2; num72++)
				{
					int num73 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num73].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int num74 = 0; num74 < 10; num74++)
				{
					int num75 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.5f);
					Main.dust[num75].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num75].noGravity = true;
					Dust dust2 = Main.dust[num75];
					dust2.velocity *= 2f;
				}
				for (int num76 = 0; num76 < 5; num76++)
				{
					int num77 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num77].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num77].noGravity = true;
					Dust dust2 = Main.dust[num77];
					dust2.velocity *= 2f;
				}
			}
			else if (type == 711)
			{
				Rectangle hitbox = base.Hitbox;
				for (int num78 = 0; num78 < oldPos.Length / 2; num78 += 2)
				{
					hitbox.X = (int)oldPos[num78].X;
					hitbox.Y = (int)oldPos[num78].Y;
					for (int num79 = 0; num79 < 2; num79++)
					{
						int num80 = Utils.SelectRandom<int>(Main.rand, 6, 55, 158);
						int num81 = Dust.NewDust(hitbox.TopLeft(), width, height, num80, direction, -2.5f);
						Main.dust[num81].alpha = 200;
						Dust dust2 = Main.dust[num81];
						dust2.velocity *= 2.4f;
						dust2 = Main.dust[num81];
						dust2.scale += Main.rand.NextFloat();
						dust2 = Main.dust[num81];
						dust2.scale -= 0.5f;
						if (Main.dust[num81].type == 55)
						{
							Main.dust[num81].color = Color.Lerp(new Color(128, 0, 180, 128), Color.Gold, Main.rand.NextFloat());
						}
						Main.dust[num81].noLight = true;
					}
				}
				for (int num82 = 10; num82 < oldPos.Length; num82 += 2)
				{
					hitbox.X = (int)oldPos[num82].X;
					hitbox.Y = (int)oldPos[num82].Y;
					for (int num83 = 0; num83 < 2; num83++)
					{
						if (Main.rand.Next(3) != 0)
						{
							int num84 = Utils.SelectRandom<int>(Main.rand, 55);
							int num85 = Dust.NewDust(hitbox.TopLeft(), width, height, num84, direction, -2.5f);
							Main.dust[num85].alpha = 120;
							Dust dust2 = Main.dust[num85];
							dust2.velocity *= 2.4f;
							dust2 = Main.dust[num85];
							dust2.scale += Main.rand.NextFloat() * 0.7f;
							dust2 = Main.dust[num85];
							dust2.scale -= 0.5f;
							if (Main.dust[num85].type == 55)
							{
								Main.dust[num85].color = Color.Lerp(Color.Purple, Color.Black, Main.rand.NextFloat());
							}
							Main.dust[num85].noLight = true;
						}
					}
				}
				for (int num86 = 5; num86 < oldPos.Length; num86++)
				{
					hitbox.X = (int)oldPos[num86].X;
					hitbox.Y = (int)oldPos[num86].Y;
					for (int num87 = 0; num87 < 1; num87++)
					{
						if (Main.rand.Next(3) != 0)
						{
							int num88 = Utils.SelectRandom<int>(Main.rand, 55);
							int num89 = Dust.NewDust(hitbox.TopLeft(), width, height, num88, direction, -2.5f);
							Main.dust[num89].alpha = 80;
							Dust dust2 = Main.dust[num89];
							dust2.velocity *= 0.3f;
							dust2 = Main.dust[num89];
							dust2.velocity += velocity * 0.5f;
							dust2 = Main.dust[num89];
							dust2.scale += Main.rand.NextFloat() * 0.7f;
							dust2 = Main.dust[num89];
							dust2.scale -= 0.5f;
							if (Main.dust[num89].type == 55)
							{
								Main.dust[num89].color = Color.Lerp(Color.Purple, Color.Black, Main.rand.NextFloat());
							}
							Main.dust[num89].noLight = true;
						}
					}
				}
				for (int num90 = 0; num90 < 20; num90++)
				{
					if (Main.rand.Next(3) != 0)
					{
						int num91 = 228;
						Dust dust23 = Main.dust[Dust.NewDust(position, width, height, num91)];
						dust23.noGravity = true;
						dust23.scale = 1.25f + Main.rand.NextFloat();
						dust23.fadeIn = 1.5f;
						Dust dust2 = dust23;
						dust2.velocity *= 6f;
						dust23.noLight = true;
					}
				}
				for (int num92 = 0; num92 < 20; num92++)
				{
					if (Main.rand.Next(3) != 0)
					{
						int num93 = 55;
						Dust dust24 = Main.dust[Dust.NewDust(position, width, height, num93)];
						dust24.noGravity = true;
						dust24.scale = 1.25f + Main.rand.NextFloat();
						dust24.fadeIn = 1.5f;
						Dust dust2 = dust24;
						dust2.velocity *= 6f;
						dust24.noLight = true;
						dust24.color = new Color(0, 0, 220, 128);
					}
				}
				if (owner == Main.myPlayer)
				{
					position = base.Center;
					base.Size = new Vector2(140f);
					base.Center = position;
					penetrate = -1;
					usesLocalNPCImmunity = true;
					localNPCHitCooldown = -1;
					Damage();
				}
			}
			else if (type == 662 || type == 685)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				Vector2 vector20 = oldVelocity.SafeNormalize(Vector2.Zero);
				Vector2 vector21 = position + vector20 * 16f;
				for (int num94 = 0; num94 < 16; num94++)
				{
					if (Main.rand.Next(2) == 0)
					{
						vector21 -= vector20 * 8f;
						continue;
					}
					Dust dust25 = Dust.NewDustDirect(vector21, width, height, 11);
					dust25.position = (dust25.position + base.Center) / 2f;
					Dust dust2 = dust25;
					dust2.velocity += oldVelocity * 0.4f;
					dust2 = dust25;
					dust2.velocity *= 0.5f;
					dust25.noGravity = true;
					vector21 -= vector20 * 8f;
				}
			}
			if (type == 680)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				Vector2 vector22 = oldVelocity.SafeNormalize(Vector2.Zero);
				Vector2 vector23 = position + vector22 * 16f;
				for (int num95 = 0; num95 < 16; num95++)
				{
					if (Main.rand.Next(2) == 0)
					{
						vector23 -= vector22 * 8f;
						continue;
					}
					Dust dust26 = Dust.NewDustDirect(vector23, width, height, 11);
					dust26.position = (dust26.position + base.Center) / 2f;
					Dust dust2 = dust26;
					dust2.velocity += oldVelocity * 0.4f;
					dust2 = dust26;
					dust2.velocity *= 0.5f;
					dust26.noGravity = true;
					vector23 -= vector22 * 8f;
				}
				Dust.NewDustDirect(position, width, height, 11, 0f, 0f, 0, Color.Red, 1.6f).noGravity = true;
			}
			if (type == 664 || type == 666 || type == 668 || type == 706)
			{
				int num96 = 4;
				int num97 = 20;
				int num98 = 10;
				int num99 = 20;
				int num100 = 20;
				int num101 = 4;
				float num102 = 1.5f;
				int num103 = 6;
				int num104 = 6;
				if (Main.player[owner].setApprenticeT3)
				{
					num96 += 4;
					num100 += 10;
					num97 += 20;
					num99 += 30;
					num98 /= 2;
					num101 += 4;
					num102 += 0.5f;
					num103 += 7;
					num104 = 270;
				}
				position = base.Center;
				width = (height = 16 * num103);
				base.Center = position;
				Damage();
				SoundEngine.PlaySound(SoundID.Item100, position);
				for (int num105 = 0; num105 < num96; num105++)
				{
					int num106 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num106].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int num107 = 0; num107 < num97; num107++)
				{
					Dust dust27 = Dust.NewDustDirect(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 2.5f);
					dust27.position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 10f;
					Dust dust2 = dust27;
					dust2.velocity *= 16f;
					if (dust27.velocity.Y > -2f)
					{
						dust27.velocity.Y *= -0.4f;
					}
					dust27.noLight = true;
					dust27.noGravity = true;
				}
				for (int num108 = 0; num108 < num99; num108++)
				{
					Dust dust28 = Dust.NewDustDirect(new Vector2(position.X, position.Y), width, height, num104, 0f, 0f, 100, default(Color), 1.5f);
					dust28.position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Dust dust2 = dust28;
					dust2.velocity *= 2f;
					dust28.noGravity = true;
					dust28.fadeIn = num102;
				}
				for (int num109 = 0; num109 < num98; num109++)
				{
					int num110 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num110].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num110].noGravity = true;
					Dust dust2 = Main.dust[num110];
					dust2.velocity *= 3f;
				}
				for (int num111 = 0; num111 < num100; num111++)
				{
					int num112 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num112].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num112].noGravity = true;
					Dust dust2 = Main.dust[num112];
					dust2.velocity *= 3f;
				}
				for (int num113 = 0; num113 < num101; num113++)
				{
					int num114 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num114].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Gore gore2 = Main.gore[num114];
					gore2.position -= Vector2.One * 16f;
					if (Main.rand.Next(2) == 0)
					{
						Main.gore[num114].position.Y -= 30f;
					}
					gore2 = Main.gore[num114];
					gore2.velocity *= 0.3f;
					Main.gore[num114].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num114].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
			}
			else if (type == 681)
			{
				position.X += width / 2;
				position.Y += height / 2;
				SoundEngine.PlaySound(SoundID.DD2_GoblinBomb, position);
				width = 22;
				height = 22;
				position.X -= width / 2;
				position.Y -= height / 2;
				for (int num115 = 0; num115 < 10; num115++)
				{
					int num116 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num116];
					dust2.velocity *= 1.4f;
					num116 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num116];
					dust2.velocity *= 1.4f;
					Main.dust[num116].noGravity = true;
					Main.dust[num116].fadeIn = 2f;
				}
				for (int num117 = 0; num117 < 10; num117++)
				{
					int num118 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
					Main.dust[num118].noGravity = true;
					Dust dust2 = Main.dust[num118];
					dust2.velocity *= 5f;
					num118 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num118];
					dust2.velocity *= 3f;
				}
				int num119 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num119];
				gore2.velocity *= 0.4f;
				Main.gore[num119].velocity.X += 1f;
				Main.gore[num119].velocity.Y += 1f;
				num119 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				gore2 = Main.gore[num119];
				gore2.velocity *= 0.4f;
				Main.gore[num119].velocity.X -= 1f;
				Main.gore[num119].velocity.Y += 1f;
				num119 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				gore2 = Main.gore[num119];
				gore2.velocity *= 0.4f;
				Main.gore[num119].velocity.X += 1f;
				Main.gore[num119].velocity.Y -= 1f;
				num119 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				gore2 = Main.gore[num119];
				gore2.velocity *= 0.4f;
				Main.gore[num119].velocity.X -= 1f;
				Main.gore[num119].velocity.Y -= 1f;
				position.X += width / 2;
				position.Y += height / 2;
				width = 80;
				height = 80;
				position.X -= width / 2;
				position.Y -= height / 2;
				Damage();
			}
			if (type == 669)
			{
				SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
				Vector2 vector24 = new Vector2(20f, 20f);
				for (int num120 = 0; num120 < 10; num120++)
				{
					Dust dust29 = Dust.NewDustDirect(base.Center - vector24 / 2f, (int)vector24.X, (int)vector24.Y, 4, 0f, 0f, 100, new Color(255, 255, 255, 110), 1.1f);
					Dust dust2 = dust29;
					dust2.velocity *= 1.4f;
				}
				for (int num121 = 0; num121 < 40; num121++)
				{
					Dust dust30 = Dust.NewDustDirect(base.Center - vector24 / 2f, (int)vector24.X, (int)vector24.Y, 4, 0f, 0f, 50, new Color(245, 200, 30, 155), 1.2f);
					dust30.noGravity = true;
					Dust dust2 = dust30;
					dust2.velocity *= 4f;
					dust30 = Dust.NewDustDirect(base.Center - vector24 / 2f, (int)vector24.X, (int)vector24.Y, 4, 0f, 0f, 50, new Color(245, 200, 30, 155), 0.8f);
					dust2 = dust30;
					dust2.velocity *= 2f;
				}
			}
			if (Main.myPlayer == owner && bobber)
			{
				PopupText.ClearSonarText();
				if (ai[1] > 0f && ai[1] < 5453f)
				{
					AI_061_FishingBobber_GiveItemToPlayer(Main.player[owner], (int)ai[1]);
				}
				ai[1] = 0f;
			}
			if (type == 634 || type == 635)
			{
				int num122 = Utils.SelectRandom<int>(Main.rand, 242, 73, 72, 71, 255);
				int num123 = 255;
				int num124 = 255;
				int num125 = 50;
				float num126 = 1.7f;
				float num127 = 0.8f;
				float num128 = 2f;
				Vector2 vector25 = (rotation - MathF.PI / 2f).ToRotationVector2();
				Vector2 vector26 = vector25 * velocity.Length() * MaxUpdates;
				if (type == 635)
				{
					num123 = 88;
					num124 = 88;
					num122 = Utils.SelectRandom<int>(Main.rand, 242, 59, 88);
					num126 = 3.7f;
					num127 = 1.5f;
					num128 = 2.2f;
					vector26 *= 0.5f;
				}
				SoundEngine.PlaySound(SoundID.Item14, position);
				position = base.Center;
				width = (height = num125);
				base.Center = position;
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				for (int num129 = 0; num129 < 40; num129++)
				{
					num122 = Utils.SelectRandom<int>(Main.rand, 242, 73, 72, 71, 255);
					if (type == 635)
					{
						num122 = Utils.SelectRandom<int>(Main.rand, 242, 59, 88);
					}
					int num130 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num122, 0f, 0f, 200, default(Color), num126);
					Main.dust[num130].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num130].noGravity = true;
					Dust dust2 = Main.dust[num130];
					dust2.velocity *= 3f;
					dust2 = Main.dust[num130];
					dust2.velocity += vector26 * Main.rand.NextFloat();
					num130 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num123, 0f, 0f, 100, default(Color), num127);
					Main.dust[num130].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					dust2 = Main.dust[num130];
					dust2.velocity *= 2f;
					Main.dust[num130].noGravity = true;
					Main.dust[num130].fadeIn = 1f;
					Main.dust[num130].color = Color.Crimson * 0.5f;
					dust2 = Main.dust[num130];
					dust2.velocity += vector26 * Main.rand.NextFloat();
				}
				for (int num131 = 0; num131 < 20; num131++)
				{
					int num132 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num124, 0f, 0f, 0, default(Color), num128);
					Main.dust[num132].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 3f;
					Main.dust[num132].noGravity = true;
					Dust dust2 = Main.dust[num132];
					dust2.velocity *= 0.5f;
					dust2 = Main.dust[num132];
					dust2.velocity += vector26 * (0.6f + 0.6f * Main.rand.NextFloat());
				}
			}
			else if (type == 651)
			{
				if (localAI[0] == 1f && owner == Main.myPlayer)
				{
					Player master = Main.player[owner];
					Point ps = new Vector2(ai[0], ai[1]).ToPoint();
					Point pe = base.Center.ToTileCoordinates();
					if (Main.netMode == 1)
					{
						NetMessage.SendData(109, -1, -1, null, ps.X, ps.Y, pe.X, pe.Y, (int)WiresUI.Settings.ToolMode);
					}
					else
					{
						Wiring.MassWireOperation(ps, pe, master);
					}
				}
			}
			else if (type == 641)
			{
				if (owner == Main.myPlayer)
				{
					for (int num133 = 0; num133 < 1000; num133++)
					{
						if (Main.projectile[num133].active && Main.projectile[num133].owner == owner && Main.projectile[num133].type == 642)
						{
							Main.projectile[num133].Kill();
						}
					}
				}
			}
			else if (type == 643)
			{
				if (owner == Main.myPlayer)
				{
					for (int num134 = 0; num134 < 1000; num134++)
					{
						if (Main.projectile[num134].active && Main.projectile[num134].owner == owner && Main.projectile[num134].type == 644)
						{
							Main.projectile[num134].Kill();
						}
					}
				}
			}
			else if (type == 645)
			{
				bool flag = WorldGen.SolidTile(Framing.GetTileSafely((int)position.X / 16, (int)position.Y / 16));
				for (int num135 = 0; num135 < 4; num135++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				for (int num136 = 0; num136 < 4; num136++)
				{
					int num137 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 0, default(Color), 2.5f);
					Main.dust[num137].noGravity = true;
					Dust dust2 = Main.dust[num137];
					dust2.velocity *= 3f;
					if (flag)
					{
						Main.dust[num137].noLight = true;
					}
					num137 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num137];
					dust2.velocity *= 2f;
					Main.dust[num137].noGravity = true;
					if (flag)
					{
						Main.dust[num137].noLight = true;
					}
				}
				for (int num138 = 0; num138 < 1; num138++)
				{
					int num139 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num139];
					gore2.velocity *= 0.3f;
					Main.gore[num139].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num139].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
			}
			else if (type == 636)
			{
				Rectangle hitbox2 = base.Hitbox;
				for (int num140 = 0; num140 < 6; num140 += 3)
				{
					hitbox2.X = (int)oldPos[num140].X;
					hitbox2.Y = (int)oldPos[num140].Y;
					for (int num141 = 0; num141 < 5; num141++)
					{
						int num142 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
						int num143 = Dust.NewDust(hitbox2.TopLeft(), width, height, num142, 2.5f * (float)direction, -2.5f);
						Main.dust[num143].alpha = 200;
						Dust dust2 = Main.dust[num143];
						dust2.velocity *= 2.4f;
						dust2 = Main.dust[num143];
						dust2.scale += Main.rand.NextFloat();
					}
				}
				if (Main.myPlayer == owner)
				{
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 953, damage, 10f, owner, 0f, 0.85f + Main.rand.NextFloat() * 1.15f);
				}
			}
			else if (type == 614)
			{
				for (int num144 = 0; num144 < 10; num144++)
				{
					Dust dust31 = Main.dust[Dust.NewDust(position, width, height, 229)];
					dust31.noGravity = true;
					Dust dust2 = dust31;
					dust2.velocity *= 3f;
				}
			}
			if (type == 644)
			{
				DoRainbowCrystalStaffExplosion();
				if (Main.myPlayer == owner)
				{
					friendly = true;
					int num145 = width;
					int num146 = height;
					int num147 = penetrate;
					position = base.Center;
					width = (height = 60);
					base.Center = position;
					penetrate = -1;
					maxPenetrate = -1;
					Damage();
					penetrate = num147;
					position = base.Center;
					width = num145;
					height = num146;
					base.Center = position;
				}
			}
			if (type == 608)
			{
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				SoundEngine.PlaySound(SoundID.Item14, position);
				for (int num148 = 0; num148 < 4; num148++)
				{
					int num149 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num149].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int num150 = 0; num150 < 30; num150++)
				{
					int num151 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 3.7f);
					Main.dust[num151].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num151].noGravity = true;
					Dust dust2 = Main.dust[num151];
					dust2.velocity *= 3f;
					Main.dust[num151].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].ArmorSetDye(), Main.player[owner]);
					num151 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num151].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					dust2 = Main.dust[num151];
					dust2.velocity *= 2f;
					Main.dust[num151].noGravity = true;
					Main.dust[num151].fadeIn = 2.5f;
					Main.dust[num151].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].ArmorSetDye(), Main.player[owner]);
				}
				for (int num152 = 0; num152 < 10; num152++)
				{
					int num153 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num153].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num153].noGravity = true;
					Dust dust2 = Main.dust[num153];
					dust2.velocity *= 3f;
					Main.dust[num153].shader = GameShaders.Armor.GetSecondaryShader(Main.player[owner].ArmorSetDye(), Main.player[owner]);
				}
				for (int num154 = 0; num154 < 10; num154++)
				{
					int num155 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num155].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num155].noGravity = true;
					Dust dust2 = Main.dust[num155];
					dust2.velocity *= 3f;
				}
				for (int num156 = 0; num156 < 2; num156++)
				{
					int num157 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num157].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Gore gore2 = Main.gore[num157];
					gore2.velocity *= 0.3f;
					Main.gore[num157].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num157].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
			}
			else if (type == 661)
			{
				position = base.Center;
				width = (height = 160);
				base.Center = position;
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				SoundEngine.PlaySound(SoundID.Item14, position);
				Vector2 vector27 = base.Center + Vector2.One * -20f;
				int num158 = 40;
				int num159 = num158;
				for (int num160 = 0; num160 < 4; num160++)
				{
					int num161 = Dust.NewDust(vector27, num158, num159, 240, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num161].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * num158 / 2f;
				}
				for (int num162 = 0; num162 < 20; num162++)
				{
					int num163 = Dust.NewDust(vector27, num158, num159, 62, 0f, 0f, 200, default(Color), 3.7f);
					Main.dust[num163].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * num158 / 2f;
					Main.dust[num163].noGravity = true;
					Main.dust[num163].noLight = true;
					Dust dust2 = Main.dust[num163];
					dust2.velocity *= 3f;
					dust2 = Main.dust[num163];
					dust2.velocity += DirectionTo(Main.dust[num163].position) * (2f + Main.rand.NextFloat() * 4f);
					num163 = Dust.NewDust(vector27, num158, num159, 62, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num163].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * num158 / 2f;
					dust2 = Main.dust[num163];
					dust2.velocity *= 2f;
					Main.dust[num163].noGravity = true;
					Main.dust[num163].fadeIn = 1f;
					Main.dust[num163].color = Color.Crimson * 0.5f;
					Main.dust[num163].noLight = true;
					dust2 = Main.dust[num163];
					dust2.velocity += DirectionTo(Main.dust[num163].position) * 8f;
				}
				for (int num164 = 0; num164 < 20; num164++)
				{
					int num165 = Dust.NewDust(vector27, num158, num159, 62, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num165].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * num158 / 2f;
					Main.dust[num165].noGravity = true;
					Main.dust[num165].noLight = true;
					Dust dust2 = Main.dust[num165];
					dust2.velocity *= 3f;
					dust2 = Main.dust[num165];
					dust2.velocity += DirectionTo(Main.dust[num165].position) * 2f;
				}
				for (int num166 = 0; num166 < 70; num166++)
				{
					int num167 = Dust.NewDust(vector27, num158, num159, 240, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num167].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * num158 / 2f;
					Main.dust[num167].noGravity = true;
					Dust dust2 = Main.dust[num167];
					dust2.velocity *= 3f;
					dust2 = Main.dust[num167];
					dust2.velocity += DirectionTo(Main.dust[num167].position) * 3f;
				}
			}
			else if (type == 617)
			{
				position = base.Center;
				width = (height = 176);
				base.Center = position;
				maxPenetrate = -1;
				penetrate = -1;
				Damage();
				SoundEngine.PlaySound(SoundID.Item14, position);
				for (int num168 = 0; num168 < 4; num168++)
				{
					int num169 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 240, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num169].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int num170 = 0; num170 < 30; num170++)
				{
					int num171 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 62, 0f, 0f, 200, default(Color), 3.7f);
					Main.dust[num171].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num171].noGravity = true;
					Dust dust2 = Main.dust[num171];
					dust2.velocity *= 3f;
					num171 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 90, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num171].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					dust2 = Main.dust[num171];
					dust2.velocity *= 2f;
					Main.dust[num171].noGravity = true;
					Main.dust[num171].fadeIn = 1f;
					Main.dust[num171].color = Color.Crimson * 0.5f;
				}
				for (int num172 = 0; num172 < 10; num172++)
				{
					int num173 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 62, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num173].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num173].noGravity = true;
					Dust dust2 = Main.dust[num173];
					dust2.velocity *= 3f;
				}
				for (int num174 = 0; num174 < 10; num174++)
				{
					int num175 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 240, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num175].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num175].noGravity = true;
					Dust dust2 = Main.dust[num175];
					dust2.velocity *= 3f;
				}
				for (int num176 = 0; num176 < 2; num176++)
				{
					int num177 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num177].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Gore gore2 = Main.gore[num177];
					gore2.velocity *= 0.3f;
					Main.gore[num177].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num177].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				if (Main.myPlayer == owner)
				{
					for (int num178 = 0; num178 < 1000; num178++)
					{
						if (Main.projectile[num178].active && Main.projectile[num178].type == 618 && Main.projectile[num178].ai[1] == (float)whoAmI)
						{
							Main.projectile[num178].Kill();
						}
					}
					int num179 = Main.rand.Next(5, 9);
					int num180 = Main.rand.Next(5, 9);
					int num181 = Utils.SelectRandom<int>(Main.rand, 86, 90);
					int num182 = ((num181 == 86) ? 90 : 86);
					for (int num183 = 0; num183 < num179; num183++)
					{
						Vector2 vector28 = base.Center + Utils.RandomVector2(Main.rand, -30f, 30f);
						Vector2 vector29 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						while (vector29.X == 0f && vector29.Y == 0f)
						{
							vector29 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						}
						vector29.Normalize();
						if (vector29.Y > 0.2f)
						{
							vector29.Y *= -1f;
						}
						vector29 *= (float)Main.rand.Next(70, 101) * 0.1f;
						NewProjectile(GetProjectileSource_FromThis(), vector28.X, vector28.Y, vector29.X, vector29.Y, 620, (int)((double)damage * 0.65), knockBack * 0.8f, owner, num181);
					}
					for (int num184 = 0; num184 < num180; num184++)
					{
						Vector2 vector30 = base.Center + Utils.RandomVector2(Main.rand, -30f, 30f);
						Vector2 vector31 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						while (vector31.X == 0f && vector31.Y == 0f)
						{
							vector31 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						}
						vector31.Normalize();
						if (vector31.Y > 0.4f)
						{
							vector31.Y *= -1f;
						}
						vector31 *= (float)Main.rand.Next(40, 81) * 0.1f;
						NewProjectile(GetProjectileSource_FromThis(), vector30.X, vector30.Y, vector31.X, vector31.Y, 620, (int)((double)damage * 0.65), knockBack * 0.8f, owner, num182);
					}
				}
			}
			else if (type == 658)
			{
				for (int num185 = 0; num185 < 10; num185++)
				{
					int num186 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 269, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
					Dust dust2;
					if (Main.rand.Next(3) == 0)
					{
						Main.dust[num186].fadeIn = 0.75f + (float)Main.rand.Next(-10, 11) * 0.01f;
						Main.dust[num186].scale = 0.25f + (float)Main.rand.Next(-10, 11) * 0.005f;
						dust2 = Main.dust[num186];
						dust2.type++;
					}
					else
					{
						Main.dust[num186].scale = 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
					}
					Main.dust[num186].noGravity = true;
					dust2 = Main.dust[num186];
					dust2.velocity *= 1.25f;
					dust2 = Main.dust[num186];
					dust2.velocity -= oldVelocity / 10f;
				}
			}
			else if (type == 620 || type == 618)
			{
				if (type == 618)
				{
					ai[0] = 86f;
				}
				for (int num187 = 0; num187 < 10; num187++)
				{
					int num188 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, (int)ai[0], velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
					Dust dust2;
					if (Main.rand.Next(3) == 0)
					{
						Main.dust[num188].fadeIn = 0.75f + (float)Main.rand.Next(-10, 11) * 0.01f;
						Main.dust[num188].scale = 0.25f + (float)Main.rand.Next(-10, 11) * 0.005f;
						dust2 = Main.dust[num188];
						dust2.type++;
					}
					else
					{
						Main.dust[num188].scale = 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
					}
					Main.dust[num188].noGravity = true;
					dust2 = Main.dust[num188];
					dust2.velocity *= 1.25f;
					dust2 = Main.dust[num188];
					dust2.velocity -= oldVelocity / 10f;
				}
			}
			else if (type == 619)
			{
				SoundEngine.PlaySound(SoundID.Item50, position);
				for (int num189 = 0; num189 < 20; num189++)
				{
					int num190 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, (int)ai[0], velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
					Dust dust2;
					if (Main.rand.Next(3) == 0)
					{
						Main.dust[num190].fadeIn = 1.1f + (float)Main.rand.Next(-10, 11) * 0.01f;
						Main.dust[num190].scale = 0.35f + (float)Main.rand.Next(-10, 11) * 0.01f;
						dust2 = Main.dust[num190];
						dust2.type++;
					}
					else
					{
						Main.dust[num190].scale = 1.2f + (float)Main.rand.Next(-10, 11) * 0.01f;
					}
					Main.dust[num190].noGravity = true;
					dust2 = Main.dust[num190];
					dust2.velocity *= 2.5f;
					dust2 = Main.dust[num190];
					dust2.velocity -= oldVelocity / 10f;
				}
				if (Main.myPlayer == owner)
				{
					int num191 = Main.rand.Next(3, 6);
					for (int num192 = 0; num192 < num191; num192++)
					{
						Vector2 vector32 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						while (vector32.X == 0f && vector32.Y == 0f)
						{
							vector32 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						}
						vector32.Normalize();
						vector32 *= (float)Main.rand.Next(70, 101) * 0.1f;
						NewProjectile(GetProjectileSource_FromThis(), oldPosition.X + (float)(width / 2), oldPosition.Y + (float)(height / 2), vector32.X, vector32.Y, 620, (int)((double)damage * 0.8), knockBack * 0.8f, owner, ai[0]);
					}
				}
			}
			if (type == 601)
			{
				Color portalColor = PortalHelper.GetPortalColor(owner, (int)ai[0]);
				Color color = portalColor;
				color.A = byte.MaxValue;
				for (int num193 = 0; num193 < 6; num193++)
				{
					Vector2 vector33 = Vector2.UnitY.RotatedByRandom(6.2831854820251465) * (3f * Main.rand.NextFloat());
					Dust dust32 = Main.dust[Dust.NewDust(base.Center, 0, 0, 263)];
					dust32.position = base.Center;
					dust32.velocity = vector33 + velocity / 5f;
					dust32.color = color;
					dust32.scale = 2f;
					dust32.noLight = true;
					dust32.noGravity = true;
				}
			}
			if (type == 596)
			{
				position = base.Center;
				width = (height = 60);
				base.Center = position;
				int num194 = 30;
				if (Main.expertMode)
				{
					num194 = 22;
				}
				damage = num194;
				Damage();
				SoundEngine.PlaySound(SoundID.Item14, position);
				for (int num195 = 0; num195 < 4; num195++)
				{
					int num196 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num196].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int num197 = 0; num197 < 20; num197++)
				{
					int num198 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 0, default(Color), 2.5f);
					Main.dust[num198].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num198].noGravity = true;
					Dust dust2 = Main.dust[num198];
					dust2.velocity *= 2f;
				}
				for (int num199 = 0; num199 < 10; num199++)
				{
					int num200 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num200].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num200].noGravity = true;
					Dust dust2 = Main.dust[num200];
					dust2.velocity *= 2f;
				}
			}
			if (type == 659)
			{
				if (ai[0] >= 0f)
				{
					int num201 = 80;
					position = base.Center;
					width = (height = num201);
					base.Center = position;
					Damage();
					SoundEngine.PlaySound(SoundID.Item14, position);
					int num202 = 15;
					int num203 = num202 + 15;
					for (int num204 = 0; num204 < num203; num204++)
					{
						int num205 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 0, default(Color), 2f + Main.rand.NextFloat() * 0.5f);
						Main.dust[num205].noGravity = true;
						if (num204 < num202)
						{
							float num206 = (float)(num204 + 1) / (float)num202 * (MathF.PI * 2f);
							Main.dust[num205].fadeIn = 1.5f + Main.rand.NextFloat() * 0.5f;
							Main.dust[num205].position = base.Center;
							Main.dust[num205].velocity = Vector2.UnitY.RotatedBy(num206) * (5f + Main.rand.NextFloat() * 1.5f);
						}
						else
						{
							Main.dust[num205].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * Main.rand.NextFloat() * width / 3f;
							Main.dust[num205].fadeIn = 0.5f + Main.rand.NextFloat() * 0.5f;
							Dust dust2 = Main.dust[num205];
							dust2.velocity *= 2f;
						}
					}
					for (int num207 = 0; num207 < 10; num207++)
					{
						int num208 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
						Main.dust[num208].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 3f;
						Main.dust[num208].fadeIn = 0.5f + Main.rand.NextFloat() * 0.5f;
						Main.dust[num208].noGravity = true;
						Dust dust2 = Main.dust[num208];
						dust2.velocity *= 1.5f;
					}
				}
			}
			else if (type >= 625 && type <= 628)
			{
				for (int num209 = 0; num209 < 6; num209++)
				{
					int num210 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num210].noGravity = true;
					Main.dust[num210].noLight = true;
				}
			}
			if (type == 631)
			{
				int num211 = Main.rand.Next(5, 10);
				for (int num212 = 0; num212 < num211; num212++)
				{
					int num213 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100);
					Dust dust2 = Main.dust[num213];
					dust2.velocity *= 1.6f;
					Main.dust[num213].velocity.Y -= 1f;
					dust2 = Main.dust[num213];
					dust2.position -= Vector2.One * 4f;
					Main.dust[num213].position = Vector2.Lerp(Main.dust[num213].position, base.Center, 0.5f);
					Main.dust[num213].noGravity = true;
				}
			}
			if (type == 539)
			{
				position = base.Center;
				width = (height = 80);
				base.Center = position;
				Damage();
				SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 7);
				for (int num214 = 0; num214 < 4; num214++)
				{
					int num215 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num215].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int num216 = 0; num216 < 20; num216++)
				{
					int num217 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 176, 0f, 0f, 200, default(Color), 3.7f);
					Main.dust[num217].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num217].noGravity = true;
					Dust dust2 = Main.dust[num217];
					dust2.velocity *= 3f;
				}
				for (int num218 = 0; num218 < 20; num218++)
				{
					int num219 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 180, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num219].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num219].noGravity = true;
					Dust dust2 = Main.dust[num219];
					dust2.velocity *= 3f;
				}
				for (int num220 = 0; num220 < 10; num220++)
				{
					int num221 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num221].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num221].noGravity = true;
					Dust dust2 = Main.dust[num221];
					dust2.velocity *= 3f;
				}
			}
			else if (type == 585)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y, 27);
				for (int num222 = 0; num222 < 20; num222++)
				{
					int num223 = Dust.NewDust(position, width, height, 26, 0f, 0f, 100);
					Main.dust[num223].noGravity = true;
					Dust dust2 = Main.dust[num223];
					dust2.velocity *= 1.2f;
					Main.dust[num223].scale = 1.3f;
					dust2 = Main.dust[num223];
					dust2.velocity -= oldVelocity * 0.3f;
					num223 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 27, 0f, 0f, 100, default(Color), 2f);
					Main.dust[num223].noGravity = true;
					dust2 = Main.dust[num223];
					dust2.velocity *= 3f;
				}
			}
			else if (type == 590)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y, 27);
				int num224 = 165;
				if (ai[2] == 1f)
				{
					num224 = 31;
				}
				for (int num225 = 0; num225 < 10; num225++)
				{
					int num226 = Dust.NewDust(position, width, height, num224, 0f, 0f, 50, default(Color), 1.5f);
					Dust dust2 = Main.dust[num226];
					dust2.velocity *= 2f;
					Main.dust[num226].noGravity = true;
				}
				float num227 = 0.6f + Main.rand.NextFloat() * 0.4f;
				int num228 = 375;
				if (ai[2] == 1f)
				{
					num228 = 61;
				}
				int num229 = Gore.NewGore(position, Vector2.Zero, num228, num227);
				Gore gore2 = Main.gore[num229];
				gore2.velocity *= 0.3f;
				num229 = Gore.NewGore(position, Vector2.Zero, num228 + 1, num227);
				gore2 = Main.gore[num229];
				gore2.velocity *= 0.3f;
				num229 = Gore.NewGore(position, Vector2.Zero, num228 + 2, num227);
				gore2 = Main.gore[num229];
				gore2.velocity *= 0.3f;
			}
			else if (type == 587)
			{
				Color newColor5 = Main.hslToRgb(ai[1], 1f, 0.5f);
				newColor5.A = 200;
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num230 = 0; num230 < 10; num230++)
				{
					int num231 = Dust.NewDust(position, width, height, 76, 0f, 0f, 0, newColor5);
					Main.dust[num231].noGravity = true;
					Dust dust2 = Main.dust[num231];
					dust2.velocity *= 1.2f;
					Main.dust[num231].scale = 0.9f;
					dust2 = Main.dust[num231];
					dust2.velocity -= oldVelocity * 0.3f;
					num231 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 76, 0f, 0f, 0, newColor5, 1.1f);
					Main.dust[num231].noGravity = true;
					dust2 = Main.dust[num231];
					dust2.velocity *= 2f;
				}
			}
			else if (type == 572)
			{
				for (int num232 = 0; num232 < 15; num232++)
				{
					int num233 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 40, velocity.X * 0.1f, velocity.Y * 0.1f, 100);
					Dust dust2 = Main.dust[num233];
					dust2.velocity *= 3f;
					Main.dust[num233].noGravity = true;
					Main.dust[num233].scale = 1.25f;
					Main.dust[num233].position = (base.Center + position) / 2f;
				}
			}
			else if (type == 581)
			{
				for (int num234 = 0; num234 < 30; num234++)
				{
					int num235 = Utils.SelectRandom<int>(Main.rand, 229, 229, 161);
					Dust dust33 = Main.dust[Dust.NewDust(position, width, height, num235)];
					dust33.noGravity = true;
					dust33.scale = 1.25f + Main.rand.NextFloat();
					dust33.fadeIn = 0.25f;
					Dust dust2 = dust33;
					dust2.velocity *= 2f;
					dust33.noLight = true;
				}
			}
			else if (type == 671)
			{
				for (int num236 = 0; num236 < 30; num236++)
				{
					int num237 = Utils.SelectRandom<int>(Main.rand, 27, 27, 62);
					Dust dust34 = Main.dust[Dust.NewDust(position, width, height, num237)];
					dust34.noGravity = true;
					dust34.scale = 1.25f + Main.rand.NextFloat();
					dust34.fadeIn = 0.25f;
					Dust dust2 = dust34;
					dust2.velocity *= 2f;
					dust34.noLight = true;
				}
			}
			else if (type == 811 || type == 814)
			{
				for (int num238 = 0; num238 < 30; num238++)
				{
					Dust dust35 = Main.dust[Dust.NewDust(position, width, height, 5)];
					dust35.scale = 1.25f + Main.rand.NextFloat();
					Dust dust2 = dust35;
					dust2.velocity *= 2f;
				}
			}
			else if (type == 819)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num239 = 0; num239 < 20; num239++)
				{
					Dust dust36 = Main.dust[Dust.NewDust(position, width, height, 5)];
					dust36.scale = 1f + Main.rand.NextFloat() * 0.5f;
					Dust dust2 = dust36;
					dust2.velocity *= 1.5f;
				}
			}
			else if (type == 675)
			{
				for (int num240 = 0; num240 < 40; num240++)
				{
					int num241 = Utils.SelectRandom<int>(Main.rand, 27, 242, 73, 72, 71, 255, 255, 255);
					Dust dust37 = Main.dust[Dust.NewDust(position, width, height, num241)];
					dust37.noGravity = true;
					dust37.scale = 1.25f + Main.rand.NextFloat();
					dust37.fadeIn = 0.25f;
					Dust dust2 = dust37;
					dust2.velocity *= 3f;
					dust37.noLight = true;
				}
			}
			else if (type == 676)
			{
				for (int num242 = 0; num242 < 120; num242++)
				{
					int num243 = Utils.SelectRandom<int>(Main.rand, 4, 256);
					Dust dust38 = Main.dust[Dust.NewDust(position, width, height, num243, 0f, 0f, 100)];
					dust38.scale = 0.8f + Main.rand.NextFloat() * 0.6f;
					dust38.fadeIn = 0.5f;
					Dust dust2 = dust38;
					dust2.velocity *= 4.5f;
					dust38.noLight = true;
					if (dust38.velocity.Y > 0f)
					{
						dust2 = dust38;
						dust2.velocity *= -0.5f;
					}
					if (dust38.type == 4)
					{
						dust38.color = new Color(80, 170, 40, 120);
					}
				}
				for (int num244 = 0; num244 < 10; num244++)
				{
					Gore.NewGoreDirect(base.Center, new Vector2(MathHelper.Lerp(-5f, 5f, Main.rand.NextFloat()), (0f - Main.rand.NextFloat()) * 5f), 1024);
				}
				for (int num245 = 0; num245 < 10; num245++)
				{
					Gore.NewGoreDirect(base.Center, new Vector2(MathHelper.Lerp(-5f, 5f, Main.rand.NextFloat()), (0f - Main.rand.NextFloat()) * 5f), 1025);
				}
				for (int num246 = 0; num246 < 10; num246++)
				{
					Gore.NewGoreDirect(base.Center, new Vector2(MathHelper.Lerp(-5f, 5f, Main.rand.NextFloat()), (0f - Main.rand.NextFloat()) * 5f), 1026);
				}
				for (int num247 = 0; num247 < 20; num247++)
				{
					Gore.NewGoreDirect(base.Center, new Vector2(MathHelper.Lerp(-0.5f, 0.5f, Main.rand.NextFloat()), (0f - Main.rand.NextFloat()) * 2f), 1026);
				}
				if (Main.netMode != 2)
				{
					Player player = Main.player[Main.myPlayer];
					if (!player.dead && player.active && (player.Center - base.Center).Length() < 300f && !player.creativeGodMode)
					{
						player.AddBuff(197, 900, quiet: false);
					}
				}
			}
			else if (type == 686)
			{
				Rectangle hitbox3 = base.Hitbox;
				for (int num248 = 0; num248 < oldPos.Length / 2; num248 += 2)
				{
					hitbox3.X = (int)oldPos[num248].X;
					hitbox3.Y = (int)oldPos[num248].Y;
					for (int num249 = 0; num249 < 3; num249++)
					{
						int num250 = Utils.SelectRandom<int>(Main.rand, 6, 55, 158);
						int num251 = Dust.NewDust(hitbox3.TopLeft(), width, height, num250, direction, -2.5f);
						Main.dust[num251].alpha = 200;
						Dust dust2 = Main.dust[num251];
						dust2.velocity *= 2.4f;
						dust2 = Main.dust[num251];
						dust2.scale += Main.rand.NextFloat();
						dust2 = Main.dust[num251];
						dust2.scale -= 0.5f;
						if (Main.dust[num251].type == 55)
						{
							Main.dust[num251].color = Color.Lerp(Color.Red, Color.Gold, Main.rand.NextFloat());
						}
						Main.dust[num251].noLight = true;
					}
				}
				for (int num252 = 10; num252 < oldPos.Length; num252 += 2)
				{
					hitbox3.X = (int)oldPos[num252].X;
					hitbox3.Y = (int)oldPos[num252].Y;
					for (int num253 = 0; num253 < 2; num253++)
					{
						int num254 = Utils.SelectRandom<int>(Main.rand, 55);
						int num255 = Dust.NewDust(hitbox3.TopLeft(), width, height, num254, direction, -2.5f);
						Main.dust[num255].alpha = 120;
						Dust dust2 = Main.dust[num255];
						dust2.velocity *= 2.4f;
						dust2 = Main.dust[num255];
						dust2.scale += Main.rand.NextFloat() * 0.7f;
						dust2 = Main.dust[num255];
						dust2.scale -= 0.5f;
						if (Main.dust[num255].type == 55)
						{
							Main.dust[num255].color = Color.Lerp(Color.Purple, Color.Black, Main.rand.NextFloat());
						}
						Main.dust[num255].noLight = true;
					}
				}
				for (int num256 = 5; num256 < oldPos.Length; num256++)
				{
					hitbox3.X = (int)oldPos[num256].X;
					hitbox3.Y = (int)oldPos[num256].Y;
					for (int num257 = 0; num257 < 1; num257++)
					{
						int num258 = Utils.SelectRandom<int>(Main.rand, 55);
						int num259 = Dust.NewDust(hitbox3.TopLeft(), width, height, num258, direction, -2.5f);
						Main.dust[num259].alpha = 80;
						Dust dust2 = Main.dust[num259];
						dust2.velocity *= 0.3f;
						dust2 = Main.dust[num259];
						dust2.velocity += velocity * 0.5f;
						dust2 = Main.dust[num259];
						dust2.scale += Main.rand.NextFloat() * 0.7f;
						dust2 = Main.dust[num259];
						dust2.scale -= 0.5f;
						if (Main.dust[num259].type == 55)
						{
							Main.dust[num259].color = Color.Lerp(Color.Purple, Color.Black, Main.rand.NextFloat());
						}
						Main.dust[num259].noLight = true;
					}
				}
				for (int num260 = 0; num260 < 30; num260++)
				{
					int num261 = 228;
					Dust dust39 = Main.dust[Dust.NewDust(position, width, height, num261)];
					dust39.noGravity = true;
					dust39.scale = 1.25f + Main.rand.NextFloat();
					dust39.fadeIn = 1.5f;
					Dust dust2 = dust39;
					dust2.velocity *= 6f;
					dust39.noLight = true;
				}
			}
			if (type == 405)
			{
				SoundEngine.PlaySound(SoundID.Item54, position);
				_ = base.Center;
				for (int num262 = 0; num262 < 20; num262++)
				{
					int num263 = 10;
					int num264 = Dust.NewDust(base.Center - Vector2.One * num263, num263 * 2, num263 * 2, 212);
					Dust dust40 = Main.dust[num264];
					Vector2 vector34 = Vector2.Normalize(dust40.position - base.Center);
					dust40.position = base.Center + vector34 * num263 * scale;
					if (num262 < 30)
					{
						dust40.velocity = vector34 * dust40.velocity.Length();
					}
					else
					{
						dust40.velocity = vector34 * Main.rand.Next(45, 91) / 10f;
					}
					dust40.color = Main.hslToRgb((float)(0.4000000059604645 + Main.rand.NextDouble() * 0.20000000298023224), 0.9f, 0.5f);
					dust40.color = Color.Lerp(dust40.color, Color.White, 0.3f);
					dust40.noGravity = true;
					dust40.scale = 0.7f;
				}
			}
			if (type == 501)
			{
				SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
				int num265 = 20;
				position.X -= num265;
				position.Y -= num265;
				width += num265 * 2;
				height += num265 * 2;
				num265 += 20;
				for (int num266 = 0; num266 < 20; num266++)
				{
					int num267 = Dust.NewDust(position, width, height, 188, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num267];
					dust2.velocity *= 0.5f;
				}
				for (int num268 = 0; num268 < 5; num268++)
				{
					int num269 = Gore.NewGore(new Vector2(position.X + (float)Main.rand.Next(width), position.Y + (float)Main.rand.Next(height)), default(Vector2), Main.rand.Next(435, 438));
					Gore gore2 = Main.gore[num269];
					gore2.velocity *= 0.5f;
					switch (num268)
					{
					case 0:
						Main.gore[num269].velocity.X += 1f;
						Main.gore[num269].velocity.Y += 1f;
						break;
					case 1:
						Main.gore[num269].velocity.X -= 1f;
						Main.gore[num269].velocity.Y += 1f;
						break;
					case 2:
						Main.gore[num269].velocity.X += 1f;
						Main.gore[num269].velocity.Y -= 1f;
						break;
					default:
						Main.gore[num269].velocity.X -= 1f;
						Main.gore[num269].velocity.Y -= 1f;
						break;
					}
					gore2 = Main.gore[num269];
					gore2.velocity *= 0.5f;
				}
				position.X -= num265;
				position.Y -= num265;
				width += num265 * 2;
				height += num265 * 2;
				Damage();
			}
			if (type == 410)
			{
				SoundEngine.PlaySound(SoundID.Item54, position);
				_ = base.Center;
				for (int num270 = 0; num270 < 10; num270++)
				{
					int num271 = (int)(10f * ai[1]);
					int num272 = Dust.NewDust(base.Center - Vector2.One * num271, num271 * 2, num271 * 2, 212);
					Dust dust41 = Main.dust[num272];
					Vector2 vector35 = Vector2.Normalize(dust41.position - base.Center);
					dust41.position = base.Center + vector35 * num271 * scale;
					if (num270 < 30)
					{
						dust41.velocity = vector35 * dust41.velocity.Length();
					}
					else
					{
						dust41.velocity = vector35 * Main.rand.Next(45, 91) / 10f;
					}
					dust41.color = Main.hslToRgb((float)(0.4000000059604645 + Main.rand.NextDouble() * 0.20000000298023224), 0.9f, 0.5f);
					dust41.color = Color.Lerp(dust41.color, Color.White, 0.3f);
					dust41.noGravity = true;
					dust41.scale = 0.7f;
				}
			}
			if (type == 629 && Main.netMode != 1)
			{
				switch (Main.npc[(int)ai[0]].type)
				{
				case 517:
					if (NPC.ShieldStrengthTowerSolar != 0)
					{
						Main.npc[(int)ai[0]].ai[3] = 1f;
					}
					NPC.ShieldStrengthTowerSolar = (int)MathHelper.Clamp(NPC.ShieldStrengthTowerSolar - 1, 0f, NPC.ShieldStrengthTowerMax);
					break;
				case 422:
					if (NPC.ShieldStrengthTowerVortex != 0)
					{
						Main.npc[(int)ai[0]].ai[3] = 1f;
					}
					NPC.ShieldStrengthTowerVortex = (int)MathHelper.Clamp(NPC.ShieldStrengthTowerVortex - 1, 0f, NPC.ShieldStrengthTowerMax);
					break;
				case 507:
					if (NPC.ShieldStrengthTowerNebula != 0)
					{
						Main.npc[(int)ai[0]].ai[3] = 1f;
					}
					NPC.ShieldStrengthTowerNebula = (int)MathHelper.Clamp(NPC.ShieldStrengthTowerNebula - 1, 0f, NPC.ShieldStrengthTowerMax);
					break;
				case 493:
					if (NPC.ShieldStrengthTowerStardust != 0)
					{
						Main.npc[(int)ai[0]].ai[3] = 1f;
					}
					NPC.ShieldStrengthTowerStardust = (int)MathHelper.Clamp(NPC.ShieldStrengthTowerStardust - 1, 0f, NPC.ShieldStrengthTowerMax);
					break;
				}
				Main.npc[(int)ai[0]].netUpdate = true;
				NetMessage.SendData(101);
			}
			if (aiStyle == 105 && owner == Main.myPlayer && ai[1] == 0f)
			{
				Vector2 vector36 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
				vector36.Normalize();
				vector36 *= 0.3f;
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector36.X, vector36.Y, Main.rand.Next(569, 572), damage, 0f, owner);
			}
			if (type == 452)
			{
				SoundEngine.PlaySound(29, (int)position.X, (int)position.Y, 103);
				position = base.Center;
				width = (height = 144);
				position.X -= width / 2;
				position.Y -= height / 2;
				for (int num273 = 0; num273 < 4; num273++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				for (int num274 = 0; num274 < 40; num274++)
				{
					int num275 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 0, default(Color), 2.5f);
					Main.dust[num275].noGravity = true;
					Dust dust2 = Main.dust[num275];
					dust2.velocity *= 3f;
					num275 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num275];
					dust2.velocity *= 2f;
					Main.dust[num275].noGravity = true;
				}
				for (int num276 = 0; num276 < 1; num276++)
				{
					int num277 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num277];
					gore2.velocity *= 0.3f;
					Main.gore[num277].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num277].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				Damage();
			}
			if (type == 454)
			{
				SoundEngine.PlaySound(4, (int)position.X, (int)position.Y, 6);
				position = base.Center;
				width = (height = 208);
				position.X -= width / 2;
				position.Y -= height / 2;
				for (int num278 = 0; num278 < 7; num278++)
				{
					int num279 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num279].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
				}
				for (int num280 = 0; num280 < 60; num280++)
				{
					int num281 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 0, default(Color), 2.5f);
					Main.dust[num281].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
					Main.dust[num281].noGravity = true;
					Dust dust2 = Main.dust[num281];
					dust2.velocity *= 1f;
					num281 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num281].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
					dust2 = Main.dust[num281];
					dust2.velocity *= 1f;
					Main.dust[num281].noGravity = true;
				}
				for (int num282 = 0; num282 < 3; num282++)
				{
					int num283 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num283];
					gore2.velocity *= 0.3f;
					Main.gore[num283].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num283].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				Damage();
			}
			if (type == 467)
			{
				position = base.Center;
				width = (height = 176);
				base.Center = position;
				Damage();
				SoundEngine.PlaySound(SoundID.Item14, position);
				for (int num284 = 0; num284 < 4; num284++)
				{
					int num285 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num285].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int num286 = 0; num286 < 30; num286++)
				{
					int num287 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 200, default(Color), 3.7f);
					Main.dust[num287].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num287].noGravity = true;
					Dust dust2 = Main.dust[num287];
					dust2.velocity *= 3f;
					num287 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num287].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					dust2 = Main.dust[num287];
					dust2.velocity *= 2f;
					Main.dust[num287].noGravity = true;
					Main.dust[num287].fadeIn = 2.5f;
				}
				for (int num288 = 0; num288 < 10; num288++)
				{
					int num289 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num289].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num289].noGravity = true;
					Dust dust2 = Main.dust[num289];
					dust2.velocity *= 3f;
				}
				for (int num290 = 0; num290 < 10; num290++)
				{
					int num291 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num291].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num291].noGravity = true;
					Dust dust2 = Main.dust[num291];
					dust2.velocity *= 3f;
				}
				for (int num292 = 0; num292 < 2; num292++)
				{
					int num293 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num293].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Gore gore2 = Main.gore[num293];
					gore2.velocity *= 0.3f;
					Main.gore[num293].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num293].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
			}
			if (type == 468)
			{
				position = base.Center;
				width = (height = 176);
				base.Center = position;
				Damage();
				SoundEngine.PlaySound(SoundID.Item14, position);
				for (int num294 = 0; num294 < 4; num294++)
				{
					int num295 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num295].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
				}
				for (int num296 = 0; num296 < 20; num296++)
				{
					int num297 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 200, default(Color), 3.7f);
					Main.dust[num297].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Main.dust[num297].noGravity = true;
					Dust dust2 = Main.dust[num297];
					dust2.velocity *= 3f;
					num297 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num297].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					dust2 = Main.dust[num297];
					dust2.velocity *= 2f;
					Main.dust[num297].noGravity = true;
					Main.dust[num297].fadeIn = 2.5f;
				}
				for (int num298 = 0; num298 < 10; num298++)
				{
					int num299 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, 0f, 0f, 0, default(Color), 2.7f);
					Main.dust[num299].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num299].noGravity = true;
					Dust dust2 = Main.dust[num299];
					dust2.velocity *= 3f;
				}
				for (int num300 = 0; num300 < 10; num300++)
				{
					int num301 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num301].position = base.Center + Vector2.UnitX.RotatedByRandom(3.1415927410125732).RotatedBy(velocity.ToRotation()) * width / 2f;
					Main.dust[num301].noGravity = true;
					Dust dust2 = Main.dust[num301];
					dust2.velocity *= 3f;
				}
				for (int num302 = 0; num302 < 2; num302++)
				{
					int num303 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Main.gore[num303].position = base.Center + Vector2.UnitY.RotatedByRandom(3.1415927410125732) * (float)Main.rand.NextDouble() * width / 2f;
					Gore gore2 = Main.gore[num303];
					gore2.velocity *= 0.3f;
					Main.gore[num303].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num303].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
			}
			if (type == 485)
			{
				for (int num304 = 0; num304 < 15; num304++)
				{
					int num305 = Dust.NewDust(position, width, height, 6);
					Main.dust[num305].noGravity = true;
					Dust dust2 = Main.dust[num305];
					dust2.velocity -= oldVelocity * Main.rand.Next(20, 60) * 0.01f;
				}
			}
			else if (type == 484)
			{
				for (int num306 = 0; num306 < 5; num306++)
				{
					int num307 = Dust.NewDust(position, width, height, 78);
					Main.dust[num307].noGravity = true;
					Dust dust2 = Main.dust[num307];
					dust2.velocity -= oldVelocity / 5f;
					Main.dust[num307].scale = 0.85f;
				}
			}
			else if (type == 483)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
				if (owner == Main.myPlayer)
				{
					int num308 = Main.rand.Next(4, 8);
					int[] array = new int[num308];
					int num309 = 0;
					for (int num310 = 0; num310 < 200; num310++)
					{
						if (!Main.npc[num310].CanBeChasedBy(this, ignoreDontTakeDamage: true))
						{
							continue;
						}
						float num311 = Distance(Main.npc[num310].Center);
						if (!(num311 > 2000f) && Collision.CanHitLine(position, width, height, Main.npc[num310].position, Main.npc[num310].width, Main.npc[num310].height))
						{
							array[num309] = num310;
							num309++;
							if (num309 == num308)
							{
								break;
							}
						}
					}
					if (num309 > 1)
					{
						for (int num312 = 0; num312 < 100; num312++)
						{
							int num313 = Main.rand.Next(num309);
							int num314;
							for (num314 = num313; num314 == num313; num314 = Main.rand.Next(num309))
							{
							}
							int num315 = array[num313];
							array[num313] = array[num314];
							array[num314] = num315;
						}
					}
					Vector2 vector37 = new Vector2(-1f, -1f);
					for (int num316 = 0; num316 < num309; num316++)
					{
						Vector2 vector38 = Main.npc[array[num316]].Center - base.Center;
						vector38.Normalize();
						vector37 += vector38;
					}
					vector37.Normalize();
					for (int num317 = 0; num317 < num308; num317++)
					{
						float num318 = Main.rand.Next(8, 15);
						Vector2 vector39 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						vector39.Normalize();
						if (num309 > 0)
						{
							vector39 += vector37;
							vector39.Normalize();
						}
						vector39 *= num318;
						if (num309 > 0)
						{
							num309--;
							vector39 = Main.npc[array[num309]].Center - base.Center;
							vector39.Normalize();
							vector39 *= num318;
						}
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector39.X, vector39.Y, 484, (int)((double)damage * 0.7), knockBack * 0.7f, owner);
					}
				}
				for (int num319 = 0; num319 < 20; num319++)
				{
					int num320 = Dust.NewDust(position, width, height, 78);
					Main.dust[num320].noGravity = true;
					Dust dust2 = Main.dust[num320];
					dust2.velocity *= 4f;
				}
				for (int num321 = 0; num321 < 7; num321++)
				{
					int num322 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num322];
					dust2.velocity *= 0.9f;
					Main.dust[num322].scale = 0.9f;
				}
				for (int num323 = 0; num323 < 3; num323++)
				{
					int num324 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
					Main.dust[num324].noGravity = true;
					Dust dust2 = Main.dust[num324];
					dust2.velocity *= 3f;
					num324 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num324];
					dust2.velocity *= 2f;
				}
				int num325 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
				Gore gore2 = Main.gore[num325];
				gore2.velocity *= 0.3f;
				Main.gore[num325].velocity.X += Main.rand.Next(-1, 2);
				Main.gore[num325].velocity.Y += Main.rand.Next(-1, 2);
				if (owner == Main.myPlayer)
				{
					int num326 = 100;
					position.X -= num326 / 2;
					position.Y -= num326 / 2;
					width += num326;
					height++;
					penetrate = -1;
					Damage();
				}
			}
			if (type == 523)
			{
				SoundEngine.PlaySound(SoundID.Item54, position);
				for (int num327 = 0; num327 < 25; num327++)
				{
					int num328 = Dust.NewDust(position, width, height, 256);
					Main.dust[num328].noGravity = true;
					Main.dust[num328].position = (Main.dust[num328].position + position) / 2f;
					Main.dust[num328].velocity = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
					Main.dust[num328].velocity.Normalize();
					Dust dust2 = Main.dust[num328];
					dust2.velocity *= (float)Main.rand.Next(1, 30) * 0.1f;
					Main.dust[num328].alpha = alpha;
				}
			}
			else if (type == 522)
			{
				SoundEngine.PlaySound(SoundID.Item118, position);
				for (int num329 = 0; num329 < 10; num329++)
				{
					int num330 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 254, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
					Dust dust2;
					if (Main.rand.Next(3) == 0)
					{
						Main.dust[num330].fadeIn = 0.75f + (float)Main.rand.Next(-10, 11) * 0.01f;
						Main.dust[num330].scale = 0.25f + (float)Main.rand.Next(-10, 11) * 0.005f;
						dust2 = Main.dust[num330];
						dust2.type++;
					}
					else
					{
						Main.dust[num330].scale = 1f + (float)Main.rand.Next(-10, 11) * 0.01f;
					}
					Main.dust[num330].noGravity = true;
					dust2 = Main.dust[num330];
					dust2.velocity *= 1.25f;
					dust2 = Main.dust[num330];
					dust2.velocity -= oldVelocity / 10f;
				}
			}
			else if (type == 521)
			{
				SoundEngine.PlaySound(SoundID.Item110, position);
				for (int num331 = 0; num331 < 20; num331++)
				{
					int num332 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 254, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.5f);
					Dust dust2;
					if (Main.rand.Next(3) == 0)
					{
						Main.dust[num332].fadeIn = 1.1f + (float)Main.rand.Next(-10, 11) * 0.01f;
						Main.dust[num332].scale = 0.35f + (float)Main.rand.Next(-10, 11) * 0.01f;
						dust2 = Main.dust[num332];
						dust2.type++;
					}
					else
					{
						Main.dust[num332].scale = 1.2f + (float)Main.rand.Next(-10, 11) * 0.01f;
					}
					Main.dust[num332].noGravity = true;
					dust2 = Main.dust[num332];
					dust2.velocity *= 2.5f;
					dust2 = Main.dust[num332];
					dust2.velocity -= oldVelocity / 10f;
				}
				if (Main.myPlayer == owner)
				{
					int num333 = Main.rand.Next(3, 6);
					for (int num334 = 0; num334 < num333; num334++)
					{
						Vector2 vector40 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						while (vector40.X == 0f && vector40.Y == 0f)
						{
							vector40 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						}
						vector40.Normalize();
						vector40 *= (float)Main.rand.Next(70, 101) * 0.1f;
						NewProjectile(GetProjectileSource_FromThis(), oldPosition.X + (float)(width / 2), oldPosition.Y + (float)(height / 2), vector40.X, vector40.Y, 522, (int)((double)damage * 0.8), knockBack * 0.8f, owner);
					}
				}
			}
			if (type == 520)
			{
				SoundEngine.PlaySound(SoundID.Item50, position);
				for (int num335 = 0; num335 < 10; num335++)
				{
					int num336 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 252, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.75f);
					Main.dust[num336].noGravity = true;
					Dust dust2 = Main.dust[num336];
					dust2.velocity -= oldVelocity / 3f;
				}
			}
			if (type == 459 || type == 709)
			{
				int num337 = 3;
				int num338 = 10;
				int num339 = 0;
				if (scale >= 1f)
				{
					position = base.Center;
					width = (height = 144);
					base.Center = position;
					num337 = 7;
					num338 = 30;
					num339 = 2;
					Damage();
				}
				for (int num340 = 0; num340 < num337; num340++)
				{
					int num341 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
					Main.dust[num341].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
				}
				for (int num342 = 0; num342 < num338; num342++)
				{
					int num343 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 226, 0f, 0f, 0, default(Color), 1.5f);
					Main.dust[num343].position = new Vector2(width / 2, 0f).RotatedBy(6.2831854820251465 * Main.rand.NextDouble()) * (float)Main.rand.NextDouble() + base.Center;
					Main.dust[num343].noGravity = true;
					Dust dust2 = Main.dust[num343];
					dust2.velocity *= 1f;
				}
				for (int num344 = 0; num344 < num339; num344++)
				{
					int num345 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num345];
					gore2.velocity *= 0.3f;
					Main.gore[num345].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num345].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				if (type == 709 && Main.myPlayer == owner)
				{
					Rectangle value7 = new Rectangle((int)base.Center.X - 40, (int)base.Center.Y - 40, 80, 80);
					for (int num346 = 0; num346 < 1000; num346++)
					{
						if (num346 != whoAmI && Main.projectile[num346].active && Main.projectile[num346].owner == owner && Main.projectile[num346].type == 443 && Main.projectile[num346].getRect().Intersects(value7))
						{
							Main.projectile[num346].ai[1] = 1f;
							Main.projectile[num346].velocity = (base.Center - Main.projectile[num346].Center) / 5f;
							Main.projectile[num346].netUpdate = true;
						}
					}
					int num347 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 443, damage, 0f, owner);
					Main.projectile[num347].timeLeft = 30 * Main.rand.Next(2, 6);
					float[] array2 = Main.projectile[num347].localAI;
					SlotId val = SoundEngine.PlayTrackedSound(SoundID.DD2_SkyDragonsFuryCircle, base.Center);
					array2[0] = ((SlotId)(ref val)).ToFloat();
				}
			}
			if (owner != Main.myPlayer && type == 453 && Main.player[owner].mount.AbilityActive)
			{
				Main.player[owner].mount.UseAbility(Main.player[owner], position, toggleOn: false);
			}
			if (type == 441)
			{
				Main.player[owner].mount.StopAbilityCharge();
			}
			if (type == 444)
			{
				SoundEngine.PlaySound(SoundID.Item96, position);
				int num348 = Main.rand.Next(5, 9);
				for (int num349 = 0; num349 < num348; num349++)
				{
					int num350 = Dust.NewDust(base.Center, 0, 0, 171, 0f, 0f, 100, default(Color), 1.4f);
					Dust dust2 = Main.dust[num350];
					dust2.velocity *= 0.8f;
					Main.dust[num350].position = Vector2.Lerp(Main.dust[num350].position, base.Center, 0.5f);
					Main.dust[num350].noGravity = true;
				}
				if (owner == Main.myPlayer)
				{
					Vector2 vector41 = Main.screenPosition + new Vector2(Main.mouseX, Main.mouseY);
					if (Main.player[owner].gravDir == -1f)
					{
						vector41.Y = (float)(Main.screenHeight - Main.mouseY) + Main.screenPosition.Y;
					}
					Vector2 vector42 = Vector2.Normalize(vector41 - base.Center);
					vector42 *= localAI[1];
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector42.X, vector42.Y, (int)localAI[0], damage, knockBack, owner);
				}
			}
			if (type == 472)
			{
				for (int num351 = 0; num351 < 20; num351++)
				{
					int num352 = Dust.NewDust(position, width, height, 30);
					Main.dust[num352].noGravity = true;
					Dust dust2 = Main.dust[num352];
					dust2.velocity *= 0.45f;
					dust2 = Main.dust[num352];
					dust2.velocity += velocity * 0.9f;
				}
			}
			if (type == 639 || type == 640)
			{
				int num353 = Main.rand.Next(5, 10);
				for (int num354 = 0; num354 < num353; num354++)
				{
					int num355 = Dust.NewDust(base.Center, 0, 0, 220, 0f, 0f, 100, default(Color), 0.5f);
					Dust dust2 = Main.dust[num355];
					dust2.velocity *= 1.6f;
					Main.dust[num355].velocity.Y -= 1f;
					Main.dust[num355].position = Vector2.Lerp(Main.dust[num355].position, base.Center, 0.5f);
					Main.dust[num355].noGravity = true;
				}
				if (owner == Main.myPlayer && type == 639)
				{
					int num356 = num + 1;
					int nextSlot = GetNextSlot();
					if (Main.ProjectileUpdateLoopIndex < nextSlot && Main.ProjectileUpdateLoopIndex != -1)
					{
						num356++;
					}
					Vector2 vector43 = new Vector2(ai[0], ai[1]);
					NewProjectile(GetProjectileSource_FromThis(), localAI[0], localAI[1], vector43.X, vector43.Y, 640, damage, knockBack, owner, 0f, num356);
				}
			}
			if (type == 684)
			{
				int num357 = Main.rand.Next(15, 25);
				for (int num358 = 0; num358 < num357; num358++)
				{
					int num359 = Dust.NewDust(base.Center, 0, 0, 60, 0f, 0f, 100, new Color(255, 255, 255, 0), 1.3f);
					Dust dust2 = Main.dust[num359];
					dust2.velocity *= 8f * (0.3f + 0.7f * Main.rand.NextFloat());
					Main.dust[num359].fadeIn = 1.3f + Main.rand.NextFloat() * 0.2f;
					Main.dust[num359].noLight = true;
					Main.dust[num359].noGravity = true;
					dust2 = Main.dust[num359];
					dust2.position += Main.dust[num359].velocity * 4f;
				}
			}
			if (type == 435)
			{
				int num360 = Main.rand.Next(5, 10);
				for (int num361 = 0; num361 < num360; num361++)
				{
					int num362 = Dust.NewDust(base.Center, 0, 0, 226, 0f, 0f, 100, default(Color), 0.5f);
					Dust dust2 = Main.dust[num362];
					dust2.velocity *= 1.6f;
					Main.dust[num362].velocity.Y -= 1f;
					Main.dust[num362].position = Vector2.Lerp(Main.dust[num362].position, base.Center, 0.5f);
					Main.dust[num362].noGravity = true;
				}
			}
			if (type == 732)
			{
				int num363 = Main.rand.Next(5, 10);
				for (int num364 = 0; num364 < num363; num364++)
				{
					int num365 = Dust.NewDust(base.Center, 0, 0, 226, 0f, 0f, 100, default(Color), 0.5f);
					Dust dust2 = Main.dust[num365];
					dust2.velocity *= 1.6f;
					Main.dust[num365].velocity.Y -= 1f;
					Main.dust[num365].velocity = Main.dust[num365].velocity * 0.5f + velocity * ((float)num364 / (float)num363) * 0.7f;
					Main.dust[num365].position = Vector2.Lerp(Main.dust[num365].position, base.Center, 0.5f);
					Main.dust[num365].noGravity = true;
				}
			}
			if (type == 682)
			{
				int num366 = 22;
				for (int num367 = 0; num367 < num366; num367++)
				{
					int num368 = Dust.NewDust(base.Center, 0, 0, 272, 0f, 0f, 0, default(Color), 0.5f);
					Dust dust2 = Main.dust[num368];
					dust2.velocity *= 1.6f;
					Main.dust[num368].velocity.Y -= 1f;
					Main.dust[num368].position = Vector2.Lerp(Main.dust[num368].position, base.Center, 0.5f);
				}
			}
			if (type == 436)
			{
				int num369 = Main.rand.Next(5, 10);
				for (int num370 = 0; num370 < num369; num370++)
				{
					int num371 = Dust.NewDust(base.Center, 0, 0, 220, 0f, 0f, 100, default(Color), 0.5f);
					Dust dust2 = Main.dust[num371];
					dust2.velocity *= 1.6f;
					Main.dust[num371].velocity.Y -= 1f;
					Main.dust[num371].position = Vector2.Lerp(Main.dust[num371].position, base.Center, 0.5f);
					Main.dust[num371].noGravity = true;
				}
			}
			if (type == 462)
			{
				int num372 = Main.rand.Next(5, 10);
				for (int num373 = 0; num373 < num372; num373++)
				{
					int num374 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100, default(Color), 0.5f);
					Dust dust2 = Main.dust[num374];
					dust2.velocity *= 1.6f;
					Main.dust[num374].velocity.Y -= 1f;
					dust2 = Main.dust[num374];
					dust2.position -= Vector2.One * 4f;
					Main.dust[num374].position = Vector2.Lerp(Main.dust[num374].position, base.Center, 0.5f);
					Main.dust[num374].noGravity = true;
				}
			}
			if (type == 442)
			{
				SoundEngine.PlaySound(SoundID.Item94, position);
				int num375 = Main.rand.Next(3, 7);
				for (int num376 = 0; num376 < num375; num376++)
				{
					int num377 = Dust.NewDust(position, width, height, 135, 0f, 0f, 100, default(Color), 2.1f);
					Dust dust2 = Main.dust[num377];
					dust2.velocity *= 2f;
					Main.dust[num377].noGravity = true;
				}
				if (Main.myPlayer == owner)
				{
					Rectangle value8 = new Rectangle((int)base.Center.X - 40, (int)base.Center.Y - 40, 80, 80);
					for (int num378 = 0; num378 < 1000; num378++)
					{
						if (num378 != whoAmI && Main.projectile[num378].active && Main.projectile[num378].owner == owner && Main.projectile[num378].type == 443 && Main.projectile[num378].getRect().Intersects(value8))
						{
							Main.projectile[num378].ai[1] = 1f;
							Main.projectile[num378].velocity = (base.Center - Main.projectile[num378].Center) / 5f;
							Main.projectile[num378].netUpdate = true;
						}
					}
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 443, damage, 0f, owner);
				}
			}
			if (type == 440)
			{
				int num379 = Main.rand.Next(3, 7);
				for (int num380 = 0; num380 < num379; num380++)
				{
					int num381 = Dust.NewDust(base.Center - velocity / 2f, 0, 0, 135, 0f, 0f, 100, default(Color), 2.1f);
					Dust dust2 = Main.dust[num381];
					dust2.velocity *= 2f;
					Main.dust[num381].noGravity = true;
				}
			}
			if (type == 606)
			{
				int num382 = Main.rand.Next(3, 7);
				for (int num383 = 0; num383 < num382; num383++)
				{
					int num384 = Dust.NewDust(base.Center - velocity / 2f, 0, 0, 182, 0f, 0f, 100, default(Color), 1.6f);
					Dust dust2 = Main.dust[num384];
					dust2.velocity *= 1.5f;
					Main.dust[num384].noGravity = true;
				}
			}
			if (type == 449)
			{
				int num385 = Main.rand.Next(3, 7);
				for (int num386 = 0; num386 < num385; num386++)
				{
					int num387 = Dust.NewDust(base.Center - velocity / 2f, 0, 0, 228, 0f, 0f, 100, default(Color), 2.1f);
					Dust dust2 = Main.dust[num387];
					dust2.velocity *= 2f;
					Main.dust[num387].noGravity = true;
				}
			}
			if (type == 495)
			{
				for (int num388 = 0; num388 < 15; num388++)
				{
					int num389 = Dust.NewDust(base.Center, 10, 10, 27);
					Main.dust[num389].noGravity = true;
					Dust dust2 = Main.dust[num389];
					dust2.velocity -= oldVelocity * 0.3f;
				}
			}
			if (type == 497)
			{
				for (int num390 = 0; num390 < 15; num390++)
				{
					int num391 = Dust.NewDust(base.Center, 10, 10, 27);
					Main.dust[num391].noGravity = true;
					Dust dust2 = Main.dust[num391];
					dust2.velocity *= 2f;
					dust2 = Main.dust[num391];
					dust2.velocity -= oldVelocity * 0.3f;
					dust2 = Main.dust[num391];
					dust2.scale += (float)Main.rand.Next(150) * 0.001f;
				}
			}
			if (type == 448)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
				position = base.Center;
				width = (height = 112);
				position.X -= width / 2;
				position.Y -= height / 2;
				for (int num392 = 0; num392 < 4; num392++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				for (int num393 = 0; num393 < 40; num393++)
				{
					int num394 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 0, default(Color), 2.5f);
					Main.dust[num394].noGravity = true;
					Dust dust2 = Main.dust[num394];
					dust2.velocity *= 3f;
					num394 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 228, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num394];
					dust2.velocity *= 2f;
					Main.dust[num394].noGravity = true;
				}
				for (int num395 = 0; num395 < 1; num395++)
				{
					int num396 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num396];
					gore2.velocity *= 0.3f;
					Main.gore[num396].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num396].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				Damage();
			}
			else if (type == 715 || type == 716 || type == 717 || type == 718)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
				position = base.Center;
				width = (height = 128);
				if (type == 717 || type == 718)
				{
					width = (height = 240);
				}
				position.X -= width / 2;
				position.Y -= height / 2;
				Damage();
				AI_147_Explosion();
			}
			if (type == 616)
			{
				SoundEngine.PlaySound(SoundID.Item14, position);
				position = base.Center;
				width = (height = 80);
				position.X -= width / 2;
				position.Y -= height / 2;
				for (int num397 = 0; num397 < 4; num397++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				for (int num398 = 0; num398 < 40; num398++)
				{
					int num399 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 200, default(Color), 2.5f);
					Main.dust[num399].noGravity = true;
					Dust dust2 = Main.dust[num399];
					dust2.velocity *= 2f;
					num399 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 229, 0f, 0f, 200, default(Color), 1.5f);
					dust2 = Main.dust[num399];
					dust2.velocity *= 1.2f;
					Main.dust[num399].noGravity = true;
				}
				for (int num400 = 0; num400 < 1; num400++)
				{
					int num401 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num401];
					gore2.velocity *= 0.3f;
					Main.gore[num401].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num401].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				Damage();
			}
			if (type == 502)
			{
				Vector2 vector44 = new Vector2(width, height) / 2f;
				for (int num402 = 0; num402 < oldPos.Length; num402++)
				{
					if (!(oldPos[num402] == Vector2.Zero))
					{
						int num403 = Dust.NewDust(oldPos[num402] + vector44, 0, 0, 66, 0f, 0f, 150, Color.Transparent, 0.7f);
						Main.dust[num403].color = Main.hslToRgb(Main.rand.NextFloat(), 1f, 0.5f);
						Main.dust[num403].noGravity = true;
					}
				}
			}
			if (type == 510)
			{
				SoundEngine.PlaySound(SoundID.Item107, position);
				Gore.NewGore(base.Center, -oldVelocity * 0.2f, 704);
				Gore.NewGore(base.Center, -oldVelocity * 0.2f, 705);
				if (owner == Main.myPlayer)
				{
					int num404 = Main.rand.Next(20, 31);
					for (int num405 = 0; num405 < num404; num405++)
					{
						Vector2 vector45 = new Vector2(Main.rand.Next(-100, 101), Main.rand.Next(-100, 101));
						vector45.Normalize();
						vector45 *= (float)Main.rand.Next(10, 201) * 0.01f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, vector45.X, vector45.Y, 511 + Main.rand.Next(3), damage, 1f, owner);
					}
				}
			}
			if (type == 868 || type == 869 || type == 996)
			{
				SoundEngine.PlaySound(SoundID.Item107, position);
				for (int num406 = 0; num406 < 15; num406++)
				{
					Dust.NewDust(position, width, height, 13, 0f, -2f, 0, default(Color), 1.5f);
				}
				if (Main.netMode != 1)
				{
					switch (type)
					{
					case 868:
						WorldGen.TreeTops.RandomizeTreeStyleBasedOnWorldPosition(Main.rand, base.Center);
						break;
					case 869:
						WorldGen.RandomizeBackgroundBasedOnPlayer(Main.rand, Main.player[owner]);
						break;
					case 996:
						WorldGen.RandomizeMoonState(Main.rand, garenteeNewStyle: true);
						break;
					}
					NetMessage.SendData(7);
				}
			}
			else if (type == 836)
			{
				for (int num407 = 0; num407 < 3; num407++)
				{
					int num408 = Dust.NewDust(position, width, height, 31, 0f, 0f, 50, Color.White, 0.8f);
					Dust dust2 = Main.dust[num408];
					dust2.velocity *= 0.5f;
					Main.dust[num408].noGravity = true;
				}
			}
			if (type == 408)
			{
				for (int num409 = 0; num409 < 15; num409++)
				{
					int num410 = Dust.NewDust(base.Center - Vector2.One * 10f, 50, 50, 5, 0f, -2f);
					Dust dust2 = Main.dust[num410];
					dust2.velocity /= 2f;
				}
				int num411 = 0;
				int num412 = 10;
				num411 = Gore.NewGore(base.Center, velocity * 0.8f, 584);
				Gore gore2 = Main.gore[num411];
				gore2.timeLeft /= num412;
				num411 = Gore.NewGore(base.Center, velocity * 0.9f, 585);
				gore2 = Main.gore[num411];
				gore2.timeLeft /= num412;
				num411 = Gore.NewGore(base.Center, velocity * 1f, 586);
				gore2 = Main.gore[num411];
				gore2.timeLeft /= num412;
			}
			if (type == 385)
			{
				SoundEngine.PlaySound(4, (int)base.Center.X, (int)base.Center.Y, 19);
				int num413 = 36;
				for (int num414 = 0; num414 < num413; num414++)
				{
					Vector2 spinningpoint = Vector2.Normalize(velocity) * new Vector2((float)width / 2f, height) * 0.75f;
					spinningpoint = spinningpoint.RotatedBy((float)(num414 - (num413 / 2 - 1)) * (MathF.PI * 2f) / (float)num413) + base.Center;
					Vector2 vector46 = spinningpoint - base.Center;
					int num415 = Dust.NewDust(spinningpoint + vector46, 0, 0, 172, vector46.X * 2f, vector46.Y * 2f, 100, default(Color), 1.4f);
					Main.dust[num415].noGravity = true;
					Main.dust[num415].noLight = true;
					Main.dust[num415].velocity = vector46;
				}
				if (owner == Main.myPlayer)
				{
					if (ai[1] < 1f)
					{
						int num416 = (Main.expertMode ? 25 : 40);
						int num417 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X - (float)(direction * 30), base.Center.Y - 4f, (float)(-direction) * 0.01f, 0f, 384, num416, 4f, owner, 16f, 15f);
						Main.projectile[num417].netUpdate = true;
					}
					else
					{
						int num418 = (int)(base.Center.Y / 16f);
						int num419 = (int)(base.Center.X / 16f);
						int num420 = 100;
						if (num419 < 10)
						{
							num419 = 10;
						}
						if (num419 > Main.maxTilesX - 10)
						{
							num419 = Main.maxTilesX - 10;
						}
						if (num418 < 10)
						{
							num418 = 10;
						}
						if (num418 > Main.maxTilesY - num420 - 10)
						{
							num418 = Main.maxTilesY - num420 - 10;
						}
						int num421 = num418 + num420;
						int num422 = num418 + 15;
						for (int num423 = num418; num423 < num421; num423++)
						{
							Tile tile = Main.tile[num419, num423];
							if (tile.active() && (Main.tileSolid[tile.type] || tile.liquid != 0))
							{
								num422 = num423;
								break;
							}
						}
						num418 = num422;
						int num424 = (Main.expertMode ? 50 : 80);
						int num425 = NewProjectile(GetProjectileSource_FromThis(), num419 * 16 + 8, num418 * 16 - 24, 0f, 0f, 386, num424, 4f, Main.myPlayer, 16f, 24f);
						Main.projectile[num425].netUpdate = true;
					}
				}
			}
			else if (type >= 424 && type <= 426)
			{
				SoundEngine.PlaySound(SoundID.Item89, position);
				position.X += width / 2;
				position.Y += height / 2;
				width = (int)(128f * scale);
				height = (int)(128f * scale);
				position.X -= width / 2;
				position.Y -= height / 2;
				for (int num426 = 0; num426 < 8; num426++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
				}
				for (int num427 = 0; num427 < 32; num427++)
				{
					int num428 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
					Main.dust[num428].noGravity = true;
					Dust dust2 = Main.dust[num428];
					dust2.velocity *= 3f;
					num428 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num428];
					dust2.velocity *= 2f;
					Main.dust[num428].noGravity = true;
				}
				for (int num429 = 0; num429 < 2; num429++)
				{
					int num430 = Gore.NewGore(position + new Vector2((float)(width * Main.rand.Next(100)) / 100f, (float)(height * Main.rand.Next(100)) / 100f) - Vector2.One * 10f, default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num430];
					gore2.velocity *= 0.3f;
					Main.gore[num430].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
					Main.gore[num430].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
				}
				if (owner == Main.myPlayer)
				{
					localAI[1] = -1f;
					maxPenetrate = 0;
					Damage();
				}
				for (int num431 = 0; num431 < 5; num431++)
				{
					int num432 = Utils.SelectRandom<int>(Main.rand, 6, 259, 158);
					int num433 = Dust.NewDust(position, width, height, num432, 2.5f * (float)direction, -2.5f);
					Main.dust[num433].alpha = 200;
					Dust dust2 = Main.dust[num433];
					dust2.velocity *= 2.4f;
					dust2 = Main.dust[num433];
					dust2.scale += Main.rand.NextFloat();
				}
			}
			if (type == 399)
			{
				SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
				Vector2 vector47 = new Vector2(20f, 20f);
				for (int num434 = 0; num434 < 5; num434++)
				{
					Dust.NewDust(base.Center - vector47 / 2f, (int)vector47.X, (int)vector47.Y, 12, 0f, 0f, 0, Color.Red);
				}
				for (int num435 = 0; num435 < 10; num435++)
				{
					int num436 = Dust.NewDust(base.Center - vector47 / 2f, (int)vector47.X, (int)vector47.Y, 31, 0f, 0f, 100, default(Color), 1.5f);
					Dust dust2 = Main.dust[num436];
					dust2.velocity *= 1.4f;
				}
				for (int num437 = 0; num437 < 20; num437++)
				{
					int num438 = Dust.NewDust(base.Center - vector47 / 2f, (int)vector47.X, (int)vector47.Y, 6, 0f, 0f, 100, default(Color), 2.5f);
					Main.dust[num438].noGravity = true;
					Dust dust2 = Main.dust[num438];
					dust2.velocity *= 5f;
					num438 = Dust.NewDust(base.Center - vector47 / 2f, (int)vector47.X, (int)vector47.Y, 6, 0f, 0f, 100, default(Color), 1.5f);
					dust2 = Main.dust[num438];
					dust2.velocity *= 3f;
				}
				if (Main.myPlayer == owner)
				{
					for (int num439 = 0; num439 < 6; num439++)
					{
						float num440 = (0f - velocity.X) * (float)Main.rand.Next(20, 50) * 0.01f + (float)Main.rand.Next(-20, 21) * 0.4f;
						float num441 = (0f - Math.Abs(velocity.Y)) * (float)Main.rand.Next(30, 50) * 0.01f + (float)Main.rand.Next(-20, 5) * 0.4f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X + num440, base.Center.Y + num441, num440, num441, 400 + Main.rand.Next(3), (int)((double)damage * 0.5), 0f, owner);
					}
				}
			}
			if (type == 384 || type == 386)
			{
				for (int num442 = 0; num442 < 20; num442++)
				{
					int num443 = Dust.NewDust(position, width, height, 212, direction * 2, 0f, 100, default(Color), 1.4f);
					Dust dust42 = Main.dust[num443];
					dust42.color = Color.CornflowerBlue;
					dust42.color = Color.Lerp(dust42.color, Color.White, 0.3f);
					dust42.noGravity = true;
				}
			}
			if (type == 507 || type == 508)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				Vector2 vector48 = position;
				Vector2 vector49 = oldVelocity;
				vector49.Normalize();
				vector48 += vector49 * 16f;
				for (int num444 = 0; num444 < 20; num444++)
				{
					int num445 = Dust.NewDust(vector48, width, height, 81);
					Main.dust[num445].position = (Main.dust[num445].position + base.Center) / 2f;
					Dust dust2 = Main.dust[num445];
					dust2.velocity += oldVelocity * 0.4f;
					dust2 = Main.dust[num445];
					dust2.velocity *= 0.5f;
					Main.dust[num445].noGravity = true;
					vector48 -= vector49 * 8f;
				}
			}
			if (type == 598)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				Vector2 vector50 = position;
				Vector2 vector51 = (rotation - MathF.PI / 2f).ToRotationVector2();
				vector50 += vector51 * 16f;
				for (int num446 = 0; num446 < 20; num446++)
				{
					int num447 = Dust.NewDust(vector50, width, height, 81);
					Main.dust[num447].position = (Main.dust[num447].position + base.Center) / 2f;
					Dust dust2 = Main.dust[num447];
					dust2.velocity += vector51 * 2f;
					dust2 = Main.dust[num447];
					dust2.velocity *= 0.5f;
					Main.dust[num447].noGravity = true;
					vector50 -= vector51 * 8f;
				}
			}
			if (type == 971)
			{
				Vector2 vector52 = position;
				Vector2 vector53 = (rotation - MathF.PI / 2f).ToRotationVector2();
				vector52 += vector53 * 8f;
				for (int num448 = 0; num448 < 6; num448++)
				{
					int num449 = Dust.NewDust(vector52, width, height, 4);
					Main.dust[num449].color = new Color(10, 10, 10, 150);
					Main.dust[num449].position = (Main.dust[num449].position + base.Center) / 2f;
					Dust dust2 = Main.dust[num449];
					dust2.velocity += vector53;
					dust2 = Main.dust[num449];
					dust2.velocity *= 0.5f;
					Main.dust[num449].noGravity = true;
					vector52 -= vector53 * 4f;
				}
			}
			if (type == 1 || type == 81 || type == 98 || type == 980)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num450 = 0; num450 < 10; num450++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 7);
				}
			}
			if (type == 336 || type == 345)
			{
				for (int num451 = 0; num451 < 6; num451++)
				{
					int num452 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 196);
					Main.dust[num452].noGravity = true;
					Main.dust[num452].scale = scale;
				}
			}
			if (type == 358)
			{
				velocity = oldVelocity * 0.2f;
				for (int num453 = 0; num453 < 100; num453++)
				{
					int num454 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 211, 0f, 0f, 75, default(Color), 1.2f);
					Dust dust2;
					if (Main.rand.Next(2) == 0)
					{
						dust2 = Main.dust[num454];
						dust2.alpha += 25;
					}
					if (Main.rand.Next(2) == 0)
					{
						dust2 = Main.dust[num454];
						dust2.alpha += 25;
					}
					if (Main.rand.Next(2) == 0)
					{
						dust2 = Main.dust[num454];
						dust2.alpha += 25;
					}
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num454].scale = 0.6f;
					}
					else
					{
						Main.dust[num454].noGravity = true;
					}
					dust2 = Main.dust[num454];
					dust2.velocity *= 0.3f;
					dust2 = Main.dust[num454];
					dust2.velocity += velocity;
					dust2 = Main.dust[num454];
					dust2.velocity *= 1f + (float)Main.rand.Next(-100, 101) * 0.01f;
					Main.dust[num454].velocity.X += (float)Main.rand.Next(-50, 51) * 0.015f;
					Main.dust[num454].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.015f;
					Main.dust[num454].position = base.Center;
				}
			}
			if (type == 406)
			{
				int num455 = 175;
				Color newColor6 = new Color(0, 80, 255, 100);
				velocity = oldVelocity * 0.2f;
				for (int num456 = 0; num456 < 40; num456++)
				{
					int num457 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, num455, newColor6, 1.6f);
					Dust dust2;
					if (Main.rand.Next(2) == 0)
					{
						dust2 = Main.dust[num457];
						dust2.alpha += 25;
					}
					if (Main.rand.Next(2) == 0)
					{
						dust2 = Main.dust[num457];
						dust2.alpha += 25;
					}
					if (Main.rand.Next(2) == 0)
					{
						dust2 = Main.dust[num457];
						dust2.alpha += 25;
					}
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num457].scale = 0.6f;
					}
					else
					{
						Main.dust[num457].noGravity = true;
					}
					dust2 = Main.dust[num457];
					dust2.velocity *= 0.3f;
					dust2 = Main.dust[num457];
					dust2.velocity += velocity;
					dust2 = Main.dust[num457];
					dust2.velocity *= 1f + (float)Main.rand.Next(-100, 101) * 0.01f;
					Main.dust[num457].velocity.X += (float)Main.rand.Next(-50, 51) * 0.015f;
					Main.dust[num457].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.015f;
					Main.dust[num457].position = base.Center;
				}
			}
			if (type == 344)
			{
				for (int num458 = 0; num458 < 8; num458++)
				{
					int num459 = Dust.NewDust(position, width, height, 197, 0f, 0f, 50);
					Main.dust[num459].noGravity = true;
					Main.dust[num459].velocity.X *= 0.75f;
					Main.dust[num459].velocity.Y *= 0.75f;
					Dust dust2 = Main.dust[num459];
					dust2.velocity -= velocity * 0.025f;
				}
			}
			else if (type == 343)
			{
				SoundEngine.PlaySound(SoundID.Item27, position);
				for (int num460 = 4; num460 < 31; num460++)
				{
					float num461 = oldVelocity.X * (30f / (float)num460);
					float num462 = oldVelocity.Y * (30f / (float)num460);
					int num463 = Dust.NewDust(new Vector2(oldPosition.X - num461, oldPosition.Y - num462), 8, 8, 197, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.2f);
					Main.dust[num463].noGravity = true;
					Dust dust2 = Main.dust[num463];
					dust2.velocity *= 0.5f;
				}
			}
			else if (type == 349)
			{
				SoundEngine.PlaySound(SoundID.Item27, position);
				for (int num464 = 0; num464 < 3; num464++)
				{
					int num465 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 76);
					Main.dust[num465].noGravity = true;
					Main.dust[num465].noLight = true;
					Main.dust[num465].scale = 0.7f;
				}
			}
			if (type == 323)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num466 = 0; num466 < 20; num466++)
				{
					int num467 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 7);
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num467].noGravity = true;
						Main.dust[num467].scale = 1.3f;
						Dust dust2 = Main.dust[num467];
						dust2.velocity *= 1.5f;
						dust2 = Main.dust[num467];
						dust2.velocity -= oldVelocity * 0.5f;
						dust2 = Main.dust[num467];
						dust2.velocity *= 1.5f;
					}
					else
					{
						Dust dust2 = Main.dust[num467];
						dust2.velocity *= 0.75f;
						dust2 = Main.dust[num467];
						dust2.velocity -= oldVelocity * 0.25f;
						Main.dust[num467].scale = 0.8f;
					}
				}
			}
			if (type == 589)
			{
				SoundEngine.PlaySound(SoundID.Item27, position);
				Color newColor7 = Color.Red;
				if (ai[1] == 1f)
				{
					newColor7 = Color.Green;
				}
				if (ai[1] == 2f)
				{
					newColor7 = Color.Purple;
				}
				if (ai[1] == 3f)
				{
					newColor7 = Color.Gold;
				}
				if (ai[1] == 4f)
				{
					newColor7 = Color.White;
				}
				newColor7.A = 100;
				for (int num468 = 0; num468 < 30; num468++)
				{
					int num469 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 11, 0f, 0f, 0, newColor7);
					Dust dust2 = Main.dust[num469];
					dust2.velocity *= 1f + Main.rand.NextFloat() * 1f;
					if (num468 < 10)
					{
						Main.dust[num469].noGravity = true;
						dust2 = Main.dust[num469];
						dust2.velocity *= 0.5f;
					}
				}
			}
			if (type == 346)
			{
				SoundEngine.PlaySound(SoundID.Item27, position);
				for (int num470 = 0; num470 < 20; num470++)
				{
					int num471 = 10;
					if (ai[1] == 1f)
					{
						num471 = 4;
					}
					int num472 = Dust.NewDust(position, width, height, num471);
					Main.dust[num472].noGravity = true;
				}
			}
			if (type == 335)
			{
				SoundEngine.PlaySound(SoundID.Item27, position);
				for (int num473 = 0; num473 < 20; num473++)
				{
					int num474 = 90 - (int)ai[1];
					int num475 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num474);
					Main.dust[num475].noLight = true;
					Main.dust[num475].scale = 0.8f;
				}
			}
			if (type == 318)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num476 = 0; num476 < 10; num476++)
				{
					int num477 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 30);
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num477].noGravity = true;
					}
				}
			}
			if (type == 378)
			{
				for (int num478 = 0; num478 < 10; num478++)
				{
					int num479 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 30);
					if (Main.rand.Next(2) == 0)
					{
						Main.dust[num479].noGravity = true;
					}
				}
			}
			else if (type == 311)
			{
				for (int num480 = 0; num480 < 5; num480++)
				{
					int num481 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 189);
					Main.dust[num481].scale = 0.85f;
					Main.dust[num481].noGravity = true;
					Dust dust2 = Main.dust[num481];
					dust2.velocity += velocity * 0.5f;
				}
			}
			else if (type == 316)
			{
				for (int num482 = 0; num482 < 5; num482++)
				{
					int num483 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 195);
					Main.dust[num483].scale = 0.85f;
					Main.dust[num483].noGravity = true;
					Dust dust2 = Main.dust[num483];
					dust2.velocity += velocity * 0.5f;
				}
			}
			else if (type == 184 || type == 195)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num484 = 0; num484 < 5; num484++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 7);
				}
			}
			else if (type == 275 || type == 276)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num485 = 0; num485 < 5; num485++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 7);
				}
			}
			else if (type == 291)
			{
				if (owner == Main.myPlayer)
				{
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 292, damage, knockBack, owner);
				}
			}
			else if (type == 295)
			{
				if (owner == Main.myPlayer)
				{
					NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 296, (int)((double)damage * 0.75), knockBack, owner);
				}
			}
			else if (type == 270 || type == 837)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y, 27);
				if (type == 270)
				{
					for (int num486 = 0; num486 < 20; num486++)
					{
						int num487 = Dust.NewDust(position, width, height, 26, 0f, 0f, 100);
						Main.dust[num487].noGravity = true;
						Dust dust2 = Main.dust[num487];
						dust2.velocity *= 1.2f;
						Main.dust[num487].scale = 1.3f;
						dust2 = Main.dust[num487];
						dust2.velocity -= oldVelocity * 0.3f;
						num487 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 5, 0f, 0f, 100, default(Color), 1.5f);
						Main.dust[num487].noGravity = true;
						dust2 = Main.dust[num487];
						dust2.velocity *= 3f;
					}
				}
				else
				{
					for (int num488 = 0; num488 < 20; num488++)
					{
						int num489 = Dust.NewDust(position, width, height, 26, 0f, 0f, 100);
						Main.dust[num489].noGravity = true;
						Dust dust2 = Main.dust[num489];
						dust2.velocity *= 1.2f;
						Main.dust[num489].scale = 1.3f;
						dust2 = Main.dust[num489];
						dust2.velocity -= oldVelocity * 0.3f;
						num489 = Dust.NewDust(new Vector2(position.X + 4f, position.Y + 4f), width - 8, height - 8, 6, 0f, 0f, 100, default(Color), 2f);
						Main.dust[num489].noGravity = true;
						dust2 = Main.dust[num489];
						dust2.velocity *= 3f;
					}
				}
			}
			else if (type == 265)
			{
				for (int num490 = 0; num490 < 15; num490++)
				{
					int num491 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 163, 0f, 0f, 100, default(Color), 1.2f);
					Main.dust[num491].noGravity = true;
					Dust dust2 = Main.dust[num491];
					dust2.velocity *= 1.2f;
					dust2 = Main.dust[num491];
					dust2.velocity -= oldVelocity * 0.3f;
				}
			}
			else if (type == 355)
			{
				for (int num492 = 0; num492 < 15; num492++)
				{
					int num493 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 205, 0f, 0f, 100, default(Color), 1.2f);
					Main.dust[num493].noGravity = true;
					Dust dust2 = Main.dust[num493];
					dust2.velocity *= 1.2f;
					dust2 = Main.dust[num493];
					dust2.velocity -= oldVelocity * 0.3f;
				}
			}
			else if (type == 304)
			{
				for (int num494 = 0; num494 < 3; num494++)
				{
					int num495 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 182, 0f, 0f, 100, default(Color), 0.8f);
					Main.dust[num495].noGravity = true;
					Dust dust2 = Main.dust[num495];
					dust2.velocity *= 1.2f;
					dust2 = Main.dust[num495];
					dust2.velocity -= oldVelocity * 0.3f;
				}
			}
			else if (type == 263)
			{
				SoundEngine.PlaySound(SoundID.Item27, position);
				for (int num496 = 0; num496 < 15; num496++)
				{
					int num497 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 92, velocity.X, velocity.Y, Main.rand.Next(0, 101), default(Color), 1f + (float)Main.rand.Next(40) * 0.01f);
					Main.dust[num497].noGravity = true;
					Dust dust2 = Main.dust[num497];
					dust2.velocity *= 2f;
				}
			}
			else if (type == 261)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num498 = 0; num498 < 15; num498++)
				{
					Dust dust43 = Dust.NewDustDirect(new Vector2(position.X, position.Y), width, height, 148);
					Dust dust2 = dust43;
					dust2.velocity *= 2f;
					dust43.velocity.Y -= 0.4f;
				}
				for (int num499 = 0; num499 < 3; num499++)
				{
					Dust dust44 = Dust.NewDustDirect(new Vector2(position.X, position.Y), width, height, 228);
					Dust dust2 = dust44;
					dust2.velocity *= 2f;
					dust44.noLight = true;
					dust2 = dust44;
					dust2.scale *= 0.8f;
					dust44.velocity.Y -= 0.3f;
				}
			}
			else if (type == 928)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num500 = 0; num500 < 25; num500++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 5, velocity.X, velocity.Y, 0, Color.White, 1.3f);
				}
			}
			else if (type == 229)
			{
				for (int num501 = 0; num501 < 25; num501++)
				{
					int num502 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 157);
					Main.dust[num502].noGravity = true;
					Dust dust2 = Main.dust[num502];
					dust2.velocity *= 1.5f;
					Main.dust[num502].scale = 1.5f;
				}
			}
			else if (type == 239)
			{
				if (velocity.Y > 0f)
				{
					int num503 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), 2, 2, 154);
					Main.dust[num503].position.X -= 2f;
					Main.dust[num503].alpha = 38;
					Dust dust2 = Main.dust[num503];
					dust2.velocity *= 0.1f;
					dust2 = Main.dust[num503];
					dust2.velocity += -oldVelocity * 0.25f;
					Main.dust[num503].scale = 0.95f;
				}
			}
			else if (type == 245)
			{
				if (velocity.Y > 0f)
				{
					int num504 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), 2, 2, 114);
					Main.dust[num504].noGravity = true;
					Main.dust[num504].position.X -= 2f;
					Main.dust[num504].alpha = 38;
					Dust dust2 = Main.dust[num504];
					dust2.velocity *= 0.1f;
					dust2 = Main.dust[num504];
					dust2.velocity += -oldVelocity * 0.25f;
					Main.dust[num504].scale = 0.95f;
				}
			}
			else if (type == 264)
			{
				if (velocity.Y > 0f)
				{
					int num505 = Dust.NewDust(new Vector2(position.X, position.Y + (float)height - 2f), 2, 2, 54);
					Main.dust[num505].noGravity = true;
					Main.dust[num505].position.X -= 2f;
					Main.dust[num505].alpha = 38;
					Dust dust2 = Main.dust[num505];
					dust2.velocity *= 0.1f;
					dust2 = Main.dust[num505];
					dust2.velocity += -oldVelocity * 0.25f;
					Main.dust[num505].scale = 0.95f;
				}
			}
			else if (type == 206 || type == 225)
			{
				SoundEngine.PlaySound(6, (int)position.X, (int)position.Y);
				for (int num506 = 0; num506 < 5; num506++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 40);
				}
			}
			else if (type == 227)
			{
				SoundEngine.PlaySound(6, (int)position.X, (int)position.Y);
				for (int num507 = 0; num507 < 15; num507++)
				{
					int num508 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 157);
					Main.dust[num508].noGravity = true;
					Dust dust2 = Main.dust[num508];
					dust2.velocity += oldVelocity * Main.rand.NextFloat();
					Main.dust[num508].scale = 1.5f;
				}
			}
			else if (type == 237 && owner == Main.myPlayer)
			{
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 238, damage, knockBack, owner);
			}
			else if (type == 243 && owner == Main.myPlayer)
			{
				NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 244, damage, knockBack, owner);
			}
			else if (type == 120)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num509 = 0; num509 < 10; num509++)
				{
					int num510 = Dust.NewDust(new Vector2(position.X - velocity.X, position.Y - velocity.Y), width, height, 67, velocity.X, velocity.Y, 100);
					if (num509 < 5)
					{
						Main.dust[num510].noGravity = true;
					}
					Dust dust2 = Main.dust[num510];
					dust2.velocity *= 0.2f;
				}
			}
			else if (type == 181 || type == 189 || type == 566)
			{
				for (int num511 = 0; num511 < 6; num511++)
				{
					int num512 = Dust.NewDust(position, width, height, 150, velocity.X, velocity.Y, 50);
					Main.dust[num512].noGravity = true;
					Main.dust[num512].scale = 1f;
				}
			}
			else if (type == 178)
			{
				for (int num513 = 0; num513 < 85; num513++)
				{
					int num514 = Main.rand.Next(139, 143);
					int num515 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num514, velocity.X, velocity.Y, 0, default(Color), 1.2f);
					Main.dust[num515].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num515].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num515].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num515].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num515].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
					Main.dust[num515].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
					Dust dust2 = Main.dust[num515];
					dust2.scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
				}
				for (int num516 = 0; num516 < 40; num516++)
				{
					int num517 = Main.rand.Next(276, 283);
					int num518 = Gore.NewGore(position, velocity, num517);
					Main.gore[num518].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.gore[num518].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.gore[num518].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.gore[num518].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Gore gore2 = Main.gore[num518];
					gore2.scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
					Main.gore[num518].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
					Main.gore[num518].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
				}
			}
			else if (type == 289)
			{
				for (int num519 = 0; num519 < 30; num519++)
				{
					int num520 = Main.rand.Next(139, 143);
					int num521 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num520, velocity.X, velocity.Y, 0, default(Color), 1.2f);
					Main.dust[num521].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num521].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num521].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num521].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.dust[num521].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
					Main.dust[num521].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
					Dust dust2 = Main.dust[num521];
					dust2.scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
				}
				for (int num522 = 0; num522 < 15; num522++)
				{
					int num523 = Main.rand.Next(276, 283);
					int num524 = Gore.NewGore(position, velocity, num523);
					Main.gore[num524].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.gore[num524].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.gore[num524].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Main.gore[num524].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
					Gore gore2 = Main.gore[num524];
					gore2.scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
					Main.gore[num524].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
					Main.gore[num524].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
				}
			}
			else if (type == 475 || type == 505 || type == 506)
			{
				if (ai[1] == 0f)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				}
				if (ai[1] < 10f)
				{
					Vector2 vector54 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num525 = 0f - velocity.X;
					float num526 = 0f - velocity.Y;
					float num527 = 1f;
					if (ai[0] <= 17f)
					{
						num527 = ai[0] / 17f;
					}
					int num528 = (int)(30f * num527);
					float num529 = 1f;
					if (ai[0] <= 30f)
					{
						num529 = ai[0] / 30f;
					}
					float num530 = 0.4f * num529;
					float num531 = num530;
					num526 += num531;
					for (int num532 = 0; num532 < num528; num532++)
					{
						float num533 = (float)Math.Sqrt(num525 * num525 + num526 * num526);
						float num534 = 5.6f;
						if (Math.Abs(num525) + Math.Abs(num526) < 1f)
						{
							num534 *= Math.Abs(num525) + Math.Abs(num526) / 1f;
						}
						num533 = num534 / num533;
						num525 *= num533;
						num526 *= num533;
						Math.Atan2(num526, num525);
						int num535 = 3;
						if (type == 506)
						{
							num535 = 30;
						}
						if (type == 505)
						{
							num535 = 239;
						}
						if ((float)num532 > ai[1])
						{
							for (int num536 = 0; num536 < 4; num536++)
							{
								int num537 = Dust.NewDust(vector54, width, height, num535);
								Main.dust[num537].noGravity = true;
								Dust dust2 = Main.dust[num537];
								dust2.velocity *= 0.3f;
							}
						}
						vector54.X += num525;
						vector54.Y += num526;
						num525 = 0f - velocity.X;
						num526 = 0f - velocity.Y;
						num531 += num530;
						num526 += num531;
					}
				}
			}
			else if (type == 171)
			{
				if (ai[1] == 0f)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				}
				if (ai[1] < 10f)
				{
					Vector2 vector55 = new Vector2(position.X + (float)width * 0.5f, position.Y + (float)height * 0.5f);
					float num538 = 0f - velocity.X;
					float num539 = 0f - velocity.Y;
					float num540 = 1f;
					if (ai[0] <= 17f)
					{
						num540 = ai[0] / 17f;
					}
					int num541 = (int)(30f * num540);
					float num542 = 1f;
					if (ai[0] <= 30f)
					{
						num542 = ai[0] / 30f;
					}
					float num543 = 0.4f * num542;
					float num544 = num543;
					num539 += num544;
					for (int num545 = 0; num545 < num541; num545++)
					{
						float num546 = (float)Math.Sqrt(num538 * num538 + num539 * num539);
						float num547 = 5.6f;
						if (Math.Abs(num538) + Math.Abs(num539) < 1f)
						{
							num547 *= Math.Abs(num538) + Math.Abs(num539) / 1f;
						}
						num546 = num547 / num546;
						num538 *= num546;
						num539 *= num546;
						Math.Atan2(num539, num538);
						if ((float)num545 > ai[1])
						{
							for (int num548 = 0; num548 < 4; num548++)
							{
								int num549 = Dust.NewDust(vector55, width, height, 129);
								Main.dust[num549].noGravity = true;
								Dust dust2 = Main.dust[num549];
								dust2.velocity *= 0.3f;
							}
						}
						vector55.X += num538;
						vector55.Y += num539;
						num538 = 0f - velocity.X;
						num539 = 0f - velocity.Y;
						num544 += num543;
						num539 += num544;
					}
				}
			}
			else if (type == 117)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num550 = 0; num550 < 10; num550++)
				{
					Dust.NewDust(new Vector2(position.X, position.Y), width, height, 26);
				}
			}
			else if (type == 166)
			{
				SoundEngine.PlaySound(SoundID.Item51, position);
				for (int num551 = 0; num551 < 10; num551++)
				{
					int num552 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 76);
					Main.dust[num552].noGravity = true;
					Dust dust2 = Main.dust[num552];
					dust2.velocity -= oldVelocity * 0.25f;
				}
			}
			else if (type == 158)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num553 = 0; num553 < 10; num553++)
				{
					int num554 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 9);
					Main.dust[num554].noGravity = true;
					Dust dust2 = Main.dust[num554];
					dust2.velocity -= velocity * 0.5f;
				}
			}
			else if (type == 159)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num555 = 0; num555 < 10; num555++)
				{
					int num556 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 11);
					Main.dust[num556].noGravity = true;
					Dust dust2 = Main.dust[num556];
					dust2.velocity -= velocity * 0.5f;
				}
			}
			else if (type == 160)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num557 = 0; num557 < 10; num557++)
				{
					int num558 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 19);
					Main.dust[num558].noGravity = true;
					Dust dust2 = Main.dust[num558];
					dust2.velocity -= velocity * 0.5f;
				}
			}
			else if (type == 161)
			{
				SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
				for (int num559 = 0; num559 < 10; num559++)
				{
					int num560 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 11);
					Main.dust[num560].noGravity = true;
					Dust dust2 = Main.dust[num560];
					dust2.velocity -= velocity * 0.5f;
				}
			}
			else if (type >= 191 && type <= 194)
			{
				int num561 = Gore.NewGore(new Vector2(position.X - (float)(width / 2), position.Y - (float)(height / 2)), new Vector2(0f, 0f), Main.rand.Next(61, 64), scale);
				Gore gore2 = Main.gore[num561];
				gore2.velocity *= 0.1f;
			}
			else if (!Main.projPet[type])
			{
				if (type == 93)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num562 = 0; num562 < 10; num562++)
					{
						int num563 = Dust.NewDust(position, width, height, 57, 0f, 0f, 100);
						Main.dust[num563].noGravity = true;
						Main.dust[num563].fadeIn = 1f;
						Main.dust[num563].velocity.X *= 2f;
						Main.dust[num563].velocity.Y *= 2f;
						Main.dust[num563].velocity.Y -= Main.rand.NextFloat() * 1.5f;
					}
				}
				else if (type == 99 || type == 1013 || type == 727 || type == 1014 || type == 1021)
				{
					short num564 = 1;
					num564 = type switch
					{
						1013 => 243, 
						727 => 40, 
						1014 => 12, 
						1021 => 323, 
						_ => 1, 
					};
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num565 = 0; num565 < 30; num565++)
					{
						int num566 = Dust.NewDust(position, width, height, num564);
						if (Main.rand.Next(2) == 0)
						{
							Dust dust2 = Main.dust[num566];
							dust2.scale *= 1.4f;
						}
						velocity *= 1.9f;
					}
					if (type == 1014 && owner == Main.myPlayer)
					{
						int number = Item.NewItem(new EntitySource_Loot(this), position, base.Size, 29);
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, number, 1f);
						}
					}
				}
				else if (type == 1005)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num567 = 0; num567 < 10; num567++)
					{
						int num568 = Dust.NewDust(position, width, height, 1);
						if (Main.rand.Next(2) == 0)
						{
							Dust dust2 = Main.dust[num568];
							dust2.scale *= 1.1f;
						}
						velocity *= 1.6f;
					}
				}
				else if (type == 772)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num569 = 0; num569 < 6; num569++)
					{
						Dust.NewDust(position, width, height, 1);
						velocity *= 1.9f;
					}
					for (int num570 = 0; num570 < 20; num570++)
					{
						Dust dust45 = Dust.NewDustDirect(position, width, height, Main.rand.NextFromList<int>(86, 87, 88, 89, 90), 0f, 0f, 0, default(Color), 0.7f);
						dust45.noGravity = true;
						Dust dust2 = dust45;
						dust2.velocity *= 2.9f;
						dust45.velocity.Y *= 0.8f;
						dust45.fadeIn = 1.1f;
					}
					for (int num571 = 0; num571 < 7; num571++)
					{
						Dust dust46 = Dust.NewDustDirect(position, width, height, Main.rand.NextFromList<int>(86, 87, 88, 89, 90), 0f, 0f, 0, default(Color), 0.7f);
						dust46.noGravity = true;
						Dust dust2 = dust46;
						dust2.velocity *= 2.9f;
						dust46.velocity.Y *= 0.8f;
						dust46.fadeIn = 1.1f;
						dust46.noLight = true;
					}
					if (owner == Main.myPlayer)
					{
						List<int> list = new List<int>();
						list.Add(181);
						list.Add(182);
						list.Add(180);
						list.Add(178);
						list.Add(179);
						list.Add(177);
						list.Add(999);
						List<int> list2 = list;
						int item = list2[Main.rand.Next(list2.Count)];
						list2.Remove(item);
						int stack = Main.rand.Next(3, 7);
						int item2 = list2[Main.rand.Next(list2.Count)];
						list2.Remove(item2);
						int stack2 = Main.rand.Next(3, 7);
						int num572 = Item.NewItem(new EntitySource_Loot(this), position, base.Size, item, stack);
						Main.item[num572].noGrabDelay = 0;
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, num572, 1f);
						}
						num572 = Item.NewItem(new EntitySource_Loot(this), position, base.Size, item2, stack2);
						Main.item[num572].noGrabDelay = 0;
						if (Main.netMode == 1)
						{
							NetMessage.SendData(21, -1, -1, null, num572, 1f);
						}
					}
				}
				else if (type == 763)
				{
					for (int num573 = 0; num573 < 4; num573++)
					{
						int num574 = Dust.NewDust(position, width, height, 40);
						if (Main.rand.Next(2) == 0)
						{
							Dust dust2 = Main.dust[num574];
							dust2.scale *= 0.8f;
						}
						Main.dust[num574].noGravity = true;
						velocity *= 1.9f;
					}
				}
				else if (type == 655)
				{
					SoundEngine.PlaySound(4, (int)position.X, (int)position.Y);
					for (int num575 = 0; num575 < 30; num575++)
					{
						int num576 = Dust.NewDust(position, width, height, 147);
						if (Main.rand.Next(2) == 0)
						{
							Dust dust2 = Main.dust[num576];
							dust2.scale *= 1.4f;
						}
						velocity *= 1.9f;
					}
					if (Main.netMode != 1 && !wet)
					{
						int num577 = 2;
						if (Main.rand.Next(3) == 0)
						{
							num577++;
						}
						if (Main.rand.Next(3) == 0)
						{
							num577++;
						}
						if (Main.rand.Next(3) == 0)
						{
							num577++;
						}
						int availableAmountOfNPCsToSpawnUpToSlot = NPC.GetAvailableAmountOfNPCsToSpawnUpToSlot(num577);
						for (int num578 = 0; num578 < availableAmountOfNPCsToSpawnUpToSlot; num578++)
						{
							int num579 = Main.rand.Next(210, 212);
							int num580 = NPC.NewNPC(GetNPCSource_FromThis(), (int)base.Center.X, (int)base.Center.Y, num579, 1);
							Main.npc[num580].velocity.X = (float)Main.rand.Next(-200, 201) * 0.002f;
							Main.npc[num580].velocity.Y = (float)Main.rand.Next(-200, 201) * 0.002f;
							Main.npc[num580].netUpdate = true;
						}
					}
				}
				else if (type == 728)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num581 = 0; num581 < 7; num581++)
					{
						Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 0.8f);
					}
					for (float num582 = 0f; num582 < 1f; num582 += 0.125f)
					{
						Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num582 * (MathF.PI * 2f) + Main.rand.NextFloat() * 0.5f) * (4f + Main.rand.NextFloat() * 4f), 150, Color.CornflowerBlue).noGravity = true;
					}
					for (float num583 = 0f; num583 < 1f; num583 += 0.25f)
					{
						Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num583 * (MathF.PI * 2f) + Main.rand.NextFloat() * 0.5f) * (2f + Main.rand.NextFloat() * 3f), 150, Color.Gold).noGravity = true;
					}
					Vector2 vector56 = new Vector2(Main.screenWidth, Main.screenHeight);
					if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector56 / 2f, vector56 + new Vector2(400f))))
					{
						for (int num584 = 0; num584 < 7; num584++)
						{
							Gore.NewGore(position, Main.rand.NextVector2CircularEdge(0.5f, 0.5f) * velocity.Length(), Utils.SelectRandom<int>(Main.rand, 16, 17, 17, 17, 17, 17, 17, 17));
						}
					}
				}
				else if (type == 729)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num585 = 0; num585 < 10; num585++)
					{
						Dust dust47 = Dust.NewDustDirect(position, width, height, 279, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
						dust47.noGravity = true;
						dust47.velocity.X *= 2f;
					}
				}
				else if (type == 723 || type == 724 || type == 725 || type == 726 || type == 907)
				{
					if (type == 723)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num586 = 0; num586 < 10; num586++)
						{
							Dust dust48 = Dust.NewDustDirect(position, width, height, 88, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
							dust48.noGravity = true;
							dust48.velocity.X *= 2f;
						}
						for (int num587 = 0; num587 < 3; num587++)
						{
							Gore gore3 = Gore.NewGoreDirect(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), Utils.SelectRandom<int>(Main.rand, 16, 17, 17));
							Gore gore2 = gore3;
							gore2.velocity *= 2f;
						}
						if (owner == Main.myPlayer && Main.player[owner].starCloakCooldown == 0)
						{
							Main.player[owner].starCloakCooldown = 60;
							int number2 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 4143);
							if (Main.netMode == 1)
							{
								NetMessage.SendData(21, -1, -1, null, number2, 1f);
							}
						}
					}
					else
					{
						if (type == 907)
						{
							SoundEngine.PlaySound(SoundID.Item27, position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item10, position);
						}
						for (int num588 = 0; num588 < 10; num588++)
						{
							Dust dust49 = Main.dust[Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f)];
							if (type == 907)
							{
								Dust dust2 = dust49;
								dust2.velocity *= 0.75f;
							}
						}
						for (int num589 = 0; num589 < 3; num589++)
						{
							Gore gore4 = Main.gore[Gore.NewGore(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), Main.rand.Next(16, 18))];
							if (type == 907)
							{
								Gore gore2 = gore4;
								gore2.velocity *= 0.5f;
							}
						}
					}
				}
				else if (type == 91 || type == 92)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num590 = 0; num590 < 10; num590++)
					{
						Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
					}
					for (int num591 = 0; num591 < 3; num591++)
					{
						Gore.NewGore(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), Main.rand.Next(16, 18));
					}
					if ((type == 91 || (type == 92 && ai[0] > 0f)) && owner == Main.myPlayer)
					{
						float x = position.X + (float)Main.rand.Next(-400, 400);
						float y = position.Y - (float)Main.rand.Next(600, 900);
						Vector2 vector57 = new Vector2(x, y);
						float num592 = position.X + (float)(width / 2) - vector57.X;
						float num593 = position.Y + (float)(height / 2) - vector57.Y;
						int num594 = 22;
						float num595 = (float)Math.Sqrt(num592 * num592 + num593 * num593);
						num595 = (float)num594 / num595;
						num592 *= num595;
						num593 *= num595;
						int num596 = damage;
						if (type == 91)
						{
							num596 /= 3;
						}
						int num597 = NewProjectile(GetProjectileSource_FromThis(), x, y, num592, num593, 92, num596, knockBack, owner);
						if (type == 91)
						{
							Main.projectile[num597].ai[1] = position.Y;
							Main.projectile[num597].ai[0] = 1f;
						}
						else
						{
							Main.projectile[num597].ai[1] = position.Y;
						}
					}
				}
				else if (type == 89)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num598 = 0; num598 < 5; num598++)
					{
						int num599 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 68);
						Main.dust[num599].noGravity = true;
						Dust dust2 = Main.dust[num599];
						dust2.velocity *= 1.5f;
						dust2 = Main.dust[num599];
						dust2.scale *= 0.9f;
					}
					if (type == 89 && owner == Main.myPlayer)
					{
						for (int num600 = 0; num600 < 2; num600++)
						{
							float num601 = (0f - velocity.X) * (float)Main.rand.Next(40, 70) * 0.01f + (float)Main.rand.Next(-20, 21) * 0.4f;
							float num602 = (0f - velocity.Y) * (float)Main.rand.Next(40, 70) * 0.01f + (float)Main.rand.Next(-20, 21) * 0.4f;
							NewProjectile(GetProjectileSource_FromThis(), position.X + num601, position.Y + num602, num601, num602, 90, (int)((double)damage * 0.5), 0f, owner);
						}
					}
				}
				else if (type == 967)
				{
					SoundEngine.PlaySound(SoundID.Item45, position);
					for (int num603 = 0; num603 < 20; num603++)
					{
						int num604 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 219, velocity.X, velocity.Y, 0, default(Color), 0.5f + (float)Main.rand.Next(-20, 40) * 0.01f);
						Main.dust[num604].noGravity = true;
						Main.dust[num604].velocity = Main.rand.NextVector2Circular(6f, 6f);
					}
				}
				else if (type == 969)
				{
					ActiveSound activeSound2 = SoundEngine.GetActiveSound(SlotId.FromFloat(localAI[1]));
					if (activeSound2 != null)
					{
						activeSound2.Volume = 0f;
						activeSound2.Stop();
					}
				}
				else if (type == 177)
				{
					for (int num605 = 0; num605 < 20; num605++)
					{
						int num606 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 137, 0f, 0f, Main.rand.Next(0, 101), default(Color), 1f + (float)Main.rand.Next(-20, 40) * 0.01f);
						Dust dust2 = Main.dust[num606];
						dust2.velocity -= oldVelocity * 0.2f;
						if (Main.rand.Next(3) == 0)
						{
							dust2 = Main.dust[num606];
							dust2.scale *= 0.8f;
							dust2 = Main.dust[num606];
							dust2.velocity *= 0.5f;
						}
						else
						{
							Main.dust[num606].noGravity = true;
						}
					}
				}
				else if (type == 119 || type == 118 || type == 128 || type == 359)
				{
					int num607 = 10;
					if (type == 119 || type == 359)
					{
						num607 = 20;
					}
					SoundEngine.PlaySound(SoundID.Item27, position);
					for (int num608 = 0; num608 < num607; num608++)
					{
						int num609 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 92);
						if (Main.rand.Next(3) != 0)
						{
							Dust dust2 = Main.dust[num609];
							dust2.velocity *= 2f;
							Main.dust[num609].noGravity = true;
							dust2 = Main.dust[num609];
							dust2.scale *= 1.75f;
						}
						else
						{
							Dust dust2 = Main.dust[num609];
							dust2.scale *= 0.5f;
						}
					}
				}
				else if (type == 309)
				{
					int num610 = 10;
					SoundEngine.PlaySound(SoundID.Item27, position);
					for (int num611 = 0; num611 < num610; num611++)
					{
						int num612 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 185);
						if (Main.rand.Next(2) == 0)
						{
							Dust dust2 = Main.dust[num612];
							dust2.velocity *= 2f;
							Main.dust[num612].noGravity = true;
							dust2 = Main.dust[num612];
							dust2.scale *= 1.75f;
						}
					}
				}
				else if (type == 308)
				{
					int num613 = 80;
					SoundEngine.PlaySound(SoundID.Item27, position);
					for (int num614 = 0; num614 < num613; num614++)
					{
						int num615 = Dust.NewDust(new Vector2(position.X, position.Y + 16f), width, height - 16, 185);
						Dust dust2 = Main.dust[num615];
						dust2.velocity *= 2f;
						Main.dust[num615].noGravity = true;
						dust2 = Main.dust[num615];
						dust2.scale *= 1.15f;
					}
				}
				else if (aiStyle == 29 && type <= 126)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					int num616 = type - 121 + 86;
					for (int num617 = 0; num617 < 15; num617++)
					{
						int num618 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num616, oldVelocity.X, oldVelocity.Y, 50, default(Color), 1.2f);
						Main.dust[num618].noGravity = true;
						Dust dust2 = Main.dust[num618];
						dust2.scale *= 1.25f;
						dust2 = Main.dust[num618];
						dust2.velocity *= 0.5f;
					}
				}
				else if (type == 597)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num619 = 0; num619 < 15; num619++)
					{
						int num620 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 262, oldVelocity.X, oldVelocity.Y, 50, default(Color), 1.2f);
						Main.dust[num620].noGravity = true;
						Dust dust2 = Main.dust[num620];
						dust2.scale *= 1.25f;
						dust2 = Main.dust[num620];
						dust2.velocity *= 0.5f;
					}
				}
				else if (type == 731)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num621 = 0; num621 < 15; num621++)
					{
						Dust dust50 = Dust.NewDustDirect(position, width, height, 226, oldVelocity.X * 0.5f, oldVelocity.Y * 0.5f, 50, default(Color), 0.5f);
						if (Main.rand.Next(3) != 0)
						{
							dust50.noGravity = true;
							Dust dust2 = dust50;
							dust2.scale *= 1.5f;
							dust2 = dust50;
							dust2.velocity *= 0.5f;
						}
					}
				}
				else if (type == 337)
				{
					SoundEngine.PlaySound(SoundID.Item27, position);
					for (int num622 = 0; num622 < 10; num622++)
					{
						int num623 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 197);
						Main.dust[num623].noGravity = true;
					}
				}
				else if (type == 379 || type == 377)
				{
					for (int num624 = 0; num624 < 5; num624++)
					{
						int num625 = Dust.NewDust(position, width, height, 171, 0f, 0f, 100);
						Main.dust[num625].scale = (float)Main.rand.Next(1, 10) * 0.1f;
						Main.dust[num625].noGravity = true;
						Main.dust[num625].fadeIn = 1.5f;
						Dust dust2 = Main.dust[num625];
						dust2.velocity *= 0.75f;
					}
				}
				else if (type == 80)
				{
					if (ai[0] >= 0f)
					{
						SoundEngine.PlaySound(SoundID.Item27, position);
						for (int num626 = 0; num626 < 10; num626++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 67);
						}
					}
					int num627 = (int)position.X / 16;
					int num628 = (int)position.Y / 16;
					if (Main.tile[num627, num628] == null)
					{
						Main.tile[num627, num628] = new Tile();
					}
					if (Main.tile[num627, num628].type == 127 && Main.tile[num627, num628].active())
					{
						WorldGen.KillTile(num627, num628);
					}
				}
				else if (type == 76 || type == 77 || type == 78)
				{
					for (int num629 = 0; num629 < 5; num629++)
					{
						int num630 = Dust.NewDust(position, width, height, 27, 0f, 0f, 80, default(Color), 1.5f);
						Main.dust[num630].noGravity = true;
					}
				}
				else if (type == 55 || type == 719)
				{
					for (int num631 = 0; num631 < 5; num631++)
					{
						int num632 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 18, 0f, 0f, 0, default(Color), 1.5f);
						Main.dust[num632].noGravity = true;
					}
				}
				else if (type == 51 || type == 267)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num633 = 0; num633 < 5; num633++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 0, 0f, 0f, 0, default(Color), 0.7f);
					}
				}
				else if (type == 478)
				{
					if (owner == Main.myPlayer)
					{
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, 0f, 0f, 480, (int)((double)damage * 0.8), knockBack * 0.5f, owner);
					}
				}
				else if (type == 477 || type == 479)
				{
					for (int num634 = 0; num634 < 5; num634++)
					{
					}
					Collision.HitTiles(position, velocity, width, height);
				}
				else if (type == 2 || type == 82)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num635 = 0; num635 < 10; num635++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100);
					}
				}
				else if (type == 474)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num636 = 0; num636 < 20; num636++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 26, 0f, 0f, 0, default(Color), 0.9f);
					}
				}
				else if (type == 172)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num637 = 0; num637 < 20; num637++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, 0f, 0f, 100);
					}
				}
				else if (type == 103)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num638 = 0; num638 < 20; num638++)
					{
						int num639 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 75, 0f, 0f, 100);
						if (Main.rand.Next(2) == 0)
						{
							Dust dust2 = Main.dust[num639];
							dust2.scale *= 2.5f;
							Main.dust[num639].noGravity = true;
							dust2 = Main.dust[num639];
							dust2.velocity *= 5f;
						}
					}
				}
				else if (type == 278)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num640 = 0; num640 < 20; num640++)
					{
						int num641 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 169, 0f, 0f, 100);
						if (Main.rand.Next(2) == 0)
						{
							Dust dust2 = Main.dust[num641];
							dust2.scale *= 1.5f;
							Main.dust[num641].noGravity = true;
							dust2 = Main.dust[num641];
							dust2.velocity *= 5f;
						}
					}
				}
				else if (type == 3 || type == 48 || type == 54 || type == 599 || type == 909)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num642 = 0; num642 < 10; num642++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 1, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.75f);
					}
				}
				else if (type == 330)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num643 = 0; num643 < 10; num643++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 0, velocity.X * 0.4f, velocity.Y * 0.4f, 0, default(Color), 0.75f);
					}
				}
				else if (type == 4)
				{
					SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
					for (int num644 = 0; num644 < 10; num644++)
					{
						Dust.NewDust(new Vector2(position.X, position.Y), width, height, 14, 0f, 0f, 150, default(Color), 1.1f);
					}
				}
				else if (type == 5)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					for (int num645 = 0; num645 < 60; num645++)
					{
						int num646 = Main.rand.Next(3);
						Dust.NewDust(position, width, height, num646 switch
						{
							0 => 15, 
							1 => 57, 
							_ => 58, 
						}, velocity.X * 0.5f, velocity.Y * 0.5f, 150, default(Color), 1.5f);
					}
				}
				else if (type == 9 || type == 12 || type == 503 || type == 955)
				{
					SoundEngine.PlaySound(SoundID.Item10, position);
					if (type == 12 || type == 955)
					{
						Color newColor8 = Color.CornflowerBlue;
						if (Main.tenthAnniversaryWorld && (type == 12 || type == 955))
						{
							newColor8 = Color.HotPink;
							newColor8.A /= 2;
						}
						for (int num647 = 0; num647 < 7; num647++)
						{
							Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 0.8f);
						}
						for (float num648 = 0f; num648 < 1f; num648 += 0.125f)
						{
							Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num648 * (MathF.PI * 2f) + Main.rand.NextFloat() * 0.5f) * (4f + Main.rand.NextFloat() * 4f), 150, newColor8).noGravity = true;
						}
						for (float num649 = 0f; num649 < 1f; num649 += 0.25f)
						{
							Dust.NewDustPerfect(base.Center, 278, Vector2.UnitY.RotatedBy(num649 * (MathF.PI * 2f) + Main.rand.NextFloat() * 0.5f) * (2f + Main.rand.NextFloat() * 3f), 150, Color.Gold).noGravity = true;
						}
						Vector2 vector58 = new Vector2(Main.screenWidth, Main.screenHeight);
						if (base.Hitbox.Intersects(Utils.CenteredRectangle(Main.screenPosition + vector58 / 2f, vector58 + new Vector2(400f))))
						{
							for (int num650 = 0; num650 < 7; num650++)
							{
								Gore.NewGore(position, Main.rand.NextVector2CircularEdge(0.5f, 0.5f) * velocity.Length(), Utils.SelectRandom<int>(Main.rand, 16, 17, 17, 17, 17, 17, 17, 17));
							}
						}
					}
					else
					{
						int num651 = 10;
						int num652 = 3;
						if (type == 503)
						{
							num651 = 40;
							num652 = 2;
							velocity /= 2f;
						}
						for (int num653 = 0; num653 < num651; num653++)
						{
							Dust.NewDust(position, width, height, 58, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
						}
						for (int num654 = 0; num654 < num652; num654++)
						{
							int num655 = Main.rand.Next(16, 18);
							if (type == 503)
							{
								num655 = 16;
							}
							Gore.NewGore(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), num655);
						}
						if (type == 12 && damage < 100)
						{
							for (int num656 = 0; num656 < 10; num656++)
							{
								Dust.NewDust(position, width, height, 57, velocity.X * 0.1f, velocity.Y * 0.1f, 150, default(Color), 1.2f);
							}
							for (int num657 = 0; num657 < 3; num657++)
							{
								Gore.NewGore(position, new Vector2(velocity.X * 0.05f, velocity.Y * 0.05f), Main.rand.Next(16, 18));
							}
						}
					}
				}
				else if (type == 281)
				{
					if (ai[0] != -3f)
					{
						SoundEngine.PlaySound(4, (int)position.X, (int)position.Y);
						int num658 = Gore.NewGore(position, new Vector2((float)Main.rand.Next(-20, 21) * 0.2f, (float)Main.rand.Next(-20, 21) * 0.2f), 76);
						Gore gore2 = Main.gore[num658];
						gore2.velocity -= velocity * 0.5f;
						num658 = Gore.NewGore(new Vector2(position.X, position.Y), new Vector2((float)Main.rand.Next(-20, 21) * 0.2f, (float)Main.rand.Next(-20, 21) * 0.2f), 77);
						gore2 = Main.gore[num658];
						gore2.velocity -= velocity * 0.5f;
						SoundEngine.PlaySound(SoundID.Item14, position);
						for (int num659 = 0; num659 < 20; num659++)
						{
							int num660 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num660];
							dust2.velocity *= 1.4f;
						}
						for (int num661 = 0; num661 < 10; num661++)
						{
							int num662 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
							Main.dust[num662].noGravity = true;
							Dust dust2 = Main.dust[num662];
							dust2.velocity *= 5f;
							num662 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust2 = Main.dust[num662];
							dust2.velocity *= 3f;
						}
						num658 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num658];
						gore2.velocity *= 0.4f;
						Main.gore[num658].velocity.X += 1f;
						Main.gore[num658].velocity.Y += 1f;
						num658 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num658];
						gore2.velocity *= 0.4f;
						Main.gore[num658].velocity.X -= 1f;
						Main.gore[num658].velocity.Y += 1f;
						num658 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num658];
						gore2.velocity *= 0.4f;
						Main.gore[num658].velocity.X += 1f;
						Main.gore[num658].velocity.Y -= 1f;
						num658 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num658];
						gore2.velocity *= 0.4f;
						Main.gore[num658].velocity.X -= 1f;
						Main.gore[num658].velocity.Y -= 1f;
						if (damage > 0)
						{
							position.X += width / 2;
							position.Y += height / 2;
							width = 128;
							height = 128;
							position.X -= width / 2;
							position.Y -= height / 2;
							if (ai[0] == -2f)
							{
								hostile = true;
							}
							Damage();
						}
					}
				}
				else if (type == 162)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					for (int num663 = 0; num663 < 20; num663++)
					{
						int num664 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num664];
						dust2.velocity *= 1.4f;
					}
					for (int num665 = 0; num665 < 10; num665++)
					{
						int num666 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num666].noGravity = true;
						Dust dust2 = Main.dust[num666];
						dust2.velocity *= 5f;
						num666 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num666];
						dust2.velocity *= 3f;
					}
					int num667 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num667];
					gore2.velocity *= 0.4f;
					Main.gore[num667].velocity.X += 1f;
					Main.gore[num667].velocity.Y += 1f;
					num667 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num667];
					gore2.velocity *= 0.4f;
					Main.gore[num667].velocity.X -= 1f;
					Main.gore[num667].velocity.Y += 1f;
					num667 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num667];
					gore2.velocity *= 0.4f;
					Main.gore[num667].velocity.X += 1f;
					Main.gore[num667].velocity.Y -= 1f;
					num667 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num667];
					gore2.velocity *= 0.4f;
					Main.gore[num667].velocity.X -= 1f;
					Main.gore[num667].velocity.Y -= 1f;
					position.X += width / 2;
					position.Y += height / 2;
					width = 128;
					height = 128;
					position.X -= width / 2;
					position.Y -= height / 2;
					Damage();
				}
				else if (type == 240)
				{
					SoundEngine.PlaySound(SoundID.Item14, position);
					for (int num668 = 0; num668 < 20; num668++)
					{
						int num669 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						Dust dust2 = Main.dust[num669];
						dust2.velocity *= 1.4f;
					}
					for (int num670 = 0; num670 < 10; num670++)
					{
						int num671 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
						Main.dust[num671].noGravity = true;
						Dust dust2 = Main.dust[num671];
						dust2.velocity *= 5f;
						num671 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
						dust2 = Main.dust[num671];
						dust2.velocity *= 3f;
					}
					int num672 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					Gore gore2 = Main.gore[num672];
					gore2.velocity *= 0.4f;
					Main.gore[num672].velocity.X += 1f;
					Main.gore[num672].velocity.Y += 1f;
					num672 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num672];
					gore2.velocity *= 0.4f;
					Main.gore[num672].velocity.X -= 1f;
					Main.gore[num672].velocity.Y += 1f;
					num672 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num672];
					gore2.velocity *= 0.4f;
					Main.gore[num672].velocity.X += 1f;
					Main.gore[num672].velocity.Y -= 1f;
					num672 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
					gore2 = Main.gore[num672];
					gore2.velocity *= 0.4f;
					Main.gore[num672].velocity.X -= 1f;
					Main.gore[num672].velocity.Y -= 1f;
					position.X += width / 2;
					position.Y += height / 2;
					width = 96;
					height = 96;
					position.X -= width / 2;
					position.Y -= height / 2;
					Damage();
				}
				else
				{
					_ = type;
					_ = 162;
					if (type == 283 || type == 282)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num673 = 0; num673 < 10; num673++)
						{
							int num674 = Dust.NewDust(position, width, height, 171, 0f, 0f, 100);
							Main.dust[num674].scale = (float)Main.rand.Next(1, 10) * 0.1f;
							Main.dust[num674].noGravity = true;
							Main.dust[num674].fadeIn = 1.5f;
							Dust dust2 = Main.dust[num674];
							dust2.velocity *= 0.75f;
						}
					}
					else if (type == 284)
					{
						for (int num675 = 0; num675 < 10; num675++)
						{
							int num676 = Main.rand.Next(139, 143);
							int num677 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num676, (0f - velocity.X) * 0.3f, (0f - velocity.Y) * 0.3f, 0, default(Color), 1.2f);
							Main.dust[num677].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
							Main.dust[num677].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
							Main.dust[num677].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
							Main.dust[num677].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
							Main.dust[num677].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
							Main.dust[num677].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
							Dust dust2 = Main.dust[num677];
							dust2.scale *= 1f + (float)Main.rand.Next(-30, 31) * 0.01f;
						}
						for (int num678 = 0; num678 < 5; num678++)
						{
							int num679 = Main.rand.Next(276, 283);
							int num680 = Gore.NewGore(position, -velocity * 0.3f, num679);
							Main.gore[num680].velocity.X += (float)Main.rand.Next(-50, 51) * 0.01f;
							Main.gore[num680].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.01f;
							Main.gore[num680].velocity.X *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
							Main.gore[num680].velocity.Y *= 1f + (float)Main.rand.Next(-50, 51) * 0.01f;
							Gore gore2 = Main.gore[num680];
							gore2.scale *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
							Main.gore[num680].velocity.X += (float)Main.rand.Next(-50, 51) * 0.05f;
							Main.gore[num680].velocity.Y += (float)Main.rand.Next(-50, 51) * 0.05f;
						}
					}
					else if (type == 286)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						for (int num681 = 0; num681 < 7; num681++)
						{
							int num682 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						}
						for (int num683 = 0; num683 < 3; num683++)
						{
							int num684 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
							Main.dust[num684].noGravity = true;
							Dust dust2 = Main.dust[num684];
							dust2.velocity *= 3f;
							num684 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust2 = Main.dust[num684];
							dust2.velocity *= 2f;
						}
						int num685 = Gore.NewGore(new Vector2(position.X - 10f, position.Y - 10f), default(Vector2), Main.rand.Next(61, 64));
						Gore gore2 = Main.gore[num685];
						gore2.velocity *= 0.3f;
						Main.gore[num685].velocity.X += (float)Main.rand.Next(-10, 11) * 0.05f;
						Main.gore[num685].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.05f;
						if (owner == Main.myPlayer)
						{
							localAI[1] = -1f;
							maxPenetrate = 0;
							position.X += width / 2;
							position.Y += height / 2;
							width = 80;
							height = 80;
							position.X -= width / 2;
							position.Y -= height / 2;
							Damage();
						}
					}
					else if (type == 14 || type == 20 || type == 36 || type == 83 || type == 84 || type == 389 || type == 104 || type == 279 || type == 100 || type == 110 || type == 180 || type == 207 || type == 357 || type == 242 || type == 302 || type == 257 || type == 259 || type == 285 || type == 287 || type == 576 || type == 577 || type == 876 || type == 968)
					{
						Collision.HitTiles(position, velocity, width, height);
						SoundEngine.PlaySound(SoundID.Item10, position);
					}
					else if (type == 981)
					{
						Collision.HitTiles(position, velocity, width, height);
						SoundEngine.PlaySound(SoundID.Item10, position);
						ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.SilverBulletSparkle, new ParticleOrchestraSettings
						{
							PositionInWorld = base.Center,
							MovementVector = Vector2.Zero
						}, owner);
					}
					else if (type == 1006)
					{
						Collision.HitTiles(position, velocity, width, height);
						SoundEngine.PlaySound(0, position);
						float num686 = Main.rand.NextFloat() * (MathF.PI * 2f);
						for (float num687 = 0f; num687 < 1f; num687 += 1f)
						{
							float num688 = num686 + MathF.PI * 2f * num687;
							Vector2 vector59 = Vector2.UnitX.RotatedBy(num688);
							Vector2 center = base.Center;
							float num689 = 0.4f;
							ParticleOrchestrator.RequestParticleSpawn(clientOnly: true, ParticleOrchestraType.ShimmerArrow, new ParticleOrchestraSettings
							{
								PositionInWorld = center,
								MovementVector = vector59 * num689
							}, owner);
						}
					}
					else if (type == 660)
					{
						Collision.HitTiles(position, velocity, width, height);
						SoundEngine.PlaySound(SoundID.Item10, position);
						int num690 = Main.rand.Next(4, 10);
						for (int num691 = 0; num691 < num690; num691++)
						{
							int num692 = Dust.NewDust(base.Center, 0, 0, 180, 0f, 0f, 100);
							Dust dust2 = Main.dust[num692];
							dust2.velocity *= 1.6f;
							Main.dust[num692].velocity.Y -= 1f;
							dust2 = Main.dust[num692];
							dust2.velocity += -velocity * (Main.rand.NextFloat() * 2f - 1f) * 0.5f;
							Main.dust[num692].scale = 2f;
							Main.dust[num692].fadeIn = 0.5f;
							Main.dust[num692].noGravity = true;
						}
					}
					else if (type == 761 || type == 762)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						if (owner == Main.myPlayer && !noDropItem)
						{
							int num693 = 4343;
							if (type == 762)
							{
								num693 = 4344;
							}
							int num694 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, num693);
							Main.item[num694].noGrabDelay = 0;
							if (Main.netMode == 1 && num694 >= 0)
							{
								NetMessage.SendData(21, -1, -1, null, num694, 1f);
							}
						}
					}
					else if (type == 712)
					{
						Collision.HitTiles(position, velocity, width, height);
						SoundEngine.PlaySound(SoundID.Item10, position);
						int num695 = Main.rand.Next(6, 12);
						for (int num696 = 0; num696 < num695; num696++)
						{
							int num697 = Dust.NewDust(base.Center, 0, 0, 15, 0f, 0f, 100);
							Dust dust2 = Main.dust[num697];
							dust2.velocity *= 1.6f;
							Main.dust[num697].velocity.Y -= 1f;
							dust2 = Main.dust[num697];
							dust2.velocity += -velocity * (Main.rand.NextFloat() * 2f - 1f) * 0.5f;
							Main.dust[num697].scale = 1f;
							Main.dust[num697].fadeIn = 1.5f;
							Main.dust[num697].noGravity = true;
							Main.dust[num697].color = new Color(255, 255, 255, 0) * 0.3f;
							dust2 = Main.dust[num697];
							dust2.velocity *= 0.7f;
							dust2 = Main.dust[num697];
							dust2.position += Main.dust[num697].velocity * 5f;
						}
						for (int num698 = 0; num698 < 3; num698++)
						{
							Gore gore5 = Gore.NewGoreDirect(position, Vector2.Zero, 1008, 1f + Main.rand.NextFloatDirection() * 0.2f);
							Gore gore2 = gore5;
							gore2.velocity *= 4f;
						}
					}
					else if (type == 638)
					{
						Collision.HitTiles(position, velocity, width, height);
						SoundEngine.PlaySound(SoundID.Item10, position);
						int num699 = Main.rand.Next(2, 5);
						for (int num700 = 0; num700 < num699; num700++)
						{
							int num701 = Dust.NewDust(base.Center, 0, 0, 229, 0f, 0f, 100);
							Dust dust2 = Main.dust[num701];
							dust2.velocity *= 1.6f;
							Main.dust[num701].velocity.Y -= 1f;
							dust2 = Main.dust[num701];
							dust2.position -= Vector2.One * 4f;
							Main.dust[num701].position = Vector2.Lerp(Main.dust[num701].position, base.Center, 0.5f);
							Main.dust[num701].noGravity = true;
						}
					}
					else if (type == 15 || type == 321)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num702 = 0; num702 < 20; num702++)
						{
							int num703 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 2f);
							Main.dust[num703].noGravity = true;
							Dust dust2 = Main.dust[num703];
							dust2.velocity *= 2f;
							num703 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
							dust2 = Main.dust[num703];
							dust2.velocity *= 2f;
						}
					}
					else if (type == 253)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num704 = 0; num704 < 20; num704++)
						{
							int num705 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 2f);
							Main.dust[num705].noGravity = true;
							Dust dust2 = Main.dust[num705];
							dust2.velocity *= 2f;
							num705 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 135, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100);
							dust2 = Main.dust[num705];
							dust2.velocity *= 2f;
						}
					}
					else if (type == 95 || type == 96)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num706 = 0; num706 < 20; num706++)
						{
							int num707 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 75, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 2f * scale);
							Main.dust[num707].noGravity = true;
							Dust dust2 = Main.dust[num707];
							dust2.velocity *= 2f;
							num707 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 75, (0f - velocity.X) * 0.2f, (0f - velocity.Y) * 0.2f, 100, default(Color), 1f * scale);
							dust2 = Main.dust[num707];
							dust2.velocity *= 2f;
						}
					}
					else if (type == 17)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num708 = 0; num708 < 5; num708++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 0);
						}
					}
					else if (type == 31 || type == 42)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num709 = 0; num709 < 5; num709++)
						{
							int num710 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 32);
							Dust dust2 = Main.dust[num710];
							dust2.velocity *= 0.6f;
						}
					}
					else if (type >= 411 && type <= 414)
					{
						int num711 = 9;
						if (type == 412 || type == 414)
						{
							num711 = 11;
						}
						if (type == 413)
						{
							num711 = 19;
						}
						for (int num712 = 0; num712 < 5; num712++)
						{
							int num713 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, num711, 0f, velocity.Y / 2f);
							Main.dust[num713].noGravity = true;
							Dust dust2 = Main.dust[num713];
							dust2.velocity -= velocity * 0.5f;
						}
					}
					else if (type == 109)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num714 = 0; num714 < 5; num714++)
						{
							int num715 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 51, 0f, 0f, 0, default(Color), 0.6f);
							Dust dust2 = Main.dust[num715];
							dust2.velocity *= 0.6f;
						}
					}
					else if (type == 39)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num716 = 0; num716 < 5; num716++)
						{
							int num717 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 38);
							Dust dust2 = Main.dust[num717];
							dust2.velocity *= 0.6f;
						}
					}
					else if (type == 71)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num718 = 0; num718 < 5; num718++)
						{
							int num719 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 53);
							Dust dust2 = Main.dust[num719];
							dust2.velocity *= 0.6f;
						}
					}
					else if (type == 179)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num720 = 0; num720 < 5; num720++)
						{
							int num721 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 149);
							Dust dust2 = Main.dust[num721];
							dust2.velocity *= 0.6f;
						}
					}
					else if (type == 40)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num722 = 0; num722 < 5; num722++)
						{
							int num723 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 36);
							Dust dust2 = Main.dust[num723];
							dust2.velocity *= 0.6f;
						}
					}
					else if (type == 21 || type == 471 || type == 532)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num724 = 0; num724 < 10; num724++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 26, 0f, 0f, 0, default(Color), 0.8f);
						}
					}
					else if (type == 583)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num725 = 0; num725 < 10; num725++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, 100, new Color(20, 250, 20, 240), 0.8f);
						}
					}
					else if (type == 584)
					{
						SoundEngine.PlaySound(0, (int)position.X, (int)position.Y);
						for (int num726 = 0; num726 < 10; num726++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, 100, new Color(250, 20, 120, 240), 0.8f);
						}
					}
					else if (type == 24)
					{
						for (int num727 = 0; num727 < 10; num727++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 1, velocity.X * 0.1f, velocity.Y * 0.1f, 0, default(Color), 0.75f);
						}
					}
					else if (type == 27)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num728 = 0; num728 < 30; num728++)
						{
							int num729 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 172, velocity.X * 0.1f, velocity.Y * 0.1f, 100);
							Main.dust[num729].noGravity = true;
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 172, velocity.X * 0.1f, velocity.Y * 0.1f, 100, default(Color), 0.5f);
						}
					}
					else if (type == 38)
					{
						for (int num730 = 0; num730 < 10; num730++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 42, velocity.X * 0.1f, velocity.Y * 0.1f);
						}
					}
					else if (type == 44 || type == 45)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num731 = 0; num731 < 30; num731++)
						{
							int num732 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, velocity.X, velocity.Y, 100, default(Color), 1.7f);
							Main.dust[num732].noGravity = true;
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 27, velocity.X, velocity.Y, 100);
						}
					}
					else if (type == 41)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						for (int num733 = 0; num733 < 10; num733++)
						{
							int num734 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
						}
						for (int num735 = 0; num735 < 5; num735++)
						{
							int num736 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
							Main.dust[num736].noGravity = true;
							Dust dust2 = Main.dust[num736];
							dust2.velocity *= 3f;
							num736 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust2 = Main.dust[num736];
							dust2.velocity *= 2f;
						}
						int num737 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						Gore gore2 = Main.gore[num737];
						gore2.velocity *= 0.4f;
						Main.gore[num737].velocity.X += (float)Main.rand.Next(-10, 11) * 0.1f;
						Main.gore[num737].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.1f;
						num737 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num737];
						gore2.velocity *= 0.4f;
						Main.gore[num737].velocity.X += (float)Main.rand.Next(-10, 11) * 0.1f;
						Main.gore[num737].velocity.Y += (float)Main.rand.Next(-10, 11) * 0.1f;
						if (owner == Main.myPlayer)
						{
							penetrate = -1;
							position.X += width / 2;
							position.Y += height / 2;
							width = 64;
							height = 64;
							position.X -= width / 2;
							position.Y -= height / 2;
							Damage();
						}
					}
					else if (type == 514)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						for (int num738 = 0; num738 < 10; num738++)
						{
							int num739 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.3f);
							Dust dust2 = Main.dust[num739];
							dust2.velocity *= 1.4f;
						}
						for (int num740 = 0; num740 < 6; num740++)
						{
							int num741 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.1f);
							Main.dust[num741].noGravity = true;
							Dust dust2 = Main.dust[num741];
							dust2.velocity *= 4.6f;
							num741 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.3f);
							dust2 = Main.dust[num741];
							dust2.velocity *= 3.3f;
							if (Main.rand.Next(2) == 0)
							{
								num741 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.1f);
								dust2 = Main.dust[num741];
								dust2.velocity *= 2.7f;
							}
						}
						if (owner == Main.myPlayer)
						{
							penetrate = -1;
							position.X += width / 2;
							position.Y += height / 2;
							width = 112;
							height = 112;
							position.X -= width / 2;
							position.Y -= height / 2;
							ai[0] = 2f;
							Damage();
						}
					}
					else if (type == 306)
					{
						SoundEngine.PlaySound(3, (int)position.X, (int)position.Y);
						for (int num742 = 0; num742 < 20; num742++)
						{
							int num743 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 184);
							Dust dust2 = Main.dust[num743];
							dust2.scale *= 1.1f;
							Main.dust[num743].noGravity = true;
						}
						for (int num744 = 0; num744 < 30; num744++)
						{
							int num745 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 184);
							Dust dust2 = Main.dust[num745];
							dust2.velocity *= 2.5f;
							dust2 = Main.dust[num745];
							dust2.scale *= 0.8f;
							Main.dust[num745].noGravity = true;
						}
						if (owner == Main.myPlayer)
						{
							int num746 = Main.rand.Next(2, 5);
							if (Main.rand.Next(1, 101) == 100)
							{
								num746 = 15;
							}
							for (int num747 = 0; num747 < num746; num747++)
							{
								float num748 = (float)Main.rand.Next(-35, 36) * 0.02f;
								float num749 = (float)Main.rand.Next(-35, 36) * 0.02f;
								num748 *= 10f;
								num749 *= 10f;
								NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, num748, num749, 307, (int)((double)damage * 0.75), (int)((double)knockBack * 0.35), Main.myPlayer);
							}
						}
					}
					else if (type == 469)
					{
						if (owner == Main.myPlayer)
						{
							int num750 = 6;
							for (int num751 = 0; num751 < num750; num751++)
							{
								if (num751 % 2 != 1 || Main.rand.Next(3) == 0)
								{
									Vector2 vector60 = position;
									Vector2 vector61 = oldVelocity;
									vector61.Normalize();
									vector61 *= 8f;
									float num752 = (float)Main.rand.Next(-35, 36) * 0.01f;
									float num753 = (float)Main.rand.Next(-35, 36) * 0.01f;
									vector60 -= vector61 * num751;
									num752 += oldVelocity.X / 6f;
									num753 += oldVelocity.Y / 6f;
									int num754 = NewProjectile(GetProjectileSource_FromThis(), vector60.X, vector60.Y, num752, num753, Main.player[owner].beeType(), Main.player[owner].beeDamage(damage / 3), Main.player[owner].beeKB(0f), Main.myPlayer);
									Main.projectile[num754].magic = false;
									Main.projectile[num754].ranged = true;
									Main.projectile[num754].penetrate = 2;
								}
							}
						}
					}
					else if (type == 183)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						for (int num755 = 0; num755 < 20; num755++)
						{
							int num756 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num756];
							dust2.velocity *= 1f;
						}
						int num757 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num757].velocity.X += 1f;
						Main.gore[num757].velocity.Y += 1f;
						Gore gore2 = Main.gore[num757];
						gore2.velocity *= 0.3f;
						num757 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num757].velocity.X -= 1f;
						Main.gore[num757].velocity.Y += 1f;
						gore2 = Main.gore[num757];
						gore2.velocity *= 0.3f;
						num757 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num757].velocity.X += 1f;
						Main.gore[num757].velocity.Y -= 1f;
						gore2 = Main.gore[num757];
						gore2.velocity *= 0.3f;
						num757 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						Main.gore[num757].velocity.X -= 1f;
						Main.gore[num757].velocity.Y -= 1f;
						gore2 = Main.gore[num757];
						gore2.velocity *= 0.3f;
						if (owner == Main.myPlayer)
						{
							int num758 = Main.rand.Next(15, 25);
							for (int num759 = 0; num759 < num758; num759++)
							{
								float speedX = (float)Main.rand.Next(-35, 36) * 0.02f;
								float speedY = (float)Main.rand.Next(-35, 36) * 0.02f;
								NewProjectile(GetProjectileSource_FromThis(), position.X, position.Y, speedX, speedY, Main.player[owner].beeType(), Main.player[owner].beeDamage(damage), Main.player[owner].beeKB(0f), Main.myPlayer);
							}
						}
					}
					else if (aiStyle == 34)
					{
						if (owner != Main.myPlayer)
						{
							timeLeft = 60;
						}
						SoundEngine.PlaySound(SoundID.Item14, position);
						if (type == 167)
						{
							for (int num760 = 0; num760 < 400; num760++)
							{
								float num761 = 16f;
								if (num760 < 300)
								{
									num761 = 12f;
								}
								if (num760 < 200)
								{
									num761 = 8f;
								}
								if (num760 < 100)
								{
									num761 = 4f;
								}
								int num762 = 130;
								int num763 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num762, 0f, 0f, 100);
								float num764 = Main.dust[num763].velocity.X;
								float y2 = Main.dust[num763].velocity.Y;
								if (num764 == 0f && y2 == 0f)
								{
									num764 = 1f;
								}
								float num765 = (float)Math.Sqrt(num764 * num764 + y2 * y2);
								num765 = num761 / num765;
								num764 *= num765;
								y2 *= num765;
								Dust dust2 = Main.dust[num763];
								dust2.velocity *= 0.5f;
								Main.dust[num763].velocity.X += num764;
								Main.dust[num763].velocity.Y += y2;
								Main.dust[num763].scale = 1.3f;
								Main.dust[num763].noGravity = true;
							}
						}
						if (type == 168)
						{
							for (int num766 = 0; num766 < 400; num766++)
							{
								float num767 = 2f * ((float)num766 / 100f);
								if (num766 > 100)
								{
									num767 = 10f;
								}
								if (num766 > 250)
								{
									num767 = 13f;
								}
								int num768 = 131;
								int num769 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num768, 0f, 0f, 100);
								float num770 = Main.dust[num769].velocity.X;
								float y3 = Main.dust[num769].velocity.Y;
								if (num770 == 0f && y3 == 0f)
								{
									num770 = 1f;
								}
								float num771 = (float)Math.Sqrt(num770 * num770 + y3 * y3);
								num771 = num767 / num771;
								if (num766 <= 200)
								{
									num770 *= num771;
									y3 *= num771;
								}
								else
								{
									num770 = num770 * num771 * 1.25f;
									y3 = y3 * num771 * 0.75f;
								}
								Dust dust2 = Main.dust[num769];
								dust2.velocity *= 0.5f;
								Main.dust[num769].velocity.X += num770;
								Main.dust[num769].velocity.Y += y3;
								if (num766 > 100)
								{
									Main.dust[num769].scale = 1.3f;
									Main.dust[num769].noGravity = true;
								}
							}
						}
						if (type == 169)
						{
							Vector2 vector62 = ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2();
							float num772 = Main.rand.Next(5, 9);
							float num773 = Main.rand.Next(12, 17);
							float value9 = Main.rand.Next(3, 7);
							float num774 = 20f;
							for (float num775 = 0f; num775 < num772; num775++)
							{
								for (int num776 = 0; num776 < 2; num776++)
								{
									Vector2 value10 = vector62.RotatedBy(((num776 == 0) ? 1f : (-1f)) * (MathF.PI * 2f) / (num772 * 2f));
									for (float num777 = 0f; num777 < num774; num777++)
									{
										Vector2 vector63 = Vector2.Lerp(vector62, value10, num777 / num774);
										float num778 = MathHelper.Lerp(num773, value9, num777 / num774);
										int num779 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, 133, 0f, 0f, 100, default(Color), 1.3f);
										Dust dust2 = Main.dust[num779];
										dust2.velocity *= 0.1f;
										Main.dust[num779].noGravity = true;
										dust2 = Main.dust[num779];
										dust2.velocity += vector63 * num778;
									}
								}
								vector62 = vector62.RotatedBy(MathF.PI * 2f / num772);
							}
							for (float num780 = 0f; num780 < num772; num780++)
							{
								for (int num781 = 0; num781 < 2; num781++)
								{
									Vector2 value11 = vector62.RotatedBy(((num781 == 0) ? 1f : (-1f)) * (MathF.PI * 2f) / (num772 * 2f));
									for (float num782 = 0f; num782 < num774; num782++)
									{
										Vector2 vector64 = Vector2.Lerp(vector62, value11, num782 / num774);
										float num783 = MathHelper.Lerp(num773, value9, num782 / num774) / 2f;
										int num784 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, 133, 0f, 0f, 100, default(Color), 1.3f);
										Dust dust2 = Main.dust[num784];
										dust2.velocity *= 0.1f;
										Main.dust[num784].noGravity = true;
										dust2 = Main.dust[num784];
										dust2.velocity += vector64 * num783;
									}
								}
								vector62 = vector62.RotatedBy(MathF.PI * 2f / num772);
							}
							for (int num785 = 0; num785 < 100; num785++)
							{
								float num786 = num773;
								int num787 = 132;
								int num788 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num787, 0f, 0f, 100);
								float num789 = Main.dust[num788].velocity.X;
								float y4 = Main.dust[num788].velocity.Y;
								if (num789 == 0f && y4 == 0f)
								{
									num789 = 1f;
								}
								float num790 = (float)Math.Sqrt(num789 * num789 + y4 * y4);
								num790 = num786 / num790;
								num789 *= num790;
								y4 *= num790;
								Dust dust2 = Main.dust[num788];
								dust2.velocity *= 0.5f;
								Main.dust[num788].velocity.X += num789;
								Main.dust[num788].velocity.Y += y4;
								Main.dust[num788].scale = 1.3f;
								Main.dust[num788].noGravity = true;
							}
						}
						if (type == 170)
						{
							for (int num791 = 0; num791 < 400; num791++)
							{
								int num792 = 133;
								float num793 = 16f;
								if (num791 > 100)
								{
									num793 = 11f;
								}
								if (num791 > 100)
								{
									num792 = 134;
								}
								if (num791 > 200)
								{
									num793 = 8f;
								}
								if (num791 > 200)
								{
									num792 = 133;
								}
								if (num791 > 300)
								{
									num793 = 5f;
								}
								if (num791 > 300)
								{
									num792 = 134;
								}
								int num794 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num792, 0f, 0f, 100);
								float num795 = Main.dust[num794].velocity.X;
								float y5 = Main.dust[num794].velocity.Y;
								if (num795 == 0f && y5 == 0f)
								{
									num795 = 1f;
								}
								float num796 = (float)Math.Sqrt(num795 * num795 + y5 * y5);
								num796 = num793 / num796;
								if (num791 > 300)
								{
									num795 = num795 * num796 * 0.7f;
									y5 *= num796;
								}
								else if (num791 > 200)
								{
									num795 *= num796;
									y5 = y5 * num796 * 0.7f;
								}
								else if (num791 > 100)
								{
									num795 = num795 * num796 * 0.7f;
									y5 *= num796;
								}
								else
								{
									num795 *= num796;
									y5 = y5 * num796 * 0.7f;
								}
								Dust dust2 = Main.dust[num794];
								dust2.velocity *= 0.5f;
								Main.dust[num794].velocity.X += num795;
								Main.dust[num794].velocity.Y += y5;
								if (Main.rand.Next(3) != 0)
								{
									Main.dust[num794].scale = 1.3f;
									Main.dust[num794].noGravity = true;
								}
							}
						}
						if (type == 415)
						{
							Vector2 vector65 = (vector65 = ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2());
							float num797 = Main.rand.Next(5, 9);
							float num798 = (float)Main.rand.Next(10, 15) * 0.66f;
							float num799 = (float)Main.rand.Next(4, 7) / 2f;
							int num800 = 30;
							for (int num801 = 0; (float)num801 < (float)num800 * num797; num801++)
							{
								if (num801 % num800 == 0)
								{
									vector65 = vector65.RotatedBy(MathF.PI * 2f / num797);
								}
								float num802 = MathHelper.Lerp(num799, num798, (float)(num801 % num800) / (float)num800);
								int num803 = 130;
								int num804 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num803, 0f, 0f, 100);
								Dust dust2 = Main.dust[num804];
								dust2.velocity *= 0.1f;
								dust2 = Main.dust[num804];
								dust2.velocity += vector65 * num802;
								Main.dust[num804].scale = 1.3f;
								Main.dust[num804].noGravity = true;
							}
							for (int num805 = 0; num805 < 100; num805++)
							{
								float num806 = num798;
								if (num805 < 30)
								{
									num806 = (num799 + num798) / 2f;
								}
								int num807 = 130;
								int num808 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num807, 0f, 0f, 100);
								float num809 = Main.dust[num808].velocity.X;
								float y6 = Main.dust[num808].velocity.Y;
								if (num809 == 0f && y6 == 0f)
								{
									num809 = 1f;
								}
								float num810 = (float)Math.Sqrt(num809 * num809 + y6 * y6);
								num810 = num806 / num810;
								num809 *= num810;
								y6 *= num810;
								Dust dust2 = Main.dust[num808];
								dust2.velocity *= 0.5f;
								Main.dust[num808].velocity.X += num809;
								Main.dust[num808].velocity.Y += y6;
								Main.dust[num808].scale = 1.3f;
								Main.dust[num808].noGravity = true;
							}
						}
						if (type == 416)
						{
							Vector2 vector66 = ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2();
							Vector2 vector67 = vector66;
							float num811 = Main.rand.Next(3, 6) * 2;
							int num812 = 20;
							float num813 = ((Main.rand.Next(2) == 0) ? 1f : (-1f));
							bool flag2 = true;
							for (int num814 = 0; (float)num814 < (float)num812 * num811; num814++)
							{
								if (num814 % num812 == 0)
								{
									vector67 = vector67.RotatedBy(num813 * (MathF.PI * 2f / num811));
									vector66 = vector67;
									flag2 = !flag2;
								}
								else
								{
									float num815 = MathF.PI * 2f / ((float)num812 * num811);
									vector66 = vector66.RotatedBy(num815 * num813 * 3f);
								}
								float num816 = MathHelper.Lerp(1f, 8f, (float)(num814 % num812) / (float)num812);
								int num817 = 131;
								int num818 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num817, 0f, 0f, 100, default(Color), 1.4f);
								Dust dust2 = Main.dust[num818];
								dust2.velocity *= 0.1f;
								dust2 = Main.dust[num818];
								dust2.velocity += vector66 * num816;
								if (flag2)
								{
									Main.dust[num818].scale = 0.9f;
								}
								Main.dust[num818].noGravity = true;
							}
						}
						if (type == 417)
						{
							float num819 = (float)Main.rand.NextDouble() * (MathF.PI * 2f);
							float num820 = (float)Main.rand.NextDouble() * (MathF.PI * 2f);
							float num821 = 4f + (float)Main.rand.NextDouble() * 3f;
							float num822 = 4f + (float)Main.rand.NextDouble() * 3f;
							float num823 = num821;
							if (num822 > num823)
							{
								num823 = num822;
							}
							for (int num824 = 0; num824 < 150; num824++)
							{
								int num825 = 132;
								float num826 = num823;
								if (num824 > 50)
								{
									num826 = num822;
								}
								if (num824 > 50)
								{
									num825 = 133;
								}
								if (num824 > 100)
								{
									num826 = num821;
								}
								if (num824 > 100)
								{
									num825 = 132;
								}
								int num827 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num825, 0f, 0f, 100);
								Vector2 vector68 = Main.dust[num827].velocity;
								vector68.Normalize();
								vector68 *= num826;
								if (num824 > 100)
								{
									vector68.X *= 0.5f;
									vector68 = vector68.RotatedBy(num819);
								}
								else if (num824 > 50)
								{
									vector68.Y *= 0.5f;
									vector68 = vector68.RotatedBy(num820);
								}
								Dust dust2 = Main.dust[num827];
								dust2.velocity *= 0.2f;
								dust2 = Main.dust[num827];
								dust2.velocity += vector68;
								if (num824 <= 200)
								{
									Main.dust[num827].scale = 1.3f;
									Main.dust[num827].noGravity = true;
								}
							}
						}
						if (type == 418)
						{
							Vector2 vector69 = ((float)Main.rand.NextDouble() * (MathF.PI * 2f)).ToRotationVector2();
							float num828 = Main.rand.Next(5, 12);
							float num829 = (float)Main.rand.Next(9, 14) * 0.66f;
							float num830 = (float)Main.rand.Next(2, 4) * 0.66f;
							float num831 = 15f;
							for (float num832 = 0f; num832 < num828; num832++)
							{
								for (int num833 = 0; num833 < 2; num833++)
								{
									Vector2 value12 = vector69.RotatedBy(((num833 == 0) ? 1f : (-1f)) * (MathF.PI * 2f) / (num828 * 2f));
									for (float num834 = 0f; num834 < num831; num834++)
									{
										Vector2 vector70 = Vector2.SmoothStep(vector69, value12, num834 / num831);
										float num835 = MathHelper.SmoothStep(num829, num830, num834 / num831);
										int num836 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, 134, 0f, 0f, 100, default(Color), 1.3f);
										Dust dust2 = Main.dust[num836];
										dust2.velocity *= 0.1f;
										Main.dust[num836].noGravity = true;
										dust2 = Main.dust[num836];
										dust2.velocity += vector70 * num835;
									}
								}
								vector69 = vector69.RotatedBy(MathF.PI * 2f / num828);
							}
							for (int num837 = 0; num837 < 120; num837++)
							{
								float num838 = num829;
								int num839 = 133;
								if (num837 < 80)
								{
									num838 = num830 - 0.5f;
								}
								else
								{
									num839 = 131;
								}
								int num840 = Dust.NewDust(new Vector2(position.X, position.Y), 6, 6, num839, 0f, 0f, 100);
								float num841 = Main.dust[num840].velocity.X;
								float y7 = Main.dust[num840].velocity.Y;
								if (num841 == 0f && y7 == 0f)
								{
									num841 = 1f;
								}
								float num842 = (float)Math.Sqrt(num841 * num841 + y7 * y7);
								num842 = num838 / num842;
								num841 *= num842;
								y7 *= num842;
								Dust dust2 = Main.dust[num840];
								dust2.velocity *= 0.2f;
								Main.dust[num840].velocity.X += num841;
								Main.dust[num840].velocity.Y += y7;
								Main.dust[num840].scale = 1.3f;
								Main.dust[num840].noGravity = true;
							}
						}
						position.X += width / 2;
						position.Y += height / 2;
						width = 192;
						height = 192;
						position.X -= width / 2;
						position.Y -= height / 2;
						penetrate = -1;
						Damage();
					}
					else if (type == 312)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						position.X += width / 2;
						position.Y += height / 2;
						width = 22;
						height = 22;
						position.X -= width / 2;
						position.Y -= height / 2;
						for (int num843 = 0; num843 < 30; num843++)
						{
							int num844 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num844];
							dust2.velocity *= 1.4f;
						}
						for (int num845 = 0; num845 < 20; num845++)
						{
							int num846 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 3.5f);
							Main.dust[num846].noGravity = true;
							Dust dust2 = Main.dust[num846];
							dust2.velocity *= 7f;
							num846 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust2 = Main.dust[num846];
							dust2.velocity *= 3f;
						}
						for (int num847 = 0; num847 < 2; num847++)
						{
							float num848 = 0.4f;
							if (num847 == 1)
							{
								num848 = 0.8f;
							}
							int num849 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
							Gore gore2 = Main.gore[num849];
							gore2.velocity *= num848;
							Main.gore[num849].velocity.X += 1f;
							Main.gore[num849].velocity.Y += 1f;
							num849 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
							gore2 = Main.gore[num849];
							gore2.velocity *= num848;
							Main.gore[num849].velocity.X -= 1f;
							Main.gore[num849].velocity.Y += 1f;
							num849 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
							gore2 = Main.gore[num849];
							gore2.velocity *= num848;
							Main.gore[num849].velocity.X += 1f;
							Main.gore[num849].velocity.Y -= 1f;
							num849 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
							gore2 = Main.gore[num849];
							gore2.velocity *= num848;
							Main.gore[num849].velocity.X -= 1f;
							Main.gore[num849].velocity.Y -= 1f;
						}
						position.X += width / 2;
						position.Y += height / 2;
						width = 128;
						height = 128;
						position.X -= width / 2;
						position.Y -= height / 2;
						Damage();
					}
					else if (type == 910 || type == 911)
					{
						Resize(22, 22);
						SoundEngine.PlaySound(SoundID.Item14, position);
						Color transparent2 = Color.Transparent;
						int num850 = 0;
						for (int num851 = 0; num851 < 30; num851++)
						{
							Dust dust51 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent2, 1.5f);
							Dust dust2 = dust51;
							dust2.velocity *= 1.4f;
						}
						for (int num852 = 0; num852 < 80; num852++)
						{
							Dust dust52 = Dust.NewDustDirect(position, width, height, num850, 0f, 0f, 100, transparent2, 2.2f);
							dust52.noGravity = true;
							dust52.velocity.Y -= 1.2f;
							Dust dust2 = dust52;
							dust2.velocity *= 4f;
							dust52 = Dust.NewDustDirect(position, width, height, num850, 0f, 0f, 100, transparent2, 1.3f);
							dust52.velocity.Y -= 1.2f;
							dust2 = dust52;
							dust2.velocity *= 2f;
						}
						for (int num853 = 1; num853 <= 2; num853++)
						{
							for (int num854 = -1; num854 <= 1; num854 += 2)
							{
								for (int num855 = -1; num855 <= 1; num855 += 2)
								{
									Gore gore6 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
									Gore gore2 = gore6;
									gore2.velocity *= ((num853 == 1) ? 0.4f : 0.8f);
									gore2 = gore6;
									gore2.velocity += new Vector2(num854, num855);
								}
							}
						}
						if (Main.netMode != 1)
						{
							Point pt = base.Center.ToTileCoordinates();
							Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt, 4.2f, DelegateMethods.SpreadDirt);
						}
					}
					else if (type == 784 || type == 785 || type == 786 || type == 805 || type == 903)
					{
						Resize(22, 22);
						if (type == 785)
						{
							SoundEngine.PlaySound(SoundID.Item62, position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item14, position);
						}
						Color transparent3 = Color.Transparent;
						int num856 = Dust.dustWater();
						for (int num857 = 0; num857 < 30; num857++)
						{
							Dust dust53 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent3, 1.5f);
							Dust dust2 = dust53;
							dust2.velocity *= 1.4f;
						}
						for (int num858 = 0; num858 < 80; num858++)
						{
							Dust dust54 = Dust.NewDustDirect(position, width, height, num856, 0f, 0f, 100, transparent3, 2.2f);
							dust54.noGravity = true;
							dust54.velocity.Y -= 1.2f;
							Dust dust2 = dust54;
							dust2.velocity *= 7f;
							dust54 = Dust.NewDustDirect(position, width, height, num856, 0f, 0f, 100, transparent3, 1.3f);
							dust54.velocity.Y -= 1.2f;
							dust2 = dust54;
							dust2.velocity *= 4f;
						}
						for (int num859 = 1; num859 <= 2; num859++)
						{
							for (int num860 = -1; num860 <= 1; num860 += 2)
							{
								for (int num861 = -1; num861 <= 1; num861 += 2)
								{
									Gore gore7 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
									Gore gore2 = gore7;
									gore2.velocity *= ((num859 == 1) ? 0.4f : 0.8f);
									gore2 = gore7;
									gore2.velocity += new Vector2(num860, num861);
								}
							}
						}
						if (Main.netMode != 1)
						{
							Point pt2 = base.Center.ToTileCoordinates();
							Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt2, 3f, DelegateMethods.SpreadWater);
						}
					}
					else if (type == 787 || type == 788 || type == 789 || type == 806 || type == 904)
					{
						Resize(22, 22);
						if (type == 788)
						{
							SoundEngine.PlaySound(SoundID.Item62, position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item14, position);
						}
						Color transparent4 = Color.Transparent;
						int num862 = 35;
						for (int num863 = 0; num863 < 30; num863++)
						{
							Dust dust55 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent4, 1.5f);
							Dust dust2 = dust55;
							dust2.velocity *= 1.4f;
						}
						for (int num864 = 0; num864 < 80; num864++)
						{
							Dust dust56 = Dust.NewDustDirect(position, width, height, num862, 0f, 0f, 100, transparent4, 1.2f);
							Dust dust2 = dust56;
							dust2.velocity *= 7f;
							dust56 = Dust.NewDustDirect(position, width, height, num862, 0f, 0f, 100, transparent4, 0.3f);
							dust2 = dust56;
							dust2.velocity *= 4f;
						}
						for (int num865 = 1; num865 <= 2; num865++)
						{
							for (int num866 = -1; num866 <= 1; num866 += 2)
							{
								for (int num867 = -1; num867 <= 1; num867 += 2)
								{
									Gore gore8 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
									Gore gore2 = gore8;
									gore2.velocity *= ((num865 == 1) ? 0.4f : 0.8f);
									gore2 = gore8;
									gore2.velocity += new Vector2(num866, num867);
								}
							}
						}
						if (Main.netMode != 1)
						{
							Point pt3 = base.Center.ToTileCoordinates();
							Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt3, 3f, DelegateMethods.SpreadLava);
						}
					}
					else if (type == 790 || type == 791 || type == 792 || type == 807 || type == 905)
					{
						Resize(22, 22);
						if (type == 791)
						{
							SoundEngine.PlaySound(SoundID.Item62, position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item14, position);
						}
						Color transparent5 = Color.Transparent;
						int num868 = 152;
						for (int num869 = 0; num869 < 30; num869++)
						{
							Dust dust57 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent5, 1.5f);
							Dust dust2 = dust57;
							dust2.velocity *= 1.4f;
						}
						for (int num870 = 0; num870 < 80; num870++)
						{
							Dust dust58 = Dust.NewDustDirect(position, width, height, num868, 0f, 0f, 100, transparent5, 2.2f);
							Dust dust2 = dust58;
							dust2.velocity *= 7f;
							dust58 = Dust.NewDustDirect(position, width, height, num868, 0f, 0f, 100, transparent5, 1.3f);
							dust2 = dust58;
							dust2.velocity *= 4f;
						}
						for (int num871 = 1; num871 <= 2; num871++)
						{
							for (int num872 = -1; num872 <= 1; num872 += 2)
							{
								for (int num873 = -1; num873 <= 1; num873 += 2)
								{
									Gore gore9 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
									Gore gore2 = gore9;
									gore2.velocity *= ((num871 == 1) ? 0.4f : 0.8f);
									gore2 = gore9;
									gore2.velocity += new Vector2(num872, num873);
								}
							}
						}
						if (Main.netMode != 1)
						{
							Point pt4 = base.Center.ToTileCoordinates();
							Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt4, 3f, DelegateMethods.SpreadHoney);
						}
					}
					else if (type == 799 || type == 800 || type == 801 || type == 810 || type == 906)
					{
						Resize(22, 22);
						if (type == 800)
						{
							SoundEngine.PlaySound(SoundID.Item62, position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item14, position);
						}
						Color transparent6 = Color.Transparent;
						int num874 = 31;
						for (int num875 = 0; num875 < 30; num875++)
						{
							Dust dust59 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent6, 1.5f);
							Dust dust2 = dust59;
							dust2.velocity *= 1.4f;
						}
						for (int num876 = 0; num876 < 80; num876++)
						{
							Dust dust60 = Dust.NewDustDirect(position, width, height, num874, 0f, 0f, 100, transparent6, 1.2f);
							Dust dust2 = dust60;
							dust2.velocity *= 7f;
							dust60 = Dust.NewDustDirect(position, width, height, num874, 0f, 0f, 100, transparent6, 0.3f);
							dust2 = dust60;
							dust2.velocity *= 4f;
						}
						for (int num877 = 1; num877 <= 2; num877++)
						{
							for (int num878 = -1; num878 <= 1; num878 += 2)
							{
								for (int num879 = -1; num879 <= 1; num879 += 2)
								{
									Gore gore10 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
									Gore gore2 = gore10;
									gore2.velocity *= ((num877 == 1) ? 0.4f : 0.8f);
									gore2 = gore10;
									gore2.velocity += new Vector2(num878, num879);
								}
							}
						}
						if (Main.netMode != 1)
						{
							Point pt5 = base.Center.ToTileCoordinates();
							Kill_DirtAndFluidProjectiles_RunDelegateMethodPushUpForHalfBricks(pt5, 3.5f, DelegateMethods.SpreadDry);
						}
					}
					else if (type == 793 || type == 796 || type == 794 || type == 797 || type == 795 || type == 798 || type == 808 || type == 809)
					{
						if (type == 794 || type == 797)
						{
							SoundEngine.PlaySound(SoundID.Item62, base.Center);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item14, base.Center);
						}
						Resize(50, 50);
						float num880 = 3f;
						for (int num881 = 0; num881 < 50; num881++)
						{
							Dust dust61 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, default(Color), 2f);
							dust61.velocity = (dust61.position - base.Center).SafeNormalize(Vector2.Zero);
							Dust dust2 = dust61;
							dust2.velocity *= 2f + (float)Main.rand.Next(5) * 0.1f;
							dust61.velocity.Y -= num880 * 0.5f;
							dust61.color = Color.Black * 0.9f;
							if (Main.rand.Next(2) == 0)
							{
								dust61.scale = 0.5f;
								dust61.fadeIn = 1f + (float)Main.rand.Next(10) * 0.1f;
								dust61.color = Color.Black * 0.8f;
							}
						}
						for (int num882 = 0; num882 < 30; num882++)
						{
							Dust dust62 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100);
							dust62.noGravity = true;
							dust62.fadeIn = 1.4f;
							dust62.velocity = (dust62.position - base.Center).SafeNormalize(Vector2.Zero);
							Dust dust2 = dust62;
							dust2.velocity *= 5.5f + (float)Main.rand.Next(61) * 0.1f;
							dust62.velocity.Y -= num880 * 0.5f;
							dust62 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100);
							dust62.velocity = (dust62.position - base.Center).SafeNormalize(Vector2.Zero);
							dust62.velocity.Y -= num880 * 0.25f;
							dust2 = dust62;
							dust2.velocity *= 1.5f + (float)Main.rand.Next(5) * 0.1f;
							dust62.fadeIn = 0f;
							dust62.scale = 0.6f;
							dust62 = Dust.NewDustDirect(position, width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust62.noGravity = num882 % 2 == 0;
							dust62.velocity = (dust62.position - base.Center).SafeNormalize(Vector2.Zero);
							dust2 = dust62;
							dust2.velocity *= 3f + (float)Main.rand.Next(21) * 0.2f;
							dust62.velocity.Y -= num880 * 0.5f;
							dust62.fadeIn = 1.2f;
							if (!dust62.noGravity)
							{
								dust62.scale = 0.4f;
								dust62.fadeIn = 0f;
							}
							else
							{
								dust2 = dust62;
								dust2.velocity *= 2f + (float)Main.rand.Next(5) * 0.2f;
								dust62.velocity.Y -= num880 * 0.5f;
							}
						}
						int num883 = 0;
						for (int num884 = 1; num884 <= 3; num884++)
						{
							float num885 = MathF.PI * 2f * Main.rand.NextFloat();
							for (float num886 = 0f; num886 < 1f; num886 += 1f / 11f)
							{
								float f4 = MathF.PI * 2f * num886 + num885;
								Vector2 spinningpoint2 = f4.ToRotationVector2();
								spinningpoint2 *= new Vector2(1f, 0.4f);
								spinningpoint2 = spinningpoint2.RotatedBy((float)num883 - MathF.PI);
								Vector2 vector71 = ((float)num883 - MathF.PI / 2f).ToRotationVector2();
								Vector2 vector72 = base.Center + vector71 * 16f * 0f;
								Dust dust63 = Dust.NewDustPerfect(vector72, 6, spinningpoint2);
								dust63.fadeIn = 1.8f;
								dust63.noGravity = true;
								Dust dust2 = dust63;
								dust2.velocity *= (float)num884 * (Main.rand.NextFloat() * 2f + 0.2f);
								dust2 = dust63;
								dust2.velocity += vector71 * 0.8f * num884;
								dust2 = dust63;
								dust2.velocity *= 2f;
							}
						}
						for (int num887 = 1; num887 <= 3; num887++)
						{
							for (int num888 = -1; num888 <= 1; num888 += 2)
							{
								for (int num889 = -1; num889 <= 1; num889 += 2)
								{
									Gore gore11 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
									Gore gore2 = gore11;
									gore2.velocity *= (float)num887 / 3f;
									gore2 = gore11;
									gore2.velocity += new Vector2(num888, num889);
								}
							}
						}
						Resize(10, 10);
					}
					else if (type == 779 || type == 783 || type == 862 || type == 863)
					{
						Resize(22, 22);
						SoundEngine.PlaySound(SoundID.Item62, position);
						Color transparent7 = Color.Transparent;
						for (int num890 = 0; num890 < 15; num890++)
						{
							Dust dust64 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent7, 0.8f);
							dust64.fadeIn = 0f;
							Dust dust2 = dust64;
							dust2.velocity *= 0.5f;
						}
						for (int num891 = 0; num891 < 5; num891++)
						{
							Dust dust65 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent7, 2.5f);
							dust65.noGravity = true;
							Dust dust2 = dust65;
							dust2.velocity *= 2.5f;
							dust65 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent7, 1.1f);
							dust2 = dust65;
							dust2.velocity *= 2f;
							dust65.noGravity = true;
						}
						for (int num892 = 0; num892 < 3; num892++)
						{
							Dust dust66 = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 100, transparent7, 1.1f);
							Dust dust2 = dust66;
							dust2.velocity *= 2f;
							dust66.noGravity = true;
						}
						for (int num893 = -1; num893 <= 1; num893 += 2)
						{
							for (int num894 = -1; num894 <= 1; num894 += 2)
							{
								if (Main.rand.Next(5) == 0)
								{
									Gore gore12 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
									Gore gore2 = gore12;
									gore2.velocity *= 0.2f;
									gore2 = gore12;
									gore2.scale *= 0.65f;
									gore2 = gore12;
									gore2.velocity += new Vector2(num893, num894) * 0.5f;
								}
							}
						}
					}
					else if (type == 776 || type == 780 || type == 777 || type == 781 || type == 778 || type == 782 || type == 803 || type == 804)
					{
						Resize(22, 22);
						if (type == 777 || type == 781)
						{
							SoundEngine.PlaySound(SoundID.Item62, position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item14, position);
						}
						Color transparent8 = Color.Transparent;
						for (int num895 = 0; num895 < 30; num895++)
						{
							Dust dust67 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, transparent8, 1.5f);
							Dust dust2 = dust67;
							dust2.velocity *= 1.4f;
						}
						for (int num896 = 0; num896 < 40; num896++)
						{
							Dust dust68 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent8, 3.5f);
							dust68.noGravity = true;
							Dust dust2 = dust68;
							dust2.velocity *= 7f;
							dust68 = Dust.NewDustDirect(position, width, height, 228, 0f, 0f, 100, transparent8, 1.3f);
							dust2 = dust68;
							dust2.velocity *= 4f;
							dust68.noGravity = true;
						}
						for (int num897 = 0; num897 < 8; num897++)
						{
							Dust dust69 = Dust.NewDustDirect(position, width, height, 226, 0f, 0f, 100, transparent8, 1.3f);
							Dust dust2 = dust69;
							dust2.velocity *= 4f;
							dust69.noGravity = true;
						}
						for (int num898 = 2; num898 <= 2; num898++)
						{
							for (int num899 = -1; num899 <= 1; num899 += 2)
							{
								for (int num900 = -1; num900 <= 1; num900 += 2)
								{
									Gore gore13 = Gore.NewGoreDirect(position, Vector2.Zero, Main.rand.Next(61, 64));
									Gore gore2 = gore13;
									gore2.velocity *= ((num898 == 1) ? 0.4f : 0.8f);
									gore2 = gore13;
									gore2.velocity += new Vector2(num899, num900);
								}
							}
						}
						if (owner == Main.myPlayer)
						{
							int num901 = 779;
							if (type == 780 || type == 781 || type == 782)
							{
								num901 = 783;
							}
							if (type == 803)
							{
								num901 = 862;
							}
							if (type == 804)
							{
								num901 = 863;
							}
							float num902 = Main.rand.NextFloat() * (MathF.PI * 2f);
							for (float num903 = 0f; num903 < 1f; num903 += 1f / 6f)
							{
								float f5 = num902 + num903 * (MathF.PI * 2f);
								Vector2 vector73 = f5.ToRotationVector2() * (4f + Main.rand.NextFloat() * 2f);
								vector73 += Vector2.UnitY * -1f;
								int num904 = NewProjectile(GetProjectileSource_FromThis(), base.Center, vector73, num901, damage / 2, 0f, owner);
								Projectile projectile = Main.projectile[num904];
								Projectile projectile2 = projectile;
								projectile2.timeLeft -= Main.rand.Next(30);
							}
						}
					}
					else if (type == 133 || type == 134 || type == 135 || type == 136 || type == 137 || type == 138 || type == 303 || type == 338 || type == 339 || type == 930)
					{
						if (type == 30 || type == 133 || type == 136)
						{
							SoundEngine.PlaySound(SoundID.Item62, position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item14, position);
						}
						position.X += width / 2;
						position.Y += height / 2;
						width = 22;
						height = 22;
						position.X -= width / 2;
						position.Y -= height / 2;
						for (int num905 = 0; num905 < 30; num905++)
						{
							int num906 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num906];
							dust2.velocity *= 1.4f;
						}
						for (int num907 = 0; num907 < 20; num907++)
						{
							int num908 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 3.5f);
							Main.dust[num908].noGravity = true;
							Dust dust2 = Main.dust[num908];
							dust2.velocity *= 7f;
							num908 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust2 = Main.dust[num908];
							dust2.velocity *= 3f;
						}
						for (int num909 = 0; num909 < 2; num909++)
						{
							float num910 = 0.4f;
							if (num909 == 1)
							{
								num910 = 0.8f;
							}
							int num911 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
							Gore gore2 = Main.gore[num911];
							gore2.velocity *= num910;
							Main.gore[num911].velocity.X += 1f;
							Main.gore[num911].velocity.Y += 1f;
							num911 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
							gore2 = Main.gore[num911];
							gore2.velocity *= num910;
							Main.gore[num911].velocity.X -= 1f;
							Main.gore[num911].velocity.Y += 1f;
							num911 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
							gore2 = Main.gore[num911];
							gore2.velocity *= num910;
							Main.gore[num911].velocity.X += 1f;
							Main.gore[num911].velocity.Y -= 1f;
							num911 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
							gore2 = Main.gore[num911];
							gore2.velocity *= num910;
							Main.gore[num911].velocity.X -= 1f;
							Main.gore[num911].velocity.Y -= 1f;
						}
					}
					else if (type == 139 || type == 140 || type == 141 || type == 142 || type == 143 || type == 144 || type == 340 || type == 341)
					{
						if (type == 139)
						{
							SoundEngine.PlaySound(SoundID.Item62, position);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item14, position);
						}
						position.X += width / 2;
						position.Y += height / 2;
						width = 80;
						height = 80;
						position.X -= width / 2;
						position.Y -= height / 2;
						for (int num912 = 0; num912 < 40; num912++)
						{
							int num913 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 2f);
							Dust dust2 = Main.dust[num913];
							dust2.velocity *= 3f;
							if (Main.rand.Next(2) == 0)
							{
								Main.dust[num913].scale = 0.5f;
								Main.dust[num913].fadeIn = 1f + (float)Main.rand.Next(10) * 0.1f;
							}
						}
						for (int num914 = 0; num914 < 70; num914++)
						{
							int num915 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 3f);
							Main.dust[num915].noGravity = true;
							Dust dust2 = Main.dust[num915];
							dust2.velocity *= 5f;
							num915 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
							dust2 = Main.dust[num915];
							dust2.velocity *= 2f;
						}
						for (int num916 = 0; num916 < 3; num916++)
						{
							float num917 = 0.33f;
							if (num916 == 1)
							{
								num917 = 0.66f;
							}
							if (num916 == 2)
							{
								num917 = 1f;
							}
							int num918 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
							Gore gore2 = Main.gore[num918];
							gore2.velocity *= num917;
							Main.gore[num918].velocity.X += 1f;
							Main.gore[num918].velocity.Y += 1f;
							num918 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
							gore2 = Main.gore[num918];
							gore2.velocity *= num917;
							Main.gore[num918].velocity.X -= 1f;
							Main.gore[num918].velocity.Y += 1f;
							num918 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
							gore2 = Main.gore[num918];
							gore2.velocity *= num917;
							Main.gore[num918].velocity.X += 1f;
							Main.gore[num918].velocity.Y -= 1f;
							num918 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
							gore2 = Main.gore[num918];
							gore2.velocity *= num917;
							Main.gore[num918].velocity.X -= 1f;
							Main.gore[num918].velocity.Y -= 1f;
						}
						position.X += width / 2;
						position.Y += height / 2;
						width = 10;
						height = 10;
						position.X -= width / 2;
						position.Y -= height / 2;
					}
					else if (type == 246)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						for (int num919 = 0; num919 < 10; num919++)
						{
							int num920 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num920];
							dust2.velocity *= 0.9f;
						}
						for (int num921 = 0; num921 < 5; num921++)
						{
							int num922 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
							Main.dust[num922].noGravity = true;
							Dust dust2 = Main.dust[num922];
							dust2.velocity *= 3f;
							num922 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust2 = Main.dust[num922];
							dust2.velocity *= 2f;
						}
						int num923 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						Gore gore2 = Main.gore[num923];
						gore2.velocity *= 0.3f;
						Main.gore[num923].velocity.X += Main.rand.Next(-1, 2);
						Main.gore[num923].velocity.Y += Main.rand.Next(-1, 2);
						position.X += width / 2;
						position.Y += height / 2;
						width = 150;
						height = 150;
						position.X -= width / 2;
						position.Y -= height / 2;
						penetrate = -1;
						maxPenetrate = 0;
						Damage();
						if (owner == Main.myPlayer)
						{
							int num924 = Main.rand.Next(2, 6);
							for (int num925 = 0; num925 < num924; num925++)
							{
								float num926 = Main.rand.Next(-100, 101);
								num926 += 0.01f;
								float num927 = Main.rand.Next(-100, 101);
								num926 -= 0.01f;
								float num928 = (float)Math.Sqrt(num926 * num926 + num927 * num927);
								num928 = 8f / num928;
								num926 *= num928;
								num927 *= num928;
								int num929 = NewProjectile(GetProjectileSource_FromThis(), base.Center.X - oldVelocity.X, base.Center.Y - oldVelocity.Y, num926, num927, 249, damage, knockBack, owner);
								Main.projectile[num929].maxPenetrate = 0;
							}
						}
					}
					else if (type == 249)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						for (int num930 = 0; num930 < 7; num930++)
						{
							int num931 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num931];
							dust2.velocity *= 0.8f;
						}
						for (int num932 = 0; num932 < 2; num932++)
						{
							int num933 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2.5f);
							Main.dust[num933].noGravity = true;
							Dust dust2 = Main.dust[num933];
							dust2.velocity *= 2.5f;
							num933 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 1.5f);
							dust2 = Main.dust[num933];
							dust2.velocity *= 1.5f;
						}
						int num934 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(61, 64));
						Gore gore2 = Main.gore[num934];
						gore2.velocity *= 0.2f;
						Main.gore[num934].velocity.X += Main.rand.Next(-1, 2);
						Main.gore[num934].velocity.Y += Main.rand.Next(-1, 2);
						position.X += width / 2;
						position.Y += height / 2;
						width = 100;
						height = 100;
						position.X -= width / 2;
						position.Y -= height / 2;
						penetrate = -1;
						Damage();
					}
					else if (type == 588)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						position = base.Center;
						width = (height = 22);
						base.Center = position;
						for (int num935 = 0; num935 < 8; num935++)
						{
							int num936 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 219 + Main.rand.Next(5));
							Dust dust2 = Main.dust[num936];
							dust2.velocity *= 1.4f;
							Main.dust[num936].fadeIn = 1f;
							Main.dust[num936].noGravity = true;
						}
						for (int num937 = 0; num937 < 15; num937++)
						{
							int num938 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 139 + Main.rand.Next(4), 0f, 0f, 0, default(Color), 1.6f);
							Main.dust[num938].noGravity = true;
							Dust dust2 = Main.dust[num938];
							dust2.velocity *= 5f;
							num938 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 139 + Main.rand.Next(4), 0f, 0f, 0, default(Color), 1.9f);
							dust2 = Main.dust[num938];
							dust2.velocity *= 3f;
						}
						if (Main.rand.Next(2) == 0)
						{
							int num939 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(276, 283));
							Gore gore2 = Main.gore[num939];
							gore2.velocity *= 0.4f;
							Main.gore[num939].velocity.X += 1f;
							Main.gore[num939].velocity.Y += 1f;
						}
						if (Main.rand.Next(2) == 0)
						{
							int num939 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(276, 283));
							Gore gore2 = Main.gore[num939];
							gore2.velocity *= 0.4f;
							Main.gore[num939].velocity.X -= 1f;
							Main.gore[num939].velocity.Y += 1f;
						}
						if (Main.rand.Next(2) == 0)
						{
							int num939 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(276, 283));
							Gore gore2 = Main.gore[num939];
							gore2.velocity *= 0.4f;
							Main.gore[num939].velocity.X += 1f;
							Main.gore[num939].velocity.Y -= 1f;
						}
						if (Main.rand.Next(2) == 0)
						{
							int num939 = Gore.NewGore(new Vector2(position.X, position.Y), default(Vector2), Main.rand.Next(276, 283));
							Gore gore2 = Main.gore[num939];
							gore2.velocity *= 0.4f;
							Main.gore[num939].velocity.X -= 1f;
							Main.gore[num939].velocity.Y -= 1f;
						}
					}
					else if (type == 773)
					{
						Player player2 = Main.player[owner];
						Vector2 v = DirectionTo(player2.Center);
						float num940 = v.ToRotation() + MathF.PI / 2f;
						num940 += MathF.PI;
						Point scarabBombDigDirectionSnap = GetScarabBombDigDirectionSnap8();
						num940 = scarabBombDigDirectionSnap.ToVector2().ToRotation() + MathF.PI / 2f;
						if (type == 794 || type == 797)
						{
							SoundEngine.PlaySound(SoundID.Item62, base.Center);
						}
						else
						{
							SoundEngine.PlaySound(SoundID.Item14, base.Center);
						}
						Resize(80, 80);
						for (int num941 = 0; num941 < 60; num941++)
						{
							Dust dust70 = Dust.NewDustDirect(position, width, height, 31, 0f, 0f, 100, default(Color), 2f);
							dust70.velocity.Y -= 0.5f;
							Dust dust2 = dust70;
							dust2.velocity *= 1.2f;
							dust70.color = Color.Black * 0.9f;
							if (Main.rand.Next(2) == 0)
							{
								dust70.scale = 0.5f;
								dust70.fadeIn = 1f + (float)Main.rand.Next(10) * 0.1f;
								dust70.color = Color.Black * 0.8f;
							}
						}
						for (int num942 = 0; num942 < 30; num942++)
						{
							Dust dust71 = Dust.NewDustDirect(position, width, height, 59, 0f, 0f, 100);
							dust71.noGravity = true;
							if (Math.Abs(velocity.X) > 0.25f)
							{
								velocity.X *= 0.25f / Math.Abs(velocity.X);
							}
							dust71.velocity.Y -= 0.5f;
							dust71.fadeIn = 1.2f;
							Dust dust2 = dust71;
							dust2.velocity *= 8f;
							dust71.velocity = dust71.velocity.RotatedBy(num940);
							dust71 = Dust.NewDustDirect(position, width, height, 59, 0f, 0f, 100, default(Color), 1.5f);
							dust2 = dust71;
							dust2.velocity *= 2f;
							dust71.velocity = dust71.velocity.RotatedBy(num940);
							dust71.velocity.Y -= 1.5f;
							dust71 = Dust.NewDustDirect(position, width, height, 59, 0f, 0f, 100, default(Color), 1.5f);
							dust71.noGravity = true;
							dust71.velocity.Y -= 1f;
							dust71.fadeIn = 2f;
							dust2 = dust71;
							dust2.velocity *= 4f;
							dust71.velocity = dust71.velocity.RotatedBy(num940);
						}
						bool flag3 = Math.Abs(scarabBombDigDirectionSnap.X) + Math.Abs(scarabBombDigDirectionSnap.Y) == 1;
						for (int num943 = 1; num943 <= 3; num943++)
						{
							float num944 = MathF.PI * 2f * Main.rand.NextFloat();
							for (float num945 = 0f; num945 < 1f; num945 += 1f / 12f)
							{
								float f6 = MathF.PI * 2f * num945 + num944;
								Vector2 value13 = f6.ToRotationVector2();
								value13 *= new Vector2(0.7f, 0.3f);
								Dust dust72 = Dust.NewDustPerfect(base.Center, 59, value13);
								dust72.fadeIn = 2f;
								dust72.noGravity = true;
								Dust dust2 = dust72;
								dust2.velocity *= (float)num943 + Main.rand.NextFloat() * 0.6f;
								dust72.velocity.Y -= (float)num943 * 0.8f;
								dust72.velocity = dust72.velocity.RotatedBy(num940);
								if (flag3)
								{
									dust2 = dust72;
									dust2.velocity += scarabBombDigDirectionSnap.ToVector2() * (Main.rand.NextFloat() * 11f + 6f);
								}
								else
								{
									dust2 = dust72;
									dust2.velocity += scarabBombDigDirectionSnap.ToVector2() * (Main.rand.NextFloat() * 7f + 5f);
								}
							}
						}
						Vector2 vector74 = (num940 - MathF.PI / 2f).ToRotationVector2();
						for (int num946 = 1; num946 <= 1; num946++)
						{
							for (int num947 = -1; num947 <= 1; num947 += 2)
							{
								for (int num948 = -1; num948 <= 1; num948 += 2)
								{
									Gore gore14 = Gore.NewGoreDirect(base.Center - Vector2.One * 20f, Vector2.Zero, Main.rand.Next(61, 64));
									gore14.velocity = gore14.velocity * 0.5f + vector74 * 3f;
									Gore gore2 = gore14;
									gore2.velocity += new Vector2(num947, num948) * 0.2f;
								}
							}
						}
						Resize(10, 10);
						if (owner == Main.myPlayer)
						{
							Point p = base.Center.ToTileCoordinates();
							Vector2 vector75 = p.ToWorldCoordinates();
							bool wallSplode = false;
							int num949 = 15;
							if (scarabBombDigDirectionSnap.X == 0 || scarabBombDigDirectionSnap.Y == 0)
							{
								num949 = (int)((double)num949 * Math.Sqrt(2.0));
							}
							for (int num950 = 0; num950 < num949; num950++)
							{
								Vector2 vec = vector75 + scarabBombDigDirectionSnap.ToVector2() * 16f * num950 * 1f;
								Point p2 = vec.ToTileCoordinates();
								if (ShouldWallExplode(p2.ToWorldCoordinates(), 9999, p2.X - 1, p2.X + 1, p2.Y - 1, p2.Y + 1))
								{
									wallSplode = true;
									break;
								}
							}
							for (int num951 = 0; num951 < num949; num951++)
							{
								Vector2 vec2 = vector75 + scarabBombDigDirectionSnap.ToVector2() * 16f * num951 * 1f;
								Point p3 = vec2.ToTileCoordinates();
								ExplodeTiles(p3.ToWorldCoordinates(), 9999, p3.X - 1, p3.X + 1, p3.Y - 1, p3.Y + 1, wallSplode);
							}
						}
					}
					else if (type == 28 || type == 30 || type == 37 || type == 75 || type == 102 || type == 164 || type == 397 || type == 517 || type == 516 || type == 519 || type == 773)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						position.X += width / 2;
						position.Y += height / 2;
						width = 22;
						height = 22;
						position.X -= width / 2;
						position.Y -= height / 2;
						int num952 = 6;
						if (type == 773)
						{
							num952 = 59;
						}
						for (int num953 = 0; num953 < 20; num953++)
						{
							int num954 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 1.5f);
							Dust dust2 = Main.dust[num954];
							dust2.velocity *= 1.4f;
						}
						for (int num955 = 0; num955 < 10; num955++)
						{
							int num956 = Dust.NewDust(position, width, height, num952, 0f, 0f, 100, default(Color), 2.5f);
							Main.dust[num956].noGravity = true;
							Dust dust2 = Main.dust[num956];
							dust2.velocity *= 5f;
							num956 = Dust.NewDust(position, width, height, num952, 0f, 0f, 100, default(Color), 1.5f);
							dust2 = Main.dust[num956];
							dust2.velocity *= 3f;
						}
						int num957 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
						Gore gore2 = Main.gore[num957];
						gore2.velocity *= 0.4f;
						Main.gore[num957].velocity.X += 1f;
						Main.gore[num957].velocity.Y += 1f;
						num957 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num957];
						gore2.velocity *= 0.4f;
						Main.gore[num957].velocity.X -= 1f;
						Main.gore[num957].velocity.Y += 1f;
						num957 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num957];
						gore2.velocity *= 0.4f;
						Main.gore[num957].velocity.X += 1f;
						Main.gore[num957].velocity.Y -= 1f;
						num957 = Gore.NewGore(position, default(Vector2), Main.rand.Next(61, 64));
						gore2 = Main.gore[num957];
						gore2.velocity *= 0.4f;
						Main.gore[num957].velocity.X -= 1f;
						Main.gore[num957].velocity.Y -= 1f;
						if (type == 102)
						{
							Vector2 vector76 = position;
							position.X += width / 2;
							position.Y += height / 2;
							width = 128;
							height = 128;
							position.X -= width / 2;
							position.Y -= height / 2;
							damage = 40;
							Damage();
							position = vector76;
							width = 22;
							height = 22;
						}
						if (type == 75)
						{
							Resize(128, 128);
							damage = 60;
							knockBack = 8f;
							Damage();
							Resize(22, 22);
						}
					}
					else if (type == 29 || type == 108 || type == 470 || type == 637 || type == 1002)
					{
						SoundEngine.PlaySound(SoundID.Item14, position);
						if (type == 29)
						{
							position.X += width / 2;
							position.Y += height / 2;
							width = 200;
							height = 200;
							position.X -= width / 2;
							position.Y -= height / 2;
						}
						for (int num958 = 0; num958 < 50; num958++)
						{
							int num959 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 31, 0f, 0f, 100, default(Color), 2f);
							Dust dust2 = Main.dust[num959];
							dust2.velocity *= 1.4f;
						}
						for (int num960 = 0; num960 < 80; num960++)
						{
							int num961 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 3f);
							Main.dust[num961].noGravity = true;
							Dust dust2 = Main.dust[num961];
							dust2.velocity *= 5f;
							num961 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 6, 0f, 0f, 100, default(Color), 2f);
							dust2 = Main.dust[num961];
							dust2.velocity *= 3f;
						}
						for (int num962 = 0; num962 < 2; num962++)
						{
							int num963 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
							Main.gore[num963].scale = 1.5f;
							Main.gore[num963].velocity.X += 1.5f;
							Main.gore[num963].velocity.Y += 1.5f;
							num963 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
							Main.gore[num963].scale = 1.5f;
							Main.gore[num963].velocity.X -= 1.5f;
							Main.gore[num963].velocity.Y += 1.5f;
							num963 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
							Main.gore[num963].scale = 1.5f;
							Main.gore[num963].velocity.X += 1.5f;
							Main.gore[num963].velocity.Y -= 1.5f;
							num963 = Gore.NewGore(new Vector2(position.X + (float)(width / 2) - 24f, position.Y + (float)(height / 2) - 24f), default(Vector2), Main.rand.Next(61, 64));
							Main.gore[num963].scale = 1.5f;
							Main.gore[num963].velocity.X -= 1.5f;
							Main.gore[num963].velocity.Y -= 1.5f;
						}
						position.X += width / 2;
						position.Y += height / 2;
						width = 10;
						height = 10;
						position.X -= width / 2;
						position.Y -= height / 2;
					}
					else if (type == 69)
					{
						SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
						for (int num964 = 0; num964 < 5; num964++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
						}
						for (int num965 = 0; num965 < 30; num965++)
						{
							int num966 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 33, 0f, -2f, 0, default(Color), 1.1f);
							Main.dust[num966].alpha = 100;
							Main.dust[num966].velocity.X *= 1.5f;
							Dust dust2 = Main.dust[num966];
							dust2.velocity *= 3f;
						}
					}
					else if (type == 70)
					{
						SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
						for (int num967 = 0; num967 < 5; num967++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
						}
						for (int num968 = 0; num968 < 30; num968++)
						{
							int num969 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 52, 0f, -2f, 0, default(Color), 1.1f);
							Main.dust[num969].alpha = 100;
							Main.dust[num969].velocity.X *= 1.5f;
							Dust dust2 = Main.dust[num969];
							dust2.velocity *= 3f;
						}
					}
					else if (type == 621)
					{
						SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
						for (int num970 = 0; num970 < 5; num970++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
						}
						for (int num971 = 0; num971 < 30; num971++)
						{
							int num972 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 266, 0f, -2f, 0, default(Color), 1.1f);
							Main.dust[num972].alpha = 100;
							Main.dust[num972].velocity.X *= 1.5f;
							Dust dust2 = Main.dust[num972];
							dust2.velocity *= 3f;
						}
					}
					else if (type == 114 || type == 115)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num973 = 4; num973 < 31; num973++)
						{
							float num974 = oldVelocity.X * (30f / (float)num973);
							float num975 = oldVelocity.Y * (30f / (float)num973);
							int num976 = Dust.NewDust(new Vector2(position.X - num974, position.Y - num975), 8, 8, 27, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.4f);
							Main.dust[num976].noGravity = true;
							Dust dust2 = Main.dust[num976];
							dust2.velocity *= 0.5f;
							num976 = Dust.NewDust(new Vector2(position.X - num974, position.Y - num975), 8, 8, 27, oldVelocity.X, oldVelocity.Y, 100, default(Color), 0.9f);
							dust2 = Main.dust[num976];
							dust2.velocity *= 0.5f;
						}
					}
					else if (type == 116)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num977 = 4; num977 < 31; num977++)
						{
							float num978 = oldVelocity.X * (30f / (float)num977);
							float num979 = oldVelocity.Y * (30f / (float)num977);
							int num980 = Dust.NewDust(new Vector2(position.X - num978, position.Y - num979), 8, 8, 64, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.8f);
							Main.dust[num980].noGravity = true;
							num980 = Dust.NewDust(new Vector2(position.X - num978, position.Y - num979), 8, 8, 64, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.4f);
							Main.dust[num980].noGravity = true;
						}
					}
					else if (type == 173)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num981 = 4; num981 < 24; num981++)
						{
							float num982 = oldVelocity.X * (30f / (float)num981);
							float num983 = oldVelocity.Y * (30f / (float)num981);
							int num984 = Main.rand.Next(3);
							int num985 = Dust.NewDust(new Vector2(position.X - num982, position.Y - num983), 8, 8, num984 switch
							{
								0 => 15, 
								1 => 57, 
								_ => 58, 
							}, oldVelocity.X * 0.2f, oldVelocity.Y * 0.2f, 100, default(Color), 1.8f);
							Dust dust2 = Main.dust[num985];
							dust2.velocity *= 1.5f;
							Main.dust[num985].noGravity = true;
						}
					}
					else if (type == 132)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num986 = 4; num986 < 31; num986++)
						{
							float num987 = oldVelocity.X * (30f / (float)num986);
							float num988 = oldVelocity.Y * (30f / (float)num986);
							int num989 = Dust.NewDust(new Vector2(oldPosition.X - num987, oldPosition.Y - num988), 8, 8, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.8f);
							Main.dust[num989].noGravity = true;
							Dust dust2 = Main.dust[num989];
							dust2.velocity *= 0.5f;
							num989 = Dust.NewDust(new Vector2(oldPosition.X - num987, oldPosition.Y - num988), 8, 8, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.4f);
							dust2 = Main.dust[num989];
							dust2.velocity *= 0.05f;
						}
					}
					else if (type == 156)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num990 = 4; num990 < 31; num990++)
						{
							float num991 = oldVelocity.X * (30f / (float)num990);
							float num992 = oldVelocity.Y * (30f / (float)num990);
							int num993 = Dust.NewDust(new Vector2(oldPosition.X - num991, oldPosition.Y - num992), 8, 8, 73, oldVelocity.X, oldVelocity.Y, 255, default(Color), 1.8f);
							Main.dust[num993].noGravity = true;
							Dust dust2 = Main.dust[num993];
							dust2.velocity *= 0.5f;
							num993 = Dust.NewDust(new Vector2(oldPosition.X - num991, oldPosition.Y - num992), 8, 8, 73, oldVelocity.X, oldVelocity.Y, 255, default(Color), 1.4f);
							dust2 = Main.dust[num993];
							dust2.velocity *= 0.05f;
							Main.dust[num993].noGravity = true;
						}
					}
					else if (type == 157)
					{
						SoundEngine.PlaySound(SoundID.Item10, position);
						for (int num994 = 4; num994 < 31; num994++)
						{
							int num995 = Dust.NewDust(position, width, height, 107, oldVelocity.X, oldVelocity.Y, 100, default(Color), 1.8f);
							Main.dust[num995].noGravity = true;
							Dust dust2 = Main.dust[num995];
							dust2.velocity *= 0.5f;
						}
					}
					else if (type == 370)
					{
						SoundEngine.PlaySound(SoundID.Item4, position);
						for (int num996 = 0; num996 < 5; num996++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
						}
						for (int num997 = 0; num997 < 30; num997++)
						{
							Vector2 vector77 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
							vector77.Normalize();
							int num998 = Gore.NewGore(base.Center + vector77 * 10f, vector77 * Main.rand.Next(4, 9) * 0.66f + Vector2.UnitY * 1.5f, 331, (float)Main.rand.Next(40, 141) * 0.01f);
							Main.gore[num998].sticky = false;
						}
					}
					else if (type == 371)
					{
						SoundEngine.PlaySound(13, (int)position.X, (int)position.Y);
						SoundEngine.PlaySound(SoundID.Item16, position);
						for (int num999 = 0; num999 < 5; num999++)
						{
							Dust.NewDust(new Vector2(position.X, position.Y), width, height, 13);
						}
						for (int num1000 = 0; num1000 < 30; num1000++)
						{
							Vector2 vector78 = new Vector2(Main.rand.Next(-10, 11), Main.rand.Next(-10, 11));
							vector78.Normalize();
							vector78 *= 0.4f;
							int num1001 = Gore.NewGore(base.Center + vector78 * 10f, vector78 * Main.rand.Next(4, 9) * 0.66f + Vector2.UnitY * 1.5f, Main.rand.Next(435, 438), (float)Main.rand.Next(20, 100) * 0.01f);
							Main.gore[num1001].sticky = false;
						}
					}
					else if (type == 936)
					{
						SoundEngine.PlaySound(SoundID.Item21, position);
						for (int num1002 = 0; num1002 < 20; num1002++)
						{
							Color newColor9 = Main.hslToRgb(0.7f + 0.2f * Main.rand.NextFloat(), 1f, 0.7f);
							newColor9.A /= 2;
							int num1003 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, 150, newColor9);
							Dust dust2 = Main.dust[num1003];
							dust2.velocity *= 1.5f;
							newColor9 = Main.hslToRgb(0.7f + 0.2f * Main.rand.NextFloat(), 1f, 0.5f);
							newColor9.A /= 2;
							num1003 = Dust.NewDust(new Vector2(position.X, position.Y), width, height, 4, 0f, 0f, 150, newColor9, 1.8f);
							dust2 = Main.dust[num1003];
							dust2.velocity *= 3f;
							Main.dust[num1003].noGravity = true;
						}
					}
				}
			}
			if (owner == Main.myPlayer && (type == 370 || type == 371 || type == 936))
			{
				float num1004 = 80f;
				int num1005 = 119;
				if (type == 371)
				{
					num1005 = 120;
				}
				if (type == 936)
				{
					num1005 = 320;
				}
				for (int num1006 = 0; num1006 < 255; num1006++)
				{
					Player player3 = Main.player[num1006];
					if (player3.active && !player3.dead && Vector2.Distance(base.Center, player3.Center) < num1004)
					{
						player3.AddBuff(num1005, 1800, quiet: false);
					}
				}
				for (int num1007 = 0; num1007 < 200; num1007++)
				{
					NPC nPC = Main.npc[num1007];
					if (nPC.active && nPC.life > 0 && Vector2.Distance(base.Center, nPC.Center) < num1004)
					{
						nPC.AddBuff(num1005, 1800);
					}
				}
			}
			if (owner == Main.myPlayer)
			{
				if (type == 30 || type == 517 || type == 397 || type == 588)
				{
					int num1008 = 4;
					Vector2 center2 = base.Center;
					int num1009 = (int)(center2.X / 16f - (float)num1008);
					int num1010 = (int)(center2.X / 16f + (float)num1008);
					int num1011 = (int)(center2.Y / 16f - (float)num1008);
					int num1012 = (int)(center2.Y / 16f + (float)num1008);
					if (num1009 < 0)
					{
						num1009 = 0;
					}
					if (num1010 > Main.maxTilesX)
					{
						num1010 = Main.maxTilesX;
					}
					if (num1011 < 0)
					{
						num1011 = 0;
					}
					if (num1012 > Main.maxTilesY)
					{
						num1012 = Main.maxTilesY;
					}
					ExplodeCrackedTiles(center2, num1008, num1009, num1010, num1011, num1012);
				}
				if (type == 28 || type == 29 || type == 37 || type == 108 || type == 136 || type == 137 || type == 138 || type == 142 || type == 143 || type == 144 || type == 339 || type == 341 || type == 470 || type == 516 || type == 519 || type == 637 || type == 716 || type == 718 || type == 780 || type == 781 || type == 782 || type == 804 || type == 783 || type == 863 || type == 796 || type == 797 || type == 798 || type == 809 || (type == 102 && Main.getGoodWorld && !Main.remixWorld))
				{
					int num1013 = 3;
					if (type == 102)
					{
						num1013 = 4;
					}
					if (type == 28 || type == 37 || type == 516 || type == 519)
					{
						num1013 = 4;
					}
					if (type == 29 || type == 470 || type == 637 || type == 796 || type == 797 || type == 798 || type == 809)
					{
						num1013 = 7;
					}
					if (type == 142 || type == 143 || type == 144 || type == 341)
					{
						num1013 = 5;
					}
					if (type == 716 || type == 780 || type == 781 || type == 782 || type == 804 || type == 783 || type == 863)
					{
						num1013 = 3;
					}
					if (type == 718)
					{
						num1013 = 5;
					}
					if (type == 108)
					{
						num1013 = 10;
					}
					if (type == 1002)
					{
						num1013 = 10;
					}
					Vector2 center3 = position;
					if (type == 716 || type == 718 || type == 773)
					{
						center3 = base.Center;
					}
					int num1014 = num1013;
					int num1015 = num1013;
					int num1016 = (int)(center3.X / 16f - (float)num1014);
					int num1017 = (int)(center3.X / 16f + (float)num1014);
					int num1018 = (int)(center3.Y / 16f - (float)num1015);
					int num1019 = (int)(center3.Y / 16f + (float)num1015);
					if (num1016 < 0)
					{
						num1016 = 0;
					}
					if (num1017 > Main.maxTilesX)
					{
						num1017 = Main.maxTilesX;
					}
					if (num1018 < 0)
					{
						num1018 = 0;
					}
					if (num1019 > Main.maxTilesY)
					{
						num1019 = Main.maxTilesY;
					}
					bool wallSplode2 = ShouldWallExplode(center3, num1013, num1016, num1017, num1018, num1019);
					ExplodeTiles(center3, num1013, num1016, num1017, num1018, num1019, wallSplode2);
				}
				if (Main.netMode != 0)
				{
					NetMessage.SendData(29, -1, -1, null, identity, owner);
				}
				if (!noDropItem)
				{
					int num1020 = -1;
					if (type >= 736 && type <= 738)
					{
						SoundEngine.PlaySound(SoundID.Item127, position);
						for (int num1021 = 0; num1021 < 3; num1021++)
						{
							Dust.NewDust(position, 16, 16, type - 736 + 275);
						}
						int num1022 = (int)(base.Center.X / 16f);
						int num1023 = (int)(base.Center.Y / 16f) + 1;
						if (Main.myPlayer == owner && Main.tile[num1022, num1023].active() && TileID.Sets.CrackedBricks[Main.tile[num1022, num1023].type] && Main.rand.Next(2) == 0)
						{
							WorldGen.KillTile(num1022, num1023);
							if (Main.netMode != 0)
							{
								NetMessage.SendData(17, -1, -1, null, 20, num1022, num1023);
							}
						}
					}
					else if (aiStyle == 10)
					{
						int num1024 = (int)(position.X + (float)(width / 2)) / 16;
						int num1025 = (int)(position.Y + (float)(height / 2)) / 16;
						int num1026 = 0;
						int num1027 = 2;
						if (type == 109)
						{
							num1026 = 147;
							num1027 = 0;
						}
						if (type == 31)
						{
							num1026 = 53;
							num1027 = 169;
							if (ai[0] == 2f)
							{
								num1027 = 0;
							}
						}
						if (type == 42)
						{
							num1026 = 53;
							num1027 = 0;
						}
						if (type == 56)
						{
							num1026 = 112;
							num1027 = 370;
						}
						if (type == 65)
						{
							num1026 = 112;
							num1027 = 0;
						}
						if (type == 67)
						{
							num1026 = 116;
							num1027 = 408;
						}
						if (type == 68)
						{
							num1026 = 116;
							num1027 = 0;
						}
						if (type == 71)
						{
							num1026 = 123;
							num1027 = 424;
						}
						if (type == 39)
						{
							num1026 = 59;
							num1027 = 0;
						}
						if (type == 40)
						{
							num1026 = 57;
							num1027 = 0;
						}
						if (type == 179)
						{
							num1026 = 224;
							num1027 = 1103;
						}
						if (type == 241)
						{
							num1026 = 234;
							num1027 = 1246;
						}
						if (type == 354)
						{
							num1026 = 234;
							num1027 = 0;
						}
						if (type == 411)
						{
							num1026 = 330;
							num1027 = 71;
						}
						if (type == 412)
						{
							num1026 = 331;
							num1027 = 72;
						}
						if (type == 413)
						{
							num1026 = 332;
							num1027 = 73;
						}
						if (type == 414)
						{
							num1026 = 333;
							num1027 = 74;
						}
						if (type == 812)
						{
							num1026 = 495;
							num1027 = 4090;
						}
						if (type == 109)
						{
							int num1028 = Player.FindClosest(position, width, height);
							if ((double)(base.Center - Main.player[num1028].Center).Length() > (double)Main.LogicCheckScreenWidth * 0.75)
							{
								num1026 = -1;
								num1027 = 593;
							}
						}
						if (Main.tile[num1024, num1025].nactive() && Main.tile[num1024, num1025].halfBrick() && velocity.Y > 0f && Math.Abs(velocity.Y) > Math.Abs(velocity.X))
						{
							num1025--;
						}
						if (!Main.tile[num1024, num1025].active() && num1026 >= 0)
						{
							bool flag4 = false;
							bool flag5 = false;
							if (num1025 < Main.maxTilesY - 2)
							{
								Tile tile2 = Main.tile[num1024, num1025 + 1];
								if (tile2 != null && tile2.active())
								{
									if (tile2.active() && tile2.type == 314)
									{
										flag5 = true;
									}
									if (tile2.active() && WorldGen.BlockBelowMakesSandFall(num1024, num1025))
									{
										flag5 = true;
									}
								}
							}
							if (!flag5)
							{
								flag4 = WorldGen.PlaceTile(num1024, num1025, num1026, mute: false, forced: true);
							}
							if (!flag5 && Main.tile[num1024, num1025].active() && Main.tile[num1024, num1025].type == num1026)
							{
								if (Main.tile[num1024, num1025 + 1].halfBrick() || Main.tile[num1024, num1025 + 1].slope() != 0)
								{
									WorldGen.SlopeTile(num1024, num1025 + 1);
									if (Main.netMode != 0)
									{
										NetMessage.SendData(17, -1, -1, null, 14, num1024, num1025 + 1);
									}
								}
								if (Main.netMode != 0)
								{
									NetMessage.SendData(17, -1, -1, null, 1, num1024, num1025, num1026);
								}
							}
							else if (!flag4 && num1027 > 0)
							{
								num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, num1027);
							}
						}
						else if (num1027 > 0)
						{
							num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, num1027);
						}
					}
					if (type == 171)
					{
						if (ai[1] == 0f)
						{
							num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 985);
							Main.item[num1020].noGrabDelay = 0;
						}
						else if (ai[1] < 10f)
						{
							num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 965, (int)(10f - ai[1]));
							Main.item[num1020].noGrabDelay = 0;
						}
					}
					if (type == 475)
					{
						if (ai[1] == 0f)
						{
							num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3005);
							Main.item[num1020].noGrabDelay = 0;
						}
						else if (ai[1] < 10f)
						{
							num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 2996, (int)(10f - ai[1]));
							Main.item[num1020].noGrabDelay = 0;
						}
					}
					if (type == 505)
					{
						if (ai[1] == 0f)
						{
							num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3079);
							Main.item[num1020].noGrabDelay = 0;
						}
						else if (ai[1] < 10f)
						{
							num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3077, (int)(10f - ai[1]));
							Main.item[num1020].noGrabDelay = 0;
						}
					}
					if (type == 506)
					{
						if (ai[1] == 0f)
						{
							num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3080);
							Main.item[num1020].noGrabDelay = 0;
						}
						else if (ai[1] < 10f)
						{
							num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 3078, (int)(10f - ai[1]));
							Main.item[num1020].noGrabDelay = 0;
						}
					}
					if (type == 12 && damage > 500 && !Main.remixWorld)
					{
						num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 75);
					}
					if (type == 155)
					{
						num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 859);
					}
					if (type == 861)
					{
						num1020 = Item.NewItem(GetItemSource_DropAsItem(), (int)position.X, (int)position.Y, width, height, 4743);
					}
					if (Main.netMode == 1 && num1020 >= 0)
					{
						NetMessage.SendData(21, -1, -1, null, num1020, 1f);
					}
				}
				if (type == 69 || type == 70 || type == 621)
				{
					int i2 = (int)(position.X + (float)(width / 2)) / 16;
					int j2 = (int)(position.Y + (float)(height / 2)) / 16;
					if (type == 69)
					{
						WorldGen.Convert(i2, j2, 2);
					}
					if (type == 70)
					{
						WorldGen.Convert(i2, j2, 1);
					}
					if (type == 621)
					{
						WorldGen.Convert(i2, j2, 4);
					}
				}
				if (type == 378)
				{
					int num1029 = Main.rand.Next(2, 4);
					if (Main.rand.Next(5) == 0)
					{
						num1029++;
					}
					for (int num1030 = 0; num1030 < num1029; num1030++)
					{
						float x2 = velocity.X;
						float y8 = velocity.Y;
						x2 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
						y8 *= 1f + (float)Main.rand.Next(-20, 21) * 0.01f;
						NewProjectile(GetProjectileSource_FromThis(), base.Center.X, base.Center.Y, x2, y8, 379, damage, knockBack, owner);
					}
				}
			}
			active = false;
		}

		private void DoRainbowCrystalStaffExplosion()
		{
			Vector2 spinningpoint = new Vector2(0f, -3f).RotatedByRandom(3.1415927410125732);
			float num = Main.rand.Next(7, 13);
			Vector2 vector = new Vector2(2.1f, 2f);
			Color newColor = Main.hslToRgb(ai[0], 1f, 0.5f);
			newColor.A = byte.MaxValue;
			for (float num2 = 0f; num2 < num; num2 += 1f)
			{
				int num3 = Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 0, newColor);
				Main.dust[num3].position = base.Center;
				Main.dust[num3].velocity = spinningpoint.RotatedBy(MathF.PI * 2f * num2 / num) * vector * (0.8f + Main.rand.NextFloat() * 0.4f);
				Main.dust[num3].noGravity = true;
				Main.dust[num3].scale = 2f;
				Main.dust[num3].fadeIn = Main.rand.NextFloat() * 2f;
				if (num3 != 6000)
				{
					Dust dust = Dust.CloneDust(num3);
					dust.scale /= 2f;
					dust.fadeIn /= 2f;
					dust.color = new Color(255, 255, 255, 255);
				}
			}
			for (float num4 = 0f; num4 < num; num4 += 1f)
			{
				int num5 = Dust.NewDust(base.Center, 0, 0, 267, 0f, 0f, 0, newColor);
				Main.dust[num5].position = base.Center;
				Main.dust[num5].velocity = spinningpoint.RotatedBy(MathF.PI * 2f * num4 / num) * vector * (0.8f + Main.rand.NextFloat() * 0.4f);
				Main.dust[num5].velocity *= Main.rand.NextFloat() * 0.8f;
				Main.dust[num5].noGravity = true;
				Main.dust[num5].scale = Main.rand.NextFloat() * 1f;
				Main.dust[num5].fadeIn = Main.rand.NextFloat() * 2f;
				if (num5 != 6000)
				{
					Dust dust2 = Dust.CloneDust(num5);
					dust2.scale /= 2f;
					dust2.fadeIn /= 2f;
					dust2.color = new Color(255, 255, 255, 255);
				}
			}
		}

		public bool ShouldWallExplode(Vector2 compareSpot, int radius, int minI, int maxI, int minJ, int maxJ)
		{
			bool result = false;
			for (int i = minI; i <= maxI; i++)
			{
				for (int j = minJ; j <= maxJ; j++)
				{
					float num = Math.Abs((float)i - compareSpot.X / 16f);
					float num2 = Math.Abs((float)j - compareSpot.Y / 16f);
					if (Math.Sqrt(num * num + num2 * num2) < (double)radius && Main.tile[i, j] != null && Main.tile[i, j].wall == 0)
					{
						result = true;
						break;
					}
				}
			}
			return result;
		}

		public Color GetFloatingDaggerMinionGlowColor()
		{
			float num = (float)(whoAmI % 6) / 6f;
			return Main.hslToRgb(0.66f + 0.33f * num, 0.7f, 0.6f) * 0.7f;
		}

		public bool CanExplodeTile(int x, int y)
		{
			if (Main.tileDungeon[Main.tile[x, y].type] || TileID.Sets.BasicChest[Main.tile[x, y].type])
			{
				return false;
			}
			switch (Main.tile[x, y].type)
			{
			case 26:
			case 88:
			case 107:
			case 108:
			case 111:
			case 211:
			case 221:
			case 222:
			case 223:
			case 226:
			case 237:
			case 470:
			case 475:
				return false;
			case 37:
			case 58:
				if (!Main.hardMode)
				{
					return false;
				}
				break;
			case 77:
				if (!Main.hardMode && y >= Main.UnderworldLayer)
				{
					return false;
				}
				break;
			case 48:
			case 232:
				if (Main.getGoodWorld)
				{
					return false;
				}
				break;
			case 137:
				if (!NPC.downedGolemBoss)
				{
					int num = Main.tile[x, y].frameY / 18;
					if ((uint)(num - 1) <= 3u)
					{
						return false;
					}
				}
				break;
			}
			return true;
		}

		public void ExplodeTiles(Vector2 compareSpot, int radius, int minI, int maxI, int minJ, int maxJ, bool wallSplode)
		{
			AchievementsHelper.CurrentlyMining = true;
			for (int i = minI; i <= maxI; i++)
			{
				for (int j = minJ; j <= maxJ; j++)
				{
					float num = Math.Abs((float)i - compareSpot.X / 16f);
					float num2 = Math.Abs((float)j - compareSpot.Y / 16f);
					if (!(Math.Sqrt(num * num + num2 * num2) < (double)radius))
					{
						continue;
					}
					bool flag = true;
					if (Main.tile[i, j] != null && Main.tile[i, j].active())
					{
						flag = CanExplodeTile(i, j);
						if (flag)
						{
							WorldGen.KillTile(i, j);
							if (!Main.tile[i, j].active() && Main.netMode != 0)
							{
								NetMessage.SendData(17, -1, -1, null, 0, i, j);
							}
						}
					}
					if (!flag)
					{
						continue;
					}
					for (int k = i - 1; k <= i + 1; k++)
					{
						for (int l = j - 1; l <= j + 1; l++)
						{
							if (Main.tile[k, l] != null && Main.tile[k, l].wall > 0 && wallSplode)
							{
								WorldGen.KillWall(k, l);
								if (Main.tile[k, l].wall == 0 && Main.netMode != 0)
								{
									NetMessage.SendData(17, -1, -1, null, 2, k, l);
								}
							}
						}
					}
				}
			}
			AchievementsHelper.CurrentlyMining = false;
		}

		public void ExplodeCrackedTiles(Vector2 compareSpot, int radius, int minI, int maxI, int minJ, int maxJ)
		{
			AchievementsHelper.CurrentlyMining = true;
			for (int i = minI; i <= maxI; i++)
			{
				for (int j = minJ; j <= maxJ; j++)
				{
					float num = Math.Abs((float)i - compareSpot.X / 16f);
					float num2 = Math.Abs((float)j - compareSpot.Y / 16f);
					if (Math.Sqrt(num * num + num2 * num2) < (double)radius && Main.tile[i, j] != null && Main.tile[i, j].active() && TileID.Sets.CrackedBricks[Main.tile[i, j].type])
					{
						WorldGen.KillTile(i, j);
						if (!Main.tile[i, j].active() && Main.netMode != 0)
						{
							NetMessage.SendData(17, -1, -1, null, 20, i, j);
						}
					}
				}
			}
			AchievementsHelper.CurrentlyMining = false;
		}

		public bool TryGetContainerIndex(out int containerIndex)
		{
			containerIndex = -1;
			if (type == 525 || type == 960)
			{
				containerIndex = -2;
				return true;
			}
			if (type == 734)
			{
				containerIndex = -5;
				return true;
			}
			return false;
		}

		public bool IsInteractible()
		{
			int num = type;
			if (num == 525 || num == 734 || num == 960)
			{
				return true;
			}
			return false;
		}

		public Color GetAlpha(Color newColor)
		{
			if (type == 920 || type == 921)
			{
				return Color.Lerp(newColor, Color.White, 0.4f) * Opacity;
			}
			if (type == 47 && Main.player[owner].wet)
			{
				return Color.White;
			}
			if (type == 937)
			{
				newColor.A = (byte)((float)(int)newColor.A * 0.75f);
			}
			if (type == 880 || type == 929)
			{
				newColor.A /= 2;
			}
			if (type == 963)
			{
				float num = 0.85f;
				newColor *= num;
				newColor.A = (byte)((float)(int)newColor.A * num);
				if (ai[0] >= 2f)
				{
					newColor.G = (byte)((float)(int)newColor.G * 0.7f);
					newColor.B = (byte)((float)(int)newColor.B * 0.7f);
				}
			}
			if (type == 1021)
			{
				return Color.White;
			}
			if (type == 1006)
			{
				return Color.White;
			}
			if (type == 981)
			{
				return Color.White;
			}
			if (type == 75)
			{
				return Color.Lerp(newColor, Color.White, 0.66f) * Opacity;
			}
			int r;
			int g;
			int b;
			if (type == 969)
			{
				int num2 = 210;
				r = (g = (b = num2));
				if (newColor.R < num2)
				{
					r = newColor.R;
				}
				if (newColor.G < num2)
				{
					g = newColor.G;
				}
				if (newColor.B < num2)
				{
					b = newColor.B;
				}
				return new Color(r, g, b, 185) * Opacity;
			}
			if (type == 967)
			{
				return Color.White * Opacity;
			}
			if (type == 855)
			{
				newColor = Color.Lerp(newColor, new Color(255, 200, 60), 0.5f);
			}
			if (type == 933 || type == 1001)
			{
				newColor = Color.White * Opacity;
			}
			if (type == 270)
			{
				return new Color(255, 255, 255, (int)Utils.WrappedLerp(0f, 255f, (float)(timeLeft % 40) / 40f));
			}
			if (type == 837)
			{
				if (alpha > 0)
				{
					return Color.Transparent;
				}
				return new Color(255, 255, 255, 200);
			}
			if (type == 180 || type == 345)
			{
				return Color.Lerp(newColor, Color.White, 0.75f);
			}
			if (type == 586)
			{
				if (ai[2] == 1f)
				{
					Color value = new Color((int)newColor.R / 2, 0, newColor.G);
					float amount = (float)Math.Sin(ai[0] % 120f * (MathF.PI * 2f) / 120f) * 0.5f + 0.5f;
					newColor = Color.Lerp(newColor, value, amount);
					return Color.Lerp(newColor, Color.Lerp(Color.White, value, amount), 0.75f);
				}
				return Color.Lerp(newColor, Color.White, 0.75f);
			}
			if (type == 764 || type == 856 || type == 857 || type == 864)
			{
				return Color.White;
			}
			if (type == 873 || type == 872 || type == 931 || type == 913 || type == 34)
			{
				return Color.White * Opacity;
			}
			if (type == 756 || type == 961)
			{
				return Color.Lerp(newColor, Color.Black, 0.25f);
			}
			if (type == 895)
			{
				return Color.White * Opacity;
			}
			if (type == 893 || type == 907)
			{
				return new Color(255, 255, 255, 150);
			}
			if (type == 833 || type == 834 || type == 835 || type == 912)
			{
				return Color.Lerp(newColor, Color.White, 0.25f);
			}
			if (type == 351 || type == 350)
			{
				Point point = base.Center.ToTileCoordinates();
				if (WorldGen.InWorld(point.X, point.Y) && !WorldGen.SolidTile(point.X, point.Y))
				{
					return Color.Lerp(newColor, Color.White, 0.15f);
				}
				return Color.Lerp(newColor, Color.White, 0.05f);
			}
			if (type == 346 || type == 347 || type == 325 || type == 755)
			{
				return Color.Lerp(newColor, Color.White, 0.75f);
			}
			if (type == 650)
			{
				r = (int)((double)(int)newColor.R * 1.5);
				g = (int)((double)(int)newColor.G * 1.5);
				b = (int)((double)(int)newColor.B * 1.5);
				if (r > 255)
				{
					r = 255;
				}
				if (g > 255)
				{
					g = 255;
				}
				if (b > 255)
				{
					b = 255;
				}
			}
			else
			{
				if (type == 948)
				{
					return Color.White;
				}
				if (type == 604 || type == 631)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
				}
				if (type == 342)
				{
					return Color.Lerp(newColor, Color.White, 0.75f) * Opacity;
				}
				if (type == 636)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 64 - alpha / 4);
				}
				if (type == 673 || type == 706)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 180 - alpha / 2 - alpha / 4);
				}
				if (type == 603 || type == 633)
				{
					return new Color(255, 255, 255, 200);
				}
				if (type == 623 || (type >= 625 && type <= 628) || type == 710)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
				}
				if (type == 645 || type == 643)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 127 - alpha / 2);
				}
				if (type == 611)
				{
					return new Color(255, 255, 255, 200);
				}
				if (type == 640 || type == 644 || type == 658)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
				}
				if (type == 612 || type == 953)
				{
					return new Color(255, 255, 255, 127);
				}
				if (type == 978)
				{
					return new Color(255, 255, 255, 127) * Opacity;
				}
				if (aiStyle == 105)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
				}
				if (type == 554)
				{
					return new Color(200, 200, 200, 200);
				}
				if (type == 601)
				{
					return PortalHelper.GetPortalColor(owner, (int)ai[0]);
				}
				if (type == 602)
				{
					Color portalColor = PortalHelper.GetPortalColor(owner, (int)ai[1]);
					portalColor.A = 227;
					return portalColor;
				}
				if (type == 585)
				{
					byte a = newColor.A;
					newColor = Color.Lerp(newColor, Color.White, 0.5f);
					newColor.A = a;
					return newColor;
				}
				if (type == 714)
				{
					byte a2 = newColor.A;
					newColor = Color.Lerp(newColor, Color.White, 0.8f);
					newColor.A = a2;
					newColor *= (float)(int)a2 / 255f;
					return newColor;
				}
				if (type == 573 || type == 578 || type == 579 || type == 617 || type == 641 || type == 707 || type == 813)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
				}
				if (type == 490)
				{
					return Color.White;
				}
				if (type == 575 || type == 596 || type == 659)
				{
					if (timeLeft < 30)
					{
						float num3 = (float)timeLeft / 30f;
						alpha = (int)(255f - 255f * num3);
					}
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 128 - alpha / 2);
				}
				if (type == 546)
				{
					return new Color(255, 200, 255, 200);
				}
				if (type == 553)
				{
					return new Color(255, 255, 200, 200);
				}
				if (type == 540)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
				}
				if (type == 498)
				{
					return new Color(255, 100, 20, 200);
				}
				if (type == 538)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
				}
				if (type == 518)
				{
					float num4 = 1f - (float)alpha / 255f;
					return new Color((int)(200f * num4), (int)(200f * num4), (int)(200f * num4), (int)(100f * num4));
				}
				if (type == 518 || type == 595 || type == 735)
				{
					Color color = Color.Lerp(newColor, Color.White, 0.85f);
					color.A = 128;
					return color * (1f - (float)alpha / 255f);
				}
				if (type == 536 || type == 607)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 63 - alpha / 4);
				}
				if (type == 591)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 63 - alpha / 4);
				}
				if (type == 493 || type == 494)
				{
					return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
				}
				if (type == 492)
				{
					return new Color(255, 255, 255, 255);
				}
				if (type == 491)
				{
					return new Color(255, 255, 255, 255);
				}
				if (type == 485 || type == 502)
				{
					return new Color(255, 255, 255, 200);
				}
				if (type == 488)
				{
					return new Color(255, 255, 255, 255);
				}
				if (type == 477 || type == 478 || type == 479)
				{
					if (alpha == 0)
					{
						return new Color(255, 255, 255, 200);
					}
					return new Color(0, 0, 0, 0);
				}
				if (type == 473)
				{
					return new Color(255, 255, 255, 255);
				}
				if (type == 50 || type == 53 || type == 515 || type == 870)
				{
					return new Color(255, 255, 255, 0);
				}
				if (type == 723 || type == 724 || type == 725 || type == 726 || type == 728 || type == 9)
				{
					return new Color(255, 255, 255, 0) * Opacity;
				}
				if (type == 92)
				{
					return new Color(255, 255, 255, 0);
				}
				if (type == 91)
				{
					return new Color(200, 200, 200, 0);
				}
				if (type == 34 || type == 15 || type == 93 || type == 94 || type == 95 || type == 96 || type == 253 || type == 258 || (type == 102 && alpha < 255))
				{
					return new Color(200, 200, 200, 25);
				}
				if (type == 465)
				{
					return new Color(255, 255, 255, 0) * (1f - (float)alpha / 255f);
				}
				if (type == 503)
				{
					Color value2 = Color.Lerp(newColor, Color.White, 0.5f) * (1f - (float)alpha / 255f);
					Color value3 = Color.Lerp(Color.Purple, Color.White, 0.33f);
					float amount2 = 0.25f + (float)Math.Cos(localAI[0]) * 0.25f;
					return Color.Lerp(value2, value3, amount2);
				}
				if (type == 467)
				{
					return new Color(255, 255, 255, 255) * (1f - (float)alpha / 255f);
				}
				if (type == 694 || type == 695 || type == 696)
				{
					return new Color(255, 255, 255, 127) * (1f - (float)alpha / 255f);
				}
				if (type == 634 || type == 635)
				{
					return new Color(255, 255, 255, 127) * Opacity;
				}
				if (type == 671)
				{
					return new Color(255, 255, 255, 255) * Opacity;
				}
				if (type == 664 || type == 666 || type == 668)
				{
					newColor = Color.Lerp(newColor, Color.White, 0.5f);
					return new Color(newColor.R, newColor.G, newColor.B, 200) * Opacity;
				}
				if (type == 451)
				{
					return new Color(255, 255, 255, 200) * ((255f - (float)alpha) / 255f);
				}
				if (type == 684)
				{
					return new Color(255, 255, 255, 200) * ((255f - (float)alpha) / 255f);
				}
				if (type == 454 || type == 452)
				{
					return new Color(255, 255, 255, 255) * (1f - (float)alpha / 255f);
				}
				if (type == 464)
				{
					return new Color(255, 255, 255, 255) * ((255f - (float)alpha) / 255f);
				}
				if (type == 450)
				{
					return new Color(200, 200, 200, 255 - alpha);
				}
				if (type == 459 || type == 709)
				{
					return new Color(255, 255, 255, 200);
				}
				if (type == 447)
				{
					return new Color(255, 255, 255, 200);
				}
				if (type == 446)
				{
					return Color.Lerp(newColor, Color.White, 0.8f) * (1f - (float)alpha / 255f);
				}
				if (type == 691 || type == 692 || type == 693)
				{
					return Color.Lerp(newColor, Color.White, 0.4f) * (1f - (float)alpha / 255f);
				}
				if (type >= 646 && type <= 649)
				{
					return Color.Lerp(newColor, Color.White, 0.8f) * (1f - (float)alpha / 255f);
				}
				if (type == 445)
				{
					return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
				}
				if (type == 440 || type == 449 || type == 606)
				{
					r = 255 - alpha;
					g = 255 - alpha;
					b = 255 - alpha;
				}
				else
				{
					if (type == 444)
					{
						return newColor * (1f - (float)alpha / 255f);
					}
					if (type == 443 || type == 675 || type == 686 || type == 711)
					{
						return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
					}
					if (type == 676)
					{
						return newColor * Opacity;
					}
					if (type == 438)
					{
						return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
					}
					if (type == 592)
					{
						return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
					}
					if (type == 437 || type == 700)
					{
						return new Color(255, 255, 255, 0) * (1f - (float)alpha / 255f);
					}
					if (type == 964 || type == 965)
					{
						return new Color(255, 255, 255, 255) * Opacity;
					}
					if (type == 462)
					{
						return new Color(255, 255, 255, 128) * (1f - (float)alpha / 255f);
					}
					if (type == 352)
					{
						Color color2 = Color.Lerp(newColor, Color.White, 0.5f);
						color2.A = (byte)((float)(int)color2.A * ((float)alpha / 255f));
						return new Color(color2.R, color2.G, color2.B, color2.A);
					}
					if (type == 435 || type == 732 || type == 731)
					{
						newColor = Color.Lerp(newColor, Color.White, 0.8f);
						return new Color(newColor.R, newColor.G, newColor.B, 25);
					}
					if (type == 682)
					{
						newColor = Color.Lerp(newColor, Color.White, 0.8f);
						return new Color(newColor.R, newColor.G, newColor.B, 127);
					}
					if (type == 436)
					{
						newColor = Color.Lerp(newColor, Color.White, 0.8f);
						return new Color(newColor.R, newColor.G, newColor.B, 25);
					}
					if (type == 409)
					{
						return new Color(250, 250, 250, 200);
					}
					if (type == 348 || type == 349)
					{
						return new Color(200, 200, 200, alpha);
					}
					if (type == 337)
					{
						return new Color(250, 250, 250, 150);
					}
					if (type >= 424 && type <= 426)
					{
						byte b2 = 150;
						if (newColor.R < b2)
						{
							newColor.R = b2;
						}
						if (newColor.G < b2)
						{
							newColor.G = b2;
						}
						if (newColor.B < b2)
						{
							newColor.B = b2;
						}
						return new Color(newColor.R, newColor.G, newColor.B, 255);
					}
					if (type == 431 || type == 432)
					{
						return new Color(250, 250, 250, 255 - alpha);
					}
					if (type == 343 || type == 344)
					{
						float num5 = 1f - (float)alpha / 255f;
						return new Color((int)(250f * num5), (int)(250f * num5), (int)(250f * num5), (int)(100f * num5));
					}
					if (type == 332)
					{
						return new Color(255, 255, 255, 255);
					}
					if (type == 329)
					{
						return new Color(200, 200, 200, 50);
					}
					if (type >= 326 && type <= 328)
					{
						return Color.Transparent;
					}
					if (type >= 400 && type <= 402)
					{
						return Color.Transparent;
					}
					if (type == 324 && frame >= 6 && frame <= 9)
					{
						return new Color(255, 255, 255, 255);
					}
					if (type == 16)
					{
						return new Color(255, 255, 255, 0);
					}
					if (type == 321)
					{
						return new Color(200, 200, 200, 0);
					}
					if (type == 76 || type == 77 || type == 78)
					{
						return new Color(255, 255, 255, 0);
					}
					if (type == 308)
					{
						return new Color(200, 200, 255, 125);
					}
					if (type == 263)
					{
						if (timeLeft < 255)
						{
							return new Color(255, 255, 255, (byte)timeLeft);
						}
						return new Color(255, 255, 255, 255);
					}
					if (type == 274)
					{
						if (timeLeft < 85)
						{
							byte b3 = (byte)(timeLeft * 3);
							byte b4 = (byte)(100f * ((float)(int)b3 / 255f));
							return new Color(b3, b3, b3, b4);
						}
						return new Color(255, 255, 255, 100);
					}
					if (type == 5)
					{
						return new Color(255, 255, 255, 0);
					}
					if (type == 300)
					{
						return new Color(250, 250, 250, 50);
					}
					if (type == 301)
					{
						if (ai[0] == 1f)
						{
							return newColor;
						}
						return new Color(250, 250, 250, 50);
					}
					if (type == 712)
					{
						return Color.Lerp(newColor, Color.White, 0.4f) * Opacity;
					}
					if (type == 304)
					{
						return new Color(255 - alpha, 255 - alpha, 255 - alpha, (byte)((float)(255 - alpha) / 3f));
					}
					if (type == 116 || type == 132 || type == 156 || type == 157 || type == 157 || type == 173)
					{
						if (localAI[1] >= 15f)
						{
							return new Color(255, 255, 255, alpha);
						}
						if (localAI[1] < 5f)
						{
							return Color.Transparent;
						}
						int num6 = (int)((localAI[1] - 5f) / 10f * 255f);
						return new Color(num6, num6, num6, num6);
					}
					if (type == 254)
					{
						if (timeLeft < 30)
						{
							float num7 = (float)timeLeft / 30f;
							alpha = (int)(255f - 255f * num7);
						}
						return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
					}
					if (type == 265 || type == 355)
					{
						if (alpha > 0)
						{
							return Color.Transparent;
						}
						return new Color(255, 255, 255, 0);
					}
					if (type == 257)
					{
						if (alpha > 200)
						{
							return Color.Transparent;
						}
						return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
					}
					if (type == 259)
					{
						if (alpha > 200)
						{
							return Color.Transparent;
						}
						return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
					}
					if (type >= 150 && type <= 152)
					{
						return new Color(255 - alpha, 255 - alpha, 255 - alpha, 255 - alpha);
					}
					if (type == 250)
					{
						return Color.Transparent;
					}
					if (type == 251)
					{
						r = 255 - alpha;
						g = 255 - alpha;
						b = 255 - alpha;
						return new Color(r, g, b, 0);
					}
					if (type == 131)
					{
						return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
					}
					if (type == 211)
					{
						return new Color(255, 255, 255, 0);
					}
					if (type == 229)
					{
						return new Color(255, 255, 255, 50);
					}
					if (type == 221 || type == 729 || type == 977)
					{
						return new Color(255, 255, 255, 200);
					}
					if (type == 20)
					{
						if (alpha <= 150)
						{
							return new Color(255, 255, 255, 0);
						}
						return new Color(0, 0, 0, 0);
					}
					if (type == 207)
					{
						r = 255 - alpha;
						g = 255 - alpha;
						b = 255 - alpha;
					}
					else
					{
						if (type == 242)
						{
							if (alpha < 140)
							{
								return new Color(255, 255, 255, 100);
							}
							return Color.Transparent;
						}
						if (type == 638)
						{
							return new Color(255, 255, 255, 100) * Opacity;
						}
						if (type == 660)
						{
							return new Color(150, 255, 255, 0) * Opacity;
						}
						if (type == 209)
						{
							r = newColor.R - alpha;
							g = newColor.G - alpha;
							b = newColor.B - alpha / 2;
						}
						else
						{
							if (type == 130)
							{
								return new Color(255, 255, 255, 175);
							}
							if (type == 182)
							{
								return new Color(255, 255, 255, 200);
							}
							if (type == 226)
							{
								r = 255;
								g = 255;
								b = 255;
								float num8 = (float)(int)Main.mouseTextColor / 200f - 0.3f;
								r = (int)((float)r * num8);
								g = (int)((float)g * num8);
								b = (int)((float)b * num8);
								r += 50;
								if (r > 255)
								{
									r = 255;
								}
								g += 50;
								if (g > 255)
								{
									g = 255;
								}
								b += 50;
								if (b > 255)
								{
									b = 255;
								}
								return new Color(r, g, b, 200);
							}
							if (type == 227)
							{
								r = (g = (b = 255));
								float num9 = (float)(int)Main.mouseTextColor / 100f - 1.6f;
								r = (int)((float)r * num9);
								g = (int)((float)g * num9);
								b = (int)((float)b * num9);
								int num10 = (int)(100f * num9);
								r += 50;
								if (r > 255)
								{
									r = 255;
								}
								g += 50;
								if (g > 255)
								{
									g = 255;
								}
								b += 50;
								if (b > 255)
								{
									b = 255;
								}
								return new Color(r, g, b, num10);
							}
							if (type == 114 || type == 115)
							{
								if (localAI[1] >= 15f)
								{
									return new Color(255, 255, 255, alpha);
								}
								if (localAI[1] < 5f)
								{
									return Color.Transparent;
								}
								int num11 = (int)((localAI[1] - 5f) / 10f * 255f);
								return new Color(num11, num11, num11, num11);
							}
							if (type == 83 || type == 88 || type == 89 || type == 90 || type == 100 || type == 104 || type == 279 || (type >= 283 && type <= 287) || type == 876)
							{
								if (alpha < 200)
								{
									return new Color(255 - alpha, 255 - alpha, 255 - alpha, 0);
								}
								return Color.Transparent;
							}
							if (type == 34 || type == 35 || type == 15 || type == 19 || type == 44 || type == 45)
							{
								return Color.White;
							}
							if (type == 79)
							{
								r = Main.DiscoR;
								g = Main.DiscoG;
								b = Main.DiscoB;
								return default(Color);
							}
							if (type == 9 || type == 15 || type == 34 || type == 50 || type == 53 || type == 76 || type == 77 || type == 78 || type == 92 || type == 91)
							{
								r = newColor.R - alpha / 3;
								g = newColor.G - alpha / 3;
								b = newColor.B - alpha / 3;
							}
							else
							{
								if (type == 18)
								{
									return new Color(255, 255, 255, 50);
								}
								if (type == 16 || type == 44 || type == 45)
								{
									r = newColor.R;
									g = newColor.G;
									b = newColor.B;
								}
								else if (type == 12 || type == 72 || type == 86 || type == 87 || type == 955)
								{
									return new Color(255, 255, 255, newColor.A - alpha);
								}
							}
						}
					}
				}
			}
			float num12 = (float)(255 - alpha) / 255f;
			r = (int)((float)(int)newColor.R * num12);
			g = (int)((float)(int)newColor.G * num12);
			b = (int)((float)(int)newColor.B * num12);
			int num13 = newColor.A - alpha;
			if (num13 < 0)
			{
				num13 = 0;
			}
			if (num13 > 255)
			{
				num13 = 255;
			}
			return new Color(r, g, b, num13);
		}

		public override string ToString()
		{
			return "type:" + type + ", name:" + Name + ", active:" + active.ToString() + ", whoAmI:" + whoAmI + ", identity:" + identity + ", ai0:" + ai[0] + ", uuid:" + projUUID;
		}
	}
}
